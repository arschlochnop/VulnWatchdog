## CVE-2024-9264-Grafana-SQL表达式注入

**漏洞编号:** CVE-2024-9264

**漏洞类型:** 代码注入/本地文件包含

**影响应用:** Grafana

**危害等级:** 高危，可能导致远程代码执行和敏感信息泄露

**影响版本:** 11.0.x, 11.1.x, 11.2.x（低于修复版本）

**利用条件:** 需要Grafana启用SQL Expressions实验性功能，duckdb二进制文件位于Grafana的$PATH中，且攻击者具有Viewer或更高权限。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-9264是Grafana中SQL表达式功能的一个代码注入和本地文件包含漏洞。攻击者可以通过构造恶意的duckdb查询，利用`read_csv_auto`函数读取服务器上的任意文件，或者执行其他命令。漏洞利用需要满足几个条件：首先，必须启用SQL Expressions这个实验性功能。其次，服务器上需要安装duckdb二进制文件，并且Grafana进程能够访问到该文件(位于PATH)。最后，攻击者需要具有Viewer或更高权限。提供的POC代码通过向`/api/ds/query`端点发送POST请求，指定`ds_type`为`__expr__`，并构造包含`SELECT * FROM read_csv_auto('/etc/passwd');`的JSON数据来尝试读取`/etc/passwd`文件。由于该漏洞允许执行任意SQL命令，所以存在一定的投毒风险，例如修改Grafana配置、添加恶意用户等。检查发现该POC代码本身并无明显投毒意图，但利用此漏洞完全可以植入后门代码,故判定存在10%的潜在投毒风险。

**项目地址:** [punitdarji/Grafana-CVE-2024-9264](https://github.com/punitdarji/Grafana-CVE-2024-9264)

**漏洞详情:** [CVE-2024-9264](https://nvd.nist.gov/vuln/detail/CVE-2024-9264)