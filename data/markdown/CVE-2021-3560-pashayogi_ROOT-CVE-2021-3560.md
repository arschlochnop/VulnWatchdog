## CVE-2021-3560-Polkit-本地提权

**漏洞编号:** CVE-2021-3560

**漏洞类型:** 本地提权

**影响应用:** Polkit

**危害等级:** 高危，允许本地普通用户提升权限至root

**影响版本:** polkit 0.105-26, polkit 0.117-2 和 polkit 0.119

**利用条件:** 本地用户需要SSH登录，而不是直接在桌面终端运行

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-3560 漏洞存在于 Polkit 中，允许本地未经授权的攻击者通过绕过 D-Bus 请求的凭据检查来提升权限至 root 用户。

**有效性分析：**
根据漏洞库信息和搜索结果，此漏洞是真实存在的，并且有公开的PoC。
根据提供的PoC代码，该脚本尝试创建一个新用户，并设置密码。利用了Polkit在处理D-Bus请求时的漏洞，通过竞争条件来修改`/etc/shadow`文件，从而为新用户设置密码，并将其加入管理员组。

**投毒风险分析：**
查看 root.sh 脚本，该脚本主要功能是创建用户并修改 /etc/shadow 文件，逻辑较为清晰。
*   **用户创建:** 脚本首先检测是否存在目标用户，如果不存在则通过 `dbus-send` 创建用户。这里使用了竞争条件，通过并发的 `dbus-send` 请求和 `kill` 命令，试图绕过 Polkit 的权限验证。
*   **密码设置:** 脚本获取 `/etc/shadow` 文件的修改时间戳，然后循环尝试使用 `dbus-send` 修改用户的密码，同样利用了竞争条件。
*   **依赖:** 脚本依赖 `dbus-send`，`systemctl`, `stat`, `id`, `grep`, `cut`, `bc`, `sleep` 等常见的系统命令。
脚本中没有发现任何明显的恶意代码，例如反弹 shell，删除文件，或植入后门等操作。没有发现任何可以被判定为投毒的代码。
因此，投毒风险评估为 0%。

**利用方式：**
1.  **漏洞触发：**利用 Polkit 在处理 D-Bus 请求时的缺陷，绕过权限验证。
2.  **用户创建：**使用 `dbus-send` 命令尝试创建一个具有管理员权限的新用户。
3.  **密码设置：**通过竞争条件修改 `/etc/shadow` 文件，为新创建的用户设置密码。
4.  **权限提升：** 使用新创建的用户登录，并通过 `sudo su` 命令获得 root 权限。

**总结：** 提供的 PoC 代码是有效的，并且经过分析，没有发现明显的投毒风险。该漏洞允许本地普通用户提升权限至 root。

**项目地址:** [pashayogi/ROOT-CVE-2021-3560](https://github.com/pashayogi/ROOT-CVE-2021-3560)

**漏洞详情:** [CVE-2021-3560](https://nvd.nist.gov/vuln/detail/CVE-2021-3560)