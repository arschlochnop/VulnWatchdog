## CVE-2021-23017-Nginx Resolver 内存覆盖

**漏洞编号:** CVE-2021-23017

**漏洞类型:** 内存覆盖

**影响应用:** Nginx

**危害等级:** 高危，可能导致worker进程崩溃或潜在的其他影响

**影响版本:** Nginx Web Server versions 0.6.18 thru 1.20.0 before 1.20.1, Nginx plus versions R13 thru R23 before R23 P1. Nginx plus version R24 before R24 P1

**利用条件:** 需要能够伪造来自DNS服务器的UDP数据包

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-23017是Nginx resolver中的一个安全问题，允许攻击者通过伪造来自DNS服务器的UDP数据包，导致1字节的内存覆盖。这可能导致worker进程崩溃或其他潜在的影响。

**有效性：** 根据漏洞信息和搜索引擎结果，POC代码针对CVE-2021-23017是有效的。多个资源确认了该漏洞的存在和利用方式。

**利用方式：**

1.  **设置恶意DNS服务器：** 攻击者需要设置一个能够发送伪造DNS响应的恶意DNS服务器。`dnsmasq` 被用作搭建恶意 DNS 服务器。
2.  **发送恶意DNS响应：** 攻击者发送包含超长域名（超过Nginx resolver的预期长度）的恶意DNS响应。该响应会覆盖Nginx worker进程的内存。
3.  **触发DNS查询：** 攻击者使用`curl`或`dig`等工具触发目标Nginx服务器的DNS查询。Nginx服务器会向攻击者的恶意DNS服务器发送请求，并接收包含恶意payload的响应。
4.  **造成拒绝服务：** 成功的利用会导致Nginx worker进程崩溃，从而造成拒绝服务攻击。
5.  **绕过防火墙:** 攻击者使用并行进程，同时执行嗅探、DNS发送和查询触发，并通过高频率的数据包和查询绕过防火墙过滤器。

**投毒风险：**

虽然该漏洞利用代码主要目的是造成拒绝服务，但仍然存在一定的投毒风险。风险点分析如下：

*   **依赖安装：**  `README.md`文件中建议用户安装`dnsmasq`和`scapy`等依赖。虽然这些依赖本身是合法的，但如果攻击者篡改了安装源，可能会引入恶意软件包。
*   **自定义DNS服务器：**  攻击者诱导用户配置自己的DNS服务器，这本身就具有一定的风险，因为所有DNS查询都会经过攻击者的服务器，攻击者可以进行中间人攻击或收集敏感信息。
*   **Payload修改：** 攻击者在构造恶意payload时，可能会在超长域名中嵌入恶意代码，虽然1字节内存覆盖的利用方式限制了恶意代码的执行，但仍然不能排除攻击者利用其他方式扩大攻击面的可能性。

综合以上分析，虽然该PoC的主要目的是拒绝服务，但不能完全排除攻击者通过修改PoC代码或利用用户配置不当等方式进行投毒攻击的可能性。**因此，投毒风险评估为10%。** 风险主要集中在依赖项安装和目标系统的配置上，而不是PoC代码本身包含恶意后门。用户需要仔细检查和验证脚本以及相关配置，以降低潜在风险。

**项目地址:** [6lj/EVIL-CVE-2021-23017-Update-2025](https://github.com/6lj/EVIL-CVE-2021-23017-Update-2025)

**漏洞详情:** [CVE-2021-23017](https://nvd.nist.gov/vuln/detail/CVE-2021-23017)