## CVE-2018-11776 Apache Struts 远程代码执行

**漏洞编号:** CVE-2018-11776

**漏洞类型:** 远程代码执行

**影响应用:** Apache Struts

**危害等级:** 高危，可导致服务器被完全控制

**影响版本:** 2.3 to 2.3.34, 2.5 to 2.5.16

**利用条件:** alwaysSelectFullNamespace 为 true， 且存在特定配置的namespace或wildcard namespace

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2018-11776 是一个 Apache Struts 框架中的远程代码执行漏洞。根据漏洞库信息和搜索结果，该漏洞是由于 Struts 对 namespace 验证不足，导致 OGNL 表达式注入，从而允许未经身份验证的攻击者执行任意代码。如果 alwaysSelectFullNamespace 设置为 true，且结果没有 namespace，同时其上层 package 没有 namespace 或使用了 wildcard namespace，就可能触发此漏洞。漏洞利用代码中的 Dockerfile 演示了如何构建一个包含漏洞的 Struts 应用，并通过修改 struts.xml 文件来触发漏洞。具体做法是向 struts.xml 文件中添加一个 action，该 action 的结果类型为 chain，指向 date 命令。访问这个 action 将会执行 date 命令，证明了远程代码执行的可能性。

**有效性：** 提供的 Dockerfile 确实可以创建一个易受攻击的 Struts 2 环境，并且包含的 struts.xml 修改方式能够触发漏洞，因此，该 PoC 代码是有效的。

**投毒风险：** Dockerfile 的主要目的是构建一个包含漏洞的 Struts 2 应用程序，用于演示和测试 CVE-2018-11776 漏洞。它修改了 struts.xml 文件，添加了一个触发漏洞的 action。但除此之外，并没有明显的恶意代码或后门。README.md 只是提供了关于该镜像的信息，包括来源和作者。投毒风险较低，可能来自于作者的疏忽或者未来供应链攻击,例如依赖组件投毒。这里认为存在10%的风险，因为虽然表面上没有发现，但不排除存在一些隐蔽的或未来的风险。例如,如果Dockerfile的tomcat版本存在高危漏洞也会存在被利用的可能性.

**利用方式：** 漏洞的利用方式是通过构造恶意的 URL，该 URL 包含了 OGNL 表达式注入。攻击者可以通过访问这个特制的 URL，在服务器上执行任意代码。具体而言，需要满足以下条件：

1.  Struts 2 版本在 2.3.0 到 2.3.34 或 2.5.0 到 2.5.16 之间。
2.  `alwaysSelectFullNamespace` 设置为 true。
3.  应用配置中，存在没有 namespace 或者使用了 wildcard namespace 的 package。

满足这些条件后，攻击者可以通过访问类似 `http://example.com/${OGNL_EXPRESSION}` 的 URL 来执行任意命令。

**项目地址:** [cved-sources/cve-2018-11776](https://github.com/cved-sources/cve-2018-11776)

**漏洞详情:** [CVE-2018-11776](https://nvd.nist.gov/vuln/detail/CVE-2018-11776)