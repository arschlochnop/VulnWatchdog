## CVE-2022-0847 Dirty Pipe

**漏洞编号:** CVE-2022-0847

**漏洞类型:** 本地权限提升

**影响应用:** Linux Kernel

**危害等级:** 高危，可能导致本地权限提升至 root

**影响版本:** Linux Kernel 5.17 rc6 (受影响范围可能更广)

**利用条件:** 需要本地用户权限

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-0847 (Dirty Pipe) 是一个 Linux 内核中的本地权限提升漏洞。漏洞原因是由于在 copy_page_to_iter_pipe 和 push_pipe 函数中，新的 pipe buffer 结构的 “flags” 成员缺乏正确的初始化，可能包含陈旧的值。利用此漏洞，非特权本地用户可以写入由只读文件支持的页面缓存中的页面，从而提升他们在系统上的权限。

**有效性：** 根据搜索结果和漏洞库信息，该漏洞存在已知的有效利用代码（POC）。提供的 compile.sh 文件指示了存在 exploit-1.c 和 exploit-2.c 这两个可能的利用代码。因此，可以判断POC代码有效。

**投毒风险：** 提供的 `compile.sh` 文件只包含编译指令，没有发现任何可疑的或经过编码处理的字符串、函数或逻辑，因此直接投毒的可能性较低。但是，无法保证 `exploit-1.c` 和 `exploit-2.c` 的内容是否包含恶意代码。在没有具体分析 `exploit-1.c` 和 `exploit-2.c` 代码内容的情况下，根据已知信息，投毒风险为 0%。 需要进一步分析 exploit-1.c 和 exploit-2.c 源代码。

**利用方式：** 漏洞的利用方式大致如下：
1.  利用 `pipe()` 创建一个管道。
2.  打开一个只读文件。
3.  利用 `splice()` 将只读文件中的内容复制到管道中。
4.  通过特定的方式修改管道缓冲区中的 flags，使其指向只读文件的页面缓存。
5.  向管道写入数据，从而覆盖只读文件中的内容。
6.  通常攻击者会覆盖 SUID 可执行文件（例如 `passwd` 或 `su`），然后执行被覆盖的文件，从而获得 root 权限。

**项目地址:** [letsr00t/CVE-2022-0847](https://github.com/letsr00t/CVE-2022-0847)

**漏洞详情:** [CVE-2022-0847](https://nvd.nist.gov/vuln/detail/CVE-2022-0847)