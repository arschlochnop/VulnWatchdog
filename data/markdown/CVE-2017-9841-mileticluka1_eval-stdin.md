## CVE-2017-9841-PHPUnit-远程代码执行

**漏洞编号:** CVE-2017-9841

**漏洞类型:** 远程代码执行

**影响应用:** PHPUnit

**危害等级:** 高危，允许攻击者执行任意PHP代码

**影响版本:** PHPUnit < 4.8.28 和 PHPUnit 5.x < 5.6.3

**利用条件:** 目标服务器的/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php URI 必须可公开访问

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2017-9841 是 PHPUnit 中的一个远程代码执行漏洞。该漏洞存在于 `Util/PHP/eval-stdin.php` 文件中。攻击者可以通过向该文件发送以 `<?php` 开头的 HTTP POST 数据，从而执行任意PHP代码。根据搜索引擎结果，此漏洞在过去几年中被广泛利用，表明其有效性。提供的 Ruby 脚本 `evil-eval.rb` 旨在自动化利用此漏洞。它通过构造包含 PHP 代码的 HTTP POST 请求，并将其发送到易受攻击的 `eval-stdin.php` 终端节点来实现远程代码执行。脚本允许用户执行各种命令，如 `checkconnection`（验证连接）、`privesc`（运行 LinPeas 以进行权限提升）和 `revshell`（启动反向 shell）。

**关于投毒风险：**

仔细检查提供的 Ruby 脚本 `evil-eval.rb` 和 `README.md`，未发现明显的恶意代码或后门。该脚本的主要功能是利用已知的 CVE-2017-9841 漏洞，通过构造 HTTP 请求执行系统命令或启动反向 shell。脚本中的命令如`privesc`下载并执行外部脚本（LinPeas），但下载源是明确的GitHub仓库，如果LinPeas本身存在问题，那属于另一个层面的风险。`revshell`也需要用户提供IP地址和监听端口，是常规的反向shell利用方式。因此，当前仓库中没有发现作者隐藏的投毒代码。

**漏洞利用方式：**

1.  **确定目标：** 找到运行易受攻击的 PHPUnit 版本的 Web 服务器，并且 `/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php` URI 可公开访问。
2.  **构造 Payload：** 构造一个以 `<?php` 开头的 PHP 代码 Payload，该 Payload 包含要执行的恶意代码。
3.  **发送 HTTP POST 请求：** 将构造的 Payload 作为 HTTP POST 数据发送到 `/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php` URI。
4.  **执行代码：** 服务器上的 PHPUnit 将执行 Payload 中的 PHP 代码，从而允许攻击者远程控制服务器。
5.  **使用提供的脚本：** 运行 `evil-eval.rb` 脚本，按照提示输入目标 URL，并使用可用的命令执行各种操作，例如检查连接，尝试权限提升或启动反向 shell。

**项目地址:** [mileticluka1/eval-stdin](https://github.com/mileticluka1/eval-stdin)

**漏洞详情:** [CVE-2017-9841](https://nvd.nist.gov/vuln/detail/CVE-2017-9841)