## CVE-2019-5736-runc容器逃逸

**漏洞编号:** CVE-2019-5736

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可获取主机root权限

**影响版本:** <= 1.0-rc6 (Docker < 18.09.2)

**利用条件:** 需要能够在受影响的容器中以root身份执行命令，或者拥有对现有容器的写入权限并通过docker exec附加到该容器。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-5736 漏洞允许攻击者通过利用文件描述符处理不当的问题，覆盖宿主机的 runc 二进制文件，从而获得宿主机的 root 权限。攻击者可以在以下两种情况下利用此漏洞：

1.  **新的容器，攻击者控制镜像：** 攻击者可以创建一个包含恶意代码的容器镜像。
2.  **已存在的容器，攻击者拥有写入权限：** 攻击者可以修改容器内的文件，并在之后使用 `docker exec` 命令附加到该容器。

**利用方式：**

1.  **利用 /proc/self/exe:**  容器内的进程可以通过 `/proc/self/exe` 访问到 runc 的二进制文件。
2.  **文件描述符泄露：** runc 在创建容器时，会将自身的文件描述符传递给容器内的进程。
3.  **覆盖 runc 二进制文件：** 攻击者可以利用泄露的文件描述符，以写模式打开宿主机的 runc 二进制文件，并使用恶意代码覆盖它。
4.  **触发漏洞：** 当宿主机再次使用被篡改的 runc 二进制文件启动容器时，恶意代码将在宿主机上以 root 权限执行。

**POC代码分析：**

提供的POC代码首先会将`/bin/sh`替换为指向`/proc/self/exe`的解释器路径，这意味着每次调用 `/bin/sh` 都会执行当前的 `runc` 二进制文件。 然后，它会循环遍历 `/proc` 目录查找包含 `runc` 字符串的进程，确定目标 `runc` 进程的PID，并尝试获取该 `runc` 进程对应的宿主机上的 `runc` 二进制文件描述符。成功获取文件描述符后，它会用恶意payload覆盖该二进制文件。恶意payload是一个反弹shell脚本，它会将宿主机的shell反弹到攻击者的指定IP和端口。

**有效性评估：**

根据漏洞信息、搜索结果和提供的POC代码，该POC代码是有效的，能够利用 CVE-2019-5736 漏洞实现容器逃逸。

**投毒风险评估：**

提供的代码的核心功能是利用漏洞进行容器逃逸，没有发现恶意或隐藏的、与漏洞利用无关的代码。虽然该payload本身用于建立反向shell可用于恶意目的，但这是漏洞利用的预期行为，不属于投毒。因此，投毒风险为 0%。

**项目地址:** [h3x0v3rl0rd/CVE-2019-5736](https://github.com/h3x0v3rl0rd/CVE-2019-5736)

**漏洞详情:** [CVE-2019-5736](https://nvd.nist.gov/vuln/detail/CVE-2019-5736)