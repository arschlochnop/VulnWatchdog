## CVE-2025-22224-VMware-TOCTOU竞态条件导致权限提升

**漏洞编号:** CVE-2025-22224

**漏洞类型:** TOCTOU竞态条件

**影响应用:** VMware ESXi, VMware Workstation

**危害等级:** 高危，可能导致客户机逃逸和主机权限提升

**影响版本:** ESXi 8.0 < ESXi80U3d-24585383, ESXi 8.0 < ESXi80U2d-24585300, ESXi 7.0 < ESXi70U3s-24585291, Workstation 17.x < 17.6.3

**利用条件:** 需要在虚拟机内具备本地管理权限

**POC 可用性:** 是

**投毒风险:** 20%

## 详情

CVE-2025-22224 是 VMware ESXi 和 Workstation 中的一个 TOCTOU (Time-of-Check Time-of-Use) 竞态条件漏洞，会导致越界写入。具有虚拟机本地管理权限的恶意攻击者可以利用此问题以主机上运行的虚拟机的 VMX 进程的身份执行代码。

**有效性:**
根据漏洞描述和搜索结果，该漏洞利用PoC是存在的，并且已经被CISA添加到已知被利用的漏洞列表中，因此该漏洞利用的有效性较高。

**投毒风险分析:**
PoC 代码通过 TinyURL 提供下载链接。这本身就带来了一定的风险，因为无法直接审查代码。此外，PoC利用竞态条件，这使得漏洞利用本身具有一定的不稳定性，也为潜在的投毒代码提供了隐藏空间。虽然PoC描述中没有明确的恶意行为，但考虑到攻击者控制主机执行代码的能力，不排除存在潜在的后门或恶意代码的可能性，PoC链接被投毒的可能性估计为20%。

**利用方式:**
1.  攻击者需要在受影响的 VMware ESXi 或 Workstation 版本的虚拟机内获得本地管理权限。
2.  攻击者在虚拟机内运行 PoC 漏洞利用程序。
3.  PoC 程序利用 VMX 进程中的 TOCTOU 漏洞，通过竞态条件竞争来修改内存区域或文件描述符，从而导致越界写入。
4.  攻击者利用越界写入，在主机上运行的 VMX 进程中覆盖敏感数据，从而获得在主机上执行任意代码的权限。
5.  成功利用漏洞后，攻击者可以在主机上以 root 权限执行任意命令，从而完全控制主机。

**项目地址:** [takerishunte/CVE-2025-22224](https://github.com/takerishunte/CVE-2025-22224)

**漏洞详情:** [CVE-2025-22224](https://nvd.nist.gov/vuln/detail/CVE-2025-22224)