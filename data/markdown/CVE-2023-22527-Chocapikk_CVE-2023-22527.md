## CVE-2023-22527 - Atlassian Confluence 远程代码执行

**漏洞编号:** CVE-2023-22527

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Atlassian Confluence Server and Data Center

**危害等级:** 高危，允许未授权的攻击者执行任意代码。

**影响版本:** 8.0.0 <= version < 8.5.4

**利用条件:** Confluence 实例需要运行在受影响的版本，并且攻击者能够通过网络访问到该实例。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-22527 是 Atlassian Confluence Server 和 Data Center 中的一个模板注入漏洞。未经身份验证的攻击者可以利用此漏洞在受影响的实例上实现远程代码执行。

**有效性：**
提供的 POC 代码看起来是有效的。它包含一个 Python 脚本 (exploit.py)，该脚本通过构造特定的 HTTP POST 请求利用模板注入漏洞。脚本中使用了 OGNL 表达式注入，并通过修改 HTTP 响应头 `X-Cmd-Response` 来获取命令执行的结果。

**投毒风险：**
代码仓库中存在投毒的风险较低，约为 10%。`exploit.py` 文件本身实现了漏洞利用，并没有明显的后门或者恶意代码。`docker-compose.yml` 文件用于快速搭建存在漏洞的环境，方便测试和验证。`README.md` 文件提供使用说明和免责声明。但是不排除作者在未来更新版本中加入投毒代码，使用时需要谨慎。

**利用方式：**
1.  攻击者发送特制的 HTTP POST 请求到 `/template/aui/text-inline.vm` 端点。
2.  在 POST 请求的数据中，攻击者使用 OGNL 表达式注入，执行任意命令。OGNL 表达式中使用了 `freemarker.template.utility.Execute` 类来执行系统命令。
3.  服务器执行攻击者注入的命令，并将命令执行的结果设置在 HTTP 响应头 `X-Cmd-Response` 中返回。
4.  攻击者从 HTTP 响应头中获取命令执行结果。

**项目地址:** [Chocapikk/CVE-2023-22527](https://github.com/Chocapikk/CVE-2023-22527)

**漏洞详情:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)