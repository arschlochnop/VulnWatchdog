## CVE-2017-5941-node-serialize-反序列化漏洞

**漏洞编号:** CVE-2017-5941

**漏洞类型:** 反序列化漏洞

**影响应用:** node-serialize

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 0.0.4

**利用条件:** 应用程序使用 node-serialize 并且允许用户控制反序列化的数据

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2017-5941 是 node-serialize 包 0.0.4 版本中的一个反序列化漏洞。攻击者可以通过将包含恶意 JavaScript 对象（特别是立即调用函数表达式 IIFE）的不可信数据传递给 `unserialize()` 函数来利用此漏洞，从而实现远程代码执行。

**有效性：**
提供的 POC 代码是有效的，它演示了如何利用此漏洞。
`index.js` 文件中的代码展示了如何使用 `node-serialize` 包反序列化 cookie 中的数据。如果 cookie 内容包含恶意 IIFE，则会导致代码执行。

**投毒风险：**
代码仓库中投毒的可能性较低，约为1%。主要原因是:
1.  `README.md`文件描述了漏洞利用和缓解方法，没有发现恶意代码。
2.  `index.js` 文件是漏洞利用的示例，目的是展示如何触发漏洞。
3. `package-lock.json` 文件锁定了依赖版本，防止安装恶意依赖，但也不能完全排除通过依赖包进行投毒的可能性，不过这个概率非常低。

虽然代码本身没有明显的投毒行为，但使用者需要注意依赖包的安全性，以避免受到供应链攻击。

**利用方式：**
1.  目标应用程序必须使用易受攻击的 `node-serialize` 包的版本 0.0.4。
2.  攻击者需要找到应用程序使用 `unserialize()` 函数反序列化用户可控数据的地方，例如 cookie、POST 参数等。
3.  攻击者构造包含恶意 IIFE 的序列化 JavaScript 对象。例如: `{"rce":"_$$ND_FUNC$$_function(){ require('child_process').exec('指令', function(error, stdout, stderr) { console.log(stdout) });}()"}`
4.  将此恶意对象进行 base64 编码，并将其作为 cookie 或其他可控数据发送到目标应用程序。
5.  当应用程序使用 `unserialize()` 反序列化此数据时，IIFE 将被执行，从而导致远程代码执行。

**项目地址:** [turnernator1/Node.js-CVE-2017-5941](https://github.com/turnernator1/Node.js-CVE-2017-5941)

**漏洞详情:** [CVE-2017-5941](https://nvd.nist.gov/vuln/detail/CVE-2017-5941)