## CVE-2024-4577 PHP-CGI 参数注入导致远程代码执行

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** PHP

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8 (Windows)

**利用条件:** Windows服务器, PHP以CGI模式运行，且系统使用某些启用了"Best Fit"策略的代码页。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-4577 是一个存在于 Windows 系统上 PHP-CGI 模式下的参数注入漏洞。当系统启用了某些使用“Best Fit”策略的代码页时，Windows 可能会使用该策略替换传递给 Win32 API 函数的命令行中的字符。PHP CGI 模块可能会将这些字符错误地解释为 PHP 选项，从而允许恶意用户将选项传递给正在运行的 PHP 二进制文件，从而泄露脚本源代码或在服务器上执行任意 PHP 代码。

**利用方式：**
攻击者通过构造特殊的 URL，包含经过 "Best Fit" 转换后会被 PHP 解释器解析为选项的字符，从而注入恶意参数。PoC 代码利用 `-d allow_url_include=1 -d auto_prepend_file=php://input` 选项，允许包含远程文件，并直接将包含恶意代码的请求体作为 PHP 代码执行，实现远程代码执行。

**有效性：**
根据漏洞信息，搜索结果和提供的漏洞利用代码，该POC代码有效。已经有实际的攻击案例发生。

**投毒风险：**
查看PoC代码，主要功能是发送包含特定参数的POST请求，以利用漏洞实现RCE。初步分析PoC代码没有明显的恶意行为，但是由于代码可以执行任意命令,存在一定风险. 投毒风险评估为5%。
  * 依赖的requests模块本身可能有潜在风险
  * 虽然代码中没有直接的恶意逻辑，但攻击者可能会修改PoC，添加反弹shell、下载恶意文件等功能。

**项目地址:** [Gill-Singh-A/CVE-2024-4577-Exploit](https://github.com/Gill-Singh-A/CVE-2024-4577-Exploit)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)