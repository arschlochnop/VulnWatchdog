## CVE-2024-32002-Git远程代码执行

**漏洞编号:** CVE-2024-32002

**漏洞类型:** 远程代码执行

**影响应用:** Git

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 受影响版本：2.45.0, 2.44.0, >= 2.43.0 < 2.43.4, >= 2.42.0 < 2.42.2, 2.41.0, >= 2.40.0 < 2.40.2, < 2.39.4

**利用条件:** 需要目标系统安装Git，并且clone包含恶意submodule的仓库，利用依赖于对大小写不敏感的文件系统，并启用符号链接。

**POC 可用性:** 是

**投毒风险:** 20%

## 详情

CVE-2024-32002是Git中存在的一个远程代码执行漏洞，它允许攻击者通过精心构造包含恶意submodule的Git仓库，诱导受害者clone该仓库，从而在受害者机器上执行恶意代码。

**漏洞利用方式：**
1.  攻击者创建一个包含submodule的恶意Git仓库。
2.  该submodule包含一个恶意的`.git/hooks/post-checkout` hook。
3.  利用了Git在处理submodule时，可能将文件写入`.git/`目录而不是submodule的工作目录的缺陷。
4.  当受害者在对大小写不敏感的文件系统上，且启用符号链接的情况下，clone这个仓库并检出（checkout）或者更新 submodule时，恶意hook会被执行，导致远程代码执行。

**有效性：**
提供的POC代码是有效的，因为它展示了如何创建一个包含恶意`post-checkout` hook的submodule，并在clone时触发该hook，从而执行任意命令。其中`/tmp/hacked`用于linux环境下的测试，powershell命令用于windows环境下的测试。

**投毒风险：**
虽然提供的POC代码本身是用于验证漏洞的，但如果攻击者在真实的恶意仓库中，除了POC代码之外还包含其他隐藏的恶意代码，则存在投毒风险。当前提供的POC代码中，`/tmp/e81041e852bc4e53c491bef3aef35e69/README.md` 文件和 `/tmp/e81041e852bc4e53c491bef3aef35e69/fast/hooks/post-checkout` 都可能被写入隐藏的恶意代码。假设作者有意隐藏投毒代码，可能性为20%。

**缓解措施：**
1.  升级Git到已修复的版本（>= 2.45.1, 2.44.1, 2.43.4, 2.42.2, 2.41.1, 2.40.2, 2.39.4）。
2.  避免clone来自不受信任来源的仓库。
3.  禁用Git的符号链接支持（`git config --global core.symlinks false`）。
4.  在clone仓库后，仔细检查submodule的内容，特别是`.git/hooks`目录下的文件。

**项目地址:** [Masamuneee/hook](https://github.com/Masamuneee/hook)

**漏洞详情:** [CVE-2024-32002](https://nvd.nist.gov/vuln/detail/CVE-2024-32002)