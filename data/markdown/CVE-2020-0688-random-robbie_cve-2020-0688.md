## CVE-2020-0688-Microsoft Exchange Server-远程代码执行

**漏洞编号:** CVE-2020-0688

**漏洞类型:** 远程代码执行

**影响应用:** Microsoft Exchange Server

**危害等级:** 高危，可能导致完全系统控制

**影响版本:** Microsoft Exchange Server 2010 SP3 UR30, 2013 CU23, 2016 CU14/CU15, 2019 CU3/CU4

**利用条件:** 需要有效的Exchange用户凭证，能够访问ECP (Exchange Control Panel)。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-0688是一个Microsoft Exchange服务器的远程代码执行漏洞，源于服务器在安装时未能正确创建唯一的密钥。攻击者可以利用该漏洞通过Exchange Control Panel (ECP)组件发送特制的payload执行任意代码。利用过程包括：

1.  **获取必要信息：** 首先，需要一个有效的Exchange用户账户（邮箱地址和密码），用于登录OWA（Outlook Web App）。登录后，需要从响应中提取`__VIEWSTATEGENERATOR`参数和`ASP.NET_SessionId` cookie。
2.  **生成ViewState Payload：** 使用`ysoserial.net`工具，基于`TextFormattingRunProperties` gadget生成恶意的ViewState payload。需要指定`--validationalg`为`SHA1`，`--validationkey`为静态的`CB2721ABDAF8E9DC516D621D8B8BF13A2C9E8689A25303BF`（这是此漏洞的核心：硬编码的密钥），`--generator`为从页面源码中获取的`__VIEWSTATEGENERATOR`值，`--viewstateuserkey`为从cookie中提取的`ASP.NET_SessionId`值。command 为需要执行的命令。
3.  **发送恶意请求：** 将生成的ViewState payload附加到对ECP的请求中，通过`__VIEWSTATE`参数传递。 URL示例: `https://localhost/ecp/default.aspx?__VIEWSTATEGENERATOR=<generator>&__VIEWSTATE=<ViewState>`。

提供的`exploit.py`脚本尝试自动化这个过程，但注释表明它**尚未经过测试，需要进一步完善**。特别是 ViewState 值的生成需要在外部完成，脚本只负责登录和参数提取。

**关于投毒风险：**

`exploit.py`脚本本身相对简单，主要功能是登录OWA并提取必要的参数。潜在的风险可能存在于以下几点：
*   作者提供的`ysoserial.net`下载链接，如果链接被替换为恶意的`ysoserial.net`版本，可能包含恶意代码，但在Github上的相关链接通常是安全的，不过需要谨慎。
*   在`exploit.py`中，如果作者有意在后续完善中添加恶意代码，例如，在生成payload时执行某些恶意操作，则存在潜在风险。
*   `README.md`中要求下载`YSO`， 如果被替换为恶意链接,会存在投毒风险。

考虑到脚本的简单性以及需要外部工具生成payload，直接的投毒风险较低，综合评估为10%。主要风险在于使用者下载的外部工具可能被篡改。

**有效性分析：**
根据漏洞描述和搜索结果，此漏洞利用的关键在于使用了硬编码的`validationkey`。如果目标Exchange服务器未打补丁，且使用了受影响的版本，利用成功的可能性较高。提供的POC代码需要手动生成ViewState payload，脚本只是辅助提取参数，因此代码的有效性取决于payload的生成是否正确以及目标服务器是否符合漏洞利用的条件。


**项目地址:** [random-robbie/cve-2020-0688](https://github.com/random-robbie/cve-2020-0688)

**漏洞详情:** [CVE-2020-0688](https://nvd.nist.gov/vuln/detail/CVE-2020-0688)