## CVE-2021-40964 - Tiny File Manager 路径遍历导致远程代码执行

**漏洞编号:** CVE-2021-40964

**漏洞类型:** 路径遍历/远程代码执行

**影响应用:** Tiny File Manager

**危害等级:** 高危，可能导致服务器文件泄露和远程代码执行

**影响版本:** <= 2.4.6

**利用条件:** 需要管理员权限或存在CSRF漏洞

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于Tiny File Manager 2.4.6及更早版本中。攻击者可以通过上传文件时，在`fullpath`参数中包含路径遍历字符串（如`../`和`..\`）来绕过服务器的工作目录限制，将恶意文件写入计算机上的任何目录。该POC脚本利用此漏洞，首先尝试使用提供的用户名和密码进行身份验证。如果身份验证成功，它会尝试泄漏Web根目录。然后，它创建一个包含PHP代码的shell文件，并使用路径遍历漏洞将其上传到Web根目录下的uploads文件夹中。最后，它尝试访问上传的shell文件，如果访问成功，则攻击者可以执行任意命令。 

**有效性：** 根据漏洞描述和提供的漏洞利用代码，该POC代码**有效**。漏洞库信息、搜索引擎结果和POC代码相互印证，确认了该漏洞的存在和利用方式。

**投毒风险：** 漏洞利用代码本身的功能是利用路径遍历漏洞上传webshell并执行命令，从代码逻辑和功能来看，不存在明显的投毒代码。
README.md文件仅仅是对漏洞利用的描述，不存在投毒代码。
但是，脚本中的URL获取部分，存在一定的风险，比如`uploadurl=http://vyvyuytcuytcuycuytuy/`以及WEBROOT的获取方式可能会导致一些意料之外的问题。另外脚本尝试自动获取webroot，如果失败会默认设置为`/var/www/html`，这可能导致攻击者在非预期位置写入文件，从而影响服务器稳定性。综合以上因素，**投毒风险为10%**，主要体现在利用过程中可能引入错误配置或攻击目标之外的副作用。

**利用方式：** 
1.  **身份验证：** 使用提供的管理员用户名和密码尝试登录Tiny File Manager。
2.  **Web根目录泄漏 (可选):** 利用文件上传功能尝试泄漏Web根目录路径。
3.  **Shell文件创建：** 创建一个包含PHP代码的shell文件，该文件允许执行任意命令。
4.  **文件上传：**  利用路径遍历漏洞，将shell文件上传到服务器的Web可访问目录中（通常是uploads目录）。
5.  **远程代码执行：**  通过访问上传的shell文件，并传递`cmd`参数来执行任意命令。

**项目地址:** [Z3R0-0x30/CVE-2021-40964](https://github.com/Z3R0-0x30/CVE-2021-40964)

**漏洞详情:** [CVE-2021-40964](https://nvd.nist.gov/vuln/detail/CVE-2021-40964)