## CVE-2023-46604-Apache ActiveMQ RCE

**漏洞编号:** CVE-2023-46604

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache ActiveMQ

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** 5.15.16之前, 5.16.7之前, 5.17.6之前, 5.18.3之前

**利用条件:** 需要网络访问 ActiveMQ Broker 或 Client

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2023-46604是Apache ActiveMQ中的一个远程代码执行漏洞。该漏洞源于Java OpenWire协议marshaller对不可信数据进行反序列化。攻击者可以通过操纵OpenWire协议中的序列化类类型，使broker或client实例化classpath上的任何类，从而执行任意shell命令。

**有效性分析：**
提供的POC代码`poc.xml` 使用 Spring Beans 的 `ProcessBuilder` 来执行命令。 它通过 `<bean>` 标签定义了一个 `ProcessBuilder` 实例，并使用 `init-method="start"` 指示 Spring 在 bean 初始化时启动该进程。 `constructor-arg` 包含了要执行的命令列表，示例中是打开计算器应用程序（MacOS）。因此，如果 ActiveMQ Broker 或者 Client 使用了受影响的版本，并且能够加载并解析该XML配置，这个POC能够成功触发RCE。

**投毒风险分析：**
查看提供的poc.xml文件，该文件旨在通过Spring Beans配置启动计算器程序。没有发现任何恶意或隐藏的代码。`/tmp/0bd050d52d14911a8492fc0b3a9ab6cc/README.md`只是描述了POC，也没有任何投毒代码。因此，可以认为此POC代码的投毒风险很低，为0%。

**利用方式：**
根据漏洞信息和POC代码，利用方式如下：

1.  攻击者需要能够通过网络访问运行Java OpenWire协议的 ActiveMQ broker 或 client。
2.  攻击者构造恶意的OpenWire消息，该消息包含对恶意Spring XML配置的引用或直接包含恶意的Spring XML配置。这个XML配置利用了`java.lang.ProcessBuilder`或其他可以执行命令的类。
3.  ActiveMQ broker 或 client 反序列化该消息，从而实例化并执行XML配置中指定的命令，导致远程代码执行。

**搜索引擎结果分析：**
根据搜索结果，CVE-2023-46604已经被广泛利用，并被用于传播恶意软件，例如 Kinsing 和勒索软件。这表明该漏洞具有很高的现实风险。

**项目地址:** [vjayant93/CVE-2023-46604-POC](https://github.com/vjayant93/CVE-2023-46604-POC)

**漏洞详情:** [CVE-2023-46604](https://nvd.nist.gov/vuln/detail/CVE-2023-46604)