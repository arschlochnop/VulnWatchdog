## CVE-2018-6574 - Go "go get" 远程命令执行

**漏洞编号:** CVE-2018-6574

**漏洞类型:** 远程命令执行

**影响应用:** Go

**危害等级:** 高危，可能导致系统完全控制

**影响版本:** < 1.8.7, 1.9.x < 1.9.4, 1.10 pre-releases < 1.10rc2

**利用条件:** 用户使用受影响的 Go 版本执行 `go get` 命令从恶意仓库获取代码。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2018-6574 漏洞允许攻击者利用 `go get` 命令在构建源代码时执行任意命令。该漏洞源于 Go 在处理 gcc 或 clang 插件选项时，未正确阻止 `-fplugin=` 和 `-plugin=` 参数。攻击者可以通过创建一个包含恶意代码的 Go 包，并在该包中利用 CGO 特性，将恶意的编译器选项注入到构建过程中。当用户使用受影响的 Go 版本执行 `go get` 命令来获取并构建该恶意包时，恶意代码将被执行。

**有效性分析：**
提供的 PoC 代码看起来是有效的。`main.go` 文件使用了 CGO 指令 `#cgo CFLAGS: -fplugin=./attack.so`，这正是漏洞利用的关键。这个指令告诉 Go 编译器在构建过程中加载 `attack.so` 插件。`attack.c` 文件定义了一个 `exploit` 函数，该函数使用 `__attribute__((constructor))` 属性，确保在动态链接库加载时自动执行。因此，当 `go get` 命令构建包含 `main.go` 的包时，`attack.so` 会被加载，`exploit` 函数会被执行，从而实现任意命令执行。

**投毒风险分析：**
经过对提供的代码进行分析，没有发现明显的投毒代码。`aaa.c`、`attack.c` 和 `exploit.c` 都包含执行 `/usr/local/bin/score 4a0b3a0c-6593-4414-86ca-c78649e04c0f` 命令的代码或者执行`sleep 20`的代码。这些代码是PoC本身的一部分，旨在验证漏洞。`README.md`是对漏洞的描述说明，`main.go`是触发漏洞的主代码, 所以仓库中作者隐藏的投毒代码可能性为0%。

**利用方式总结：**
1.  **创建恶意 Go 包：** 攻击者创建一个包含 `main.go` 文件的 Go 包，并在 `main.go` 文件中使用 CGO 指令 `#cgo CFLAGS: -fplugin=./attack.so`，指向包含恶意代码的动态链接库。
2.  **创建恶意动态链接库：** 攻击者创建一个动态链接库（例如 `attack.so`），该库包含在加载时自动执行的恶意代码。
3.  **托管恶意包：** 攻击者将恶意 Go 包托管在一个可以通过 `go get` 命令访问的仓库中（例如 GitHub）。
4.  **诱导用户执行 `go get`：** 攻击者诱导用户使用受影响的 Go 版本执行 `go get <malicious_package_url>` 命令来获取并构建恶意包。
5.  **执行恶意代码：** 当用户执行 `go get` 命令时，Go 编译器会加载恶意动态链接库，并执行其中的恶意代码，从而实现远程命令执行。

**项目地址:** [seoqqq/CVE-2018-6574](https://github.com/seoqqq/CVE-2018-6574)

**漏洞详情:** [CVE-2018-6574](https://nvd.nist.gov/vuln/detail/CVE-2018-6574)