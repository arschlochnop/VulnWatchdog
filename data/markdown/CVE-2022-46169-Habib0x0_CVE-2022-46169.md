## CVE-2022-46169 - Cacti 未授权命令注入

**漏洞编号:** CVE-2022-46169

**漏洞类型:** 命令注入

**影响应用:** Cacti

**危害等级:** 高危，未经身份验证的远程代码执行

**影响版本:** < 1.2.23

**利用条件:** 需要目标Cacti实例存在满足条件的 poller_item (POLLER_ACTION_SCRIPT_PHP 类型), 且攻击者能够访问 remote_agent.php 页面。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-46169 是 Cacti 1.2.23 之前版本中存在的一个未经身份验证的命令注入漏洞。漏洞位于 `remote_agent.php` 文件中，攻击者可以通过构造特定的 HTTP 请求，绕过身份验证，并利用 `poller_id` 参数进行命令注入。 

**利用方式：**

1.  **身份验证绕过：** 攻击者通过设置 `X-Forwarded-For` 等 HTTP Header，伪造客户端IP，绕过 `remote_agent.php` 的身份验证。
2.  **参数污染:** 攻击者利用`poller_id`，`host_id`，`local_data_ids[]`参数进行参数污染。
3.  **命令注入：** 成功绕过身份验证后，攻击者可以利用 `polldata` action，将恶意命令注入到 `poller_id` 参数中，从而执行任意系统命令。

**POC 分析：**

提供的 Ruby POC 代码首先尝试绕过身份验证，然后爆破`host_id`和`local_data_ids[]`，以找到有效的 `poller_item`，最后构造包含恶意命令的 URL，并发送 HTTP 请求触发命令注入。

**投毒风险分析：**

该 POC 代码主要功能是利用漏洞进行攻击。投毒风险较低，但仍然存在一定的潜在风险。
*   **依赖项风险：** POC 代码依赖于 `net/http`、`uri`、`json`、`optparse`、`artii` 和 `colorize` 等 Ruby 库。虽然这些库本身不太可能包含恶意代码，但始终存在依赖项被污染的风险。
*   **恶意命令注入：** 虽然 POC 中显示的命令是发起反向 Shell，但攻击者可以修改 POC 代码，注入其他恶意命令，例如删除文件、篡改数据等。因此，在使用 POC 时，务必仔细审查代码，确保不会执行未授权的操作。

综上，该 POC 的投毒风险相对较低，但仍需谨慎使用，并对代码进行充分审查。

**项目地址:** [Habib0x0/CVE-2022-46169](https://github.com/Habib0x0/CVE-2022-46169)

**漏洞详情:** [CVE-2022-46169](https://nvd.nist.gov/vuln/detail/CVE-2022-46169)