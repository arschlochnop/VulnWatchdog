## CVE-2020-11984-Apache HTTP Server-mod_proxy_uwsgi 缓冲区溢出

**漏洞编号:** CVE-2020-11984

**漏洞类型:** 缓冲区溢出

**影响应用:** Apache HTTP Server

**危害等级:** 高危，可能导致信息泄露和远程代码执行

**影响版本:** 2.4.32 to 2.4.44

**利用条件:** 需要启用mod_proxy_uwsgi模块

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2020-11984 是 Apache HTTP Server 2.4.32 到 2.4.44 版本中 mod_proxy_uwsgi 模块存在的一个缓冲区溢出漏洞。当 Apache 作为 uWSGI 服务器的反向代理时，如果 HTTP 头部字段的大小超过 16K，`mod_proxy_uwsgi` 模块在处理请求头时，由于没有充分的边界检查，可能导致缓冲区溢出，从而造成信息泄露甚至远程代码执行。

**漏洞利用方式分析：**

1.  **环境搭建：** 提供的 Dockerfile 文件用于构建存在漏洞的 Apache HTTP Server 环境。它首先基于 Debian bullseye-slim 镜像，安装必要的编译工具和依赖库。然后，下载 Apache HTTP Server 2.4.32、APR 和 APR-Util 的源代码，并编译安装 Apache。
2.  **模块配置：** Dockerfile 配置了 `mod_proxy_uwsgi` 模块，允许 Apache 作为 uWSGI 服务器的反向代理。通过 `ProxyPass` 指令将请求转发到后端的 uWSGI 服务器。
3.  **触发漏洞：** 漏洞利用的关键在于发送包含大量 HTTP 头部字段的恶意请求。攻击者可以通过构造一个长度超过 16K 的 HTTP 头部，例如 `LimitRequestFieldSize 1048576`, 触发缓冲区溢出。
4.  **代码执行 (可能)：** 成功触发缓冲区溢出后，攻击者可以通过控制溢出内容，覆盖内存中的关键数据，例如函数返回地址，最终实现远程代码执行。 这取决于服务器的配置和内存布局等因素。

**投毒风险分析：**

提供的 Dockerfile 主要用于构建和配置 Apache HTTP Server 环境，`supervisord.conf`用于管理进程，`upstream.py` 是一个简单的 uWSGI 应用。代码中，投毒风险较低，主要考量点如下：

*   **Dockerfile：** Dockerfile 从官方 Apache 镜像源下载源代码，降低了被篡改的风险。虽然构建过程中存在一定风险，但是下载的源是apache官方源，被投毒的可能性较低. 
*   **supervisord.conf：** 该文件用于配置 Supervisor，用于管理 Apache 和 uWSGI 进程。内容较为标准，未发现恶意配置。
*   **upstream.py：** 这是一个简单的 Python uWSGI 应用，用于处理反向代理的请求。代码非常简单，主要功能是返回 'Hello from uWSGI!' 字符串。因此，投毒的可能性很小。
*   **其他配置：** Dockerfile 中对 Apache 配置文件 `httpd.conf` 的修改，例如设置 `User apache` 和 `Group apache`，以及启用 `mod_proxy_uwsgi` 模块，都是正常的配置操作，不涉及恶意代码。

因此，该仓库中存在作者隐藏的投毒代码的风险较低，评估为 **5%**。主要风险可能存在于下载的 Apache 源代码被替换成恶意版本，但这种情况发生的概率较低。

**项目地址:** [masahiro331/CVE-2020-11984](https://github.com/masahiro331/CVE-2020-11984)

**漏洞详情:** [CVE-2020-11984](https://nvd.nist.gov/vuln/detail/CVE-2020-11984)