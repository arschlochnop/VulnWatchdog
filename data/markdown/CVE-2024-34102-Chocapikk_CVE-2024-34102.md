## CVE-2024-34102-Adobe Commerce-XXE漏洞

**漏洞编号:** CVE-2024-34102

**漏洞类型:** XML外部实体注入 (XXE)

**影响应用:** Adobe Commerce (Magento)

**危害等级:** 高危，可能导致任意代码执行、敏感信息泄露

**影响版本:** <= 2.4.4-p8, 2.4.5-p7, 2.4.6-p5, 2.4.7

**利用条件:** 无需用户交互，网络可达即可

**POC 可用性:** 是

**投毒风险:** 20%

## 详情

该漏洞存在于Adobe Commerce的XML解析模块中，允许未经身份验证的攻击者通过发送精心构造的XML文档，引用外部实体，从而读取服务器上的任意文件，甚至可能执行任意代码。从搜索引擎结果和漏洞描述来看，这是一个严重的安全问题，利用代码的存在进一步证实了其风险。攻击者利用该漏洞获取敏感信息，如数据库配置、加密密钥等，从而完全控制系统。

**有效性：**
提供的POC代码看起来是有效的，因为它包含了利用XXE漏洞所需的关键步骤：

1.  **生成Callback URL：** 利用fars.ee在线服务托管包含恶意XML实体的DTD文件，指向攻击者的服务器。
2.  **获取Instance ID：** 从SSRF API获取一个实例ID，用于后续的攻击。
3.  **发送恶意请求：** 构造包含恶意DTD URL的请求，发送到目标URL。
4.  **检查Exploitation Success：** 检查实例日志，解码并显示提取的数据。

根据漏洞描述，无需用户交互即可利用该漏洞，进一步增加了其威胁性。

**投毒风险：**
此POC代码的投毒风险评估为20%。风险点在于：

1.  **依赖外部服务 (fars.ee, cvssadvisor.com)：**  POC依赖 `fars.ee` 托管 DTD 文件和 `cvssadvisor.com` 的SSRF API。 这些服务如果被恶意控制或停止服务，可能导致POC失效或被利用进行中间人攻击。
2.  **base64编码php://filter流：** POC使用base64编码可能绕过部分WAF检测，但如果攻击者更改`dtd_data`为反弹shell的代码，并且服务器端没有进行严格的输入验证,可能存在隐患。
3. **SSRF API使用风险:**  SSRF API可能会记录和分析攻击流量，存在被溯源的风险。

总体来说，代码主要利用了已知的XXE漏洞，并没有发现明显的后门或者恶意代码。 但使用过程中依赖外部服务存在一定的风险。

**利用方式：**

1.  攻击者首先需要找到存在XXE漏洞的Adobe Commerce实例。
2.  使用POC脚本，指定目标URL和要读取的文件（默认为`/etc/passwd`）。
3.  脚本会自动生成包含恶意XML实体的DTD文件，并将其托管在fars.ee上。
4.  脚本会发送包含恶意DTD URL的请求到目标服务器。
5.  目标服务器解析XML时，会尝试从fars.ee加载DTD文件，触发XXE漏洞，读取指定文件内容，并通过回调URL将内容发送到攻击者的服务器。
6.  攻击者可以从回调URL的日志中获取读取到的文件内容。

**项目地址:** [Chocapikk/CVE-2024-34102](https://github.com/Chocapikk/CVE-2024-34102)

**漏洞详情:** [CVE-2024-34102](https://nvd.nist.gov/vuln/detail/CVE-2024-34102)