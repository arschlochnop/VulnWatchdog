## CVE-2022-26134-Confluence-OGNL注入

**漏洞编号:** CVE-2022-26134

**漏洞类型:** OGNL注入

**影响应用:** Atlassian Confluence Server 和 Data Center

**危害等级:** 高危，允许未经身份验证的攻击者执行任意代码

**影响版本:** 1.3.0 < version < 7.4.17, 7.13.0 <= version < 7.13.7, 7.14.0 <= version < 7.14.3, 7.15.0 <= version < 7.15.2, 7.16.0 <= version < 7.16.4, 7.17.0 <= version < 7.17.4, 7.18.0 <= version < 7.18.1

**利用条件:** 目标Confluence实例需要存在于受影响的版本范围内，且攻击者能够发起网络请求。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-26134 是一个存在于 Atlassian Confluence Server 和 Data Center 的 OGNL 注入漏洞。未经身份验证的攻击者可以通过构造特定的 HTTP 请求，向存在漏洞的 Confluence 实例注入恶意的 OGNL 表达式，从而执行任意代码。 

**有效性评估：**
根据漏洞库信息和搜索引擎结果，此漏洞已被广泛确认，并且存在公开的PoC利用代码。搜索结果显示存在活跃的漏洞利用案例，表明该漏洞的有效性很高。

**投毒风险分析：**
提供的PoC代码 (CVE-2022-26134.py) 主要功能是发送包含恶意 OGNL 表达式的 HTTP 请求，并根据返回头中的特定字段（X-Qualys-Response）判断漏洞是否成功利用。代码本身包含以下功能：

*   **漏洞利用：**  通过构造包含 OGNL 表达式的 URL，向目标 Confluence 服务器发送请求。
*   **结果判断：**  检查响应头中是否存在 `X-Qualys-Response` 字段，以确定命令是否执行成功。
*   **批量处理：**  支持从文件中读取多个目标 URL 进行批量漏洞扫描。
*   **结果输出：**  将成功利用漏洞的 URL 输出到 Excel 文件中。

对PoC代码进行了仔细分析，未发现明显的恶意代码，例如反向shell，downloader等。PoC主要用于验证漏洞是否存在和执行用户指定的命令。但是，任何允许远程代码执行的漏洞都存在被滥用的风险。攻击者可以修改该PoC以植入恶意软件或执行其他恶意行为。

**投毒风险：** 低，代码主要功能是验证漏洞，虽然存在被修改后进行恶意利用的可能性，但是代码本身不包含恶意功能。评估投毒风险为 5%。

**利用方式：**

1.  **构造恶意请求：**  攻击者需要构造包含 OGNL 表达式的 HTTP 请求。该表达式会被 Confluence 服务器解析并执行。
2.  **发送请求：**  将构造好的请求发送到目标 Confluence 服务器的特定 URL。
3.  **执行任意代码：**  如果目标服务器存在漏洞，且 OGNL 表达式构造正确，服务器会执行攻击者指定的代码。
4.  **获取结果：**  攻击者可以通过多种方式获取代码执行的结果，例如通过 DNS 查询、写入文件或通过 HTTP 响应头。

**POC利用分析：**
此POC通过在URL中插入特殊构造的OGNL表达式，利用Confluence服务器的漏洞执行命令。它通过修改HTTP响应头 `X-Qualys-Response` 来回显命令执行的结果，从而验证漏洞的存在。该脚本还支持批量扫描和将结果输出到Excel文件，这对于大规模漏洞评估和渗透测试非常有用。

**项目地址:** [yTxZx/CVE-2022-26134](https://github.com/yTxZx/CVE-2022-26134)

**漏洞详情:** [CVE-2022-26134](https://nvd.nist.gov/vuln/detail/CVE-2022-26134)