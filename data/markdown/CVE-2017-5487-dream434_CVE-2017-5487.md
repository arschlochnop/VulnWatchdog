## CVE-2017-5487-WordPress-REST API 用户枚举

**漏洞编号:** CVE-2017-5487

**漏洞类型:** 信息泄露/用户枚举

**影响应用:** WordPress

**危害等级:** 中危，可能泄露用户名，为后续攻击提供信息

**影响版本:** 4.7之前 (<= 4.7)

**利用条件:** WordPress REST API 启用，且版本低于4.7.1

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

该漏洞存在于WordPress 4.7版本及之前的REST API实现中，由于`wp-includes/rest-api/endpoints/class-wp-rest-users-controller.php`没有正确限制对文章作者列表的访问，攻击者可以通过访问`wp-json/wp/v2/users`端点来获取敏感信息，如用户名。 

**有效性：**
根据漏洞信息和搜索引擎结果，该漏洞确实存在于WordPress 4.7之前的版本中。提供的POC代码旨在利用此漏洞枚举用户名，利用方式是向目标WordPress网站的REST API端点`/wp-json/wp/v2/users`发送请求，尝试获取用户信息。如果WordPress版本低于4.7.1，且没有采取适当的防护措施，该POC代码应该是有效的。

**投毒风险：**
分析提供的Python脚本`leak-wordpress-user.py`，脚本的功能是读取urls.txt中的URL列表，然后针对每个URL，循环请求`/?rest_route=/wp/v2/users/{i}` endpoint，其中`i` 是从0到number的整数，来尝试枚举用户。 脚本会将发现的用户名和相关信息写入到`users_leak.txt`文件中。脚本使用了`requests`库发送HTTP请求，并使用了`colorama`、`pyfiglet`、`simplejson`、`rich`库来提供更好的输出和命令行界面。

虽然脚本本身没有明显的恶意代码，但存在以下几点潜在的投毒风险：

1.  **依赖风险：** 脚本依赖于`requirements.txt`中列出的外部库。 虽然这些库本身是很常用的库，但库的维护者可能在后续版本中引入恶意代码，或者被黑客攻击导致恶意版本发布。
2.  **URL列表风险：** 该脚本依赖于用户提供的URL列表文件 `urls.txt`。 如果用户不小心使用了包含恶意站点的URL列表，可能会导致意外的请求到不信任的站点。
3.  **输出文件风险：** 脚本会将结果写入到`users_leak.txt`。如果该脚本运行在具有其他安全漏洞的系统上，攻击者可能会利用该文件进行信息窃取。

考虑到这些风险，我认为该仓库存在约5%的投毒可能性，因为主要是依赖项和使用方式上的风险，而非代码本身存在后门。

**利用方式：**

1.  确定目标WordPress网站的版本是否低于4.7.1。
2.  克隆包含利用代码的Git仓库。
3.  使用`pip install -r requirements.txt`命令安装依赖。
4.  准备包含目标网站URL的`urls.txt`文件，每行一个URL。
5.  运行脚本`python3 leak-wordpress-user.py -list urls.txt -number 10`，其中`urls.txt`是URL列表文件，`10`是要尝试枚举的用户数量。
6.  检查生成的`users_leak.txt`文件，查看是否成功枚举到用户名。

**项目地址:** [dream434/CVE-2017-5487](https://github.com/dream434/CVE-2017-5487)

**漏洞详情:** [CVE-2017-5487](https://nvd.nist.gov/vuln/detail/CVE-2017-5487)