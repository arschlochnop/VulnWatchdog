## CVE-2023-38831-WinRAR-代码执行

**漏洞编号:** CVE-2023-38831

**漏洞类型:** 代码执行

**影响应用:** WinRAR

**危害等级:** 高危，允许攻击者在目标系统上执行任意代码

**影响版本:** < 6.23

**利用条件:** 用户需要使用受影响的WinRAR版本打开恶意的ZIP文件

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-38831是一个存在于WinRAR 6.23之前版本中的漏洞。该漏洞的利用方式是创建一个特制的ZIP文件，其中包含一个良性文件和一个同名文件夹。当用户尝试使用WinRAR打开ZIP文件并访问该良性文件时，WinRAR会错误地执行该同名文件夹中的恶意代码，导致远程代码执行。

**有效性：**
提供的POC代码（exploit.c）利用了该漏洞。该代码生成一个ZIP文件，其中包含一个PDF文件（document.pdf）和一个名为“document.pdf\”的文件夹，该文件夹内包含一个恶意的批处理脚本（script.bat）。当用户在易受攻击的WinRAR版本中打开并尝试访问该PDF文件时，WinRAR将执行该批处理脚本。
checker.bat 是用来检测目标系统是否安装WinRAR，以及WinRAR的版本是否是受影响的版本。
exploit.ps1 看起来不完整，但是其作用应该是检查WinRAR版本。

**投毒风险：**
代码中存在一定的投毒风险，约为10%。原因如下：
*   **脚本内容可控：** exploit.c 中的script_content变量包含了要执行的命令，虽然当前POC仅仅是弹窗，但是攻击者可以修改这个变量，执行任意命令，例如下载恶意软件，执行系统命令等。
*   **复杂的构建过程：** exploit.c 代码本身比较复杂，阅读和分析需要一定的时间和精力。攻击者可以利用这一点，在代码中隐藏不易察觉的恶意代码。
虽然有潜在的投毒风险，但当前代码的主要目的是演示漏洞利用，风险较低，作者没有明显的隐藏后门行为，恶意代码比较容易被发现。

**利用方式：**
1.  攻击者创建一个恶意的ZIP压缩包，其中包含：
    *   一个良性的文件（例如 document.pdf）。
    *   一个与良性文件同名的文件夹（例如 document.pdf/）。
    *   恶意代码位于同名文件夹中（例如 document.pdf/script.bat）。
2.  攻击者诱骗目标用户使用存在漏洞的 WinRAR 版本打开此 ZIP 压缩包。
3.  当用户尝试打开良性文件时，WinRAR 错误地执行同名文件夹中的恶意代码，从而导致任意代码执行。


**项目地址:** [idkwastaken/CVE-2023-38831](https://github.com/idkwastaken/CVE-2023-38831)

**漏洞详情:** [CVE-2023-38831](https://nvd.nist.gov/vuln/detail/CVE-2023-38831)