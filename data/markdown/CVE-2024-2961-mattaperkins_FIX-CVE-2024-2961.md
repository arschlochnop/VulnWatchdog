## CVE-2024-2961-glibc-iconv缓冲区溢出

**漏洞编号:** CVE-2024-2961

**漏洞类型:** 缓冲区溢出

**影响应用:** glibc

**危害等级:** 高危，可能导致程序崩溃或任意代码执行

**影响版本:** < 2.40

**利用条件:** 需要使用iconv()函数进行ISO-2022-CN-EXT字符集转换，并且输出缓冲区大小可控。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-2961是glibc库中iconv()函数的一个缓冲区溢出漏洞。当使用iconv()将字符串转换为ISO-2022-CN-EXT字符集时，如果输出缓冲区过小，可能会发生最多4字节的溢出。攻击者可以通过构造特定的输入字符串来触发此漏洞，导致程序崩溃或覆盖相邻的变量，甚至执行任意代码。

**有效性评估：**
根据CVE信息和搜索结果，该漏洞已经公开披露，并且存在可利用的POC。提供的修复脚本通过从`gconv-modules-extra.conf`文件中移除包含'CN-?EXT'的行来缓解该漏洞，禁用存在漏洞的字符集转换。 因此，修复脚本本身表明该漏洞是可利用的，虽然提供的脚本仅仅是缓解，而不是直接的exp.

**投毒风险评估：**
提供的`fix.sh`脚本的主要功能是检测系统上是否存在受漏洞影响的glibc版本，并尝试通过修改iconv的配置文件来缓解该漏洞。脚本首先检查`/usr/lib/x86_64-linux-gnu/gconv`目录是否存在，然后检查ldd版本是否包含GLIBC，并检查`iconv -l`命令的输出是否包含'CN-?EXT'。如果以上检查都通过，脚本会尝试使用`grep`命令从`gconv-modules-extra.conf`文件中移除包含'CN-?EXT'的行，并将修改后的内容保存到`.new`文件中，最后使用`mv`命令覆盖原始文件。脚本的最后运行`iconvconfig`。

该脚本的目的是缓解漏洞，而不是利用漏洞。没有发现任何恶意代码或隐藏的后门。因此，投毒风险可以认为是0%。

**利用方式：**
1.  **触发漏洞：** 通过调用iconv()函数，并将一个精心构造的字符串从一种字符集转换为ISO-2022-CN-EXT字符集。
2.  **控制溢出：**  控制输入字符串和输出缓冲区的大小，确保溢出发生，并且覆盖到目标内存区域。
3.  **代码执行 (如果可能)：** 如果溢出覆盖了函数返回地址或其他关键数据，攻击者可以控制程序的执行流程，最终实现任意代码执行。

漏洞利用难度取决于具体的环境和目标程序。在某些情况下，可能需要绕过各种安全机制，如地址空间布局随机化（ASLR）和数据执行保护（DEP）。

**项目地址:** [mattaperkins/FIX-CVE-2024-2961](https://github.com/mattaperkins/FIX-CVE-2024-2961)

**漏洞详情:** [CVE-2024-2961](https://nvd.nist.gov/vuln/detail/CVE-2024-2961)