## CVE-2022-29464-WSO2-Unrestricted File Upload RCE

**漏洞编号:** CVE-2022-29464

**漏洞类型:** 未限制文件上传导致远程代码执行

**影响应用:** WSO2 API Manager, Identity Server, Enterprise Integrator, Open Banking AM/KM

**危害等级:** 高危，可导致远程代码执行

**影响版本:** WSO2 API Manager 2.2.0 up to 4.0.0, WSO2 Identity Server 5.2.0 up to 5.11.0, WSO2 Identity Server Analytics 5.4.0, 5.4.1, 5.5.0 and 5.6.0, WSO2 Identity Server as Key Manager 5.3.0 up to 5.11.0, WSO2 Enterprise Integrator 6.2.0 up to 6.6.0, WSO2 Open Banking AM 1.4.0 up to 2.0.0 and WSO2 Open Banking KM 1.4.0, up to 2.0.0

**利用条件:** 需要能够访问 `/fileupload` 端点

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-29464 漏洞允许攻击者通过 `/fileupload` 端点上传任意文件，通过目录穿越将恶意JSP文件上传到webapps目录下，从而实现远程代码执行。

**有效性：**
根据漏洞库信息、搜索引擎结果和提供的PoC代码，该漏洞利用是有效的。多个来源都确认了该漏洞的存在和可利用性，并且存在公开的PoC。

**投毒风险：**
PoC 代码本身主要功能是上传 webshell，但是`reverse_jsp`使用了硬编码的`8.tcp.ngrok.io:12508`，存在潜在的风险，如果攻击者修改了这个reverse shell 的地址，有可能反弹shell到攻击者的机器上。虽然`public_key`变量存在，但是代码没有使用，所以可以排除钓鱼风险，综上判断，存在5%的投毒风险。

**利用方式：**
1.  攻击者使用带有目录穿越的 `Content-Disposition` 头构造恶意的POST请求到 `/fileupload` 端点。
2.  请求中包含要上传的恶意JSP文件，目标路径指向Web根目录下的一个可执行JSP的目录，例如 `repository/deployment/server/webapps`。
3.  服务器接收到请求后，由于未对上传的文件类型和目标路径进行充分验证，会将恶意JSP文件写入到指定目录。
4.  攻击者可以通过访问上传的JSP文件，执行其中的恶意代码，实现远程代码执行。

**项目地址:** [g0dxing/CVE-2022-29464](https://github.com/g0dxing/CVE-2022-29464)

**漏洞详情:** [CVE-2022-29464](https://nvd.nist.gov/vuln/detail/CVE-2022-29464)