## CVE-2024-0012 & CVE-2024-9474 Palo Alto PAN-OS 身份验证绕过和命令执行

**漏洞编号:** CVE-2024-0012

**漏洞类型:** 身份验证绕过 + 命令执行

**影响应用:** Palo Alto PAN-OS

**危害等级:** 高危，可能导致完全控制受影响的系统

**影响版本:** PAN-OS 10.2, 11.0, 11.1, 和 11.2 (参考漏洞库信息)

**利用条件:** 需要网络访问 PAN-OS 管理 Web 界面，且管理界面暴露在不受信任的网络中（例如互联网）。 根据漏洞库信息，仅允许受信任的内部IP地址访问管理界面可大大降低风险。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞利用结合了 CVE-2024-0012（身份验证绕过）和 CVE-2024-9474（命令执行和权限提升）。

**利用方式：**

1.  **身份验证绕过 (CVE-2024-0012)：** 攻击者无需身份验证即可访问 PAN-OS 管理 Web 界面。
2.  **获取 PHPSESSID：**  攻击者通过发送特制的 POST 请求到 `createRemoteAppwebSession.php` 获取有效的 `PHPSESSID`。
3.  **命令注入 (CVE-2024-9474)：** 攻击者使用获得的 `PHPSESSID`，通过在 `user` 参数中注入 shell 命令，利用 `createRemoteAppwebSession.php` 执行任意命令。
4.  **反弹 Shell：** 攻击者构造一个反弹 shell 的 payload，该 payload 经过两次 Base64 编码。
5.  **分块上传：** 因为命令长度限制，payload 被分割成多个小块，然后通过多个 POST 请求上传到目标服务器，存储为临时文件。
6.  **组合 Payload：** 上传完成后，攻击者使用 shell 命令将这些小块文件组合成一个完整的文件 `enc.txt`。
7.  **双重解码：** 攻击者对 `enc.txt` 中的内容进行双重 Base64 解码，并将结果保存到 `shell.sh` 文件中。
8.  **执行 Shell：** 攻击者赋予 `shell.sh` 可执行权限并执行它，从而建立反弹 shell 连接到攻击者的监听器。

**有效性：**

根据搜索引擎结果，该漏洞已被积极利用。提供的 PoC 代码实现了漏洞利用的完整流程，包括身份验证绕过、命令注入和反弹 shell。因此，该PoC代码被认为是有效的。

**投毒风险：**

虽然PoC的主要功能是利用漏洞，但仍存在一定的投毒风险。

*   **临时文件残留：**  该PoC在目标系统上创建临时文件（`c_*.tmp`, `enc.txt`, `shell.sh`），如果利用失败或被中断，这些文件可能会残留，占用磁盘空间或泄露信息。
*   **命令执行风险：**  即使没有成功建立反弹 shell，PoC执行的中间命令可能对系统造成意外影响。
*   **依赖性问题：** 该PoC 依赖于目标系统上存在 `bash`，`base64`，`cat`，`echo`，`tr`，`chmod` 命令。 如果目标系统缺少这些命令,会导致POC 利用失败.

**投毒风险评估：**

该PoC的主要目的是进行漏洞利用，而非进行恶意破坏。 但也存在一定的风险。 投毒风险大概为10%。

**项目地址:** [TalatumLabs/CVE-2024-0012_CVE-2024-9474_PoC](https://github.com/TalatumLabs/CVE-2024-0012_CVE-2024-9474_PoC)

**漏洞详情:** [CVE-2024-0012](https://nvd.nist.gov/vuln/detail/CVE-2024-0012)