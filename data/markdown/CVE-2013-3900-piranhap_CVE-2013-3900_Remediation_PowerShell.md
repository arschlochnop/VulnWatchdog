## CVE-2013-3900 WinVerifyTrust Signature Validation Vulnerability

**漏洞编号:** CVE-2013-3900

**漏洞类型:** 签名验证绕过

**影响应用:** Windows操作系统

**危害等级:** 中危，可能导致恶意代码执行

**影响版本:** 受影响的Windows操作系统版本（见漏洞库信息）

**利用条件:** 用户或应用程序需要运行或安装被篡改的签名PE文件。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2013-3900是一个Windows WinVerifyTrust函数处理 Authenticode 签名验证时存在的远程代码执行漏洞。攻击者可以修改已签名的PE文件，添加恶意代码而不使签名失效。 

**有效性：**
根据漏洞库信息和搜索引擎结果，该漏洞是真实存在的，并且可以通过修改PE文件来利用。 提供的POC代码 `tool.ps1` 本身不是漏洞利用代码，而是**缓解措施**，它通过修改注册表键值 `EnableCertPaddingCheck` 来启用或禁用证书填充检查。启用此检查可以缓解此漏洞。因此，提供的代码**不能直接用于漏洞利用，而是用于修复漏洞**。

**投毒风险：**
提供的PowerShell脚本 `tool.ps1` 的目的是修改注册表以启用或禁用证书填充检查，从而缓解 CVE-2013-3900 漏洞。 该脚本相对简单，逻辑清晰，只包含读取用户输入、判断输入值，以及修改注册表的操作。 检查了脚本中的关键操作，例如注册表路径和键名，与缓解 CVE-2013-3900 漏洞所需的设置一致。 没有发现任何可疑的代码或行为，例如执行外部命令、下载恶意文件或收集敏感信息。 此外，脚本的目的是修复漏洞，而不是利用漏洞，这降低了作者故意添加恶意代码的可能性。 因此，该脚本中存在作者隐藏的投毒代码的风险非常低，可以判断投毒风险为0%。

**利用方式：**
攻击者需要篡改已签名的PE文件，在未验证的部分添加恶意代码，然后在目标系统上执行该文件。如果目标系统未启用证书填充检查，则WinVerifyTrust函数不会验证PE文件中添加的恶意代码，从而导致恶意代码执行。 攻击方式通常涉及以下步骤：

1.  获取一个合法的、已签名的PE文件。
2.  在PE文件的PKCS7部分或其他未验证的区域添加恶意代码。
3.  诱骗用户或应用程序运行或安装被篡改的PE文件。

**缓解措施：**
可以通过设置注册表键值 `EnableCertPaddingCheck` 为1来启用证书填充检查，从而缓解此漏洞。提供的 `tool.ps1` 脚本可以自动化此过程。需要管理员权限才能运行此脚本并修改注册表。


**项目地址:** [piranhap/CVE-2013-3900_Remediation_PowerShell](https://github.com/piranhap/CVE-2013-3900_Remediation_PowerShell)

**漏洞详情:** [CVE-2013-3900](https://nvd.nist.gov/vuln/detail/CVE-2013-3900)