## CVE-2025-6019-libblockdev-本地提权

**漏洞编号:** CVE-2025-6019

**漏洞类型:** 本地权限提升 (LPE)

**影响应用:** libblockdev (通过 udisks)

**危害等级:** 高危，攻击者可以从 allow_active 用户权限提升到 root 权限

**影响版本:** Red Hat Enterprise Linux 7/8/9/10 受影响

**利用条件:** 需要本地访问权限，且Polkit配置允许 allow_active 用户进行某些操作

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2025-6019 是 libblockdev 中的一个本地权限提升漏洞。利用方式是，攻击者首先利用 Polkit 中 'allow_active' 设置允许的权限，然后通过构造恶意的 XFS 镜像，诱使 udisks 调整其大小。由于 udisks 在挂载用户提供的文件系统镜像时通常会设置 nosuid 和 nodev 等安全标志，但攻击者可以通过精心设计的 XFS 镜像包含 SUID-root shell，从而绕过这些安全措施。当 udisks 以 root 权限挂载这个恶意文件系统后，攻击者就可以执行 SUID-root shell 并获得 root 权限。

提供的 POC 代码 `poc2025-6019.py` 尝试利用与 CVE-2025-6018 相关的另一种提权方式，该方式依赖于 PAM 环境的污染，看起来与漏洞描述中的利用方式有所不同。

**有效性评估：**

提供的 POC 代码 `poc2025-6019.py` 并非直接利用 XFS 镜像的漏洞，而是尝试通过 PAM 环境污染利用 CVE-2025-6018 漏洞。该脚本首先通过 SSH 连接到目标主机，检查是否存在 CVE-2025-6018/6019 漏洞的前提条件（PAM 版本和配置），然后尝试通过修改 `~/.pam_environment` 文件来污染 PAM 环境，最后检查是否成功提升权限。根据漏洞描述，CVE-2025-6019 的根本原因是恶意构造的 XFS 镜像绕过了 udisks 的安全机制。 因此，提供的 POC 利用的提权方式与漏洞描述并不完全相符，有效性存疑，可能需要目标系统同时存在 CVE-2025-6018 漏洞才能成功。

**投毒风险评估：**

代码中存在轻微的投毒风险，主要是由于脚本需要在目标主机上创建和修改文件。虽然脚本本身的目标是利用漏洞，但如果攻击者修改了脚本，例如在 `commands_sequence_1` 或 `commands_sequence_2` 中添加恶意命令，则可能在目标主机上执行任意代码。由于脚本需要 SSH 凭据才能运行，因此只有具有一定权限的用户才能利用此脚本进行攻击。投毒风险较低(约为1%)，因为代码本身较为简单，且主要是执行系统命令，不易隐藏恶意代码。主要风险在于脚本可能被修改以执行恶意命令。

**利用方式总结：**

1.  **CVE-2025-6019 (基于漏洞描述)：** 攻击者创建包含 SUID-root shell 的恶意 XFS 镜像，并诱使 udisks 以 root 权限挂载该镜像，从而执行 SUID-root shell 并获得 root 权限。
2.  **POC 代码 (`poc2025-6019.py`)：** 通过 SSH 连接到目标主机，检查是否存在 CVE-2025-6018 的前提条件，然后通过修改 `~/.pam_environment` 文件来污染 PAM 环境，最后检查是否成功提升权限。这是一种利用 PAM 配置不当的提权方式，与 CVE-2025-6019 的原始漏洞描述有所不同，更像是利用了 CVE-2025-6018 的方式。

**项目地址:** [dreysanox/CVE-2025-6019_Poc](https://github.com/dreysanox/CVE-2025-6019_Poc)

**漏洞详情:** [CVE-2025-6019](https://nvd.nist.gov/vuln/detail/CVE-2025-6019)