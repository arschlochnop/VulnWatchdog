## CVE-2024-39924-Vaultwarden-权限提升

**漏洞编号:** CVE-2024-39924

**漏洞类型:** 权限提升

**影响应用:** Vaultwarden

**危害等级:** 高危，允许攻击者在紧急访问场景下完全控制vault

**影响版本:** 1.30.3

**利用条件:** 需要攻击者已经被授予紧急访问权限

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-39924 存在于 Vaultwarden 1.30.3 版本中。该漏洞允许已经获得紧急访问权限的攻击者，通过修改 API 端点 `/api/emergency-access/<UUID>` 的 metadata，特别是 `waitTimeDays` 字段，来绕过预设的等待时间，立即获得对目标 vault 的完全控制权。漏洞利用过程为：

1.  攻击者首先需要被授予紧急访问权限。
2.  攻击者向 `/api/emergency-access/<UUID>` 发送 PUT 请求。
3.  在请求体中，将 `waitTimeDays` 修改为 `0`。
4.  触发 Vaultwarden 的 cronjob，导致攻击者立即获得对目标 vault 的访问权限。

**有效性：**

提供的 PoC 代码看起来是有效的。它提供了一个 Dockerfile，用于搭建一个包含漏洞版本的 Vaultwarden 实例，并提供了一个 README 文件，详细描述了漏洞利用步骤和所需的凭据。搜索引擎结果也确认了该漏洞的存在和影响。

**投毒风险：**

经过分析，该 PoC 代码没有明显的投毒风险。Dockerfile 只是用于构建包含漏洞版本的 Vaultwarden 实例，没有发现恶意代码。提供的 RSA 私钥 `rsa_key.pem` 应该是测试环境使用的，不应该用于生产环境。此外，仓库提供的其他文件如README.md只包含漏洞信息和使用说明，未发现后门或者恶意代码，**因此投毒的可能性为 0%**。

**利用方式：**

1.  **前提条件：** 攻击者必须首先被目标用户设置为紧急联系人，并获得紧急访问权限。
2.  **漏洞触发：** 攻击者利用漏洞，向`/api/emergency-access/<UUID>`接口发送PUT请求，将 `waitTimeDays` 设置为0。
3.  **权限提升：** 由于缺乏适当的身份验证和授权检查，Vaultwarden 允许攻击者立即获得对目标 vault 的完全控制权，绕过了预期的等待时间。

此漏洞的根本原因是缺乏对紧急访问元数据修改操作的适当身份验证和授权检查，导致了权限提升。

**项目地址:** [l4rm4nd/PoC-CVE-2024-39924](https://github.com/l4rm4nd/PoC-CVE-2024-39924)

**漏洞详情:** [CVE-2024-39924](https://nvd.nist.gov/vuln/detail/CVE-2024-39924)