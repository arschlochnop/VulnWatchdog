## CVE-2023-40028-Ghost-任意文件读取

**漏洞编号:** CVE-2023-40028

**漏洞类型:** 任意文件读取

**影响应用:** Ghost

**危害等级:** 中危，可能导致敏感信息泄露

**影响版本:** < 5.59.1

**利用条件:** 需要Ghost后台的高权限用户账号

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-40028 是 Ghost CMS 中存在的一个任意文件读取漏洞。攻击者需要具备Ghost的管理员权限，能够上传文件。漏洞利用方式为：

1.  **身份验证：** 首先，攻击者需要使用有效的用户名和密码登录Ghost后台。
2.  **生成恶意Payload：**  POC代码`exp.py`会创建一个包含符号链接的zip文件。这个符号链接指向服务器上的任意文件（攻击者想要读取的文件）。符号链接位于`content/images/2024/{image_name}.png`，其中`image_name`是随机生成的。
3.  **上传Payload：**  攻击者将生成的zip文件上传到Ghost CMS。Ghost将解压此zip文件，创建符号链接。
4.  **文件读取：**  攻击者通过访问包含符号链接的URL（例如，`{Ghost_Url}/content/images/2024/{image_name}.png`）来触发文件读取。由于Ghost会将符号链接解析为目标文件，因此攻击者可以读取服务器上的任意文件。
5.  **清理：**  POC代码会在利用完成后删除生成的payload文件和cookie文件。

**有效性评估：**

根据漏洞库信息、搜索结果和POC代码，该漏洞是有效的。多个来源都确认了该漏洞的存在，并提供了相应的POC。

**投毒风险评估：**

POC代码本身主要功能是利用漏洞，但存在一定的潜在投毒风险。主要考量点如下：

*   **依赖风险：** 代码使用了`os.system`来执行系统命令，这增加了引入恶意代码的可能性。尽管此处的系统命令是为了创建符号链接和打包zip文件，但如果攻击者修改了代码，这些命令可能被替换为执行恶意操作的命令。
*   **代码可读性：** 代码相对清晰，主要功能集中在生成payload、上传和读取文件，容易进行代码审计。
*   **清理操作：** 代码中包含清理操作，删除了生成的payload文件，这降低了长期驻留恶意代码的可能性。

综合考虑，评估认为投毒风险为10%。因为代码的功能相对直接，且包含清理操作，不容易隐藏恶意代码。但`os.system`的使用仍然引入了一定的风险，如果用户不小心执行了被篡改的代码，可能会受到攻击。

**漏洞利用方式总结：**

该漏洞利用的核心在于利用Ghost CMS对上传文件处理的缺陷，允许上传包含符号链接的文件。通过创建指向敏感文件的符号链接，攻击者可以绕过权限验证，读取服务器上的任意文件。


**项目地址:** [buutt3rf1y/CVE-2023-40028](https://github.com/buutt3rf1y/CVE-2023-40028)

**漏洞详情:** [CVE-2023-40028](https://nvd.nist.gov/vuln/detail/CVE-2023-40028)