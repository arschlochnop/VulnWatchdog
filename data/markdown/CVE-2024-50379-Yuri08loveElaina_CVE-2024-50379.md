## CVE-2024-50379 - Apache Tomcat JSP 编译 TOCTOU 竞争条件 RCE

**漏洞编号:** CVE-2024-50379

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Tomcat

**危害等级:** 高危，未经授权的远程代码执行

**影响版本:** 9.0.0.M1 - 9.0.97, 10.1.0-M1 - 10.1.33, 11.0.0-M1 - 11.0.1

**利用条件:** 默认Servlet启用写入（非默认配置），大小写不敏感的文件系统。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-50379 是一个 Apache Tomcat 中的 TOCTOU（Time-of-check Time-of-use）竞争条件漏洞，发生在 JSP 编译期间。如果满足以下条件，则可能导致远程代码执行：

1.  **默认 Servlet 启用写入：** Tomcat 的默认 Servlet 允许写入，这不是默认配置，需要手动开启。
2.  **大小写不敏感的文件系统：** 操作系统使用大小写不敏感的文件系统（例如 Windows）。

**漏洞利用方式：**

攻击者通过上传恶意 JSP 文件（例如 aa.Jsp 和 bb.Jsp）并利用并发请求触发 TOCTOU 漏洞。具体来说，攻击者会并发地发送 PUT 和 GET 请求到 Tomcat 服务器。PUT 请求用于上传包含恶意代码的 JSP 文件，GET 请求用于访问这些 JSP 文件。由于竞争条件，Tomcat 可能会在文件检查后、实际执行文件之前，将文件误判为安全，从而导致恶意代码被执行。

漏洞利用代码 `exploit.py` 模拟了这种攻击方式，它并发地向目标 URL 发送 PUT 和 GET 请求，尝试上传和执行包含反弹 shell 代码的 JSP 文件。代码中使用了多线程来增加竞争成功的概率。

**有效性：**

根据漏洞描述和搜索结果，POC代码在满足特定条件（默认 Servlet 启用写入，大小写不敏感的文件系统）下有效。它利用了并发请求来触发 TOCTOU 漏洞，从而允许远程代码执行。

**投毒风险：**

查看提供的代码，发现该代码的功能是尝试利用 CVE-2024-50379 漏洞进行远程代码执行。代码本身实现了并发上传和访问JSP文件，并通过反弹shell执行恶意代码。**该代码的目的是进行漏洞验证和利用，而不是植入恶意后门**。因此，认为该代码存在投毒风险的可能性极低，判定为0%。

搜索结果也表明该漏洞利用涉及竞争条件，需要并发执行 PUT 和 GET 请求才能成功利用。这与 POC 代码的实现方式相符。

**项目地址:** [Yuri08loveElaina/CVE-2024-50379](https://github.com/Yuri08loveElaina/CVE-2024-50379)

**漏洞详情:** [CVE-2024-50379](https://nvd.nist.gov/vuln/detail/CVE-2024-50379)