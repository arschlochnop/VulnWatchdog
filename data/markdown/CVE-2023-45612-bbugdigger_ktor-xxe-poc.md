## CVE-2023-45612-Ktor-XXE

**漏洞编号:** CVE-2023-45612

**漏洞类型:** XXE

**影响应用:** Ktor

**危害等级:** 高危，可能导致敏感信息泄露

**影响版本:** < 2.3.5

**利用条件:** 目标应用启用了XML ContentNegotiation且使用默认配置

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-45612是JetBrains Ktor框架在2.3.5版本之前的XML处理中存在的一个XXE漏洞。默认情况下，ContentNegotiation在使用XML格式时存在安全隐患，允许攻击者通过构造恶意的XML请求来读取服务器上的任意文件或执行其他恶意操作。

**有效性分析：**
根据提供的POC代码，该漏洞的利用步骤如下：
1.  克隆包含漏洞利用代码的`ktor-xxe-poc`仓库。
2.  使用Gradle构建并运行Ktor应用程序（该应用程序模拟了存在漏洞的服务）。
3.  在另一个终端中使用Python脚本`xxe_poc.py`发送包含恶意XML Payload的请求。

通过执行这些步骤，可以验证目标服务是否存在XXE漏洞。

**投毒风险分析：**
代码仓库中可能存在投毒风险，例如在`build.gradle.kts`中引入恶意的依赖，或者在`xxe_poc.py`脚本中执行恶意操作。以下是评估结果：
*   **build.gradle.kts:** 检查依赖项，libs.xmlutil.core、libs.xmlutil.serialization可能存在被替换成恶意依赖的风险，例如，指向一个包含恶意代码的Maven仓库。虽然检查这些依赖库的安全性可以降低风险，但并不能完全排除。
*   **xxe_poc.py:** 此脚本是POC验证脚本，用于发送恶意XML，主要用于读取文件，进行SSRF等操作，但可能存在后门，例如执行系统命令，连接恶意服务器等。需要仔细审查该脚本。
*   **gradlew:** 主要用于构建， 脚本本身没有明显的投毒特征。

由于不清楚`xxe_poc.py`的具体内容，以及无法对远程maven仓库中的依赖项进行安全评估，因此给出10%的投毒风险。

**利用方式：**
攻击者可以发送一个包含恶意XML Payload的请求，该Payload包含一个指向外部实体的声明。当Ktor应用解析该XML时，会尝试加载外部实体，从而导致：
*   **任意文件读取：** 攻击者可以读取服务器上的任意文件，例如配置文件、密钥等。
*   **服务端请求伪造（SSRF）：** 攻击者可以利用服务器作为跳板，向内部网络或外部网络发起请求。
*   **拒绝服务攻击（DoS）：** 通过引用一个无限循环的外部实体，导致服务器资源耗尽。

**项目地址:** [bbugdigger/ktor-xxe-poc](https://github.com/bbugdigger/ktor-xxe-poc)

**漏洞详情:** [CVE-2023-45612](https://nvd.nist.gov/vuln/detail/CVE-2023-45612)