## CVE-2023-52927

**漏洞编号:** CVE-2023-52927

**漏洞类型:** UAF（Use-After-Free）

**影响应用:** Linux Kernel

**危害等级:** 高危，可导致本地权限提升

**影响版本:** < 6.1.130, < 6.6

**利用条件:** 需要在受影响的内核版本上运行，并能够配置netfilter/nf_tables子系统。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-52927 是 Linux 内核 netfilter 模块中 nf_conntrack 功能中的一个 UAF 漏洞。该漏洞源于 `nf_ct_find_expectation` 函数在某些情况下没有正确地从哈希表中移除 expectation 对象。当 OVS 和 TC conntrack 不确认创建的 ct 时，会导致 expectation 对象被释放后仍然被使用。

**利用方式：**

1.  **分配 template nf_conn：** 通过调用 `nft_ct_set_zone_eval()` 分配一个 template nf_conn。
2.  **设置 nf_nat_setup_info()：** 设置 `nf_nat_setup_info()` 函数。
3.  **连接 template nf_conn：** 将 template nf_conn 连接到 `nf_nat_setup_info()`。
4.  **释放 template nf_conn：** 释放 template nf_conn。
5.  **链接另一个 nf_conn：** 将另一个 nf_conn 链接到 `nf_nat_bysource` 哈希表的相同 bucket。
6.  **触发 KASAN：** 触发 KASAN UAF 漏洞。
7. **漏洞利用**: 首先通过原始的UAF获得一个原始的读写能力，然后通过替换对象改变原始读写能力。通过泄露堆信息和控制使用的nf_conn，从而实现读写表达式的ops，最终通过控制RIP来完成提权。

**有效性：**

根据提供的漏洞利用代码（README.md），该漏洞存在可利用性。代码中详细描述了漏洞的根 Cause 分析，以及如何编写 PoC 来触发 KASAN 报告，并开发稳定的本地权限提升 exploit。

**投毒风险：**

虽然提供的文档看起来像是详细的漏洞分析和利用指南，但是仍然存在一定的投毒风险。代码中可能包含一些不易察觉的后门或恶意代码，例如：

*   **隐藏的函数调用：** 在 PoC 代码中插入一些看似无害但实际会执行恶意操作的函数调用。
*   **条件触发的恶意行为：** 只有在特定条件下才会触发的恶意代码，例如检查特定环境变量或系统配置。
*   **利用漏洞安装后门：** 利用漏洞在目标系统上安装后门程序，以便后续进行远程控制。

鉴于漏洞利用代码的复杂性，以及攻击者可能使用的各种隐藏手段，因此**投毒风险估计为 10%**。建议在使用此代码之前进行全面的安全审计，以确保其安全性。

**项目地址:** [seadragnol/CVE-2023-52927-private](https://github.com/seadragnol/CVE-2023-52927-private)

**漏洞详情:** [CVE-2023-52927](https://nvd.nist.gov/vuln/detail/CVE-2023-52927)