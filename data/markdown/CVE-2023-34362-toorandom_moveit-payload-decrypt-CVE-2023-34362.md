## CVE-2023-34362-MOVEit Transfer-SQL注入

**漏洞编号:** CVE-2023-34362

**漏洞类型:** SQL注入

**影响应用:** MOVEit Transfer

**危害等级:** 高危，可能导致数据泄露、远程代码执行，以及被勒索软件利用

**影响版本:** 受影响版本包括但不限于2021.0.6 (13.0.6), 2021.1.4 (13.1.4), 2022.0.4 (14.0.4), 2022.1.5 (14.1.5), and 2023.0.1 (15.0.1)，以及所有早于上述五个版本的版本，包括不受支持的旧版本。

**利用条件:** 未授权的攻击者可以通过HTTP或HTTPS访问存在漏洞的MOVEit Transfer实例

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-34362是MOVEit Transfer中的一个SQL注入漏洞，允许未经身份验证的攻击者访问MOVEit Transfer的数据库。根据使用的数据库引擎（MySQL、Microsoft SQL Server或Azure SQL），攻击者可能能够推断数据库的结构和内容，并执行SQL语句来修改或删除数据库元素。该漏洞在野外被积极利用，已被CL0P勒索软件团伙利用进行数据盗窃和勒索。

**漏洞利用方式：**

1.  **SQL注入：** 攻击者利用SQL注入漏洞，通过构造恶意的SQL语句，绕过身份验证或直接访问数据库。
2.  **数据访问：** 成功利用SQL注入后，攻击者可以读取数据库中的敏感数据，例如用户名、密码、API密钥等。
3.  **数据篡改/删除：** 攻击者可以执行SQL语句来修改或删除数据库中的数据，导致服务中断或数据损坏。
4.  **远程代码执行：** 在某些情况下，攻击者可能能够利用SQL注入执行操作系统命令，从而实现远程代码执行。

**POC有效性：**

提供的POC代码 (`moveit_payload_decrypt.sh`) 用于解密MOVEit Transfer日志中发现的base64编码的artifact，这与漏洞的利用方式密切相关。攻击者利用SQL注入获得加密payload后，需要使用该脚本来解密payload。 因此，它不是直接利用漏洞的EXP，而是漏洞利用链中的一个环节,用于解密有效载荷， 依赖于已经成功利用SQL注入。 该脚本需要OrgKey 0，该密钥存储在受影响实例的注册表项 `Microsoft/Standard Networks/siLock/Institutions/0` 中。脚本的功能是根据提供的OrgKey 0解析MOVEit日志中base64 artifact的头部并解密序列化的payload对象。

**投毒风险分析：**

查看代码，主要功能集中在payload的解析和解密上。该脚本本身需要从MOVEit服务器的注册表中提取OrgKey 0才能运行，因此投毒风险较低。 但是考虑到以下几点， 仍然存在一定的投毒风险：

1.  **依赖外部命令：** 脚本依赖于`base64`、`cut`、`dd`、`xxd`、`sed`、`openssl`等外部命令。如果这些命令被恶意替换，可能导致脚本执行恶意代码。但这种情况更偏向于系统层面的攻击，而非脚本本身的投毒。
2.  **代码可读性：** 代码相对简单，易于审计，但仍然存在一定的复杂性，可能隐藏不易察觉的漏洞或后门。
3.  **潜在的恶意修改：** 攻击者可能修改脚本，例如在解密后添加恶意代码，或者将解密后的数据发送到远程服务器。

基于以上分析，认为此仓库存在10%的投毒风险。主要风险在于脚本可能被修改或利用来执行恶意操作，而不是脚本本身包含明显的恶意代码。

**项目地址:** [toorandom/moveit-payload-decrypt-CVE-2023-34362](https://github.com/toorandom/moveit-payload-decrypt-CVE-2023-34362)

**漏洞详情:** [CVE-2023-34362](https://nvd.nist.gov/vuln/detail/CVE-2023-34362)