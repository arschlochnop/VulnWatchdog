## CVE-2017-16995

**漏洞编号:** CVE-2017-16995

**漏洞类型:** Linux Kernel eBPF权限提升

**影响应用:** Linux Kernel

**危害等级:** 高危，本地权限提升

**影响版本:** through 4.4

**利用条件:** 本地用户，开启了BPF_SYSCALL配置

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2017-16995 存在于 Linux kernel 4.4版本及更早版本中，是 kernel/bpf/verifier.c 中 check_alu_op 函数的一个整数溢出漏洞，允许本地用户通过利用不正确的符号扩展导致拒绝服务（内存损坏）或可能产生未指明的其他影响。根据提供的POC代码和搜索结果分析：

**有效性：**

POC代码显示漏洞利用成功，可以在多个内核版本上实现本地权限提升，获取root权限。代码中明确说明，此漏洞在加固的Grsecurity内核上无法利用，表明其利用依赖于特定的内核配置和缓解措施的缺失。

**投毒风险：**

虽然提供的代码本身看起来是漏洞利用程序，但仍存在潜在的投毒风险。虽然代码的目的是利用漏洞，但恶意攻击者可能会在代码中添加后门或恶意功能，这些功能在表面上可能不明显，但可能会损害受感染系统的安全性。经过对POC代码的分析，未发现明显的恶意代码。风险评估为5%, 主要是因为：

1.  **代码复杂性：** eBPF和内核利用代码比较复杂，隐藏恶意代码相对容易。
2.  **依赖外部资源：** 某些利用可能依赖于外部脚本或库，这些资源可能被篡改。

**利用方式：**

漏洞利用的核心在于绕过BPF验证器中的符号扩展检查。具体步骤如下：

1.  **创建BPF Map：**  创建一个BPF map以存储数据。
2.  **绕过BPF验证器：**  构造恶意的BPF程序，利用`check_alu_op`函数中的符号扩展错误。
3.  **创建Socket Pair：**  创建socketpair。
4.  **附加BPF后门：**  将BPF程序附加到socket上，作为后门。
5.  **泄漏Sock结构：**  利用漏洞泄漏socket结构的信息。
6.  **获取Cred结构地址：**  根据泄漏的信息计算cred结构的地址。
7.  **覆盖Cred结构：**  覆盖cred结构中的UID和GID，将其设置为0，从而获得root权限。
8.  **启动Shell：**  启动一个具有root权限的shell。

漏洞利用的成功依赖于目标系统存在漏洞，且没有启用相应的安全缓解措施。攻击者需要能够编译和运行BPF程序。

**项目地址:** [ZhiQiAnSecFork/cve-2017-16995](https://github.com/ZhiQiAnSecFork/cve-2017-16995)

**漏洞详情:** [CVE-2017-16995](https://nvd.nist.gov/vuln/detail/CVE-2017-16995)