## CVE-2023-21554-Microsoft Message Queuing (MSMQ) Remote Code Execution Vulnerability

**漏洞编号:** CVE-2023-21554

**漏洞类型:** 远程代码执行

**影响应用:** Microsoft Message Queuing (MSMQ)

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 受影响的Windows版本请参考漏洞库信息

**利用条件:** 目标系统已启用MSMQ服务，且攻击者能够与MSMQ服务端口(通常是1801)建立连接。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

根据漏洞库信息，CVE-2023-21554是Microsoft Message Queuing (MSMQ) 远程代码执行漏洞。提供的PoC代码尝试利用此漏洞。以下是详细分析：

**1. 有效性：**
根据README.md，PoC成功的标志是`mqsvc.exe`进程的崩溃。PoC代码通过socket连接到目标机器的1801端口(MSMQ默认端口)，然后发送一系列预先准备好的二进制数据包，包括连接建立请求 (`establish_connection.bin`)、连接参数 (`connection_parameters.bin`) 和包含漏洞触发数据的用户消息 (`user_message.bin`)。如果目标系统存在漏洞，则`mqsvc.exe`进程会崩溃，表明利用成功。根据文档，`mqsvc.exe`进程的崩溃而非弹窗是成功利用的标志。

**2. 投毒风险：**
分析PoC代码后，没有发现明显的投毒代码。代码的目的是发送一系列二进制文件到MSMQ服务，触发漏洞导致服务崩溃。它并没有执行任何恶意操作例如下载执行恶意程序，上传用户隐私信息等等。代码主要功能是从本地读取文件然后通过socket发送，投毒风险较低。虽然PoC代码本身尝试利用漏洞，但利用的目的是触发崩溃，而不是植入后门或其他恶意行为。因此，可以认为存在投毒代码的概率为0%。

**3. 利用方式：**
漏洞的利用方式如下：
1.  **建立连接：** PoC首先通过socket连接到目标机器的MSMQ服务端口（1801）。
2.  **发送预定义数据包：**  PoC发送一系列预定义的二进制数据包，这些数据包模拟了MSMQ客户端与服务器之间的正常通信流程，包括建立连接、设置连接参数和发送用户消息。
3.  **触发漏洞：**  `user_message.bin`包含精心构造的恶意数据，当MSMQ服务处理这些数据时，会触发漏洞，导致`mqsvc.exe`进程崩溃，可能最终导致远程代码执行。

简单来说，该漏洞是由于MSMQ服务在处理特定格式的消息时，未进行充分的输入验证，导致可以利用精心构造的消息触发漏洞，进而导致远程代码执行。

**项目地址:** [zoemurmure/CVE-2023-21554-PoC](https://github.com/zoemurmure/CVE-2023-21554-PoC)

**漏洞详情:** [CVE-2023-21554](https://nvd.nist.gov/vuln/detail/CVE-2023-21554)