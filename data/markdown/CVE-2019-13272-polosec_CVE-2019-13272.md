## CVE-2019-13272 Linux Kernel PTRACE_TRACEME 本地提权漏洞

**漏洞编号:** CVE-2019-13272

**漏洞类型:** 本地提权

**影响应用:** Linux Kernel

**危害等级:** 高危，允许本地用户获取root权限

**影响版本:** < 5.1.17

**利用条件:** 本地用户访问，需要存在父子进程关系，父进程降低权限并调用execve，可能需要利用Polkit的pkexec helper

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-13272 漏洞存在于 Linux kernel 5.1.17 之前的版本中，`kernel/ptrace.c` 中的 `ptrace_link` 函数在处理进程创建 ptrace 关系时的凭据记录时存在问题。攻击者可以利用父子进程关系，其中父进程放弃权限并调用 `execve`（可能允许攻击者控制）来获取 root 权限。

**有效性：**

漏洞库信息和搜索结果都确认了该漏洞的存在以及利用的可能。漏洞描述明确指出可以利用 Polkit 的 `pkexec` helper，结合 `PTRACE_TRACEME` 来提权。 搜索结果中也有提及该漏洞的利用方式和受影响版本。

提供的 Python POC 代码似乎是一个 HTTP 请求发送工具，其发送的POST请求的URI部分存在多个`.%0d.`的序列，这是一种目录穿越攻击的尝试。该POC利用点是向目标服务发送恶意命令。虽然它可能能够利用某些web服务，但它与CVE-2019-13272（Linux Kernel PTRACE_TRACEME）的描述不符。该漏洞是linux内核漏洞，并非web服务漏洞。

总体来说，提供的POC代码与漏洞描述信息不符，大概率**无效**。

**投毒风险：**

该POC代码本身是一个python脚本，主要功能是发送构造的http请求。虽然该脚本可以执行任意命令，但并没有发现明显的恶意行为，例如植入后门、删除文件等。 脚本中可能存在一些隐藏的参数或命令，如果被恶意利用，可能会对系统造成损害。但是，从代码的表面来看，投毒风险较低。 考虑到HTTP请求可以发送任意命令，存在一定的风险，但脚本本身不像是专门用于投毒。

**利用方式：**

1.  **利用 `PTRACE_TRACEME` 和父子进程关系：**  创建一个父进程，该进程首先降低自身权限（例如，切换到非特权用户），然后调用 `execve` 执行另一个程序（可能是攻击者控制的）。
2.  **滥用 `ptrace_link` 的凭据处理逻辑：**  在父进程调用 `execve` 之前，使用 `PTRACE_TRACEME` 建立 ptrace 关系。由于 `ptrace_link` 对凭据的处理存在缺陷，可能导致子进程获得不应有的权限。
3.  **结合 `pkexec` (如果可用):** 利用 polkit 的 `pkexec` 程序，该程序可能允许普通用户以 root 权限执行命令。结合 `PTRACE_TRACEME`，可以绕过 `pkexec` 的权限检查，从而提升权限。

总而言之，该漏洞需要利用父子进程，ptrace机制，以及可能存在的特权helper程序（如pkexec）。攻击者需要精心构造利用链才能成功提权。


**项目地址:** [polosec/CVE-2019-13272](https://github.com/polosec/CVE-2019-13272)

**漏洞详情:** [CVE-2019-13272](https://nvd.nist.gov/vuln/detail/CVE-2019-13272)