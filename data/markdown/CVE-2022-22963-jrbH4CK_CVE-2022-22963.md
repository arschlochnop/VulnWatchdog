## CVE-2022-22963-Spring Cloud Function-远程代码执行

**漏洞编号:** CVE-2022-22963

**漏洞类型:** 远程代码执行

**影响应用:** Spring Cloud Function

**危害等级:** 高危，可能导致远程代码执行和访问本地资源

**影响版本:** Spring Cloud Function versions 3.1.6, 3.2.2 以及所有旧的和不受支持的版本

**利用条件:** 需要目标应用使用Spring Cloud Function的路由功能，且对外开放网络端口。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22963 是 Spring Cloud Function 中存在的一个远程代码执行漏洞。当使用路由功能时，攻击者可以通过提供一个特制的 SpEL 表达式作为路由表达式，导致远程代码执行和访问本地资源。\n\n**有效性：** 提供的POC代码看起来是有效的。它通过发送包含恶意SpEL表达式的POST请求到 `/functionRouter` 路径来利用此漏洞。这个SpEL表达式用于执行命令，首先下载一个反弹shell脚本，然后赋予执行权限，最后执行该脚本。搜索结果也表明此漏洞可以被远程利用且无需身份验证。\n\n**投毒风险：**  代码中存在轻微的投毒风险。`springCloud.sh` 脚本从攻击者的服务器下载 `rs.sh` 文件，这意味着攻击者可以随时更改 `rs.sh` 的内容，从而在不知情的情况下执行恶意代码。虽然提供的PoC本身只是反弹shell，但攻击者可以轻易地替换为更具破坏性的命令。例如，脚本可以被修改为删除文件或安装后门。但由于脚本功能相对简单且目标明确，主要风险在于下载的 `rs.sh` 文件内容可变，因此投毒风险估计为 10%。\n\n**利用方式：** 漏洞利用方式如下：\n1.  攻击者构造一个包含恶意 SpEL 表达式的 HTTP POST 请求。\n2.  该请求被发送到启用了 Spring Cloud Function 路由功能的应用程序的 `/functionRouter` 路径。\n3.  SpEL 表达式被解析和执行，从而允许攻击者执行任意命令。\n4.  POC代码中，攻击者使用SpEL表达式下载、赋予执行权限并执行一个反弹shell脚本，从而获得对目标系统的shell访问权限。

**项目地址:** [jrbH4CK/CVE-2022-22963](https://github.com/jrbH4CK/CVE-2022-22963)

**漏洞详情:** [CVE-2022-22963](https://nvd.nist.gov/vuln/detail/CVE-2022-22963)