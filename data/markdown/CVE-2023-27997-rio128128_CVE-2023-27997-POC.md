## CVE-2023-27997 - FortiOS SSL-VPN 堆缓冲区溢出

**漏洞编号:** CVE-2023-27997

**漏洞类型:** 堆缓冲区溢出

**影响应用:** FortiOS, FortiProxy

**危害等级:** 严重，远程代码执行

**影响版本:** FortiOS: <= 7.2.4, <= 7.0.11, <= 6.4.12, <= 6.0.16; FortiProxy: <= 7.2.3, <= 7.0.9, <= 2.0.12, <= 1.2.13, <= 1.1.6

**利用条件:** 需要目标系统开启SSL-VPN服务，且版本在受影响范围内。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-27997是FortiOS和FortiProxy SSL-VPN中的一个堆缓冲区溢出漏洞。未经验证的远程攻击者可以通过发送特制的请求来利用此漏洞，从而实现远程代码执行。

**有效性：**

根据漏洞信息和搜索结果，该漏洞是真实存在的，并且已经被广泛利用。 BishopFox的博客提供了漏洞利用的详细分析和PoC。提供的Python脚本尝试利用此漏洞进行远程代码执行。

**投毒风险：**

该脚本包含一个反向shell功能，如果成功利用，将在目标系统上执行shell，并将shell连接到攻击者指定的IP地址和端口。 这不是漏洞本身的特性，而是PoC的后利用阶段，不能称之为投毒。 该脚本依赖于硬编码的地址`hardcoded = 0x00007fc5f128e000`， 这使得exploit的可靠性降低, 如果该地址在目标系统上不正确，则漏洞利用将失败。Content-Length 非常大，可能导致拒绝服务，增加了风险。
尽管如此，该脚本本身并没有明显的恶意代码，但存在被篡改的风险，因此投毒风险评估为10%。风险主要在于使用者可能不理解代码的全部功能，直接使用导致安全问题。反向shell功能如果被滥用，则可能导致严重的后果。

**利用方式：**

1.  **漏洞触发：** 攻击者发送一个特制的HTTP POST请求到目标系统的`/remote/error`端点。
2.  **缓冲区溢出：** 该请求包含一个超长的payload，导致在堆内存中发生缓冲区溢出。
3.  **ROP链执行：** 溢出数据覆盖堆上的内存，包括返回地址，攻击者通过ROP链控制程序执行流程，执行`execve`系统调用。
4.  **反向Shell：** `execve`调用执行/bin/python脚本，该脚本会连接到攻击者指定的IP地址和端口，从而建立反向shell连接。
5.  **参数传递：** 通过构造内存中的参数，python执行包含reverse shell的命令。

**项目地址:** [rio128128/CVE-2023-27997-POC](https://github.com/rio128128/CVE-2023-27997-POC)

**漏洞详情:** [CVE-2023-27997](https://nvd.nist.gov/vuln/detail/CVE-2023-27997)