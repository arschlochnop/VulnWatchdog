## CVE-2019-12185-eLabFTW-任意文件上传

**漏洞编号:** CVE-2019-12185

**漏洞类型:** 任意文件上传

**影响应用:** eLabFTW

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 1.8.5

**利用条件:** 需要用户账号，可通过登录获取

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

该漏洞存在于eLabFTW 1.8.5的/app/controllers/EntityController.php组件中。攻击者可以利用已有的用户账户，通过POST请求上传任意文件，从而实现远程代码执行。

**有效性分析：**

根据漏洞描述和提供的漏洞利用代码，该漏洞的有效性较高。漏洞利用代码演示了如何构造恶意请求，上传包含PHP代码的文件到服务器的web根目录，并通过访问该文件执行任意命令。

**投毒风险分析：**

漏洞利用代码本身不包含明显的投毒代码。代码的主要功能是利用文件上传漏洞，上传包含恶意PHP代码的文件。该PHP代码（`<?php echo shell_exec($_GET['e'].' 2>&1'); ?>`）的功能是执行通过GET请求传递的系统命令。没有发现作者隐藏其他恶意行为。

**利用方式分析：**

1.  **身份验证：** 首先，攻击者需要拥有eLabFTW的用户账号。如果无法注册，可能需要暴力破解或者利用其他漏洞获取有效账户。
2.  **构造恶意请求：** 攻击者使用POST请求，将包含PHP代码的文件上传到`/app/controllers/EntityController.php`。请求的`Content-Disposition`头部需要正确设置，以绕过文件类型检查。
3.  **远程代码执行：** 上传成功后，攻击者可以通过访问上传的PHP文件，执行任意系统命令。利用代码中，PHP文件名为`poc3.php5`，通过GET参数`e`传递要执行的命令。
4.  **利用EXP:** EXP首先尝试登录系统。登录成功后，它会构建一个multipart/form-data请求，其中包含要上传的PHP文件。这个PHP文件包含执行系统命令的代码。EXP然后将这个请求发送到/app/controllers/EntityController.php端点。如果上传成功，EXP会尝试执行一个简单的系统命令（“id”）来验证代码执行。

**总结：**

CVE-2019-12185是一个严重的安全漏洞，攻击者可以利用该漏洞完全控制受影响的eLabFTW服务器。提供的POC代码具有较高的有效性，并且没有发现明显的投毒风险。系统管理员应尽快升级到安全版本，或采取其他缓解措施，以防止攻击。

**项目地址:** [Drew-Alleman/CVE-2019-12185](https://github.com/Drew-Alleman/CVE-2019-12185)

**漏洞详情:** [CVE-2019-12185](https://nvd.nist.gov/vuln/detail/CVE-2019-12185)