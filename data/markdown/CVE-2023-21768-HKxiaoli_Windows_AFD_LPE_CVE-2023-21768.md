## CVE-2023-21768 Windows AFD LPE

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 本地提权

**影响应用:** Windows AFD Driver

**危害等级:** 高危，允许低权限用户提升到 SYSTEM 权限

**影响版本:** Windows Server 2022 (<= 10.0.20348.1487), Windows 11 21H2 (<= 10.0.22000.1455), Windows 11 22H2 (<= 10.0.22621.1105)

**利用条件:** 需要本地访问权限。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-21768 是 Windows Ancillary Function Driver (AFD) 中存在的一个本地提权漏洞。根据漏洞信息和搜索结果，该漏洞影响 Windows Server 2022 和 Windows 11 的特定版本。攻击者可以利用此漏洞，从低权限用户提升到 SYSTEM 权限，从而完全控制受影响的系统。

**有效性：**

根据搜索结果，特别是来自 GitHub 的链接（[https://github.com/Malwareman007/CVE-2023-21768](https://github.com/Malwareman007/CVE-2023-21768)），存在完整的漏洞利用代码。提供的 POC 代码包括一个 Visual Studio 解决方案，其中包含利用漏洞的代码。`README.md` 文件表明，完整的漏洞利用程序可以在易受攻击的 Windows 11 22H2 系统上运行，并且写入原语适用于所有易受攻击的系统。因此，可以认为提供的 POC 代码是有效的。

**投毒风险：**

虽然无法完全排除投毒风险，但根据现有信息判断，该风险相对较低。原因如下：

*   **代码复杂性：**漏洞利用代码相对复杂，需要编译和执行，增加了投毒的难度。
*   **公开可用性：**该漏洞的 POC 代码已在 GitHub 上公开，这意味着其他人可以审查代码并查找潜在的恶意行为。
*   **作者信誉：**虽然无法完全确定作者的信誉，但作者在 `README.md` 文件中提供了 Twitter 链接，这表明他们愿意公开身份。

尽管如此，仍然存在一些潜在的投毒风险：

*   **隐藏后门：**攻击者可能会在代码中隐藏后门，这些后门在正常使用过程中可能不会被发现。例如，可能会在编译过程中插入额外的恶意代码。
*   **依赖项：**该漏洞利用程序可能依赖于其他库或组件，这些库或组件可能包含恶意代码。

综合考虑，保守估计投毒风险为10%。

**利用方式：**

该漏洞的利用方式如下：

1.  **获取目标进程的 PID：**攻击者需要知道他们想要提升权限的进程的 PID。
2.  **运行漏洞利用程序：**攻击者运行编译后的漏洞利用程序，并将目标进程的 PID 作为参数传递给它。
3.  **提权：**漏洞利用程序利用 AFD 驱动程序中的漏洞，将目标进程的权限提升到 SYSTEM 权限。
4.  **执行恶意代码：**攻击者现在可以在 SYSTEM 权限下执行恶意代码，从而完全控制受影响的系统。

总之，CVE-2023-21768 是一个严重的安全漏洞，攻击者可以利用它来完全控制受影响的系统。建议尽快应用 Microsoft 提供的安全补丁。

**项目地址:** [HKxiaoli/Windows_AFD_LPE_CVE-2023-21768](https://github.com/HKxiaoli/Windows_AFD_LPE_CVE-2023-21768)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)