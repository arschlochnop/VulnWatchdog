## CVE-2025-31129-jooby-pac4j-反序列化漏洞

**漏洞编号:** CVE-2025-31129

**漏洞类型:** 反序列化漏洞

**影响应用:** jooby-pac4j

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** < 2.17.0 (2.x) and < 3.7.0 (3.x)

**利用条件:** 需要用户交互（点击恶意链接等）

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2025-31129 是一个存在于 jooby-project jooby 的 pac4j 模块中的反序列化漏洞。该漏洞位于 io.jooby.internal.pac4j.SessionStoreImpl#get 模块，由于其反序列化不可信数据而导致。攻击者可以利用此漏洞在目标系统上执行任意代码。

**有效性分析：**

根据漏洞库信息和搜索引擎结果，该漏洞已被确认为真实存在，并且有修复版本发布。提供的 POC 代码包含一个 Maven 项目，使用了 commons-collections 3.2.1 依赖。`Main.java` 包含了利用 `commons-collections` 库构建反序列化链的代码，用于在目标系统上执行任意代码。

**投毒风险分析：**

分析 POC 代码，发现以下潜在投毒点：

*   **ClassLoader:** 代码中没有直接操作ClassLoader的代码，但反序列化漏洞本身就可能被用于加载恶意的类，从而达到投毒的目的。
*   **恶意类文件加载：** 代码 `byte[] data=Files.readAllBytes(Paths.get("/path/to/evilclass"));` 通过读取本地文件 `/path/to/evilclass` 的内容，这部分存在潜在的风险。如果该路径指向的文件被替换为恶意类，则可能导致 RCE。虽然代码里包含shellinject相关的字符串，但整体更像是exp模版，`/path/to/evilclass` 是需要使用者填充的。

总体而言，此POC更多依赖使用者提供恶意的class，而不是直接在POC中投毒。

**利用方式：**

1.  **漏洞触发：** 攻击者需要找到 jooby-pac4j 应用中处理 session 的地方，并能够向其中写入恶意序列化数据。
2.  **构造恶意序列化数据：** 利用 `commons-collections` 库或其他 gadget 链，构造包含恶意指令的序列化数据。该数据会指示目标 JVM 执行特定的操作，例如执行系统命令，下载并执行恶意代码等。
3.  **发送恶意请求：** 攻击者需要构造包含恶意序列化数据的 HTTP 请求，并发送到目标 jooby-pac4j 应用。
4.  **反序列化触发：** jooby-pac4j 应用在处理请求时，会反序列化 session 中的数据。如果 session 中包含攻击者构造的恶意序列化数据，则会触发反序列化漏洞，导致任意代码执行。

由于该漏洞涉及到反序列化，并且需要用户交互，因此建议及时升级到安全版本。


**项目地址:** [cwm1123/CVE-2025-31129](https://github.com/cwm1123/CVE-2025-31129)

**漏洞详情:** [CVE-2025-31129](https://nvd.nist.gov/vuln/detail/CVE-2025-31129)