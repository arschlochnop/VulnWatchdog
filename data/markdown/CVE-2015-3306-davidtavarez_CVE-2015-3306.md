## CVE-2015-3306 ProFTPD mod_copy 远程命令执行

**漏洞编号:** CVE-2015-3306

**漏洞类型:** 远程命令执行

**影响应用:** ProFTPD

**危害等级:** 高危，可能导致任意文件读取、写入以及远程代码执行

**影响版本:** 1.3.5 (受影响版本，但根据测试信息可能影响其他版本，如1.3.4a)

**利用条件:** 目标服务器运行ProFTPD服务，且启用了mod_copy模块，攻击者需要能够通过FTP协议连接目标服务器

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2015-3306 漏洞存在于 ProFTPD 1.3.5 的 mod_copy 模块中。该模块允许远程攻击者利用 `SITE CPFR` 和 `SITE CPTO` 命令读取和写入任意文件，从而导致远程代码执行。根据提供的PoC代码，攻击者首先尝试连接目标服务器的FTP服务。接着，PoC利用`site cpfr /etc/passwd`读取敏感文件，然后尝试用恶意PHP代码覆盖它。如果目标路径不允许覆盖，该PoC会尝试读取`/proc/self/fd/3`，并将其内容通过 `site cpto` 写入到Web目录中一个可访问的PHP文件中。最后，通过HTTP请求访问该PHP文件，并传递`cmd`参数来执行任意命令。由于PoC下载的是`/proc/self/fd/3`的内容，因此可以判断为验证型代码，而非后门代码。

**有效性评估：**
根据漏洞描述和PoC代码，以及搜索引擎的结果，该漏洞的利用是有效的。PoC代码中针对Web服务器的存在性进行了检测，也说明了该漏洞是能够利用的。

**投毒风险评估：**
代码主要逻辑为利用漏洞进行文件复制，最终执行命令。没有发现植入恶意后门或进行其他恶意操作的代码，因此，投毒风险为0%。

**利用方式：**
1.  利用`SITE CPFR`命令指定源文件，可以为`/etc/passwd`或者`/proc/self/fd/3`。
2.  利用`SITE CPTO`命令指定目标文件，将源文件内容复制到目标文件，目标文件必须位于web目录下，以便后续可以通过http访问。
3.  通过构造HTTP GET请求，访问上传的php文件，并执行命令。

**项目地址:** [davidtavarez/CVE-2015-3306](https://github.com/davidtavarez/CVE-2015-3306)

**漏洞详情:** [CVE-2015-3306](https://nvd.nist.gov/vuln/detail/CVE-2015-3306)