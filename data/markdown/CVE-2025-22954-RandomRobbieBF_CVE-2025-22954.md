## CVE-2025-22954-Koha-SQL注入

**漏洞编号:** CVE-2025-22954

**漏洞类型:** SQL注入

**影响应用:** Koha

**危害等级:** 高危，可能导致数据泄露和远程代码执行

**影响版本:** < 24.11.02

**利用条件:** 需要具有访问 `/serials/lateissues-export.pl` 脚本的权限 (需要登录验证，但文档中说明是authenticated user)

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2025-22954 是一个存在于 Koha 24.11.02 之前版本的 SQL 注入漏洞，位于 `C4/Serials.pm` 模块的 `GetLateOrMissingIssues` 函数中。攻击者可以通过操纵 `/serials/lateissues-export.pl` 脚本中的 `supplierid` 或 `serialid` 参数来利用此漏洞。

**有效性：**
提供的PoC代码有效。漏洞库信息和搜索引擎结果均表明此漏洞存在，且 PoC 代码给出了可行的利用方法，包括直接构造 HTTP 请求、使用 curl 命令以及利用 SQLMap 工具。SQLMap利用的示例已经很详细。

**投毒风险：**
PoC 代码主要包含漏洞利用的示例，没有发现明显的投毒代码。README.md 文件只是描述了漏洞和利用方法。因此，投毒风险较低。但是需要注意，任何下载和执行的代码都存在潜在风险，应该进行安全审查。风险预估为1%，因为无法完全排除在描述性文本或注释中隐藏恶意代码的可能性。

**利用方式：**
1.  **确定目标：** 找到一个运行着存在漏洞的 Koha 版本的系统。
2.  **构造恶意 HTTP 请求：**  通过 GET 请求 `/serials/lateissues-export.pl`，并在 `supplierid` 参数中注入恶意的 SQL 代码。例如：`supplierid=1' UNION SELECT 1,2,3,4,5,6,7,8,9,10,11,12,user(),14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30 -- -`。
3.  **使用 curl：** 使用 curl 命令发送包含恶意 SQL 注入的 HTTP 请求。
4.  **使用 SQLMap：** 利用 SQLMap 自动化漏洞利用过程。首先，捕获一个包含有效身份验证 cookie 的请求，然后使用 SQLMap 的 `-r` 参数指定请求文件，并使用 `-p supplierid` 参数指定注入点。或者，可以直接使用 `-u` 参数指定 URL，并通过 `--dump` 参数提取数据。
5.  **数据提取/控制：** 成功利用该漏洞后，攻击者可以提取数据库中的敏感数据（如用户名、密码哈希等），或者在某些情况下，甚至可以执行任意代码，从而完全控制系统。攻击者可以通过`user()`函数，来获取数据库当前用户，判断当前用户的权限，利用高权限用户来提权，达到控制系统的目的。

**项目地址:** [RandomRobbieBF/CVE-2025-22954](https://github.com/RandomRobbieBF/CVE-2025-22954)

**漏洞详情:** [CVE-2025-22954](https://nvd.nist.gov/vuln/detail/CVE-2025-22954)