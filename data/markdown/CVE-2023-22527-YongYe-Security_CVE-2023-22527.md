## CVE-2023-22527-Confluence-远程代码执行

**漏洞编号:** CVE-2023-22527

**漏洞类型:** 模板注入/OGNL注入

**影响应用:** Atlassian Confluence Server/Data Center

**危害等级:** 高危，允许未授权的远程代码执行

**影响版本:** 8.0.0 <= version < 8.5.4

**利用条件:** 需要网络访问，目标Confluence实例版本在受影响范围内。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-22527是一个存在于Atlassian Confluence Server和Data Center的模板注入漏洞，攻击者可以利用该漏洞在未经身份验证的情况下执行任意代码。漏洞位于`text-inline.vm`模板中，攻击者通过构造包含恶意OGNL表达式的请求，利用`#request['.KEY_velocity.struts2.context'].internalGet('ognl').findValue`来执行命令。  

**有效性：**
根据漏洞库信息、搜索引擎结果（例如NVD、Rapid7、ProjectDiscovery、TrendMicro等）和提供的PoC代码，可以确认该漏洞是真实存在的，并且PoC代码是有效的。PoC代码通过发送包含恶意OGNL表达式的POST请求到`/template/aui/text-inline.vm`端点，从而实现远程代码执行。

**投毒风险：**
PoC代码本身存在一定的风险。虽然该PoC直接利用了漏洞实现RCE，但是批量扫描脚本会向目标系统发送恶意请求,造成不必要的扫描日志。`README.md`声明"I am not responsible for any illegal attacks"，但无法完全排除作者故意留下后门的可能性。考虑到代码的功能集中于漏洞利用，并且代码量不大，易于审查，故投毒风险较低，评估为10%。

**利用方式：**
1.  目标系统必须运行受影响的Confluence版本（8.0.0 <= version < 8.5.4）。
2.  攻击者构造包含恶意OGNL表达式的POST请求，发送到`/template/aui/text-inline.vm`端点。
3.  恶意OGNL表达式利用`#request['.KEY_velocity.struts2.context'].internalGet('ognl').findValue`执行任意命令。
4.  服务器执行命令，并通过`X-Cmd-Response` header返回结果。

提供的PoC代码包含以下关键步骤：
1.  **版本检测:**  PoC首先尝试获取Confluence版本。
2.  **漏洞利用:** 如果版本在受影响范围内，则构造包含恶意OGNL表达式的HTTP POST请求。
3.  **命令执行:**  恶意OGNL表达式会触发命令执行，并将输出写入HTTP响应头。
4. **结果保存:** 将成功利用的URL保存在result.txt中

**项目地址:** [YongYe-Security/CVE-2023-22527](https://github.com/YongYe-Security/CVE-2023-22527)

**漏洞详情:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)