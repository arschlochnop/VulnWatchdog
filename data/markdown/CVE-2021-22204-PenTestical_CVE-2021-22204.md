## CVE-2021-22204 - ExifTool DjVu Arbitrary Code Execution

**漏洞编号:** CVE-2021-22204

**漏洞类型:** 代码注入

**影响应用:** ExifTool

**危害等级:** 高危，允许远程代码执行

**影响版本:** >=7.44, <12.24

**利用条件:** 需要目标系统安装了存在漏洞版本的ExifTool，且用户使用ExifTool处理恶意构造的DjVu文件。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-22204是ExifTool中DjVu文件解析模块存在的一个代码注入漏洞。攻击者可以构造包含恶意Perl代码的DjVu文件，当ExifTool解析该文件时，恶意代码会被执行，从而导致任意代码执行。

**有效性：**
提供的POC代码利用了DjVu文件格式解析的漏洞，通过在DjVu文件中嵌入恶意的Perl代码来实现远程代码执行。`createFile.sh` 脚本创建了一个恶意的 `shell.djvu` 文件，该文件包含一个反向shell的Payload。如果目标系统使用存在漏洞版本的ExifTool处理此文件，则攻击者能够获得一个shell。

**投毒风险：**
分析提供的 `LICENSE`, `README.md`, `createFile.sh` 文件，没有发现明显的投毒代码。 `createFile.sh` 脚本的功能是生成包含payload的 DjVu 文件。 该脚本仅包含构造漏洞利用的必要代码，没有发现任何试图在目标系统上安装后门或执行其他恶意操作的迹象。

**利用方式：**
1.  攻击者需要替换 `createFile.sh` 脚本中的IP地址（默认为`10.10.10.10`）为攻击者自己的IP地址。
2.  运行 `createFile.sh` 脚本，生成恶意的 `shell.djvu` 文件。
3.  将 `shell.djvu` 文件发送给目标用户。
4.  诱导目标用户使用存在漏洞的ExifTool版本处理 `shell.djvu` 文件（例如，使用 `sudo /usr/local/bin/exiftool shell.djvu` 命令）。
5.  攻击者在其监听端口（默认为4444）上接收反向shell连接。

需要注意的是，POC中的注释表明，为了成功利用此漏洞，ExifTool需要以root权限运行（例如使用`sudo`）。 这是由于反向shell Payload需要提升的权限才能执行某些操作。


**项目地址:** [PenTestical/CVE-2021-22204](https://github.com/PenTestical/CVE-2021-22204)

**漏洞详情:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)