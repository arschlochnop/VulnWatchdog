## CVE-2023-45866-BlueZ-蓝牙HID注入

**漏洞编号:** CVE-2023-45866

**漏洞类型:** 蓝牙HID注入

**影响应用:** BlueZ

**危害等级:** 高危，允许未授权的蓝牙HID设备注入键盘事件，可能导致任意命令执行

**影响版本:** 5.64-0ubuntu1 (Ubuntu 22.04LTS)等受影响版本

**利用条件:** 攻击者需要在蓝牙通信范围内，目标设备开启蓝牙功能且未采取CVE-2020-0556的缓解措施。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-45866 允许未认证的蓝牙外围设备 (Peripheral role HID Device) 发起并建立加密连接，并接收 HID 键盘报告。攻击者可以伪装成蓝牙键盘，在没有用户交互的情况下向主机注入 HID 消息，例如键盘按键，从而执行任意命令。 

**有效性评估：**
根据漏洞信息和搜索引擎结果，该漏洞利用的关键在于绕过蓝牙配对认证，从而模拟键盘输入。提供的Python脚本`BluetoothDucky.py`尝试自动化此过程。脚本通过以下步骤利用漏洞：

1.  **蓝牙适配器初始化：** 重启蓝牙服务，配置适配器名称和类别。
2.  **HID Profile注册：** 注册HID profile，使系统认为该设备是HID设备。
3.  **连接目标设备：** 尝试连接目标设备的SDP服务，并进行配对。
4.  **HID连接：** 连接HID中断和控制端口。
5.  **Payload执行：** 从指定文件读取Ducky脚本，并将其转换为HID键盘报告发送到目标设备。

根据搜索结果，该漏洞影响包括Android、iOS和Linux等多个平台。因此，如果脚本能够成功建立蓝牙连接并绕过认证，则漏洞利用应该是有效的。

**投毒风险分析：**
分析提供的Python脚本 `BluetoothDucky.py`，未发现明显的恶意代码或后门。脚本主要功能是模拟蓝牙键盘并发送预定义的按键序列。

以下是未发现明显投毒代码的理由：

*   脚本的主要功能是模拟键盘输入，逻辑清晰。
*   脚本依赖于标准的Python库和Linux工具 (例如 `bluetooth`, `hcitool`)。
*   脚本没有尝试访问本地文件系统、网络连接或执行其他可疑操作。
*   `injector` 目录下的文件需要进一步分析, 但当前的代码片段没有展示出恶意行为。

虽然没有发现明显的投毒代码，但仍存在以下潜在风险：

*   Ducky脚本本身可能包含恶意命令，例如下载和执行恶意软件。这取决于攻击者提供的payload。
*   脚本的依赖项 (例如 `injector` 目录下的模块) 可能包含漏洞或恶意代码。由于没有提供完整代码，无法进行全面分析。
*   脚本的实现可能存在缺陷，导致意外行为或安全问题。

综合考虑，投毒风险较低，但不能完全排除。给予10%的投毒风险评估。

**利用方式：**

1.  **扫描目标设备：** 使用蓝牙扫描工具 (例如 `bluetooth.discover_devices`) 查找附近的蓝牙设备。
2.  **配置攻击环境：** 安装必要的Python库 (例如 `pybluez`)，并确保蓝牙适配器正常工作。
3.  **运行攻击脚本：** 运行 `BluetoothDucky.py` 脚本，指定目标设备的蓝牙地址和用于攻击的蓝牙接口。
4.  **建立连接：** 脚本尝试与目标设备建立蓝牙连接，并绕过认证。
5.  **注入键盘事件：** 脚本将Ducky脚本转换为HID键盘报告，并发送到目标设备。

**总结：**
CVE-2023-45866是一个高危漏洞，攻击者可以通过模拟蓝牙键盘注入恶意键盘事件，从而控制目标设备。提供的POC代码具有一定的有效性，但需要进一步测试和验证。投毒风险较低，但不能完全排除。

**项目地址:** [Eason-zz/BluetoothDucky](https://github.com/Eason-zz/BluetoothDucky)

**漏洞详情:** [CVE-2023-45866](https://nvd.nist.gov/vuln/detail/CVE-2023-45866)