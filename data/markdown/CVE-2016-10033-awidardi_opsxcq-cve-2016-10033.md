## CVE-2016-10033-PHPMailer-远程代码执行

**漏洞编号:** CVE-2016-10033

**漏洞类型:** 远程代码执行

**影响应用:** PHPMailer

**危害等级:** 高危，允许远程攻击者执行任意代码

**影响版本:** < 5.2.18

**利用条件:** 目标系统运行存在漏洞的PHPMailer版本，并且使用了isMail传输方式，攻击者能够控制Sender属性

**POC 可用性:** 是

**投毒风险:** 20%

## 详情

CVE-2016-10033是PHPMailer的一个远程代码执行漏洞，存在于5.2.18之前的版本中。该漏洞源于`mailSend`函数在使用`isMail`传输方式时，未正确过滤`Sender`属性，导致攻击者可以通过插入反斜杠双引号（\"）来注入额外的参数到`mail`命令中，从而执行任意代码。

**有效性：**
根据漏洞库信息和搜索引擎结果，该漏洞是真实存在的，并且存在多个公开的PoC代码。 提供的Dockerfile构建了一个存在漏洞的环境，其中安装了apache2、php5、sendmail等必要组件，并将存在漏洞的php代码部署到web服务器，可以通过提供的POC进行验证，因此可以判断提供的POC代码是有效的。

**投毒风险：**
分析提供的Dockerfile和相关文件，发现存在一定的投毒风险，但风险较低。风险主要存在于Dockerfile中使用的`apt-get upgrade -y`命令。虽然这个命令的本意是升级系统软件包，但如果APT源被恶意篡改，则可能安装恶意软件。此外，`chmod 777 -R /www`也可能带来安全隐患，但这是为了方便演示漏洞，不应算作投毒代码。此外，许可证文件是GPL v3，不太可能包含恶意代码。
综上，投毒风险评估为20%。

**利用方式：**
1.  攻击者需要找到使用了存在漏洞的PHPMailer版本的Web应用。
2.  攻击者需要找到或构造一个可以控制PHPMailer `Sender`属性的输入点（例如，联系表单）。
3.  攻击者在`Sender`属性中，插入包含恶意代码的反斜杠双引号，例如：`attacker@example.com -oQ/tmp -X/tmp/shell.php`。
4.  当Web应用调用PHPMailer发送邮件时，PHPMailer会将`Sender`属性传递给`mail`命令。
5.  由于未正确过滤，攻击者注入的参数会被`mail`命令执行，从而在服务器上写入恶意代码文件（例如webshell）。
6.  攻击者通过访问恶意代码文件，执行任意命令，获取服务器控制权。

**项目地址:** [awidardi/opsxcq-cve-2016-10033](https://github.com/awidardi/opsxcq-cve-2016-10033)

**漏洞详情:** [CVE-2016-10033](https://nvd.nist.gov/vuln/detail/CVE-2016-10033)