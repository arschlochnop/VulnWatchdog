## CVE-2023-25690-Apache HTTP Server-HTTP Request Smuggling

**漏洞编号:** CVE-2023-25690

**漏洞类型:** HTTP Request Smuggling

**影响应用:** Apache HTTP Server

**危害等级:** 高危，可能导致绕过访问控制、代理未授权URL、缓存投毒。

**影响版本:** 2.4.0 <= version <= 2.4.55

**利用条件:** 需要启用mod_proxy和RewriteRule/ProxyPassMatch，且RewriteRule/ProxyPassMatch使用非特定模式匹配URL。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-25690是Apache HTTP Server中的一个HTTP请求走私漏洞，存在于mod_proxy模块的配置中。当mod_proxy与RewriteRule或ProxyPassMatch一起使用时，如果RewriteRule或ProxyPassMatch中的模式匹配部分用户提供的请求目标（URL）数据，并且该数据被重新插入到代理的请求目标中使用变量替换，则会受到影响。

**漏洞利用方式：**

1.  攻击者构造包含特殊字符（如CRLF序列）的HTTP请求。
2.  利用RewriteRule或ProxyPassMatch的非特定匹配模式，将恶意构造的URL的一部分传递到后端服务器。
3.  通过注入CRLF序列，走私额外的HTTP请求。
4.  这些走私的请求可以绕过代理服务器的访问控制，将未预期的URL代理到现有源服务器，或者进行缓存投毒。

**POC有效性：**

根据提供的漏洞信息、搜索结果和漏洞利用代码，该POC代码是有效的。POC代码通过构造特殊的HTTP请求，利用`mod_proxy`和`mod_rewrite`的配置缺陷，实现了HTTP请求走私。

**投毒风险：**

代码本身存在一定投毒风险，例如，`pre.txt`的内容可以被恶意修改，从而导致利用失败或引入其他漏洞。脚本通过读取外部文件“pre.txt”来构造payload，如果攻击者能够控制该文件，则可以植入恶意代码或篡改请求，对服务器或用户造成损害。此外，虽然脚本看起来像是为了演示漏洞，但如果被恶意修改，可以用于进行实际的攻击，因此存在潜在的风险。

具体分析如下：

*   `request_prepare`函数从`pre.txt`读取数据，并对其进行URL编码。如果`pre.txt`包含恶意代码，则可能导致请求走私攻击。
*   `send_and_recive`函数发送构造的请求并接收响应。此函数本身没有恶意代码，但它用于发送由`request_prepare`函数准备的请求，因此受到`pre.txt`内容的影响。

总体来说，该POC代码存在一定的投毒风险，但主要取决于`pre.txt`的内容。需要仔细审查`pre.txt`文件，并采取适当的安全措施来防止恶意利用。

**项目地址:** [thanhlam-attt/CVE-2023-25690](https://github.com/thanhlam-attt/CVE-2023-25690)

**漏洞详情:** [CVE-2023-25690](https://nvd.nist.gov/vuln/detail/CVE-2023-25690)