## CVE-2023-45878-GibbonEdu-任意文件写入

**漏洞编号:** CVE-2023-45878

**漏洞类型:** 任意文件写入

**影响应用:** GibbonEdu

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** <= 25.0.1

**利用条件:** 需要目标系统运行GibbonEdu，且漏洞页面可访问。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-45878是GibbonEdu 25.0.1及之前版本中的一个任意文件写入漏洞。该漏洞位于`rubrics_visualise_saveAjax.php`，该文件无需身份验证即可访问。攻击者可以通过POST请求，利用`img`、`path`和`gibbonPersonID`参数，将恶意PHP代码写入服务器上的任意位置。其中`img`参数是base64编码的图像数据，`path`参数指定写入的文件路径，与安装目录的绝对路径连接。攻击者可以利用这个漏洞上传webshell，从而实现远程代码执行。

**有效性：**
提供的POC代码有效。从搜索引擎结果和漏洞库信息来看，该漏洞允许未授权用户写入任意文件，结合POC代码，其利用方式是通过构造特定的POST请求，将包含PHP恶意代码的base64编码数据写入指定的文件路径。POC代码中包含用于生成Windows反向shell的powershell脚本。

**投毒风险：**
POC代码的投毒风险较低，约为10%。主要风险点在于：
1.  **powershell脚本:**POC代码中生成了Windows反向shell的powershell脚本,如果目标环境并非预期，可能会导致攻击者在不知情的情况下连接到恶意服务器。
2.  **文件服务器:**POC运行了一个文件服务器，可能存在其他安全问题，虽然代码里只是用来传输powershell脚本,仍然存在一定风险

**利用方式：**
1.  目标系统运行GibbonEdu 25.0.1或更早版本。
2.  攻击者通过POST请求访问`rubrics_visualise_saveAjax.php`，构造恶意的`img`和`path`参数。
3.  `img`参数包含base64编码的PHP恶意代码，例如`<?php echo system($_GET['cmd']); ?>`，`path`参数指定webshell的文件名，例如`shell.php`。
4.  服务器将解码后的PHP代码写入指定的文件路径，例如`/modules/Rubrics/shell.php`。
5.  攻击者通过访问`/modules/Rubrics/shell.php?cmd=恶意命令`执行任意命令。
6. POC生成一个powershell脚本用于反向连接，并通过建立http服务供目标服务器下载
7.  POC利用webshell执行powershell命令，从http服务下载生成的powershell脚本。

**项目地址:** [nrazv/CVE-2023-45878](https://github.com/nrazv/CVE-2023-45878)

**漏洞详情:** [CVE-2023-45878](https://nvd.nist.gov/vuln/detail/CVE-2023-45878)