## CVE-2024-4367: PDF.js 任意JavaScript执行漏洞

**漏洞编号:** CVE-2024-4367

**漏洞类型:** 任意JavaScript执行

**影响应用:** Firefox, Firefox ESR, Thunderbird (通过PDF.js)

**危害等级:** 高危，可能导致XSS攻击，窃取用户数据，甚至远程代码执行

**影响版本:** Firefox < 126, Firefox ESR < 115.11, Thunderbird < 115.11

**利用条件:** 用户需要打开恶意的PDF文件

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2024-4367是PDF.js中的一个漏洞，由于缺少对字体处理的类型检查，允许在PDF.js上下文中执行任意JavaScript代码。攻击者可以构造恶意的PDF文件，当用户使用受影响的Firefox、Firefox ESR或Thunderbird版本打开该文件时，嵌入的JavaScript代码会被执行。  

**有效性评估：**  提供的POC代码看起来是有效的。`README.md` 文件提供了漏洞的概述、利用方法、缓解措施和详细分析的链接。`poc.py` 脚本用于生成包含恶意payload的PDF文件。`app` 目录包含一个简单的Node.js应用，用于本地测试，允许上传PDF文件并通过`pdfjs-dist`库进行渲染。  `public/index.html` 包含前端代码，用于上传PDF并使用`pdf.js`进行渲染。  

**投毒风险评估：**  
*   查看 `poc.pdf` 确认是否植入后门，`poc.pdf` 是恶意的PDF， 利用了字体的解析漏洞，执行Javascript代码。 但是不属于后门，只属于poc验证的一部分
*   查看 `server.js` 中间件是否包含恶意代码，`server.js` 中间件属于正常的express上传pdf和打开pdf的逻辑。
*   查看 `public/index.html` 确认是否调用恶意api， `public/index.html`属于前端代码，用于上传pdf，并渲染pdf，没有恶意api调用。
*   查看 `poc.py` 确认是否生成了恶意PDF，`poc.py`属于poc验证的一部分
总体判断投毒风险极低，可能存在的风险是依赖包的供应链投毒风险,考虑到node_modules体积巨大，人工审计成本太高，所以认为存在 1% 的潜在投毒风险。

**利用方式分析：**
1.  攻击者使用 `poc.py` 脚本生成包含恶意JavaScript代码的PDF文件。
2.  攻击者通过各种手段（例如，电子邮件、网站链接）诱使用户打开该PDF文件。
3.  如果用户使用受影响的Firefox、Firefox ESR或Thunderbird版本打开该PDF文件，PDF.js会解析该文件。
4.  由于缺少类型检查，恶意的JavaScript代码会在PDF.js的上下文中执行，从而实现XSS攻击或潜在的远程代码执行。
5.  攻击者可以利用执行的JavaScript代码窃取用户的敏感信息、修改网页内容，甚至控制用户的计算机。

**项目地址:** [Masamuneee/CVE-2024-4367-Analysis](https://github.com/Masamuneee/CVE-2024-4367-Analysis)

**漏洞详情:** [CVE-2024-4367](https://nvd.nist.gov/vuln/detail/CVE-2024-4367)