## CVE-2024-36401-GeoServer-RCE

**漏洞编号:** CVE-2024-36401

**漏洞类型:** 远程代码执行

**影响应用:** GeoServer

**危害等级:** 高危，未授权的攻击者可以通过构造恶意请求执行任意代码

**影响版本:** 受影响版本： < 2.22.6, >= 2.23.0 且 < 2.23.6, >= 2.24.0 且 < 2.24.4, >= 2.25.0 且 < 2.25.2

**利用条件:** 目标GeoServer实例对外开放且未应用补丁或缓解措施

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-36401 是 GeoServer 中存在的一个远程代码执行 (RCE) 漏洞，由于不安全地将属性名称评估为 XPath 表达式导致。攻击者可以利用此漏洞通过构造特制的OGC请求（如WFS GetFeature, WFS GetPropertyValue, WMS GetMap, WMS GetFeatureInfo, WMS GetLegendGraphic 和 WPS Execute）在目标服务器上执行任意代码。

**有效性：**
根据漏洞信息、搜索引擎结果，特别是CISA的已知被利用漏洞列表，以及提供的利用代码（WoodpeckerPlugin），可以判断此漏洞POC**有效**并且已被积极利用。

**投毒风险：**
提供的 WoodpeckerPlugin 旨在简化漏洞利用过程，但也存在一定投毒风险。风险点在于：
1.  **自定义内存马注入：** 虽然插件提供了默认的冰蝎内存马，但允许用户自定义内存马，如果用户不熟悉内存马，可能引入恶意代码。
2.  **Woodpecker 框架：** 该插件依赖于 Woodpecker 框架，若框架本身存在安全问题，则会影响所有插件。
3.  **源码审查不足：** 用户可能直接使用编译好的插件，而未进行充分的源码审查，增加了潜在的风险。虽然作者声明免责，但是下载来路不明的jar包，本身就存在风险。
4.  **命令执行的安全性：** 通过`command`参数执行任意命令，本身权限过大，存在风险。命令日志记录是否完善，也会影响溯源。
综合评估，投毒风险大约为10%，风险较低，主要集中在用户自定义操作上。

**利用方式：**
1.  **探测：** 使用插件的 Poc 模块进行批量探测，判断目标是否存在 CVE-2024-36401 漏洞。
2.  **命令执行：** 通过 Exploit 模块，设置 `command` 参数执行任意命令。
3.  **内存马注入：** 使用默认或自定义的内存马，注入到 GeoServer 进程中，实现更持久的控制。

**缓解措施：**
1.  升级 GeoServer 到已修复的版本 (>= 2.22.6, >= 2.23.6, >= 2.24.4, >= 2.25.2)。
2.  移除 `gt-complex-x.y.jar` 文件（可能影响部分功能）。
3.  使用防火墙或其他安全设备限制对 GeoServer 的访问。
4.  加强对GeoServer日志的监控，及时发现异常行为。

**项目地址:** [funnyDog896/CVE-2024-36401-WoodpeckerPlugin](https://github.com/funnyDog896/CVE-2024-36401-WoodpeckerPlugin)

**漏洞详情:** [CVE-2024-36401](https://nvd.nist.gov/vuln/detail/CVE-2024-36401)