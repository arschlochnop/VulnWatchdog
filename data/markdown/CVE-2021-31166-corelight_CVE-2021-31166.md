## CVE-2021-31166

**漏洞编号:** CVE-2021-31166

**漏洞类型:** 远程代码执行

**影响应用:** Windows HTTP Protocol Stack (http.sys)

**危害等级:** 高危，远程代码执行

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (版本低于 10.0.19041.982 或 10.0.19042.982)

**利用条件:** 目标系统需要启用HTTP服务，且攻击者能够发送HTTP请求。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-31166 是 Windows HTTP 协议栈 (http.sys) 中的一个远程代码执行漏洞。攻击者可以通过发送特制的 HTTP 请求利用此漏洞，从而在目标系统上执行任意代码。

**有效性：**
根据漏洞库信息，该漏洞的 CVSS 评分高达 9.8，属于危急级别。CISA 将其添加到已知被利用的漏洞目录中，表明该漏洞已被广泛利用。提供的漏洞利用代码包含 Suricata 规则和 Zeek 包，用于检测利用尝试，参考链接中也提供了POC，因此该漏洞利用的有效性较高。

**投毒风险：**
提供的代码主要包含许可证、Makefile、README.md、Suricata规则和Zeek包。这些文件用于检测漏洞利用，而非直接利用漏洞。Makefile 文件看起来是用来构建测试环境或者插件的，但没有实际的构建命令。检测规则本身不太可能包含恶意代码。但仍然存在很小的可能性，例如，Suricata 规则可能存在缺陷，导致误报或其他问题。因此，投毒风险较低，估计为 10%。

**利用方式：**
1.  攻击者构造特制的 HTTP 请求，该请求包含恶意数据在 `ACCEPT-ENCODING` 头中或其他相关字段。
2.  HTTP 协议栈处理该请求时，由于内存管理错误（Use After Free），导致内存损坏。
3.  攻击者可以利用内存损坏执行任意代码。

总的来说，利用方式是通过发送特制的HTTP请求来触发HTTP协议栈中的内存管理错误，进而实现远程代码执行。

**项目地址:** [corelight/CVE-2021-31166](https://github.com/corelight/CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)