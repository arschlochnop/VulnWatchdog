## CVE-2024-32019-netdata-本地提权

**漏洞编号:** CVE-2024-32019

**漏洞类型:** 本地提权

**影响应用:** netdata

**危害等级:** 高危，攻击者可利用此漏洞获取root权限。

**影响版本:** >= 1.45.0, < 1.45.3 和 >= 1.44.0-60, < 1.45.0-169

**利用条件:** 目标系统上运行受影响版本的netdata，且攻击者需要具有本地低权限账号。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-32019 漏洞存在于 netdata 的 ndsudo 工具中，该工具以 root 权限运行，但其搜索路径由 PATH 环境变量控制。攻击者可以通过修改 PATH 环境变量，将恶意程序放置在 ndsudo 搜索路径中，当 ndsudo 调用外部命令时，会执行攻击者放置的恶意程序，从而获得 root 权限。

提供的 POC 代码是一个 C 程序，编译后可以直接执行一个具有 root 权限的 bash shell。攻击者需要首先创建一个包含此恶意程序的可写目录，然后修改 PATH 环境变量，将此目录添加到 PATH 的最前面。之后，当 ndsudo 执行任何外部命令时，都会首先执行攻击者放置的恶意程序，从而获得 root shell。

代码中没有发现明显的投毒行为。它只是简单地设置 uid 和 gid 为 0，然后执行 /bin/bash。因此，投毒风险评估为0%。

利用方式总结：
1.  利用需要先获得一个netdata软件的低权限账号。
2.  创建一个包含恶意程序（例如 POC 中的 C 程序编译后的可执行文件）的可写目录。
3.  修改 PATH 环境变量，将该目录添加到 PATH 的最前面。
4.  触发 ndsudo 执行任何外部命令，这将导致恶意程序以 root 权限执行，从而获得 root shell。

**项目地址:** [x0da6h/POC-for-CVE-2024-32019](https://github.com/x0da6h/POC-for-CVE-2024-32019)

**漏洞详情:** [CVE-2024-32019](https://nvd.nist.gov/vuln/detail/CVE-2024-32019)