## CVE-2025-32463-Sudo-本地提权

**漏洞编号:** CVE-2025-32463

**漏洞类型:** 本地提权

**影响应用:** Sudo

**危害等级:** 高危，允许本地用户获取root权限

**影响版本:** 1.9.14 <= version < 1.9.17p1

**利用条件:** 需要本地用户权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2025-32463是Sudo 1.9.14到1.9.17p1版本中存在的一个本地权限提升漏洞。该漏洞允许本地用户通过`sudo`的`-R` 或 `--chroot`选项，利用用户可控目录下的`/etc/nsswitch.conf`文件，加载攻击者控制的NSS模块，从而以root权限执行任意命令。

**利用方式：**

1.  **漏洞利用代码分析：**
    *   `privesc.sh`脚本首先创建了一个名为`shaolin`的目录，并在该目录下创建了`etc`子目录。然后，它在`shaolin/etc`目录中创建了一个`nsswitch.conf`文件，并将内容设置为`passwd: /shaolin`。这意味着系统将尝试从`/shaolin`路径加载passwd数据库。
    *   脚本还从`/etc/group`复制到 `shaolin/etc`。这可能是为了避免在使用chroot环境时出现问题，因为chroot环境可能缺少必要的系统文件。
    *   接着，使用`gcc`编译`exp.c`文件，生成一个名为`shaolin.so.2`的共享库文件，并将其放置在`libnss_`目录下。
    *   最后，使用`sudo -R shaolin shaolin`命令触发漏洞。这会指示sudo使用`shaolin`目录作为chroot环境，并尝试加载`shaolin.so.2`共享库作为NSS模块。
    *   `exp.c`文件包含一个构造函数`exploit`，该函数会在共享库加载时自动执行。该函数首先设置UID和GID为0，有效地将当前进程提升为root权限。然后，它将当前工作目录更改为`/root`，并执行`/bin/bash`，从而创建一个具有root权限的shell。

2.  **漏洞利用流程：**
    *   攻击者首先需要拥有一个低权限的本地用户帐户。
    *   攻击者执行`privesc.sh`脚本。该脚本会在用户可控的目录下创建一个特制的chroot环境，包含恶意的`nsswitch.conf`文件和一个特制的NSS模块（共享库）。
    *   当`sudo`使用`-R`选项时，会进入该chroot环境，并根据`nsswitch.conf`文件的指示加载攻击者提供的NSS模块。
    *   攻击者提供的NSS模块中的代码会被执行，从而提升权限到root。

3.  **有效性：**
    根据漏洞描述和提供的POC代码，该POC代码如果目标版本在受影响范围内，则该漏洞利用代码是有效的，可以实现本地权限提升。

4. **投毒风险:**
    虽然主要功能是利用漏洞，但仍存在潜在的投毒风险：
    * `privesc.sh`中的mkdir -p shaolin/etc libnss_ 创建目录的操作可能存在命名混淆，但这是漏洞利用的必要步骤，因为需要创建目录来存放恶意nsswitch.conf和共享库文件
    * 脚本中复制/etc/group到chroot环境是避免chroot环境缺失必要文件导致利用失败，不是投毒行为
   虽然该poc的主要目的明显是提权，但依旧有轻微的隐藏和混淆。风险评级为10%。

**项目地址:** [cybershaolin47/CVE-2025-32463_POC](https://github.com/cybershaolin47/CVE-2025-32463_POC)

**漏洞详情:** [CVE-2025-32463](https://nvd.nist.gov/vuln/detail/CVE-2025-32463)