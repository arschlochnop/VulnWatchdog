## CVE-2020-1472 Zerologon 本地提权漏洞

**漏洞编号:** CVE-2020-1472

**漏洞类型:** 特权提升

**影响应用:** Windows Server

**危害等级:** 高危，可能导致域控被完全控制

**影响版本:** 受影响的Windows Server版本包括但不限于2008 R2, 2012, 2012 R2, 2016, 2019, 2004, 1903, 1909, 20H2

**利用条件:** 需要与目标域控制器建立网络连接

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-1472 (Zerologon) 允许未经身份验证的攻击者通过 Netlogon 协议控制域控制器。该漏洞源于 Netlogon 协议中使用的加密算法的缺陷。攻击者通过将客户端凭据设置为全零，可以有效地绕过身份验证，从而冒充域控制器并接管域。提供的POC代码 `zerologon.py` 实现了通过 RPC/SMB 利用此漏洞的验证过程。该脚本通过与域控制器的 Netlogon 服务建立连接，发送全零的 challenge 和 credential 进行身份验证。由于存在漏洞，域控制器会错误地接受这些无效凭据，从而允许攻击者执行特权操作。

**有效性：**

根据提供的漏洞信息、搜索结果和漏洞利用代码，可以判断该POC代码是有效的。搜索结果表明，Zerologon 是一个严重的安全漏洞，可以被利用来完全控制域。提供的POC代码是基于已知的利用方法实现的，通过 Netlogon 协议发送特制的身份验证请求，利用加密算法中的缺陷来绕过身份验证。

**投毒风险：**

评估POC代码是否存在投毒风险，需要仔细分析代码逻辑。代码片段显示，它主要是利用 Netlogon 协议的漏洞，通过发送全零 challenge 和 credential 来绕过身份验证。以下是代码的风险分析：

*   **随机字节** 代码在客户端挑战和客户端凭据中引入了一个随机字节 `finaly_rand_byte = os.urandom(1)`。这主要是为了规避简单的IDS签名检测，并非恶意投毒代码。
*   **条件执行**：脚本包含 `-t` 参数可以选择 RPC 或 SMB 协议进行测试。这并不构成投毒。
*   **impacket库的使用**：代码使用了 `impacket` 库，这是一个常用的网络协议库，本身没有恶意。但是，如果 `impacket` 库被篡改，可能会引入恶意代码。但是从代码本身来看，没有直接的投毒代码存在。

虽然代码本身没有明显的恶意行为，但仍存在一定的风险，例如依赖的库可能存在安全问题，或者代码的某些部分可能被用于恶意目的。因此，将投毒风险评估为10%。

**利用方式：**

1.  **目标识别：** 确定目标域控制器的NetBIOS名称和IP地址。
2.  **连接建立：** 使用RPC/SMB与目标域控制器的Netlogon服务建立连接。
3.  **身份验证绕过：** 通过发送全零的challenge和credential尝试身份验证。POC代码中，`plaintext` 和 `ciphertext` 变量被设置为全零。
4.  **权限提升：** 成功绕过身份验证后，攻击者可以执行特权操作，例如更改域管理员密码、创建新的域管理员账户等。
5.  **域控制：** 最终，攻击者可以完全控制整个域。

请注意，利用此漏洞可能导致严重的后果，包括数据泄露、服务中断等。务必在获得授权的情况下进行测试，并采取必要的安全措施。

**项目地址:** [zeronetworks/zerologon](https://github.com/zeronetworks/zerologon)

**漏洞详情:** [CVE-2020-1472](https://nvd.nist.gov/vuln/detail/CVE-2020-1472)