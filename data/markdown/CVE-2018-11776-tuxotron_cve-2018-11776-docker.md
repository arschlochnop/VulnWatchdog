## CVE-2018-11776-Apache Struts2-远程代码执行

**漏洞编号:** CVE-2018-11776

**漏洞类型:** 远程代码执行

**影响应用:** Apache Struts2

**危害等级:** 高危，可导致服务器完全控制

**影响版本:** 2.3 to 2.3.34, 2.5 to 2.5.16

**利用条件:** alwaysSelectFullNamespace为true，且结果未使用命名空间，或者url标签缺少value和action，且上层包无命名空间或通配符命名空间

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2018-11776 漏洞是 Apache Struts2 框架中的一个远程代码执行漏洞。当 `alwaysSelectFullNamespace` 设置为 true，并且存在特定的命名空间配置时，攻击者可以通过构造恶意的 URL 来执行任意代码。

**有效性：**
根据漏洞库信息、搜索引擎结果和提供的POC代码，可以判断该漏洞的POC代码是有效的。漏洞库信息表明这是一个已公开的远程代码执行漏洞，并且有多个Exploit-DB链接。搜索引擎结果也显示了大量关于此漏洞的分析和利用文章。提供的Dockerfile、README.md和Go语言编写的exploit代码，都表明该漏洞存在可利用性。

**投毒风险：**
代码中存在投毒的潜在风险，但风险较低。主要风险存在于 `exploit-cve-2018-11776.go` 中，虽然代码的主要功能是利用漏洞执行命令，但如果作者恶意修改了 payload 构造方式或在命令执行后添加额外的操作，可能会引入投毒代码。例如，在执行命令后，将服务器上的敏感信息发送到攻击者控制的服务器。此外，`Dockerfile` 中虽然只是简单地部署了存在漏洞的应用，但也可能包含恶意修改，比如加入后门程序，尽管可能性较低。总体估计投毒风险为10%。

**利用方式：**
1.  **漏洞成因：** 漏洞由于 Struts2 框架对命名空间处理不当，导致 OGNL 表达式注入。
2.  **利用条件：** 需要满足 `alwaysSelectFullNamespace` 为 true 的条件，并且存在特定的命名空间配置，例如结果未使用命名空间，或者url标签缺少value和action，且上层包无命名空间或通配符命名空间。
3.  **攻击方法：** 攻击者通过构造包含恶意 OGNL 表达式的 URL，利用框架的漏洞执行任意命令。
4.  **POC 利用：** 提供的 exploit-cve-2018-11776.go  程序，首先构造一个包含 OGNL 表达式的 payload，该 payload 能够执行指定的命令。然后对 payload 进行 URL 编码，并将其拼接到目标 URL 后面。最后，通过发送 HTTP GET 请求到目标 URL，触发漏洞，执行 payload 中的命令，并将命令执行结果返回。
例如：`http://localhost:8080/${(#_memberAccess['allowStaticMethodAccess']=true).(#cmd='id').(#iswin=(@java.lang.System@getProperty('os.name').toLowerCase().contains('win'))).(#cmds=(#iswin?{'cmd.exe','/c',#cmd}:{'bash','-c',#cmd})).(#p=new java.lang.ProcessBuilder(#cmds)).(#p.redirectErrorStream(true)).(#process=#p.start()).(#ros=(@org.apache.struts2.ServletActionContext@getResponse().getOutputStream())).(@org.apache.commons.io.IOUtils@copy(#process.getInputStream(),#ros)).(#ros.flush())}/help.action`

**项目地址:** [tuxotron/cve-2018-11776-docker](https://github.com/tuxotron/cve-2018-11776-docker)

**漏洞详情:** [CVE-2018-11776](https://nvd.nist.gov/vuln/detail/CVE-2018-11776)