## CVE-2017-12615 - Apache Tomcat Remote Code Execution

**漏洞编号:** CVE-2017-12615

**漏洞类型:** 远程代码执行

**影响应用:** Apache Tomcat

**危害等级:** 高危，允许远程攻击者执行任意代码

**影响版本:** 7.0.0 to 7.0.79

**利用条件:** 运行在Windows上，HTTP PUT方法启用（readonly初始化参数设置为false）。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2017-12615漏洞允许未经授权的攻击者通过上传包含恶意代码的JSP文件到受影响的Apache Tomcat服务器上，从而实现远程代码执行。利用方式如下：

1.  **漏洞原理：** 当Tomcat运行在Windows操作系统上，并且启用了HTTP PUT方法（通常通过设置`readonly`初始化参数为`false`实现）时，服务器允许客户端上传文件。如果对上传的文件名没有进行充分的验证，攻击者就可以上传一个带有JSP扩展名的文件（例如`shell.jsp/`），Tomcat会将该文件视为JSP文件并执行其中的代码。

2.  **POC代码分析：** 提供的Python POC脚本首先尝试使用`OPTIONS`请求获取服务器允许的HTTP方法，并检查`Allow`头是否包含`PUT`。如果支持`PUT`方法，则生成一个随机文件名（带有`.jsp/`扩展名），然后使用`PUT`请求将包含恶意JSP代码的文件上传到服务器。上传的JSP代码包含一个简单的后门，允许攻击者通过`i`参数执行任意系统命令，并通过`pwd`参数进行简单的密码验证。文件上传成功后，脚本会打印出shell的访问URL。

3.  **有效性：** 根据漏洞描述和POC代码的逻辑，POC代码是有效的。如果目标Tomcat服务器满足漏洞条件（Windows + PUT enabled + Tomcat 7.0.0-7.0.79），该POC应该能够成功上传JSP shell并执行命令。

4.  **投毒风险：** 提供的POC代码本身没有明显的投毒行为。恶意代码位于JSP shell的内容中，目的是在目标服务器上执行命令，而不是在攻击者的机器上进行任何恶意操作。因此，投毒风险评估为0%。

5.  **利用方式总结：**
    *   确定目标Tomcat服务器运行在Windows上，并且启用了HTTP PUT方法。
    *   使用POC脚本或其他HTTP客户端发送PUT请求，上传一个包含恶意JSP代码的文件，文件名以`.jsp/`结尾。
    *   通过访问上传的JSP文件（例如，`http://target/random_name.jsp?pwd=023&i=whoami`）来执行任意系统命令。

6.  **搜索结果佐证：** 搜索引擎结果表明，CVE-2017-12615是一个已知被广泛利用的高危漏洞，CISA已知漏洞利用库收录了该漏洞，并建议高优先级修复。同时也存在相关的分析文章，进一步验证了漏洞的有效性和危害性。

**项目地址:** [wsg00d/cve-2017-12615](https://github.com/wsg00d/cve-2017-12615)

**漏洞详情:** [CVE-2017-12615](https://nvd.nist.gov/vuln/detail/CVE-2017-12615)