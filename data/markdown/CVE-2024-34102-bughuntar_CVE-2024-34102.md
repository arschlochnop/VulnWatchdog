## CVE-2024-34102 - Adobe Commerce XXE

**漏洞编号:** CVE-2024-34102

**漏洞类型:** XML 外部实体注入 (XXE)

**影响应用:** Adobe Commerce / Magento

**危害等级:** 严重，可能导致任意代码执行，敏感信息泄露

**影响版本:** <= 2.4.7, 2.4.6-p5, 2.4.5-p7, 2.4.4-p8 及更早版本

**利用条件:** 无需用户交互，需要网络访问

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-34102 漏洞存在于 Adobe Commerce/Magento 的 XML 解析器中。攻击者可以通过发送特制的 XML 文档，引用外部实体来利用此漏洞，从而执行任意代码或读取服务器上的敏感文件。由于漏洞是未授权的，无需用户交互，攻击者可以通过网络直接触发。

**有效性分析：**

根据漏洞库信息、搜索引擎结果和漏洞利用代码，此漏洞的 PoC 代码是有效的。漏洞库明确指出 CVE-2024-34102 是一个 XXE 漏洞，并且具有较高的 CVSS 评分（9.8）。搜索结果也表明该漏洞已被广泛讨论，并且存在公开可用的 PoC。提供的 PoC 代码实现了一个利用 CVE-2024-34102 读取任意文件的工具，进一步证明了其有效性。

**投毒风险分析：**

仔细分析了提供的 Go 代码 `cosmic_sting.go` 以及 `README.md` 文件。代码的主要功能是利用 XXE 漏洞读取文件，创建 Callback URL, 通过外带数据的方式获取文件内容。具体分析如下：

*   **代码逻辑：** 代码首先创建一个随机的 Callback URL，然后构造恶意的 XML 实体，当目标服务器解析该 XML 时，会尝试访问 Callback URL，从而将服务器上的文件内容外带出来。
*   **潜在风险：**代码中使用`fars.ee`这个域名来托管DTD文件，该域名存在潜在的风险，如果该域名被恶意人员控制，可能会投放恶意的DTD文件，进而导致被攻击的服务器执行恶意代码。代码中存在使用`api.cvssadvisor.com`获取instanceId的操作，增加了信息泄露的风险。代码中包含一些URL的硬编码，增加了被恶意利用的风险。
*   **结论：** 总体来看，代码的投毒风险较低，主要风险在于对第三方URL的依赖。 但是，鉴于代码的功能是读取文件内容，并无直接执行恶意代码的功能，因此代码的投毒风险较低，估计在5%左右。

**利用方式：**

1.  **构造恶意 XML：** 攻击者构造一个包含外部实体引用的恶意 XML 文档。
2.  **发送请求：** 将该 XML 文档作为请求的一部分发送到存在漏洞的 Adobe Commerce/Magento 服务器。
3.  **触发 XXE：** 服务器解析 XML 时，会尝试解析外部实体，从而发起对攻击者控制的服务器的请求。
4.  **读取文件/执行代码：** 攻击者可以通过外部实体引用读取服务器上的任意文件，或者通过特定的 payload 执行任意代码。
5.  **文件外带：** 通过 `fars.ee` 生成的 dtd 文件，读取目标文件内容，并且通过 `c5.rs` 域名将数据外带出去。

**项目地址:** [bughuntar/CVE-2024-34102](https://github.com/bughuntar/CVE-2024-34102)

**漏洞详情:** [CVE-2024-34102](https://nvd.nist.gov/vuln/detail/CVE-2024-34102)