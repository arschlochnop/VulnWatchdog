## CVE-2016-10033-PHPMailer-远程代码执行

**漏洞编号:** CVE-2016-10033

**漏洞类型:** 远程代码执行

**影响应用:** PHPMailer

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** < 5.2.18

**利用条件:** 目标系统使用了存在漏洞的PHPMailer版本，并且允许通过Web接口或其它方式设置邮件发送的相关参数，特别是Sender属性

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2016-10033 漏洞存在于 PHPMailer 5.2.18 之前的版本中。攻击者可以利用 `mailSend` 函数中 `isMail` 传输方式的参数注入漏洞，通过构造恶意的 `Sender` 属性，在 `mail` 命令中注入额外的参数，从而执行任意代码。

**有效性：**
根据漏洞库信息和搜索结果，该漏洞是真实存在的，并且存在多个公开的PoC。提供的 Dockerfile 描述了一个包含存在漏洞的 PHPMailer 版本的环境，因此可以推断POC代码是有效的.根据搜索结果，rapid7已经发布了该漏洞的利用模块。

**投毒风险：**
提供的代码仓库主要包含Dockerfile，LICENSE，www目录以及main.sh脚本。Dockerfile构建了一个包含apache, php5, python, sendmail的环境，用于复现漏洞。LICENSE是GNU GPL协议。main.sh 脚本可能是容器启动时执行的初始化脚本。www目录下是web应用的代码，包含攻击的载荷。

虽然整体代码目的是复现漏洞，但也存在一定的投毒风险（大约5%的可能性）， 主要体现在以下几个方面：

*   **依赖项中的隐患：** Dockerfile安装了一些额外的组件，如python，这些组件可能存在未知的安全问题。这些组件虽然不是直接利用PHPMailer漏洞，但可能被攻击者利用。
*   **main.sh脚本：** 该脚本的用途未知，如果它包含下载或执行其他恶意脚本的逻辑，则存在风险。

**利用方式：**
1.  攻击者需要找到使用了易受攻击的 PHPMailer 版本的 Web 应用。
2.  攻击者通过 Web 界面或其他途径，控制邮件发送的 `Sender` 属性。
3.  攻击者在 `Sender` 属性中构造包含反斜杠双引号和恶意命令的字符串，例如：`" -oQ/tmp -X/www/shell.php some_valid_email@example.com`， 其中`/www/shell.php` 是攻击者想要写入的webshell路径。
4.  当 Web 应用调用 PHPMailer 发送邮件时，PHPMailer 会调用 `mail` 命令，并将构造的恶意字符串作为参数传递给 `mail` 命令。
5.  `mail` 命令执行恶意代码，例如写入 WebShell 到服务器，从而实现远程代码执行。

总而言之，该漏洞利用方式较为直接，风险高，需尽快修复。

**项目地址:** [zeeshanbhattined/exploit-CVE-2016-10033](https://github.com/zeeshanbhattined/exploit-CVE-2016-10033)

**漏洞详情:** [CVE-2016-10033](https://nvd.nist.gov/vuln/detail/CVE-2016-10033)