## CVE-2018-0114-Node-jose-JWT签名伪造

**漏洞编号:** CVE-2018-0114

**漏洞类型:** JWT签名伪造

**影响应用:** Node-jose Library

**危害等级:** 高危，允许未授权的攻击者伪造JWT令牌，可能导致身份冒充和权限提升

**影响版本:** < 0.11.0

**利用条件:** 目标系统使用存在漏洞的Node-jose库进行JWT验证

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2018-0114 存在于 Cisco node-jose 开源库 0.11.0 之前的版本中。该漏洞允许未经身份验证的远程攻击者使用嵌入在令牌中的密钥重新签名令牌。该漏洞是由于 node-jose 遵循 JSON Web Signature (JWS) 标准处理 JSON Web Tokens (JWTs) 引起的。此标准指定代表公钥的 JSON Web Key (JWK) 可以嵌入在 JWS 的标头中。然后信任此公钥进行验证。攻击者可以通过删除原始签名，将新的公钥添加到标头，然后使用与嵌入在该 JWS 标头中的公钥关联的（攻击者拥有的）私钥对对象进行签名来利用这一点。

**利用方式：**

1.  **获取目标JWT:** 攻击者首先需要获取一个有效的JWT令牌，该令牌由易受攻击的Node-jose库处理。
2.  **构造恶意JWK:** 攻击者生成自己的RSA密钥对，并将公钥部分构造为一个JWK，嵌入到JWT的header中。
3.  **修改JWT Header:**  将原始JWT header中的签名算法（`alg`）修改为`RS256`，并将构造好的JWK添加到header中。
4.  **重新签名:** 使用攻击者自己的私钥对修改后的JWT header和payload进行签名。
5.  **发送伪造的JWT:** 将伪造的JWT发送给目标系统。由于目标系统信任header中的JWK，因此会使用攻击者的公钥验证签名，从而成功绕过身份验证。

**代码分析:**

提供的Ruby脚本 `CVE-2018-0114.rb` 实现了上述的攻击流程：

*   生成或读取攻击者的RSA私钥和公钥。
*   构造包含攻击者公钥的JWK header。
*   从命令行或代码中获取目标用户名，并将其编码为JWT payload。
*   使用攻击者的私钥对修改后的header和payload进行签名。
*   输出最终的伪造JWT。

**投毒风险:**

分析了提供的代码仓库，该仓库的目的是为了重现CVE-2018-0114漏洞的利用。该仓库只包含了一个ruby脚本和一个README文件，ruby脚本实现了漏洞利用，没有发现隐藏的恶意代码或后门，因此投毒风险为0%。

**项目地址:** [scumdestroy/CVE-2018-0114](https://github.com/scumdestroy/CVE-2018-0114)

**漏洞详情:** [CVE-2018-0114](https://nvd.nist.gov/vuln/detail/CVE-2018-0114)