## CVE-2024-12905-tar-fs-文件写入/覆盖

**漏洞编号:** CVE-2024-12905

**漏洞类型:** 路径遍历/符号链接攻击

**影响应用:** tar-fs

**危害等级:** 高危，可导致任意文件写入/覆盖，可能导致远程代码执行

**影响版本:** < 1.16.4, 2.0.0 <= version < 2.1.2, 3.0.0 <= version < 3.0.8

**利用条件:** 需要能够上传恶意构造的tar文件并触发提取操作。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-12905是tar-fs库中的一个文件写入/覆盖漏洞，源于不正确的链接解析和路径限制。攻击者可以构造恶意的tar文件，其中包含指向系统关键文件的符号链接，以及攻击者期望写入的内容。当目标系统使用存在漏洞的tar-fs版本提取该tar文件时，符号链接会被解析，从而导致文件写入操作发生在预期提取目录之外，进而覆盖或写入任意文件。POC利用方式如下：

1.  **创建恶意的tar文件：**  使用提供的`exploit.py`脚本，该脚本接受两个参数：包含要写入内容的文件的路径，以及要覆盖的目标文件的路径。脚本会生成两个tar文件 `stage_1.tar` 和 `stage_2.tar`。
2.  **`stage_1.tar` 的作用：**  首先，脚本创建一个符号链接，将`normal_file`链接到目标文件路径。然后，将此符号链接添加到`stage_1.tar`中。这一步的目的是在提取时创建符号链接。
3.  **`stage_2.tar` 的作用：** 脚本将包含实际写入内容的文件的路径添加到`stage_2.tar`中。这一步将覆盖符号链接指向的文件，写入攻击者指定的内容。
4.  **漏洞利用：**  攻击者首先上传并解压`stage_1.tar`，这会在提取目录中创建一个指向目标文件的符号链接。然后，攻击者上传并解压`stage_2.tar`，这会覆盖符号链接指向的目标文件，实现任意文件写入。

根据漏洞库信息和搜索引擎结果，此漏洞确实存在且危害较大。提供的POC代码逻辑清晰，没有发现隐藏的恶意代码，因此投毒风险较低。

**项目地址:** [theMcSam/CVE-2024-12905-PoC](https://github.com/theMcSam/CVE-2024-12905-PoC)

**漏洞详情:** [CVE-2024-12905](https://nvd.nist.gov/vuln/detail/CVE-2024-12905)