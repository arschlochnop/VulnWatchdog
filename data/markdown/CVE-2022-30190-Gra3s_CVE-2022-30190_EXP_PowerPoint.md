## CVE-2022-30190 Microsoft Windows Support Diagnostic Tool (MSDT) 远程代码执行漏洞

**漏洞编号:** CVE-2022-30190

**漏洞类型:** 远程代码执行

**影响应用:** Microsoft Windows Support Diagnostic Tool (MSDT)

**危害等级:** 高危，可能导致远程代码执行，控制受影响系统

**影响版本:** 受影响的Windows版本包括但不限于Windows 7、Windows 8.1、Windows 10、Windows 11、Windows Server 2008 R2、Windows Server 2012、Windows Server 2016、Windows Server 2019、Windows Server 2022等，具体版本范围见漏洞库信息。

**利用条件:** 需要用户打开包含恶意链接的文档（如Word、PowerPoint等），或者访问包含恶意链接的网页。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-30190（Follina）是一个存在于Microsoft Windows Support Diagnostic Tool (MSDT) 中的远程代码执行漏洞。该漏洞允许攻击者通过构造恶意的文档，诱使用户打开，从而在受害者系统上执行任意代码。

**有效性：**
根据漏洞库信息、搜索引擎结果和漏洞利用代码，该漏洞利用代码是有效的。搜索结果显示该漏洞已被积极利用，并且有公开的PoC代码。

**投毒风险：**
分析提供的PoC代码，`/tmp/b3fc53fc9d09e4a456a951f4bdd6f2bd/exploit.html` 文件看起来是一个无害的HTML文档，里面包含大量的Lorem Ipsum文本，但是攻击者可以通过 `slide1.xml.rels` 中插入恶意的url，从而执行恶意的payload。`/tmp/b3fc53fc9d09e4a456a951f4bdd6f2bd/README.md` 只是说明了如何修改`slide1.xml.rels` 文件的Target指向攻击者的服务器。

仓库中的投毒风险较低，主要风险在于payload本身可能被替换成恶意代码。但是，这个仓库本身的目的就是漏洞利用，使用者应该已经知晓其潜在的风险，并对下载的内容进行安全审查。因此, 投毒风险评定为10%。

**利用方式：**
1.  攻击者创建一个包含恶意链接的文档（例如，利用提供的PowerPoint PoC，将`.ppsx`文件解压，修改`ppt\slides\_rels\slide1.xml.rels`文件中的`Target`属性，指向攻击者控制的服务器上的`exploit.html`文件）。
2.  攻击者在自己的服务器上托管一个恶意的`exploit.html`文件，该文件包含用于触发MSDT漏洞的代码，并执行payload（默认payload是calc程序）。
3.  攻击者诱使用户打开该文档。
4.  当用户打开文档时，MSDT会尝试通过URL协议连接到攻击者的服务器，下载并执行恶意的`exploit.html`文件中的代码，从而在受害者系统上执行任意命令。

总的来说，该漏洞的利用依赖于社会工程学，诱使用户打开恶意文档。成功利用后，攻击者可以获得与当前用户相同的权限，从而控制受影响的系统。

**项目地址:** [Gra3s/CVE-2022-30190_EXP_PowerPoint](https://github.com/Gra3s/CVE-2022-30190_EXP_PowerPoint)

**漏洞详情:** [CVE-2022-30190](https://nvd.nist.gov/vuln/detail/CVE-2022-30190)