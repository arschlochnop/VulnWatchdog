## CVE-2025-29927-Next.js中间件授权绕过

**漏洞编号:** CVE-2025-29927

**漏洞类型:** 授权绕过

**影响应用:** Next.js

**危害等级:** 高危，可能导致未经授权的访问和数据泄露

**影响版本:** < 13.5.6, >14.0.0 < 14.2.25, >15.0.0 < 15.2.3, >= 11.1.4 <= 13.5.6

**利用条件:** 需要目标应用使用了Next.js中间件进行授权校验

**POC 可用性:** 是

**投毒风险:** 20%

## 详情

CVE-2025-29927 漏洞是 Next.js 中间件中的一个授权绕过漏洞。根据漏洞描述，如果 Next.js 应用的授权检查发生在中间件中，攻击者可以绕过这些检查。

**有效性：**

*   从漏洞库信息和搜索结果来看，此漏洞是一个真实存在的，并且影响了多个版本的Next.js。
*   提供的漏洞利用代码是一个Python脚本，用于检测目标网站是否使用了受影响的Next.js版本。
*   脚本通过发送HTTP请求到目标网站，然后解析响应内容，查找Next.js的版本信息。如果找到版本信息，脚本会检查该版本是否在受影响的范围内。
*   虽然此脚本主要是检测版本，但可以作为漏洞利用的前置步骤，确认目标是否存在漏洞，从而辅助利用。

**投毒风险：**

*   此代码存在一定的投毒风险。
*   以下是风险分析：
    *   **subprocess.run() 函数**: 脚本使用 `subprocess.run()` 来执行外部命令，如 `subfinder`, `dig`, `host`。如果攻击者控制了这些命令的输入或执行路径，他们可以注入恶意命令。
    *   **urllib3.disable_warnings()**: 禁用 HTTPS 警告可能会使脚本更容易受到中间人攻击。
    *   **request.get(url, verify=False)**: 禁用 SSL 证书验证增加了中间人攻击的风险，可能允许攻击者拦截或篡改流量。
*   评估：subprocess模块的风险相对较高，其他风险相对较低，整体**投毒风险为20%**，主要来自 subprocess 执行的外部命令。

**利用方式：**

1.  **版本检测：** 使用提供的Python脚本检测目标网站使用的Next.js版本。
2.  **发送恶意请求：**  如果目标网站使用的Next.js版本在受影响范围内，攻击者可以尝试发送包含 `x-middleware-subrequest` 标头的恶意请求，绕过中间件的授权检查。
3.  **获取未授权访问权限：** 成功绕过授权检查后，攻击者可以访问原本需要授权才能访问的资源或执行操作。

此漏洞的核心在于`x-middleware-subrequest`标头的处理不当。Next.js官方建议临时缓解措施是阻止包含此标头的外部请求到达应用，直到升级到修复版本。

**项目地址:** [nocomp/CVE-2025-29927-scanner](https://github.com/nocomp/CVE-2025-29927-scanner)

**漏洞详情:** [CVE-2025-29927](https://nvd.nist.gov/vuln/detail/CVE-2025-29927)