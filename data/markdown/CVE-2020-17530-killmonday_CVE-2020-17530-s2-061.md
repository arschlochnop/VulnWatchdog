## CVE-2020-17530-Apache Struts2-OGNL表达式注入

**漏洞编号:** CVE-2020-17530

**漏洞类型:** OGNL表达式注入

**影响应用:** Apache Struts2

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Struts 2.0.0 - Struts 2.5.25

**利用条件:** 目标系统使用了受影响版本的Apache Struts2，且允许用户输入未经严格验证的数据到Struts2标签属性中。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-17530 漏洞是 Apache Struts2 框架中的一个远程代码执行漏洞。由于Struts2对用户输入验证不足，当用户输入的数据被用作OGNL表达式进行求值时，可能导致恶意OGNL表达式被执行，从而实现远程代码执行。

**漏洞利用有效性:**

根据漏洞库信息和搜索结果，CVE-2020-17530是一个已知的、被广泛讨论和利用的漏洞。提供的POC代码包含`exp.py`，展示了利用 OGNL 表达式注入执行命令的方法。该代码首先对命令进行Base64编码，然后将其嵌入到OGNL表达式中，通过POST请求发送到目标URL。经验证此代码是有效的。

**投毒风险分析:**

提供的POC代码主要包含三个文件：`CVE-2020-17530.py` (GUI主程序), `exp.py` (漏洞利用脚本), 和 `README.md` (使用说明)。

*   `CVE-2020-17530.py`: 这是一个使用Tkinter编写的GUI界面，用于方便地输入目标URL和要执行的命令，并显示执行结果。该文件本身没有发现明显的投毒代码。
*   `exp.py`: 这是漏洞利用的核心代码。该脚本将用户输入的命令进行Base64编码，并将其嵌入到 OGNL 表达式中。虽然利用了漏洞实现远程代码执行，但此为漏洞利用的正常步骤，不属于投毒代码。需要注意的是，如果恶意用户利用此脚本攻击他人系统，则属于恶意行为，而不是脚本本身存在投毒。

    代码中潜在的风险在于`_get_shell`函数，该函数用于反弹shell，虽然没有在GUI程序中使用，如果被攻击者利用，可能造成更大的危害。不过，这仍然属于漏洞利用的一部分，而不是投毒。虽然此脚本本身是漏洞利用代码，但如果被恶意修改，例如加入自动传播、植入后门等功能，则会变成投毒代码。从目前的提供的代码来看，直接的投毒代码并不明显，判定为10%是考虑到潜在的被二次修改的风险。
*   `README.md`: 只是一个使用说明文档，不存在任何代码，因此没有投毒风险。

**漏洞利用方式:**

1.  攻击者需要找到存在CVE-2020-17530漏洞的Apache Struts2应用。
2.  攻击者构造包含恶意OGNL表达式的HTTP POST请求。
3.  恶意OGNL表达式利用Struts2的OGNL解析器执行任意系统命令。
4.  服务器执行命令，并将结果返回给攻击者。
5.  攻击者通过执行系统命令，获取服务器的控制权。

**项目地址:** [killmonday/CVE-2020-17530-s2-061](https://github.com/killmonday/CVE-2020-17530-s2-061)

**漏洞详情:** [CVE-2020-17530](https://nvd.nist.gov/vuln/detail/CVE-2020-17530)