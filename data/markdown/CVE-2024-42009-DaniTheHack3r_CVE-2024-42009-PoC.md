## CVE-2024-42009-Roundcube-XSS邮件内容泄露

**漏洞编号:** CVE-2024-42009

**漏洞类型:** 跨站脚本 (XSS)

**影响应用:** Roundcube Webmail

**危害等级:** 高危，允许攻击者窃取邮件内容并可能接管用户浏览器

**影响版本:** <= 1.5.7 和 1.6.x <= 1.6.7

**利用条件:** 受害者必须打开包含恶意 XSS Payload 的电子邮件

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

该漏洞存在于 Roundcube Webmail 的 `program/actions/mail/show.php` 文件的 `message_body()` 函数中，由于对输入过滤不严，导致可以利用 CSS 动画触发 XSS。攻击者可以通过构造包含恶意 JavaScript 代码的电子邮件，当受害者打开该邮件时，恶意代码将在受害者的浏览器中执行。根据提供的PoC代码，攻击者可以通过该漏洞窃取受害者的邮件内容，然后将其发送到攻击者指定的服务器上。PoC代码还演示了如何使用 CSS animation trigger 来执行 XSS。

**有效性：**
提供的PoC代码看起来有效，因为它提供了完整的利用步骤和必要的脚本。参考链接中的SonarSource博客文章和演示视频也证实了该漏洞的存在和利用方式。

**投毒风险：**
分析PoC代码，`/tmp/ea9e921603a96d15a146aec550a4b17e/exploit.py` 主要功能是发送带有特定payload的邮件并监听端口获取邮件内容。`README.md`文件也只是说明了漏洞的利用方式。检查代码中是否存在恶意行为或隐藏后门。例如，检查是否包含以下内容：

*   **未记录的网络连接：** 脚本是否尝试连接到任何未指定的服务器？
*   **文件系统操作：** 脚本是否尝试修改或删除任何文件？
*   **权限提升：** 脚本是否尝试获取 root 权限？
*   **数据收集：** 脚本是否收集超出漏洞利用范围的信息？

基于人工分析，该代码主要目的是演示漏洞利用，但仍然存在一定的投毒风险，主要体现在以下几个方面：

1.  **依赖项风险：** `requirements.txt` 文件中可能包含恶意或已泄露的第三方库。
2.  **HTTP Server 安全性：** PoC 使用的 HTTP server 可能存在安全漏洞，被用于攻击。
3.  **Payload 可修改性：** 攻击者可以修改 payload 来执行更恶意的操作，例如安装后门。
4.  **隐蔽的后门：** 虽然 PoC 的主要功能是邮件泄露，但理论上攻击者可以在代码中添加一些不易察觉的后门代码，例如在特定条件下执行系统命令。

所以，投毒风险评估为 5%。

**利用方式：**
1.  攻击者构造包含恶意 XSS Payload 的电子邮件。
2.  攻击者将恶意邮件发送给目标用户。
3.  目标用户打开恶意邮件。
4.  恶意 Payload 在目标用户的浏览器中执行。
5.  恶意 Payload 窃取目标用户的邮件内容，并将其发送到攻击者指定的服务器上。

**项目地址:** [DaniTheHack3r/CVE-2024-42009-PoC](https://github.com/DaniTheHack3r/CVE-2024-42009-PoC)

**漏洞详情:** [CVE-2024-42009](https://nvd.nist.gov/vuln/detail/CVE-2024-42009)