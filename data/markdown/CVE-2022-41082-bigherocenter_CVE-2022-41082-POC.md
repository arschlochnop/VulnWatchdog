## CVE-2022-41082-Microsoft Exchange Server Remote Code Execution Vulnerability

**漏洞编号:** CVE-2022-41082

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Microsoft Exchange Server

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** 受影响版本包括 Exchange Server 2013 Cumulative Update 23，Exchange Server 2016 Cumulative Update 22 和 23，Exchange Server 2019 Cumulative Update 11 和 12（具体版本范围见漏洞库信息）

**利用条件:** 需要身份验证，但可通过 SSRF 漏洞 (CVE-2022-41040) 结合利用绕过部分身份验证。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-41082 是 Microsoft Exchange Server 中的一个远程代码执行漏洞。攻击者可以通过利用此漏洞在受影响的服务器上执行任意代码。根据漏洞库信息和搜索结果，该漏洞与 CVE-2022-41040（SSRF 漏洞）组合成 ProxyNotShell 攻击链，允许经过身份验证的（或借助 SSRF 绕过部分身份验证的）攻击者远程执行代码。提供的 POC 代码显示了利用该漏洞的基本流程。POC包含一个Python脚本，用于发送特制的SOAP请求到Exchange服务器的PowerShell端点，从而触发RCE。此外，POC还包含TabShell.ps1脚本，利用特权提升，绕过受限的PowerShell沙箱环境，执行任意PowerShell命令，并执行操作系统命令，例如启动计算器（calc.exe）或获取IP配置信息。cmd文件指定了要执行的命令。POC的README文件提供了使用说明。投毒风险分析：虽然POC代码本身是为了演示漏洞利用，但由于其涉及到执行任意命令，存在一定的风险。`cmd` 文件中指定了 `C:\calc.exe` 作为示例，但攻击者可以替换为任何恶意程序。`TabShell.ps1`也具有潜在的风险，尝试绕过 PowerShell 的安全限制，如果成功，可能允许攻击者在更广泛的范围内执行恶意操作。代码中未发现明显的恶意投毒代码，但是建议审查脚本执行的操作，以确保其安全性和完整性。因此，推断投毒风险为10%。利用方式：

1.  **身份验证/SSRF 绕过：** 首先需要获取 Exchange 服务器的身份验证凭据，或者利用 CVE-2022-41040 (SSRF) 等漏洞绕过身份验证。
2.  **发送恶意 SOAP 请求：** 使用 POC 提供的 Python 脚本 `poc.py`，构造包含恶意 PowerShell 命令的 SOAP 请求，并将其发送到 Exchange 服务器的 PowerShell 端点。
3.  **命令执行：** Exchange 服务器解析并执行 SOAP 请求中的 PowerShell 命令，从而在服务器上执行任意代码。
4.  **特权提升（可选）：**  使用 `TabShell.ps1` 脚本突破 PowerShell 沙箱，提升权限并执行更广泛的恶意操作。
5.  **持久化/横向移动：**  攻击者可以利用 RCE 漏洞在 Exchange 服务器上安装后门、窃取敏感信息，或者横向移动到网络中的其他系统。

**项目地址:** [bigherocenter/CVE-2022-41082-POC](https://github.com/bigherocenter/CVE-2022-41082-POC)

**漏洞详情:** [CVE-2022-41082](https://nvd.nist.gov/vuln/detail/CVE-2022-41082)