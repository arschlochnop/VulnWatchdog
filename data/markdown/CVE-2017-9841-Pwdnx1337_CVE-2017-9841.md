## CVE-2017-9841-PHPUnit-远程代码执行

**漏洞编号:** CVE-2017-9841

**漏洞类型:** 远程代码执行

**影响应用:** PHPUnit

**危害等级:** 高危，允许攻击者执行任意PHP代码

**影响版本:** < 4.8.28 和 5.x < 5.6.3

**利用条件:** 需要目标服务器存在暴露的/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php URI，即可以通过web访问该文件

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2017-9841 是 PHPUnit 框架中的一个远程代码执行漏洞。根据漏洞库信息和搜索结果，该漏洞存在于 PHPUnit 4.8.28 之前版本以及 5.x 系列的 5.6.3 之前版本中。攻击者可以通过向 `vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php` 发送包含 `<?php` 开头的恶意 PHP 代码的 POST 请求来执行任意代码。

**漏洞利用方式:**

1.  **确定目标:**  目标服务器上必须安装了受影响版本的 PHPUnit，并且 `/vendor` 目录对外暴露，允许通过 Web 访问 `eval-stdin.php` 文件。
2.  **构造Payload:**  构造一个以 `<?php` 开头的 PHP 代码，作为 POST 请求的数据发送到目标服务器的 `eval-stdin.php` 路径。
3.  **发送请求:**  使用 POST 方法发送包含恶意 PHP 代码的请求。
4.  **执行代码:**  服务器上的 `eval-stdin.php` 脚本会执行 POST 请求中的 PHP 代码，从而导致远程代码执行。

**POC有效性评估:**

提供的 POC 代码 `phpunit.py` 的功能是：

1.  **设置目标URL：** 接收目标URL列表作为参数，读取目标URL
2.  **构造包含恶意PHP代码的POST请求:** 使用 `<?php` 开头，包含下载并执行一个名为 `ZIP.php` 文件的命令 (通过 curl 命令从 `https://raw.githubusercontent.com/Pwdny1337/ZIP/refs/heads/main/ZIP.php` 下载)。
3.  **发送POST请求:**  使用 `requests` 库向目标服务器的 `eval-stdin.php` 路径发送带有恶意PHP代码的POST请求。
4.  **验证是否成功:**  检查是否成功下载并执行了 `ZIP.php` 文件。如果状态码是200并且内容包含“PHP”，则认为漏洞利用成功。
5.  **保存结果:**  将成功利用漏洞的URL保存到 `save.txt` 和 `result/Shell_results.txt` 文件中。

此POC代码逻辑清晰，功能完整，能够有效利用该漏洞执行远程代码，所以是有效的。

**投毒风险评估:**

分析POC代码，没有发现作者植入的恶意代码，用于反制攻击者或者进行其他恶意行为。POC利用的是公开的远程代码执行漏洞，执行的代码也是从GitHub下载，虽然存在一定风险，但不能视为POC代码本身的投毒行为。因此判定投毒风险为0%。

根据搜索结果，CVE-2017-9841 漏洞曾在野外被广泛利用，攻击者经常扫描和利用此漏洞。即使在漏洞公布多年后，仍然存在攻击活动，表明一些系统仍然未修复此漏洞。

**项目地址:** [Pwdnx1337/CVE-2017-9841](https://github.com/Pwdnx1337/CVE-2017-9841)

**漏洞详情:** [CVE-2017-9841](https://nvd.nist.gov/vuln/detail/CVE-2017-9841)