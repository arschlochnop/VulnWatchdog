## CVE-2025-29927-Next.js中间件授权绕过

**漏洞编号:** CVE-2025-29927

**漏洞类型:** 授权绕过

**影响应用:** Next.js

**危害等级:** 高危，可能导致未授权访问和数据泄露

**影响版本:** Next.js 15.x < 15.2.3, Next.js 14.x < 14.2.25, Next.js 13.x < 13.5.9

**利用条件:** 自托管Next.js应用，使用Middleware进行身份验证/授权，并且没有在后续路由中进行二次验证。 应用需要部署为`next start` 和 `output: standalone` 模式。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2025-29927是Next.js框架中的一个授权绕过漏洞。该漏洞存在于Next.js的中间件实现中，允许攻击者通过设置`x-middleware-subrequest` header绕过中间件的身份验证和授权检查。 

**有效性：**
根据漏洞库信息、搜索引擎结果以及提供的POC代码，可以确认该漏洞是有效的。POC代码通过设置`x-middleware-subrequest: middleware` header来模拟内部子请求，从而绕过中间件的身份验证检查。

**投毒风险：**
POC代码本身主要用于演示漏洞利用方法。 代码仓库包含一个`exploit-test.js`用于测试漏洞利用。 漏洞本身原理简单，利用方式比较直接，因此作者在POC中隐藏恶意代码的可能性较低。 但是依然存在一定的投毒风险，例如在安装依赖时引入恶意依赖项，或者通过混淆等方式在利用脚本中添加恶意代码。综合评估，投毒风险约为5%。

**利用方式：**
1.  攻击者向目标Next.js应用发送HTTP请求。
2.  在HTTP请求头中添加`x-middleware-subrequest: middleware`。
3.  如果目标应用依赖中间件进行身份验证或授权，并且没有在后续路由中进行二次验证，则攻击者可以绕过中间件的检查。
4.  攻击者可以访问受保护的资源或执行未授权操作。

**缓解措施：**
1.  升级到Next.js 15.2.3或更高版本，Next.js 14.2.25或更高版本，Next.js 13.5.9或更高版本。
2.  如果无法升级，可以配置Web应用防火墙（WAF），阻止包含`x-middleware-subrequest` header的外部请求。
3.  在所有需要身份验证的路由中，进行二次身份验证检查。

**项目地址:** [aydinnyunus/CVE-2025-29927](https://github.com/aydinnyunus/CVE-2025-29927)

**漏洞详情:** [CVE-2025-29927](https://nvd.nist.gov/vuln/detail/CVE-2025-29927)