## CVE-2016-10033-PHPMailer远程代码执行

**漏洞编号:** CVE-2016-10033

**漏洞类型:** 远程代码执行

**影响应用:** PHPMailer

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** < 5.2.18

**利用条件:** 需要目标系统使用存在漏洞的PHPMailer版本，并且允许通过mail()函数发送邮件

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2016-10033漏洞存在于PHPMailer 5.2.18之前的版本中。攻击者可以利用mailSend函数中的参数注入漏洞，通过精心构造的Sender属性，向mail命令传递额外的参数，从而执行任意代码。利用方式主要是通过修改POST请求中的Host头，在其中插入恶意代码。由于该漏洞利用需要拼接大量的字符，且依赖于特定环境配置，因此存在一定的利用难度，成功率受环境影响较大。提供的PoC利用了WordPress的密码找回功能，通过修改Host头来实现代码执行。

**有效性：**
根据漏洞库信息、搜索引擎结果以及提供的漏洞利用代码，可以判断该漏洞是真实存在的，并且存在公开的PoC。PoC利用了PHPMailer组件向用户发送邮件时的漏洞，通过构造恶意邮箱地址，可以执行任意命令。

**投毒风险：**
提供的Dockerfile文件用于构建存在漏洞的WordPress环境，本身不包含恶意代码。README.md文件提供了漏洞的利用说明和PoC，webshell.php文件是一个简单的webshell，wordpress-rce-exploit.sh文件是一个空文件。虽然webshell.php文件本身不是投毒代码，但在真实环境中被攻击者利用可能会造成安全风险。综合来看，该仓库本身被投毒的风险较低，约10%。主要是 webshell 本身是一种后门，若未经授权部署可能带来风险，且PoC中利用了外部资源，可能被替换。

**利用方式：**
1.  **找到使用PHPMailer的应用程序：** 确定目标应用程序使用了存在漏洞的PHPMailer版本。
2.  **构造恶意邮箱地址：** 通过修改`Sender`属性，插入反斜杠双引号和要执行的命令，例如：`attacker@example.com\" -oQ/tmp -X/tmp/shell.php some text`。
3.  **触发邮件发送：** 触发应用程序发送邮件的功能，例如注册、密码找回等。
4.  **执行命令：** PHPMailer在调用mail()函数时，会将恶意代码传递给系统，导致命令执行。
在提供的PoC中，利用WordPress的密码找回功能，通过修改HTTP请求中的Host头，注入恶意参数到mail()函数中，实现远程代码执行。

**项目地址:** [liusec/WP-CVE-2016-10033](https://github.com/liusec/WP-CVE-2016-10033)

**漏洞详情:** [CVE-2016-10033](https://nvd.nist.gov/vuln/detail/CVE-2016-10033)