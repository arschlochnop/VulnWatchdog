## CVE-2025-43300: iOS/macOS DNG图像处理内存损坏

**漏洞编号:** CVE-2025-43300

**漏洞类型:** 内存损坏（越界写入）

**影响应用:** iOS, iPadOS, macOS ImageIO框架

**危害等级:** 高危，可导致应用程序崩溃或潜在的代码执行

**影响版本:** macOS Sonoma < 14.7.8, macOS Ventura < 13.7.8, iPadOS < 17.7.10, macOS Sequoia < 15.6.1, iOS < 18.6.2 and iPadOS < 18.6.2

**利用条件:** 处理恶意的DNG图像文件

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2025-43300是一个存在于Apple ImageIO框架中的越界写入漏洞，影响iOS、iPadOS和macOS系统。该漏洞的根本原因是DNG文件中TIFF元数据中的`SamplesPerPixel`值与JPEG流中的`SOF3 component count`值不一致，导致内存分配和处理过程中的错位，最终造成缓冲区溢出。攻击者可以通过处理特制的DNG图像文件来触发该漏洞，导致应用程序崩溃或潜在的代码执行。

**漏洞利用方式：**

1.  **漏洞触发：** 通过ImageIO框架处理包含特制元数据的DNG图像文件，这些元数据会故意与图像数据流不一致。
2.  **元数据不一致：** 具体而言，TIFF头中的`SamplesPerPixel`元数据指示了预期的颜色组件数，而JPEG无损流中的`SOF3 component count`指定了实际的数据组件数。当这两个值不同时，就会出现问题。
3.  **内存分配错位：** 系统基于`SamplesPerPixel`的值（例如，2个组件）分配缓冲区。`缓冲区大小 = 图像宽度 x 图像高度 x 2`。
4.  **数据写入溢出：** JPEG解码器读取`SOF3`组件计数（例如，1个组件）。由于实际与预期数据大小不一致，解码器尝试基于错误的假设写入数据。这将导致向缓冲区写入比分配的更多的数据。
5.  **结果：** 缓冲区溢出导致相邻内存区域损坏，导致应用程序崩溃或潜在的代码执行。

**POC有效性分析：**

提供的POC代码包含两个Python脚本：`dng_vulnerability_analyzer.py`和`hex_modifier.py`。`dng_vulnerability_analyzer.py`用于分析DNG文件结构，识别是否存在`SamplesPerPixel`元数据与`SOF3 component count`不一致的情况。`hex_modifier.py`用于通过修改特定字节来创建POC文件，增加`SamplesPerPixel`的值并减少`SOF3 component count`的值，从而触发漏洞。提供的POC创建过程清晰，并且解释了为什么这些修改会导致内存损坏。从漏洞描述和POC代码来看，该漏洞利用是有效的。

**投毒风险分析：**

检查了提供的POC代码（`dng_vulnerability_analyzer.py`和`hex_modifier.py`），没有发现任何明显的恶意代码或后门。这些脚本的功能主要是分析和修改DNG文件，用于触发漏洞，而不是植入恶意代码。`hex_modifier.py`脚本中包含安全检查机制，以防止意外的文件损坏，这进一步降低了投毒的可能性。因此，可以认为该仓库中不存在作者隐藏的投毒代码。投毒风险评估为0%。

**总结：**

CVE-2025-43300是一个高危的内存损坏漏洞，攻击者可以利用该漏洞通过处理特制的DNG图像文件来攻击受影响的系统。提供的POC代码有效，并且没有发现投毒风险。

**项目地址:** [hunters-sec/CVE-2025-43300](https://github.com/hunters-sec/CVE-2025-43300)

**漏洞详情:** [CVE-2025-43300](https://nvd.nist.gov/vuln/detail/CVE-2025-43300)