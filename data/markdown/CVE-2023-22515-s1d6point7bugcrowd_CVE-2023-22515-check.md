## CVE-2023-22515 Atlassian Confluence 破损的访问控制

**漏洞编号:** CVE-2023-22515

**漏洞类型:** 破损的访问控制

**影响应用:** Atlassian Confluence Data Center and Server

**危害等级:** 高危，可能导致未授权管理员账户创建和远程代码执行

**影响版本:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**利用条件:** Confluence实例对外开放，且版本在受影响范围内

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-22515是一个存在于Atlassian Confluence Data Center和Server中的破损的访问控制漏洞。未经身份验证的攻击者可以通过此漏洞创建未经授权的Confluence管理员账户，并访问Confluence实例。根据漏洞库信息和搜索结果，该漏洞影响Confluence Data Center和Server 8.0.0到8.5.1之间的多个版本。提供的漏洞利用代码是一个检测脚本，用于确定Confluence实例是否容易受到攻击，而不是直接利用漏洞。它首先检查Confluence版本，然后尝试通过POST请求将应用设置为设置模式(setup mode)。如果版本在受影响范围内，并且成功设置了设置模式，则认为该实例易受攻击。

**有效性：**
该POC的有效性取决于目标Confluence实例的版本和是否能成功触发setup mode。如果目标版本在受影响范围内，且可以设置为setup mode，则该脚本能有效识别漏洞的存在，但它本身**不能直接利用漏洞**创建管理员账户。 该脚本只起到验证是否存在漏洞。

**投毒风险：**
该存储库存在投毒风险的可能性较低，约为10%。 原因是：
1. 该代码主要功能是版本检测和setup mode设置，没有执行恶意操作。
2.  虽然`X-Custom-Header`可用于识别用户，理论上存在追踪行为，但是此行为不属于后门或者恶意行为，所以投毒风险较低。

**利用方式：**
1.  **版本检测:**  利用脚本或者手动访问`login.action`页面，通过正则表达式提取Confluence版本号。
2.  **Setup Mode检查:** 发送POST请求到`/server-info.action`，设置`bootstrapStatusProvider.applicationConfig.setupComplete`为`false`尝试进入Setup Mode。
3.  **创建管理员账号:** 如果成功进入Setup Mode，即可创建新的管理员账户，从而控制Confluence实例。需要注意，提供的代码**不包含**创建管理员账户的步骤，只是检测漏洞是否存在。

**项目地址:** [s1d6point7bugcrowd/CVE-2023-22515-check](https://github.com/s1d6point7bugcrowd/CVE-2023-22515-check)

**漏洞详情:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)