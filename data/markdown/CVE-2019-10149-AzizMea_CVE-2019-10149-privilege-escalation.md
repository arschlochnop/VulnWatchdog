## CVE-2019-10149-Exim-远程命令执行

**漏洞编号:** CVE-2019-10149

**漏洞类型:** 远程命令执行

**影响应用:** Exim

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** 4.87 to 4.91

**利用条件:** 目标服务器运行Exim邮件服务器，且版本在4.87到4.91之间，需要网络访问25端口。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-10149 存在于 Exim 邮件传输代理 (MTA) 的 deliver_message() 函数中，由于对接收者地址验证不当导致。攻击者可以通过发送特制的电子邮件，在目标服务器上执行任意命令。

**有效性分析：**

根据漏洞库信息、搜索引擎结果和提供的POC代码，该漏洞的利用是有效的。POC代码 `wizard.py` 模拟了SMTP交互，利用`RCPT TO`命令中的`${run{...}}` 扩展功能，执行shell命令。

**投毒风险分析：**

检查提供的`wizard.py`文件，其中的payload经过了编码，目的是为了绕过一些检测机制。解码后的命令主要完成以下操作：

*   创建一个具有SUID权限的程序 `s`。
*   该程序 `s` 拥有root权限，执行后会启动一个root shell。
*   利用`${run{}}` 在服务器上执行编译命令，生成二进制文件s，并赋予SUID权限
*   POC的最后，执行该程序 `/tmp/s` 以获取root权限。

该POC旨在提升权限，而不是注入恶意代码到服务器的持久性位置，因此不属于传统的“投毒”行为。 投毒风险：0%

**利用方式：**

1.  攻击者连接到Exim服务器的25端口。
2.  发送HELO, MAIL FROM等SMTP命令进行初始化。
3.  利用 `RCPT TO` 命令，构造包含恶意命令的接收者地址，其中使用了 `${run{...}}` 扩展功能。
4.  发送DATA命令，提供邮件内容 (实际上邮件内容对利用该漏洞来说并不重要)。
5.  利用服务器执行`${run{}}`中的命令，该命令编译一个具有SUID的程序，攻击者执行该程序以获取root权限。

**项目地址:** [AzizMea/CVE-2019-10149-privilege-escalation](https://github.com/AzizMea/CVE-2019-10149-privilege-escalation)

**漏洞详情:** [CVE-2019-10149](https://nvd.nist.gov/vuln/detail/CVE-2019-10149)