## CVE-2024-23334-aiohttp-目录遍历

**漏洞编号:** CVE-2024-23334

**漏洞类型:** 目录遍历

**影响应用:** aiohttp

**危害等级:** 中危，可能导致敏感信息泄露

**影响版本:** < 3.9.2

**利用条件:** 需要目标服务器开启了`follow_symlinks=True`的静态文件服务

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-23334是aiohttp库中的一个目录遍历漏洞。当`aiohttp.web.static`设置`follow_symlinks=True`时，如果对输入路径没有进行充分校验，可能允许攻击者通过构造包含`../`的恶意URL来访问静态资源目录以外的文件。 

**有效性：**

提供的POC代码是有效的。它通过Dockerfile设置了一个存在漏洞的环境：

1.  创建了一个静态资源目录 `/workspace/static`。
2.  创建了一个指向 `/etc/shadow` 的符号链接 `/workspace/static/image.png`。
3.  `app/main.py`中使用`aiohttp.web.static` 并设置 `follow_symlinks=True`。

攻击者可以通过访问类似 `http://target:8080/static/image.png` 或 `http://target:8080/static/../../../../etc/shadow`的URL来读取 `/etc/shadow` 文件（如果直接利用目录遍历，需要绕过URL的normalize）。POC自带的 `exploit_path_traversal.py`脚本通过发送原始HTTP请求绕过了URL规范化。

**投毒风险：**

代码库中可能存在轻微的投毒风险，概率约为10%。 风险点在于以下几点：

1.  **`/etc/shadow`的符号链接：**  POC创建了一个指向`/etc/shadow`的符号链接。虽然这是为了演示漏洞，但在实际环境中，恶意用户可能会创建指向其他敏感文件的符号链接，以扩大攻击范围。
2.  **`exploit_path_traversal.py`：** 该脚本绕过了URL规范化，这在某些情况下是必要的，但同时也可能被用于更复杂的攻击。

虽然POC的目的主要是演示漏洞，但上述风险点表明，如果直接使用此POC而不进行适当的修改和安全审查，可能会对系统造成危害。

**利用方式：**

该漏洞的利用方式有两种：

1.  **符号链接利用：** 如果服务器上存在指向敏感文件的符号链接（例如，本POC中的 `/workspace/static/image.png -> /etc/shadow`），攻击者可以直接访问该符号链接来读取目标文件。
2.  **目录遍历：** 即使没有预先存在的符号链接，攻击者也可以尝试使用目录遍历（`../`）来访问静态资源目录以外的文件。但需要注意URL规范化的问题，可能需要使用原始HTTP请求绕过。

总而言之，POC代码是有效的，可以用来演示CVE-2024-23334漏洞。需要注意的是，存在少量的投毒风险，应谨慎使用。

**项目地址:** [brian-edgar-re/poc-cve-2024-23334](https://github.com/brian-edgar-re/poc-cve-2024-23334)

**漏洞详情:** [CVE-2024-23334](https://nvd.nist.gov/vuln/detail/CVE-2024-23334)