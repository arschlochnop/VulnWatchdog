## CVE-2021-4034 Polkit pkexec 本地提权漏洞

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地提权

**影响应用:** Polkit pkexec

**危害等级:** 高危，允许低权限用户获得root权限

**影响版本:** all (受影响版本)

**利用条件:** 本地用户可访问pkexec

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-4034 是 polkit pkexec 工具中的一个本地提权漏洞。pkexec 是一个 setuid 工具，旨在允许非特权用户以特权用户身份运行命令，遵循预定义的策略。漏洞的根本原因是 pkexec 在处理调用参数计数时存在错误，导致其尝试将环境变量作为命令执行。攻击者可以通过构造特定的环境变量，诱使 pkexec 执行任意代码，从而获得目标机器上的管理权限。

**有效性：**
根据漏洞库信息和搜索结果，该漏洞已经公开，并且存在可用的漏洞利用代码（POC）。多个安全厂商和研究团队已经验证了该漏洞的存在和利用方式。虽然提供的POC代码只是一个README.md文件，但根据漏洞描述，可以推断有效的POC代码需要利用精心构造的环境变量来执行恶意代码。

**投毒风险：**
提供的 POC 代码只是一个 README 文件，本身不包含任何可执行代码。 但是，如果从其他来源获取的漏洞利用代码，可能存在投毒风险。为了评估投毒风险，必须检查利用代码的以下内容:

1.  **来源的可靠性：** 代码是否来自受信任的来源？例如，知名的安全研究人员或组织。
2.  **代码审查：** 代码是否经过了审查？最好由多个安全研究人员进行独立的代码审查。
3.  **混淆：** 代码是否经过了混淆处理，使其难以理解？这可能是隐藏恶意行为的标志。
4.  **网络连接：** 代码是否尝试建立网络连接？如果代码尝试连接到未知的或可疑的服务器，则可能存在风险。
5.  **权限请求：** 代码是否请求了不必要的权限？如果代码请求的权限超过了其功能所需的范围，则可能存在风险。

由于当前提供的代码只是readme.md,所以风险较低，预估投毒风险为10%。

**利用方式：**
该漏洞的利用方式主要涉及以下步骤：

1.  **构造恶意环境变量：** 攻击者需要构造一组特殊的环境变量，这些环境变量会被 pkexec 错误地解析为命令。
2.  **执行 pkexec：** 攻击者执行 pkexec，触发漏洞。
3.  **提权：** pkexec 执行攻击者构造的恶意代码，导致攻击者获得 root 权限。

参考链接中有很多关于该漏洞的讨论和POC利用示例。

**项目地址:** [dh4r4/PwnKit-CVE-2021-4034-](https://github.com/dh4r4/PwnKit-CVE-2021-4034-)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)