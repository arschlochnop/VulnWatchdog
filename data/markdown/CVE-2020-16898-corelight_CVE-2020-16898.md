## CVE-2020-16898 - Windows TCP/IP 远程代码执行漏洞（Bad Neighbor）

**漏洞编号:** CVE-2020-16898

**漏洞类型:** 远程代码执行（RCE）

**影响应用:** Windows TCP/IP 协议栈

**危害等级:** 高危，可能导致远程代码执行，完全控制受影响系统

**影响版本:** Windows 10 Version 1709, 1803, 1809, 1903, 1909, 2004, Windows Server 2019, Windows Server version 1903, Windows Server version 2004 等多个版本受影响

**利用条件:** 攻击者需要与目标主机处于同一网络邻域，或者能够发送伪造的 ICMPv6 路由通告数据包到目标主机

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

该漏洞存在于 Windows TCP/IP 协议栈中，当其处理 ICMPv6 路由通告数据包时，未能正确解析其中的 RDNSS 选项（Option Type 25），导致内存损坏，进而允许攻击者执行任意代码。攻击者通过发送特制的 ICMPv6 路由通告数据包来触发此漏洞。

**有效性评估：**

根据漏洞库信息和搜索结果，此漏洞是一个真实存在的远程代码执行漏洞，并且已经有公开的PoC代码。提供的Zeek脚本是一个网络检测包，用于检测利用此漏洞的恶意流量。它通过分析 ICMPv6 路由通告数据包，特别是检查 RDNSS 选项的长度是否为偶数来判断是否存在攻击。

**投毒风险分析：**

提供的PoC代码（Zeek脚本）主要用于检测攻击，而不是利用攻击。仔细检查提供的文件，包括`LICENSE`, `README.md`, `bro-pkg.meta`, `zkg.meta`, `scripts/CVE-2020-16898.zeek`, 和 `scripts/__load__.zeek`，没有发现明显的恶意代码或后门。代码逻辑清晰，主要是检测 ICMPv6 路由通告消息中 RDNSS 选项的长度是否合法。脚本通过生成 Notice 日志来告知管理员存在潜在的攻击行为。投毒的风险较低，但仍存在微小可能性，例如利用 Zeek 脚本的复杂性进行隐藏，或者利用 Zeek 本身的漏洞执行恶意操作。因此，保守估计投毒风险为5%。

**利用方式分析：**

1.  **攻击者构造恶意的 ICMPv6 路由通告数据包：** 数据包中包含一个格式错误的 RDNSS 选项（Option Type 25），其长度为非偶数。
2.  **攻击者将恶意数据包发送给目标 Windows 主机：** 可以通过本地网络发送，也可以通过中间人攻击等方式。
3.  **目标主机处理恶意数据包：** Windows TCP/IP 协议栈在处理该数据包时，由于 RDNSS 选项的长度错误，导致内存溢出。
4.  **攻击者利用内存溢出执行任意代码：** 攻击者可以在溢出的内存中写入恶意代码，并控制程序的执行流程，最终实现远程代码执行。

提供的 Zeek 脚本并不能直接利用漏洞，而是用于检测网络流量中是否存在利用此漏洞的攻击行为。 它通过检测 ICMPv6 路由通告消息中的 Recursive_DNS_Server_Option (RDNSS) 是否存在长度异常的情况（长度不为偶数）来进行判断。 如果发现异常，则会产生一个Notice告警。

**项目地址:** [corelight/CVE-2020-16898](https://github.com/corelight/CVE-2020-16898)

**漏洞详情:** [CVE-2020-16898](https://nvd.nist.gov/vuln/detail/CVE-2020-16898)