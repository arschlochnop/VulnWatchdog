## CVE-2022-0847-Dirty Pipe

**漏洞编号:** CVE-2022-0847

**漏洞类型:** 本地权限提升

**影响应用:** Linux Kernel

**危害等级:** 高危，允许非特权用户覆盖只读文件，提升权限至root

**影响版本:** Linux kernel versions newer than 5.8 and before 5.16.11, 5.15.25, 5.10.102

**利用条件:** 本地访问受影响的Linux系统

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

**漏洞有效性：**

根据漏洞库信息、搜索结果和提供的漏洞利用代码，CVE-2022-0847（Dirty Pipe）是一个有效的本地权限提升漏洞。漏洞库信息将其描述为“未初始化的pipe_buffer.flags成员”，允许非特权本地用户写入只读文件支持的页面缓存，从而提升系统权限。搜索引擎结果也证实了该漏洞的存在和可利用性，并提供了多个POC利用示例。

**投毒风险：**

评估提供的POC代码，虽然主要功能是利用Dirty Pipe漏洞提升权限，但仍存在一定的投毒风险：

*   `exploit-1.c` 旨在修改 `/etc/passwd` 文件，虽然会备份文件并在完成后恢复，但在备份和恢复的过程中存在时间差，可能导致系统不稳定或数据丢失。修改`/etc/passwd`后门可能会存在被其他人利用的可能性.
*   `exploit-2.c` 旨在劫持 SUID 二进制文件，虽然示例中使用了 `/usr/bin/sudo`，但攻击者可以替换为其他关键的 SUID 程序，注入恶意代码，从而实现更隐蔽和持久的控制。
*   `compile.sh` 脚本本身较为简单，仅执行编译操作，但如果被修改为在编译过程中插入恶意代码，则可能引入更严重的风险。虽然脚本内容很简单，风险比较低，但是仍然具有一定的风险.

因此，综合考虑以上因素，我评估该仓库的投毒风险为10%。

**利用方式：**

Dirty Pipe漏洞的利用方式主要分为以下几个步骤：

1.  **创建管道：** 创建一个pipe，并填充pipe缓冲区，使pipe_buffer拥有`PIPE_BUF_FLAG_CAN_MERGE`标志。
2.  **排空管道：** 排空管道，但保留一个指向目标页面缓存的引用。
3.  **写入恶意数据：** 向管道写入恶意数据，由于 `pipe_buffer.flags` 未正确初始化，导致可以绕过只读限制，覆盖目标文件内容。

提供的`exploit-1.c`演示了如何修改`/etc/passwd`文件来提升权限。`exploit-2.c`则展示了如何劫持SUID程序。这两种方式都利用了Dirty Pipe漏洞覆盖只读文件或进程内存，从而实现权限提升的目的。

**项目地址:** [ayushx007/CVE-2022-0847-DirtyPipe-Exploits](https://github.com/ayushx007/CVE-2022-0847-DirtyPipe-Exploits)

**漏洞详情:** [CVE-2022-0847](https://nvd.nist.gov/vuln/detail/CVE-2022-0847)