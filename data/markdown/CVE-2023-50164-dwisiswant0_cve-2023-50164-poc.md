## CVE-2023-50164-Apache Struts-路径遍历与远程代码执行

**漏洞编号:** CVE-2023-50164

**漏洞类型:** 路径遍历与远程代码执行

**影响应用:** Apache Struts

**危害等级:** 高危，可能导致任意文件上传和远程代码执行

**影响版本:** 2.0.0 <= version <= 2.5.32, 6.0.0 <= version <= 6.3.0.1

**利用条件:** 需要应用程序存在文件上传功能，并且使用了受影响的Apache Struts版本。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-50164 是 Apache Struts 2 中的一个严重漏洞，允许攻击者通过操纵文件上传参数来执行路径遍历，在某些情况下，这可能导致上传恶意文件，进而实现远程代码执行。

**漏洞分析：**
根据漏洞库信息和搜索结果，该漏洞源于 Apache Struts 在处理文件上传时对路径的验证不足。攻击者可以构造包含路径遍历字符（如`../`）的文件名或路径，从而绕过安全检查，将文件上传到服务器上的任意位置。

**POC有效性：**
提供的POC代码是一个Go程序，它通过以下步骤利用该漏洞：

1.  **WAR文件创建：** 将目标文件压缩成WAR文件， WAR文件相当于一个web项目，里面存放这web项目会执行的jsp等。
2.  **路径检查：** 检查目标路径是否已存在，如果存在则退出。
3.  **文件上传：** 通过修改文件上传参数，尝试将WAR文件上传到目标服务器。
4.  **验证：** 检查上传的文件是否可以通过HTTP访问，以确认上传是否成功。

根据搜索结果和POC代码，该漏洞的利用方式是有效的。多个安全厂商和研究人员已经确认了该漏洞的存在并发布了相关的PoC。

**投毒风险分析：**
查看提供的PoC代码，主要代码功能都集中在利用漏洞本身，没有发现明显的恶意代码或后门。该POC的主要流程是：

1.  生成WAR文件
2.  发送Payload进行攻击
3.  验证Payload是否上传成功

但是，仍然存在一些潜在的投毒风险：

1.  **依赖风险：** 该PoC依赖一些第三方Go模块，这些模块可能存在安全漏洞或被恶意篡改。
2.  **编译风险：** 用户在编译PoC代码时，可能会引入恶意代码。
3.  **参数篡改：** 使用者可能会在使用PoC时修改参数，导致上传的文件包含恶意代码。

总的来说，该PoC代码本身没有明显的投毒代码，但仍然存在一些潜在的风险，需要用户在使用时保持警惕。因此，将投毒风险评估为5%。

**利用方式：**

1.  攻击者构造包含恶意代码（如JSP webshell）的文件。
2.  攻击者使用PoC工具，通过修改文件上传参数，将恶意文件上传到服务器的web目录或其他敏感位置。
3.  攻击者通过访问上传的恶意文件，执行其中的恶意代码，从而控制服务器。

**缓解措施：**

1.  升级到Apache Struts 2.5.33 或 6.3.0.2 或更高版本。
2.  对文件上传进行严格的路径验证和过滤。
3.  限制上传文件的类型。
4.  使用Web应用防火墙（WAF）来检测和阻止恶意文件上传请求。

**项目地址:** [dwisiswant0/cve-2023-50164-poc](https://github.com/dwisiswant0/cve-2023-50164-poc)

**漏洞详情:** [CVE-2023-50164](https://nvd.nist.gov/vuln/detail/CVE-2023-50164)