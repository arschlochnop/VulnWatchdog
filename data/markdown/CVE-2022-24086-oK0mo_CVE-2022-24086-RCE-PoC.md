## CVE-2022-24086 Adobe Commerce (Magento) 远程代码执行

**漏洞编号:** CVE-2022-24086

**漏洞类型:** 远程代码执行

**影响应用:** Adobe Commerce (Magento)

**危害等级:** 高危，未经身份验证的远程代码执行

**影响版本:** 2.3.3-p1 - 2.3.7-p2, 2.4.0 - 2.4.3-p1

**利用条件:** 目标系统存在漏洞版本的Magento，且允许通过网络访问checkout流程

**POC 可用性:** 是

**投毒风险:** 30%

## 详情

CVE-2022-24086是Adobe Commerce和Magento Open Source中存在的一个输入验证漏洞。该漏洞位于checkout流程中，未经身份验证的攻击者可以通过构造恶意的输入，利用Magento的模板引擎进行远程代码执行。官方补丁通过移除或转义模板引擎中使用的双花括号`{{`和`}}`来修复此漏洞。漏洞利用代码分析显示，该PoC主要依赖于Magento的邮件模板功能，攻击者通过精心构造的payload，在邮件模板中注入恶意代码，并在checkout流程中触发邮件发送，从而实现远程代码执行。

**有效性分析：**
根据搜索结果和漏洞利用代码描述，该漏洞已经被广泛证实存在，并且有实际的攻击案例。提供的PoC代码针对特定版本的Magento，验证了该漏洞的可利用性。

**投毒风险分析：**
尽管PoC的README声称不包含任何恶意代码，但是代码仓库声明该PoC用于售卖，并包含"full instruction on penetration, sample payloads and support"。考虑到作者出于经济利益，可能在完整的渗透说明和payload中包含恶意代码（例如，后门或隐蔽的持久化方法），以提高攻击成功率或保持对目标系统的访问。此外，PoC本身可能存在一些难以察觉的漏洞，允许攻击者通过它来传播恶意软件或进行其他恶意活动。因此，存在一定投毒风险。虽然提供的代码本身可能不是直接的恶意代码，但是商业化利用意味着可能存在隐藏的恶意行为。 估算投毒风险为30%。

**利用方式：**
1.  **识别目标版本：** 确定目标Magento的版本是否在受影响的范围内 (2.3.3-p1 - 2.3.7-p2, 2.4.0 - 2.4.3-p1)。
2.  **构造恶意Payload：** 构造包含恶意代码的Payload，利用Magento模板引擎的特性，例如使用`{{`和`}}`注入PHP代码。
3.  **触发漏洞：** 在checkout流程中，通过修改请求参数或POST数据，将构造的Payload注入到邮件模板中。
4.  **执行代码：** 当Magento处理包含恶意Payload的邮件模板时，恶意代码将被执行，从而实现远程代码执行。

**项目地址:** [oK0mo/CVE-2022-24086-RCE-PoC](https://github.com/oK0mo/CVE-2022-24086-RCE-PoC)

**漏洞详情:** [CVE-2022-24086](https://nvd.nist.gov/vuln/detail/CVE-2022-24086)