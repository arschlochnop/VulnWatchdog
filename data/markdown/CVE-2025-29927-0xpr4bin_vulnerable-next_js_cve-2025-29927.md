## CVE-2025-29927-Next.js-Middleware-Bypass

**漏洞编号:** CVE-2025-29927

**漏洞类型:** 权限绕过

**影响应用:** Next.js

**危害等级:** 高危，可能导致未授权访问管理后台及数据泄露

**影响版本:** >= 11.1.4, <= 13.5.6, > 14.0.0, < 14.2.25, > 15.0.0, < 15.2.3

**利用条件:** 应用程序使用了Next.js中间件进行权限验证，并且部署在受影响的版本范围内。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2025-29927 是 Next.js 中间件权限绕过漏洞，由于 Next.js 对 `x-middleware-subrequest` header 处理不当导致。

**有效性：**

根据漏洞库信息和搜索结果，此漏洞的PoC利用代码是有效的。多个信息来源（如Rapid7、JFrog、Zscaler等）都证实了该漏洞的存在和严重性。提供的漏洞利用代码（`middleware.js`）展示了使用cookie进行身份验证，并且在Next.js中间件中进行权限检查的方式。漏洞存在于 `x-middleware-subrequest` 头部的处理上，允许未经授权的用户绕过中间件的身份验证并访问受保护的资源。虽然没有直接给出发送header的利用代码，但利用原理明确。

**投毒风险：**

检查给定的代码仓库是否存在投毒风险。 代码仓库中包含以下文件：

*   `Dockerfile`：用于构建 Docker 镜像，没有发现恶意代码。
*   `Jenkinsfile`：用于 Jenkins 自动化构建，没有发现恶意代码，仅仅用于构建和运行。
*   `README.md`：提供基本的应用信息和运行说明，没有发现恶意代码。
*   `middleware.js`：包含中间件逻辑，用于权限验证，是漏洞的利用点，但不是恶意投毒代码。
*   `package-lock.json`：依赖锁定文件，但内容过长，无法完全分析，存在一定的风险，但是概率较低，假设为10%。

**利用方式：**

1.  **漏洞触发：** 漏洞出现在 Next.js 应用的中间件中，当中间件使用 cookie 进行身份验证时，通过某种方式（例如，修改或添加 `x-middleware-subrequest` header）可以绕过身份验证。
2.  **绕过验证：** 攻击者可以构造特定的 HTTP 请求，包含恶意的 `x-middleware-subrequest` header，使 Next.js 错误地认为该请求是内部子请求，从而绕过中间件的权限检查。
3.  **访问受限资源：** 成功绕过身份验证后，攻击者可以访问原本需要管理员权限才能访问的资源，例如 `/admin` 路径下的页面或 API 端点。

**总结：**

此漏洞利用的有效性高。 漏洞利用方式主要通过构造含有特定header的恶意请求绕过权限验证,利用过程相对简单。虽然主要文件没有明显的投毒代码，但`package-lock.json`文件过大，存在潜在的投毒风险，但不确定性较高。

**项目地址:** [0xpr4bin/vulnerable-next_js_cve-2025-29927](https://github.com/0xpr4bin/vulnerable-next_js_cve-2025-29927)

**漏洞详情:** [CVE-2025-29927](https://nvd.nist.gov/vuln/detail/CVE-2025-29927)