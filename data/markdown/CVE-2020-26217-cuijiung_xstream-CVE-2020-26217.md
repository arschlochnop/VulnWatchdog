## CVE-2020-26217-XStream-远程代码执行

**漏洞编号:** CVE-2020-26217

**漏洞类型:** 远程代码执行

**影响应用:** XStream

**危害等级:** 高危，可能允许远程攻击者执行任意shell命令

**影响版本:** < 1.4.14

**利用条件:** 依赖于黑名单的用户，使用白名单的用户不受影响。需要目标系统运行存在漏洞的XStream版本并且能够解析恶意XML。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于XStream 1.4.14之前的版本中，由于不安全的处理XML数据导致远程代码执行。攻击者可以通过构造恶意的XML输入，利用XStream的反序列化漏洞执行任意shell命令。漏洞利用代码中的`CVE-2020-26217.xml`文件展示了一个利用javax.imageio.spi.FilterIterator和java.lang.ProcessBuilder执行命令的Payload。该POC通过创建`java.lang.ProcessBuilder`实例，并调用其`start`方法来执行系统命令，本例中执行的是`calc`命令。 

**有效性：**
根据漏洞信息和提供的POC代码，可以判断该POC是有效的。漏洞库信息和搜索结果都表明CVE-2020-26217是一个远程代码执行漏洞，而提供的POC代码展示了如何利用该漏洞执行任意命令。

**投毒风险：**
分析提供的文件，`README.md`、`pom.xml`和`src/main/java/Main.java`文件本身不包含恶意代码，主要的Payload位于`CVE-2020-26217.xml`文件中。投毒风险主要在于作者可能在XML文件中嵌入不易察觉的恶意代码，例如更隐蔽的命令执行方式，或尝试利用其他的类执行恶意操作。例如,payload尝试连接特定IP地址以下载并执行文件,或者执行一些敏感操作如读取/etc/shadow文件内容等。由于XML文件本身包含大量序列化的类，人工审查难以完全覆盖所有潜在风险，故认为存在一定的投毒风险，占比10%。

**利用方式：**
1.  攻击者构造恶意的XML文件，该文件包含可以触发远程代码执行的Payload。
2.  攻击者将恶意XML文件发送给使用存在漏洞的XStream版本的目标系统。
3.  目标系统使用XStream解析收到的XML文件。
4.  XStream在解析XML时，由于存在反序列化漏洞，执行了Payload中包含的恶意代码，从而导致远程代码执行。
5.  在给定的POC中,利用了`javax.imageio.spi.FilterIterator`和`java.lang.ProcessBuilder`的组合来执行任意命令.  首先, 创建一个`java.lang.ProcessBuilder`对象,设置要执行的命令(例如`calc`).  然后, 构造一个`javax.imageio.spi.FilterIterator`,  并将ProcessBuilder对象放入其中.  当XStream反序列化这个XML时, 会触发`FilterIterator`的迭代,  进而调用ProcessBuilder的`start`方法, 从而执行预设的命令。

**项目地址:** [cuijiung/xstream-CVE-2020-26217](https://github.com/cuijiung/xstream-CVE-2020-26217)

**漏洞详情:** [CVE-2020-26217](https://nvd.nist.gov/vuln/detail/CVE-2020-26217)