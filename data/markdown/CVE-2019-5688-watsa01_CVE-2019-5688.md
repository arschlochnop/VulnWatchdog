## CVE-2019-5688-NVIDIA-权限提升/信息泄露/DoS

**漏洞编号:** CVE-2019-5688

**漏洞类型:** 权限提升/信息泄露/拒绝服务

**影响应用:** NVIDIA NVFlash, NVUFlash, GPUModeSwitch Tool

**危害等级:** 高危，可能导致权限提升、信息泄露或拒绝服务

**影响版本:** NVFlash, NVUFlash prior to v5.588.0, GPUModeSwitch prior to 2019-11

**利用条件:** 需要管理员权限的身份验证用户

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-5688 存在于 NVIDIA NVFlash, NVUFlash Tool v5.588.0 之前版本以及 GPUModeSwitch Tool 2019-11 之前的版本中。漏洞位于 NVIDIA 内核模式驱动程序 (nvflash.sys, nvflsh32.sys, and nvflsh64.sys) 中。该漏洞允许经过身份验证并具有管理员权限的用户访问未经 NVIDIA 管理的其他设备的设备内存和寄存器，从而可能导致权限提升、信息泄露或拒绝服务。

**漏洞利用分析：**

漏洞利用代码（exploit.py）尝试利用此漏洞，通过以下步骤实现对物理内存的读写：

1.  **打开设备：**  使用 `CreateFileW` 函数尝试打开设备 `\\.\NVFLASH`。
2.  **映射物理内存：**  通过 `DeviceIoControl` 函数发送控制代码 `0x81DE804F` 来映射物理内存地址。 输入缓冲区包含一个魔术数字、物理地址和大小。如果成功，此调用返回一个虚拟地址。
3.  **写入物理内存：**  使用 `memmove` 函数将数据写入映射的虚拟地址，从而写入相应的物理内存。
4.  **读取物理内存：**  类似于写入，使用 `memmove` 函数从映射的虚拟地址读取数据，从而读取相应的物理内存。
5. **测试：** exploit代码中 `test_kernel_write` 函数演示了如何将数据写入物理地址 0x200000（2MB 处），然后从同一地址读取数据以验证写入操作。

**有效性评估：**

根据漏洞描述和漏洞利用代码，此PoC代码似乎有效。它利用了 NVIDIA 驱动程序中的漏洞，允许管理员权限用户访问和修改物理内存。成功利用此漏洞需要目标系统运行受影响版本的 NVIDIA 软件，并拥有管理员权限。

**投毒风险评估：**

通过分析提供的漏洞利用代码，未发现任何明显的恶意代码或后门。该代码的功能是直接的：打开设备、映射物理内存、读写物理内存。所有操作都是为了利用漏洞而设计的，没有发现尝试安装恶意软件、泄露信息或执行其他未经授权的操作的迹象。因此，投毒风险评估为 0%。

**漏洞利用方式总结：**

1.  攻击者需要拥有目标系统的管理员权限。
2.  攻击者运行漏洞利用代码，利用 NVIDIA 驱动程序中的漏洞。
3.  漏洞利用代码通过 `DeviceIoControl` 与驱动程序交互，映射物理内存地址到用户空间。
4.  攻击者可以使用映射的内存地址读写任意物理内存，从而可能导致权限提升、信息泄露或拒绝服务。

**项目地址:** [watsa01/CVE-2019-5688](https://github.com/watsa01/CVE-2019-5688)

**漏洞详情:** [CVE-2019-5688](https://nvd.nist.gov/vuln/detail/CVE-2019-5688)