## CVE-2021-26855-Microsoft Exchange Server Remote Code Execution

**漏洞编号:** CVE-2021-26855

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Microsoft Exchange Server

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** Microsoft Exchange Server 2013 Cumulative Update 21, 2013 Cumulative Update 22, 2013 Cumulative Update 23, 2016 Cumulative Update 8, 2016 Cumulative Update 9, 2016 Cumulative Update 10, 2016 Cumulative Update 11, 2016 Cumulative Update 12, 2016 Cumulative Update 13, 2016 Cumulative Update 14, 2016 Cumulative Update 15, 2016 Cumulative Update 16, 2016 Cumulative Update 17, 2016 Cumulative Update 18, 2016 Cumulative Update 19, 2019 Cumulative Update 1, 2019 Cumulative Update 2, 2019 Cumulative Update 3, 2019 Cumulative Update 4, 2019 Cumulative Update 5, 2019 Cumulative Update 6, 2019 Cumulative Update 7, 2019 Cumulative Update 8

**利用条件:** 需要目标Exchange服务器可访问，且未安装相关安全更新。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-26855 是 Microsoft Exchange Server 中的一个服务器端请求伪造 (SSRF) 漏洞，是 ProxyLogon 攻击链的一部分。未经身份验证的攻击者可以利用此漏洞发送任意 HTTP 请求并冒充管理员进行身份验证，最终造成远程代码执行。

**利用方式：**

1.  **SSRF（CVE-2021-26855）：** 攻击者首先利用 SSRF 漏洞绕过身份验证，获取合法的身份。
2.  **获取SID：** 使用合法的身份，获取用户的SID
3.  **伪造管理员 SID：** 通过篡改已泄露的用户SID，伪造管理员SID
4.  **ProxyLogon：** 使用伪造的管理员 SID 通过 ProxyLogon 攻击链，获得管理员权限。
5.  **写入webshell：** 利用管理员权限，在目标服务器上写入 webshell。
6.  **远程代码执行：** 通过访问 webshell 执行任意代码。

**投毒风险：**
查看提供的POC代码，发现其功能是利用漏洞，在正常情况下，不应存在恶意代码。但是，由于代码逻辑复杂，且依赖外部库（Impacket），存在作者在代码中植入恶意逻辑的可能性。另外，通过分析发现proxylogon.py中的shell_src变量可以自定义，如果被替换成恶意payload，则存在一定风险。

综合考虑，投毒风险评估为10%，主要风险在于代码的可信度以及shell_src变量的替换。

**项目地址:** [TheDudeD6/ExchangeSmash](https://github.com/TheDudeD6/ExchangeSmash)

**漏洞详情:** [CVE-2021-26855](https://nvd.nist.gov/vuln/detail/CVE-2021-26855)