## CVE-2024-23346-pymatgen-代码注入

**漏洞编号:** CVE-2024-23346

**漏洞类型:** 代码注入

**影响应用:** pymatgen

**危害等级:** 高危，可执行任意代码

**影响版本:** < 2024.2.20

**利用条件:** 需要受影响版本的pymatgen库，以及能解析恶意构造的CIF文件

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-23346 存在于 pymatgen 库的 `JonesFaithfulTransformation.from_transformation_str()` 方法中。该方法使用 `eval()` 函数处理输入，导致攻击者可以通过构造恶意的 transformation_string 执行任意代码。PoC 利用了这一点，在 CIF 文件的 `_space_group_magn.transform_BNS_Pp_abc` 字段中嵌入了包含反弹 shell 命令的 Python 代码。利用方式是：攻击者提供一个特制的 CIF 文件，当受害者使用存在漏洞的 pymatgen 版本解析该文件时，嵌入的恶意代码会被执行，从而导致远程代码执行。

**有效性：** 根据漏洞信息和PoC代码，此漏洞利用是有效的。该漏洞利用了 eval 函数执行了任意代码。

**投毒风险：** 提供的 PoC 代码本身就是利用漏洞的代码，不是投毒代码。 仓库中可能存在的投毒风险在于，该仓库意图是作为 Hack The Box (HTB) 渗透测试使用，作者在描述文件或者其他地方隐藏不易察觉的恶意代码的可能性较小，因此将投毒风险评估为较低，大约10%。主要风险在于使用者可能不清楚代码细节，直接使用，如果原作者有恶意，可能存在被利用风险。

**利用方式：**
1.  攻击者创建一个包含恶意 `_space_group_magn.transform_BNS_Pp_abc` 字段的 CIF 文件。
2.  诱导受害者使用存在漏洞的 pymatgen 版本打开或解析该 CIF 文件。
3.  pymatgen 在解析 `_space_group_magn.transform_BNS_Pp_abc` 字段时，会调用 `eval()` 执行其中的恶意代码。
4.  恶意代码在受害者机器上执行，例如反弹 shell。

**项目地址:** [9carlo6/CVE-2024-23346](https://github.com/9carlo6/CVE-2024-23346)

**漏洞详情:** [CVE-2024-23346](https://nvd.nist.gov/vuln/detail/CVE-2024-23346)