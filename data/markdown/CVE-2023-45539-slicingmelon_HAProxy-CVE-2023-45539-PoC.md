## CVE-2023-45539 HAProxy URI 组件解析漏洞

**漏洞编号:** CVE-2023-45539

**漏洞类型:** URI解析漏洞/信息泄露

**影响应用:** HAProxy

**危害等级:** 中危，可能导致敏感信息泄露或未授权访问

**影响版本:** < 2.8.2

**利用条件:** HAProxy配置中使用了 path_end 或正则表达式ACL进行路由

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2023-45539 漏洞存在于HAProxy 2.8.2之前的版本中。由于HAProxy在URI组件中接受'#'字符，攻击者可以通过构造包含'#'字符的URI，结合HAProxy的 path_end 规则，绕过访问控制，将请求错误地路由到静态资源服务器，或者其他后端服务。根据提供的PoC代码，该漏洞的利用方式是：

1.  HAProxy配置了使用 `path_end` ACL根据文件扩展名路由请求的规则。
2.  攻击者构造一个包含'#'字符的URL，例如 `/admin#.png`。
3.  HAProxy错误地将该请求路由到静态资源服务器，即使`/admin`路径原本是被禁止访问的。

**有效性：**
根据PoC代码和漏洞描述，该漏洞利用是有效的。PoC通过修改URI，利用HAProxy对'#'字符处理的缺陷，绕过了原本的访问限制。

**投毒风险：**
查看提供的PoC代码，包括 `README.md`, `docker-compose.yaml`, `haproxy.cfg`。这些文件只是为了演示和复现该漏洞，不存在作者隐藏的后门或恶意代码。

`docker-compose.yaml` 使用了易受攻击的HAProxy版本（2.8.1），但这不是投毒，而是为了演示漏洞。

`haproxy.cfg` 文件配置了前端和两个后端（`be_static` 和 `be_app`），并使用 `path_end` ACL 规则进行路由，模拟了漏洞存在的环境。`be_app` 后端包含一个 `http-request deny` 规则来模拟受保护的 `/admin` 目录。这也不是投毒，而是为了演示漏洞的绕过。

因此，该仓库中不存在投毒代码，风险为0%。

**利用方式：**
1.  攻击者需要确定目标HAProxy服务器的版本低于2.8.2，并且配置中使用了 `path_end` 或正则表达式 ACL进行路由。
2.  攻击者构造包含'#'字符的恶意URI，例如：`/<受保护的路径>#.<静态资源扩展名>`。
3.  如果配置正确，HAProxy会将该请求错误地路由到静态资源服务器，导致未授权访问。


**项目地址:** [slicingmelon/HAProxy-CVE-2023-45539-PoC](https://github.com/slicingmelon/HAProxy-CVE-2023-45539-PoC)

**漏洞详情:** [CVE-2023-45539](https://nvd.nist.gov/vuln/detail/CVE-2023-45539)