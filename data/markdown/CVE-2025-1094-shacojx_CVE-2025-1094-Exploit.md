## CVE-2025-1094-PostgreSQL-SQL注入

**漏洞编号:** CVE-2025-1094

**漏洞类型:** SQL注入

**影响应用:** PostgreSQL

**危害等级:** 高危，可能导致数据泄露和远程代码执行

**影响版本:** < 17.3, < 16.7, < 15.11, < 14.16, < 13.19

**利用条件:** 需要数据库连接和特定的client/server encoding配置(BIG5, EUC_TW, MULE_INTERNAL)

**POC 可用性:** 是

**投毒风险:** 20%

## 详情

CVE-2025-1094 漏洞是 PostgreSQL 中由于不正确的引用语法中和导致的 SQL 注入漏洞。漏洞存在于 `PQescapeLiteral()`, `PQescapeIdentifier()`, `PQescapeString()`, 和 `PQescapeStringConn()` 等libpq函数中，以及 psql 命令行工具。\n\n**漏洞利用方式：**\n\n1.  **SQL 注入：** 攻击者通过构造恶意的 SQL 语句，利用 `lo_export` 函数读取服务器上的敏感文件，例如 `/etc/passwd`。payload首先使用 `pg_read_file`读取文件内容,然后使用`convert_from`将内容转换为UTF8编码。\n2.  **WebSocket 劫持（PoC 中的利用方式）：** 该 PoC 尝试劫持一个已建立的 WebSocket 连接，并发送恶意 payload，以执行远程代码。\n3.  **远程代码执行（RCE）：** 通过反弹 shell，攻击者可以完全控制服务器。\n\n**投毒风险分析：**\n\nPoC 代码包含一个WebSocket劫持部分，其中包含一段python反弹shell的代码，需要将`REVERSE_IP`和`REVERSE_PORT`替换为攻击者控制的地址。该部分有风险，需要使用者确认该地址为其所拥有。如果该部分地址不是poc使用者所控制的,那么相当于poc使用者主动连接了poc编写者的服务器,存在一定的风险，但是不属于典型的投毒。\n
此外，PoC 代码依赖于特定版本的 JDK (22) 和 okhttp3 库，如果构建环境与预期不符，可能导致 PoC 无法正常运行。虽然这增加了使用难度，但并不构成主动投毒行为。\n
SQL注入本身就存在一定的数据库被植入后门的风险.但是该风险是SQL注入攻击本身具有的,不能算是POC的投毒风险.综合来看，POC 代码存在一定风险，但不属于典型的投毒行为，主要是webshell劫持部分需要确认。\n\n**缓解措施：**\n\n*   在引用输入之前，确认输入通过编码验证。\n*   升级到 PostgreSQL 17.3, 16.7, 15.11, 14.16, 或 13.19 或更高版本。

**项目地址:** [shacojx/CVE-2025-1094-Exploit](https://github.com/shacojx/CVE-2025-1094-Exploit)

**漏洞详情:** [CVE-2025-1094](https://nvd.nist.gov/vuln/detail/CVE-2025-1094)