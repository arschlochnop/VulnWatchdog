## CVE-2020-1472 Zerologon权限提升漏洞

**漏洞编号:** CVE-2020-1472

**漏洞类型:** 权限提升

**影响应用:** Windows Server

**危害等级:** 高危，允许未授权的攻击者接管域控制器

**影响版本:** 受影响的Windows Server版本见漏洞库信息

**利用条件:** 攻击者需要位于与域控制器相同的网络，并且能够与其建立Netlogon连接。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-1472，又名Zerologon，是一个影响Windows Server Netlogon协议的权限提升漏洞。攻击者通过将域控制器的Netlogon密码置零，可以有效地禁用其身份验证机制。由于Netlogon协议在身份验证过程中使用AES-CFB8加密，但实现上存在缺陷，导致可以通过多次尝试将密码归零。

**有效性：**
提供的PoC代码 `zeroLogon_toShell.py` 尝试利用Zerologon漏洞将域控制器的Netlogon密码置零，然后利用`evil-winrm`工具获取域控制器的shell。根据搜索引擎结果和漏洞描述，该漏洞已经有公开的PoC，因此该代码的有效性较高。需要注意的是，利用成功需要提供有效的Administrator NTLM哈希。

**投毒风险：**
查看PoC代码，发现其主要功能是利用Zerologon漏洞，然后尝试使用`evil-winrm`连接到域控制器。代码中存在执行操作系统命令的部分 (`os.system`)，这部分存在潜在的投毒风险。例如，攻击者可能会修改`os.system`执行的命令，在受害者不知情的情况下安装后门或执行其他恶意操作。虽然目前的PoC看起来直接调用了`evil-winrm`，但攻击者可能插入额外的命令。代码还包含从用户那里获取Administrator NTLM Hash的部分，攻击者可以将获取到的hash发送到远程服务器，进行下一步利用。由于代码主要依赖于已知的漏洞利用方法，且没有发现明显的恶意代码，因此投毒风险为较低，估计为10%。

**利用方式：**
1.  **连接到域控制器：** 攻击者需要位于与目标域控制器相同的网络中。需要知道目标域控制器的NetBIOS名称和IP地址。
2.  **利用Zerologon漏洞：** 攻击者运行PoC脚本，该脚本尝试通过发送一系列特制的Netlogon请求将域控制器的密码置零。这个过程可能需要多次尝试。
3.  **恢复或者直接利用：**成功利用漏洞后，域控制器的密码被置零。原始exp需要先恢复机器账户密码，但是该PoC是直接输入Administrator NTLM Hash连接。攻击者可以使用`evil-winrm`等工具，使用置零密码或者Administrator NTLM Hash远程连接到域控制器。
4.  **权限提升：** 通过`evil-winrm`连接到域控制器后，攻击者拥有了系统权限，可以执行任意操作，例如添加域管理员账号、窃取敏感数据等。

**项目地址:** [c3rrberu5/ZeroLogon-to-Shell](https://github.com/c3rrberu5/ZeroLogon-to-Shell)

**漏洞详情:** [CVE-2020-1472](https://nvd.nist.gov/vuln/detail/CVE-2020-1472)