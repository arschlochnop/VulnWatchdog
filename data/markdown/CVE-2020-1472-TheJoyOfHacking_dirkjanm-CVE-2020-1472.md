## CVE-2020-1472 (Zerologon)

**漏洞编号:** CVE-2020-1472

**漏洞类型:** 权限提升

**影响应用:** Windows Server Netlogon

**危害等级:** 高危，可能导致域接管

**影响版本:** 受影响的Windows Server版本包括Windows Server 2008 R2 SP1, 2012, 2012 R2, 2016, 2019, 2004, 1903, 1909, 20H2

**利用条件:** 攻击者需要位于与域控制器相同的网络中

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-1472，也被称为Zerologon，是一个Windows Server Netlogon协议中的权限提升漏洞。未经身份验证的攻击者可以通过建立一个脆弱的Netlogon安全通道连接到域控制器来利用此漏洞，从而获得域管理员权限。

**有效性：**

提供的POC代码通过将域控制器的机器账户密码设置为零来利用该漏洞。成功利用后，攻击者可以使用DCSync获取域凭据，从而控制整个域。根据漏洞信息和搜索结果，该POC代码的有效性较高，已被广泛使用。

**投毒风险：**

该仓库中可能存在的投毒风险评估为10%。 风险主要来源于以下几个方面：

1.  **密码重置风险：** POC 默认会将域控制器的机器账户密码重置为空，这会导致与其它域控制器的通信中断。虽然脚本提供了恢复密码的方法，但如果操作不当或者恢复流程失败，可能会导致域功能异常。
2.  **依赖关系：** POC 依赖于 impacket 库的特定版本，如果使用错误的版本可能会导致脚本运行失败或产生未知的副作用。
3.  **脚本修改：** 下载的脚本可能被恶意修改，例如添加额外功能（后门）。尽管此POC的核心功能是已知的，但仍然存在下载后被修改的可能性。 虽然风险较低，但用户应始终从可信来源下载代码并进行代码审计。

**利用方式：**

1.  攻击者首先使用提供的`cve-2020-1472-exploit.py`脚本，指定目标域控制器的IP地址和NetBIOS名称。此脚本会尝试将域控制器的机器账户密码设置为零。
2.  如果攻击成功，攻击者可以使用`secretsdump.py`（Impacket库的一部分）从域控制器中提取域凭据，包括域管理员账户的哈希值。
3.  攻击者可以使用提取到的域管理员凭据来控制整个域。
4.  为了避免影响域控制器的正常运行，攻击者可以使用`restorepassword.py`脚本，配合从注册表中dump出的hex password（通过 secretsdump 获得），将域控制器的机器账户密码恢复为原始密码。

**修复建议：**

*   安装Microsoft官方发布的补丁。
*   监控网络中是否存在利用CVE-2020-1472的攻击行为。
*   强制执行签名和加密的Netlogon通信。


**项目地址:** [TheJoyOfHacking/dirkjanm-CVE-2020-1472](https://github.com/TheJoyOfHacking/dirkjanm-CVE-2020-1472)

**漏洞详情:** [CVE-2020-1472](https://nvd.nist.gov/vuln/detail/CVE-2020-1472)