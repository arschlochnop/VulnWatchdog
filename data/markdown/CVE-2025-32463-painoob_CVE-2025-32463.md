## CVE-2025-32463 – Sudo chroot Escape

**漏洞编号:** CVE-2025-32463

**漏洞类型:** 本地权限提升

**影响应用:** Sudo

**危害等级:** 高危，本地用户可获取 root 权限

**影响版本:** 1.9.14 到 1.9.17p1 (不包含 1.9.17p1)

**利用条件:** 本地用户，并且sudoers配置文件中存在CHROOT配置

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2025-32463 允许本地用户通过利用 Sudo 的 `--chroot` 选项和用户可控的 `/etc/nsswitch.conf` 文件获取 root 访问权限。漏洞利用方式如下：

1.  **漏洞原理：** Sudo 在使用 `--chroot` 选项时，如果使用了用户可控目录下的 `/etc/nsswitch.conf` 文件，可能导致加载恶意共享库，从而提升权限。

2.  **利用步骤：**
    *   创建一个临时目录`${STAGE}`。
    *   在临时目录中创建 `woot1337.c` 文件，该文件包含一个构造函数`woot()`，该函数通过`setreuid(0,0)`和`setregid(0,0)`将进程的uid和gid设置为0，然后将当前目录更改为根目录，最后执行 `/bin/bash`，从而获得 root shell。
    *   创建 `woot/etc` 和 `libnss_` 目录，并将 `/etc/group` 复制到 `woot/etc` 目录中。
    *   创建一个 `woot/etc/nsswitch.conf` 文件，其中包含 `passwd: /woot1337`，指示系统使用 `/woot1337` 文件来解析密码。
    *   使用 `gcc` 编译 `woot1337.c` 文件，生成一个共享库 `libnss_/woot1337.so.2`。`-Wl,-init,woot` 参数指定 `woot` 函数作为初始化函数。
    *   使用 `sudo -R woot woot` 命令，其中 `-R woot` 表示使用 `woot` 目录作为 chroot 环境，`woot` 是一个不存在的命令，但是由于 `nsswitch.conf` 被配置为使用恶意共享库，所以会加载并执行恶意代码。
    *   清理临时目录。

3.  **有效性：** 根据漏洞信息、搜索结果和提供的 POC 代码，该漏洞利用的有效性较高。多个来源证实了该漏洞的存在，并且提供了可利用的 POC 代码。

4.  **投毒风险：** 虽然 POC 代码的主要目的是利用漏洞，但仍存在一定的投毒风险。例如，`woot1337.c` 中可以插入额外的恶意代码，这些代码会在提权后执行。例如添加反弹shell，或者其他不必要的文件操作。由于该脚本执行环境在用户控制下，有添加恶意代码的可能。因此，投毒风险评估为10%。主要是基于对于`woot1337.c`内容是否完全可信。

5.  **利用限制：** 该漏洞利用需要在 `sudoers` 文件中配置了 `CHROOT` 选项，并且允许用户使用 `sudo` 执行特定的命令。

**项目地址:** [painoob/CVE-2025-32463](https://github.com/painoob/CVE-2025-32463)

**漏洞详情:** [CVE-2025-32463](https://nvd.nist.gov/vuln/detail/CVE-2025-32463)