## CVE-2019-18935 - Telerik UI for ASP.NET AJAX 反序列化远程代码执行

**漏洞编号:** CVE-2019-18935

**漏洞类型:** .NET 反序列化漏洞

**影响应用:** Telerik UI for ASP.NET AJAX

**危害等级:** 高危，可导致远程代码执行

**影响版本:** <= 2019.3.1023

**利用条件:** 目标系统使用了存在漏洞的Telerik UI版本，并且已知加密密钥（或者使用了默认密钥），或者上传目录可写，以及允许执行上传的aspx文件。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2019-18935 存在于 Progress Telerik UI for ASP.NET AJAX 中，是一个 .NET 反序列化漏洞，位于 RadAsyncUpload 函数中。当由于 CVE-2017-11317 或 CVE-2017-11357 的存在，或者通过其他方式得知加密密钥时，此漏洞可被利用。

**有效性：**
根据漏洞库信息、搜索结果和提供的漏洞利用代码，此漏洞利用是有效的。漏洞库信息明确指出漏洞存在于2019.3.1023及之前的版本，搜索结果也确认了该漏洞已被积极利用，并可能导致远程代码执行。提供的漏洞利用代码 `RCE.py` 实现了利用该漏洞的PoC。

**投毒风险：**
代码中存在轻微的投毒风险，约为5%。因为`ysoserial.exe`的来源无法完全保证，如果它被替换为恶意版本，可能会导致攻击者在受害者机器上执行任意代码。此外，利用代码的执行依赖于`mono`环境，如果受害者环境中存在恶意的mono运行时，也会引入安全风险，但总的来说，代码本身的目的就是利用已知漏洞进行RCE，并非伪装成正常功能。

**利用方式：**
1.  **确定目标使用了存在漏洞的 Telerik UI for ASP.NET AJAX 版本。**
2.  **获取加密密钥。** 如果目标使用了默认密钥，或者存在 CVE-2017-11317 或 CVE-2017-11357 等漏洞可用于获取密钥，则可以利用已知密钥进行攻击。否则，可能需要爆破或通过其他方式获取密钥。
3.  **使用 ysoserial.exe 生成恶意 payload。**  `RCE.py` 脚本使用 `ysoserial.exe` 生成 .NET 反序列化 payload，该 payload 包含要执行的恶意命令。
4.  **编码 payload。**  生成的 payload 被 Base64 编码，然后进行 URL 编码。
5.  **通过 RadAsyncUpload 函数发送 payload。**  编码后的 payload 被作为 `application/octet-stream` 发送到 `Telerik.Web.UI.WebResource.axd?type=rau` 端点。攻击者需要找到目标系统上该路径。`RCE.py` 会提示用户输入目标URL。
6.  **执行任意代码。**  如果漏洞利用成功，服务器将反序列化 payload，从而执行攻击者指定的恶意命令。
7.  **扫描 webshell。** `RCE.py`尝试在常见上传目录查找是否webshell上传成功,并尝试通过webshell执行命令。用户可以添加额外的上传目录，以增加webshell被发现的概率。脚本通过向webshell发送`cmd=whoami`来验证webshell是否有效。

**项目地址:** [clarkvoss/telerik](https://github.com/clarkvoss/telerik)

**漏洞详情:** [CVE-2019-18935](https://nvd.nist.gov/vuln/detail/CVE-2019-18935)