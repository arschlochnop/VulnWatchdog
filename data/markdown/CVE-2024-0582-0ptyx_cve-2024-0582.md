## CVE-2024-0582 - Linux Kernel io_uring Use-After-Free

**漏洞编号:** CVE-2024-0582

**漏洞类型:** Use-After-Free

**影响应用:** Linux Kernel

**危害等级:** 高危，可能导致提权和拒绝服务

**影响版本:** < 6.4.0

**利用条件:** 本地用户权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-0582 是 Linux 内核 io_uring 子系统中的一个 use-after-free 漏洞。根据漏洞库信息和搜索结果，该漏洞存在于用户通过 IORING_REGISTER_PBUF_RING 注册buffer ring, mmap() 之后释放的情况下。

**有效性分析：**
提供的POC代码尝试利用此漏洞。`exp.c` 中的代码展示了注册 buffer ring, mmap 映射，可能存在释放后的访问。结合搜索结果中`ysanatomic/io_uring_LPE-CVE-2024-0582`项目以及`Mind the Patch Gap: Exploiting an io_uring Vulnerability in Ubuntu`文章，可以推断POC具有一定的有效性。

**投毒风险分析：**
分析提供的Makefile文件，脚本 `run_dbg.sh` 和C代码 `exp.c`, `test.c`，并未发现明显的恶意代码。
*   `Makefile` 只是编译exp和test程序。
*   `run_dbg.sh` 是一个qemu调试脚本，用于在虚拟机环境中运行和调试内核，方便利用，不存在投毒代码。
*   `exp.c` 通过 io_uring 接口注册、映射和释放 buffer ring，核心利用逻辑基于公开的漏洞信息。

但是，`PoC for CVE-2024-0582`代码中 `I will not be releasing a write-up for this vulnerability as my method of exploitation is almost the same as for CVE-2023-2598.` 这句话表明作者可能借鉴了之前的漏洞利用方法，为了增加成功率和绕过检测，作者可能隐藏了一些细节,因此有一定的投毒风险。总体风险较低,判断为10%。

**利用方式：**
1.  **注册 Buffer Ring：** 使用 `io_uring_register_buf_ring` 注册一个 buffer ring。
2.  **内存映射 (mmap)：** 使用 `mmap` 将注册的 buffer ring 映射到用户空间。
3.  **释放 Buffer Ring：** 触发漏洞，释放 buffer ring 后，在某些情况下可能仍然存在对该内存区域的访问。
4.  **Use-After-Free：**  利用释放后仍然存在的指针，执行恶意操作，例如修改其他内核数据结构，从而实现提权或拒绝服务。

总的来说，该漏洞利用需要对 io_uring 机制有一定的了解，并且需要根据具体的内核版本和配置进行调整。提供的PoC代码为本地提权漏洞利用提供了基础。

**项目地址:** [0ptyx/cve-2024-0582](https://github.com/0ptyx/cve-2024-0582)

**漏洞详情:** [CVE-2024-0582](https://nvd.nist.gov/vuln/detail/CVE-2024-0582)