## CVE-2022-0739-BookingPress-SQL注入

**漏洞编号:** CVE-2022-0739

**漏洞类型:** SQL注入

**影响应用:** BookingPress

**危害等级:** 高危，可能导致数据泄露、权限提升和远程代码执行

**影响版本:** < 1.0.11

**利用条件:** 需要目标WordPress网站安装了BookingPress插件，并且版本低于1.0.11，同时需要能够通过网络访问目标网站的/wp-admin/admin-ajax.php接口。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-0739是BookingPress WordPress插件1.0.11版本之前存在的一个未经身份验证的SQL注入漏洞。攻击者可以利用`bookingpress_front_get_category_services` AJAX action，通过构造恶意的SQL语句，在数据库中执行任意SQL命令。该漏洞利用方式如下：

1.  **漏洞点：** `bookingpress_front_get_category_services` AJAX action
2.  **利用前提：** BookingPress插件版本低于1.0.11且未经身份验证。
3.  **利用方法：**
    *   获取有效的`_wpnonce`值。
    *   构造POST请求，`action`参数为`bookingpress_front_get_category_services`， `_wpnonce`参数为获取到的nonce值，`category_id`参数可以为任意整数， `total_service`参数包含SQL注入payload。
    *   SQL注入发生在`total_service`参数中，攻击者可以在该参数中插入恶意SQL代码，例如`UNION ALL SELECT`语句，从而读取数据库中的敏感信息。

提供的PoC代码 `booking-press-expl.py` 的有效性分析：

*   该PoC脚本首先通过发送包含`@@VERSION`的SQL注入payload来检测目标是否易受攻击，如果成功返回数据库版本信息，则证明漏洞存在。
*   然后，PoC利用SQL注入获取WordPress用户表`wp_users`中的用户名、邮箱和密码哈希。
*   PoC代码使用 `limit 1 offset {off}` 循环遍历用户表，逐步提取所有用户信息。

投毒风险分析：

*   PoC代码本身主要用于验证漏洞和提取用户信息，不包含恶意功能，例如写入webshell或修改数据库内容，所以投毒风险为0%。
*   代码清晰，功能明确，没有发现任何隐藏或可疑代码。

总结：提供的PoC代码能够有效利用CVE-2022-0739漏洞，实现对WordPress数据库的未授权访问，提取敏感用户信息。该PoC不包含投毒代码，风险较低。

**项目地址:** [destr4ct/CVE-2022-0739](https://github.com/destr4ct/CVE-2022-0739)

**漏洞详情:** [CVE-2022-0739](https://nvd.nist.gov/vuln/detail/CVE-2022-0739)