## CVE-2024-53677-Apache Struts文件上传路径穿越导致RCE

**漏洞编号:** CVE-2024-53677

**漏洞类型:** 文件上传路径穿越导致远程代码执行

**影响应用:** Apache Struts

**危害等级:** 高危，可能导致远程代码执行和服务器完全控制

**影响版本:** 2.0.0 < version < 6.4.0

**利用条件:** 需要目标系统运行受影响版本的Apache Struts，并且使用了基于 FileUploadInterceptor 的文件上传逻辑

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-53677是Apache Struts 2中的一个文件上传漏洞。攻击者可以操纵文件上传参数，实现路径穿越，将恶意文件上传到任意目录，从而可能导致远程代码执行。

**有效性评估：**

根据漏洞描述、搜索结果和提供的漏洞利用代码，该漏洞的POC代码是有效的。搜索引擎结果均表明这是一个高危漏洞，且存在被利用的风险。POC代码提供了一个Docker环境，用于复现该漏洞。README.md 文件中描述了如何构建和运行该环境，以及漏洞利用的关键修改，例如使用 FileUploadInterceptor 和禁用文件类型验证，进一步降低了复现漏洞的难度。

**投毒风险评估：**

*   **Dockerfile：** Dockerfile用于构建包含漏洞的Struts2应用，本身不包含恶意代码。使用Tomcat作为容器，并复制编译好的WAR包部署。
*   **README.md：** 提供了漏洞复现环境的搭建说明，没有发现恶意代码。
*   **context.xml：** Tomcat的上下文配置文件，设置了一些安全属性，如`antiResourceLocking`和`privileged`，以及CookieProcessor，虽然可能存在配置错误导致其他问题，但本身不是投毒代码。
*   **tomcat-users.xml：** 用于配置Tomcat的用户和角色，包含一个默认的管理员账户admin/trackflaw，这本身是**非常危险**的，因为它使用了一个硬编码的密码。虽然这个默认账户方便漏洞验证，但在真实环境中应该**立即删除或修改密码**。将默认密码作为投毒行为的风险评估较低，因为这通常被认为是配置不当，而非恶意植入。
*   **struts-app/mvnw：** Maven Wrapper，用于在没有安装Maven的环境下构建项目，没有发现恶意代码。

总体评估，代码本身未发现明显的恶意后门。高危操作是设置了默认Tomcat管理员账户，**但这个缺陷更偏向于配置问题，而非有意植入的后门**。考虑到默认账号和密码可能被利用，存在一定的安全风险，将投毒风险评估为10%。

**利用方式分析：**

1.  **环境搭建：** 使用提供的Dockerfile构建包含漏洞的Struts2应用。
2.  **路径穿越：** 通过修改文件上传的参数（例如文件名），构造包含“../”的路径，使文件上传到web目录之外的位置，例如Tomcat的`webapps`目录之外。
3.  **上传恶意文件：** 上传包含恶意代码的文件，例如JSP Webshell。
4.  **远程代码执行：** 通过访问上传的恶意文件，触发恶意代码的执行，从而获得服务器的控制权。

关键在于构造恶意的文件名，利用路径穿越绕过Struts的文件上传检查，将恶意文件上传到可执行的位置。

**项目地址:** [c4oocO/CVE-2024-53677-Docker](https://github.com/c4oocO/CVE-2024-53677-Docker)

**漏洞详情:** [CVE-2024-53677](https://nvd.nist.gov/vuln/detail/CVE-2024-53677)