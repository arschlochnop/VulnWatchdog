## CVE-2022-42889 - Apache Commons Text RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** < 1.10.0 (1.5 - 1.9)

**利用条件:** 应用使用了受影响版本的Apache Commons Text，并且允许用户可控的输入被用于变量插值

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-42889，也被称为Text4Shell，是Apache Commons Text库中的一个严重漏洞。该漏洞源于库中存在不安全的变量插值默认设置，允许攻击者在处理不可信的输入时执行任意代码。漏洞存在于1.5到1.9版本的Apache Commons Text中。 

**有效性：**根据漏洞库信息、搜索引擎结果和已知的利用案例，该漏洞利用是有效的。许多文章都确认了其远程代码执行的能力。

**投毒风险：** 提供的代码片段是一个`CONTRIBUTING.md`文件，它与漏洞本身无关，而是Apache Commons Text项目的贡献指南。 虽然贡献指南本身不会造成直接的投毒，但若攻击者恶意修改构建脚本或其它代码并提交PR，存在潜在的投毒风险。这个`CONTRIBUTING.md`文件中隐藏恶意代码的可能性极低，因为此文件本身不是可执行代码，混淆难度大，容易被发现。因此判断投毒风险较低，约为5%。

**利用方式：**
1.  **利用变量插值：** 攻击者需要找到应用程序中使用Apache Commons Text进行变量插值的地方。
2.  **构造恶意输入：** 攻击者构造包含恶意表达式的输入字符串，例如使用`script`，`dns`，或`url`前缀的表达式。例如 `${script:javascript:java.lang.Runtime.getRuntime().exec('touch /tmp/pwned')}`。
3.  **触发代码执行：** 当应用程序使用Apache Commons Text处理该输入时，库会尝试解析并执行恶意表达式，从而导致远程代码执行。

**缓解措施：**
*   升级到Apache Commons Text 1.10.0或更高版本，该版本默认禁用了有问题的插值器。
*   禁用或限制在变量插值中使用`script`、`dns`和`url`等前缀。
*   对所有用户提供的输入进行严格的验证和清理。

**项目地址:** [shoucheng3/asf__commons-text_CVE-2022-42889_1-9](https://github.com/shoucheng3/asf__commons-text_CVE-2022-42889_1-9)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)