## CVE-2024-12084-rsync-堆缓冲区溢出

**漏洞编号:** CVE-2024-12084

**漏洞类型:** 堆缓冲区溢出

**影响应用:** rsync

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 3.2.7 和 3.3.0

**利用条件:** 需要目标 rsync 服务开启，且协议版本为 31.0

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-12084 存在于 rsync 守护进程中，是由于对攻击者可控的校验和长度（s2length）处理不当造成的堆缓冲区溢出。当 MAX_DIGEST_LEN 超过固定 SUM_LENGTH（16 字节）时，攻击者可以在 sum2 缓冲区中进行越界写入，从而实现远程代码执行。

**有效性：**
提供的 POC 代码是一个 Nuclei 模板，用于检测 rsync 服务是否容易受到 CVE-2024-12084 攻击。该模板通过检查 rsync 服务的协议版本是否为 31.0 来判断目标是否存在漏洞。如果协议版本匹配，则认为目标容易受到攻击。这个检测方法是基于协议版本与漏洞版本之间的关联，因此是有效的。

**投毒风险：**
检查提供的文件 `LICENSE`, `README.md`, `template.yaml`。`LICENSE` 是 MIT 许可证，属于标准协议。 `README.md` 文件描述了漏洞和如何使用 Nuclei 模板进行检测。`template.yaml` 文件包含 Nuclei 模板的具体配置，它定义了如何发送请求以及如何识别 rsync 服务的协议版本。仔细检查了 Nuclei 模板代码，没有发现任何尝试进行恶意操作的代码。此仓库中没有发现隐藏的投毒代码，因此投毒风险为 0%。

**利用方式：**
1.  攻击者需要建立与易受攻击的 rsync 服务器的连接。
2.  攻击者在数据传输过程中发送特制的校验和长度 (s2length)，使其大于 SUM_LENGTH (16 字节)。
3.  当 rsync 守护进程处理此校验和时，由于不正确的边界检查，它会将数据写入 sum2 缓冲区之外，导致堆缓冲区溢出。
4.  攻击者可以通过控制溢出的数据来覆盖堆上的其他数据结构，最终实现远程代码执行。
简而言之，利用方式是通过发送特制的 rsync 协议数据包，其中包含过长的校验和长度，从而触发堆缓冲区溢出并实现远程代码执行。

**项目地址:** [rxerium/CVE-2024-12084](https://github.com/rxerium/CVE-2024-12084)

**漏洞详情:** [CVE-2024-12084](https://nvd.nist.gov/vuln/detail/CVE-2024-12084)