## CVE-2025-29927-Next.js Middleware 权限绕过

**漏洞编号:** CVE-2025-29927

**漏洞类型:** 权限绕过

**影响应用:** Next.js

**危害等级:** 高危，可能导致未授权访问敏感数据

**影响版本:** >= 11.1.4, <= 13.5.6; > 14.0.0, < 14.2.25; > 15.0.0, < 15.2.3

**利用条件:** 目标应用使用Next.js中间件进行权限验证，且版本在受影响范围内

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2025-29927 是一个 Next.js 中间件权限绕过漏洞。当权限验证逻辑存在于 Next.js 中间件时，攻击者可以通过设置 `x-middleware-subrequest` 请求头绕过权限验证，访问受保护的资源。

**有效性：**

根据漏洞库信息、搜索引擎结果以及提供的POC代码，可以判断该漏洞利用是有效的。POC代码提供了一个简单的Next.js应用，其中包含一个受保护的 `/admin` 路由，该路由受到中间件保护。POC代码中详细描述了利用 `x-middleware-subrequest` 请求头绕过中间件验证访问 `/admin` 路由的方法，并提供了多种利用方式，包括浏览器扩展、JavaScript Console、cURL和Python Requests。

**投毒风险：**

评估POC代码，发现投毒风险较低，约 5%。 主要风险点可能存在于开发者对POC代码的依赖以及后期修改，但从提供的代码本身来看，除了演示漏洞利用外，没有发现任何恶意或隐藏的代码。

**利用方式：**

1.  **发送包含特定`x-middleware-subrequest`头的HTTP请求。** 根据Next.js版本，`x-middleware-subrequest`头的值可能有所不同，例如 `middleware`、`src/middleware` 或 `middleware:middleware:middleware:middleware:middleware`。
2.  **绕过中间件的身份验证。** 通过发送包含上述头的请求，中间件的身份验证逻辑被绕过，攻击者可以直接访问受保护的资源。
3.  **访问受保护的路由。** 成功绕过身份验证后，攻击者可以访问例如`/admin`之类的受保护路由，并执行未授权操作。

**缓解措施：**

*   升级到Next.js 15.2.3+ (14.2.25+ for 14.x)。
*   在代理/CDN级别阻止`x-middleware-subrequest`请求头。
*   实施额外的服务器端验证。

**项目地址:** [aayush256-sys/next-js-auth-bypass](https://github.com/aayush256-sys/next-js-auth-bypass)

**漏洞详情:** [CVE-2025-29927](https://nvd.nist.gov/vuln/detail/CVE-2025-29927)