## CVE-2025-24813 Apache Tomcat Path Equivalence and Deserialization RCE

**漏洞编号:** CVE-2025-24813

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Tomcat

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** 9.0.0.M1 - 9.0.98, 10.1.0-M1 - 10.1.34, 11.0.0-M1 - 11.0.2

**利用条件:** 需要满足多个条件：默认Servlet的写入已启用（默认禁用），启用partial PUT，应用程序使用Tomcat基于文件的会话持久化，应用程序包含一个可能在反序列化攻击中被利用的库。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2025-24813 是 Apache Tomcat 中的一个路径等价漏洞，利用 `file.Name` (内部点) 导致远程代码执行、信息泄露或恶意内容添加到上传的文件中。漏洞存在于默认Servlet的写入功能启用时。

**有效性分析：**

提供的 Python 脚本 (CVE-2025-24813.py) 尝试利用此漏洞。脚本包含以下关键步骤：

1.  **检查可写Servlet：** `check_writable_servlet` 函数检查目标 URL 是否可通过 PUT 方法写入。
2.  **生成 Payload：** 脚本可以生成 ysoserial payload 或 Java payload。ysoserial payload 使用指定的 gadget 来执行命令。Java payload 将命令编译成 .class 文件并打包到 JAR 文件中。
3.  **上传 Payload：** `upload_and_verify_payload` 函数尝试将生成的 payload 上传到 `target_url/uploads/../sessions/{session_id}.session`。如果上传成功并返回 409 冲突，则脚本尝试发送一个带有伪造的JSESSIONID cookie的 GET 请求，并期望获得 500 内部服务器错误，这表明漏洞利用可能成功。

**投毒风险分析：**

该脚本存在少量投毒风险，风险点在于:
*   `generate_ysoserial_payload` 函数允许指定 `ysoserial_path` 和 `gadget`。虽然脚本本身没有植入恶意代码，但如果用户使用了被篡改的 ysoserial.jar 或选择了恶意的 gadget，则可能执行任意代码。用户需要自行验证 ysoserial 的来源和完整性。
* `remove_file` 函数尝试删除临时文件，如果由于权限或其他原因失败，可能会留下编译后的 Java 类文件。
总体代码逻辑是尝试复现和利用漏洞，未发现明显恶意代码。因此，投毒风险较低。

**利用方式：**

1.  **前提条件：** 确保目标 Tomcat 服务器满足漏洞利用的条件，特别是启用了默认 Servlet 的写入功能和 partial PUT。
2.  **确定目标 URL 和会话 ID：** 找到 Tomcat 服务器的 uploads 目录和目标应用程序使用的会话 ID。session id可以从服务器获取，或者脚本中指定，上传的session文件名由此决定。
3.  **生成 Payload：** 使用脚本提供的 `generate_ysoserial_payload` 或 `generate_java_payload` 函数生成包含恶意命令的 payload。
4.  **上传 Payload：** 使用 `upload_and_verify_payload` 函数将生成的 payload 上传到 Tomcat 服务器的会话目录。
5.  **触发反序列化：** 脚本通过发送带有特定 Cookie 的 GET 请求来触发反序列化。如果一切顺利，服务器将执行 payload 中的恶意命令。

**项目地址:** [sentilaso1/CVE-2025-24813-Apache-Tomcat-RCE-PoC](https://github.com/sentilaso1/CVE-2025-24813-Apache-Tomcat-RCE-PoC)

**漏洞详情:** [CVE-2025-24813](https://nvd.nist.gov/vuln/detail/CVE-2025-24813)