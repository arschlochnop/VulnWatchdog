## CVE-2017-12615-Apache Tomcat-远程代码执行

**漏洞编号:** CVE-2017-12615

**漏洞类型:** 远程代码执行

**影响应用:** Apache Tomcat

**危害等级:** 高危，允许攻击者上传恶意JSP文件并在服务器上执行，可能导致完全控制服务器。

**影响版本:** 7.0.0 to 7.0.79

**利用条件:** 运行在Windows上的Apache Tomcat 7.0.0 to 7.0.79，HTTP PUTs已启用（readonly初始化参数设置为false）。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2017-12615是一个存在于Apache Tomcat 7.0.0到7.0.79版本的远程代码执行漏洞。当Tomcat运行在Windows操作系统上，并且启用了HTTP PUT请求方法（通常通过设置`readonly`初始化参数为`false`来实现）时，攻击者可以通过构造特殊的请求上传JSP文件到服务器。由于Tomcat对上传的文件名处理不当，攻击者可以通过在文件名后添加斜杠`/`，空格`%20`或者`::$DATA`绕过文件类型检查，最终上传恶意的JSP文件。

**漏洞利用方式：**

1.  **条件判断：** 确认目标Tomcat服务器版本在7.0.0到7.0.79之间，运行在Windows系统上，并且HTTP PUT请求已启用。
2.  **上传JSP文件：** 使用PUT请求上传一个包含恶意代码的JSP文件，文件名需要包含`/`，`%20`或者`::$DATA`等绕过方式。例如，`shell.jsp/`，`shell.jsp%20`或者`shell.jsp::$DATA`。
3.  **执行JSP文件：** 成功上传JSP文件后，通过访问该JSP文件的URL，服务器会执行其中的恶意代码，导致远程代码执行。

**关于投毒风险的分析：**

查看提供的`TomcatScanPro.py`脚本，该脚本的主要功能是漏洞检测和利用，包括CVE-2017-12615漏洞的多种利用方式、CNVD-2020-10487漏洞利用以及弱口令爆破等。主要的投毒风险可能存在于以下几个方面：

*   **恶意WebShell内容：** 脚本在弱口令破解成功后，会尝试上传WebShell，如果WebShell的内容被替换为具有破坏性的代码，可能会对目标系统造成损害。
*   **config.yaml配置文件的恶意修改：** 如果`config.yaml`配置文件被篡改，攻击者可以修改默认的扫描行为，例如指定恶意的文件包含路径或关键字，从而在受害者不知情的情况下执行恶意操作。
*   **WAR包部署的恶意代码：** 脚本支持通过上传WAR包来获取`getshell`，如果WAR包中包含恶意代码，可能会导致更严重的后果。

**投毒风险评估：**

综合考虑以上因素，尽管脚本本身的功能是漏洞检测和利用，但潜在的投毒风险仍然存在。攻击者可以通过修改脚本中的关键配置或替换WebShell内容来达到恶意目的。因此，在使用该脚本时，务必仔细检查脚本的源代码和配置文件，确保其安全性。 这里根据代码功能和描述评估`poison`风险为 10%，主要是因为脚本本身是一个渗透测试工具，其目的是模拟攻击，因此某些操作本身就具有一定的“攻击性”，但从恶意代码植入的角度看，风险较低。


**项目地址:** [lizhianyuguangming/TomcatScanPro](https://github.com/lizhianyuguangming/TomcatScanPro)

**漏洞详情:** [CVE-2017-12615](https://nvd.nist.gov/vuln/detail/CVE-2017-12615)