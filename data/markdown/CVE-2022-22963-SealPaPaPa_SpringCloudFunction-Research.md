## CVE-2022-22963-Spring Cloud Function-远程代码执行

**漏洞编号:** CVE-2022-22963

**漏洞类型:** 远程代码执行

**影响应用:** Spring Cloud Function

**危害等级:** 高危，可导致服务器完全控制

**影响版本:** Spring Cloud Function versions 3.1.6, 3.2.2 and all old and unsupported versions

**利用条件:** Spring Cloud Function 启用了路由功能

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-22963 是 Spring Cloud Function 中的一个远程代码执行漏洞。攻击者可以利用 `spring.cloud.function.routing-expression` 请求头，注入恶意的 SpEL 表达式，从而执行任意代码。根据漏洞库信息，CVSS 3.1 评分为 9.8，属于危急漏洞。搜索结果显示，该漏洞允许未经身份验证的远程攻击，攻击者可以完全控制受影响的服务器。提供的 POC 代码通过设置 `spring.cloud.function.routing-expression` 头来执行 `touch /tmp/pwned` 命令，如果成功执行，则表明漏洞存在且可利用。

**有效性:**  POC 代码通过构造包含恶意 SpEL 表达式的请求头，发送到 `/functionRouter` 路径，利用了路由表达式解析的缺陷，达到了远程代码执行的效果，因此有效。

**投毒风险:**  提供的 POC 代码主要功能是在目标服务器上创建 `/tmp/pwned` 文件，以验证漏洞的存在。`README.md` 文件提供了漏洞的描述和参考链接，`poc.py` 文件包含了利用代码。没有发现隐藏的、超出漏洞验证范围的恶意代码，因此投毒风险较低，估计为0%。

**利用方式:**
1.  **目标确认:** 确认目标系统使用了存在漏洞的 Spring Cloud Function 版本，且启用了路由功能。
2.  **构造请求:** 构造包含 `spring.cloud.function.routing-expression` 请求头的 HTTP POST 请求。
3.  **注入 SpEL:** 在 `spring.cloud.function.routing-expression` 中嵌入恶意的 SpEL 表达式，用于执行系统命令。
4.  **发送请求:** 将构造好的请求发送到 `/functionRouter` 路径。
5.  **验证执行:** 检查命令是否成功执行，例如检查是否创建了预期的文件或执行了其他操作。例如本例使用`touch /tmp/pwned` 创建文件,验证漏洞.

**项目地址:** [SealPaPaPa/SpringCloudFunction-Research](https://github.com/SealPaPaPa/SpringCloudFunction-Research)

**漏洞详情:** [CVE-2022-22963](https://nvd.nist.gov/vuln/detail/CVE-2022-22963)