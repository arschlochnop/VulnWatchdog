## CVE-2018-11776-Apache Struts-远程代码执行

**漏洞编号:** CVE-2018-11776

**漏洞类型:** 远程代码执行

**影响应用:** Apache Struts

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** 2.3 to 2.3.34 和 2.5 to 2.5.16

**利用条件:** alwaysSelectFullNamespace 为 true，且存在特定配置的package和result/url标签

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2018-11776是Apache Struts 2中的一个远程代码执行漏洞。根据漏洞描述和搜索结果，当`alwaysSelectFullNamespace`设置为true，并且使用了不带namespace的result，同时其上层package也没有namespace或者使用了通配符namespace时，攻击者可以通过构造恶意的OGNL表达式来实现远程代码执行。提供的PoC代码通过发送包含恶意OGNL表达式的HTTP请求，利用Struts的OGNL表达式解析引擎执行任意命令。Dockerfile 构建了一个包含存在漏洞的 Struts 2.3.12 版本的 Tomcat 环境，为漏洞验证提供便利。

**有效性评估：**

根据漏洞库信息、搜索结果以及PoC代码分析，该漏洞的PoC代码是有效的。搜索结果中提及了多个关于CVE-2018-11776的分析报告和利用案例，表明该漏洞在实际环境中被成功利用过。

**投毒风险评估：**

PoC代码本身主要包含Dockerfile、LICENSE、README.md和exploit.py四个文件。`exploit.py`文件是漏洞利用脚本，功能明确，用于构造和发送恶意请求。Dockerfile用于构建存在漏洞的Struts2环境，简化了漏洞复现过程。LICENSE和README.md文件为常规说明文件。经过对PoC代码的分析，没有发现明显的恶意代码或后门，但仍存在一定的投毒风险：

1.  **依赖风险：** Dockerfile中使用了`apk add`命令安装了`vim`和`zip`，这些工具本身是安全的，但如果软件源被篡改，可能会引入恶意软件包。这部分的风险较低，约为5%。
2.  **命令注入风险：** 虽然`exploit.py`中的命令执行是通过用户提供的参数，但如果用户下载的exploit.py被篡改，将允许攻击者执行任意命令，则脚本可以被修改为包含恶意payload。但是，这是对所有脚本的通用风险。约为5%
3.  **供应链风险：** Struts 2 框架本身可能存在其他未知的安全问题，攻击者可能通过组合多个漏洞来实现更复杂的攻击。但是此风险已超出当前评估范畴。

总体而言，该仓库的投毒风险较低，约为10%。主要的风险在于用户下载的PoC代码可能被篡改，或者依赖的软件源被污染。建议用户在下载和使用PoC代码时，务必从可信来源获取，并进行安全审计。

**利用方式：**

1.  目标系统需要运行存在漏洞的Apache Struts版本（2.3 to 2.3.34 或 2.5 to 2.5.16），并且`alwaysSelectFullNamespace`配置为`true`。
2.  漏洞存在于当结果 (result) 在没有命名空间的情况下使用时，并且其上层包没有或具有通配符命名空间。或者当 url 标签没有 value 属性和 action 属性设置时，并且其上层包没有或具有通配符命名空间。
3.  攻击者构造包含恶意OGNL表达式的HTTP请求，例如在URL中嵌入OGNL表达式。
4.  Struts框架在处理请求时，由于OGNL表达式未经过充分的验证，恶意代码得以执行。
5.  攻击者可以利用此漏洞执行任意系统命令，实现远程代码执行，从而控制目标服务器。

**项目地址:** [knqyf263/CVE-2018-11776](https://github.com/knqyf263/CVE-2018-11776)

**漏洞详情:** [CVE-2018-11776](https://nvd.nist.gov/vuln/detail/CVE-2018-11776)