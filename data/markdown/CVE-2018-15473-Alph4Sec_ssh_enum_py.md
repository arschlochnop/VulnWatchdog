## CVE-2018-15473 OpenSSH 用户枚举漏洞

**漏洞编号:** CVE-2018-15473

**漏洞类型:** 用户枚举

**影响应用:** OpenSSH

**危害等级:** 中危，允许攻击者枚举有效的用户名

**影响版本:** <= 7.7

**利用条件:** 需要网络访问目标SSH服务

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2018-15473 漏洞允许攻击者通过分析 OpenSSH 服务器对无效和有效用户名请求的响应时间差异来枚举有效的用户名。该漏洞存在于 `auth2-gss.c`, `auth2-hostbased.c` 和 `auth2-pubkey.c` 文件中。

**利用方式：**

1.  攻击者使用提供的 `ssh_enum_py3.py` 脚本，该脚本基于 Python 3 和 Paramiko 库。
2.  脚本首先执行 pre-read banner 以避免 EOF/NoBanner 错误。
3.  然后，脚本针对目标 IP 地址 ( `-i` 参数) 和端口 ( `-p` 参数，默认为 22) 发送 SSH 连接尝试，使用提供的用户名列表 ( `-u` 参数)。
4.  脚本测量每个连接尝试的响应时间。
5.  通过 autotune 功能 ( `-a` 参数) 或手动设置 multiplier ( `-m` 参数) 和 threshold ( `-t` 参数)，脚本确定响应时间的 cutoff 值。
6.  如果某个用户名的响应时间超过 cutoff 值的次数超过 threshold 值，则该用户名被标记为 `likely VALID`，表明该用户可能存在。
7.  如果服务器返回一致的错误响应（例如 "AuthFailed"），则该用户被标记为 `likely INVALID`。

**有效性：**

提供的 POC 代码有效，因为它利用了 OpenSSH 在处理认证请求时的时序差异来判断用户是否存在。多个 exploit-db 链接 (`https://www.exploit-db.com/exploits/45210/`, `https://www.exploit-db.com/exploits/45233/`, `https://www.exploit-db.com/exploits/45939/`) 也表明了该漏洞的可利用性。

**投毒风险：**

代码中存在投毒代码的风险较低。代码主要实现的是一个用户枚举的工具，利用的是响应时间差异。虽然存在通过修改用户名列表等方式进行攻击的可能性，但本身代码的恶意程度较低。README.md 中也强调了要进行伦理使用。但是仍然有很小的风险，比如在autotune的时候篡改 baseline 值导致识别出错，但是这些篡改行为相对隐蔽，所以判定投毒风险为 1%。

**项目地址:** [Alph4Sec/ssh_enum_py](https://github.com/Alph4Sec/ssh_enum_py)

**漏洞详情:** [CVE-2018-15473](https://nvd.nist.gov/vuln/detail/CVE-2018-15473)