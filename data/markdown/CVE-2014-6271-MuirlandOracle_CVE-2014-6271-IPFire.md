## CVE-2014-6271 IP Fire Shellshock RCE

**漏洞编号:** CVE-2014-6271

**漏洞类型:** 远程代码执行

**影响应用:** IPFire

**危害等级:** 高危，允许未经授权的远程代码执行

**影响版本:** <= 2.15

**利用条件:** 目标系统运行存在漏洞的Bash版本，且可以通过HTTP(S)访问到受影响的CGI脚本 (index.cgi)。可能需要用户名和密码进行身份验证。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2014-6271，也被称为Shellshock，是一个存在于GNU Bash中的高危漏洞。该漏洞允许攻击者通过构造恶意的环境变量来执行任意代码。提供的Python POC代码专门针对IPFire防火墙<=2.15版本。利用方式如下：

1.  **漏洞原理：** Bash在处理环境变量时，允许在函数定义后附加额外的命令。如果这些环境变量被传递给执行Bash脚本的CGI程序，附加的命令就会被执行。
2.  **攻击向量：**  攻击者通过HTTP请求的header中设置包含恶意代码的环境变量，利用IPFire的`index.cgi`脚本触发漏洞。
3.  **POC代码分析：** 该POC首先尝试连接到目标IPFire服务器，如果需要则进行HTTP基本身份验证。然后，它构造一个包含恶意Bash代码的环境变量，并通过HTTP请求的headers将其发送到`index.cgi`。恶意代码利用函数定义后的trailing string执行任意命令。POC还包含了一个伪shell，允许交互式地执行命令。
4.  **投毒风险分析：** POC代码主要功能是漏洞验证和利用，但仍存在一定投毒风险。例如：
    *   代码中包含`eval`或`exec`等执行任意代码的函数，虽然目前用于执行用户输入的命令，但攻击者可能修改这些部分来执行恶意代码。
    *   该脚本依赖于`requests`库，攻击者可能篡改此脚本，要求安装恶意依赖包，从而执行恶意代码
    *  该脚本在执行远程命令后直接打印到输出，没有进行过滤，如果远程服务器被入侵，可能会发送恶意字符到客户端，导致客户端被攻击。
  因此，保守估计存在10%的投毒风险，主要集中在潜在的恶意依赖、命令执行的输出处理以及代码篡改的可能性。

**总结：** 提供的POC代码利用Shellshock漏洞，通过构造包含恶意Bash代码的环境变量，实现在目标IPFire系统上执行任意命令。由于利用了HTTP(S)协议，攻击通常可以通过网络远程发起。尽管漏洞已经存在多年，但仍然有很多系统没有修复，因此该漏洞仍然具有较高的现实威胁。

**项目地址:** [MuirlandOracle/CVE-2014-6271-IPFire](https://github.com/MuirlandOracle/CVE-2014-6271-IPFire)

**漏洞详情:** [CVE-2014-6271](https://nvd.nist.gov/vuln/detail/CVE-2014-6271)