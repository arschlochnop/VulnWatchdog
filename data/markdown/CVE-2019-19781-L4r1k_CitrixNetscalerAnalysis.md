## CVE-2019-19781-Citrix ADC/Gateway-目录遍历

**漏洞编号:** CVE-2019-19781

**漏洞类型:** 目录遍历

**影响应用:** Citrix Application Delivery Controller (ADC) and Gateway

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 10.5, 11.1, 12.0, 12.1, and 13.0

**利用条件:** 需要网络访问

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-19781是Citrix ADC和Gateway产品中的一个目录遍历漏洞。攻击者可以利用此漏洞读取服务器上的任意文件，甚至结合其他漏洞实现远程代码执行。根据搜索结果，此漏洞在野外被广泛利用，并与NOTROBIN恶意软件有关联。提供的POC代码（Citrix NetScaler Analysis.ipynb）是一个Jupyter Notebook，旨在帮助分析受影响的Citrix设备的日志和模板文件，以检测漏洞利用的痕迹。它本身并非直接的漏洞利用代码，而是一个分析工具，通过搜索特定关键词（如'nobody'用户执行的命令）来识别潜在的入侵行为。因此，不能简单地说该POC“有效”，而是说该工具可以有效辅助漏洞利用后的分析和检测。

**利用方式：**

1.  **目录遍历：** 攻击者发送特制的HTTP请求，包含目录遍历序列（例如`../`），以访问受限目录之外的文件。
2.  **文件读取：** 成功利用目录遍历漏洞后，攻击者可以读取系统配置文件、日志文件或其他敏感信息。
3.  **远程代码执行：**  结合其他漏洞（例如模板注入），攻击者可以将恶意代码写入到服务器上的文件中，然后通过目录遍历漏洞访问并执行这些文件，从而实现远程代码执行。
4.  **日志分析和检测：**  提供的POC代码是一个分析工具，可以帮助安全分析师检查Citrix设备的日志文件，搜索与CVE-2019-19781漏洞利用相关的可疑活动。

**投毒风险分析：**

该POC代码的主要功能是日志和配置文件分析，用于检测漏洞利用的痕迹，而不是直接利用漏洞。代码中包含大量搜索关键词，例如搜索'nobody'用户执行的命令。虽然工具本身是为了安全分析而设计的，但如果攻击者修改了这些关键词列表，可能会导致分析结果出现偏差，例如忽略某些关键的攻击特征。此外，Jupyter Notebook代码在执行前可以被修改，因此存在被植入恶意代码的风险。如果用户在不检查代码的情况下直接运行，可能会执行恶意操作。这种风险相对较低，因为用户通常会查看配置部分，意识到这是一个分析工具，恶意代码会被发现。

考虑到Jupyter Notebook代码的可修改性和用户可能存在的疏忽，以及搜索关键词被篡改的可能，判定存在10%的投毒风险。

**项目地址:** [L4r1k/CitrixNetscalerAnalysis](https://github.com/L4r1k/CitrixNetscalerAnalysis)

**漏洞详情:** [CVE-2019-19781](https://nvd.nist.gov/vuln/detail/CVE-2019-19781)