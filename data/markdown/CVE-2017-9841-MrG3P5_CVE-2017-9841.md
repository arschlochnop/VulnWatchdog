## CVE-2017-9841-PHPUnit-远程代码执行

**漏洞编号:** CVE-2017-9841

**漏洞类型:** 远程代码执行

**影响应用:** PHPUnit

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** PHPUnit < 4.8.28 和 5.x < 5.6.3

**利用条件:** 需要目标服务器暴露/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php等URI

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2017-9841是一个存在于PHPUnit框架中的远程代码执行漏洞。攻击者可以通过发送以"<?php "开头的恶意HTTP POST数据到暴露的eval-stdin.php文件，从而执行任意PHP代码。

**有效性分析：**

根据漏洞信息、搜索结果和提供的POC代码，可以判断此漏洞的POC代码是有效的。

漏洞库信息表明，该漏洞允许远程攻击者执行任意PHP代码。搜索结果也显示了该漏洞被广泛利用，并且存在公开的攻击签名。

提供的POC代码 (main.py) 尝试通过发送包含PHP代码的POST请求到多个可能的URI路径来利用此漏洞。它通过检查响应中是否包含`md5(phpunit_rce)`的MD5哈希值来判断目标是否易受攻击，如果是，目标就被识别为易受攻击的。

**投毒风险分析：**

代码中存在潜在的投毒风险，主要体现在以下几个方面：

1.  **依赖包安装：** `require.txt` 文件中列出了需要安装的依赖包。虽然 `colorama`、`requests` 和 `pyfiglet` 本身是常用的库，但攻击者可能通过篡改 `require.txt` 文件，添加包含恶意代码的依赖包。但可能性较低。
2.  **代码执行流程：** `main.py` 脚本会读取用户提供的域名列表，并对每个域名尝试进行漏洞利用。攻击者可能通过控制域名列表，将受害者引导至恶意网站或服务器。但这里只是读取，不进行恶意操作。
3.  **结果保存：** 利用成功的目标URL会保存到 `result.txt` 文件中。攻击者可能利用这一点，收集受害者信息。
4. **检测逻辑**: POC 使用 `md5(phpunit_rce)` 检测漏洞是否存在，存在被绕过的可能，如果作者故意使用其他字符串，可能会导致误报。

综合评估，该POC存在一定的投毒风险，主要集中在依赖包篡改的可能性以及利用成功目标URL可能被收集的风险，但总体风险较低，判断投毒概率为5%。

**利用方式：**

1.  **漏洞发现：** 攻击者首先需要找到运行存在漏洞版本的PHPUnit，并且暴露了`/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php` URI的网站。
2.  **构造Payload：** 攻击者构造一个HTTP POST请求，请求体以`<?php `开头，包含需要执行的PHP代码。
3.  **发送请求：** 攻击者将构造好的POST请求发送到目标URI。
4.  **代码执行：** 如果目标存在漏洞，PHPUnit的`eval-stdin.php`文件会执行POST请求中的PHP代码，从而实现远程代码执行。

**项目地址:** [MrG3P5/CVE-2017-9841](https://github.com/MrG3P5/CVE-2017-9841)

**漏洞详情:** [CVE-2017-9841](https://nvd.nist.gov/vuln/detail/CVE-2017-9841)