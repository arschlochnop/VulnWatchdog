## CVE-2022-24112-Apache APISIX-RCE

**漏洞编号:** CVE-2022-24112

**漏洞类型:** 远程代码执行

**影响应用:** Apache APISIX

**危害等级:** 高危，可导致服务器完全控制

**影响版本:** < 2.12.1, < 2.10.4, 1.3

**利用条件:** 启用batch-requests插件，且admin api端口和数据面板使用默认配置或未妥善配置

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-24112 漏洞存在于 Apache APISIX 的 batch-requests 插件中。攻击者可以利用此漏洞绕过 Admin API 的 IP 限制，从而进行远程代码执行。漏洞利用方式如下：

1.  **漏洞原理：** batch-requests 插件存在缺陷，允许攻击者覆盖 X-REAL-IP 头部，从而绕过 IP 访问控制。
2.  **利用步骤：**
    *   攻击者构造包含恶意 Lua 代码的 PUT 请求，通过 batch-requests 插件发送到 `/apisix/admin/routes/index` 路径，以创建或更新路由。
    *   恶意 Lua 代码利用 `io.popen` 函数执行系统命令，并通过 `ngx.say()` 函数将命令执行结果返回。
    *   攻击者访问特定URI触发该路由，即可执行注入的命令。

3.  **POC 分析：** 提供的 exploit.py 脚本正是实现了上述步骤。脚本构建包含恶意 Lua 代码的 JSON payload，然后通过 batch-requests 插件发送到 APISIX 服务器，触发路由执行系统命令，并将结果打印到控制台。

4.  **投毒风险：** 提供的 exploit.py 脚本没有发现明显的投毒代码。脚本的功能完全是实现漏洞利用，没有额外的恶意行为。它只是利用了 APISIX 的漏洞执行攻击者指定的命令。

5.  **缓解措施：** 禁用 batch-requests 插件，或升级到 2.10.4 或 2.12.1 及以上版本。

**项目地址:** [fatkz/CVE-2022-24112](https://github.com/fatkz/CVE-2022-24112)

**漏洞详情:** [CVE-2022-24112](https://nvd.nist.gov/vuln/detail/CVE-2022-24112)