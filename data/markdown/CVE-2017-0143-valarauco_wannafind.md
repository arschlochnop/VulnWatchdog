## CVE-2017-0143 Windows SMB Remote Code Execution Vulnerability

**漏洞编号:** CVE-2017-0143

**漏洞类型:** 远程代码执行

**影响应用:** Windows SMBv1

**危害等级:** 高危，可能导致远程代码执行和系统控制

**影响版本:** Windows Vista SP2; Windows Server 2008 SP2 and R2 SP1; Windows 7 SP1; Windows 8.1; Windows Server 2012 Gold and R2; Windows RT 8.1; Windows 10 Gold, 1511, and 1607; Windows Server 2016

**利用条件:** 目标系统开启SMBv1服务，攻击者需要能够访问目标系统的445端口

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2017-0143是一个存在于Windows SMBv1服务器中的远程代码执行漏洞。攻击者可以通过构造特制的SMB数据包发送到目标服务器的445端口来触发此漏洞，成功利用可导致在目标系统上执行任意代码。

**有效性：**
提供的POC代码是一个`wannafind.sh`脚本，它使用`nmap`和`masscan`来检测网络中是否存在受CVE-2017-0143（MS17-010）和CVE-2017-7494影响的系统。脚本首先检查`masscan`和`nmap`是否已安装，然后下载或更新相应的Nmap脚本（`smb-vuln-ms17-010.nse` 和 `samba-vuln-cve-2017-7494.nse`）。然后，它使用`masscan`快速扫描指定子网的445端口，再使用`nmap`和下载好的脚本扫描存活主机，寻找漏洞。

这个脚本本身并不能直接利用CVE-2017-0143，但是它可以用来识别易受攻击的目标，为后续的攻击做准备。因此，该脚本的**有效性在于漏洞检测而非直接利用**。

**投毒风险：**
虽然脚本的功能是漏洞扫描，但仍存在一定的投毒风险。 主要体现在以下几个方面：

1.  **外部资源下载:** 脚本会从GitHub下载`smb-vuln-ms17-010.nse`脚本, 从gist.githubusercontent.com 下载`samba-vuln-cve-2017-7494.nse`。如果这些远程仓库被篡改，脚本可能会下载恶意代码。但脚本中对下载的文件会执行 `chown root:root`操作，即使被篡改，攻击者提权难度也会增加。
2.  **脚本执行:** 脚本需要root权限才能执行masscan和更新nmap脚本。如果攻击者能控制运行脚本的环境，可以修改脚本内容，添加恶意命令。

考虑到脚本的功能主要是调用现有的扫描工具，并且需要root权限才能运行，投毒风险相对较低，但不能完全排除。 考虑到远程下载脚本存在被中间人攻击的风险，给出一个较低的百分比：5%。

**利用方式：**
根据漏洞库信息和搜索结果，CVE-2017-0143的利用方式如下：

1.  **攻击者扫描网络，识别存在漏洞的SMBv1服务。** `wannafind.sh` 脚本可以辅助完成这一步。
2.  **攻击者构造恶意的SMB数据包，发送到目标服务器的445端口。**
3.  **目标服务器处理恶意数据包时，触发漏洞，导致代码执行。**
4.  **攻击者利用执行的代码，获取系统控制权，安装后门，窃取数据等。**

该漏洞常与EternalBlue（CVE-2017-0144）一起使用，EternalBlue负责突破系统的初始防御，然后利用CVE-2017-0143执行恶意代码。

**项目地址:** [valarauco/wannafind](https://github.com/valarauco/wannafind)

**漏洞详情:** [CVE-2017-0143](https://nvd.nist.gov/vuln/detail/CVE-2017-0143)