## CVE-2018-6574 - Go "go get" 远程命令执行

**漏洞编号:** CVE-2018-6574

**漏洞类型:** 远程命令执行

**影响应用:** Go

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** Go before 1.8.7, Go 1.9.x before 1.9.4, and Go 1.10 pre-releases before Go 1.10rc2

**利用条件:** 目标系统使用受影响的 Go 版本，且执行 `go get` 命令获取包含恶意代码的包。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2018-6574 允许在源码构建过程中利用 gcc 或 clang 插件特性执行远程命令。漏洞原因是 Go 在执行 `go get` 时没有正确阻止 `-fplugin=` 和 `-plugin=` 参数。 

**有效性:**

提供的 POC 代码有效。`attack.c` 文件包含一个 `malicious()` 函数，该函数使用 `__attribute__((constructor))` 在程序启动时自动执行 `/usr/local/bin/score 5406e228-19be-4c56-b6da-ee36ce3dee1a` 命令。`main.go` 文件使用 `cgo` 调用 `attack.so` (由 `attack.c` 编译而来)，从而触发恶意代码执行。

**投毒风险:**

提供的代码中没有明显的投毒代码。`attack.c` 的功能很明确，就是执行一个固定的命令。`main.go` 只是为了触发 `attack.c` 中恶意函数的执行。因此，投毒风险评估为 0%。

**利用方式:**

1.  攻击者创建一个包含恶意 `attack.c` 和 `main.go` 文件的 Go 包。
2.  `attack.c` 包含在程序启动时执行任意命令的代码。
3.  `main.go` 利用 `cgo` 技术，通过 `-fplugin=` 选项加载并执行 `attack.c` 编译后的共享库。
4.  攻击者将该恶意 Go 包托管在可访问的存储库中。
5.  受害者在易受攻击的 Go 版本上使用 `go get` 命令下载并构建该恶意包。
6.  构建过程中，`attack.so` 被加载，其中的恶意代码被执行，导致远程命令执行。
7.  `/usr/local/bin/score` 命令被执行，可能导致系统受损或被控制。

**项目地址:** [the-valluvarsploit/CVE-2018-6574](https://github.com/the-valluvarsploit/CVE-2018-6574)

**漏洞详情:** [CVE-2018-6574](https://nvd.nist.gov/vuln/detail/CVE-2018-6574)