## CVE-2024-38856-Apache OFBiz-RCE

**漏洞编号:** CVE-2024-38856

**漏洞类型:** 远程代码执行

**影响应用:** Apache OFBiz

**危害等级:** 高危，未经身份验证的远程代码执行

**影响版本:** <= 18.12.14

**利用条件:** 目标系统运行Apache OFBiz，且存在/webtools/control/main/ProgramExport端点

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-38856是Apache OFBiz中的一个不正确的授权漏洞，允许未经身份验证的端点执行屏幕渲染代码。攻击者通过向/webtools/control/main/ProgramExport端点发送精心构造的POST请求，其中包含恶意的groovyProgram参数，该参数经过URL编码，包含需要执行的命令的base64编码，从而实现远程代码执行。

**有效性：**
提供的POC代码，包含一个bash脚本和一个nuclei的yaml文件，可以通过发送包含恶意Groovy脚本的POST请求来利用此漏洞。脚本首先将要执行的命令进行Base64编码，然后将其嵌入到Groovy表达式中，并将表达式转换为\u00转义的Unicode序列，最后，构造包含groovyProgram参数的POST请求发送到目标端点。

**投毒风险：**
虽然整个仓库看起来专注于利用CVE-2024-38856，但仍存在小部分投毒风险，如脚本中可能存在的后门代码。虽然脚本的主要功能是执行命令，但需要仔细检查是否存在其他恶意行为，比如反弹shell或下载执行恶意文件。检查发现，脚本中并没有发现直接的投毒代码。风险主要在于，如果攻击者获取了脚本的所有权，可以随时植入恶意代码，所以判定投毒风险为5%。

**利用方式：**
1.  攻击者需要一个目标Apache OFBiz实例，版本小于等于18.12.14。
2.  攻击者构造一个包含恶意Groovy脚本的POST请求，该脚本利用`execute()`函数执行任意命令。为了绕过某些过滤，命令会被Base64编码。
3.  攻击者将构造的POST请求发送到`/webtools/control/main/ProgramExport`端点。
4.  如果目标系统存在漏洞，Groovy脚本将被执行，攻击者指定的命令也会被执行。
5.  命令执行的结果将返回给攻击者。

**项目地址:** [0x20c/CVE-2024-38856-EXP](https://github.com/0x20c/CVE-2024-38856-EXP)

**漏洞详情:** [CVE-2024-38856](https://nvd.nist.gov/vuln/detail/CVE-2024-38856)