## CVE-2022-42889-Apache Commons Text-RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** <= 1.9

**利用条件:** 应用程序使用受影响版本的Apache Commons Text，且允许用户可控的输入传递给文本插值功能

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-42889，又名Text4Shell，是Apache Commons Text库中的一个远程代码执行漏洞。该漏洞源于库中不安全的默认文本插值配置，允许攻击者通过构造包含恶意表达式的输入，利用`script`, `dns`, 或 `url` 等lookup执行任意代码或与远程服务器通信。

**有效性：**
根据漏洞库信息、搜索引擎结果以及提供的PoC代码，此漏洞的利用是有效的。搜索引擎结果中的多个条目都将此漏洞描述为高危远程代码执行漏洞，并提供了利用示例。

**投毒风险：**
提供的PoC代码本身旨在验证漏洞的存在，通过`curl+{{interactsh-url}}`的方式来检测是否成功执行了命令。由于该PoC代码目的在于触发漏洞并进行验证，不包含恶意行为（例如：上传恶意文件、修改系统配置等），因此其主要风险在于被滥用进行攻击。但仓库中其他未提供的文件，可能存在隐藏的后门或恶意代码，因此综合判定存在10%的投毒风险。

**利用方式：**
攻击者将构造包含恶意表达式的字符串，例如`${script:javascript:java.lang.Runtime.getRuntime().exec('command')}`。这个字符串会被传递给使用了Apache Commons Text库进行文本插值的应用程序。如果应用程序没有对用户输入进行充分的验证和过滤，该表达式将被解析并执行，导致远程代码执行。PoC中使用了`curl`命令和`interactsh`服务来验证漏洞是否成功利用，实际攻击中可以替换成任何其他命令。

简而言之，利用方式是：
1.  应用程序使用存在漏洞的Apache Commons Text版本（<= 1.9）。
2.  应用程序允许用户可控的输入传递给文本插值功能。
3.  攻击者构造包含恶意表达式的输入。
4.  Apache Commons Text解析并执行恶意表达式，导致RCE。

**项目地址:** [Gotcha1G/CVE-2022-42889](https://github.com/Gotcha1G/CVE-2022-42889)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)