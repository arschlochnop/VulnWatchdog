## CVE-2022-21661-WordPress-SQL注入

**漏洞编号:** CVE-2022-21661

**漏洞类型:** SQL注入

**影响应用:** WordPress

**危害等级:** 高危，可能导致数据库信息泄露和任意代码执行

**影响版本:** < 5.8.3

**利用条件:** 目标WordPress站点存在/wp-admin/admin-ajax.php，需要网络访问权限

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2022-21661 是一个 WordPress 核心中 WP_Query 类在处理某些输入时，由于不正确的过滤，导致可能发生 SQL 注入的漏洞。攻击者可以利用该漏洞执行任意 SQL 查询，从而可能泄露敏感数据，甚至在某些情况下执行恶意代码。

**有效性：**
提供的 POC 代码是一个 Python 脚本，用于检测目标 WordPress 站点是否存在 CVE-2022-21661 漏洞。它通过构造包含恶意 SQL 语句的 `tax_query` 参数，并向 `/wp-admin/admin-ajax.php` 发送 POST 请求，来判断目标站点是否存在漏洞。

代码中 `r0` 函数检查站点是否返回400 错误代码，且包含`0`，作为一个预检测。
`r1` 函数使用 `extractvalue` 函数进行盲注检测。如果返回结果包含计算得到的 MD5 值，则认为存在漏洞。
`r2` 函数通过 `sleep` 函数判断是否存在时间盲注。

**投毒风险：**
该仓库的投毒风险较低，约为 1%。理由如下：
*   代码功能相对独立，主要功能是发送 payload 进行漏洞检测。
*   代码逻辑清晰，没有发现明显的恶意代码或后门。
*   虽然可以将扫描结果写入日志文件，但这种行为是合理的，并非恶意行为。

当然，依旧存在风险，例如作者在未来的版本中添加恶意代码，或者利用该扫描器收集的信息进行其他攻击。

**利用方式：**
1.  **确定目标：** 确定运行 WordPress 且版本低于 5.8.3 的目标站点。
2.  **发送 Payload：** 使用提供的 POC 代码或类似的工具，向目标站点的 `/wp-admin/admin-ajax.php` 发送包含恶意 SQL 语句的 POST 请求。Payload 的核心是 `tax_query` 参数，它包含一个精心构造的 SQL 注入语句。
3.  **验证漏洞：** 通过分析响应状态码、响应时间或响应内容，判断目标站点是否存在漏洞。
4.  **数据提取/代码执行：** 如果漏洞存在，攻击者可以利用 SQL 注入漏洞执行任意 SQL 查询，从而获取数据库中的敏感数据。在某些情况下，攻击者还可以利用该漏洞执行任意代码，完全控制目标站点。

**项目地址:** [p4ncontomat3/CVE-2022-21661](https://github.com/p4ncontomat3/CVE-2022-21661)

**漏洞详情:** [CVE-2022-21661](https://nvd.nist.gov/vuln/detail/CVE-2022-21661)