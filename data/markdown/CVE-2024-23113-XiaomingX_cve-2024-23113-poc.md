## CVE-2024-23113 - Fortinet Format String Vulnerability

**漏洞编号:** CVE-2024-23113

**漏洞类型:** 格式化字符串漏洞

**影响应用:** FortiOS, FortiProxy, FortiPAM, FortiSwitchManager

**危害等级:** 高危，可导致远程代码执行

**影响版本:** FortiOS (7.4.0 - 7.4.2, 7.2.0 - 7.2.6, 7.0.0 - 7.0.13), FortiProxy (7.4.0 - 7.4.2, 7.2.0 - 7.2.8, 7.0.0 - 7.0.15), FortiPAM (1.2.0, 1.1.0 - 1.1.2, 1.0.0 - 1.0.3), FortiSwitchManager (7.2.0 - 7.2.3, 7.0.0 - 7.0.3)

**利用条件:** 需要网络访问到受影响的Fortinet设备，且目标设备运行受影响的版本。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-23113 是 Fortinet 产品中的一个格式化字符串漏洞。根据漏洞库信息和搜索结果，该漏洞影响 FortiOS、FortiProxy、FortiPAM 和 FortiSwitchManager 的多个版本。攻击者可以通过发送特制的数据包利用该漏洞执行未授权的代码或命令，从而实现远程代码执行 (RCE)。CVSS 评分高达 9.8，属于严重级别漏洞。

**有效性分析：**

提供的 PoC 代码 (`CVE-2024-23113-poc.py`) 尝试通过构造一个包含格式化字符串的特殊数据包发送到目标主机的 541 端口来检测漏洞。PoC 首先建立 TLS 1.2 连接，然后发送 `reply 200\r\nrequest=auth\r\nauthip=%n\r\n\r\n\x00` 作为 payload。如果目标主机未修补漏洞，服务器可能会崩溃或返回错误，PoC 代码会尝试捕获这些错误来判断是否存在漏洞。PoC代码基于接收到的服务器响应来判断设备是否已修复。

**投毒风险分析：**

PoC 代码本身看起来是为了验证漏洞是否存在，而不是为了植入后门或执行恶意操作。该代码的功能主要是发送特定的格式化字符串 payload 并根据服务器的响应来判断目标主机是否存在漏洞。因此，可以认为该仓库中存在作者隐藏的投毒代码的可能性为 0%。

**利用方式分析：**

利用方式涉及以下步骤：

1.  **建立连接：** 攻击者需要能够通过网络访问到目标 Fortinet 设备，并通过 541 端口建立 TLS 1.2 连接。
2.  **构造 Payload：** 攻击者构造包含格式化字符串（例如 `%n`）的特殊数据包。`%n` 格式化字符串可以将已输出的字符数写入内存中的某个地址，从而可能覆盖关键数据或执行任意代码。
3.  **发送 Payload：** 攻击者将构造好的数据包发送到目标设备。
4.  **执行代码：** 如果设备存在漏洞，格式化字符串会被解析，从而导致未授权的代码或命令执行。攻击者可以通过控制格式化字符串的内容来执行恶意操作，例如添加后门、修改配置或获取敏感信息。

**总结：**

CVE-2024-23113 是一个高危的格式化字符串漏洞，利用难度较低，影响范围广泛。强烈建议受影响的用户尽快升级到安全版本。

**项目地址:** [XiaomingX/cve-2024-23113-poc](https://github.com/XiaomingX/cve-2024-23113-poc)

**漏洞详情:** [CVE-2024-23113](https://nvd.nist.gov/vuln/detail/CVE-2024-23113)