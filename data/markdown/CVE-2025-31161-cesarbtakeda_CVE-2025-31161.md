## CVE-2025-31161-CrushFTP-Authentication Bypass

**漏洞编号:** CVE-2025-31161

**漏洞类型:** 身份验证绕过

**影响应用:** CrushFTP

**危害等级:** 严重，可能导致完全系统控制

**影响版本:** CrushFTP 10 (before 10.8.4) and 11 (before 11.3.1)

**利用条件:** 需要网络访问CrushFTP服务器，且目标版本存在漏洞

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2025-31161 允许未经身份验证的攻击者绕过身份验证并接管 crushadmin 帐户 (除非使用 DMZ 代理实例)。此漏洞是由于 FTP 服务器的 HTTP 组件的 AWS4-HMAC 授权方法中存在竞争条件。服务器首先通过调用 login_user_pass() 验证用户的存在，而无需密码要求。通过发送篡改的 AWS4-HMAC 标头，可以进一步稳定该漏洞，从而无需成功触发竞争条件。通过仅提供用户名和后面的斜杠 (/)，服务器将成功找到用户名，从而触发成功的 anypass 身份验证过程，但服务器将无法找到预期的 SignedHeaders 条目，从而导致索引越界错误，从而阻止代码到达会话清理。总之，这些问题使得以任何已知或可猜测的用户（例如，crushadmin）进行身份验证变得非常容易，并且可能导致通过获得管理帐户来完全破坏系统。

**利用方式：**

1.  利用 AWS4-HMAC 授权中的漏洞，通过发送包含用户名和斜杠的畸形请求绕过身份验证。
2.  使用绕过的身份验证会话，通过 WebInterface/function/ 调用创建新的管理员用户或修改现有用户密码。
3.  如果目标是 crushadmin 帐户，则攻击者可以完全控制 CrushFTP 系统。

**关于PoC代码的有效性：**
提供的 PoC 代码 (exploit.c) 尝试利用此漏洞。它包含设置 HTTP 标头、构造 URL 以及使用 libcurl 执行 HTTP 请求的功能。漏洞利用尝试通过设置带有畸形 'Authorization' 标头的 Cookie 并向易受攻击的端点发送请求来利用身份验证绕过。

**关于投毒风险：**
风险较低，大约 5%。 虽然代码包含常见漏洞利用所需的网络功能（通过 libcurl），但其中未发现任何明显的恶意或不必要的操作，例如下载和执行任意二进制文件、修改系统文件或建立后门。代码相对简单，主要是为了演示身份验证绕过漏洞利用，而不是进行恶意活动。但存在一些风险，例如错误处理不当或意外崩溃，因此谨慎使用。

**项目地址:** [cesarbtakeda/CVE-2025-31161](https://github.com/cesarbtakeda/CVE-2025-31161)

**漏洞详情:** [CVE-2025-31161](https://nvd.nist.gov/vuln/detail/CVE-2025-31161)