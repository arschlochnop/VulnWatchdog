## CVE-2020-16898 - Windows TCP/IP 远程代码执行漏洞（Bad Neighbor）

**漏洞编号:** CVE-2020-16898

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Windows TCP/IP 协议栈

**危害等级:** 高危，可导致远程代码执行或拒绝服务

**影响版本:** Windows 10 Version 1709, 1803, 1809, 1903, 1909, 2004 和 Windows Server 2019, version 1903, version 2004

**利用条件:** 攻击者需要在与目标系统相同的网络上或能够发送 ICMPv6 路由通告数据包到目标系统。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2020-16898 是一个存在于 Windows TCP/IP 协议栈中的远程代码执行漏洞。该漏洞是由于 Windows TCP/IP 协议栈不正确地处理 ICMPv6 路由通告数据包所致。 攻击者可以通过发送特制的 ICMPv6 路由通告数据包到远程 Windows 计算机来利用此漏洞，成功利用此漏洞的攻击者可以在目标服务器或客户端上执行任意代码。 

根据漏洞信息和搜索结果，该漏洞影响多个 Windows 版本，包括 Windows 10 和 Windows Server。该漏洞利用涉及发送特制的 ICMPv6 数据包。PoC 代码使用 Scapy 库构造这些数据包，并发送给目标。PoC代码通过填充 `ICMPv6NDOptRDNSS` 选项的 `dns` 字段来触发漏洞。根据搜索结果和漏洞描述，该漏洞有可能导致远程代码执行或者拒绝服务（BSOD）。

**有效性：**
根据漏洞信息，该漏洞的 PoC 是可用的，提供的代码可以触发蓝屏死机（BSOD），表明 PoC 具有一定的有效性。

**投毒风险：**
该 PoC 代码主要使用 Scapy 库构造和发送 ICMPv6 数据包，未发现明显的恶意代码或后门。但是，所有来源不明的代码都存在一定的风险，建议在隔离环境中运行。
仔细审查代码，发现其逻辑主要是构造畸形的ICMPv6数据包以触发TCP/IP协议栈中的漏洞，目的是导致BSOD。其中最可疑的地方是大量的"AAAA:AAAA:AAAA:AAAA:AAAA:AAAA:AAAA:AAAA"字符串。这部分代码是在利用漏洞，而非添加恶意代码。因此，判定投毒风险较低，估计在5%左右，主要是考虑作者可能会植入一些不易察觉的payload。

**利用方式：**
1.  攻击者需要位于与目标系统相同的网络或者能够向目标系统发送 IPv6 数据包。
2.  攻击者利用 Scapy 等工具构造恶意的 ICMPv6 路由通告 (RA) 数据包，特别是 `ICMPv6NDOptRDNSS` 选项。
3.  构造的 ICMPv6 RA 数据包被发送到目标 Windows 系统。
4.  Windows TCP/IP 协议栈处理畸形的 ICMPv6 RA 数据包时，触发漏洞，可能导致远程代码执行或拒绝服务攻击（BSOD）。

**项目地址:** [momika233/CVE-2020-16898-exp](https://github.com/momika233/CVE-2020-16898-exp)

**漏洞详情:** [CVE-2020-16898](https://nvd.nist.gov/vuln/detail/CVE-2020-16898)