## CVE-2007-2447-Samba-远程命令执行

**漏洞编号:** CVE-2007-2447

**漏洞类型:** 远程命令执行

**影响应用:** Samba

**危害等级:** 高危，可导致完全控制受影响的系统

**影响版本:** 3.0.0 through 3.0.25rc3

**利用条件:** 需要Samba服务运行，且开启了 username map script 选项（对于SamrChangePassword函数的利用）或拥有有效的用户身份验证（对于其他MS-RPC函数的利用）。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2007-2447是Samba中的一个远程命令执行漏洞，存在于Samba 3.0.0到3.0.25rc3版本中。该漏洞源于smbd的MS-RPC功能，当启用了"username map script" smb.conf选项时，攻击者可以通过SamrChangePassword函数利用该漏洞，或者通过其他MS-RPC函数（如远程打印机和文件共享管理）在已认证用户的情况下利用。攻击者通过在MS-RPC请求中注入shell元字符，可以在服务器上执行任意命令。

**有效性评估：**

根据漏洞信息和提供的POC代码，此漏洞利用的有效性较高。POC代码使用`smb.SMBConnection`库建立SMB连接，并尝试通过构造包含反弹shell命令的用户名来触发漏洞。这种方法直接利用了漏洞描述中提到的shell元字符注入。

**投毒风险评估：**

提供的POC代码相对简洁，主要功能是建立SMB连接并发送包含恶意命令的用户名。代码中没有发现明显的恶意行为或后门。`README.md` 文件只是简单的使用说明。

**利用方式分析：**

1.  **环境准备：** 目标系统运行着存在漏洞的Samba版本，并且满足利用条件（开启username map script 或 已认证用户）。
2.  **监听端口：** 攻击者使用`nc -lnpt <lport>`在攻击机上监听指定端口，等待反弹shell。
3.  **运行POC：** 攻击者运行提供的Python POC脚本，输入目标IP地址、端口、攻击机IP地址和监听端口。
4.  **触发漏洞：** POC脚本建立SMB连接，并发送包含反弹shell命令的用户名到目标系统。目标系统执行该命令。
5.  **获取Shell：** 如果漏洞利用成功，攻击者将在攻击机上获得目标系统的shell。

**搜索引擎结果补充：**

*   多个来源确认了漏洞的存在和危害。
*   一些来源提供了缓解措施，例如禁用外部脚本调用。

**项目地址:** [s4msec/CVE-2007-2447](https://github.com/s4msec/CVE-2007-2447)

**漏洞详情:** [CVE-2007-2447](https://nvd.nist.gov/vuln/detail/CVE-2007-2447)