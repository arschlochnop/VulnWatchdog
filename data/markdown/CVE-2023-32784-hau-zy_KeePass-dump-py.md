## CVE-2023-32784-KeePass-主密码泄露

**漏洞编号:** CVE-2023-32784

**漏洞类型:** 内存信息泄露

**影响应用:** KeePass

**危害等级:** 高危，可能导致数据库密码泄露

**影响版本:** < 2.54

**利用条件:** 需要能够访问运行KeePass的系统，例如通过webshell、本地权限等

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-32784是KeePass 2.x版本在2.54之前的内存泄露漏洞。攻击者可以通过dump KeePass进程的内存，或者分析swap文件、休眠文件、甚至整个系统的RAM dump，来恢复明文的主密码。POC代码`keepassdump.py`尝试自动化这个过程：首先检查KeePass进程是否运行，如果没有运行则尝试启动KeePass。然后，它使用powershell命令（通过WerFault）dump KeePass进程的内存到临时文件。最后，它扫描dump文件，尝试定位和提取主密码。搜索结果表明此漏洞可以被利用。`vdohney/keepass-password-dumper` 是原始的POC，而`keepassdump.py` 是用Python重写的版本。漏洞利用依赖于访问系统内存的能力。投毒风险评估：虽然POC的大部分代码看起来是合法的漏洞利用代码，但subprocess模块的使用，尤其是powershell命令的构造和执行，存在一定的风险。攻击者可能通过修改powershell命令来执行恶意代码，例如下载和执行其他程序。`subprocess.call(cmd, shell=False)` 在windows下，当`shell=False`时，cmd会被当做单个字符串，如果cmd字符串本身包含恶意命令，则有被执行的风险，从而导致投毒。另外，通过检查代码发现作者在`open_proc`函数中硬编码了KeePass的安装路径，如果用户安装在其他路径，则POC会失效，这是一个潜在的缺陷或者是一种变相的投毒方式。文件扫描密码的逻辑相对简单，有可能无法准确提取密码，或者提取到其他敏感信息。综合考虑，投毒风险较低，大约为10%。

**项目地址:** [hau-zy/KeePass-dump-py](https://github.com/hau-zy/KeePass-dump-py)

**漏洞详情:** [CVE-2023-32784](https://nvd.nist.gov/vuln/detail/CVE-2023-32784)