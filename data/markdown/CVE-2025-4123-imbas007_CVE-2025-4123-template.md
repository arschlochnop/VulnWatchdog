## CVE-2025-4123-Grafana-XSS/Open Redirect/SSRF

**漏洞编号:** CVE-2025-4123

**漏洞类型:** XSS/Open Redirect/SSRF

**影响应用:** Grafana

**危害等级:** 高危，可能导致账户劫持、敏感信息泄露、SSRF

**影响版本:** 受影响版本包括 Grafana 10.4.18+security-01 之前的所有 10.4.x 版本、11.2.9+security-01 之前的所有 11.2.x 版本、11.3.6+security-01 之前的所有 11.3.x 版本、11.4.4+security-01 之前的所有 11.4.x 版本、11.5.4+security-01 之前的所有 11.5.x 版本、11.6.1+security-01 之前的所有 11.6.x 版本、以及 12.0.0+security-01 之前的所有 12.0.x 版本。

**利用条件:** 需要用户交互（点击恶意链接），匿名访问可能增加风险，安装Grafana Image Renderer插件将允许SSRF攻击。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2025-4123 是 Grafana 中的一个高危漏洞，它结合了客户端路径遍历和开放重定向，导致 XSS。 攻击者可以利用此漏洞将用户重定向到托管前端插件的恶意网站，从而执行任意 JavaScript 代码。 如果启用了匿名访问，则此漏洞无需编辑权限即可利用。 如果安装了 Grafana Image Renderer 插件，则可以利用开放重定向来实现完整的读取 SSRF。该漏洞的CVSS评分为7.6，属于高危漏洞。 漏洞利用方式为：攻击者构造包含恶意路径的URL，诱导用户点击。该URL首先利用客户端路径遍历和开放重定向，将用户重定向到攻击者控制的服务器，然后攻击者控制的服务器返回包含恶意 JavaScript 代码的页面，从而在用户的浏览器中执行任意代码。

**有效性评估：** 根据搜索结果和提供的nuclei模板，可以确认该漏洞利用代码（nuclei模板）是有效的。多个来源证实了漏洞的存在，以及利用客户端路径遍历和开放重定向进行XSS和SSRF攻击的可能性。

**投毒风险评估：** nuclei模板文件本身没有明显的恶意代码，主要是请求和匹配。但是`README.md`文件内容简单,也无风险,总体仓库较小,但需要人工进行review确认没有被篡改覆盖。

**利用方式分析：**

1.  **开放重定向：** 利用 Grafana 的开放重定向漏洞，将用户重定向到恶意网站。
2.  **XSS：** 在恶意网站上托管包含 XSS 有效负载的 JavaScript 代码，当用户被重定向到该网站时，恶意代码将在用户的浏览器中执行。
3.  **SSRF（可选）：** 如果安装了 Grafana Image Renderer 插件，则可以利用开放重定向来实现 SSRF 攻击，读取内部服务的信息。

**Nuclei 模板利用流程：**

1.  Nuclei 模板发送包含特殊构造的 URL 的 GET 请求，该 URL 包含路径遍历序列（`..%252f%255C` 或 `..%2F%5c`）和指向恶意网站的重定向（`{{interactsh-url}}` 或 `oast.pro`）。
2.  Grafana 服务器处理请求时，由于路径遍历漏洞，会错误地将请求重定向到恶意网站。
3.  如果请求成功重定向，Nuclei 模板会通过状态码（302）和 Location 头部中是否包含恶意网站的 URL 来判断是否存在开放重定向漏洞。
4.  如果 Interactsh 检测到 DNS 交互，并且 content type 是 image/png 说明存在SSRF漏洞，这是因为 `/render` 接口会尝试渲染重定向到的地址，从而触发SSRF。

**项目地址:** [imbas007/CVE-2025-4123-template](https://github.com/imbas007/CVE-2025-4123-template)

**漏洞详情:** [CVE-2025-4123](https://nvd.nist.gov/vuln/detail/CVE-2025-4123)