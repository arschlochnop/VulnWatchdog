## CVE-2017-9841-PHPUnit-远程代码执行

**漏洞编号:** CVE-2017-9841

**漏洞类型:** 远程代码执行

**影响应用:** PHPUnit

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** PHPUnit < 4.8.28 和 PHPUnit 5.x < 5.6.3

**利用条件:** 目标服务器运行受影响版本的PHPUnit，并且/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php URI可公开访问

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2017-9841 漏洞允许远程攻击者通过向 `Util/PHP/eval-stdin.php` 发送以 `<?php` 开头的 HTTP POST 数据来执行任意 PHP 代码。从提供的漏洞库信息和搜索引擎结果来看，这是一个被广泛利用的漏洞。PoC代码仓库提供了一个masscanner，表明了该漏洞的可利用性。 

**有效性：**
提供的PoC代码利用了该漏洞，通过扫描目标并发送恶意payload实现远程代码执行。

**投毒风险：**
代码仓库包含 `Pipfile` 和 `Pipfile.lock`，用于管理依赖。`README.md` 描述了工具的用法，包括扫描IP范围和主机列表。`dorks.txt` 包含用于查找潜在目标的 Google dorks。`main.py` 是主脚本，负责执行扫描和利用。 `error.log` 为空，表明没有已知的报错信息

虽然看起来是一个正常的漏洞利用工具，但是代码中仍然存在一定的投毒风险：

*   **隐蔽后门：** 作者可能在 `modules/executor.py`或其他未提供的模块中添加了恶意代码，例如收集目标信息或执行其他未授权操作。由于 `modules` 文件夹中的具体文件未提供，无法完全确定。 
*   **依赖项风险：** 虽然 `Pipfile.lock` 锁定了解释和依赖项的版本，但仍然存在通过替换PyPI镜像源的方式引入恶意依赖的风险。 

综合考虑，认为存在 **10%** 的投毒风险，主要集中在 `modules` 文件夹中的脚本是否做了其他未授权的操作上。 

**利用方式：**
1.  扫描：使用提供的扫描脚本或dorks扫描互联网上暴露的、存在漏洞的PHPUnit应用。
2.  Payload构造：构造以 `<?php` 开头的 PHP 代码，例如执行系统命令的 `<?php system($_GET['cmd']); ?>`。
3.  发送请求：向 `/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php` 发送包含 payload 的 HTTP POST 请求。
4.  代码执行：服务器执行 payload，攻击者可以控制服务器。

**项目地址:** [incogbyte/laravel-phpunit-rce-masscaner](https://github.com/incogbyte/laravel-phpunit-rce-masscaner)

**漏洞详情:** [CVE-2017-9841](https://nvd.nist.gov/vuln/detail/CVE-2017-9841)