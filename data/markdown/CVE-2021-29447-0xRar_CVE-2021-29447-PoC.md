## CVE-2021-29447-WordPress-XXE

**漏洞编号:** CVE-2021-29447

**漏洞类型:** XML 外部实体注入 (XXE)

**影响应用:** WordPress

**危害等级:** 高危，可能导致敏感文件泄露，服务器端请求伪造 (SSRF)

**影响版本:** 5.6.0 <= version < 5.7.1 (需要PHP 8环境)

**利用条件:** 需要 WordPress 站点运行在 PHP 8 环境，并具有文件上传权限（例如 Author 角色）

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-29447 是一个 WordPress 的 XXE 漏洞，存在于 5.6 到 5.7 版本中，且需要运行在 PHP 8 环境下。攻击者需要具备文件上传权限，比如拥有 Author 角色。漏洞原理是 WordPress 在处理上传的媒体文件时，特别是 WAVE 音频文件，其中使用的 ID3 解析库存在 XML 解析问题。攻击者可以构造恶意的 WAVE 文件，其中包含指向外部实体的 XML 代码，从而读取服务器上的任意文件，或进行服务器端请求伪造。

**利用方式:**

1.  攻击者首先需要一个具有文件上传权限的 WordPress 账户（如 Author）。
2.  攻击者构造一个包含恶意 XML 内容的 WAVE 文件（payload.wav）。该 XML 声明了一个外部实体，指向攻击者控制的服务器上的 DTD 文件。
3.  攻击者在自己的服务器上部署一个恶意的 DTD 文件（evil.dtd）。该 DTD 文件定义了另一个实体，用于读取目标服务器上的文件内容，并通过 HTTP 请求将内容发送给攻击者。
4.  攻击者将构造的恶意 WAVE 文件上传到 WordPress 的媒体库。
5.  当 WordPress 解析该 WAVE 文件时，会触发 XXE 漏洞，加载攻击者服务器上的 DTD 文件，并读取目标文件内容，将 base64 编码后的内容发送到攻击者的服务器。
6.  攻击者从 HTTP 请求中获取 base64 编码的数据，并进行解码，得到目标文件的内容。

**POC 代码分析:**

提供的 Python 脚本 `PoC.py` 用于自动化生成恶意的 `payload.wav` 和 `evil.dtd` 文件。该脚本需要指定攻击者的服务器 IP 地址、端口，以及要读取的目标文件路径。脚本还会启动一个简单的 PHP HTTP 服务器，用于接收目标服务器发送的请求。

**投毒风险评估:**

代码本身功能明确，就是用于生成payload和启动http server，没有发现任何隐藏的恶意代码或后门。decode.php只是用来解码base64数据，所以判定没有投毒风险。

**项目地址:** [0xRar/CVE-2021-29447-PoC](https://github.com/0xRar/CVE-2021-29447-PoC)

**漏洞详情:** [CVE-2021-29447](https://nvd.nist.gov/vuln/detail/CVE-2021-29447)