## CVE-2022-0995 - Linux kernel watch_queue OOB write

**漏洞编号:** CVE-2022-0995

**漏洞类型:** Out-of-bounds write

**影响应用:** Linux kernel

**危害等级:** 高危，允许本地用户提升权限或导致拒绝服务

**影响版本:** kernel 5.17 rc8，以及 Ubuntu 21.10 kernel 5.13.0-37 (根据github信息)

**利用条件:** 需要本地用户权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-0995 是 Linux 内核的 watch_queue 事件通知子系统中发现的一个越界 (OOB) 内存写入漏洞。该漏洞允许本地用户覆盖内核状态的部分内容，可能导致权限提升或拒绝服务。

**利用方式分析：**

1.  **漏洞点：** watch_queue 子系统的 filter 处理逻辑存在越界写入漏洞。
2.  **利用方法：** 漏洞利用代码通过消息队列 (msg_msg) 在 kmalloc-96 和 kmalloc-1024 缓存中喷射对象。然后在 kmalloc-96 缓存中制造一个空洞。之后利用 watch_queue 的漏洞进行越界写，覆盖相邻的内核内存对象。 通过覆盖`pipe_buffer`结构中的`ops`指针为预先构造的恶意`pipe_buf_operations`结构，该结构指向用户空间的恶意代码，最终实现提权。
3.  **POC 代码有效性：** 根据 Github 页面和搜索结果，POC 代码已存在并且可以利用，但并非 100% 可靠，可能需要多次尝试，github代码明确指出针对Ubuntu 21.10 kernel 5.13.0-37。
4.  **投毒风险评估：**
    *   查看提供的 `exploit.c` 代码，里面存在利用消息队列、socket、pipe等进行内存布局的操作，目的是为了稳定利用。`get_shell()`函数内存在设置suid，修改文件权限，以及执行`/tmp/trigger`操作， 恶意程度很高。但是，`/tmp/trigger`的内容依赖于`echo -e "\xff\xff\xff\xff" > /tmp/trigger`，本质上是覆盖一个文件，如果不存在后门文件，那么提权利用并不会成功。综合考虑，投毒风险判断为 10%。主要是`/tmp/trigger`执行的指令未知，存在潜在风险。


**项目地址:** [1nzag/CVE-2022-0995](https://github.com/1nzag/CVE-2022-0995)

**漏洞详情:** [CVE-2022-0995](https://nvd.nist.gov/vuln/detail/CVE-2022-0995)