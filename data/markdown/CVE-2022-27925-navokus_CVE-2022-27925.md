## CVE-2022-27925-Zimbra-目录遍历文件上传

**漏洞编号:** CVE-2022-27925

**漏洞类型:** 目录遍历/文件上传

**影响应用:** Zimbra Collaboration Suite (ZCS)

**危害等级:** 高危，可能导致任意文件上传和远程代码执行

**影响版本:** 8.8.15 和 9.0

**利用条件:** 需要管理员权限的身份验证（但根据搜索结果可能存在绕过）

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

该漏洞存在于Zimbra Collaboration Suite 8.8.15和9.0的mboximport功能中。具有管理员权限的已认证用户可以通过上传包含恶意路径的ZIP文件，利用目录遍历漏洞将任意文件写入系统。漏洞利用方式如下：

1.  **漏洞原理：**mboximport功能接收ZIP压缩包并解压，由于未对压缩包内的文件路径进行充分验证，攻击者可以通过构造包含特殊字符（如“../”）的路径，将文件写入任意目录。
2.  **利用步骤：**
    *   构建一个包含恶意JSP shell的ZIP文件，JSP shell的文件名和路径经过精心构造，利用目录遍历写入到Web服务器的可执行目录下。
    *   使用管理员权限登录Zimbra管理界面。
    *   通过mboximport功能上传构造好的ZIP文件。
    *   如果上传成功，JSP shell将被写入指定目录。
    *   通过访问JSP shell的URL来执行任意命令。
3.  **POC代码分析：**
    *   `run.py`脚本使用`zipfile`库创建一个包含JSP shell的ZIP文件。
    *   JSP shell的功能是接收`cmd`参数，并在服务器上执行该命令，然后将结果返回。
    *   脚本尝试将JSP shell写入三个不同的路径：`../../../../mailboxd/webapps/zimbraAdmin/admin.bk.jsp`，`../../../../jetty_base/webapps/zimbraAdmin/admin.bk.jsp`和`../../../../jetty/webapps/zimbraAdmin/admin.bk.jsp`，涵盖了不同的Zimbra部署环境。
    *   脚本使用`requests`库向`/service/extensio3/backup/mboximport`和`/service/extension/backup/mboximport`端点发送POST请求，上传ZIP文件。
    *   最后，脚本尝试通过访问JSP shell的URL（`/zimbraAdmin/admin.bk.jsp?cmd=`）来执行命令`ps aux`或`ls -la`，并打印HTTP状态码以确认漏洞是否利用成功。
4.  **有效性：**
    *   根据漏洞库信息和搜索结果，该漏洞是真实存在的，并且已经被积极利用。
    *   提供的POC代码看起来有效，因为它能够构造恶意ZIP文件，并尝试将其上传到目标服务器，并在成功上传后执行命令。
5.  **投毒风险：**
    *   对提供的POC代码进行了分析，没有发现任何明显的投毒代码。该脚本的主要功能是利用漏洞进行攻击，而不是在目标系统上安装后门或其他恶意软件。因此，投毒风险为0%。
6.  **其他风险:**
    *  搜索结果表明，CVE-2022-27925常与其他漏洞（例如CVE-2022-37042）组合利用，实现未经身份验证的远程代码执行。这意味着即使攻击者没有管理员权限，也可能通过其他漏洞绕过身份验证，然后利用此漏洞上传恶意文件并执行代码。

**项目地址:** [navokus/CVE-2022-27925](https://github.com/navokus/CVE-2022-27925)

**漏洞详情:** [CVE-2022-27925](https://nvd.nist.gov/vuln/detail/CVE-2022-27925)