## CVE-2024-3400 Palo Alto PAN-OS GlobalProtect 任意文件创建导致命令注入

**漏洞编号:** CVE-2024-3400

**漏洞类型:** 命令注入

**影响应用:** Palo Alto Networks PAN-OS GlobalProtect

**危害等级:** 高危，未经身份验证的攻击者可以在防火墙上以 root 权限执行任意代码。

**影响版本:** PAN-OS 10.2, PAN-OS 11.0, and PAN-OS 11.1版本, 小于 PAN-OS 10.2.9-h1, PAN-OS 11.0.4-h1, PAN-OS 11.1.2-h3

**利用条件:** 目标设备配置了 GlobalProtect 网关或 GlobalProtect 门户。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-3400是Palo Alto Networks PAN-OS软件GlobalProtect功能中的一个命令注入漏洞，该漏洞是由于任意文件创建导致的。未经身份验证的攻击者可以通过向目标系统发送特制的HTTP请求，在特定版本的PAN-OS上，利用GlobalProtect功能写入任意文件，最终导致命令注入，以root权限执行任意代码。

**漏洞利用方式：**

1.  **确定目标：** 找到运行受影响PAN-OS版本且配置了GlobalProtect网关或门户的Palo Alto防火墙。
2.  **利用漏洞：** 通过发送包含恶意Cookie的HTTP POST请求到`/ssl-vpn/hipreport.esp`，在`/var/appweb/sslvpndocs/global-protect/portal/images/`目录下创建任意文件。Cookie中包含`SESSID=/../../../var/appweb/sslvpndocs/global-protect/portal/images/${file_here};`，`${file_here}`是要写入的文件名，也是命令注入的关键位置。
3.  **命令执行：**  创建的文件内容可被执行，从而实现命令注入。

**有效性评估：**

根据漏洞描述和漏洞利用代码，该POC代码是有效的。它通过`httpx`工具发送特制的HTTP请求，利用任意文件创建漏洞实现命令注入。脚本首先尝试写入文件，然后验证文件是否成功写入（通过检查HTTP状态码）。

**投毒风险分析：**

该POC代码本身比较简洁，主要利用了`httpx`工具发送恶意请求。潜在的投毒风险在于：

*   **恶意URL列表：** `gp.hosts`文件可能包含指向恶意站点的链接，这些站点可能托管恶意软件或进行其他攻击活动。用户在使用该脚本时，如果使用不可信的URL列表，可能会受到二次攻击。
*   **文件写入位置：** 攻击者可能会修改脚本，将文件写入到更敏感的位置，从而扩大攻击范围。

总体来说，投毒风险较低，约为10%。主要是由于脚本功能较为单一，且依赖于`httpx`工具，恶意代码隐藏的空间有限。但用户仍需谨慎使用，并确保使用可信的URL列表。

**缓解措施：**

*   升级到PAN-OS 10.2.9-h1, PAN-OS 11.0.4-h1, PAN-OS 11.1.2-h3或更高版本。
*   应用威胁防御签名95187、95189和95191。
*   对GlobalProtect接口应用漏洞保护。

**项目地址:** [ak1t4/CVE-2024-3400](https://github.com/ak1t4/CVE-2024-3400)

**漏洞详情:** [CVE-2024-3400](https://nvd.nist.gov/vuln/detail/CVE-2024-3400)