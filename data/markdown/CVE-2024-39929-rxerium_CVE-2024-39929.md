## CVE-2024-39929-Exim-MIME绕过

**漏洞编号:** CVE-2024-39929

**漏洞类型:** MIME绕过

**影响应用:** Exim

**危害等级:** 中危，可能导致恶意附件投递

**影响版本:** <= 4.97.1

**利用条件:** 需要目标Exim服务器开启邮件服务

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-39929 漏洞存在于 Exim 邮件服务器中，版本 <= 4.97.1。该漏洞源于 Exim 未能正确解析多行 RFC 2231 头部文件名，导致远程攻击者可以绕过 $mime_filename 扩展名阻止保护机制，从而可能将可执行附件传递到最终用户的邮箱。

**有效性：**
根据漏洞信息和搜索结果，存在利用此漏洞绕过扩展名检查的风险，从而导致恶意文件上传。提供的POC代码是一个nuclei模版，用于检测是否存在该漏洞，本身不包含漏洞利用代码。

**投毒风险：**
查看POC代码，主要包含以下内容：
*   `README.md`: 描述漏洞信息、nuclei工具的使用方法等。
*   `template.yaml`: nuclei模版文件，用于检测目标是否存在该漏洞。
该仓库主要提供的是一个nuclei漏洞检测模版，用于判断目标Exim服务器是否存在CVE-2024-39929漏洞，而不是直接进行漏洞利用。因此判断投毒的可能性较低，但仍然存在一定的风险。

该模版在检测时，仅会发送一个换行符`\n`，然后通过匹配返回结果中的Exim版本号来判断是否存在漏洞。该检测模版本身不包含任何可执行代码或恶意操作，因此直接利用该模版进行投毒的可能性很小。

但是，仍有较小的可能存在隐蔽的风险。例如：
*   作者可能在其他地方发布了与此漏洞相关的利用代码，并诱导用户下载使用，其中可能包含恶意代码。
*   该模版可能被篡改，添加恶意代码，并重新发布。
因此，虽然直接投毒的概率较低，但仍需保持警惕。

**利用方式：**
1.  攻击者构造包含恶意附件的电子邮件。
2.  在邮件头部中，构造畸形的多行RFC 2231头部文件名，绕过Exim的$mime_filename扩展名阻止机制。
3.  将包含恶意附件的邮件发送给目标Exim服务器。
4.  如果目标Exim服务器存在CVE-2024-39929漏洞，则会错误解析头部文件名，允许恶意附件通过检查。
5.  恶意附件被投递到最终用户的邮箱。
6.  用户打开恶意附件，导致恶意代码执行。


**项目地址:** [rxerium/CVE-2024-39929](https://github.com/rxerium/CVE-2024-39929)

**漏洞详情:** [CVE-2024-39929](https://nvd.nist.gov/vuln/detail/CVE-2024-39929)