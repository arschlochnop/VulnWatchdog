## CVE-2020-11097-FreeRDP-OOB读取

**漏洞编号:** CVE-2020-11097

**漏洞类型:** OOB读取

**影响应用:** FreeRDP

**危害等级:** 中危，可能导致信息泄露或程序崩溃

**影响版本:** < 2.1.2

**利用条件:** 需要RDP连接，并能够触发NTLM认证过程

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

该漏洞存在于FreeRDP的NTLM认证过程中，`ntlm_av_pair_get`函数在处理NTLM AV_PAIR对时，由于长度校验不充分，导致越界读取`PRIMARY_DRAWING_ORDER_FIELD_BYTES`数组。提供的POC代码模拟了一个恶意的NTLM协商过程，通过构造畸形的TargetInfo字段，使其AV_LEN为一个非常大的值，从而触发越界读取。

**有效性：**
根据漏洞描述和POC代码分析，该POC代码能够有效地触发漏洞，导致FreeRDP客户端崩溃或泄露内存信息。从搜索结果中，也确认了该漏洞的存在以及修复版本。

**投毒风险：**
提供的`test.py`代码主要用于模拟存在漏洞的服务器，发送包含恶意AV_PAIR的NTLM Challenge报文。该代码本身没有发现任何可疑的或恶意的代码，用于收集信息或执行其他恶意行为。因此，投毒风险较低，可能性为0%。

**利用方式：**
1.  攻击者搭建一个恶意的RDP服务器，或者劫持正常的RDP连接。
2.  当客户端尝试连接该服务器时，服务器发送一个精心构造的NTLM Challenge报文，其中包含畸形的TargetInfo字段，AV_LEN字段的值非常大。
3.  客户端在解析该报文时，由于`ntlm_av_pair_get`函数的长度校验不足，导致越界读取`PRIMARY_DRAWING_ORDER_FIELD_BYTES`数组，最终导致程序崩溃或者信息泄露。

**排序优先级说明：**
虽然漏洞库信息提供了漏洞的基本信息，但是搜索引擎结果可以帮助更好地了解漏洞的危害和利用方式。POC代码则可以验证漏洞的存在，帮助理解漏洞的原理。因此，本次分析遵循**搜索引擎结果 > 漏洞利用代码 > 漏洞库信息**的优先级。

**项目地址:** [SpiralBL0CK/CVE-2020-11097-POC](https://github.com/SpiralBL0CK/CVE-2020-11097-POC)

**漏洞详情:** [CVE-2020-11097](https://nvd.nist.gov/vuln/detail/CVE-2020-11097)