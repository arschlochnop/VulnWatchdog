## CVE-2021-3156-Sudo-Heap 缓冲区溢出

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap 缓冲区溢出

**影响应用:** Sudo

**危害等级:** 高危，允许本地用户提升权限至 root

**影响版本:** Sudo 1.8.2 - 1.9.5p1 (不包括 1.9.5p2)

**利用条件:** 需要本地用户权限

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2021-3156 (Baron Samedit) 是 Sudo 1.8.2 到 1.9.5p1 版本中存在的一个堆缓冲区溢出漏洞。漏洞存在于 sudo 如何解析命令行参数中，特别是当命令以单个反斜杠结尾时。攻击者可以通过 `sudoedit -s` 命令和一个以单个反斜杠字符结尾的命令行参数来触发此漏洞，从而导致堆缓冲区溢出，并最终允许本地用户提升权限至 root。

**有效性：**
根据漏洞库信息和搜索结果，该漏洞是真实存在的，并且有公开的利用代码。提供的 Python 脚本是一个漏洞检查器，用于确定目标系统是否受到 CVE-2021-3156 的影响。它通过检查 sudo 的版本来判断系统是否存在漏洞。

**投毒风险：**
提供的 Python 脚本本身是一个检查器，用于验证系统是否存在漏洞。它不包含任何恶意代码或后门，但也不能完全排除在其他未提供的相关漏洞利用代码中存在投毒行为，概率很低。如果利用其他漏洞代码，需要仔细审查。

**利用方式：**
1.  **漏洞触发：** 利用 `sudoedit -s` 命令，并构造一个以单个反斜杠结尾的命令行参数，触发漏洞。
2.  **缓冲区溢出：** Sudo 在解析参数时存在 off-by-one 错误，导致堆缓冲区溢出。
3.  **权限提升：** 通过精心构造的溢出数据，攻击者可以覆盖堆上的关键数据结构，从而控制程序的执行流程，最终提升权限至 root。

根据搜索结果，该漏洞影响广泛，多个 Linux 发行版和 macOS 都受到了影响。存在公开的漏洞利用程序，使得攻击者可以很容易地利用该漏洞。


**项目地址:** [lypd0/CVE-2021-3156-checker](https://github.com/lypd0/CVE-2021-3156-checker)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)