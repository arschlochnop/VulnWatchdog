## CVE-2019-5736 - runc 容器逃逸

**漏洞编号:** CVE-2019-5736

**漏洞类型:** 容器逃逸

**影响应用:** runc (Docker, Kubernetes)

**危害等级:** 高危，允许容器内的攻击者获取主机 root 权限

**影响版本:** <= 1.0-rc6 (Docker < 18.09.2)

**利用条件:** 攻击者需要在受影响的容器中拥有执行代码的能力（例如，通过控制镜像或 docker exec）

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-5736 漏洞是 runc 中的一个文件描述符处理错误，允许攻击者通过覆盖主机上的 `runc` 二进制文件来逃逸容器。该漏洞的利用方式如下：

1.  **漏洞原理：** 当使用 `docker exec` 或创建新的容器时，`runc` 会被调用。漏洞利用的关键在于 `/proc/self/exe` 文件描述符的处理，攻击者可以利用此文件描述符来写入主机上的 `runc` 二进制文件。
2.  **利用条件：** 攻击者需要具备在目标容器内执行代码的能力，并且目标主机运行着存在漏洞版本的 Docker 或其他使用 runc 的容器平台。
3.  **利用步骤：**
    *   **准备 Payload：** 攻击者需要创建一个 Payload，该 Payload 将替换主机上的 `runc` 二进制文件。Payload 可以是任何可执行代码，例如反向 shell。
    *   **利用 exploit.c:** `exploit.c`首先打开`/proc/[pid]/exe`,然后使用恶意payload覆盖runc二进制文件。
    *   **触发漏洞：** 攻击者通过`docker exec`命令或创建新容器来触发漏洞。当主机尝试调用被篡改的 `runc` 二进制文件时，Payload 将以 root 权限执行。

4.  **代码分析：**
    *   `payload.c`：这是一个简单的反向 shell Payload，连接到攻击者指定的 IP 地址和端口。
    *   `exploit.c`：该程序尝试打开 `/proc/*/exe`，查找运行的 `runc` 进程，并使用 Payload 覆盖它。
    *   `pwn.sh`：该脚本在容器内部循环查找runC的进程，并且执行`exploit.c`进行覆盖。
    *   `README.md`：说明了漏洞利用方法，以及漏洞利用具有破坏性，会覆盖宿主机上的`/usr/bin/docker-runc`二进制文件,还覆盖了容器内的`/bin/sh`。

5.  **投毒风险分析：**
    *   该代码仓库的主要目的是提供 CVE-2019-5736 漏洞的 PoC。虽然总体目的是为了展示漏洞，但存在潜在的投毒风险，例如：
    *   `payload.c` 中的恶意 IP 地址或端口：攻击者可能会修改 `payload.c`，将反向 shell 连接到恶意 IP 地址或端口，从而控制受害者主机。
    *   `exploit.c` 中的后门：攻击者可能会在 `exploit.c` 中添加额外的代码，例如安装后门或收集敏感信息。
    *   根据经验和代码检查，该仓库中作者隐藏的投毒代码可能性较低，约为 10%。这个PoC主要用来验证漏洞，但使用者仍然需要仔细检查代码，确保没有恶意修改。

6.  **有效性评估：**
    *   根据漏洞描述、搜索结果和 PoC 代码，该漏洞利用是有效的。成功利用该漏洞可以使攻击者获得主机的 root 权限。

7.  **缓解措施：**
    *   升级 Docker 到 >= 18.09.2 或更新的 runc 版本。
    *   实施容器安全策略，限制容器的权限。
    *   使用安全扫描工具检测容器镜像中的漏洞。

总之，CVE-2019-5736 是一个严重的安全漏洞，需要及时修复。在使用 PoC 代码时，务必谨慎，并仔细检查代码是否存在恶意修改。

**项目地址:** [likekabin/CVE-2019-5736](https://github.com/likekabin/CVE-2019-5736)

**漏洞详情:** [CVE-2019-5736](https://nvd.nist.gov/vuln/detail/CVE-2019-5736)