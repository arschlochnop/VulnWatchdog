## CVE-2023-22809-sudoedit权限提升漏洞

**漏洞编号:** CVE-2023-22809

**漏洞类型:** 权限提升

**影响应用:** Sudo

**危害等级:** 高危，允许本地用户提升至root权限

**影响版本:** 1.8.0 - 1.9.12p1

**利用条件:** 目标系统sudo版本在受影响范围内，当前用户需要具有使用sudoedit或sudo -e命令编辑文件的权限，且目标文件属于root或ALL用户/用户组。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2023-22809 漏洞存在于 Sudo 1.8.0 到 1.9.12p1 版本中。sudoedit (也称为 -e) 功能错误地处理了用户提供的环境变量（SUDO_EDITOR、VISUAL 和 EDITOR）中传递的额外参数，允许本地攻击者将任意条目附加到要处理的文件列表中。这可能导致权限提升。问题在于用户指定的编辑器可能包含一个“--”参数，该参数会破坏保护机制，例如，EDITOR='vim -- /path/to/extra/file' 值。

**利用方式：**

1.  **检查sudo版本：** 检查目标系统上安装的sudo版本是否在受影响范围内（1.8.0 到 1.9.12p1）。
2.  **验证sudoedit权限：** 确认当前用户是否具有使用`sudoedit`或`sudo -e`命令编辑root权限文件的权限。可以通过`sudo -l`命令查看当前用户的sudo权限。
3.  **设置环境变量：** 设置环境变量`EDITOR`、`VISUAL`或`SUDO_EDITOR`，使其包含恶意参数。例如，`EDITOR='nano -- /etc/sudoers'`。
4.  **执行sudoedit：** 使用`sudoedit`或`sudo -e`命令编辑目标文件。由于环境变量中的恶意参数，实际上可以编辑`/etc/sudoers`文件。
5.  **修改sudoers文件：** 在`/etc/sudoers`文件中添加当前用户具有免密sudo权限的条目，例如`username ALL=(ALL:ALL) ALL`。
6.  **获取root权限：** 使用`sudo su root`或`sudo -i`命令获取root权限。

**有效性：**

提供的POC代码有效。它首先检查sudo版本，然后验证用户是否可以运行sudoedit命令。如果可以，它会指示用户将一行添加到sudoers文件中，以便授予用户root权限。最后，它尝试使用`sudo su root`获取root shell。

**投毒风险：**

查看了exploit.sh脚本。该脚本的主要功能是利用CVE-2023-22809漏洞，通过修改/etc/sudoers文件来提升权限。没有发现任何明显的恶意代码或后门。该脚本的目的是利用漏洞，而不是植入持久性的后门。该脚本需要用户交互，在sudoers文件中添加特定行，这降低了静默投毒的风险。
根据分析，此仓库中存在作者隐藏的投毒代码的可能性为0%。

**项目地址:** [asepsaepdin/CVE-2023-22809](https://github.com/asepsaepdin/CVE-2023-22809)

**漏洞详情:** [CVE-2023-22809](https://nvd.nist.gov/vuln/detail/CVE-2023-22809)