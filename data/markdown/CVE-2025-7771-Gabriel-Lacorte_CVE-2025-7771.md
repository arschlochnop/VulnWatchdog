## CVE-2025-7771-ThrottleStop-权限提升/代码执行

**漏洞编号:** CVE-2025-7771

**漏洞类型:** 权限提升/代码执行

**影响应用:** ThrottleStop

**危害等级:** 高危，允许本地攻击者在内核上下文中执行任意代码，导致权限提升和潜在的后续攻击，例如禁用安全软件或绕过内核级保护。

**影响版本:** 3.0.0.0 及可能其他版本

**利用条件:** 需要存在易受攻击的ThrottleStop.sys驱动程序，并具有执行用户模式应用程序的权限。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2025-7771 存在于 ThrottleStop.sys 驱动中，该驱动暴露了两个 IOCTL 接口，允许通过 `MmMapIoSpace` 函数对物理内存进行任意读写访问。攻击者可以通过用户模式应用程序利用这些接口来修补运行中的 Windows 内核，并使用 ring-0 权限调用任意内核函数。

**有效性：**

根据漏洞库信息和搜索引擎结果，此漏洞是真实存在的，并且已经有可用的PoC代码。PoC代码利用 `ThrottleStop.sys` 驱动程序中的漏洞，通过发送特制的 IOCTL 请求，实现对物理内存的读写，最终调用内核函数 `DbgPrint`，证明了可以在 Ring 0 下执行代码。

**投毒风险：**

代码分析表明，PoC代码主要包含以下几个部分：

1.  **`main.cpp`**:  主程序入口，负责创建 `ThrottleStop` 实例，获取内核基址，并调用 `DbgPrint` 函数。
2.  **`throttlestop/throttlestop.cpp`**: 包含 `ThrottleStop` 类的实现，该类负责与驱动程序交互，读取物理内存，写入物理内存，以及查找系统模块基址等。
3.  **`throttlestop/common.h`**: 定义了驱动程序名称、路径和设备名称等常量。

虽然代码本身主要关注漏洞利用，但潜在的投毒风险包括：

*   **依赖项替换**:  `throttlestop.h`中可能包含未公开的恶意功能。
*   **后门IOCTL**:  驱动程序本身可能包含未公开的IOCTL，用于执行恶意操作。
*   **编译时注入**:  构建脚本或Makefile可能被修改，以在编译过程中注入恶意代码。

考虑到作者可能在驱动程序交互，地址解析过程加入恶意代码。给予10%的投毒概率。

**利用方式：**

1.  **查找 `ThrottleStop.sys` 驱动程序**: 确定目标系统上是否存在易受攻击的 `ThrottleStop.sys` 驱动程序。
2.  **获取驱动程序句柄**:  通过 `CreateFileW` 函数打开 `ThrottleStop.sys` 驱动程序的设备。
3.  **查找内核基址**:  通过读取内存或使用 `NtQuerySystemInformation` 函数查找 `ntoskrnl.exe` 的基址。
4.  **构造 IOCTL 请求**:  构造包含要读取或写入的物理地址和值的 IOCTL 请求。
5.  **发送 IOCTL 请求**:  使用 `DeviceIoControl` 函数将 IOCTL 请求发送到 `ThrottleStop.sys` 驱动程序。
6.  **执行任意代码**:  通过修改内核内存中的函数指针或其他关键数据，执行任意代码。

**项目地址:** [Gabriel-Lacorte/CVE-2025-7771](https://github.com/Gabriel-Lacorte/CVE-2025-7771)

**漏洞详情:** [CVE-2025-7771](https://nvd.nist.gov/vuln/detail/CVE-2025-7771)