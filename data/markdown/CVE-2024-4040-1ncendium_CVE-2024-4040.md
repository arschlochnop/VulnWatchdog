## CVE-2024-4040-CrushFTP-服务器端模板注入

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** CrushFTP

**危害等级:** 高危，可导致任意文件读取、认证绕过和远程代码执行

**影响版本:** 10.0 < version < 10.7.1 和 11.0 < version < 11.1.0

**利用条件:** 目标系统需要运行存在漏洞的CrushFTP版本，且攻击者需要能够访问目标服务器的网络端口。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-4040 是 CrushFTP 中存在的一个严重的服务器端模板注入 (SSTI) 漏洞。根据漏洞库信息、搜索引擎结果和提供的漏洞利用代码，可以总结如下：

**1. 有效性:**

提供的PoC代码是有效的。PoC代码通过发送包含恶意模板的请求到目标服务器，利用服务器端模板引擎的缺陷，从而读取任意文件。根据PoC的描述，还可以绕过身份验证以获得管理权限，甚至执行远程代码。

`exploit.py` 文件中的 `test_if_vulnerable` 函数通过检查响应是否包含 `commandResult` 字符串来初步判断目标是否易受攻击。`include_file` 函数通过构造包含 `<INCLUDE>{file}</INCLUDE>` 标签的请求来包含指定的文件。

**2. 投毒风险:**

分析提供的PoC代码，投毒风险较低，约 5%。主要原因是：

*   PoC代码逻辑相对简单，主要功能是发送带有恶意模板的HTTP请求。
*   代码主要利用的是服务器端模板注入漏洞，本身没有明显的恶意行为，例如植入后门或上传恶意文件。
*   代码中没有发现连接到外部未知服务器或下载执行未知代码的行为。

风险主要来自以下可能：

*   **依赖风险:** `exploit.py` 依赖于 `requests` 库。虽然 `requests` 是一个常用的库，但也存在被供应链攻击的风险，如果 `requests` 库被篡改，可能会导致PoC被植入恶意代码。
*   **人为修改:** 如果攻击者下载了PoC代码后，手动添加了恶意代码，例如反弹shell，那么就存在投毒风险。

**3. 利用方式:**

该漏洞的利用方式如下：

1.  **确定目标:** 找到运行存在漏洞的 CrushFTP 版本的服务器。
2.  **发送恶意请求:** 使用 PoC 代码，构造包含恶意模板的 HTTP POST 请求，发送到目标的 `/WebInterface/login.html` 路径。
3.  **任意文件读取:** 通过在请求中指定要读取的文件路径，利用服务器端模板注入漏洞，读取目标服务器上的任意文件。
4.  **权限提升/RCE:** 结合读取到的文件内容，或者直接利用模板注入，绕过身份验证，获取管理员权限，执行任意命令。

**4. 优先级排序:**

根据优先级，排序如下：

1.  **搜索引擎结果:** 搜索引擎结果表明 CVE-2024-4040 漏洞正在被积极利用，并提供了检测和缓解该漏洞的指南。
2.  **漏洞利用代码:** 提供的 PoC 代码确认了漏洞的可利用性，并且可以直接用于测试和攻击目标系统。
3.  **漏洞库信息:** 漏洞库信息提供了关于漏洞的详细描述、影响和 CVSS 评分，确认了漏洞的严重性。


**项目地址:** [1ncendium/CVE-2024-4040](https://github.com/1ncendium/CVE-2024-4040)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)