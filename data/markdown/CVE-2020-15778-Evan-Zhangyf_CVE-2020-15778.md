## CVE-2020-15778 OpenSSH SCP 命令注入

**漏洞编号:** CVE-2020-15778

**漏洞类型:** 命令注入

**影响应用:** OpenSSH

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** <= 8.3p1

**利用条件:** 需要目标系统运行受影响版本的OpenSSH，并且允许通过scp进行文件传输

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-15778 存在于 OpenSSH 的 scp 工具中，具体是 `scp.c` 文件的 `toremote` 函数。该漏洞允许攻击者通过在目标参数中注入反引号字符来执行任意命令。由于 OpenSSH 没有充分验证或转义目标参数中的特殊字符，攻击者可以利用这一缺陷在服务器上执行恶意命令。 

**有效性：**
提供的 POC 代码通过构建 Docker 镜像来模拟受影响的 scp 服务器和客户端环境，验证了漏洞的有效性。攻击者可以使用 `scp nil.txt root@<internal IP of scp server>:'`your command`/tmp'` 命令注入 shell 命令。

**投毒风险：**
该仓库存在一定的投毒风险。虽然提供的Dockerfile看起来比较干净，但仍需要注意以下几点：
1.  **Docker镜像基础镜像：**Dockerfile使用的ubuntu:20.04镜像理论上是官方镜像，但仍存在被篡改的可能性，尽管可能性极低。
2.  **构建脚本：**构建脚本可能存在隐藏的恶意代码，虽然提供的构建步骤看起来很简单，但如果存在其他未公开的构建步骤，则可能存在风险。
3.  **命令注入本身：**即使仓库本身没有直接的投毒代码，该漏洞本身允许攻击者注入任意命令，从而在受害者机器上执行恶意操作。例如，可以利用该漏洞下载并执行恶意脚本。
综上所述，虽然直接的投毒代码的可能性较低，但考虑到Docker镜像和命令注入的潜在风险，该仓库存在约10%的投毒风险。

**利用方式：**
利用方式主要为：
1.  攻击者需要能够通过 scp 连接到目标服务器。
2.  攻击者构造包含反引号的恶意目标参数，例如：`scp file.txt user@host:'`malicious_command`:/path/to/dest'`
3.  当 scp 执行此命令时，反引号中的命令将在服务器上执行，从而导致命令注入。 
POC中给出了删除服务器所有文件以及反弹shell的例子，证明漏洞利用方式的有效性。

**项目地址:** [Evan-Zhangyf/CVE-2020-15778](https://github.com/Evan-Zhangyf/CVE-2020-15778)

**漏洞详情:** [CVE-2020-15778](https://nvd.nist.gov/vuln/detail/CVE-2020-15778)