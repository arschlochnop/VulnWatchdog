## CVE-2024-42327-Zabbix-SQL注入

**漏洞编号:** CVE-2024-42327

**漏洞类型:** SQL注入

**影响应用:** Zabbix

**危害等级:** 高危，可能导致权限提升和远程代码执行

**影响版本:** <=6.0.31, <=6.4.16, <=7.0.1

**利用条件:** 需要非管理员用户账户，且该账户拥有API访问权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-42327是Zabbix前端API中存在的一个SQL注入漏洞。非管理员用户，只要拥有API访问权限，就可以利用此漏洞。

**有效性：**

根据漏洞信息和搜索结果，以及提供的PoC代码，可以判定该漏洞利用的有效性较高。PoC代码演示了如何利用SQL注入漏洞，通过`user.get` API获取管理员的会话ID（sessionid）或密码哈希，进而提权执行操作，甚至远程代码执行。

**投毒风险：**

分析PoC代码，发现以下潜在投毒风险：

*   **硬编码依赖：** PoC代码中使用了类似 `u.userid=1` 这样的硬编码，假设管理员用户的ID为1。如果目标系统管理员ID不是1，脚本可能无法正常工作，或者被修改为执行恶意操作。
*   **远程代码执行：** 脚本通过创建和执行Zabbix脚本实现远程代码执行。攻击者可能修改脚本内容，执行任意恶意命令。
*   **权限维持：** 成功提权后，攻击者可以通过创建新的管理员账户来维持对系统的控制。
*   **数据篡改：** 通过SQL注入可以篡改数据库中的数据，影响Zabbix系统的监控数据和配置。

综合判断，该PoC代码存在一定的投毒风险，风险概率估计为10%。风险主要来自于利用成功后的恶意操作，而非PoC本身携带恶意payload。

**利用方式：**

1.  **身份验证：** 使用Zabbix前端的非管理员用户的用户名和密码，通过`user.login` API获取身份验证令牌（token）。
2.  **SQL注入：** 构造恶意的`user.get` API请求，在`selectRole`参数中注入SQL代码。PoC利用SQL注入，尝试获取管理员用户的会话ID或密码哈希。
3.  **权限提升：** 如果成功获取管理员的会话ID，可以使用该ID作为`Authorization` header，冒充管理员执行API操作。
4.  **远程代码执行（RCE）：**  利用管理员权限，创建一个新的Zabbix脚本，脚本内容为经过Base64编码的恶意命令，然后通过`script.execute` API执行该脚本。
5.  **创建用户：** 利用管理员权限，创建一个新的管理员用户，完成持久化攻击。

总体来说，该漏洞的利用涉及多个Zabbix API，结合SQL注入实现权限提升和远程代码执行。利用过程相对复杂，但PoC代码的存在降低了利用难度。

**项目地址:** [itform-fr/Zabbix---CVE-2024-42327](https://github.com/itform-fr/Zabbix---CVE-2024-42327)

**漏洞详情:** [CVE-2024-42327](https://nvd.nist.gov/vuln/detail/CVE-2024-42327)