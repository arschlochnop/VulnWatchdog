## CVE-2022-44268-ImageMagick-任意文件读取

**漏洞编号:** CVE-2022-44268

**漏洞类型:** 任意文件读取

**影响应用:** ImageMagick

**危害等级:** 高危，可能导致敏感信息泄露

**影响版本:** 7.1.0-49

**利用条件:** ImageMagick需要处理恶意构造的PNG图片，且运行ImageMagick的账户需要有读取目标文件的权限

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-44268是ImageMagick的一个任意文件读取漏洞。攻击者可以通过上传特制的PNG图像，利用ImageMagick解析PNG图片时的缺陷，将指定文件的内容嵌入到处理后的图像中。这个POC代码包含两个主要功能：

1.  **图像投毒 (Poison the image):**  `--image`、`--file-to-read` 和 `--output` 参数用于生成包含被读取文件内容的恶意PNG图片。它使用 Pillow 库来创建 PNG 图片，并将要读取的文件路径添加到 PNG 文件的元数据（PngInfo）中。这部分没有发现投毒代码。
2.  **漏洞验证 (Check if exploit was successful):**  `--url` 参数用于从远程服务器下载PNG图片（假设是先前投毒的），然后从图片的元数据中提取嵌入的文件内容。它首先获取 `Raw profile type`，对其进行十六进制解码，并打印解码后的内容。这部分没有发现投毒代码。

**利用方式：**

1.  攻击者首先使用POC脚本生成一个“投毒”的PNG文件，其中包含要读取的目标文件的路径。
2.  攻击者将这个恶意PNG文件上传到目标服务器，该服务器使用存在漏洞的ImageMagick版本处理上传的图片（例如，进行缩放）。
3.  当ImageMagick处理这个恶意PNG文件时，它会读取指定的文件，并将文件内容嵌入到处理后的图像中。
4.  攻击者下载处理后的图像，并使用POC脚本从图像中提取嵌入的文件内容。

**投毒风险评估：**

分析提供的Dockerfile、Python脚本、README和requirements.txt，没有发现明显的恶意代码或后门。该代码的主要目的是演示和验证CVE-2022-44268漏洞，没有执行任何与漏洞利用无关的操作，因此判断投毒风险较低，风险概率为0%。虽然使用了docker进行快速部署运行,但主要还是为了poc验证环境.requirements.txt只是常规的poc脚本依赖库。

**项目地址:** [mouftan/CVE-2022-44268](https://github.com/mouftan/CVE-2022-44268)

**漏洞详情:** [CVE-2022-44268](https://nvd.nist.gov/vuln/detail/CVE-2022-44268)