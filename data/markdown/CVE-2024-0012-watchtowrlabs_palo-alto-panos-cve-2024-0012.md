## CVE-2024-0012 PAN-OS 身份验证绕过

**漏洞编号:** CVE-2024-0012

**漏洞类型:** 身份验证绕过

**影响应用:** Palo Alto PAN-OS

**危害等级:** 高危，可能导致完全控制系统

**影响版本:** PAN-OS 10.2, 11.0, 11.1, 和 11.2 受影响版本

**利用条件:** 需要网络访问管理Web界面，特别是当管理界面暴露在互联网上时

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-0012 是 Palo Alto Networks PAN-OS 软件中的一个身份验证绕过漏洞，允许未经身份验证的攻击者通过网络访问管理 Web 界面，获得 PAN-OS 管理员权限。利用方式如下：

1.  **漏洞描述：** 攻击者可以绕过身份验证，从而执行管理操作，篡改配置或利用其他经过身份验证的权限提升漏洞（例如 CVE-2024-9474）。
2.  **影响范围：** PAN-OS 10.2, 11.0, 11.1 和 11.2 版本受影响。 Cloud NGFW 和 Prisma Access 不受此漏洞影响。
3.  **利用条件：** 攻击者需要能够通过网络访问 PAN-OS 的管理 Web 界面。如果管理界面暴露在互联网上，风险最高。限制仅从受信任的内部 IP 地址访问管理界面可以大大降低风险。
4.  **POC 验证：** 提供的 POC 代码 (`palo-alto-vpn-CVE-2024-0012-check-wt.yaml`) 是一个 Nuclei 模板，用于检测目标是否存在 CVE-2024-0012 漏洞。它通过发送一个带有 `X-PAN-AUTHCHECK: off` 头的 GET 请求到 `/php/utils/CmsGetDeviceSoftwareVersion.php/.js.map` 路径来尝试绕过身份验证。如果服务器返回状态码 200，并且响应头包含特定的字段（如 `Expires: 0`, `PHPSESSID=`, `application/json`）以及响应正文中包含字符串 "0.0.0"，则认为目标存在漏洞。
5.  **投毒风险分析：**
    *   POC 代码本身主要用于漏洞检测，目的是验证漏洞是否存在。`README.md` 仅提供漏洞信息和作者信息。
    *   虽然 POC 代码的目的是检测，但如果被恶意修改，例如在检测的同时执行某些恶意操作（例如，修改防火墙规则），则存在投毒的潜在风险。但当前提供的代码不具备该功能。仓库中其他文件主要是描述信息，没有发现明显的恶意代码。基于以上分析，投毒风险较低，估计约为 5%。 风险主要在于未来可能出现的恶意变种或二次修改。
6.  **缓解措施：**
    *   升级到已修复的 PAN-OS 版本（10.2.12-h2, 11.0.6-h1, 11.1.5-h1, 11.2.4-h1 及更高版本）。
    *   限制对管理 Web 界面的访问，仅允许受信任的内部 IP 地址访问。
    *   如果使用威胁防御订阅，可以使用威胁 ID 95746, 95747, 95752, 95753, 95759 和 95763 (在 Applications and Threats 内容版本 8915-9075 及更高版本中可用) 来阻止攻击。确保所有列出的威胁 ID 都设置为阻止模式，并通过 DP 端口路由 MGT 端口的入站流量，替换入站流量管理的证书，解密到管理界面的入站流量，并在到管理服务的入站流量上启用威胁防御。

**项目地址:** [watchtowrlabs/palo-alto-panos-cve-2024-0012](https://github.com/watchtowrlabs/palo-alto-panos-cve-2024-0012)

**漏洞详情:** [CVE-2024-0012](https://nvd.nist.gov/vuln/detail/CVE-2024-0012)