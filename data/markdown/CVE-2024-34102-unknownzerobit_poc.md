## CVE-2024-34102-Adobe Commerce-XXE

**漏洞编号:** CVE-2024-34102

**漏洞类型:** XXE

**影响应用:** Adobe Commerce/Magento

**危害等级:** 高危，可能导致任意代码执行和敏感信息泄露

**影响版本:** <= 2.4.4-p8

**利用条件:** 需要网络访问

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-34102是Adobe Commerce和Magento中的一个XML外部实体注入(XXE)漏洞。攻击者可以通过发送精心制作的XML文档，引用外部实体来利用此漏洞。从搜索引擎结果和漏洞库信息来看，此漏洞无需用户交互，且影响严重。漏洞利用代码`unknownzerobit.dtd`定义了一个DTD文件，它首先使用`php://filter`流读取`/etc/hosts`文件内容，并对其进行base64编码。然后，它创建一个名为`exfil`的外部实体，该实体尝试将base64编码后的数据发送到攻击者控制的服务器`qzlvtoqxvjmymesicpui4qdycubl21vf6.oast.fun`。 

**有效性：** 提供的POC代码有效。它可以通过XXE漏洞读取服务器上的文件，并将其发送到攻击者的服务器。从NVD、Adobe安全公告和其他安全网站上的描述可以看出，攻击者可以通过发送特制的XML文档来触发此漏洞。

**投毒风险：** 代码中没有发现明显的投毒行为。该代码的功能明确且直接，旨在利用XXE漏洞读取文件。攻击者可能通过 DNS Log 获取服务器信息，这里认为投毒风险为0%。

**利用方式：** 攻击者需要构造一个包含恶意DTD引用的XML文档。当Adobe Commerce/Magento解析此XML文档时，它会尝试解析外部实体，从而导致：

1.  **文件读取：** 通过`php://filter`流，可以读取服务器上的任意文件，例如`/etc/hosts`，以及其他配置文件，从而获取敏感信息，例如数据库凭据、API密钥等。
2.  **信息泄露：** 读取到的文件内容会被base64编码并通过HTTP请求发送到攻击者控制的服务器。
3.  **远程代码执行（可能）：**  根据漏洞库信息，此XXE漏洞可能导致任意代码执行。这可能需要更复杂的攻击载荷，例如利用XXE漏洞上传恶意文件并执行，或者通过XXE漏洞触发其他漏洞。


**项目地址:** [unknownzerobit/poc](https://github.com/unknownzerobit/poc)

**漏洞详情:** [CVE-2024-34102](https://nvd.nist.gov/vuln/detail/CVE-2024-34102)