## CVE-2024-30088 Windows Kernel Elevation of Privilege Vulnerability

**漏洞编号:** CVE-2024-30088

**漏洞类型:** 权限提升

**影响应用:** Windows Kernel

**危害等级:** 高危，可导致系统权限提升

**影响版本:** 受影响的Windows版本和版本号范围在漏洞库信息中已列出

**利用条件:** 需要本地访问权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-30088是一个Windows内核权限提升漏洞，是由于AuthzBasepCopyoutInternalSecurityAttributes函数在将当前令牌对象的_AUTHZBASEP_SECURITY_ATTRIBUTES_INFORMATION复制到用户模式时存在TOCTOU（Time-of-check Time-of-use）竞态条件漏洞。攻击者可以通过竞态条件修改安全属性名称的缓冲区指针，从而实现任意地址写入。

**有效性评估：**

*   根据搜索结果和POC描述，此漏洞已被APT34等组织利用，CISA KEV目录也已收录，表明该漏洞存在真实利用案例。
*   POC代码描述了漏洞原理，并提供了触发漏洞的方法（调用NtQueryInformationToken）。
*   补丁分析也表明了微软修复了该TOCTOU漏洞。
*   因此，提供的POC代码很可能有效。

**投毒风险评估：**

*   提供的文件包括一个README.md和一个Visual Studio解决方案文件(.sln)。
*   README.md文件包含漏洞描述、触发方式、补丁说明以及POC视频链接，看起来比较规范。
*   .sln文件是Visual Studio的项目文件，通常本身不包含可执行代码。投毒代码可能隐藏在POC的源代码中，例如，作者可能在利用过程中故意引入错误，使得POC在某些情况下破坏系统，或者植入后门。
*   由于缺乏实际的POC代码，只能假设存在一定的风险。需要仔细检查POC的源代码才能确定是否存在投毒代码。考虑到攻击者通常会将漏洞利用代码作为初始访问点，直接投毒的可能性较低，但不能完全排除。
*   **风险评估：** 10%。该评估基于没有检查源代码的情况下的粗略评估，需要进一步分析代码以确认是否存在恶意代码。

**利用方式：**

1.  **漏洞触发：** 通过调用NtQueryInformationToken函数，并指定TokenAccesInformation类来触发漏洞。
2.  **竞态条件：** 创建一个竞争线程，该线程的目标是在RtlCopyUnicodeString函数调用之前修改安全属性名称的缓冲区指针。
3.  **任意地址写入：** 利用竞态条件，攻击者可以将任意值写入任意地址，通常用于提升权限，例如修改进程令牌等。
4.  **权限提升：** 利用任意地址写入能力，攻击者可以提升当前进程的权限到SYSTEM级别。

**项目地址:** [tykawaii98/CVE-2024-30088](https://github.com/tykawaii98/CVE-2024-30088)

**漏洞详情:** [CVE-2024-30088](https://nvd.nist.gov/vuln/detail/CVE-2024-30088)