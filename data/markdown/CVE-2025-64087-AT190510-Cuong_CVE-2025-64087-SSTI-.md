## CVE-2025-64087 XDocReport Freemarker SSTI

**漏洞编号:** CVE-2025-64087

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** XDocReport

**危害等级:** 高危，可能导致远程代码执行和数据泄露

**影响版本:** 1.0.0 through 2.1.0

**利用条件:** 需要能够上传.docx文件的接口，且服务端使用Freemarker模板引擎处理

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

XDocReport存在一个服务器端模板注入漏洞，当使用FreeMarker引擎处理DOCX模板时，攻击者可以通过在模板中嵌入恶意表达式来执行任意代码。漏洞存在于 `fr.opensagres.xdocreport.template.freemarker.FreemarkerTemplateEngine.java` 文件中，因为该文件没有对上传的DOCX/模板文件内容进行验证。攻击者可以上传包含恶意FreeMarker表达式的`.docx`文件，例如 `${\"freemarker.template.utility.Execute\"?new()(\"whoami\")}`。 成功利用该漏洞可以导致远程代码执行(RCE)，从而允许攻击者窃取数据或完全控制系统。

**有效性：** 提供的POC代码有效，通过在.docx文件中插入恶意FreeMarker表达式，可以实现RCE。例如，可以使用`${"freemarker.template.utility.Execute"?new()("calc")}`打开计算器，或者使用`${"freemarker.template.utility.Execute"?new()("whoami")}`获取用户名。

**投毒风险：** 从提供的漏洞利用代码来看，投毒风险较低。虽然payload可以执行任意命令，但在示例中，payload都是一些常见的命令，比如`whoami`，`calc`，`dir`等。包含powershell的示例是为了建立反弹shell。 但是，考虑到该仓库可能存在其他隐藏的恶意代码，因此将投毒风险评估为10%。需要进一步的代码审计来确定是否存在其他恶意代码。

**利用方式：**
1.  攻击者上传包含恶意FreeMarker表达式的`.docx`文件。
2.  XDocReport使用FreeMarker引擎解析该文件。
3.  FreeMarker引擎执行恶意表达式，导致RCE。
4.  攻击者可以利用RCE执行任意命令，例如窃取数据、篡改文件或完全控制系统。

**项目地址:** [AT190510-Cuong/CVE-2025-64087-SSTI-](https://github.com/AT190510-Cuong/CVE-2025-64087-SSTI-)

**漏洞详情:** [CVE-2025-64087](https://nvd.nist.gov/vuln/detail/CVE-2025-64087)