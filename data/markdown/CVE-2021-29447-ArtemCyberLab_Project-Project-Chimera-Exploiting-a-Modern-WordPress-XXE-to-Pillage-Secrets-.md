## CVE-2021-29447 WordPress XXE

**漏洞编号:** CVE-2021-29447

**漏洞类型:** XML 外部实体注入 (XXE)

**影响应用:** WordPress

**危害等级:** 高危，可能导致敏感信息泄露，包括数据库凭据，并最终导致远程代码执行

**影响版本:** >= 5.6.0, < 5.7.1，需要PHP 8

**利用条件:** 需要具备上传文件的权限 (如 Author 角色)，服务器运行PHP 8，存在可利用的端口（如80,443,22,3306）

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

提供的漏洞利用代码展示了完整的攻击链，从信息收集到获取反向shell。漏洞CVE-2021-29447是WordPress媒体库中的XXE漏洞，该漏洞允许攻击者通过上传特制的恶意WAV文件读取服务器上的敏感文件，比如wp-config.php。漏洞利用过程如下：

1. **侦察和枚举：** 使用Nmap扫描目标主机，发现开放端口和服务版本。使用WPScan枚举用户名，并通过暴力破解获取有效凭据。
2. **XXE 漏洞利用：**  构造包含恶意XML内容的WAV文件，利用XML外部实体注入读取wp-config.php文件。需要搭建一个HTTP服务器来接收和处理泄露的数据。使用php脚本解码base64编码的数据，提取数据库凭据。
3. **数据库访问：** 使用获得的数据库凭据连接到MySQL数据库，提取用户表中的用户名和密码哈希。
4. **密码破解：** 使用John the Ripper破解用户密码哈希，获取明文密码。
5. **权限提升和远程代码执行：** 修改Hello Dolly插件，插入PHP反向shell代码。通过访问修改后的插件页面，触发反向shell连接到攻击者控制的机器。
6. **后渗透：**  在获取shell后，执行提权操作，查找敏感文件。

**关于投毒风险的分析:**

POC代码中包含完整的攻击链，本身并没有明显的投毒代码，但如果使用者不熟悉整个流程，直接复制粘贴执行，可能会留下后门，例如植入的PHP反向shell。此外，攻击者可能将接收泄露数据的 HTTP server  替换成一个恶意站点，窃取攻击者的信息。因此，判定存在一定概率的投毒风险，估计为10%。主要风险点在于使用者对代码理解程度不够，可能直接使用未经验证的代码。


**项目地址:** [ArtemCyberLab/Project-Project-Chimera-Exploiting-a-Modern-WordPress-XXE-to-Pillage-Secrets-](https://github.com/ArtemCyberLab/Project-Project-Chimera-Exploiting-a-Modern-WordPress-XXE-to-Pillage-Secrets-)

**漏洞详情:** [CVE-2021-29447](https://nvd.nist.gov/vuln/detail/CVE-2021-29447)