## CVE-2018-9995 - TBK DVR Authentication Bypass

**漏洞编号:** CVE-2018-9995

**漏洞类型:** 身份验证绕过

**影响应用:** TBK DVR4104, DVR4216 及多个重新贴牌版本 (Novo, CeNova, QSee, Pulnix, XVR 5 in 1, Securus, Night OWL, DVR Login, HVR Login, MDVR Login)

**危害等级:** 高危，可能导致未经授权的访问、数据泄露以及远程控制

**影响版本:** 受影响设备使用TBK DVR4104和DVR4216系列固件

**利用条件:** 需要网络访问目标DVR设备

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2018-9995 允许远程攻击者通过设置 'Cookie: uid=admin' HTTP头部来绕过身份验证。攻击者可以发送包含此Cookie头的请求到目标DVR设备的 'device.rsp?opt=user&cmd=list' 端点，从而获取设备上的所有用户凭据，这些凭据以JSON格式返回。

**有效性分析：**
根据漏洞描述和提供的漏洞利用代码，该漏洞利用的有效性很高。POC代码是一个C# .NET控制台应用程序，它通过发送包含特定Cookie头的HTTP请求来利用此漏洞。`ClientUrl.cs`文件中的`DVRReq`函数负责构建和发送包含“Cookie: uid=admin”头的请求，并解析返回的JSON数据。

**投毒风险分析：**
分析了提供的POC代码，投毒风险较低，大约10%。主要风险可能在于构建Visual Studio解决方案本身，以及使用第三方库(Newtonsoft.Json)。以下是一些潜在的投毒点：

*   **构建过程：** Visual Studio项目文件 (`DVRFaultNET.csproj`) 引用了 ILMerge，这是一个用于将多个.NET程序集合并为一个可执行文件的工具。虽然ILMerge本身是合法的，但攻击者可能会修改构建过程以包含恶意代码。
*   **第三方库：**  POC使用了Newtonsoft.Json进行JSON序列化和反序列化。虽然Newtonsoft.Json是广泛使用的库，但存在被利用的风险（例如，通过使用已知漏洞的版本）。
*   **潜在后门：** 代码本身看起来是直观地实现了CVE-2018-9995 的利用。但是，由于使用了StreamReader 类读取response数据，如果服务器返回大量数据，可能会导致内存溢出或者其他异常。攻击者可能利用这一点进行拒绝服务攻击. 如果攻击者可以修改编译后的程序，可以植入后门。

**利用方式：**
1.  确定目标DVR设备的IP地址或域名。
2.  运行编译后的DVRFaultNET.exe程序。
3.  程序提示输入DVR设备的URL地址，输入目标地址。
4.  程序发送包含 'Cookie: uid=admin' 头部的HTTP请求到 'device.rsp?opt=user&cmd=list' 端点。
5.  程序解析返回的JSON数据，提取用户凭据。

**项目地址:** [ST0PL/DVRFaultNET](https://github.com/ST0PL/DVRFaultNET)

**漏洞详情:** [CVE-2018-9995](https://nvd.nist.gov/vuln/detail/CVE-2018-9995)