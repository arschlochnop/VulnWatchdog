## CVE-2020-11651-SaltStack-认证绕过

**漏洞编号:** CVE-2020-11651

**漏洞类型:** 认证绕过

**影响应用:** SaltStack

**危害等级:** 高危，可远程代码执行

**影响版本:** < 2019.2.4 和 < 3000.2

**利用条件:** 需要网络可达Salt Master

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2020-11651 存在于SaltStack Salt 2019.2.4之前和3000.2之前的版本中。Salt-master进程的ClearFuncs类没有正确验证方法调用，允许未经身份验证的远程用户访问某些方法。这些方法可以用于从salt master检索用户令牌和/或在salt minions上运行任意命令。

**有效性分析：**

根据漏洞库信息和搜索结果，此漏洞是真实存在的，并且有公开的POC。搜索结果中`jasperla/CVE-2020-11651-poc`是一个公开的POC，用于验证修复。

**投毒风险分析：**

提供的代码是一个InSpec profile，用于检查SaltStack是否已修补CVE-2020-11651和CVE-2020-11652。它通过检查salt-api，salt-cloud，salt-master等软件包的版本来判断是否存在漏洞。该代码**本身不包含任何恶意代码**，它的目的是检测漏洞是否存在，而非利用漏洞。但是, 任何代码都存在风险，如果profile本身存在缺陷，可能会产生误报，从而误导用户认为系统是安全的。考虑到InSpec profile的性质，判定投毒的可能性为5%。

**利用方式：**

利用此漏洞，攻击者可以绕过身份验证，通过未经授权的ClearFuncs方法，从Salt Master检索用户令牌，或者直接在Salt Minion上执行任意命令，从而完全控制受影响的系统。 根据搜索结果的描述，Coinminers已经开始利用该漏洞，说明该漏洞危害较高。由于存在未授权访问，攻击者可以发送构造的请求，调用`ClearFuncs`中的函数，执行恶意操作。具体步骤如下：

1.  确定存在漏洞的Salt Master版本。
2.  构造特定的RPC调用，绕过认证。
3.  利用绕过的认证，调用敏感函数，获取token或直接执行命令。
4.  利用获取的权限控制Minion或者Master。

**项目地址:** [chef-cft/salt-vulnerabilities](https://github.com/chef-cft/salt-vulnerabilities)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)