## CVE-2017-8917-Joomla-SQL注入

**漏洞编号:** CVE-2017-8917

**漏洞类型:** SQL注入

**影响应用:** Joomla

**危害等级:** 高危，可能导致数据泄露和远程代码执行

**影响版本:** 3.7.x before 3.7.1

**利用条件:** 需要能够访问存在漏洞的Joomla网站

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2017-8917是Joomla 3.7.0版本中存在的一个SQL注入漏洞。根据漏洞库信息和搜索引擎结果，攻击者可以通过构造恶意的SQL语句，利用`com_fields`组件的`list[fullordering]`参数，执行任意SQL命令。提供的POC代码 `joomblah.py` 旨在利用此漏洞，通过`UpdateXML`函数和注入的SQL查询，提取数据库中的敏感信息，例如用户名、密码哈希和会话信息。该脚本首先尝试获取CSRF token，然后利用SQL注入提取数据库表名，并从中提取用户和会话信息。漏洞利用有效性较高，因为多个来源都确认了该漏洞的存在和利用方法。

关于投毒风险，快速浏览了POC代码后发现，虽然代码主要功能是利用SQL注入漏洞，但仍存在一定的风险。具体分析：
*   **依赖风险** 该脚本依赖于Python的`requests`、`re`、`argparse`、`os`、`random`、`time`和`binascii`模块。虽然这些模块通常是安全的，但如果攻击者控制了用户的环境，可能会通过修改这些模块来执行恶意代码。
*   **字符编码问题** 代码中包含字符编码转换，`value.decode('utf-8')`，这在处理特定字符集时可能引入漏洞，虽然原作者修复了此问题。
*   **不明确的异常处理** 代码中缺少适当的异常处理，可能导致脚本在遇到意外情况时崩溃或执行错误的操作。例如，如果无法连接到目标网站，脚本可能会引发未处理的异常。
*   **潜在的后门风险**  攻击者可能修改脚本，使其在成功利用漏洞后执行额外的恶意操作，例如上传后门文件或修改服务器配置，在第82行中，如果攻击者修改了返回的内容进行恶意代码的植入。

因此，虽然主要功能是漏洞利用，但仍然存在一定的投毒风险，尤其是考虑到攻击者可能修改脚本以执行其他恶意活动。总体评估投毒概率在10%左右。

利用方式总结：
1.  目标：Joomla 3.7.0网站。
2.  入口点：`com_fields`组件的`list[fullordering]`参数。
3.  攻击方式：构造恶意的SQL语句，利用`UpdateXML`函数执行SQL注入。
4.  目的：提取数据库中的敏感信息，例如用户名、密码哈希和会话信息。

**项目地址:** [gloliveira1701/Joomblah](https://github.com/gloliveira1701/Joomblah)

**漏洞详情:** [CVE-2017-8917](https://nvd.nist.gov/vuln/detail/CVE-2017-8917)