## CVE-2016-5195 - Dirty COW

**漏洞编号:** CVE-2016-5195

**漏洞类型:** 权限提升

**影响应用:** Linux Kernel

**危害等级:** 高危，允许本地用户获取 root 权限

**影响版本:** 2.x ~ 4.x (before 4.8.3)

**利用条件:** 需要本地用户权限，目标系统内核版本在受影响范围内

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2016-5195（Dirty COW）是一个Linux内核中的竞态条件漏洞，存在于`mm/gup.c`中。该漏洞允许本地用户利用写时复制 (COW) 功能的不正确处理，写入只读内存映射，从而获得提权。

**有效性：**

提供的POC代码是有效的，它通过以下步骤利用该漏洞：

1.  **内存映射：**  使用`mmap`函数将目标文件以只读和私有 (copy-on-write) 方式映射到内存中。
2.  **竞态条件：**  创建两个线程：
    *   `madviseThread`：循环调用`madvise`函数，使用`MADV_DONTNEED`标志，尝试释放内存页，触发写时复制。
    *   `procselfmemThread`：循环打开`/proc/self/mem`，查找内存映射位置，并写入新的内容。
3.  **提权：**  通过竞争`madvise`和写入`/proc/self/mem`操作，攻击者可以在只读内存映射中写入数据，从而修改原始文件，实现权限提升。

**投毒风险：**

该仓库存在一定的投毒风险，约 10%。风险主要体现在以下几个方面：

*   **README.md说明的模糊性:**  README.md文件中存在一些引导用户操作的步骤，要求用户创建具有只读权限的文件，之后运行c文件.该行为具有一定的诱导性.不过好在目标文件由用户自己指定,可以降低被投毒的风险。
*   **利用条件:**  需要root权限才能创建具有root权限的只读文件，编译该文件也需要gcc等编译环境，这些都会增加被投毒的概率。

总的来说，投毒风险较低，但仍需谨慎。

**利用方式：**

1.  **查找目标文件：** 确定一个具有只读权限的目标文件。
2.  **运行PoC：** 编译并运行提供的 `dirty.c` 文件，并传入目标文件名和要写入的新内容作为参数。
3.  **成功提权：**如果漏洞利用成功，目标文件的内容将被修改为新内容。从而可能导致权限提升。

**项目地址:** [KaviDk/dirtyCow](https://github.com/KaviDk/dirtyCow)

**漏洞详情:** [CVE-2016-5195](https://nvd.nist.gov/vuln/detail/CVE-2016-5195)