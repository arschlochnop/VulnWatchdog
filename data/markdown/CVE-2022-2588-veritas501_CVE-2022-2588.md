## CVE-2022-2588

**漏洞编号:** CVE-2022-2588

**漏洞类型:** Use-After-Free

**影响应用:** Linux Kernel

**危害等级:** 中危，可能导致权限提升或拒绝服务

**影响版本:** < 6.0~rc1

**利用条件:** 需要本地用户权限和User Namespaces支持

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-2588 是 Linux 内核 cls_route 过滤器实现中的一个 Use-After-Free 漏洞。如果过滤器的句柄值为 0，则在释放之前不会从哈希表中删除旧过滤器。 

**利用方式：**

1.  **漏洞触发：** 该漏洞是由 `cls_route` 过滤器在特定情况下（句柄为0）释放后没有从哈希表中移除导致的。
2.  **利用条件：** 漏洞利用需要本地用户权限，并且需要启用User Namespaces。
3.  **利用过程：**
    *   分配一个存在漏洞的对象。
    *   释放该对象，但由于漏洞，该对象并未从哈希表中移除。
    *   双重释放该对象，导致Use-After-Free。
    *   通过文件系统操作（文件喷射）在释放的内存位置分配新的对象，实现内存重用。
    *   利用文件描述符的重叠，通过慢速写入覆盖/etc/passwd 文件，实现提权。
4.  **POC 代码分析：**
    *   `exp.c` 包含利用该漏洞的完整exp代码。该代码首先会通过内存碎片整理来确保内存布局。然后分配并释放存在漏洞的对象，触发UAF，接着通过文件喷射占据释放的内存。
    *   `Makefile` 用于编译exp.c成可执行文件。还包括启动QEMU的命令。
    *   `boot.sh` 是用于启动 QEMU 虚拟机的脚本，配置了内核、initrd、内存等参数。
5.  **投毒风险分析：**
    *   代码中使用了`attack_data`覆盖`/etc/passwd`，修改后可能会影响系统功能，但并没有发现明显的恶意代码或后门函数。
    *  POC 利用的原理和过程相对清晰，主要集中在漏洞利用本身。
    *   `#define ATTACK_FILE "/etc/passwd"`表明目标是`/etc/passwd`, 具有一定的破坏性, 更改`/etc/passwd`可能导致系统出现问题, 将比例上调到10%.

**有效性：** 根据POC代码和搜索结果，该漏洞利用代码相对有效，可以在特定条件下实现本地权限提升。

综上，该漏洞利用方式相对清晰，但仍存在一定的风险，需要谨慎使用。

**项目地址:** [veritas501/CVE-2022-2588](https://github.com/veritas501/CVE-2022-2588)

**漏洞详情:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)