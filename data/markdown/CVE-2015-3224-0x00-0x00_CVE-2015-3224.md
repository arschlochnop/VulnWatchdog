## CVE-2015-3224 Ruby on Rails Web Console IP Whitelist Bypass RCE

**漏洞编号:** CVE-2015-3224

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Ruby on Rails Web Console

**危害等级:** 高危，允许未授权用户执行任意命令

**影响版本:** Web Console < 2.1.3, Rails 3.x/4.x

**利用条件:** 目标系统运行着存在漏洞的Ruby on Rails应用，并且Web Console已启用。需要能够发送HTTP请求到目标服务器。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2015-3224是Ruby on Rails Web Console的一个IP白名单绕过漏洞。Web Console在2.1.3之前的版本以及Rails 3.x和4.x中，没有正确限制`X-Forwarded-For`头的使用，导致攻击者可以通过构造包含伪造IP地址的`X-Forwarded-For`头来绕过白名单限制，从而访问Web Console并执行任意代码。 

**有效性：**
提供的Metasploit模块旨在利用此漏洞。它通过发送带有伪造`X-Forwarded-For`头的HTTP请求绕过IP白名单，然后利用Web Console执行任意命令。该模块的修改版允许执行单个命令，而不仅仅是建立反向/绑定shell，增加了利用的灵活性。从搜索引擎结果中也能看出，该漏洞存在可被利用的RCE.

**投毒风险：**
`install.sh`脚本的目的是将修改后的ruby脚本拷贝到metasploit的模块目录下，脚本本身没有明显的恶意行为。但是，在`ruby-on-rails-web-console2-rce.rb`脚本中，虽然作者声明添加了`CMD`变量用于执行任意命令，但这本身就是漏洞利用的一部分，不能算作投毒。Metasploit模块通常包含执行任意命令的功能。投毒风险在于：
1.  **代码质量问题:**  代码可能存在未知的bug，导致目标系统崩溃或不稳定。
2.  **依赖问题:**  模块可能依赖特定的库或环境，如果目标系统缺少这些依赖，可能导致利用失败。
3.  **兼容性问题:**  模块可能不兼容所有版本的Ruby on Rails或Web Console。

总体而言，该仓库的投毒风险较低，主要风险在于利用代码本身可能存在的缺陷和兼容性问题。

**利用方式：**
1.  攻击者首先确定目标系统是否运行着存在漏洞的Ruby on Rails应用，并且Web Console已启用。
2.  攻击者发送一个特制的HTTP请求，其中包含一个`X-Forwarded-For`头，该头包含一个不在白名单中的IP地址。
3.  由于Web Console没有正确验证`X-Forwarded-For`头，攻击者成功绕过IP白名单。
4.  攻击者使用Web Console执行任意命令，从而控制目标系统。

此POC的利用方式是通过修改 Metasploit 模块，使其能够发送带有伪造 `X-Forwarded-For` 头的 HTTP 请求，从而绕过 IP 白名单并执行任意命令。

**项目地址:** [0x00-0x00/CVE-2015-3224](https://github.com/0x00-0x00/CVE-2015-3224)

**漏洞详情:** [CVE-2015-3224](https://nvd.nist.gov/vuln/detail/CVE-2015-3224)