## CVE-2023-4220 Chamilo LMS Unauthenticated Remote Code Execution

**漏洞编号:** CVE-2023-4220

**漏洞类型:** 远程代码执行

**影响应用:** Chamilo LMS

**危害等级:** 高危，允许未经验证的攻击者执行任意代码

**影响版本:** <= 1.11.24

**利用条件:** 目标系统运行Chamilo LMS 1.11.24或更早版本，并且bigUpload功能未被禁用或修复。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2023-4220 存在于Chamilo LMS的bigUpload功能中，允许未经身份验证的攻击者通过上传恶意文件（如webshell）来执行远程代码。漏洞位于`/main/inc/lib/javascript/bigupload/inc/bigUpload.php`。根据提供的漏洞利用代码，攻击者首先上传一个包含恶意PHP代码的文件（通常是webshell），然后通过构造特定的URL来访问该文件，从而执行webshell中的代码。

**有效性：**
从搜索结果和漏洞利用代码来看，该漏洞利用是有效的。漏洞库信息和多个搜索结果都表明该漏洞允许未经身份验证的远程代码执行。漏洞利用代码提供了一个简单的PoC，演示了如何上传PHP webshell并执行任意命令。

**投毒风险：**
提供的漏洞利用代码本身**不包含明显的投毒代码**。该代码的目的是上传webshell和执行命令。它首先创建一个名为`/tmp/rce.php`的临时文件，其中包含PHP代码来执行base64编码的命令。然后，使用`curl`命令上传这个文件到`/main/inc/lib/javascript/bigupload/inc/bigUpload.php`，并使用另一个`curl`命令，通过URL参数`aoOoy`将要执行的命令以base64编码的形式传递给webshell。虽然执行任意命令本身存在安全风险，但是这段代码的主要目的是为了验证漏洞，并没有包含任何用于破坏系统或窃取信息的恶意逻辑。因此，投毒风险评估为0%。

**利用方式：**
1.  **确定目标Chamilo LMS的版本**：可以通过访问`/documentation/changelog.html`来确定版本。
2.  **构造恶意PHP文件（webshell）**：创建一个包含PHP代码的webshell，例如，允许执行任意命令的PHP脚本。
3.  **上传webshell**：使用`curl`命令或其他HTTP客户端，将webshell上传到`/main/inc/lib/javascript/bigupload/inc/bigUpload.php?action=post-unsupported`。
4.  **执行命令**：使用`curl`或其他HTTP客户端，构造一个包含要执行的命令的URL，并访问上传的webshell。命令需要进行base64编码和URL编码。

该漏洞利用无需身份验证，攻击复杂度较高（需要了解目标系统的文件路径和URL结构），但影响是严重的，可能导致完全控制目标系统。

**项目地址:** [charlesgargasson/CVE-2023-4220](https://github.com/charlesgargasson/CVE-2023-4220)

**漏洞详情:** [CVE-2023-4220](https://nvd.nist.gov/vuln/detail/CVE-2023-4220)