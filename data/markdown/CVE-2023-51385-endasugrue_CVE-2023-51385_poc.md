## CVE-2023-51385 OpenSSH 命令注入

**漏洞编号:** CVE-2023-51385

**漏洞类型:** 命令注入

**影响应用:** OpenSSH

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** < 9.6

**利用条件:** 用户名或主机名包含shell元字符，且在特定情况下被扩展令牌引用

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-51385 是 OpenSSH 9.6 之前版本中存在的一个命令注入漏洞。当用户名或主机名包含 shell 元字符，并且该名称在某些情况下被扩展令牌引用时，可能发生操作系统命令注入。例如，不受信任的 Git 仓库可能具有子模块，其用户名或主机名中包含 shell 元字符。 

**有效性：**

根据漏洞库信息和搜索结果，此漏洞的利用涉及到shell元字符的注入。提供的 POC 代码非常简短，仅包含一个 README.md 文件，指示该项目旨在提供漏洞的概念验证。因此，该POC本身并不能直接验证漏洞，需要结合其他方式例如vin01.github.io/piptagole/ssh/security/openssh/libssh/remote-code-execution/2023/12/20/openssh-proxycommand-libssh-rce.html 中的信息来构造完整的利用链.可以确认漏洞可以利用。

**投毒风险：**

当前提供的 POC 代码（README.md）不包含任何可执行代码，因此直接的投毒风险很低。但是，如果攻击者修改或替换了该 POC，添加了恶意代码，则存在投毒风险。因为该漏洞涉及到命令执行，后门代码可能隐藏在被注入的命令中，实现持久化控制。

**利用方式：**

1.  **构造恶意用户名或主机名：** 攻击者需要创建一个包含 shell 元字符的用户名或主机名。
2.  **触发扩展令牌引用：** 在某些 OpenSSH 配置中，例如使用 `ProxyCommand` 指令，会扩展用户名或主机名。如果扩展过程中没有正确转义 shell 元字符，就会导致命令注入。
3.  **执行任意命令：** 攻击者可以通过注入恶意的 shell 命令来执行任意操作系统命令。

例如，攻击者可以在 Git 子模块的 URL 中嵌入恶意代码，当 OpenSSH 克隆该子模块时，会执行该恶意代码。

从搜索引擎的结果来看，该漏洞影响广泛，多个厂商都发布了安全公告，确认了漏洞的存在和危害。

**项目地址:** [endasugrue/CVE-2023-51385_poc](https://github.com/endasugrue/CVE-2023-51385_poc)

**漏洞详情:** [CVE-2023-51385](https://nvd.nist.gov/vuln/detail/CVE-2023-51385)