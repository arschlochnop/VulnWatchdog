## CVE-2019-2215 Android Binder Use-After-Free

**漏洞编号:** CVE-2019-2215

**漏洞类型:** Use-After-Free

**影响应用:** Android Kernel

**危害等级:** 高危，允许本地权限提升至内核权限

**影响版本:** Kernel

**利用条件:** 需要安装恶意本地应用或通过网络应用中的漏洞利用

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-2215 是 Android Binder 组件中的一个 use-after-free 漏洞，存在于 `binder.c` 文件中。该漏洞允许攻击者从应用提权到 Linux 内核级别。利用该漏洞不需要用户交互，但需要预先安装恶意应用程序或配合其他网络应用漏洞。根据提供的 POC 代码分析，漏洞利用过程大致如下：

1.  **漏洞触发**:首先通过打开`/dev/binder`设备并使用`epoll_ctl`添加文件描述符到epoll实例来准备binder驱动环境。子进程睡眠1秒后，在父进程中首先使用`ioctl(fd_binder, BINDER_THREAD_EXIT, NULL)`释放binder线程对象。然后，在父进程中调用 `writev`，结合精心构造的`iovec`数组，在释放的内存位置写入数据。
2.  **UAF利用**: 之后在子进程中调用 `epoll_ctl(epfd, EPOLL_CTL_DEL, fd_binder, &event)` 再次使用已经释放的binder线程对象，触发use-after-free。 
3.  **信息泄露**:  通过 pipe 将数据读回，从而泄露内核内存信息。特别是利用精心构造的`iovec`结构覆盖`binder_thread`的`task_list.next`指针，使其指向`task_struct`，从而泄漏`task_struct`地址。
4.  **权限提升**: 代码中使用`smash_address`函数，该函数尝试覆盖内核内存中的地址值，结合泄露的`task_struct`地址，可以修改当前进程的`cred`结构，从而提升权限。

**有效性评估：**
根据漏洞信息和提供的 POC 代码，该漏洞利用具有较高的有效性。漏洞的利用流程清晰，利用了 Android Binder 机制的 use-after-free 漏洞。

**投毒风险分析：**
该 POC 代码本身旨在利用漏洞提升权限，实现 root 访问。可能的投毒点在于：
*   **恶意代码注入：** 代码可能包含在提权后执行恶意操作的代码，例如植入后门、窃取数据等。
*   **条件触发：** 漏洞利用可能依赖特定的系统配置或内核版本，导致在某些设备上崩溃或行为异常。
*   **稳定性问题：** 漏洞利用本身可能不稳定，可能导致设备崩溃或重启。
目前来看，提供的代码较为基础，主要用于演示漏洞利用，但仍然存在作者植入恶意代码的可能性。投毒风险评估为10%，主要集中在提权后执行的恶意行为和稳定性问题上。

**项目地址:** [DimitriFourny/cve-2019-2215](https://github.com/DimitriFourny/cve-2019-2215)

**漏洞详情:** [CVE-2019-2215](https://nvd.nist.gov/vuln/detail/CVE-2019-2215)