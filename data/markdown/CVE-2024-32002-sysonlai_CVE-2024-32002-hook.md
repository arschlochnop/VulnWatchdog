## CVE-2024-32002 Git RCE

**漏洞编号:** CVE-2024-32002

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Git

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 受影响版本：2.39.4之前, 2.40.0 < 2.40.2, 2.41.0, 2.42.0 < 2.42.2, 2.43.0 < 2.43.4, 2.44.0, 2.45.0

**利用条件:** 目标系统需要使用受影响的Git版本，且攻击者能够诱导用户克隆包含恶意submodule的仓库。文件系统需要大小写不敏感，且支持符号链接或开启`core.symlinks`配置。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-32002是Git中的一个远程代码执行漏洞，该漏洞允许攻击者通过精心构造包含恶意submodule的Git仓库，在受害者克隆该仓库时执行任意代码。

**漏洞利用方式：**

1.  攻击者创建一个包含恶意submodule的Git仓库。
2.  该恶意submodule包含一个`.gitmodules`文件，其中定义了submodule的路径和一个指向攻击者控制的仓库的URL。
3.  攻击者在submodule的仓库中创建一个恶意的`.git/hooks/post-checkout`脚本，该脚本包含要执行的恶意代码（例如`calc.exe`）。
4.  受害者克隆该恶意仓库，Git会递归地克隆submodule。
5.  由于Git在处理submodule时存在漏洞，攻击者可以利用大小写不敏感的文件系统和符号链接，将恶意hook脚本写入到`.git/`目录中，而不是submodule的工作目录。
6.  在克隆submodule完成后，`.git/hooks/post-checkout`脚本会自动执行，导致远程代码执行。

**有效性：**
提供的POC代码看起来有效。`README.md` 只是仓库的说明文档，`hooks/post-checkout` 脚本包含 `calc.exe`，这意味着在受害者克隆包含此 submodule 的仓库后，`calc.exe` 会被执行，验证了RCE漏洞的存在。根据搜索引擎结果，该漏洞确实可以被利用进行远程代码执行（例如，[webpage 4 begin] 和 [webpage 6 begin]）。

**投毒风险：**
POC 代码中的`calc.exe` 显然是用于验证漏洞的，并非恶意代码。但是，如果攻击者用更隐蔽和恶意的代码替换 `calc.exe`，那么这就构成了投毒。由于提供的代码非常简单，只包含一个 hook 脚本，隐藏恶意代码的空间相对较小，主要风险在于hook脚本本身可能包含更复杂的恶意行为。假设攻击者有10%的可能性在其他地方（例如隐藏的脚本或配置文件中）添加恶意代码。

**漏洞缓解措施：**
*   升级 Git 到最新版本。
*   禁用 symbolic link 支持 (`git config --global core.symlinks false`)。
*   避免克隆来自不可信来源的仓库。

**项目地址:** [sysonlai/CVE-2024-32002-hook](https://github.com/sysonlai/CVE-2024-32002-hook)

**漏洞详情:** [CVE-2024-32002](https://nvd.nist.gov/vuln/detail/CVE-2024-32002)