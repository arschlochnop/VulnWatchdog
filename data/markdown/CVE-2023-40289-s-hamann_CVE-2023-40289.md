## CVE-2023-40289 - Supermicro BMC IPMI 命令注入

**漏洞编号:** CVE-2023-40289

**漏洞类型:** 命令注入

**影响应用:** Supermicro BMC IPMI

**危害等级:** 高危，允许拥有BMC管理权限的攻击者提升权限

**影响版本:** X11SSM-F, X11SAE-F, 和 X11SSE-F 1.66

**利用条件:** 需要拥有目标BMC的管理员权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

根据漏洞库信息、搜索引擎结果和提供的漏洞利用代码，漏洞利用的有效性较高。

**有效性评估：**

*   漏洞库信息明确指出 CVE-2023-40289 是 Supermicro X11SSM-F, X11SAE-F, 和 X11SSE-F 1.66 设备上的命令注入问题，攻击者可以利用它来提升权限。
*   搜索引擎结果证实了该漏洞的存在，并提供了指向 Supermicro 官方安全公告以及 Binarly 的相关分析报告的链接。
*   提供的漏洞利用代码 (CVE_2023_40289.py) 基于 Binarly 的分析，实现了利用该漏洞的代码。该代码包括存储payload、触发payload执行等功能。

**投毒风险评估：**

*   **Payload存储与触发：** 代码的核心在于将恶意命令存储到BMC配置中，并通过`send_test_alert`触发执行。这本身就是漏洞利用方式，但如果攻击者恶意修改payload的内容，例如在反弹shell的命令中添加下载并执行恶意文件的指令，就存在投毒的可能。
*   **HTTP Server：** 代码中包含一个简易的HTTP Server，用于接收目标设备上传的文件。如果攻击者修改该Server的行为，例如在接收文件后执行某些恶意操作，也会造成投毒。
*  **curl参数：** curl的参数如果被篡改，可能导致信息泄露或者被重定向到恶意服务器。
综合来看，虽然代码主要是为了利用漏洞，但存在潜在的投毒风险，需要人工审核和谨慎使用。考虑到代码的复杂度和潜在的攻击面，将投毒风险评估为10%。

**利用方式分析：**

1.  **身份验证：** 首先，攻击者需要通过某种方式获得目标 BMC 的管理员权限。
2.  **Payload 存储：** 攻击者使用 `store_payload` 函数，将恶意命令注入到 BMC 的配置中。该函数将命令存储在告警配置的某个字段中。  由于BMC的告警邮件功能设计缺陷，mail字段的参数过滤不严格，允许命令注入。
3.  **Payload 触发：** 攻击者使用 `trigger_exploit` 函数，触发之前存储的恶意命令。该函数会发送一个测试告警，从而执行注入的命令。
4.  **命令执行：** 通过命令注入执行任意命令，例如反弹 shell、下载恶意文件等，从而完全控制目标 BMC。

代码中还包含一个 `get_file` 函数，可以从目标 BMC 上获取任意文件，这进一步扩大了攻击面。


**项目地址:** [s-hamann/CVE-2023-40289](https://github.com/s-hamann/CVE-2023-40289)

**漏洞详情:** [CVE-2023-40289](https://nvd.nist.gov/vuln/detail/CVE-2023-40289)