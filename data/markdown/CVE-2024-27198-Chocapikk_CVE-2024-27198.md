## CVE-2024-27198-JetBrains TeamCity Authentication Bypass

**漏洞编号:** CVE-2024-27198

**漏洞类型:** 身份验证绕过

**影响应用:** JetBrains TeamCity

**危害等级:** 高危，允许未授权用户执行管理员操作

**影响版本:** < 2023.11.4

**利用条件:** 需要网络访问 TeamCity 服务

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-27198是JetBrains TeamCity 2023.11.4之前的版本中的一个身份验证绕过漏洞，允许未经身份验证的攻击者执行管理员操作。根据漏洞库信息，该漏洞CVSS评分为9.8 (Critical)，已经被CISA添加到已知被利用漏洞目录(KEV)。

**有效性：**
根据CISA信息,该漏洞已经被积极利用,给出的漏洞利用代码尝试通过`hax?jsp=/app/rest/users;.jsp`路径添加具有系统管理员角色的用户，从而获得管理员权限。这种利用方式与漏洞描述相符，且通过DarkReading等安全媒体的报道佐证，该漏洞确实被大规模利用。因此，提供的POC代码的思路是有效的，但实际的成功率取决于TeamCity服务器的配置和版本。

**投毒风险：**
POC代码主要功能是添加用户和执行命令，代码本身存在一定的投毒风险。但总体风险较低，只有10%。投毒风险主要来自于以下几个方面：

*   **后门账号：**  如果攻击者修改脚本，可以将新添加的管理员账号信息硬编码到脚本中，方便后续的持续访问。
*   **恶意命令：**  `execute_command`函数可以被修改为执行更具破坏性的命令，例如删除数据、篡改配置等。
*   **依赖引入：**  攻击者可能通过引入恶意的第三方库来执行恶意代码，但风险较低，因为代码依赖项较少。
*   **批量处理风险：** 虽然批量处理仅评估漏洞是否存在，但如果被修改为尝试利用，会对大量服务器造成影响。

由于脚本相对简单，并且主要依赖于已知的TeamCity API，因此隐藏恶意代码的难度较高，容易被发现。

**利用方式：**

1.  **目标识别：**  通过网络扫描或信息收集，确定运行TeamCity且版本低于2023.11.4的目标。
2.  **身份验证绕过：**  利用漏洞，绕过TeamCity的身份验证机制。
3.  **添加管理员用户：**  通过构造恶意的REST API请求，向TeamCity服务器添加具有系统管理员权限的新用户。
4.  **远程代码执行：**  成功添加管理员用户后，使用新账号登录TeamCity，利用TeamCity提供的功能，执行任意代码，实现远程控制服务器的目的。
5.  **命令执行：** 通过交互式shell执行命令。

利用脚本提供了批量处理功能，可以自动化扫描和识别潜在的漏洞服务器。脚本还提供了添加用户的功能，通过添加用户尝试获取管理权限并进一步进行RCE。

总而言之，CVE-2024-27198漏洞的利用方式较为直接，通过添加管理员用户即可获得服务器控制权，风险极高。

**项目地址:** [Chocapikk/CVE-2024-27198](https://github.com/Chocapikk/CVE-2024-27198)

**漏洞详情:** [CVE-2024-27198](https://nvd.nist.gov/vuln/detail/CVE-2024-27198)