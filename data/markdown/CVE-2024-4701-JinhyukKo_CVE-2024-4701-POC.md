## CVE-2024-4701-Netflix Genie-路径遍历导致远程代码执行

**漏洞编号:** CVE-2024-4701

**漏洞类型:** 路径遍历

**影响应用:** Netflix Genie

**危害等级:** 高危，可导致远程代码执行

**影响版本:** < 4.3.18

**利用条件:** 需要低权限用户和网络访问

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-4701 是 Netflix Genie 中存在的一个路径遍历漏洞，所有版本低于 4.3.18 的 Genie 都受影响。该漏洞允许经过身份验证的低权限用户通过文件上传功能，利用路径遍历将恶意文件写入到服务器的任意位置，从而可能导致远程代码执行。

**漏洞利用方式：**

1.  攻击者利用 Genie 的文件上传功能，上传恶意文件。
2.  在上传的文件名中构造包含 `..` 的路径，实现路径遍历。
3.  通过路径遍历，将恶意文件写入到目标系统的任意位置，例如可以覆盖`/etc/ld.so.preload`文件，加载恶意so文件。
4.  由于能写入任意文件，进一步可以导致RCE。

**POC有效性：**

提供的 POC 代码尝试利用此漏洞。它使用`requests`库向 Genie 的 `/api/v3/jobs` 端点发送一个 multipart/form-data 请求，其中包含：

*   一个 JSON 格式的 `request` 字段，包含作业的配置信息。
*   两个 `attachment` 字段，分别指向 `/tmp/pe.so` 和 `/etc/ld.so.preload`，通过路径遍历尝试覆盖这两个文件。`/tmp/pe.so` 可以是恶意的共享对象文件。`etc/ld.so.preload`允许在程序启动前加载共享库，通过劫持程序启动加载恶意共享库，可实现RCE。

如果 Genie 实例存在此漏洞，并且攻击者具有上传文件的权限，那么此 POC 应该可以成功利用该漏洞。docker-compose文件用于搭建存在漏洞的环境。

**投毒风险：**

分析提供的代码后，没有发现明显的投毒代码。该漏洞利用代码专注于利用路径遍历漏洞实现恶意文件写入。代码中的`/tmp/pe.so` 需要攻击者自行准备, `/etc/ld.so.preload` 是目标系统的配置，代码本身并没有植入恶意代码。因此，投毒风险评估为 0%。

**项目地址:** [JinhyukKo/CVE-2024-4701-POC](https://github.com/JinhyukKo/CVE-2024-4701-POC)

**漏洞详情:** [CVE-2024-4701](https://nvd.nist.gov/vuln/detail/CVE-2024-4701)