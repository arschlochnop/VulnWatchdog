## CVE-2018-6574-Go-远程命令执行

**漏洞编号:** CVE-2018-6574

**漏洞类型:** 远程命令执行

**影响应用:** Go

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** < 1.8.7, 1.9.x < 1.9.4, 1.10 pre-releases < 1.10rc2

**利用条件:** 用户使用受影响的Go版本执行 `go get` 命令，并下载包含恶意代码的包。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2018-6574 允许攻击者通过 `go get` 命令执行远程代码。漏洞原因是 Go 在构建过程中没有正确过滤 gcc 或 clang 的插件参数（`-fplugin=` 和 `-plugin=`）。

**有效性：**

提供的 POC 代码 `main.go` 展示了如何利用该漏洞。代码通过 `#cgo CFLAGS: -fplugin=./attack.so` 指令引入一个恶意的 gcc 插件 `attack.so`。当 `go get` 或 `go build` 执行此代码时，gcc/clang 会尝试加载并执行 `attack.so`，从而实现远程命令执行。

**投毒风险：**

由于 POC 代码中引用了外部的 `attack.so` 文件，因此存在投毒风险。虽然代码本身只是声明和调用了一个简单的函数，但是实际的恶意代码存在于 `attack.so` 中。攻击者可以将恶意代码注入到 `attack.so` 中，从而在用户构建项目时执行任意命令。如果用户下载并使用了包含此 `main.go` 和恶意的 `attack.so` 的代码仓库，那么就会受到攻击。投毒风险评估为10%，主要因为代码本身依赖外部文件，增加了复杂性，也更容易被发现。

**利用方式：**

1.  攻击者创建一个包含恶意 `main.go` 和 `attack.so` 的 Go 项目。
2.  `main.go` 包含 `#cgo CFLAGS: -fplugin=./attack.so` 指令。
3.  `attack.so` 包含攻击者想要执行的恶意代码。
4.  攻击者将该项目托管在公共代码仓库（例如 GitHub）上。
5.  攻击者诱骗受害者使用受影响的 Go 版本执行 `go get <攻击者仓库地址>` 命令。
6.  `go get` 命令下载并构建项目，触发 gcc/clang 加载 `attack.so`。
7.  `attack.so` 中的恶意代码被执行，攻击成功。

搜索引擎结果中的 "pentesterlab.com/exercises/cve-2018-6574" 链接提供了一个练习环境，可以用来复现和理解该漏洞。

**总结：**

CVE-2018-6574 是一个严重的安全漏洞，允许攻击者利用 `go get` 命令执行任意代码。为了避免受到攻击，请确保使用最新版本的 Go，并避免下载和构建来自不可信来源的 Go 项目。

**项目地址:** [jftierno/CVE-2018-6574-2](https://github.com/jftierno/CVE-2018-6574-2)

**漏洞详情:** [CVE-2018-6574](https://nvd.nist.gov/vuln/detail/CVE-2018-6574)