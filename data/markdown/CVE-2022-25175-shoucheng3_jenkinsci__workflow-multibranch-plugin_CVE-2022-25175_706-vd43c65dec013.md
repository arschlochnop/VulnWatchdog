## CVE-2022-25175 - Jenkins Pipeline Multibranch Plugin 任意命令执行

**漏洞编号:** CVE-2022-25175

**漏洞类型:** 任意命令执行

**影响应用:** Jenkins Pipeline: Multibranch Plugin

**危害等级:** 高危，允许攻击者在Jenkins控制器上执行任意操作系统命令

**影响版本:** <= 706.vd43c65dec013

**利用条件:** 需要Item/Configure权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-25175 漏洞存在于 Jenkins Pipeline Multibranch Plugin 中，受影响的版本为 706.vd43c65dec013 及更早版本。漏洞原因是该插件为不同的 SCM 在 `readTrusted` 步骤中使用了相同的 checkout 目录。攻击者如果具有 Item/Configure 权限，可以通过精心构造的 SCM 内容，在 Jenkins 控制器上执行任意操作系统命令。

**有效性：**
根据漏洞描述和搜索结果，该漏洞的利用是有效的。多个来源都确认了此漏洞可以导致任意命令执行。

**投毒风险：**
提供的“漏洞利用代码”实际上是 `CHANGELOG.md` 文件，并非实际的漏洞利用代码。因此，无法直接从这段代码判断是否存在投毒。然而，一般情况下，投毒风险主要存在于漏洞利用脚本中，攻击者可能会在其中嵌入恶意代码。考虑到`CHANGELOG.md`是描述版本更新日志，通常不会包含恶意代码。但是，`CHANGELOG.md`中提到的github releases的下载链接，以及相关依赖包有可能存在投毒风险。
综合评估，投毒风险较低，估计为10%。

**利用方式：**
1.  攻击者需要具备 Jenkins 的 Item/Configure 权限。
2.  攻击者创建一个包含恶意内容的 SCM 仓库，例如 Git 仓库。
3.  攻击者配置一个 Multibranch Pipeline 项目，指向该恶意 SCM 仓库。
4.  当 Jenkins 执行该 Pipeline 时，由于 `readTrusted` 步骤使用了相同的 checkout 目录，恶意 SCM 内容将被检出到控制器上。
5.  攻击者可以在 SCM 内容中包含恶意代码，例如 Groovy 脚本，通过 `readTrusted` 步骤执行，从而在 Jenkins 控制器上执行任意操作系统命令。

**缓解措施：**
1.  升级 Jenkins Pipeline Multibranch Plugin 到不受影响的版本（>= 2.26.1, >= 2.23.1, >= 696.698.v9b4218eea50f）。
2.  限制用户的 Item/Configure 权限，降低攻击面。
3.  审查 Jenkinsfile 和 SCM 内容，防止恶意代码注入。

**项目地址:** [shoucheng3/jenkinsci__workflow-multibranch-plugin_CVE-2022-25175_706-vd43c65dec013](https://github.com/shoucheng3/jenkinsci__workflow-multibranch-plugin_CVE-2022-25175_706-vd43c65dec013)

**漏洞详情:** [CVE-2022-25175](https://nvd.nist.gov/vuln/detail/CVE-2022-25175)