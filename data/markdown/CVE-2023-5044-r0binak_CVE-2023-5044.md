## CVE-2023-5044 - Kubernetes Ingress Nginx Code Injection

**漏洞编号:** CVE-2023-5044

**漏洞类型:** 代码注入

**影响应用:** Kubernetes Ingress Nginx

**危害等级:** 高危，可能导致集群接管和敏感信息泄露

**影响版本:** < 1.9.0

**利用条件:** 需要拥有创建 Ingress 资源的权限

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2023-5044 漏洞允许攻击者通过 `nginx.ingress.kubernetes.io/permanent-redirect` 注解进行代码注入。当 Ingress Nginx 控制器处理包含恶意注解的 Ingress 资源时，会将注解中的代码注入到生成的 Nginx 配置中，导致任意代码执行。

**漏洞利用方式：**

1.  攻击者创建一个包含恶意 `nginx.ingress.kubernetes.io/permanent-redirect` 注解的 Ingress 资源。
2.  注解中包含的 Lua 代码会被注入到 Nginx 配置文件中。
3.  当用户访问与 Ingress 规则匹配的 URL 时，注入的 Lua 代码将被执行。

提供的 POC 代码演示了如何利用此漏洞读取 Kubernetes service account token (`/var/run/secrets/kubernetes.io/serviceaccount/token`) 以及执行任意命令 (touch /you)。

**有效性：**

根据漏洞库信息和搜索结果，该 POC 代码有效。多个来源都确认了 CVE-2023-5044 允许代码注入，并且提供的 POC 代码与漏洞描述一致，可成功利用该漏洞。

**投毒风险：**

分析提供的 POC 代码，没有发现作者隐藏的投毒代码。POC 代码只是演示了如何利用漏洞读取敏感信息和执行命令，并没有包含任何恶意行为，例如植入后门、窃取数据或破坏系统。因此，投毒风险评估为 0%。

**利用方式总结：**

攻击者利用该漏洞的核心在于控制 Ingress 资源的 `nginx.ingress.kubernetes.io/permanent-redirect` 注解，注入恶意的 Lua 代码到 Nginx 配置中。一旦 Ingress 资源被创建，Nginx 控制器就会加载包含恶意代码的配置，从而导致代码执行。攻击者可以利用此漏洞读取敏感信息，甚至完全控制 Kubernetes 集群。

**项目地址:** [r0binak/CVE-2023-5044](https://github.com/r0binak/CVE-2023-5044)

**漏洞详情:** [CVE-2023-5044](https://nvd.nist.gov/vuln/detail/CVE-2023-5044)