## CVE-2023-40931-Nagios XI-SQL注入

**漏洞编号:** CVE-2023-40931

**漏洞类型:** SQL注入

**影响应用:** Nagios XI

**危害等级:** 高危，可能导致数据泄露和远程代码执行

**影响版本:** 5.11.0 to 5.11.1

**利用条件:** 需要有效的Nagios XI用户名和密码，以及目标实例的网络访问权限。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-40931 是 Nagios XI 5.11.0 到 5.11.1 版本中存在的 SQL 注入漏洞。根据漏洞库信息和搜索引擎结果，该漏洞允许经过身份验证的攻击者通过向 `/nagiosxi/admin/banner_message-ajaxhelper.php` 发送包含恶意 `id` 参数的 POST 请求，执行任意 SQL 命令。

**有效性：**

提供的sqlmap命令看起来是有效的，它可以自动化漏洞利用过程。 它首先使用提供的用户名和密码向 API 进行身份验证以获取token，然后使用此token构造一个恶意的URL,其中`id`参数用于注入SQL payload。 sqlmap工具可以自动检测和利用SQL注入漏洞，并提取数据库信息。

**投毒风险：**

提供的POC代码是一个sqlmap命令，本身不包含直接执行恶意操作的代码。但是，需要注意以下几点：

*   **sqlmap 的安全性：** sqlmap 是一个功能强大的工具，但也可能被用于恶意目的。从不可信的来源下载或使用修改过的 sqlmap 可能存在风险。
*   **目标系统的风险：** 成功利用 SQL 注入漏洞可能导致完全控制目标系统。这取决于数据库权限和系统配置。
*   **Payload的风险:** 使用sqlmap进行--dump操作存在一定的数据泄露风险，攻击者可能通过该操作获取数据库中的敏感信息。

总体来说，直接的投毒风险较低，但使用该POC代码进行漏洞利用可能导致严重的后果，需要谨慎评估和使用。投毒风险评估为10%，主要是因为sqlmap本身可能存在未知的风险，或者用户在使用时可能引入额外的payload。

**利用方式：**

1.  **身份验证：** 攻击者需要拥有 Nagios XI 的有效用户名和密码。可以通过暴力破解、钓鱼等方式获取。
2.  **获取 Token：** 使用获得的用户名和密码，调用 Nagios XI 的 API `/nagiosxi/api/v1/authenticate` 获取身份验证 Token。
3.  **构造恶意请求：** 构造一个包含恶意 `id` 参数的 POST 请求，发送到 `/nagiosxi/admin/banner_message-ajaxhelper.php`。`id` 参数中包含 SQL 注入 Payload。
4.  **执行 SQL 命令：** Nagios XI 服务器在处理请求时，会将恶意 `id` 参数中的 SQL 代码注入到数据库查询中，导致任意 SQL 命令的执行。
5.  **提取数据/控制系统：** 攻击者可以通过执行 SQL 命令提取数据库中的敏感数据，或者修改数据库内容，甚至可以通过数据库执行操作系统命令，从而完全控制 Nagios XI 服务器。

**项目地址:** [sealldeveloper/CVE-2023-40931-PoC](https://github.com/sealldeveloper/CVE-2023-40931-PoC)

**漏洞详情:** [CVE-2023-40931](https://nvd.nist.gov/vuln/detail/CVE-2023-40931)