## CVE-2024-23113 - Fortinet Format String Vulnerability

**漏洞编号:** CVE-2024-23113

**漏洞类型:** 格式化字符串漏洞

**影响应用:** FortiOS, FortiProxy, FortiPAM, FortiSwitchManager

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** FortiOS (7.4.0-7.4.2, 7.2.0-7.2.6, 7.0.0-7.0.13), FortiProxy (7.4.0-7.4.2, 7.2.0-7.2.8, 7.0.0-7.0.15), FortiPAM (1.2.0, 1.1.0-1.1.2, 1.0.0-1.0.3), FortiSwitchManager (7.2.0-7.2.3, 7.0.0-7.0.3)

**利用条件:** 需要网络可达受影响端口 (脚本中硬编码为541)，且目标为存在漏洞的版本

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-23113是一个存在于多个Fortinet产品中的格式化字符串漏洞。根据漏洞描述，攻击者可以通过构造特制的网络数据包来执行未授权的代码或命令。

**有效性分析：**

提供的PoC脚本尝试通过TLSv1.2连接到目标设备的541端口。脚本构造了一个包含格式化字符串`%n`的payload，并发送到服务器。如果服务器存在漏洞，预期会因为格式化字符串的问题导致连接中断，脚本会捕获这个异常并判断目标可能存在漏洞。

**投毒风险分析：**

*   PoC脚本本身相对简单，主要功能是检测漏洞是否存在，没有明显的恶意代码。
*   `README.md`文件中提到“This python script is to be used for internal use only.”，以及免责声明，这在一定程度上表明作者可能意识到了潜在的滥用风险。
*   潜在的风险在于，攻击者可能会修改脚本中的payload，尝试利用格式化字符串漏洞执行任意代码，但这取决于目标系统是否存在相应的利用链。代码中`format_string_payload = b"reply 200\r\nrequest=auth\r\nauthip=%n\r\n\r\n\x00"`这行，存在被修改为更具攻击性的payload，但目前脚本功能仅为检测。
*   投毒风险评估为10%，主要考虑潜在的payload修改风险，而非脚本本身存在恶意代码。

**利用方式分析：**

1.  确定目标Fortinet设备运行的固件版本在受影响范围内。
2.  使用PoC脚本检测目标设备是否存在漏洞。
3.  如果目标设备存在漏洞，修改PoC脚本中的payload，利用格式化字符串漏洞执行任意代码。这通常需要对目标系统的内存布局和可利用的函数地址有一定的了解。
4.  成功利用漏洞后，攻击者可以在目标设备上执行任意命令，可能导致系统被完全控制。

**项目地址:** [valornode/CVE-2024-23113](https://github.com/valornode/CVE-2024-23113)

**漏洞详情:** [CVE-2024-23113](https://nvd.nist.gov/vuln/detail/CVE-2024-23113)