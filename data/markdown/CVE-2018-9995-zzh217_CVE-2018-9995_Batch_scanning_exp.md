## CVE-2018-9995 - TBK DVR 认证绕过

**漏洞编号:** CVE-2018-9995

**漏洞类型:** 认证绕过

**影响应用:** TBK DVR4104, DVR4216及多个重新贴牌版本

**危害等级:** 高危，可能导致未授权访问和控制设备

**影响版本:** 受影响版本未明确列出，但包括TBK DVR4104和DVR4216及多个重新贴牌版本

**利用条件:** 需要网络可达，目标设备开放HTTP/HTTPS服务

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2018-9995漏洞允许攻击者通过在HTTP请求头中设置`Cookie: uid=admin`绕过身份验证。通过发送包含该Cookie头的请求，攻击者可以模拟管理员身份，访问设备的敏感信息或执行未授权操作。

**利用方式:**

1.  攻击者构造一个HTTP请求，并在请求头中添加`Cookie: uid=admin`。
2.  攻击者将该请求发送到目标DVR设备的Web接口，例如`device.rsp?opt=user&cmd=list`。
3.  如果设备存在漏洞，则会绕过身份验证，并返回管理员权限下的JSON数据。

**有效性评估:**

根据漏洞库信息和Exploit-DB的公开漏洞利用代码(44577)，该漏洞利用的有效性较高。攻击者可以相对容易地通过构造恶意请求来绕过身份验证。

**投毒风险分析:**

提供的Python脚本 `CVE-2018-9995_Batch_scanning_exp.py`  主要功能是批量扫描和利用该漏洞。脚本通过以下步骤工作：

1.  **导入必要的库:** 导入 requests, grequests, csv, argparse等库，用于发送HTTP请求，处理CSV文件和解析命令行参数。
2.  **定义Colors类:** 定义颜色类用于在终端输出不同颜色的文本。
3.  **定义banner:** 定义了一个ASCII艺术的banner。

   通过快速浏览代码，没有发现明显的恶意代码或后门。但是，需要注意以下几点潜在的风险：

*   **依赖风险:** 脚本依赖于第三方库（requests, grequests, tableprint）。如果这些库被恶意修改，可能会导致代码执行漏洞。
*   **输入验证:** 脚本可能没有对输入（例如，目标IP地址或URL）进行充分的验证。如果攻击者能够控制输入，可能会导致任意代码执行或拒绝服务攻击。
*   **异常处理:** 脚本可能没有对所有可能的异常情况进行处理。这可能会导致脚本崩溃或泄露敏感信息。

   考虑到以上风险以及代码的简单性，评估认为投毒风险较低，约为5%。更全面的分析需要对代码进行更深入的审计，例如检查所有输入验证和异常处理的细节。

**项目地址:** [zzh217/CVE-2018-9995_Batch_scanning_exp](https://github.com/zzh217/CVE-2018-9995_Batch_scanning_exp)

**漏洞详情:** [CVE-2018-9995](https://nvd.nist.gov/vuln/detail/CVE-2018-9995)