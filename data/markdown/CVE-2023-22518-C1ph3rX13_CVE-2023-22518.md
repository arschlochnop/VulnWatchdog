## CVE-2023-22518-Atlassian Confluence 认证绕过

**漏洞编号:** CVE-2023-22518

**漏洞类型:** 认证绕过

**影响应用:** Atlassian Confluence Data Center and Server

**危害等级:** 高危，可能导致完全控制 Confluence 实例

**影响版本:** 所有版本 < 7.19.16, < 8.3.4, < 8.4.4, < 8.5.3, < 8.6.1 的 Confluence Data Center and Server

**利用条件:** 目标 Confluence 实例未打补丁且可通过网络访问

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-22518 是 Atlassian Confluence Data Center 和 Server 中的一个认证绕过漏洞。未经身份验证的攻击者可以利用此漏洞重置 Confluence 并创建一个 Confluence 实例管理员帐户，从而完全控制 Confluence 实例。\n\n**利用方式分析：**\n\n1.  **漏洞原理：** 该漏洞源于 Confluence 在特定恢复/安装场景下对认证的错误处理。攻击者可以利用特定的 API 端点在未授权的情况下执行系统恢复操作，并创建新的管理员账户。\n2.  **POC 代码分析：** 提供的 POC 代码首先尝试上传一个伪造的 ZIP 文件到 `/json/setup-restore.action` 或 `/json/setup-restore-local.action` 端点，目的是触发服务器返回包含服务器路径信息的响应。即使上传的文件内容无效，如果服务器响应包含特定的文本（"The zip file did not contain an entry" 和 "exportDescriptor.properties"），则表明目标存在漏洞。\n3.  **利用过程：** 漏洞成功利用后，攻击者可以上传包含恶意配置的 ZIP 文件，该文件能够重置系统并创建一个新的管理员账户，一般账户名为admin，密码admin。攻击者然后可以使用此账户登录并完全控制 Confluence 实例。\n\n**投毒风险分析：**\n\n代码中存在一定的投毒风险，例如，代码中`exp` 函数会尝试使用一个本地zip文件进行利用，如果这个zip文件被替换成恶意文件，比如植入webshell，存在后门风险。此外，虽然代码本身看起来简单，但是可能隐藏了更复杂的利用逻辑或者恶意行为（例如，尝试连接到外部服务器，收集信息等）。考虑到代码的简洁性以及主要功能集中于漏洞利用，投毒可能性较低，预估为10%。

**项目地址:** [C1ph3rX13/CVE-2023-22518](https://github.com/C1ph3rX13/CVE-2023-22518)

**漏洞详情:** [CVE-2023-22518](https://nvd.nist.gov/vuln/detail/CVE-2023-22518)