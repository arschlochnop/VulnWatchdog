## CVE-2018-7600 - Drupalgeddon2 RCE

**漏洞编号:** CVE-2018-7600

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Drupal

**危害等级:** 高危，允许未经身份验证的攻击者执行任意代码

**影响版本:** Drupal 7.x (before 7.58), 8.x (before 8.3.9), 8.4.x (before 8.4.6), and 8.5.x (before 8.5.1)

**利用条件:** 目标Drupal站点未打补丁，并且存在默认或常见模块配置。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2018-7600（Drupalgeddon2）是一个存在于Drupal核心中的远程代码执行漏洞。根据漏洞信息和搜索结果，此漏洞影响多个子系统，利用方式是通过构造特殊的请求，特别是利用`user/password` endpoint，结合`#post_render`属性，触发PHP的`passthru()`函数来执行任意命令。

**有效性：**

提供的PoC代码通过两个步骤利用该漏洞：

1.  发送一个包含恶意参数的POST请求到`user/password`，利用`name[#post_render][]`，`name[#markup]`和`name[#type]`参数注入命令。
2.  从响应中提取`form_build_id`，然后发送另一个包含该`form_build_id`的请求到`file/ajax/name/#value/{form_build_id}`，以触发命令执行。

根据提供的漏洞库信息、搜索结果以及利用代码，可以判断此POC代码是**有效**的，可以利用未修复的Drupal站点执行远程代码。

**投毒风险：**

评估PoC代码是否存在投毒风险：

*   代码相对简短，易于审查。
*   代码的主要功能是利用已知的Drupal漏洞执行命令，没有发现明显的恶意行为。
*   虽然代码中没有直接发现投毒代码，但是任何代码都存在被恶意修改的风险。例如，攻击者可能会修改命令执行部分，使其在执行用户指定的命令之前或之后执行其他恶意操作。

尽管直接投毒证据不多，但考虑到软件供应链的安全风险，以及任何代码都可能被篡改的可能性，综合评估投毒风险为**5%**。这个评估考虑了代码本身的简洁性以及潜在的供应链攻击风险。

**利用方式：**

1.  攻击者首先构造一个包含恶意参数的POST请求，发送到目标Drupal站点的`user/password`路径。
2.  该请求利用了Drupal的表单渲染机制中的漏洞，允许攻击者注入并执行PHP代码。
3.  服务器响应包含一个`form_build_id`，攻击者需要提取该ID。
4.  攻击者使用提取的`form_build_id`构造第二个POST请求，发送到`file/ajax/name/#value/{form_build_id}`路径。
5.  这个请求触发Drupal执行之前注入的PHP代码，从而实现远程代码执行。

通过这种方式，攻击者可以在未经身份验证的情况下，在目标Drupal服务器上执行任意命令，从而完全控制受影响的系统。

**项目地址:** [xxxTectationxxx/CVE-2018-7600](https://github.com/xxxTectationxxx/CVE-2018-7600)

**漏洞详情:** [CVE-2018-7600](https://nvd.nist.gov/vuln/detail/CVE-2018-7600)