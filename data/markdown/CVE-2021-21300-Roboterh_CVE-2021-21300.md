## CVE-2021-21300-Git-远程代码执行

**漏洞编号:** CVE-2021-21300

**漏洞类型:** 远程代码执行

**影响应用:** Git

**危害等级:** 高危，可能导致远程代码执行和系统控制

**影响版本:** 2.14.2 <= version < 2.17.6, 2.18.0 <= version < 2.18.5, 2.19.0 <= version < 2.19.6, 2.20.0 <= version < 2.20.5, 2.21.0 <= version < 2.21.4, 2.22.0 <= version < 2.22.5, 2.23.0 <= version < 2.23.4, 2.24.0 <= version < 2.24.4, 2.25.0 <= version < 2.25.5, 2.26.0 <= version < 2.26.3, 2.27.0 <= version < 2.27.1, 2.28.0 <= version < 2.28.1, 2.29.0 <= version < 2.29.3, 2.30.0 <= version < 2.30.1

**利用条件:** 目标系统使用受影响的Git版本，且文件系统为大小写不敏感（如NTFS, HFS+, APFS），启用了符号链接，并配置了clean/smudge filter（如Git LFS）。用户克隆恶意仓库。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-21300漏洞是Git中的一个远程代码执行漏洞，存在于当Git客户端在大小写不敏感的文件系统上处理包含符号链接和clean/smudge过滤器(例如Git LFS)的恶意仓库时。攻击者可以创建一个包含特制的符号链接和文件的仓库，当用户克隆该仓库时，恶意代码会被执行。

**有效性：**
根据漏洞信息和搜索结果，该漏洞的POC是有效的。多个来源都确认了该漏洞的存在，并提供了缓解措施和补丁版本。PacketStorm Security等网站上也有利用代码的示例。

**投毒风险：**
提供的代码片段主要展示了Git钩子的示例，例如`applypatch-msg.sample`、`commit-msg.sample`和`fsmonitor-watchman.sample`。这些是正常的Git功能，用于在特定Git操作期间执行脚本。虽然这些钩子本身不是恶意代码，但攻击者可以利用这些钩子来执行恶意操作。例如，攻击者可以在仓库中包含一个`.gitattributes`文件，该文件配置了一个恶意的clean/smudge过滤器，该过滤器会在检出时执行任意代码。`fsmonitor-watchman.sample`这个文件监视文件系统的变化，恶意修改这个文件可能会导致监控系统被破坏，或者执行恶意的代码。因此，**仓库本身存在被投毒的可能，概率约为10%**。

**利用方式：**
1.  **创建恶意仓库：** 攻击者创建一个Git仓库，其中包含：
    *   一个`.gitattributes`文件，配置一个恶意的clean/smudge过滤器。例如，将所有`.txt`文件指向一个执行任意代码的脚本。
    *   一个或多个符号链接，指向触发恶意过滤器的文件。
    *   可能包含Git LFS跟踪的文件，以便在克隆时触发过滤器。
2.  **诱骗用户克隆仓库：** 攻击者通过各种手段（例如，社交工程、鱼叉式网络钓鱼等）诱骗受害者克隆该恶意仓库。
3.  **执行恶意代码：** 当受害者克隆仓库时，Git会根据`.gitattributes`中的配置执行clean/smudge过滤器。如果过滤器指向恶意脚本，则该脚本会在受害者的计算机上执行，从而导致远程代码执行。

要成功利用此漏洞，需要满足以下条件：
*   目标系统使用受影响的Git版本。
*   文件系统为大小写不敏感（如NTFS, HFS+, APFS）。
*   启用了符号链接（默认启用，但可以通过`git config core.symlinks false`禁用）。
*   配置了clean/smudge filter（例如Git LFS）。


**项目地址:** [Roboterh/CVE-2021-21300](https://github.com/Roboterh/CVE-2021-21300)

**漏洞详情:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)