## CVE-2007-2447

**漏洞编号:** CVE-2007-2447

**漏洞类型:** 远程命令执行

**影响应用:** Samba

**危害等级:** 高危，允许远程攻击者执行任意命令

**影响版本:** 3.0.0 through 3.0.25rc3

**利用条件:** 目标系统运行存在漏洞的Samba版本，并且启用“username map script”选项 (针对SamrChangePassword函数)。需要网络可达以及Samba服务端口开放。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2007-2447 是一个Samba的远程命令执行漏洞。漏洞存在于Samba 3.0.0到3.0.25rc3版本的smbd的MS-RPC功能中。攻击者可以通过精心构造的包含shell元字符的参数，在启用 "username map script" 的情况下利用SamrChangePassword函数，或者在其他MS-RPC函数(例如远程打印机和文件共享管理)中利用此漏洞执行任意命令。

**漏洞利用方式：**
1.  **利用场景一 (需要身份验证):**  远程已认证的用户可以利用涉及远程打印机和文件共享管理中的其他MS-RPC功能，通过shell元字符执行命令。
2.  **利用场景二 (匿名访问, 需要username map script):**  当启用了 `username map script` 选项时，匿名调用 `SamrChangePassword()` 函数，攻击者可以在密码中注入shell元字符，从而执行任意命令。

**POC有效性：**提供的POC代码利用了此漏洞，通过SMB协议发送包含反弹shell命令的用户名，从而在目标机器上执行该命令。利用成功的前提是目标主机存在漏洞且满足相应的利用条件。

**投毒风险评估：**
虽然POC代码主要功能是利用漏洞，但是仍然存在一定的投毒风险：
*   **Payload修改风险：** 攻击者可能修改`payload`变量，植入恶意代码，例如下载并执行其他恶意程序。
*   **依赖项风险：**  虽然POC中使用`mysmb`，`platform`，`sys`，`os`等常见库，但是依赖库本身也可能被篡改。

考虑到POC代码的简洁性，主要功能是反弹shell，且依赖的库较为常见，因此投毒风险较低，大约为5%。

**项目地址:** [3x1t1um/CVE-2007-2447](https://github.com/3x1t1um/CVE-2007-2447)

**漏洞详情:** [CVE-2007-2447](https://nvd.nist.gov/vuln/detail/CVE-2007-2447)