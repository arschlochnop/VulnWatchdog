## CVE-2025-54874-OpenJPEG-堆内存写溢出

**漏洞编号:** CVE-2025-54874

**漏洞类型:** 堆内存写溢出

**影响应用:** OpenJPEG

**危害等级:** 中危，可能导致拒绝服务或信息泄露

**影响版本:** >= 2.5.1, <= 2.5.3

**利用条件:** 需要能够处理恶意的JP2图像文件

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2025-54874 存在于 OpenJPEG 2.5.1 到 2.5.3 版本中。当 `opj_jp2_read_header` 函数被调用，并且数据流 `p_stream` 太短，同时 `p_image` 没有被初始化时，可能导致堆内存写溢出。

**有效性分析：**
提供的POC代码（poc.c和相关的README.md）旨在演示CVE-2025-54874漏洞。README描述了如何编译和运行POC，并提供了验证漏洞所需的步骤，包括使用Valgrind进行内存泄漏检测。Valgrind的结果显示存在内存泄漏，确认了POC的有效性。

**投毒风险分析：**
查看提供的poc.c代码没有发现任何恶意后门，根据提交记录也没有其他可疑文件。但仍需注意，在实际环境中，应当从官方或可信来源获取OpenJPEG库。此处的投毒风险评估为10%，主要基于以下考虑：

*   **POC的性质：** POC代码本身是为了演示漏洞，通常不会包含恶意代码。但恶意攻击者可能会修改POC，使其包含其他恶意功能。
*   **代码审查：**  虽然快速审查未发现明显的恶意代码，但全面的安全审计需要更深入的分析。
*   **依赖项：** 该POC依赖于OpenJPEG库。如果使用的OpenJPEG库本身被篡改，则可能引入恶意代码。
*   **作者的信誉：**  虽然GitHub有用户信誉系统，但作者的账号仍然存在被盗用的风险，进而导致恶意代码的引入。

**利用方式分析：**
1.  **漏洞触发：** 漏洞发生在 `opj_jp2_read_header` 函数中，该函数用于解析JP2文件的头部。
2.  **条件：**  触发该漏洞需要满足两个条件：一是输入的数据流 `p_stream` 太短，二是 `p_image` 结构体未被正确初始化。
3.  **过程：**  当 `opj_j2k_read_header` 函数返回错误时，`opj_jp2_read_header` 没有检查该错误，直接在堆内存中设置值，导致内存泄漏。
4.  **攻击向量：**  攻击者可以构造恶意的JP2文件，使其满足上述条件，从而触发漏洞。
5.  **影响：**  该漏洞可能导致程序崩溃（拒绝服务）或泄露敏感信息，CVSS评分表明该漏洞可能导致高机密性、完整性和可用性影响。

**总结：**
POC代码能够有效演示CVE-2025-54874漏洞，该漏洞是一个堆内存写溢出，通过构造恶意的JP2文件触发。虽然POC代码本身投毒风险较低，但在实际使用时，需要确保OpenJPEG库的来源可信，并进行全面的安全审计。

**项目地址:** [cyhe50/cve-2025-54874-poc](https://github.com/cyhe50/cve-2025-54874-poc)

**漏洞详情:** [CVE-2025-54874](https://nvd.nist.gov/vuln/detail/CVE-2025-54874)