## CVE-2022-26265-Contao CMS-RCE

**漏洞编号:** CVE-2022-26265

**漏洞类型:** 远程代码执行(RCE)

**影响应用:** Contao CMS Managed Edition

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** 1.5.0

**利用条件:** 需要Contao CMS v1.5.0安装并运行，攻击者需要能访问`/api/server/config`接口。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-26265是Contao Managed Edition v1.5.0中的一个远程代码执行漏洞，该漏洞位于`api/server/config`接口，通过`php_cli`参数实现。攻击者可以通过构造恶意的`php_cli`参数，发送PUT请求到该接口，执行任意命令。 

**有效性：**
根据漏洞信息、搜索结果以及提供的POC代码，此漏洞是有效的。POC代码利用了`php_cli`参数中的RCE漏洞，通过发送精心构造的POST请求到`/api/server/config`接口，执行任意命令。

**投毒风险：**
提供的POC代码主要包含以下几个部分：
1.  `README.md`: 描述了漏洞信息和受影响的产品。
2.  `main.py`: 漏洞利用的Python脚本，用于发送恶意请求。

对`main.py`进行分析，发现以下几点：
*   代码结构清晰，主要功能是发送包含恶意`php_cli`参数的POST请求。
*   包含随机字符串生成函数，可能用于绕过某些检测。
*   User-Agent被设置为`Mozilla/5.0`，属于正常请求头。
*   Cookie `contao_manager_auth` 被硬编码，实际利用需要替换为有效cookie

综合来看，该POC代码本身存在投毒的可能性较低，但存在被篡改的风险。攻击者可能在`command`参数中注入恶意代码，或者修改请求头，以便进行隐蔽攻击。因此，在使用该POC时，需要仔细检查代码，确保其安全性。

**利用方式：**
1.  攻击者需要拥有目标Contao CMS v1.5.0实例的访问权限。
2.  攻击者构造一个包含恶意PHP代码的字符串，作为`php_cli`参数的值。
3.  攻击者将构造好的JSON数据作为请求体，并设置正确的请求头，发送POST请求到`/api/server/config`接口。
4.  Contao CMS接收到请求后，会解析`php_cli`参数，并将其作为PHP CLI命令执行，从而导致远程代码执行。

**结论：**
该漏洞的利用方式较为简单，但危害巨大，可能导致服务器完全控制。建议Contao CMS v1.5.0的用户尽快升级到最新版本，或者采取其他安全措施，以防止受到攻击。同时使用POC时，需注意检查代码，防止被植入恶意代码。

**项目地址:** [redteamsecurity2023/CVE-2022-26265](https://github.com/redteamsecurity2023/CVE-2022-26265)

**漏洞详情:** [CVE-2022-26265](https://nvd.nist.gov/vuln/detail/CVE-2022-26265)