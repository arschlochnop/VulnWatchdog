## CVE-2024-40453-Squirrelly-代码注入

**漏洞编号:** CVE-2024-40453

**漏洞类型:** 代码注入

**影响应用:** Squirrelly

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 9.0.0

**利用条件:** 目标服务器运行存在漏洞版本的Squirrelly，且攻击者能够控制 options.varName 参数

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-40453是Squirrelly v9.0.0版本中的一个代码注入漏洞，该漏洞位于`options.varName`组件中。攻击者可以通过控制`options.varName`参数，将恶意JavaScript代码注入到服务器端，从而实现远程代码执行（RCE）。

**有效性：**
提供的POC代码尝试利用此漏洞。它创建了一个反向shell `payload.sh`，并通过HTTP服务器提供给目标服务器。然后，它使用`wget`和`bash`命令在目标系统上执行该payload。

**投毒风险：**
该POC本身存在轻微的投毒风险（10%）。原因在于：

*   脚本会创建和执行`payload.sh`。虽然payload的内容（反向shell）在代码中可见，但攻击者可能会修改`poc.py`脚本，使其包含额外的恶意行为，例如，在创建`payload.sh`时添加其他命令，从而在目标系统上执行未经授权的操作。
*   脚本启动了一个简单的HTTP服务器。攻击者可能会通过替换 `SimpleHTTPRequestHandler` 为自定义的handler，在传输 `payload.sh` 的过程中引入恶意代码。虽然这部分风险较低，但是也需要进行评估。

**利用方式：**

1.  **目标服务器存在漏洞：** 目标服务器上运行着 Squirrelly v9.0.0 或未打补丁的版本。
2.  **控制`options.varName`：** 攻击者能够控制传递给Squirrelly模板引擎的`options.varName`参数。
3.  **注入恶意代码：** 攻击者将包含恶意JavaScript代码的字符串作为`options.varName`的值传递给Squirrelly模板引擎。例如，`${require('child_process').execSync('command')}`可以执行任意系统命令。
4.  **服务器端执行：** Squirrelly模板引擎在服务器端执行注入的恶意代码，导致远程代码执行。在本例中，PoC生成反向shell，使得攻击者能够连接到受害者的机器。

该漏洞的严重性在于它允许未经身份验证的攻击者在服务器上执行任意代码，从而可能导致完全控制受影响的系统。建议Squirrelly用户尽快升级到 v9.0.1或更高版本。

**项目地址:** [BwithE/CVE-2024-40453](https://github.com/BwithE/CVE-2024-40453)

**漏洞详情:** [CVE-2024-40453](https://nvd.nist.gov/vuln/detail/CVE-2024-40453)