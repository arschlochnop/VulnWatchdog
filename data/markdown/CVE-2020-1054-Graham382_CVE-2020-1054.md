## CVE-2020-1054 Win32k 权限提升漏洞

**漏洞编号:** CVE-2020-1054

**漏洞类型:** 权限提升

**影响应用:** Windows

**危害等级:** 高危，允许低权限用户提升至SYSTEM权限

**影响版本:** 受影响的Windows版本包括但不限于Windows 7 SP1, Windows 8.1, Windows 10 (多个版本), Windows Server (多个版本)

**利用条件:** 本地访问

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

根据漏洞库信息和搜索结果，CVE-2020-1054是Windows内核模式驱动程序在处理内存中的对象时未能正确处理对象而导致的权限提升漏洞。攻击者可以利用此漏洞在本地提升权限。

**有效性：**
提供的PoC代码（CVE-2020-1054.cpp）似乎针对Windows 7 x64，它利用了`DrawIconEx`函数中的漏洞。代码通过操纵GDI对象，特别是位图对象，来实现越界写入，从而覆盖内核内存中的敏感数据，如进程令牌。

**投毒风险：**
该代码主要功能是利用漏洞提升权限，没有发现明显的恶意代码或后门。但是，任何漏洞利用代码都可能被恶意修改并重新发布，因此始终存在一定的投毒风险，评估为1%。风险极低,主要是考虑到安全问题,正常使用风险可忽略不计.

**利用方式：**
1.  **查找目标进程和系统进程的Token地址：** 通过`GetObjectKernelAddress`函数获取当前进程和系统进程的内核对象地址，并计算Token在EPROCESS结构中的偏移。系统进程一般是PID为4的System进程。
2.  **GDI对象操纵：** 代码创建GDI对象（位图）并在内存中分配空间。通过精心构造的位图对象及其相关的内存布局，利用`DrawIconEx`函数中的越界写入漏洞。
3.  **越界写入：**  通过计算目标地址,修改当前进程的Token为系统进程的Token，实现权限提升。
4. **提权:** 利用成功之后,当前进程就具备了System权限.

**总结：**
该漏洞利用方式是典型的Win32k漏洞利用，通过GDI对象操纵和越界写入来修改进程令牌，从而实现权限提升。POC是有效的，但需要针对特定的Windows版本进行调整。投毒风险较低，但使用时仍需谨慎。

**项目地址:** [Graham382/CVE-2020-1054](https://github.com/Graham382/CVE-2020-1054)

**漏洞详情:** [CVE-2020-1054](https://nvd.nist.gov/vuln/detail/CVE-2020-1054)