## CVE-2025-29927-Next.js-Authorization Bypass

**漏洞编号:** CVE-2025-29927

**漏洞类型:** 权限绕过

**影响应用:** Next.js

**危害等级:** 高危，可能导致未授权访问和数据泄露

**影响版本:** 11.1.4 <= 版本 <= 13.5.6, > 14.0.0 < 14.2.25, > 15.0.0 < 15.2.3

**利用条件:** 目标Next.js应用存在受影响的中间件配置，且允许外部请求包含x-middleware-subrequest头。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2025-29927 存在于 Next.js 中间件的授权绕过漏洞。攻击者可以通过在请求中设置 `x-middleware-subrequest` header 来绕过中间件的授权检查，从而访问受保护的路由。漏洞影响的 Next.js 版本包括 11.1.4 到 13.5.6，大于 14.0.0 小于 14.2.25，以及大于 15.0.0 小于 15.2.3。利用方式是通过发送带有特定 `x-middleware-subrequest` header 的 HTTP 请求。提供的 POC 代码 `CVE202529927-check.py` 旨在检测目标应用是否存在此漏洞。它通过尝试不同的 `x-middleware-subrequest` 值和路径，检查是否可以绕过身份验证。该脚本首先定义了`middleware_names`和`paths`列表，用于构建payload。然后，它尝试通过修改 `x-middleware-subrequest` header 的值来绕过中间件的身份验证。`is_authentication_page` 函数检测页面内容中是否包含身份验证相关的关键词，以判断页面是否为登录页面。`bypass_auth`函数用于发送带有恶意header的请求来绕过验证，如果状态码和内容长度发生变化，则认为存在漏洞。

**有效性评估：** 根据漏洞信息和搜索结果，提供的 POC 代码能够有效验证漏洞的存在。它尝试使用不同的 `x-middleware-subrequest` 值来绕过中间件认证，如果返回的状态码和内容长度与预期不符，则说明漏洞存在。

**投毒风险分析：** 代码中可能存在轻微的投毒风险，主要体现在以下几个方面：

1.  **依赖风险：** 脚本使用了`requests`和`BeautifulSoup4`库，如果这些库本身被植入恶意代码，可能影响脚本的安全性。尽管requests和beautifulsoup4本身很常用，风险较低。
2.  **拒绝服务 (DoS)：**  脚本中的 `cache_p` 函数，通过随机生成查询参数并重复发送请求，可能导致目标服务器的缓存失效，进而造成 DoS 攻击，占用大量资源，导致服务器性能下降。
3.  **信息泄露：** 脚本会打印服务器的响应状态码和内容长度等信息，虽然这些信息本身不是敏感数据，但在某些情况下，可能被攻击者利用来推断服务器的内部结构和配置。

总体而言，投毒的概率比较低，大约为10%。主要是脚本使用了外部库，可能存在依赖风险。同时`cache_p` 函数有潜在的 DoS 风险。

**利用方式总结：**

1.  攻击者构造包含 `x-middleware-subrequest` header 的恶意 HTTP 请求。
2.  `x-middleware-subrequest` 的值设置为特定的中间件名称，例如 'middleware'，'pages/_middleware'等。
3.  发送请求到受保护的路由。
4.  如果中间件验证逻辑存在缺陷，攻击者可以绕过身份验证，访问受保护的资源。

**项目地址:** [c0dejump/CVE-2025-29927-check](https://github.com/c0dejump/CVE-2025-29927-check)

**漏洞详情:** [CVE-2025-29927](https://nvd.nist.gov/vuln/detail/CVE-2025-29927)