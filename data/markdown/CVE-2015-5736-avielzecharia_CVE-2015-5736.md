## CVE-2015-5736 - Fortinet FortiClient 本地提权

**漏洞编号:** CVE-2015-5736

**漏洞类型:** 本地提权

**影响应用:** Fortinet FortiClient

**危害等级:** 高危，允许本地用户以内核权限执行任意代码

**影响版本:** 5.2.4 之前

**利用条件:** 需要本地访问权限，目标系统安装了受影响版本的FortiClient

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2015-5736 漏洞存在于 Fortinet FortiClient 的 Fortishield.sys 驱动中。该驱动允许本地用户通过精心构造的 IOCTL 调用（0x220024 或 0x220028）设置回调函数，从而以内核权限执行任意代码。

**有效性：**
提供的POC代码看起来有效。它首先获取 FortiShield.sys 的基地址，然后计算出漏洞点 `forti_vuln_ptr` 和新的返回地址 `forti_new_RV`。 POC 利用了 `MoveFileEx` 触发回调，并结合 ROP 链来提权。

**投毒风险：**
代码主要是为了演示漏洞利用，风险在于：

*   **潜在的蓝屏：** 如果ROP链构造不正确，或者目标环境与POC不匹配，可能导致系统崩溃（蓝屏）。
*   **代码执行：** 成功利用该漏洞可能会导致恶意代码在内核模式下执行。投毒的概率较低，因为代码直接暴漏了操作流程,主要目的是为了漏洞复现。
    风险评估为 5%。主要考虑了代码质量问题可能导致的蓝屏，以及潜在的恶意利用可能性。

**利用方式：**

1.  **查找 FortiShield.sys 基址：** 使用 `GetBaseAddr` 函数获取 FortiShield.sys 驱动的基地址。
2.  **构造 IOCTL 调用：** 驱动的漏洞点允许用户设置回调函数。利用 MoveFileEx API触发漏洞的执行
3.  **构建 ROP 链：** 在内核中执行任意代码。ROP链的目的通常是提权、禁用安全措施等。
4.  **触发漏洞：** 调用 `MoveFileEx` 触发漏洞，控制程序执行流程，最终执行 ROP 链，实现提权。

**项目地址:** [avielzecharia/CVE-2015-5736](https://github.com/avielzecharia/CVE-2015-5736)

**漏洞详情:** [CVE-2015-5736](https://nvd.nist.gov/vuln/detail/CVE-2015-5736)