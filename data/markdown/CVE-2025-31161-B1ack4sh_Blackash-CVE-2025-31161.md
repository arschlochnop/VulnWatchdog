## CVE-2025-31161-CrushFTP-认证绕过

**漏洞编号:** CVE-2025-31161

**漏洞类型:** 认证绕过

**影响应用:** CrushFTP

**危害等级:** 高危，可导致完全控制系统

**影响版本:** 10 < 10.8.4, 11 < 11.3.1

**利用条件:** 需要目标CrushFTP实例可以通过HTTP(S)访问，且未启用DMZ代理

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2025-31161是CrushFTP 10（10.8.4之前）和11（11.3.1之前）版本中存在的一个认证绕过漏洞。该漏洞允许未经身份验证的攻击者绕过身份验证并接管crushadmin帐户，除非使用了DMZ代理实例。漏洞利用涉及利用AWS4-HMAC授权方法中的竞争条件或通过发送损坏的AWS4-HMAC标头来稳定地绕过身份验证。POC代码通过发送包含用户名和一个斜杠（/）的恶意构造的AWS4-HMAC请求，触发服务器端的index-out-of-bounds错误，阻止服务器执行会话清理，从而允许攻击者以任何已知或可猜测的用户身份进行身份验证。利用方式如下：

1.  **发送带有恶意构造的Authorization header的HTTP请求：** 该请求模仿AWS4-HMAC身份验证，但故意省略或篡改某些字段。具体来说，`Credential`字段只包含用户名和一个斜杠，例如 `Credential=crushadmin/`。
2.  **绕过身份验证检查：** 由于构造的请求，服务器在初步的用户验证阶段会成功找到用户名，触发身份验证过程。但后续对`SignedHeaders`的检查会失败，导致 index-out-of-bounds 错误。
3.  **创建新用户：**  利用绕过的身份验证，攻击者发送一个POST请求到`/WebInterface/function/`，包含`setUserItem`命令，以及新用户的XML配置信息，从而创建一个具有管理员权限的新用户。

**有效性：** 根据提供的漏洞信息和搜索引擎结果，该POC代码很可能有效。CVE已被广泛报道，并有证据表明该漏洞已被实际利用。

**投毒风险：** 风险较低 (5%)，尽管无法完全排除。POC代码相对简单，主要功能是利用漏洞创建新用户。但需要注意的是以下几点：
    *   **依赖项：** 该脚本依赖于`requests`库，如果通过`requirements.txt`文件安装依赖，可能会存在通过恶意依赖进行投毒的风险，不过这里直接提供了代码，风险降低。
    *   **目标账户：** 脚本默认针对`crushadmin`账户，如果攻击者修改脚本针对其他账户，可能会造成拒绝服务或权限提升。
    *   **后门植入：** 理论上，作者可以在创建新用户的同时，添加额外的配置，例如植入后门或修改现有用户的权限，但提供的代码中没有发现此类行为。
    *  **网络风险:** 代码需要通过网络连接到目标，存在被中间人攻击的风险

总体而言，POC代码本身的投毒风险较低，但使用者需要注意代码的来源和潜在的风险，并在安全的环境中进行测试。

**项目地址:** [B1ack4sh/Blackash-CVE-2025-31161](https://github.com/B1ack4sh/Blackash-CVE-2025-31161)

**漏洞详情:** [CVE-2025-31161](https://nvd.nist.gov/vuln/detail/CVE-2025-31161)