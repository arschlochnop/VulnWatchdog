## CVE-2022-24834-Redis-Lua cjson heap overflow

**漏洞编号:** CVE-2022-24834

**漏洞类型:** 堆溢出

**影响应用:** Redis

**危害等级:** 高危，可能导致堆破坏和远程代码执行

**影响版本:** 6.0.0 < version < 6.0.20, 6.2.0 < version < 6.2.13, 7.0.0 < version < 7.0.12

**利用条件:** 需要Redis实例开启Lua脚本支持，且攻击者需要通过身份验证和授权访问Redis

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-24834 漏洞是 Redis 中 Lua cjson 库的一个堆溢出漏洞。当 Redis 执行特别构造的 Lua 脚本时，可能触发 cjson 库中的堆溢出，导致堆破坏，甚至远程代码执行。

**有效性：**
根据漏洞库信息、搜索结果以及提供的漏洞利用代码，该漏洞的利用是有效的。搜索结果中多个链接指向漏洞详情和利用分析，表明该漏洞已被广泛研究和利用。提供的 exploit.py 脚本，明确使用了 pwn 库与 Redis 实例进行交互，并执行包含反弹 shell 命令的 Lua 脚本，具备利用该漏洞进行远程代码执行的能力。

**投毒风险：**
提供的 exploit.py 脚本主要功能是利用 Redis 实例执行恶意 Lua 脚本，脚本从文件读取 Lua 代码，并将 bash 反弹 shell 命令嵌入其中。该脚本本身功能较为直接，没有发现任何隐藏的、与漏洞利用无关的代码或逻辑。此外，README.md 文件的内容也很简单，没有可疑之处。因此，此仓库中存在作者隐藏的投毒代码的可能性极低。

**利用方式：**
1.  **准备环境：**搭建存在漏洞版本的Redis实例。
2.  **编写Lua脚本：**编写包含漏洞触发代码和恶意负载的Lua脚本,恶意负载是反弹shell。
3.  **执行利用代码：**运行提供的 `exploit.py` 脚本，指定目标 Redis 主机、端口，监听主机、端口和包含恶意 Lua 脚本的文件路径。
4.  **反弹Shell：**脚本会连接 Redis 实例，执行 Lua 脚本，Lua 脚本中的恶意代码会在 Redis 服务器上执行反弹 shell 命令。
5.  **控制服务器：**攻击者通过监听端口，获得 Redis 服务器的 shell，从而控制服务器。

**项目地址:** [DukeSec97/CVE-2022-24834-](https://github.com/DukeSec97/CVE-2022-24834-)

**漏洞详情:** [CVE-2022-24834](https://nvd.nist.gov/vuln/detail/CVE-2022-24834)