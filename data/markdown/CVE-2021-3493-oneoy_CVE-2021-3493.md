## CVE-2021-3493 - Ubuntu OverlayFS 本地提权

**漏洞编号:** CVE-2021-3493

**漏洞类型:** 本地提权

**影响应用:** Linux Kernel (Ubuntu)

**危害等级:** 高危，本地用户可提升至 root 权限

**影响版本:** Ubuntu 4.4, 4.15, 5.4, and 5.8 kernels (具体版本号见漏洞库信息)

**利用条件:** 需要目标系统存在未修复的 Ubuntu kernel，且启用 unprivileged user namespaces 和允许 unprivileged overlayfs mounts。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

该漏洞存在于 Ubuntu 内核的 OverlayFS 实现中，由于未正确验证用户命名空间中底层文件系统上文件 capabilities 的设置，导致本地攻击者可利用 unprivileged user namespaces 和 Ubuntu 内核中允许 unprivileged overlayfs mounts 的补丁来提升权限。

**利用方式：**

1.  **环境准备：** 创建必要的目录结构 (lower, upper, work, merge)。
2.  **配置 User Namespace:** 创建一个新的用户命名空间。
3.  **配置 OverlayFS:** 使用 lowerdir, upperdir, 和 workdir 选项挂载 overlay 文件系统。
4.  **设置 Capabilities:** 将可执行文件复制到 merge 目录，并使用 `setxattr` 设置其 capabilities (如 CAP_SETUID, CAP_SETGID, CAP_CHOWN)。
5.  **触发提权:** 执行 merge 目录中的可执行文件，该文件将会以 root 权限执行。

**投毒风险评估：**

提供的 `exploit.c` 代码主要功能是利用 OverlayFS 的漏洞进行提权。代码创建必要的目录，配置 user namespace 和 overlay 文件系统，并设置可执行文件的 capabilities。代码逻辑清晰，没有发现恶意代码或后门。

**有效性评估：**

提供的 POC 代码基于公开信息，并针对 CVE-2021-3493 漏洞进行了利用。根据漏洞库信息、搜索引擎结果和代码分析，该 POC 代码在满足漏洞利用条件的情况下应该是有效的。

**项目地址:** [oneoy/CVE-2021-3493](https://github.com/oneoy/CVE-2021-3493)

**漏洞详情:** [CVE-2021-3493](https://nvd.nist.gov/vuln/detail/CVE-2021-3493)