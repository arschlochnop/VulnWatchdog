## CVE-2024-3094 XZ Utils Backdoor

**漏洞编号:** CVE-2024-3094

**漏洞类型:** 供应链攻击/后门

**影响应用:** XZ Utils

**危害等级:** 极危，允许未经授权的远程SSH访问和潜在的任意代码执行

**影响版本:** 5.6.0, 5.6.1

**利用条件:** 系统使用了受感染的XZ Utils版本，并且sshd等服务链接了受感染的liblzma库。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-3094是一个供应链攻击，恶意代码被插入到XZ Utils的5.6.0和5.6.1版本中。这个后门通过复杂的混淆手段，在构建liblzma库时从伪装的测试文件中提取预编译的目标文件，并修改liblzma代码中的特定函数。这导致任何链接到这个被修改的liblzma库的软件都可能受到影响。最关键的利用点在于，该后门能够拦截并修改与liblzma库的数据交互，攻击者可以通过SSH服务进行未经授权的远程访问，甚至是执行任意代码。

**有效性：**
提供的Dockerfile和docker-compose.yaml文件旨在重现该漏洞。Dockerfile配置了一个Debian experimental镜像，安装了openssh-server，curl，vim和net-tools等工具，并允许root用户通过密码进行SSH登录。docker-compose.yaml定义了如何构建和运行包含漏洞的Docker容器，通过端口映射将容器的22端口映射到宿主机的2222端口。README.md 包含验证步骤，其中包括：
1. 确认容器中安装的liblzma5版本为5.6.0
2. 确认sshd 是否使用了 liblzma.so
3. 运行PoC脚本，验证后门是否存在。
根据README.md描述，这个环境能够成功复现漏洞并检测到后门，表明该POC代码是有效的。

**投毒风险：**
虽然该仓库提供了一个用于重现CVE-2024-3094漏洞的环境，但存在一定的投毒风险。主要考虑到以下几个因素：
1. **Dockerfile中的基础镜像**：使用了`debian:experimental-20240311`镜像。`experimental`分支通常包含未经完全测试的软件包，可能引入其他未知的安全问题。虽然这不一定是恶意的，但增加了潜在的风险。
2. **SSH配置**：Dockerfile中启用了`PermitRootLogin yes`，允许root用户通过密码登录。虽然这简化了漏洞验证过程，但在生产环境中是极其不安全的做法，容易被恶意利用。
3. **PoC脚本**：`poc_detect_backdoor.sh` 脚本的内容并没有直接给出，因此不能确定脚本是否存在恶意行为。即使当前脚本是安全的，也存在未来被替换为恶意脚本的风险。
总体来说，作者直接投毒的可能性较低，约10%。但是，由于Dockerfile配置和基础镜像选择存在一定的风险，用户在使用这个环境时需要格外小心。

**利用方式：**
1.  **供应链攻击：** 恶意代码被插入到XZ Utils的发布版本中，影响了使用这些版本的用户。
2.  **SSH后门：** 受感染的liblzma库被sshd服务链接后，攻击者可以利用后门绕过SSH身份验证。
3.  **远程代码执行：** 成功绕过SSH身份验证后，攻击者可以执行任意命令，从而完全控制受感染的系统。

**项目地址:** [been22426/CVE-2024-3094](https://github.com/been22426/CVE-2024-3094)

**漏洞详情:** [CVE-2024-3094](https://nvd.nist.gov/vuln/detail/CVE-2024-3094)