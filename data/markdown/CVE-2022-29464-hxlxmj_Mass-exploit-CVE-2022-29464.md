## CVE-2022-29464-WSO2-任意文件上传导致远程代码执行

**漏洞编号:** CVE-2022-29464

**漏洞类型:** 任意文件上传导致远程代码执行

**影响应用:** WSO2 API Manager, Identity Server, Enterprise Integrator, Open Banking AM/KM

**危害等级:** 高危，可导致远程代码执行，系统完全控制

**影响版本:** WSO2 API Manager 2.2.0 up to 4.0.0, WSO2 Identity Server 5.2.0 up to 5.11.0, WSO2 Identity Server Analytics 5.4.0, 5.4.1, 5.5.0 and 5.6.0, WSO2 Identity Server as Key Manager 5.3.0 up to 5.11.0, WSO2 Enterprise Integrator 6.2.0 up to 6.6.0, WSO2 Open Banking AM 1.4.0 up to 2.0.0 and WSO2 Open Banking KM 1.4.0, up to 2.0.0.

**利用条件:** 需要网络访问 /fileupload 端点

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-29464 是一个存在于多个 WSO2 产品中的严重漏洞，允许未经授权的文件上传，并最终导致远程代码执行。攻击者利用 `/fileupload` 端点，通过 `Content-Disposition` 头部中的目录遍历序列（如 `../../../../`）将恶意文件上传到 Web 根目录下的可执行目录，例如 `repository/deployment/server/webapps`。上传的文件可以是 JSP、WAR 或其他可执行格式，从而允许攻击者在服务器上执行任意代码。

**漏洞利用方式：**

1.  **确定目标：** 确定运行存在漏洞的 WSO2 产品的目标服务器。
2.  **构造恶意请求：** 构造一个包含恶意文件的 POST 请求，该文件将被上传到 `/fileupload` 端点。请求的 `Content-Disposition` 头部必须包含目录遍历序列，以便将文件放置在 Web 根目录下的可执行目录中。
3.  **上传恶意文件：** 发送构造的请求到目标服务器。服务器会处理请求并将恶意文件上传到指定目录。
4.  **触发代码执行：** 通过访问上传的恶意文件（例如，通过 Web 浏览器），触发服务器执行其中的代码。

**投毒风险分析：**

提供的漏洞利用代码段（`LICENSE`文件）是 GNU GPL 许可证的文本，不包含任何恶意代码或投毒行为。因此，此代码段本身不存在投毒风险。 但是，如果提供的仓库中包含其他payload.jsp或者war,那么会存在投毒风险.根据现有信息，投毒风险为0%。

**有效性分析：**

根据漏洞信息和搜索结果，CVE-2022-29464 漏洞利用的有效性很高，该漏洞被广泛利用，并且已经有公开的PoC利用代码。

**项目地址:** [hxlxmj/Mass-exploit-CVE-2022-29464](https://github.com/hxlxmj/Mass-exploit-CVE-2022-29464)

**漏洞详情:** [CVE-2022-29464](https://nvd.nist.gov/vuln/detail/CVE-2022-29464)