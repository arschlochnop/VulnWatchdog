## CVE-2019-12840 - Webmin Package Updates Remote Command Execution

**漏洞编号:** CVE-2019-12840

**漏洞类型:** 远程命令执行

**影响应用:** Webmin

**危害等级:** 高危，可导致完全系统控制

**影响版本:** <= 1.910

**利用条件:** 需要Webmin访问权限，且用户拥有"Package Updates"模块的授权

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-12840允许经过授权的用户通过"Package Updates"模块的update.cgi页面中的data参数执行任意命令，从而获得root权限。根据提供的漏洞信息、搜索结果以及漏洞利用代码，分析如下：

1.  **有效性：**
    *   漏洞库信息明确指出，Webmin 1.910及更早版本存在此漏洞，任何有"Package Updates"模块权限的用户均可利用。漏洞利用代码（CVE-2019-12840.py）也提供了完整的利用流程，包括登录认证和命令执行，因此POC代码有效。

2.  **投毒风险：**
    *   该脚本总体来说比较直接，主要功能是登录Webmin并利用漏洞执行命令。但仍然存在潜在的风险，比如 reverse shell 部分使用base64编码，可能存在通过替换编码后的shellcode执行恶意操作，但概率较低，初步判定投毒风险为10%，脚本中没有任何明显的后门或恶意代码。

3.  **利用方式：**
    *   **登录认证：** 首先，脚本使用提供的用户名和密码登录Webmin系统。
    *   **获取Session ID：** 成功登录后，脚本获取Webmin的Session ID (sid)。
    *   **构造恶意请求：** 脚本构造一个包含恶意命令的POST请求，发送到`/package-updates/update.cgi`页面。其中，`data`参数包含要执行的命令。具体而言，脚本修改了 `u` 参数的值, 插入要执行的命令. 
    *   **命令执行：** Webmin服务器收到请求后，由于未对`data`参数进行充分的验证和过滤，导致恶意命令被执行，攻击者从而获取服务器的控制权限。
    *   **反弹Shell (可选)：** 可以通过`-lhost`参数指定反弹shell的地址，脚本会将payload编码为base64，Webmin 执行解码后的代码，实现反弹shell。

4.  **总结：**
    该漏洞利用的关键在于Webmin对"Package Updates"模块的输入验证不足，允许经过身份验证的用户执行任意命令。提供的POC代码能够有效利用该漏洞，但存在极低的投毒风险。

**项目地址:** [Pol-Ruiz/PoC-CVE-2019-12840](https://github.com/Pol-Ruiz/PoC-CVE-2019-12840)

**漏洞详情:** [CVE-2019-12840](https://nvd.nist.gov/vuln/detail/CVE-2019-12840)