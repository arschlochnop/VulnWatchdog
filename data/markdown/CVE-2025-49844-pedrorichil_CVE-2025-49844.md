## CVE-2025-49844-Redis-Lua Use-After-Free

**漏洞编号:** CVE-2025-49844

**漏洞类型:** Use-After-Free

**影响应用:** Redis

**危害等级:** 高危，远程代码执行

**影响版本:** < 8.2.2

**利用条件:** 需要Redis服务开启Lua脚本功能，且攻击者需要具有执行Lua脚本的权限（通过身份验证或未配置身份验证）

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于Redis的Lua脚本解释器中，是由于不正确的内存管理导致的Use-After-Free。攻击者可以利用此漏洞，通过构造恶意的Lua脚本来操控垃圾回收机制，触发UAF，进一步逃逸Lua沙箱，最终实现远程代码执行。

**有效性评估：**
提供的Dockerfile和README.md表明存在针对CVE-2025-49844的POC。Dockerfile创建了一个易受攻击的Redis实例（7.2.0），而README.md提供了关于如何设置和运行该POC的详细说明，包括检查漏洞、触发UAF、测试沙箱逃逸和内存损坏等模块。通过提供的命令和预期输出，可以判断POC是有效的，可以验证漏洞的存在。

**投毒风险分析：**
虽然提供的代码库的目的是为了演示漏洞，但仍然存在一定的投毒风险。风险主要在于 `exploit_poc.py`脚本，特别是其与目标Redis服务器交互并执行Lua脚本的部分。以下是投毒风险分析：

*   **依赖项风险：** `exploit_poc.py` 脚本可能依赖于额外的Python库，这些库可能包含恶意代码。但是从提供的代码片段中并没有看到额外的库，需要查看具体 `exploit_poc.py` 文件。
*   **命令执行风险：** 如果攻击者修改了 `exploit_poc.py` 脚本，可能会在Redis服务器上执行任意命令，甚至下载和执行恶意软件。
*   **后门植入：** 攻击者可能通过修改 `exploit_poc.py`，在Redis服务器上植入后门，例如添加具有特权的账户或者开放不必要的端口。

虽然README.md中包含警告信息，提示用户不要在生产环境中使用，但是缺乏经验的用户可能会忽略这些警告，从而面临风险。总体来说，投毒风险较低，因为提供的代码主要是为了演示UAF漏洞。但是，使用任何来自不可信来源的代码时，都应该进行彻底的审查。

**利用方式：**
1.  **漏洞触发：** 攻击者首先需要连接到Redis服务器，如果需要身份验证，则需要提供正确的密码。
2.  **发送恶意Lua脚本：** 攻击者使用EVAL命令向Redis服务器发送特制的Lua脚本。
3.  **触发Use-After-Free：** 恶意Lua脚本通过操纵垃圾回收机制，触发Use-After-Free漏洞。
4.  **沙箱逃逸：** 成功触发UAF后，攻击者利用内存损坏漏洞来逃逸Lua沙箱的限制。
5.  **远程代码执行：** 在逃逸沙箱后，攻击者可以执行任意的本地代码，从而完全控制Redis服务器，并可能进一步控制整个系统。可利用`exploit_poc.py` 脚本的不同模块来进行验证和利用，如 `basic`, `sandbox`, 和 `advanced` 模式。

**项目地址:** [pedrorichil/CVE-2025-49844](https://github.com/pedrorichil/CVE-2025-49844)

**漏洞详情:** [CVE-2025-49844](https://nvd.nist.gov/vuln/detail/CVE-2025-49844)