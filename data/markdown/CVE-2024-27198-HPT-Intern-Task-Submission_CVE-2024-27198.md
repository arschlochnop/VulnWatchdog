## CVE-2024-27198 TeamCity 身份验证绕过

**漏洞编号:** CVE-2024-27198

**漏洞类型:** 身份验证绕过

**影响应用:** JetBrains TeamCity

**危害等级:** 高危，允许未授权用户执行管理操作，可能导致数据泄露和远程代码执行

**影响版本:** < 2023.11.4

**利用条件:** 需要网络访问TeamCity服务器

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-27198 是 JetBrains TeamCity 中存在的身份验证绕过漏洞。该漏洞位于 `web-openapi.jar` 库的 `jetbrains.buildServer.controllers.BaseController` 类中。具体来说，`updateViewIfRequestHasJspParameter` 方法在处理请求时存在缺陷，允许攻击者通过操纵 `jsp` 请求参数来绕过身份验证。 

**利用方式：**

1.  构造一个不以 `.jsp` 结尾的 URL，例如 `/random_string`。
2.  在该 URL 中添加 `jsp` 请求参数，并将其值设置为以 `.jsp` 结尾但不包含 `/admin` 的值，例如 `random_string?jsp=anything.jsp`。
3.  如果 `modelAndView` 对象的视图名称与 `jsp` 参数的值不同，则 `modelAndView` 的视图名称将被更新为 `jsp` 参数的值。
4.  通过这种方式，攻击者可以访问 TeamCity REST API 中的敏感资源，例如 `/app/rest/server`，而无需进行身份验证。

**有效性：**

提供的漏洞利用代码解释了漏洞原理，并描述了如何构造恶意 URL 以绕过身份验证。根据漏洞库信息和POC代码分析，该漏洞利用有效。

**投毒风险：**

分析提供的POC代码主要为漏洞分析文档，描述了漏洞的原理和利用方法。由于代码较为简单，主要为描述性的JAVA代码段，直接执行的脚本较少。但是由于其中包含了一些Github的链接，如果用户下载了非官方来源的EXP并执行，可能存在一定风险。 因此，投毒风险评估为10%。

**项目地址:** [HPT-Intern-Task-Submission/CVE-2024-27198](https://github.com/HPT-Intern-Task-Submission/CVE-2024-27198)

**漏洞详情:** [CVE-2024-27198](https://nvd.nist.gov/vuln/detail/CVE-2024-27198)