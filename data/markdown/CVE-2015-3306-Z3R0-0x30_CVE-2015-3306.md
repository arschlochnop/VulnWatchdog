## CVE-2015-3306-ProFTPD-mod_copy任意文件读写

**漏洞编号:** CVE-2015-3306

**漏洞类型:** 任意文件读写

**影响应用:** ProFTPD

**危害等级:** 高危，可能导致信息泄露和远程代码执行

**影响版本:** 1.3.5

**利用条件:** 需要mod_copy模块启用，以及对ProFTPD服务器的网络访问。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2015-3306漏洞存在于ProFTPD 1.3.5版本的mod_copy模块中。攻击者可以通过`SITE CPFR`和`SITE CPTO`命令，实现任意文件的读取和写入。 

**有效性:**

根据漏洞库信息、搜索结果以及提供的漏洞利用代码，可以判断该漏洞是真实有效的。漏洞利用代码 `Z3R0_ProFTPexploit.py` 提供了一种可行的攻击方法，利用 `SITE CPFR` 和 `SITE CPTO` 命令将SSH私钥复制到目标服务器的指定目录，从而可能实现SSH登录。

**投毒风险:**

对提供的Python代码进行分析，发现以下几点潜在的投毒风险：

1.  **依赖外部命令：** 代码中使用了 `os.system` 函数执行外部命令 `mkdir` 和 `mount`。虽然这些命令本身功能明确，但攻击者可能通过修改传递给 `os.system` 的参数，来执行恶意命令。例如，虽然这里的mount命令的目的是挂载远程目录，但如果目标系统已经存在一个恶意的挂载点，这个操作可能会被利用。
2. **SSH Key路径硬编码**: 脚本要求指定SSH私钥的完整路径, 这意味着攻击者需要知道目标服务器的SSH配置。
3. **mount命令参数**: `os.system("sudo mount " + server + ":/var /mnt/testdir")`  这行代码尝试挂载服务器的`/var`目录到本地`/mnt/testdir`。如果服务器配置不当，或者用户权限足够，攻击者可能通过挂载其他敏感目录(例如`/root`)来获取更多信息。

综合以上分析，认为存在**10%**的投毒风险。主要风险在于攻击者可以利用代码中的外部命令执行，在特定环境下实现恶意操作，但总体来说，该代码的目的是为了实现利用，而不是进行大规模的恶意投毒。

**利用方式:**

1.  **漏洞触发：** 攻击者需要连接到目标ProFTPD服务器，并发送`SITE CPFR`命令指定源文件，然后发送`SITE CPTO`命令指定目标文件。
2.  **任意文件读写：** 通过`SITE CPFR`和`SITE CPTO`命令，攻击者可以读取服务器上的任意文件，并将文件写入到服务器上的任意位置（受限于ProFTPD进程的权限）。
3.  **权限提升 (示例代码)：** 示例代码利用该漏洞将攻击者的SSH私钥复制到目标服务器的某个目录（脚本中的`directory`变量指定），从而实现SSH登录，进而控制目标服务器。
4.  **其他利用方式：** 攻击者可以写入恶意脚本到Web服务器的目录，然后通过Web访问触发脚本执行，实现远程代码执行；或者修改系统配置文件，破坏系统功能。


**项目地址:** [Z3R0-0x30/CVE-2015-3306](https://github.com/Z3R0-0x30/CVE-2015-3306)

**漏洞详情:** [CVE-2015-3306](https://nvd.nist.gov/vuln/detail/CVE-2015-3306)