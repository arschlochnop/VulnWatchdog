## CVE-2020-7247 - OpenSMTPD 远程代码执行

**漏洞编号:** CVE-2020-7247

**漏洞类型:** 远程代码执行

**影响应用:** OpenSMTPD

**危害等级:** 高危，允许远程攻击者以 root 权限执行任意命令

**影响版本:** 6.6

**利用条件:** 需要目标系统运行存在漏洞的 OpenSMTPD 6.6，并且使用未注释的默认配置。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2020-7247 存在于 OpenSMTPD 6.6 的 smtp_session.c 文件的 smtp_mailaddr 函数中。由于输入验证不正确，允许远程攻击者通过构造恶意的 SMTP 会话，在 MAIL FROM 字段中注入 shell 元字符，从而以 root 权限执行任意命令。该漏洞影响使用"未注释的"默认配置的 OpenSMTPD 实例。

**漏洞利用方式：**

1.  攻击者建立与 OpenSMTPD 服务器的 SMTP 连接。
2.  攻击者在 `MAIL FROM` 命令中注入包含 shell 元字符的恶意地址。由于 `smtp_mailaddr` 函数未能正确验证输入，这些元字符会被传递到后续的 mail.local 进程。
3.  OpenSMTPD 在执行 MDA 命令时，会将 `MAIL FROM` 字段的内容传递给 `/usr/libexec/mail.local` 命令，造成命令注入。
4.  攻击者利用命令注入执行任意 shell 命令，由于 mail.local 以 root 权限运行，攻击者可以获得 root 权限。

**有效性：**

提供的 POC 代码库包含利用此漏洞所需的所有必要组件，例如安装易受攻击服务器的脚本和自动化漏洞利用脚本。 鉴于漏洞库信息、搜索结果以及POC中包含手动利用步骤描述，提供的POC代码有效。

**投毒风险：**

提供的 README.md 文件中包含用于设置和利用 CVE-2020-7247 的代码和配置，声明仅用于测试目的，而非滥用。但是，代码仓库的创建者可能会添加不易察觉的恶意代码。虽然无法完全确定是否存在投毒风险，但考虑到 POC 的性质，以及开发者声明，投毒风险较低。考虑到POC验证可能存在后门代码，因此判定投毒的概率较低，为1%。

**项目地址:** [SimonSchoeni/CVE-2020-7247-POC](https://github.com/SimonSchoeni/CVE-2020-7247-POC)

**漏洞详情:** [CVE-2020-7247](https://nvd.nist.gov/vuln/detail/CVE-2020-7247)