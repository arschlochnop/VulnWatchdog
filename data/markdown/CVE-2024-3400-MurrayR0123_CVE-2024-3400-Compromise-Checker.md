## CVE-2024-3400 PAN-OS GlobalProtect 命令注入

**漏洞编号:** CVE-2024-3400

**漏洞类型:** 命令注入

**影响应用:** PAN-OS GlobalProtect

**危害等级:** 高危，未授权的攻击者可以以 root 权限执行任意代码

**影响版本:** PAN-OS 10.2 (低于 10.2.9-h1), PAN-OS 11.0 (低于 11.0.4-h1), PAN-OS 11.1 (低于 11.1.2-h3)

**利用条件:** 需要目标系统配置了 GlobalProtect 网关或 GlobalProtect 门户，无需启用设备遥测。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-3400 是 Palo Alto Networks PAN-OS 软件 GlobalProtect 功能中的一个命令注入漏洞，源于任意文件创建漏洞。未经身份验证的攻击者可以利用此漏洞在防火墙上以 root 权限执行任意代码。

**有效性：**
根据漏洞库信息和搜索结果，该漏洞已在野外被利用，并且存在公开可用的 PoC。提供的 `cve-2024-3400_checker.sh` 脚本并非直接的漏洞利用代码，而是用于检测目标系统是否已经被入侵，该脚本通过检查web服务器日志、恶意文件和可疑的计划任务等方式进行检测。

**投毒风险：**
该脚本本身旨在检测漏洞利用后的痕迹，而非利用漏洞。虽然脚本本身不会直接执行恶意操作，但仍有很小的风险：
*   **误报：** 脚本可能会因为某些特征与恶意行为相似而产生误报，导致不必要的恐慌。
*   **信息泄露：** 脚本运行时会读取系统日志和配置文件，如果脚本被恶意修改，可能会泄露敏感信息。
因此，投毒风险估计为 10%。

**利用方式：**
根据漏洞信息描述和搜索结果，攻击者利用此漏洞通常涉及以下步骤：
1.  **利用任意文件创建漏洞：** 攻击者首先利用漏洞在目标系统上创建任意文件。
2.  **命令注入：**  通过精心构造的文件内容，攻击者可以注入恶意命令。
3.  **以 root 权限执行代码：** 注入的命令以 root 权限执行，攻击者从而完全控制受影响的系统。

根据Volexity的分析报告，攻击者可能还会使用Upstyle后门进行持久化控制。
检测脚本中的检测点也反映了这些攻击特征，例如检测`/var/lib/python3.6/site-packages/system.pth`中是否包含base64编码的恶意代码，以及检查/tmp目录下是否存在创建GlobalProtect相关目录或下载执行恶意脚本的行为。


**项目地址:** [MurrayR0123/CVE-2024-3400-Compromise-Checker](https://github.com/MurrayR0123/CVE-2024-3400-Compromise-Checker)

**漏洞详情:** [CVE-2024-3400](https://nvd.nist.gov/vuln/detail/CVE-2024-3400)