## CVE-2022-29464 - WSO2 任意文件上传导致远程代码执行

**漏洞编号:** CVE-2022-29464

**漏洞类型:** 任意文件上传

**影响应用:** WSO2 产品

**危害等级:** 高危，可导致远程代码执行

**影响版本:** WSO2 API Manager 2.2.0 up to 4.0.0, WSO2 Identity Server 5.2.0 up to 5.11.0, WSO2 Identity Server Analytics 5.4.0, 5.4.1, 5.5.0 and 5.6.0, WSO2 Identity Server as Key Manager 5.3.0 up to 5.11.0, WSO2 Enterprise Integrator 6.2.0 up to 6.6.0, WSO2 Open Banking AM 1.4.0 up to 2.0.0 and WSO2 Open Banking KM 1.4.0, up to 2.0.0.

**利用条件:** 目标服务器存在fileupload端点且未进行严格的文件类型和路径校验

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-29464 是一个存在于多个 WSO2 产品中的高危漏洞，它允许未经授权的攻击者通过 `/fileupload` 端点上传任意文件，最终导致远程代码执行。该漏洞的利用方式是通过构造包含目录穿越序列的 `Content-Disposition` 头，将恶意 JSP 文件上传到 Web 根目录下的可访问位置，如 `repository/deployment/server/webapps` 目录。上传的 JSP 文件包含执行任意命令的代码。根据提供的漏洞利用代码 `exploit.py`，该脚本通过 POST 请求向目标服务器的 `/fileupload/toolsAny` 端点上传一个包含恶意代码的 JSP 文件。攻击者可以通过访问上传的 JSP 文件来执行任意命令。例如，脚本会将包含一个表单的 JSP shell 上传到 `/authenticationendpoint` 应用目录下。 该代码看起来是直接利用漏洞，没有发现隐藏的恶意代码或者后门，所以投毒风险评估为0%。 搜索引擎结果也表明该漏洞已被广泛利用，并建议用户尽快更新或采取缓解措施。

**项目地址:** [hupe1980/CVE-2022-29464](https://github.com/hupe1980/CVE-2022-29464)

**漏洞详情:** [CVE-2022-29464](https://nvd.nist.gov/vuln/detail/CVE-2022-29464)