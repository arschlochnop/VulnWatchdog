## CVE-2023-21554-Microsoft Message Queuing (MSMQ) 远程代码执行漏洞

**漏洞编号:** CVE-2023-21554

**漏洞类型:** 远程代码执行

**影响应用:** Microsoft Message Queuing (MSMQ)

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 受影响的Windows版本范围广泛，具体参见漏洞库信息

**利用条件:** 目标系统需要启用MSMQ服务并且攻击者能够通过网络访问MSMQ服务端口（默认1801）

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-21554 是一个 Microsoft Message Queuing (MSMQ) 远程代码执行漏洞。攻击者可以通过向 MSMQ 服务发送特制的恶意消息来触发此漏洞，从而在目标系统上执行任意代码。

**有效性：**
提供的POC代码看起来有效。它模拟了MSMQ协议的交互过程，包括建立连接、发送连接参数、用户消息和会话确认。代码从二进制文件中读取数据，并发送到目标IP地址的1801端口。用户可以通过修改`user_message.bin`文件中的数据来尝试不同的攻击载荷。

**投毒风险：**
POC代码本身主要功能是发送预定义的二进制数据包，初步判断高危恶意投毒的可能性较低。
*   **低风险：**代码主要功能是读取预定义的二进制文件并发送它们。虽然这些文件本身可能是恶意的，但脚本本身并没有明显包含恶意代码（如下载并执行任意代码）。
*   **中等风险：**作者可能在`establish_connection.bin`，`connection_parameters.bin`，`user_message.bin`和 `session_acknowledgment.bin`这些二进制文件中植入恶意代码。攻击者可能利用这些文件进行恶意攻击，例如，user_message.bin 可能包含触发漏洞的特定有效载荷。
*   **需要注意的地方：**代码中有部分注释，如`data[0x5e] = i`和`data[0x5f] = 0xff`，表明攻击者可以修改`user_message.bin`的内容。如果这些修改用于执行恶意代码，则存在潜在风险。

总而言之，虽然此脚本直接包含后门代码的风险较低，但它为潜在的恶意利用程序提供了框架。因此，考虑到二进制文件可能被篡改植入恶意payload，代码存在10%的投毒风险。

**利用方式：**
1.  **环境准备：** 确保目标系统上运行着易受攻击的MSMQ服务版本，并且攻击者可以通过网络访问其1801端口。
2.  **准备恶意消息：** 准备包含恶意载荷的`establish_connection.bin`, `connection_parameters.bin`, `user_message.bin`和`session_acknowledgment.bin`文件。通常，`user_message.bin`是放置攻击载荷的常见位置。
3.  **运行POC脚本：** 运行提供的POC脚本，将目标IP地址作为输入。脚本将按照MSMQ协议顺序发送数据包。
4.  **触发漏洞：** 如果`user_message.bin`中的载荷成功利用了漏洞，则可以在目标系统上执行任意代码。

**缓解措施：**
*   应用Microsoft提供的安全补丁。
*   如果不需要，禁用MSMQ服务。
*   限制对MSMQ服务的网络访问。
*   使用网络入侵检测系统(NIDS)监控MSMQ流量中是否存在恶意模式。

**项目地址:** [Rahul-Thakur7/CVE-2023-21554](https://github.com/Rahul-Thakur7/CVE-2023-21554)

**漏洞详情:** [CVE-2023-21554](https://nvd.nist.gov/vuln/detail/CVE-2023-21554)