## CVE-2019-16278-nostromo nhttpd-目录遍历导致远程代码执行

**漏洞编号:** CVE-2019-16278

**漏洞类型:** 目录遍历导致远程代码执行

**影响应用:** nostromo nhttpd

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** <= 1.9.6

**利用条件:** 目标服务器运行nostromo nhttpd 1.9.6或更早版本，且允许外部网络访问。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2019-16278是nostromo nhttpd 1.9.6及更早版本中`http_verify`函数存在的一个目录遍历漏洞，允许攻击者通过构造特殊的HTTP请求实现远程代码执行。 

**有效性分析：**

*   漏洞库信息明确指出该漏洞为目录遍历，可以导致远程代码执行。
*   搜索引擎结果中多个来源（NVD、CVE Details、Exploit-DB等）确认了该漏洞的存在及其危害。
*   提供的POC代码是用Rust编写的，通过发送包含目录遍历字符（`/.%0d./`）的POST请求到`/bin/sh`来执行命令。其中`%0d`是回车符的URL编码，用于绕过一些安全检查。
*   POC代码的`exploit.rs`文件构造了恶意HTTP请求，将目标IP、端口和要执行的命令作为参数传入。该请求利用目录遍历漏洞，最终将命令传递给`/bin/sh`执行。`main.rs`文件解析命令行参数并调用`exploit.rs`中的函数。
*   POC代码的README.md文件提供了使用示例，进一步验证了漏洞的可利用性。
*  综合来看，提供的POC代码是有效的，可以直接利用该漏洞实现远程代码执行。

**投毒风险分析：**

*   查看了`Cargo.lock`、`Cargo.toml`、`README.md`、`src/exploit.rs`和`src/main.rs`文件的内容。
*   代码逻辑相对简单，主要是构造HTTP请求和处理网络连接。
*   没有发现明显的恶意代码或后门。
*   `Cargo.toml`中依赖了`anyhow` crate，该crate是一个通用的错误处理库，本身没有安全风险。
*   尽管如此，在实际使用任何第三方代码之前，都应该进行代码审计，以确保没有潜在的风险。
*   评估的投毒风险较低，约为1%。

**利用方式总结：**

1.  攻击者首先需要确定目标服务器正在运行存在漏洞的nostromo nhttpd版本（<= 1.9.6）。
2.  攻击者构造包含目录遍历字符的恶意HTTP POST请求，指向`/bin/sh`。
3.  在POST请求的body中包含需要执行的命令。
4.  服务器的`http_verify`函数在处理请求时，由于目录遍历漏洞，会将请求传递给`/bin/sh`执行。
5.  攻击者从而实现远程代码执行，控制目标服务器。

**项目地址:** [keshiba/cve-2019-16278](https://github.com/keshiba/cve-2019-16278)

**漏洞详情:** [CVE-2019-16278](https://nvd.nist.gov/vuln/detail/CVE-2019-16278)