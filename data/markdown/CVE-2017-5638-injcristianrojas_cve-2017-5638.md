## CVE-2017-5638-Apache Struts2-远程代码执行

**漏洞编号:** CVE-2017-5638

**漏洞类型:** 远程代码执行

**影响应用:** Apache Struts2

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** 2.3.x before 2.3.32 和 2.5.x before 2.5.10.1

**利用条件:** 需要目标系统运行存在漏洞版本的Apache Struts2，并且接受HTTP请求。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2017-5638 是 Apache Struts2 中的一个远程代码执行漏洞，存在于 Jakarta Multipart parser 中。当 Struts2 尝试处理文件上传时，如果 Content-Type、Content-Disposition 或 Content-Length HTTP 头部被恶意构造，将导致异常处理和错误消息生成过程出现问题，进而允许攻击者执行任意命令。

**漏洞利用方式：**

漏洞利用主要通过构造恶意的 Content-Type 头部，其中包含 OGNL 表达式。 OGNL（Object-Graph Navigation Language）是一种强大的表达式语言，用于访问和操作 Java 对象的属性。 攻击者通过在 Content-Type 头部中注入恶意的 OGNL 表达式，利用 Struts2 在解析请求时的漏洞，执行任意系统命令。

提供的漏洞利用代码包含两个 Python 脚本 (exploit1.py 和 exploit2.py)。

*   **exploit1.py:**  尝试通过在 Content-Type 中注入 OGNL 表达式，添加一个名为 "PWNED" 的 HTTP 头部，其值为 1337。这可以用来验证漏洞是否存在。
*   **exploit2.py:**  允许攻击者指定要执行的命令。 它构造一个更复杂的 OGNL 表达式，绕过某些安全限制，并使用 `java.lang.ProcessBuilder` 执行指定的命令，然后将命令的输出返回到 HTTP 响应中。

**有效性：**

根据漏洞库信息和搜索引擎结果，此漏洞已经被广泛利用，提供的 POC 代码与已知的攻击方式一致，因此可以判断 POC 代码有效。

**投毒风险：**

提供的代码仓库包含一个 Jenkinsfile, 用于通过OWASP Dependency Check Plugin进行依赖检查, 这本身不属于投毒行为。 exploit1.py 和 exploit2.py 是利用漏洞的代码，也不构成投毒。仓库结构和代码内容来看，存在恶意投毒的可能性较低，约 5% 的可能性在于作者可能在其他未展示的文件中隐藏恶意代码，或者存在依赖污染的风险。总体而言，直接利用该仓库进行投毒的可能性较低，但仍需谨慎使用，建议在使用前进行详细的代码审计。

**项目地址:** [injcristianrojas/cve-2017-5638](https://github.com/injcristianrojas/cve-2017-5638)

**漏洞详情:** [CVE-2017-5638](https://nvd.nist.gov/vuln/detail/CVE-2017-5638)