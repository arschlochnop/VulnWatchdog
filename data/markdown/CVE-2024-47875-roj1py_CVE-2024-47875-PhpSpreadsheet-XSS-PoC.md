## CVE-2024-47875-PhpSpreadsheet-XSS

**漏洞编号:** CVE-2024-47875

**漏洞类型:** 跨站脚本攻击(XSS)

**影响应用:** PhpSpreadsheet

**危害等级:** 高危，可能导致用户信息泄露、会话劫持和恶意代码执行

**影响版本:** < 2.2.2, < 2.1.2, < 1.29.4

**利用条件:** 需要目标应用使用受影响版本的PhpSpreadsheet，并且允许上传XLSX文件并将其转换为HTML

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于PhpSpreadsheet的generateNavigation()函数中，当把包含多个sheet的XLSX文件转换为HTML时，sheet的名字没有被合理地过滤，导致XSS漏洞。

**有效性：**

根据漏洞信息和POC代码，该漏洞利用方式有效。POC代码能够生成包含恶意JavaScript代码的XLSX文件，上传后，当PhpSpreadsheet处理该文件并转换为HTML时，恶意代码会被执行。

**投毒风险：**

分析POC代码，发现该代码主要功能是生成恶意XLSX文件，并提供了一些辅助功能，如HTTP服务器用于捕获回调数据。主要的风险在于，攻击者可以修改`exploit.py`中的payload，执行更具破坏性的操作，例如，窃取敏感信息、劫持用户会话或进行恶意重定向。代码中没有明显的后门或恶意行为，但用户需要仔细审查payload部分，确保符合预期。综上所述，该仓库存在一定的投毒风险，但风险较低（约10%）。

**利用方式：**

1.  攻击者使用POC脚本生成恶意的XLSX文件，文件中包含XSS payload。
2.  攻击者将恶意的XLSX文件上传到目标应用。
3.  当目标应用使用PhpSpreadsheet将XLSX文件转换为HTML时，由于没有充分过滤sheet名称，XSS payload会被注入到生成的HTML页面中。
4.  当用户访问包含XSS payload的HTML页面时，恶意JavaScript代码会在用户的浏览器中执行。
5.  恶意代码可以窃取用户的cookie、将用户重定向到恶意网站、执行键盘记录等操作。

**项目地址:** [roj1py/CVE-2024-47875-PhpSpreadsheet-XSS-PoC](https://github.com/roj1py/CVE-2024-47875-PhpSpreadsheet-XSS-PoC)

**漏洞详情:** [CVE-2024-47875](https://nvd.nist.gov/vuln/detail/CVE-2024-47875)