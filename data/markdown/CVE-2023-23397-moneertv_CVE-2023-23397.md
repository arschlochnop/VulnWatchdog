## CVE-2023-23397-Microsoft Outlook 权限提升漏洞

**漏洞编号:** CVE-2023-23397

**漏洞类型:** 权限提升

**影响应用:** Microsoft Outlook

**危害等级:** 高危，可能导致NTLM Relay攻击

**影响版本:** 受影响版本包括Microsoft Outlook 2013 SP1, 2016, 2019, Office LTSC 2021, Microsoft 365 Apps for Enterprise等，具体版本范围参考漏洞库信息。

**利用条件:** 攻击者需要向受害者发送包含恶意构造属性的邮件或日历邀请。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-23397是一个Microsoft Outlook权限提升漏洞，攻击者可以利用此漏洞发动NTLM Relay攻击。漏洞原理是Outlook在处理邮件或日历邀请时，会读取某些属性（如PidLidReminderFileParameter）中指定的UNC路径，并尝试进行NTLM身份验证。攻击者可以将此路径设置为指向攻击者控制的服务器，当Outlook尝试连接该服务器时，会将用户的NTLM哈希发送给攻击者。攻击者可以使用此哈希进行NTLM Relay攻击，冒充受害者访问网络资源。

**有效性：** 根据漏洞库信息，该漏洞已被积极利用，POC代码的存在进一步证实了其有效性。

**投毒风险：** 提供的代码片段`/tmp/a829982ba7bdb2d91914433ccf5b5a1f/Appointment.cs`是创建Outlook Appointment的C#代码，来自MsgKit库，用于创建.msg文件。粗略判断，此文件中直接包含明显恶意代码（如反弹shell，恶意下载执行等）的可能性较低。但仍存在一定的投毒风险，例如：

1.  **微妙的属性设置：** 攻击者可能在代码中添加不易察觉的属性设置，例如在`NamedProperties.AddProperty`中插入指向恶意服务器的UNC路径，从而触发漏洞，或者添加其他隐蔽的属性修改，利用其他未知的Outlook特性进行攻击。
2.  **依赖项风险：** 该代码依赖于MsgKit库和OpenMcdf库。这些依赖库本身可能存在漏洞或被植入后门。
3. **编译器和构建过程** 攻击者可能篡改编译配置，引入外部恶意代码

基于代码片段的初步分析，投毒风险较低，但需要更全面的代码审查和依赖项分析才能确定是否存在隐藏的恶意代码，因此给出10%的投毒风险。

**利用方式：**

1.  攻击者构造包含恶意`PidLidReminderFileParameter`或其他相关属性的邮件或日历邀请。
2.  受害者使用受影响版本的Outlook打开该邮件或日历邀请。
3.  Outlook尝试连接恶意UNC路径，并将受害者的NTLM哈希发送到攻击者控制的服务器。
4.  攻击者使用收到的NTLM哈希进行NTLM Relay攻击。

**修复建议：**

*   及时安装Microsoft官方发布的补丁。
*   限制Outlook对外部UNC路径的访问。
*   使用强身份验证方式，例如多因素身份验证，以降低NTLM Relay攻击的风险。

**项目地址:** [moneertv/CVE-2023-23397](https://github.com/moneertv/CVE-2023-23397)

**漏洞详情:** [CVE-2023-23397](https://nvd.nist.gov/vuln/detail/CVE-2023-23397)