## CVE-2023-41892-Craft CMS-远程代码执行

**漏洞编号:** CVE-2023-41892

**漏洞类型:** 远程代码执行

**影响应用:** Craft CMS

**危害等级:** 高危，允许未授权远程代码执行

**影响版本:** >= 4.0.0-RC1, <= 4.4.14

**利用条件:** 目标Craft CMS版本在受影响范围内，且未打补丁，需要网络访问。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-41892 存在于 Craft CMS 中，是一个远程代码执行漏洞。根据漏洞库信息和搜索引擎结果，该漏洞影响 Craft CMS 4.0.0-RC1 到 4.4.14 版本。攻击者可以通过发送特制的请求来利用此漏洞，在目标服务器上执行任意代码。\n\n**利用方式：**\n\n1.  **信息收集：** 首先，攻击者需要确定目标 Craft CMS 的版本是否在受影响范围内。\n2.  **上传临时文件：** 该漏洞利用链首先利用了 Imagick 组件处理图像时的MSL文件，在临时目录写入包含恶意PHP代码的文件。exploit.py脚本首先通过访问一个特殊的URL（触发phpinfo()）来获取`upload_tmp_dir`和`DOCUMENT_ROOT`。如果`upload_tmp_dir`不存在，则使用`/tmp`目录。\n3.  **写入webshell:** 之后，利用MSL文件将webshell写入`DOCUMENT_ROOT`目录下。\n4.  **代码执行：**  攻击者通过访问webshell文件,并携带`cmd`参数来执行任意的系统命令。该POC脚本使用base64编码命令，以绕过潜在的过滤。\n5.  **反弹shell：** POC代码中包含了反弹 shell 的功能，允许攻击者在成功利用漏洞后获得对目标系统的控制权。\n\n**投毒风险分析：**\n\n虽然提供的POC代码主要功能是利用漏洞实现远程代码执行，但是仍然存在一定的投毒风险。例如，攻击者可能会修改POC代码，在反弹 shell 之外执行其他恶意操作，例如安装后门、窃取敏感信息等。此外，POC代码本身依赖于未授权的远程代码执行，如果被滥用，可能对目标系统造成严重损害。经过代码分析，作者在代码中添加额外后门的可能性较低，主要风险在于代码本身被用于非法用途。 该`exploit.py`脚本没有明显的恶意代码，它的目的是利用已知的RCE漏洞。代码尝试找到临时上传目录和web根目录，然后上传一个PHP文件，该文件允许执行传递给它的命令。最后，它使用该文件来删除临时文件并反弹一个shell。尽管此代码本身没有恶意，但它的确会被用于恶意目的。因此，投毒风险较低，但存在误用的可能。

**项目地址:** [diegaccio/Craft-CMS-Exploit](https://github.com/diegaccio/Craft-CMS-Exploit)

**漏洞详情:** [CVE-2023-41892](https://nvd.nist.gov/vuln/detail/CVE-2023-41892)