## CVE-2018-6574 - Go "go get" 远程命令执行

**漏洞编号:** CVE-2018-6574

**漏洞类型:** 远程代码执行

**影响应用:** Go

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** Go before 1.8.7, Go 1.9.x before 1.9.4, and Go 1.10 pre-releases before Go 1.10rc2

**利用条件:** 目标系统需要运行受影响的Go版本，并且执行`go get`命令获取恶意代码仓库

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2018-6574 漏洞允许攻击者通过 `go get` 命令执行任意代码。该漏洞源于 Go 在构建过程中没有正确过滤 gcc 或 clang 的插件参数（`-fplugin=` 和 `-plugin=`）。攻击者可以构造包含恶意 `C` 代码的 Go 项目，利用 `cgo` 特性，在 `go get` 下载并构建该项目时，`C` 代码会被编译并执行，从而实现远程命令执行。

**有效性：**
提供的 POC 代码有效。它包含一个 `exploit.c` 文件，其中定义了一个 `malicious()` 函数，该函数使用 `system()` 函数执行命令 `/usr/local/bin/score 3f9f4915-ab08-4227-9eba-830c2b3ac417`。`__attribute__((constructor))` 确保 `malicious()` 函数在加载动态链接库时自动执行。
`main.go` 文件使用 `cgo` 特性，将 `exploit.so` 作为插件编译到 Go 程序中。当 `go get` 获取并构建这个项目时，`exploit.c` 会被编译成动态链接库，并在程序加载时执行 `malicious()` 函数，从而执行预定的恶意命令。

**投毒风险：**
根据提供的代码，投毒风险为 0%。`exploit.c` 中执行的命令 `/usr/local/bin/score 3f9f4915-ab08-4227-9eba-830c2b3ac417` 明确定义，没有发现隐藏的恶意代码或者其他未知的行为。此仓库只是作为POC验证，触发执行的是给定的命令。

**利用方式：**
1.  **创建恶意 Go 项目：** 攻击者创建一个包含 `exploit.c` 和 `main.go` 文件的 Go 项目。`exploit.c` 包含要执行的恶意代码，`main.go` 使用 `cgo` 特性加载 `exploit.so`。
2.  **托管恶意项目：** 将恶意 Go 项目托管在公共代码仓库（例如 GitHub）上。
3.  **诱导受害者执行 `go get`：** 攻击者诱导受害者在其系统上执行 `go get <恶意项目URL>` 命令。
4.  **远程命令执行：** 当受害者执行 `go get` 命令时，Go 会下载并构建恶意项目。构建过程中，`exploit.c` 会被编译并执行，从而在受害者系统上执行攻击者预设的恶意命令。

**项目地址:** [memmas/CVE-2018-6574](https://github.com/memmas/CVE-2018-6574)

**漏洞详情:** [CVE-2018-6574](https://nvd.nist.gov/vuln/detail/CVE-2018-6574)