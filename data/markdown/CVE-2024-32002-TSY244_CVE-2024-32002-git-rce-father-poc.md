## CVE-2024-32002-Git-远程代码执行

**漏洞编号:** CVE-2024-32002

**漏洞类型:** 远程代码执行

**影响应用:** Git

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** 受影响版本包括：< 2.39.4, >= 2.40.0, < 2.40.2, = 2.41.0, >= 2.42.0, < 2.42.2, >= 2.43.0, < 2.43.4, = 2.44.0, = 2.45.0

**利用条件:** 目标服务器需要安装受影响的Git版本，且文件系统区分大小写并支持符号链接，需要克隆包含恶意子模块的仓库

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-32002 漏洞存在于 Git 的子模块处理中。攻击者可以构造恶意的 Git 仓库，其中包含一个带有恶意配置的子模块。当用户递归克隆这个仓库时，Git 会将恶意文件写入 `.git/` 目录，而不是子模块的工作目录，导致可以执行恶意的 hook 脚本，实现远程代码执行。

**有效性：**
提供的 POC 代码是一个 `post-checkout` hook 脚本，它会在 `git checkout` 操作后执行。脚本的内容是将 "amal_was_here" 写入 `/tmp/pwnd` 文件，并且打开计算器程序。如果目标系统成功执行了这个脚本，就可以证明该漏洞的有效性。

**投毒风险：**
POC 代码本身不包含明显的投毒行为，它只是一个简单的示例，用于验证漏洞的存在。但是，考虑到漏洞利用方式，攻击者可以修改 hook 脚本，使其包含更具破坏性的恶意代码。例如，可以执行系统命令、窃取敏感信息或者植入后门。因此，从远程仓库克隆代码时，始终存在一定的风险。
投毒风险评估为 10%，因为这个示例代码更像是概念验证，而非恶意利用，但实际攻击中，攻击者完全可以将hook脚本编写为恶意的脚本。

**利用方式：**
1.  攻击者创建一个包含恶意子模块的 Git 仓库。
2.  子模块的 `.gitmodules` 文件中包含指向恶意仓库的 URL。
3.  恶意仓库的 `hooks/post-checkout` 目录包含攻击者想要执行的恶意脚本。
4.  受害者递归克隆包含恶意子模块的 Git 仓库（例如，使用 `git clone --recurse-submodules` 命令）。
5.  Git 在克隆子模块时，会将恶意 hook 脚本写入 `.git/hooks` 目录。
6.  当执行 `git checkout` 操作时，恶意 hook 脚本被执行，导致远程代码执行。

**项目地址:** [TSY244/CVE-2024-32002-git-rce-father-poc](https://github.com/TSY244/CVE-2024-32002-git-rce-father-poc)

**漏洞详情:** [CVE-2024-32002](https://nvd.nist.gov/vuln/detail/CVE-2024-32002)