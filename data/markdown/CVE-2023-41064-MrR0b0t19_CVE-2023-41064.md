## CVE-2023-41064-ImageIO-WebP缓冲区溢出

**漏洞编号:** CVE-2023-41064

**漏洞类型:** 缓冲区溢出

**影响应用:** macOS, iOS, iPadOS ImageIO框架

**危害等级:** 高危，可能导致任意代码执行

**影响版本:** macOS < 11.7.10, macOS < 12.6.9, macOS < 13.5.2, iOS and iPadOS < 15.7.9, iOS and iPadOS < 16.6.1

**利用条件:** 需要用户处理恶意构造的WebP图像

**POC 可用性:** 是

**投毒风险:** 50%

## 详情

CVE-2023-41064 是 Apple ImageIO 框架中 WebP 图像处理相关的缓冲区溢出漏洞。当应用程序使用 ImageIO 处理恶意构造的 WebP 图像时，可能导致任意代码执行。

**有效性：**
提供的POC代码旨在创建一个包含特定头结构的空 WebP 文件。根据代码分析，它尝试通过操纵位写入操作（VP8LPutBits）和特定码长计数（code_lengths_counts）来触发漏洞。虽然代码本身并不能直接证明漏洞利用的成功，但它尝试构造一个畸形的 WebP 文件，这可能是利用此漏洞的第一步。搜索引擎结果显示，该漏洞已被积极利用，这表明创建恶意图像以触发漏洞是可能的。

**投毒风险：**
存在一定的投毒风险。虽然代码的主要功能是创建WebP文件，但是其中`subprocess.run(["hola_mundo.exe"])`这行代码会尝试执行一个外部程序`hola_mundo.exe`，而这个程序并不在提供的代码仓库中。这意味着用户如果直接使用此POC，可能会在不知情的情况下执行来自其他来源的恶意代码。此外，提供的README文件中提到“Este script se proporciona con fines educativos y no debe usarse con fines maliciosos o ilegales.”，这可能是一种免责声明，但同时也可能暗示该脚本的潜在危险性。同时作者名为“Fan_tasma”，也暗示有潜在风险。

**利用方式：**
1.  **恶意图像创建：** 攻击者构造一个恶意的 WebP 图像，该图像包含畸形的头部或编码数据，触发 ImageIO 框架中的缓冲区溢出。
2.  **用户交互：** 攻击者诱使用户使用存在漏洞的应用程序（例如，Safari、邮件应用）打开或处理该恶意图像。这可能通过网页、电子邮件或其他文件传输方式实现。
3.  **代码执行：** 当应用程序尝试解析该恶意图像时，缓冲区溢出漏洞被触发，允许攻击者覆盖内存并执行任意代码。`subprocess.run(["hola_mundo.exe"])`这行代码可能是利用成功后执行payload。因此，利用方式的核心在于构造特殊的WebP图像，并诱导用户打开。

**项目地址:** [MrR0b0t19/CVE-2023-41064](https://github.com/MrR0b0t19/CVE-2023-41064)

**漏洞详情:** [CVE-2023-41064](https://nvd.nist.gov/vuln/detail/CVE-2023-41064)