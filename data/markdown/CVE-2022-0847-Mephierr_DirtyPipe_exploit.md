## CVE-2022-0847 (Dirty Pipe) Local Privilege Escalation

**漏洞编号:** CVE-2022-0847

**漏洞类型:** 本地权限提升

**影响应用:** Linux Kernel

**危害等级:** 高危，可获取root权限

**影响版本:** Linux Kernel 5.17 rc6及之前版本

**利用条件:** 本地用户访问权限

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-0847，又名Dirty Pipe，是一个Linux内核中的本地权限提升漏洞。该漏洞允许非特权用户覆盖只读文件，从而可能提升权限。漏洞原因是Linux内核在处理管道缓冲区时，没有正确初始化`flags`成员。**有效性：**提供的POC代码尝试利用此漏洞修改`/etc/passwd`文件来修改root密码，这是一个典型的Dirty Pipe漏洞利用方式。根据搜索结果，该漏洞的利用代码是可靠的，可以在受影响的系统上获得root权限。POC代码首先备份`/etc/passwd`，然后创建一个管道，利用`splice`和`write`系统调用将恶意数据写入`/etc/passwd`文件的特定偏移处，从而修改root用户的密码。**投毒风险：**查看代码，该漏洞利用代码主要用于修改`/etc/passwd`文件以更改root密码，没有发现隐藏的恶意功能，例如安装后门或进行未经授权的远程访问。可以判定投毒风险为0%。**利用方式：**该漏洞的利用方式如下：
1.  **利用前提：**攻击者需要具有本地用户权限。
2.  **漏洞触发：**利用`pipe()`创建管道，并通过多次写入和读取操作，使管道缓冲区具有`PIPE_BUF_FLAG_CAN_MERGE`标志。
3.  **数据注入：**使用`splice()`将只读文件中的一小部分数据复制到管道中。然后，利用`write()`将恶意数据写入管道，由于`PIPE_BUF_FLAG_CAN_MERGE`标志的存在，这些数据将被写入到只读文件对应的page cache中，从而覆盖文件内容。
4.  **权限提升：**通过覆盖`/etc/passwd`等敏感文件，攻击者可以修改用户密码或者添加具有root权限的用户，最终实现权限提升。

**项目地址:** [Mephierr/DirtyPipe_exploit](https://github.com/Mephierr/DirtyPipe_exploit)

**漏洞详情:** [CVE-2022-0847](https://nvd.nist.gov/vuln/detail/CVE-2022-0847)