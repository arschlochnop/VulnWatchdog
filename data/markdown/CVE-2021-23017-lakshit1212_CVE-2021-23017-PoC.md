## CVE-2021-23017-Nginx Resolver 内存覆盖漏洞

**漏洞编号:** CVE-2021-23017

**漏洞类型:** 内存覆盖

**影响应用:** Nginx Web Server, Nginx Plus

**危害等级:** 高危，可能导致worker进程崩溃或潜在的其他影响

**影响版本:** Nginx Web Server versions 0.6.18 thru 1.20.0 before 1.20.1, Nginx plus versions R13 thru R23 before R23 P1. Nginx plus version R24 before R24 P1

**利用条件:** 目标服务器开启了resolver且攻击者能够伪造来自DNS服务器的UDP数据包

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-23017是Nginx resolver中的一个安全问题，攻击者可以通过伪造来自DNS服务器的UDP数据包，造成1字节的内存覆盖，从而导致worker进程崩溃或其他潜在影响。

**有效性分析：**

根据漏洞库信息和搜索引擎结果，该漏洞是真实存在的，并且有公开的POC代码。提供的POC代码利用`scapy`库构造恶意DNS响应数据包，通过ARP欺骗拦截目标服务器的DNS请求，然后发送伪造的响应包，实现内存覆盖。

**投毒风险分析：**

阅读提供的POC代码，没有发现明显的投毒代码。代码主要功能是：

1.  `device_setup()`: 设置IP转发和阻止正常的DNS响应，确保攻击流量可以到达目标。
2.  `ARPP()`: 进行ARP欺骗，将目标和DNS服务器的流量劫持到攻击者的机器。
3.  `exploit()`: 监听目标服务器的DNS请求，并构造恶意的DNS响应。
4.  `process_received_packet()`: 接收到DNS请求后，构造包含恶意payload的DNS响应，该payload用于触发1字节内存覆盖。

代码中没有发现任何未经授权的恶意行为，例如反向shell、数据窃取等。因此，投毒风险为0%。

**利用方式：**

1.  **环境准备：** 攻击者需要能够监听目标服务器的网络流量，并且能够伪造来自DNS服务器的UDP数据包。通常需要进行ARP欺骗。
2.  **监听DNS请求：** 攻击者监听目标服务器发送的DNS请求。
3.  **构造恶意响应：** 收到DNS请求后，攻击者构造包含恶意payload的DNS响应。Payload的设计是为了触发Nginx resolver中的1字节内存覆盖漏洞。`poc.py`通过找到DNS请求中第一个空字节(0x00)的位置，截断原始请求并插入恶意数据。
4.  **发送恶意响应：** 攻击者将构造的恶意DNS响应发送给目标服务器，覆盖内存。
5.  **结果：** 内存覆盖可能导致worker进程崩溃或者其他未知的安全影响，例如拒绝服务。

该漏洞的成功利用依赖于攻击者能够进行中间人攻击，并能够伪造DNS响应。如果目标服务器使用了DNSSEC等安全机制，可以缓解此类攻击。

**项目地址:** [lakshit1212/CVE-2021-23017-PoC](https://github.com/lakshit1212/CVE-2021-23017-PoC)

**漏洞详情:** [CVE-2021-23017](https://nvd.nist.gov/vuln/detail/CVE-2021-23017)