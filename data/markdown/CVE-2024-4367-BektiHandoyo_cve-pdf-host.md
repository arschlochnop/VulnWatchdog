## CVE-2024-4367-PDF.js-任意JavaScript执行

**漏洞编号:** CVE-2024-4367

**漏洞类型:** 任意JavaScript执行

**影响应用:** Firefox, Firefox ESR, Thunderbird (通过PDF.js)

**危害等级:** 高危，可能导致敏感信息泄露、XSS攻击和远程代码执行（在PDF.js上下文中）

**影响版本:** < Firefox 126, < Firefox ESR 115.11, < Thunderbird 115.11

**利用条件:** 用户打开恶意构造的PDF文件

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-4367 是一个存在于 PDF.js 中的漏洞，由于在处理字体时缺少类型检查，允许在 PDF.js 上下文中执行任意 JavaScript 代码。 

**漏洞利用方式：**

1.  **构造恶意PDF：** 攻击者需要创建一个包含恶意 JavaScript 代码的 PDF 文档。 从提供的漏洞利用代码 `exploit.pdf` 和 `poc.pdf` 来看，攻击者在PDF的字体对象中嵌入 JavaScript 代码。 具体来说，代码被嵌入到 `/Font` 对象的 `/FontMatrix` 属性中，通过这种方式绕过类型检查。
2.  **触发漏洞：** 当目标用户使用受影响的 Firefox, Firefox ESR 或 Thunderbird 版本打开此 PDF 文档时，PDF.js 会尝试渲染字体，从而执行嵌入的恶意 JavaScript 代码。
3.  **代码执行：**  嵌入的 JavaScript 代码可以执行各种恶意操作。 在提供的 POC 代码中，恶意 JavaScript 代码的目的是窃取位于 `/app/admin/flag.pdf` 的 flag 文件，并将内容发送到攻击者的服务器。
     *   `exploit.pdf`: 将 flag 以 DataURL 格式发送到 `https://ha.requestcatcher.com/`。
     *   `poc.pdf`:  将 flag 以文件格式发送到 `https://webhook.site/134021d3-88f1-44a6-aa82-e48e33247fcc`。

**投毒风险分析：**

根据对提供的两个 PDF 文件的分析，没有发现明显的投毒代码。 两个 PDF 文件中的 JavaScript 代码都旨在利用漏洞窃取 flag，并将 flag 数据发送到外部服务器进行 exfiltration。 没有发现其他隐藏的恶意行为或后门代码。

**有效性评估：**

提供的 POC 代码利用了 PDF.js 在字体处理中类型检查的缺失漏洞。 根据漏洞描述和搜索结果，此漏洞允许执行任意 JavaScript 代码。 因此，POC 代码**有效**。

**项目地址:** [BektiHandoyo/cve-pdf-host](https://github.com/BektiHandoyo/cve-pdf-host)

**漏洞详情:** [CVE-2024-4367](https://nvd.nist.gov/vuln/detail/CVE-2024-4367)