## CVE-2014-6271-Apache-Debian Shellshock

**漏洞编号:** CVE-2014-6271

**漏洞类型:** 远程代码执行

**影响应用:** GNU Bash

**危害等级:** 高危，允许远程攻击者执行任意代码

**影响版本:** <= 4.3

**利用条件:** 需要目标系统存在CGI脚本，且Apache配置允许执行CGI脚本，并且Bash版本存在漏洞。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2014-6271（Shellshock）是一个影响 GNU Bash 的高危漏洞。该漏洞源于 Bash 处理环境变量中函数定义后附加字符串的方式存在缺陷，允许远程攻击者通过构造特殊的环境变量来执行任意代码。

**有效性：**

根据提供的 PoC 代码（/tmp/47c4ac3d27239b789878e6360b54dc21/README.md），该 PoC 旨在演示如何在 Apache Debian 环境中利用 CVE-2014-6271 漏洞。它包含构建易受攻击的 Docker 镜像和 Kubernetes 清单的步骤，以及利用漏洞的演示。

PoC 代码的有效性通过以下事实得到证实：

*   它提供了一个明确的攻击向量：通过 `User-Agent` HTTP 头传递恶意构造的 Bash 函数定义。
*   它演示了如何获得受害容器上的 shell 访问权限。
*   它演示了如何在受害容器上修改 Web 页面内容。

因此，提供的 PoC 代码可以被认为是有效的。

**投毒风险：**

评估 PoC 代码的投毒风险表明，主要风险较低，约为 5%。

*   **高风险文件:** 位于`/tmp/47c4ac3d27239b789878e6360b54dc21/web-insecure/Dockerfile`，这个Dockerfile 用于构建包含漏洞环境，该漏洞是已知的，构建目的是用于演示验证，所以它不是投毒代码。
*   **低风险文件:** 其他文件（例如 web-secure 目录中的文件和 k8s 清单文件）似乎是良性的，并且用于设置安全的环境以进行比较或者演示。
*   **总体分析:**

虽然该存储库的目的是演示漏洞，但攻击者可能会修改 `web-insecure/Dockerfile` 以包含其他恶意软件或后门。用户在使用这些文件构建镜像时应谨慎。

**利用方式：**

利用 CVE-2014-6271 漏洞涉及以下步骤：

1.  **确定目标：**识别运行易受攻击的 Bash 版本的系统，该系统通常用于处理 Web 请求或 CGI 脚本。
2.  **构造攻击负载：**创建一个包含恶意 Bash 函数定义的特殊构造的环境变量。
3.  **传递攻击负载：**通过 HTTP 请求头（例如 `User-Agent`）或 CGI 脚本可以访问的任何其他环境变量将攻击负载传递到目标系统。
4.  **执行任意代码：**当 Bash 处理恶意环境变量时，它会执行其中嵌入的命令。

在提供的 PoC 代码中，利用方式如下：

1.  攻击者设置一个 netcat 监听器 (`nc -nvlp 5050`)。
2.  攻击者使用 curl 命令向易受攻击的 Web 服务发送一个 HTTP 请求，其中 `User-Agent` 头包含一个恶意的 Bash 函数定义。这个函数定义包含执行反向 shell 的命令，将 shell 连接到攻击者的 netcat 监听器。
3.  当 Web 服务（通常通过 CGI 脚本）执行 Bash 时，Bash 会处理恶意的 `User-Agent` 头，执行反向 shell 命令，并允许攻击者访问受害容器上的 shell。

**项目地址:** [mochizuki875/CVE-2014-6271-Apache-Debian](https://github.com/mochizuki875/CVE-2014-6271-Apache-Debian)

**漏洞详情:** [CVE-2014-6271](https://nvd.nist.gov/vuln/detail/CVE-2014-6271)