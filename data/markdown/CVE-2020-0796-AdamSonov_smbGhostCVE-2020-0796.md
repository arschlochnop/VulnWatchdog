## CVE-2020-0796-SMBGhost

**漏洞编号:** CVE-2020-0796

**漏洞类型:** 远程代码执行

**影响应用:** Microsoft Windows SMBv3

**危害等级:** 高危，可能导致远程代码执行和网络传播

**影响版本:** Windows 10 Version 1903/1909, Windows Server Version 1903/1909

**利用条件:** 目标系统启用SMBv3协议，且未安装相应的安全补丁

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-0796（SMBGhost）是Microsoft SMBv3协议中的一个远程代码执行漏洞。攻击者可以通过向目标服务器发送特制的SMBv3数据包来触发此漏洞，从而在目标系统上执行任意代码。

**有效性：**

提供的POC代码包含一个扫描器(scanner.py)和一个主程序(smbCVE-2020-0796.py)。扫描器通过发送特制的SMBv3请求来检测目标主机是否存在漏洞。主程序调用扫描器，并根据扫描结果判断目标是否易受攻击。多个搜索结果表明存在公开可用的PoC代码，并且已经被积极利用，该POC代码可能有效。

**投毒风险：**

扫描器代码 (scanner.py) 的主要功能是探测目标IP是否存在漏洞，没有明显的恶意行为。它构造了一个特定的SMB数据包并检查响应，以确定目标是否容易受到攻击。主程序 (smbCVE-2020-0796.py) 负责调用扫描器。风险主要来自于：

1.  **subprocess.run() 使用风险：** `smbCVE-2020-0796.py` 使用 `subprocess.run()` 执行 `scanner.py`。虽然这里直接调用的是项目内的文件，但如果将来被修改，例如从外部获取扫描器脚本，就可能引入恶意代码。
2.  **依赖包风险：** `requirements.txt` 中声明了 `netaddr` 依赖。虽然这是一个常见的网络库，但任何依赖都存在被供应链攻击的潜在风险。
3.  **异常处理风险：** 代码中使用了`try...except` 块来处理网络连接错误和子进程执行错误。虽然这样做可以防止程序崩溃，但也可能隐藏潜在的错误，降低了调试难度，为潜在的恶意代码隐藏提供了机会。

综合来看，投毒的概率较低，但并非完全没有，大约10%的风险。

**利用方式：**

1.  **扫描阶段：** 使用scanner.py扫描目标IP地址范围，识别存在CVE-2020-0796漏洞的系统。scanner.py 通过发送特定的SMBv3协议数据包，并根据返回的数据包特征判断目标是否存在漏洞。
2.  **漏洞触发：** 当扫描器确定目标系统存在漏洞后，攻击者可以使用专门的漏洞利用程序发送特制的SMBv3请求，触发缓冲区溢出。
3.  **代码执行：** 成功触发漏洞后，攻击者可以在目标系统上执行任意代码。通常，攻击者会利用此漏洞来获取系统控制权，例如安装恶意软件、窃取敏感数据等。

**项目地址:** [AdamSonov/smbGhostCVE-2020-0796](https://github.com/AdamSonov/smbGhostCVE-2020-0796)

**漏洞详情:** [CVE-2020-0796](https://nvd.nist.gov/vuln/detail/CVE-2020-0796)