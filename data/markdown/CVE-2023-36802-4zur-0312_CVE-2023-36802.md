## CVE-2023-36802 - Microsoft Streaming Service Proxy 权限提升漏洞

**漏洞编号:** CVE-2023-36802

**漏洞类型:** 权限提升

**影响应用:** Microsoft Streaming Service Proxy

**危害等级:** 高危，本地权限提升至SYSTEM

**影响版本:** 受影响的Windows 10, Windows Server和Windows 11版本，具体版本范围见漏洞库信息

**利用条件:** 需要本地访问权限。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-36802 是一个 Microsoft Streaming Service Proxy 权限提升漏洞。根据搜索结果和漏洞利用代码，该漏洞利用方式主要通过以下步骤：

1.  **信息泄露与地址获取：** 利用`CreateFileA`打开`Mskssrv`设备，然后通过`NtQuerySystemInformation`或类似方式泄露内核地址，例如`mskssrv_file_obj`（MSKSSRV 文件对象地址）, 当前进程的EPROCESS地址，系统进程的EPROCESS地址等。
2.  **`PreviousMode`覆写：** 利用该漏洞的关键是覆盖内核线程的`PreviousMode`。这使得在内核模式下运行的代码可以以用户模式的权限执行，从而绕过某些安全检查。
3.  **Token替换：** 获取系统进程的Token，然后将其写入当前进程的Token中，实现权限提升。
4.  **漏洞缓解绕过：** 漏洞利用代码中包含绕过某些缓解措施的操作，例如设置`ProcessBilled`字段为0，防止某些循环导致的问题。
5.  **提权后处理:**  在提权后，需要恢复被修改的`PreviousMode`和`ProcessBilled`等关键数据，避免系统崩溃。

**有效性分析：** 根据搜索结果和提供的POC代码，该漏洞利用方法应该是有效的，因为有公开的利用代码和相关的分析文章，并且CISA已经将其添加到已知被利用漏洞目录中。PoC代码包含必要步骤，例如泄露内核地址，覆盖PreviousMode，以及Token替换。

**投毒风险分析：** 漏洞利用代码本身较为复杂，存在一定投毒的可能性，主要集中在以下几个方面：

*   **延时或触发条件：** 恶意代码可能被隐藏在某个条件判断中，例如在特定时间或特定操作后触发。
*   **资源耗尽：** 恶意代码可能通过分配大量内存或创建大量线程来耗尽系统资源，导致拒绝服务。
*   **后门植入：** 恶意代码可能在提权后植入后门，例如修改系统文件或添加新的用户。

考虑到代码的复杂性，以及利用过程涉及到多个内核地址的读写，存在微小的风险：如果攻击者有意在利用代码中加入恶意代码，并且能够成功执行，那么可能会对系统造成损害。因此，结合代码分析，推测投毒的风险大约为10%。

**项目地址:** [4zur-0312/CVE-2023-36802](https://github.com/4zur-0312/CVE-2023-36802)

**漏洞详情:** [CVE-2023-36802](https://nvd.nist.gov/vuln/detail/CVE-2023-36802)