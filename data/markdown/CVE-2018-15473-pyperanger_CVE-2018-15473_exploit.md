## CVE-2018-15473 - OpenSSH 用户枚举

**漏洞编号:** CVE-2018-15473

**漏洞类型:** 用户枚举

**影响应用:** OpenSSH

**危害等级:** 中危，泄露用户名信息，增加暴力破解或社工攻击的成功率

**影响版本:** <= 7.7

**利用条件:** 需要目标SSH服务开启且版本小于等于7.7，且可以建立TCP连接

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2018-15473 漏洞是 OpenSSH 7.7 及之前版本中存在的一个用户枚举漏洞。该漏洞源于 OpenSSH 在处理无效用户身份验证请求时，不会延迟 bailout，导致攻击者可以通过观察服务器的响应时间差异来判断目标服务器上是否存在特定用户。提供的漏洞利用代码通过构造畸形的 SSH 数据包，并根据服务器返回的错误信息（Packet integrity error）来判断用户是否存在。

**有效性评估：**

根据漏洞库信息、搜索结果和提供的漏洞利用代码，可以判断此漏洞利用代码有效。搜索结果中的多个条目均指出了该漏洞的存在，并且提供了漏洞利用的相关信息。漏洞利用代码本身也实现了利用该漏洞进行用户枚举的逻辑。

**投毒风险评估：**

分析提供的 Perl 漏洞利用代码，该代码主要功能是构造畸形的 SSH 数据包来触发漏洞，没有发现明显的恶意代码或后门。该脚本通过修改 `Net::SSH::Perl::Auth::PublicKey::_sign_send_pubkey` 函数来发送畸形数据包，并通过hook `Net::SSH::Perl::Packet::croak`函数来判断目标是否存在用户。虽然修改了标准库函数，但是没有发现任何写入文件、执行系统命令等恶意行为。因此，可以认为该仓库中不存在作者隐藏的投毒代码，投毒风险为 0%。

**利用方式分析：**

1.  **漏洞原理：** OpenSSH 在处理用户身份验证请求时，如果用户不存在，会立即返回错误信息，而不会像处理存在的用户那样，继续进行后续的身份验证步骤。这个时间差异可以被攻击者利用。
2.  **利用步骤：**
    *   首先，需要安装 `Net::SSH::Perl` 模块以及相关的依赖。
    *   然后，运行提供的 Perl 脚本，指定要枚举的用户名和目标主机 IP 地址。例如：`perl CVE-2018-15473.pl root 192.168.1.100`
    *   脚本会尝试使用指定的用户名进行 SSH 身份验证，但会发送一个畸形的数据包。
    *   如果服务器返回 "Packet integrity error"，则表示该用户存在；否则，表示该用户不存在。
3.  **缓解措施：**
    *   升级 OpenSSH 到 7.8 或更高版本。
    *   使用 fail2ban 等工具来限制 SSH 身份验证尝试的频率。
    *   禁用用户名密码登录，使用 SSH 密钥进行身份验证。


**项目地址:** [pyperanger/CVE-2018-15473_exploit](https://github.com/pyperanger/CVE-2018-15473_exploit)

**漏洞详情:** [CVE-2018-15473](https://nvd.nist.gov/vuln/detail/CVE-2018-15473)