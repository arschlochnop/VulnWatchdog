## CVE-2020-17519-Apache Flink 目录遍历

**漏洞编号:** CVE-2020-17519

**漏洞类型:** 目录遍历

**影响应用:** Apache Flink

**危害等级:** 高危，可读取JobManager进程可访问的任意文件

**影响版本:** 1.11.0 to 1.11.2

**利用条件:** 需要Flink JobManager的REST接口暴露在外网或内网，且目标版本在1.11.0到1.11.2之间。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

根据漏洞库信息和搜索引擎结果，CVE-2020-17519是Apache Flink 1.11.0到1.11.2版本中存在的一个目录遍历漏洞。攻击者可以通过JobManager的REST接口，利用`..%252f`进行URL编码后的目录穿越，读取JobManager进程有权访问的服务器本地文件。CISA已将此漏洞添加到已知被利用漏洞目录中，表明该漏洞正在被积极利用。

提供的Nmap脚本`apache-flink-traversal.nse`通过构造特定的HTTP GET请求，尝试读取`/etc/passwd`文件来验证漏洞是否存在。具体来说，它发送请求到`/jobmanager/logs/..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252fetc%252fpasswd`，如果服务器返回状态码200且响应体中包含`root:x:0:0`，则认为目标服务器存在漏洞。

**有效性：**
POC代码有效，它通过构造恶意的URL来读取敏感文件，是检测漏洞的常见方法。

**投毒风险：**
查看了提供的Nmap脚本内容，该脚本的主要功能是检测目标主机是否存在CVE-2020-17519漏洞，通过发送包含目录遍历payload的HTTP请求到目标Flink JobManager的REST API端点，并检查响应内容是否包含`/etc/passwd`文件的内容，从而判断是否存在漏洞。未发现作者隐藏的恶意代码或后门。
虽然此脚本本身的功能是检查漏洞，但使用者可能会利用此漏洞来获取服务器上的敏感信息，这属于漏洞利用行为，而非POC投毒。因此，投毒风险评估为0%。

**利用方式：**
1.  确定目标Apache Flink的版本是否在受影响的范围内（1.11.0 to 1.11.2）。
2.  使用Nmap脚本或手动构造包含目录遍历payload的HTTP GET请求，发送到JobManager的REST接口。
3.  通过REST接口发送请求`/jobmanager/logs/..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252fetc%252fpasswd`。
4.  如果服务器返回状态码200，并且响应体包含`/etc/passwd`的内容，则表明漏洞存在，可以进一步利用该漏洞读取其他文件。
5.  利用该漏洞读取JobManager进程可访问的任何本地文件，例如配置文件、密钥等。

**项目地址:** [dolevf/apache-flink-directory-traversal.nse](https://github.com/dolevf/apache-flink-directory-traversal.nse)

**漏洞详情:** [CVE-2020-17519](https://nvd.nist.gov/vuln/detail/CVE-2020-17519)