## CVE-2024-28397-js2py-Sandbox-Escape

**漏洞编号:** CVE-2024-28397

**漏洞类型:** 代码注入/沙箱逃逸

**影响应用:** js2py

**危害等级:** 高危，远程代码执行

**影响版本:** <= 0.74

**利用条件:** 需要目标系统运行js2py并且存在可访问的API接口

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-28397是js2py 0.74版本及以前存在的一个沙箱逃逸漏洞。攻击者可以通过精心构造的API调用，利用`js2py.disable_pyimport()`组件中的问题，在Python环境中执行任意代码。

**有效性：**
根据漏洞库信息、搜索引擎结果和漏洞利用代码来看，此POC是有效的，可以实现远程代码执行。

**投毒风险：**
查看`exploit.py`代码，主要功能是从用户处获取host、port、cmd、session，然后构造HTTP请求，将包含恶意JavaScript代码的payload发送到目标服务器的`/run_code`接口。Payload使用JavaScript代码来查找Python的subprocess.Popen类，然后使用它来执行用户提供的命令。投毒风险分析：
*   **输入参数：** 代码中存在输入参数(host, port, cmd, session),cmd参数用于远程代码执行，如果攻击者提供的cmd参数本身包含恶意代码，那么可以认为存在投毒，但此处的投毒行为应有使用者承担。
*   **网络请求：** 代码会向指定host和port发起网络请求，如果被替换为恶意的host，存在信息泄露或中间人攻击的风险。
*   **Payload本身：** Payload的功能是查找subprocess.Popen并执行命令，这本身就是恶意操作。将Payload集成到自动化利用框架中存在风险。
因此，存在一定的投毒风险，评估为10%。风险主要来自于使用者利用该脚本进行攻击或将包含该漏洞利用的js2py项目集成到更大的项目中。

**利用方式：**
1.  攻击者需要知道目标服务器的host和port。
2.  攻击者需要知道目标服务器的`session`。
3.  攻击者提供要执行的命令（`cmd`）。
4.  漏洞利用脚本构造包含恶意JavaScript代码的payload，该payload的核心是利用JavaScript查找Python的`subprocess.Popen`类。
5.  脚本通过HTTP POST请求将payload发送到目标服务器的`/run_code`接口。
6.  目标服务器执行payload中的JavaScript代码，进而执行攻击者提供的命令。
7.  执行结果通过HTTP响应返回给攻击者。

此漏洞的根本原因是js2py在处理JavaScript代码时，未能正确地隔离Python环境，导致攻击者可以绕过沙箱限制，从而执行任意Python代码。 通过`js2py.disable_pyimport()`组件进行利用。

**项目地址:** [vitaciminIPI/CVE-2024-28397-RCE](https://github.com/vitaciminIPI/CVE-2024-28397-RCE)

**漏洞详情:** [CVE-2024-28397](https://nvd.nist.gov/vuln/detail/CVE-2024-28397)