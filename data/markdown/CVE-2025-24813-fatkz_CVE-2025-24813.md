## CVE-2025-24813 - Apache Tomcat 远程代码执行漏洞

**漏洞编号:** CVE-2025-24813

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Tomcat

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** 9.0.0.M1 - 9.0.98, 10.1.0-M1 - 10.1.34, 11.0.0-M1 - 11.0.2

**利用条件:** 需要满足以下所有条件：DefaultServlet的writes启用（readonly=false）；支持partial PUT（默认启用）；使用Tomcat的文件session持久化机制，且为默认存储位置；应用包含可用于反序列化攻击的库。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2025-24813 是 Apache Tomcat 中的一个远程代码执行漏洞，该漏洞源于对包含恶意 Java 序列化对象的`.session`文件的处理不当。攻击者可以通过发送带有 `Content-Range` 头的 partial PUT 请求，将恶意`.session`文件上传到 `work/` 目录。当具有匹配 `JSESSIONID` cookie 的请求到达时，Tomcat 会自动反序列化该恶意 session，从而导致任意代码执行。

**有效性：**
根据漏洞库信息、搜索结果和提供的 POC 代码，该漏洞的 POC 代码是有效的。多个来源都表明该漏洞已被积极利用。

**利用方式：**
1.  **准备恶意 Payload:** 使用 `ysoserial` 或类似工具生成包含恶意代码的序列化 Java 对象，并将其保存为 `.ser` 文件。
2.  **上传 Payload:** 使用 partial PUT 请求将恶意 `.ser` 文件上传到 Tomcat 的 `work/` 目录下，文件名为 `<session_id>.session`。`Content-Range` 头用于模拟不完整的上传。
3.  **触发反序列化:**  发送包含与上传的 session 文件名相匹配的 `JSESSIONID` cookie 的 HTTP 请求到目标 Tomcat 服务器，这会导致 Tomcat 反序列化上传的恶意 session 文件，从而执行恶意代码。

**投毒风险：**
POC 代码本身看起来相对简单，主要执行上传 payload 和触发反序列化操作。仔细检查后，存在以下潜在的投毒风险：

*   **Payload 内容：** 虽然 POC 代码没有直接包含恶意 payload，但是依赖用户提供的 `payload_file`。如果用户从不可信的来源获取了恶意 payload 文件，则可能存在投毒风险。
*   **隐蔽的 HTTP 请求修改：** 在 `requests.put` 或 `requests.get` 调用中，攻击者可能添加额外的 HTTP 头或修改请求内容，以在目标服务器上执行其他恶意操作。目前的代码较为简洁，未发现明显的可疑之处。
*   **依赖库的风险：** `requests` 是一个常用的 Python 库，但如果攻击者篡改了这个库，可能会引入恶意行为。可能性较低，但不能完全排除。
*   **代码逻辑的细微修改：** 攻击者可能会对 POC 代码进行细微修改，例如更改上传路径或触发反序列化的方式，以便在特定环境下实现更隐蔽的攻击。这些修改后的代码可能更难被检测到。

总体而言，此 POC 代码直接包含投毒代码的可能性较低，约 10%。更大的风险在于用户使用的 payload 文件是否可信，以及攻击者是否会对代码进行修改以适应特定环境。


**项目地址:** [fatkz/CVE-2025-24813](https://github.com/fatkz/CVE-2025-24813)

**漏洞详情:** [CVE-2025-24813](https://nvd.nist.gov/vuln/detail/CVE-2025-24813)