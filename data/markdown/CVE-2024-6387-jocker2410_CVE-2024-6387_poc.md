## CVE-2024-6387 OpenSSH regreSSHion 漏洞

**漏洞编号:** CVE-2024-6387

**漏洞类型:** 竞争条件漏洞

**影响应用:** OpenSSH

**危害等级:** 高危，可能导致远程代码执行或拒绝服务

**影响版本:** 8.5p1 <= OpenSSH <= 9.7p1

**利用条件:** 目标系统使用受影响的OpenSSH版本，基于glibc的Linux系统，且未禁用LoginGraceTime

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-6387（regreSSHion）是一个存在于OpenSSH服务器(sshd)中的竞争条件漏洞。该漏洞源于OpenSSH在处理信号时存在不安全行为。远程攻击者通过在一定时间内认证失败，可以触发此漏洞，进而可能导致远程代码执行（RCE）或拒绝服务（DoS）。

**漏洞利用方式：**

1.  攻击者向目标服务器发起大量的SSH连接请求。
2.  在SSH认证过程中，攻击者故意使认证失败，触发LoginGraceTime超时。
3.  由于竞争条件，sshd可能在处理SIGALRM信号时进入不安全状态。
4.  在glibc-based的Linux系统上，这种不安全状态可能允许攻击者将指令插入到堆中，最终导致RCE。
5.  如果无法实现RCE，攻击者可以通过耗尽服务器资源，导致DoS。

**POC代码分析：**

提供的PoC代码`/tmp/d7c5471d195cdec17d8f4ebaf7516058/CVE-2024-6387_poc.py`的主要功能是检测目标SSH服务器的版本，判断其是否受CVE-2024-6387漏洞影响。它通过建立socket连接，发送`\x00`，接收SSH版本信息，并进行正则匹配来确定OpenSSH的版本。如果版本在易受攻击的范围内（8.5 <= 版本 < 9.8）,则输出目标系统可能存在漏洞。该PoC本身**不包含直接利用漏洞的代码**，仅仅用于版本检测。

`/tmp/d7c5471d195cdec17d8f4ebaf7516058/README.md` 提供了一个使用说明，介绍了如何使用该PoC。`/tmp/d7c5471d195cdec17d8f4ebaf7516058/ip-addr.list`包含需要检查的IP地址列表, 127.0.0.1是示例.

**有效性：**

提供的POC代码的**有效性在于验证目标系统是否存在漏洞**，而非直接利用该漏洞。根据搜索结果和漏洞描述，完整的漏洞利用需要更复杂的步骤和技术，例如大量连接尝试来触发竞争条件，以及精心构造的shellcode。因此，此PoC仅仅是前期验证步骤。

**投毒风险：**

该仓库中存在**投毒风险的可能性较低，约为10%**。PoC代码主要功能是版本检测，本身没有发现恶意代码。潜在的风险可能存在于：

*   `ip-addr.list`文件：虽然当前提供的`ip-addr.list`文件只包含本地地址`127.0.0.1`, 如果用户不小心使用了作者预先设定的其他IP地址列表，可能会导致未授权的扫描或攻击行为。
*   `session.log`文件：虽然日志记录本身不是恶意行为，但如果日志文件被上传或泄露，可能暴露用户的扫描目标信息。日志信息包含IP和端口信息。
*   在实际利用该漏洞时，如果攻击者使用了恶意的Payload，可能会对目标系统造成更大的危害。这些Payload可能被伪装成无害的代码，从而绕过安全检测。
*   如果作者在其他未公开的分支或版本中包含了恶意代码，并且诱导用户使用这些版本，则存在更高的投毒风险。

**综上所述，**虽然提供的PoC代码本身不包含明显的恶意代码，但用户在使用时仍然需要保持警惕，仔细审查代码，并确保从可信的来源获取代码，避免潜在的投毒风险。

**项目地址:** [jocker2410/CVE-2024-6387_poc](https://github.com/jocker2410/CVE-2024-6387_poc)

**漏洞详情:** [CVE-2024-6387](https://nvd.nist.gov/vuln/detail/CVE-2024-6387)