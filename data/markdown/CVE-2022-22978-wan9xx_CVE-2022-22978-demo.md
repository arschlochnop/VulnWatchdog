## CVE-2022-22978-Spring Security RegexRequestMatcher 身份验证绕过

**漏洞编号:** CVE-2022-22978

**漏洞类型:** 身份验证绕过

**影响应用:** Spring Security

**危害等级:** 高危，可能导致未授权访问

**影响版本:** Spring security versions 5.4.x prior to 5.4.11+, 5.5.x prior to 5.5.7+, 5.6.x prior to 5.6.4+ and all earlier unsupported versions

**利用条件:** 1. Spring Security在漏洞影响范围内。
2. 使用spring-security的正则匹配器regexMatchers或者直接使用RegexRequestMatcher，并且使用了`.` 匹配路径，例如regexMatcher("/api/.*")。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-22978是一个Spring Security中的身份验证绕过漏洞。当应用程序使用`RegexRequestMatcher`并且在正则表达式中使用了`.`时，攻击者可以通过在URL中注入换行符（`%0a`或`%0d`）来绕过身份验证。漏洞利用代码显示，通过访问类似`http://127.0.0.1:8080/admin/admin%0a`的URL，可以绕过登录验证。但是，如果绕过的URL没有对应的Controller处理请求，会返回404错误。

**有效性：**提供的POC代码是有效的，可以成功绕过身份验证，但前提是目标应用程序使用了存在漏洞的`RegexRequestMatcher`配置，并且绕过的路径有对应的处理器。

**投毒风险：**提供的代码主要是演示漏洞利用，没有发现明显的恶意代码。代码主要是一些配置和示例，用于演示漏洞。但是，由于代码来自外部，存在极小的潜在风险（例如构建脚本或配置文件中的隐蔽依赖），因此评估为5%。

**利用方式：**
1.  确认目标应用程序使用受影响版本的Spring Security，并且使用了`RegexRequestMatcher`且包含`.`的配置，例如 `regexMatcher("/api/.*")`。
2.  构造包含换行符的URL，例如 `/admin/admin%0a`，尝试绕过身份验证。
3.  验证是否成功绕过身份验证，并可以访问受保护的资源。如果绕过成功，但服务器返回 404 错误，则说明绕过的路径没有相应的控制器处理。

**项目地址:** [wan9xx/CVE-2022-22978-demo](https://github.com/wan9xx/CVE-2022-22978-demo)

**漏洞详情:** [CVE-2022-22978](https://nvd.nist.gov/vuln/detail/CVE-2022-22978)