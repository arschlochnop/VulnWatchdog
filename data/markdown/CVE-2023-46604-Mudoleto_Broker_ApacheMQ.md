## CVE-2023-46604-Apache ActiveMQ-远程代码执行

**漏洞编号:** CVE-2023-46604

**漏洞类型:** 远程代码执行

**影响应用:** Apache ActiveMQ

**危害等级:** 高危，可能导致远程代码执行和系统被控制

**影响版本:** < 5.15.16, < 5.16.7, < 5.17.6, < 5.18.3

**利用条件:** 需要网络访问ActiveMQ Broker或Client，且目标存在于受影响版本范围内

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2023-46604 是 Apache ActiveMQ 中的一个远程代码执行漏洞。该漏洞源于Java OpenWire协议消息处理过程中存在反序列化漏洞，未经身份验证的远程攻击者可以通过操纵 OpenWire 协议中的序列化类类型，使 ActiveMQ Broker 或 Client 实例化 classpath 上的任何类，从而执行任意 shell 命令。

**有效性：**
根据搜索引擎结果，多个安全厂商报告了CVE-2023-46604漏洞的在野利用，包括被Kinsing恶意软件和勒索软件利用。这表明该漏洞利用的有效性较高。

**投毒风险：**
提供的“漏洞利用代码”文件内容仅为nmap扫描结果，无法直接判断是否存在投毒代码。Nmap扫描本身是一种信息收集行为，不包含任何可执行的恶意代码。因此，判定投毒风险为0%。

**利用方式：**
1.  **漏洞原理：** ActiveMQ 使用 OpenWire 协议进行消息序列化和反序列化。漏洞利用通过构造恶意的序列化消息，指定一个可以执行恶意代码的类（通常是利用已知的 gadget chain），然后将其发送到 ActiveMQ Broker 或 Client。
2.  **利用过程：** 攻击者需要首先确定目标 ActiveMQ Broker 或 Client 的版本，然后根据版本选择合适的 gadget chain。攻击者构造包含恶意 gadget chain 的序列化消息，并通过 OpenWire 协议发送给目标。目标在反序列化消息时，会实例化恶意类，从而执行攻击者指定的任意代码。
3. **利用场景：** 攻击者可以通过此漏洞直接控制 ActiveMQ 服务器，执行系统命令，安装后门，窃取敏感数据，甚至将其作为僵尸网络的一部分。也可能控制客户端，特别是基于Java的客户端。
4. **风险缓解：** 升级ActiveMQ版本到5.15.16, 5.16.7, 5.17.6, or 5.18.3，避免使用存在漏洞的legacy OpenWire Module，加强身份认证。

**项目地址:** [Mudoleto/Broker_ApacheMQ](https://github.com/Mudoleto/Broker_ApacheMQ)

**漏洞详情:** [CVE-2023-46604](https://nvd.nist.gov/vuln/detail/CVE-2023-46604)