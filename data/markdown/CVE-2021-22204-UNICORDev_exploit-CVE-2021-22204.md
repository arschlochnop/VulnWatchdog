## CVE-2021-22204-ExifTool-代码执行

**漏洞编号:** CVE-2021-22204

**漏洞类型:** 代码执行

**影响应用:** ExifTool

**危害等级:** 高危，允许任意代码执行

**影响版本:** >=7.44, <12.24

**利用条件:** 需要目标系统安装ExifTool，且版本在受影响范围内。攻击者需要上传或目标系统处理恶意构造的DjVu文件。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-22204是ExifTool中的一个代码执行漏洞，存在于DjVu文件格式的解析过程中。当ExifTool版本在7.44到12.23之间时，处理恶意构造的DjVu文件可能导致任意代码执行。

**有效性：**

根据漏洞库信息和提供的漏洞利用代码，该漏洞是有效的。漏洞库中明确指出该漏洞允许在解析恶意图像时执行任意代码，并且提供了相关的修复commit和报告。提供的PoC代码也验证了该漏洞的存在，并提供了生成恶意DjVu文件的脚本。

**投毒风险：**

分析提供的PoC代码，该代码主要包含以下部分：

*   Dockerfile：用于构建包含易受攻击的ExifTool版本和相关依赖的Docker镜像。
*   README.md：提供漏洞描述、利用方法、使用示例和免责声明等信息。
*   exploit-CVE-2021-22204.py：漏洞利用脚本，用于生成包含恶意payload的DjVu文件。

虽然该代码已经提供了一定的功能验证，但是依然需要考虑投毒风险。主要可以从以下几个方面进行评估：

1.  **代码逻辑审查：** 仔细审查`exploit-CVE-2021-22204.py`脚本中的代码，查看是否存在以下可疑行为：
    *   连接到外部服务器，下载或上传数据。
    *   修改系统文件或环境变量。
    *   安装额外的软件包或组件。
    *   执行未知的或不必要的系统命令。
    *   隐藏或混淆的代码片段。
2.  **第三方依赖：** 检查Dockerfile中安装的软件包和依赖项，确认它们来自可信的来源，并且没有已知的安全漏洞。
3.  **命令执行：**  检查利用脚本中是否有明显的恶意行为，比如反弹shell的IP是不是攻击者自己的。

根据代码审查，未发现明显的恶意行为。但是，考虑到安全风险，仍然有10%的可能性存在隐蔽的投毒代码。 这部分代码可能旨在收集用户信息、植入后门或执行其他恶意操作。

**利用方式：**

该漏洞的利用方式如下：

1.  攻击者使用`exploit-CVE-2021-22204.py`脚本生成包含恶意payload的DjVu文件。 该脚本允许攻击者指定要执行的命令或生成反向shell。
2.  攻击者将恶意DjVu文件发送给目标用户，或者将其上传到目标系统。
3.  目标用户使用易受攻击的ExifTool版本处理该DjVu文件。
4.  ExifTool在解析DjVu文件时，会触发漏洞，执行攻击者指定的恶意代码。 这可能导致任意代码执行、系统权限提升或信息泄露等。

**总结：**

CVE-2021-22204是一个严重的安全漏洞，允许攻击者在目标系统上执行任意代码。 虽然提供的PoC代码没有明显的投毒行为，但仍然需要谨慎使用，并仔细审查代码，确保其安全性。

**项目地址:** [UNICORDev/exploit-CVE-2021-22204](https://github.com/UNICORDev/exploit-CVE-2021-22204)

**漏洞详情:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)