## CVE-2024-3400 PAN-OS GlobalProtect 远程命令执行

**漏洞编号:** CVE-2024-3400

**漏洞类型:** 命令注入

**影响应用:** Palo Alto Networks PAN-OS GlobalProtect

**危害等级:** 高危，未授权远程命令执行，可完全控制防火墙

**影响版本:** PAN-OS 10.2 (小于 10.2.9-h1), 11.0 (小于 11.0.4-h1), 11.1 (小于 11.1.2-h3)

**利用条件:** 存在GlobalProtect网关或Portal配置，且防火墙版本在受影响范围内

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-3400是一个存在于Palo Alto Networks PAN-OS GlobalProtect功能中的命令注入漏洞。该漏洞允许未经身份验证的攻击者在防火墙上以root权限执行任意代码。根据漏洞信息和搜索结果，该漏洞的利用方式是利用特制的SESSID cookie，其中包含经过反引号执行的命令，并利用 `${IFS}` 绕过简单的过滤器。攻击者可以通过 `/global-protect/login.esp` 端点将payload注入，从而创建一个任意文件，导致命令注入。

**漏洞利用有效性：**

从提供的漏洞库信息、搜索结果以及漏洞利用代码来看，该漏洞利用是有效的。漏洞库信息中明确指出“Palo Alto Networks is aware of an increasing number of attacks that leverage the exploitation of this vulnerability”以及“Proof of concepts for this vulnerability have been publicly disclosed by third parties.”，证明该漏洞在野外已被利用且存在可用的PoC。

搜索结果也证实了这一点，例如“CVE-2024-3400 Activity | ThreatLabz” 和 “CVE-2024-3400 PAN-OS Zero-Day: What You Need To...” 都表明该漏洞正在被积极利用。

漏洞利用代码（README.md）中也详细描述了一个真实的攻击案例，包括攻击者使用的payload、C2服务器、以及受影响的端点等，进一步证实了该漏洞的可利用性。

**投毒风险分析：**

提供的漏洞利用代码（README.md）主要是一个事件调查报告和分析，用于检测和响应CVE-2024-3400的攻击尝试。虽然提供了IOC、利用模式和缓解措施，但该文件本身并没有包含恶意代码。

但是，考虑到该漏洞允许远程代码执行，攻击者可能会利用该漏洞部署后门或其他恶意软件。因此，在实际利用PoC进行测试时，需要格外小心，确保在一个隔离的环境中进行，并仔细检查利用过程中产生的任何文件或进程。

根据对代码的分析，投毒风险较低，估计为10%。风险主要来自如果直接复制利用代码而不理解其含义，可能会无意中执行一些不期望的操作，但代码本身没有明显的恶意目的。

**利用方式总结：**

1.  **目标：** 存在GlobalProtect配置的Palo Alto Networks PAN-OS防火墙（版本在受影响范围内）。
2.  **入口点：** `/global-protect/login.esp` 端点。
3.  **攻击载荷：** 特制的 `SESSID` cookie，包含反引号执行的命令，并使用 `${IFS}` 绕过过滤器。
4.  **利用过程：** 攻击者发送包含恶意 `SESSID` 的 HTTP POST 请求到 `/global-protect/login.esp` 端点，触发命令注入。
5.  **结果：** 在防火墙上以 root 权限执行任意命令，例如，下载并执行恶意脚本，建立反向shell等。

**项目地址:** [CyprianAtsyor/letsdefend-cve2024-3400-case-study](https://github.com/CyprianAtsyor/letsdefend-cve2024-3400-case-study)

**漏洞详情:** [CVE-2024-3400](https://nvd.nist.gov/vuln/detail/CVE-2024-3400)