## CVE-2023-22809-sudoedit权限提升漏洞

**漏洞编号:** CVE-2023-22809

**漏洞类型:** 权限提升

**影响应用:** sudo

**危害等级:** 高危，本地攻击者可获取root权限

**影响版本:** 1.8.0 to 1.9.12p1

**利用条件:** 用户需要拥有使用sudoedit或sudo -e编辑文件的权限。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2023-22809 存在于 Sudo 1.9.12p2 之前的版本中。sudoedit (即 -e) 功能错误地处理用户提供的环境变量（SUDO_EDITOR、VISUAL 和 EDITOR）中传递的额外参数，允许本地攻击者将任意条目附加到要处理的文件列表中，导致权限提升。

**有效性：**
根据漏洞信息和提供的POC代码，该漏洞利用是有效的。POC代码旨在利用sudoedit的参数处理缺陷，通过设置恶意的EDITOR环境变量，将/etc/sudoers文件添加到sudoedit要编辑的文件列表中，从而允许低权限用户修改sudoers文件，并添加可以获取root权限的规则。

**投毒风险：**
分析提供的`exploit.sh`脚本，该脚本首先检查当前用户是否具有使用`sudoedit`或`sudo -e`以root身份运行文件的权限。 如果是，脚本将输出提示，要求用户将一行添加到`/etc/sudoers`文件中，以便在所有文件上获得权限并获得root shell。该脚本本身**没有**包含恶意代码，例如下载和执行其他脚本或修改系统文件等。因此，投毒风险较低，估计为0%。 但是，攻击者可能通过替换`exploit.sh`脚本或者修改脚本下载地址来引入恶意代码。

**利用方式：**
1.  **漏洞利用前提：**  攻击者需要能够通过`sudo -l`命令看到他/她能够以root身份运行`sudoedit`或`sudo -e`命令。
2.  **设置环境变量：**  攻击者设置`EDITOR`环境变量，使其包含`vim -- /etc/sudoers`这样的命令。这里的`--`是为了绕过sudo的参数检查，`/etc/sudoers`是攻击者想要编辑的文件。
3.  **运行sudoedit：**  攻击者运行`sudoedit <任意文件>`或 `sudo -e <任意文件>`。由于`EDITOR`环境变量被设置，实际执行的编辑器是攻击者控制的，并且会将`/etc/sudoers`文件作为要编辑的文件打开。
4.  **修改sudoers文件：**  攻击者在打开的`/etc/sudoers`文件中添加一行，例如`username ALL=(ALL:ALL) ALL`，这将允许该用户以root身份运行任何命令。
5.  **获取root权限：**  攻击者现在可以使用`sudo -i`或`sudo su`等命令获取root权限。

**项目地址:** [M4fiaB0y/CVE-2023-22809](https://github.com/M4fiaB0y/CVE-2023-22809)

**漏洞详情:** [CVE-2023-22809](https://nvd.nist.gov/vuln/detail/CVE-2023-22809)