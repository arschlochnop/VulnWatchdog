## CVE-2022-37122 Carel pCOWeb HVAC BACnet Gateway 任意文件读取漏洞

**漏洞编号:** CVE-2022-37122

**漏洞类型:** 任意文件读取

**影响应用:** Carel pCOWeb HVAC BACnet Gateway

**危害等级:** 高危，可能导致敏感信息泄露

**影响版本:** 2.1.0, Firmware: A2.1.0 - B2.1.0, Application Software: 2.15.4A Software v16 13020200

**利用条件:** 目标系统存在CVE-2022-37122漏洞，且攻击者可以访问目标系统的web服务。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-37122存在于Carel pCOWeb HVAC BACnet Gateway 2.1.0版本中，是一个未经身份验证的任意文件读取漏洞。攻击者可以通过`logdownload.cgi`脚本中的`file` GET参数，利用目录遍历漏洞读取系统上的任意文件。

**有效性评估：**

提供的漏洞利用代码（cve-2022-37122-scanner.sh）是一个bash脚本，可以扫描目标是否存在此漏洞，并尝试读取`/etc/hostname`文件进行验证。该脚本使用curl发送HTTP请求，通过目录遍历payload读取文件内容。脚本提供了多种选项，包括指定目标URL、payload、线程数、输出文件等。因此，提供的PoC代码是有效的。

**投毒风险分析：**

代码主要功能是扫描和验证漏洞，但也存在一定的投毒风险。以下是风险分析：

*   **依赖风险:**  虽然脚本只依赖于`bash`、`curl`和`figlet`（会自动安装），但如果自动安装过程被篡改，可能会引入恶意依赖。
*   **输出风险:**  脚本会将结果输出到CSV文件，并保存响应样本。如果目标系统返回大量数据，可能会导致拒绝服务攻击。
*   **Payload风险:** 虽然默认payload是`/etc/hostname`，但用户可以自定义payload，如果payload包含恶意代码，可能会对目标系统造成损害。
*   **后门风险:** 仔细检查脚本，未发现明显的后门代码。但由于脚本功能较为复杂，不排除作者隐藏了不易察觉的恶意代码。例如，可能存在根据特定条件执行恶意操作的代码。
*   **更新风险:** 如果该项目被恶意控制，后续的更新可能会包含恶意代码。

综合考虑以上因素，投毒风险大约为10%。

**利用方式：**

1.  使用提供的`cve-2022-37122-scanner.sh`脚本，指定目标URL。
2.  脚本会发送包含目录遍历payload的HTTP请求到目标系统的`logdownload.cgi`脚本。
3.  如果目标存在漏洞，且payload有效，脚本会读取指定文件的内容并保存到CSV文件和响应样本中。
4.  攻击者可以修改payload，读取目标系统上的其他敏感文件，例如`/etc/passwd`、`/etc/shadow`等。

**项目地址:** [bughuntar/CVE-2022-37122-Exploit](https://github.com/bughuntar/CVE-2022-37122-Exploit)

**漏洞详情:** [CVE-2022-37122](https://nvd.nist.gov/vuln/detail/CVE-2022-37122)