## CVE-2023-4220-Chamilo LMS 未授权文件上传导致RCE

**漏洞编号:** CVE-2023-4220

**漏洞类型:** 未授权文件上传/远程代码执行

**影响应用:** Chamilo LMS

**危害等级:** 高危，可能导致服务器完全被控制，数据泄露，安装勒索软件等

**影响版本:** <= 1.11.24

**利用条件:** 需要目标Chamilo LMS实例可公开访问

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-4220 存在于 Chamilo LMS <= 1.11.24 的 `/main/inc/lib/javascript/bigupload/inc/bigUpload.php` 文件中，这是一个未经身份验证的大文件上传接口。攻击者可以通过该接口上传恶意webshell文件，从而获得服务器的远程代码执行权限。

**有效性:**

根据漏洞库信息、搜索引擎结果以及提供的PoC代码，可以判断该PoC代码有效。漏洞库信息明确指出该漏洞允许未经身份验证的攻击者上传webshell并执行任意代码。搜索引擎结果中也包含多个关于该漏洞的描述，并指出可以远程控制服务器。提供的PoC代码包含一个 bash 脚本 (CVE-2023-4220.sh)，该脚本自动化了webshell的上传和访问过程，验证了漏洞的可利用性。

**利用方式:**

1.  攻击者执行PoC脚本，指定webshell文件路径、目标Chamilo LMS的URL以及监听端口。
2.  脚本使用curl命令上传webshell到目标服务器的 `/main/inc/lib/javascript/bigupload/files/` 目录下。
3.  脚本尝试访问上传的webshell文件，并使用 `nc` 命令在指定端口上启动监听。
4.  成功访问webshell后，攻击者即可通过监听端口与webshell进行交互，从而执行任意系统命令。

**投毒风险:**

提供的PoC代码主要包含一个bash脚本和一个README文件。通过分析bash脚本的内容，可以发现脚本主要功能是上传文件，访问文件和启动一个网络监听。脚本本身没有明显的恶意代码，但是存在以下潜在的投毒风险：

1.  **依赖的webshell文件:** webshell文件本身可能包含恶意代码，例如反弹shell，下载并执行其他恶意程序等。但是，webshell的内容不由PoC作者控制，因此不应算作PoC本身的投毒。
2.  **README文件:** README文件用于说明PoC的使用方法，通常不会包含恶意代码。
3.  **sleep 时间:** 脚本中`sleep 3`指令可能会被恶意修改,增加sleep时间或者消耗服务器资源的操作,实现隐蔽的拒绝服务攻击.

综上所述，PoC代码本身存在投毒的可能性较低，大概为10%，主要的风险来自于攻击者使用的webshell文件。

**项目地址:** [Pr1or95/CVE-2023-4220-exploit](https://github.com/Pr1or95/CVE-2023-4220-exploit)

**漏洞详情:** [CVE-2023-4220](https://nvd.nist.gov/vuln/detail/CVE-2023-4220)