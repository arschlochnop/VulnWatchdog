## CVE-2024-39943 - rejetto HFS RCE

**漏洞编号:** CVE-2024-39943

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** rejetto HFS (HTTP File Server)

**危害等级:** 高危，可完全控制服务器

**影响版本:** < 0.52.10

**利用条件:** 需要目标HFS服务器开启文件上传功能，并且攻击者具有上传权限。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2024-39943 漏洞存在于 rejetto HFS (HTTP File Server) 3 的 0.52.10 之前版本中。该漏洞允许经过身份验证的远程用户（如果他们具有上传权限）执行操作系统命令。这是因为在 Node.js 中使用 `child_process.execSync` 而不是 `child_process.spawnSync` 来执行 `df` 命令时使用了 shell。  

**有效性分析：**

提供的漏洞利用代码是一个 Node.js 应用，模拟了存在漏洞的 HFS 服务器环境。`poc.py` 脚本通过向 `/upload` 路径发送包含操作系统命令的 HTTP POST 请求来利用该漏洞。服务器接收上传的文件，读取其内容，并使用 `execSync()` 函数执行该内容，从而导致远程代码执行。POC 代码演示了通过上传包含 `echo Hello_From_Hacked_Server` 命令的文件，在服务器上成功执行该命令。

**投毒风险分析：**

分析提供的代码仓库，其中投毒风险较低。主要原因是：

*   **代码结构简单清晰：** Dockerfile, docker-compose.yml, poc.py, package.json, server.js, README.md 文件均直接可见，结构简单，易于审计。
*   **明确的漏洞利用意图：**  README.md 详细描述了漏洞原理、利用方法和 PoC 验证过程，目的明确。
*   **关键代码段突出：** `server.js` 文件中明确标出了 `execSync()` 导致漏洞的位置，方便理解。
*   **没有发现可疑代码：**  检查了所有文件，没有发现任何试图建立反向 shell、下载恶意文件或执行其他恶意操作的可疑代码。

虽然投毒风险较低，但仍存在极小的可能性，例如作者未来可能更新仓库添加恶意代码。因此，建议在使用任何第三方代码时，始终进行仔细的代码审查。

**利用方式总结：**

1.  攻击者需要拥有目标 HFS 服务器的账号，并且该账号具有文件上传权限。
2.  攻击者构造包含恶意操作系统命令的文件。例如，包含 `echo Hello_From_Hacked_Server` 命令的 `exploit.txt` 文件。
3.  攻击者使用 `poc.py` 脚本或者其他 HTTP 客户端工具，向目标服务器的 `/upload` 路径发送 HTTP POST 请求，并将包含恶意命令的文件作为 `file` 参数上传。
4.  目标服务器接收到上传的文件后，读取其内容，并使用 `execSync()` 函数执行该内容，从而导致远程代码执行。
5.  攻击者通过查看服务器的响应或者其他方式，获取命令执行结果，并进一步控制服务器。

**项目地址:** [JenmrR/Node.js-CVE-2024-39943](https://github.com/JenmrR/Node.js-CVE-2024-39943)

**漏洞详情:** [CVE-2024-39943](https://nvd.nist.gov/vuln/detail/CVE-2024-39943)