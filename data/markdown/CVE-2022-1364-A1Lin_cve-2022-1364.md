## CVE-2022-1364 - Chrome V8 Turbofan 类型混淆漏洞

**漏洞编号:** CVE-2022-1364

**漏洞类型:** 类型混淆

**影响应用:** Google Chrome

**危害等级:** 高危，可能导致堆损坏和任意代码执行

**影响版本:** < 100.0.4896.127

**利用条件:** 用户访问恶意构造的HTML页面

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-1364 是 Google Chrome V8 Turbofan 中的一个类型混淆漏洞。该漏洞允许远程攻击者通过精心设计的 HTML 页面利用堆损坏漏洞。根据CISA的信息，该漏洞已被积极利用。提供的漏洞利用代码 `exp.html` 尝试利用此漏洞。下面对代码进行分析：

1.  **漏洞触发:** `foo()` 函数是漏洞触发的关键。它利用了 V8 的优化过程中的类型推断错误，导致对象属性的类型混淆。
2.  **信息泄露和地址计算:** `bar()` 函数利用 `foo()` 函数创建的类型混淆，创建一个 Map 对象，并向其中添加对象。这导致了内存中的对象布局可以被预测。然后，`addrof()` 函数用于计算对象的地址，`read()` 和 `write()` 函数用于读取和写入任意内存地址。这些函数依赖于`oob`数组实现越界读写。
3.  **利用 WebAssembly:** 该漏洞利用代码使用 WebAssembly 获取可读写可执行内存页面的地址。`wasmCode`定义了一个简单的wasm模块, 通过`addrof`计算`wasmInstance`地址, 然后通过wasm实例获取rwx内存页面的地址。
4.  **Shellcode 注入和执行:** 该漏洞利用代码将 shellcode 复制到可执行内存页，然后执行。在这里，shellcode 是 `[254, 255, 255, 234]` (0xfa, 0xff, 0xff, 0xea), 这通常不是一个完整的shellcode。可能是作者简化了shellcode，或者这仅仅是一个测试shellcode.

**有效性评估:**

该漏洞利用代码利用了类型混淆漏洞来实现任意代码执行。该漏洞需要对 V8 引擎的内部结构有深入的了解。该 POC 已经被标记为有效，并被 CISA 列入已知被利用的漏洞。

**投毒风险评估:**

分析提供的代码，没有发现明显的恶意代码或后门。Shellcode `[254, 255, 255, 234]` 可能是一个无害的操作。代码的目的是为了验证漏洞的存在并实现代码执行。如果实际应用，则shellcode 会替换为攻击者想要执行的恶意代码。

**漏洞利用方式总结:**

1.  利用类型混淆漏洞，导致对象属性的类型混淆。
2.  利用类型混淆漏洞，实现越界读取和写入。
3.  利用 WebAssembly 获取可读写可执行内存页面的地址。
4.  将 shellcode 复制到可执行内存页，然后执行。

**项目地址:** [A1Lin/cve-2022-1364](https://github.com/A1Lin/cve-2022-1364)

**漏洞详情:** [CVE-2022-1364](https://nvd.nist.gov/vuln/detail/CVE-2022-1364)