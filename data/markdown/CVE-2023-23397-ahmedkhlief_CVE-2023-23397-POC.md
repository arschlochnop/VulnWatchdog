## CVE-2023-23397

**漏洞编号:** CVE-2023-23397

**漏洞类型:** 权限提升

**影响应用:** Microsoft Outlook

**危害等级:** 严重，可能导致NTLM Relay攻击

**影响版本:** 受影响版本见漏洞库信息

**利用条件:** 攻击者需要发送特制的邮件或日历邀请给受害者

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-23397 是一个 Microsoft Outlook 的权限提升漏洞。攻击者可以通过发送包含恶意 `PidLidReminderFileParameter` 属性的电子邮件、日历邀请或任务请求来利用此漏洞。当 Outlook 处理此属性时，它会尝试连接到攻击者控制的 UNC 路径，从而强制 Outlook 对攻击者控制的服务器进行身份验证，从而允许 NTLM 中继攻击。漏洞利用方式如下：

1.  **攻击者构造恶意数据：** 攻击者创建一个包含恶意 `PidLidReminderFileParameter` 属性的 Outlook 项目（例如，日历邀请）。此属性指向攻击者控制的 UNC 路径。
2.  **发送给受害者：** 攻击者将此恶意 Outlook 项目发送给受害者。
3.  **Outlook 处理：** 当受害者的 Outlook 客户端处理此项目时，它会尝试访问指定的 UNC 路径，触发 NTLM 身份验证。
4.  **NTLM 中继：** 攻击者可以使用 NTLM 中继攻击来冒充受害者或执行其他恶意操作。

**关于代码的分析：**

提供的 C# 代码片段 `Appointment.cs` 似乎是用于创建和操作 Outlook 约会对象的库的一部分。虽然代码本身没有明显的恶意行为，但重要的是要检查完整的代码库，包括 MsgKit 库的其他部分，以寻找潜在的漏洞或后门。由于MsgKit是一个开源项目，被投毒的可能性较低，但仍然存在风险。

**投毒风险评估：**

评估投毒风险需要检查整个 MsgKit 代码库以及构建和分发过程。在没有完整代码审查的情况下，无法确定代码中是否存在隐藏的恶意代码。但根据以往经验，开源项目的投毒风险较低。此处给出的10% 是基于以下判断：攻击者可能通过提交恶意PR的方式，在不引人注意的情况下添加恶意代码，或者利用MsgKit库的其他漏洞进行攻击。

**有效性评估：**

根据搜索结果，CVE-2023-23397 是一个已知且被积极利用的漏洞，并且有可用的PoC。该漏洞利用的关键在于 `PidLidReminderFileParameter` 属性的处理。代码片段 `Appointment.cs` 似乎与构造包含该属性的 Outlook 对象有关。因此，只要攻击者可以控制 `PidLidReminderFileParameter` 的值，就可以触发该漏洞。

综上所述，该漏洞利用是有效的，并且被广泛利用。

**项目地址:** [ahmedkhlief/CVE-2023-23397-POC](https://github.com/ahmedkhlief/CVE-2023-23397-POC)

**漏洞详情:** [CVE-2023-23397](https://nvd.nist.gov/vuln/detail/CVE-2023-23397)