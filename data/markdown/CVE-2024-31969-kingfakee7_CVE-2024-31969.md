## CVE-2024-31969-sudo-本地提权

**漏洞编号:** CVE-2024-31969

**漏洞类型:** 本地提权

**影响应用:** sudo

**危害等级:** 高危，允许本地用户以root权限执行任意命令

**影响版本:** 1.9.0 -> 1.9.15p4

**利用条件:** 用户在sudoers文件中拥有sudoedit权限

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2024-31969是sudo版本1.9.0到1.9.15p4中存在的一个本地权限提升漏洞。该漏洞源于`sudoedit`命令对用户环境变量和文件所有权的验证不充分。攻击者可以利用`SUDO_EDITOR`等环境变量或通过符号链接操纵文件，从而以root权限修改任意文件。

**漏洞利用方式：**

1.  **环境准备：** 需要存在一个允许用户通过`sudoedit`编辑文件的sudoers配置。
2.  **漏洞验证：** 提供的POC脚本首先检查sudo版本，如果版本在1.9.0到1.9.15p4之间，则继续进行漏洞验证。  
3.  **利用过程：** 通过设置`SUDO_EDITOR`环境变量为恶意命令（例如，`bash -c 'echo hacked > /tmp/hackedfile'`），然后使用`sudoedit`命令编辑目标文件（`/tmp/hackedfile`）。 由于`sudoedit`使用root权限执行`SUDO_EDITOR`中指定的命令，因此可以以root权限写入`/tmp/hackedfile`文件。脚本会检测文件内容和权限判断是否提权成功。

**有效性评估：**

根据漏洞信息和提供的POC代码，该漏洞利用是有效的。如果目标系统的sudo版本在受影响范围内，并且用户拥有sudoedit权限，则可以成功利用该漏洞进行本地提权。

**投毒风险评估：**

查看提供的POC代码，主要功能是验证是否存在CVE-2024-31969漏洞，通过判断Sudo版本，然后使用SUDO_EDITOR执行echo命令。其中风险点在于SUDO_EDITOR的内容是可控的，但也仅仅是echo命令。并没有发现其它恶意操作。因此，投毒风险较低，评估结果为1%。主要风险是用户错误使用或修改POC，导致意外的文件写入或其他系统问题。 仓库的README.md提示只做教育用途。

**项目地址:** [kingfakee7/CVE-2024-31969](https://github.com/kingfakee7/CVE-2024-31969)

**漏洞详情:** [CVE-2024-31969](https://nvd.nist.gov/vuln/detail/CVE-2024-31969)