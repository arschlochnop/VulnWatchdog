## CVE-2020-16898 Windows TCP/IP 远程代码执行漏洞

**漏洞编号:** CVE-2020-16898

**漏洞类型:** 远程代码执行

**影响应用:** Windows TCP/IP 协议栈

**危害等级:** 高危，可导致远程代码执行甚至蓝屏死机（BSOD）

**影响版本:** Windows 10 Version 1709, 1803, 1809, 1903, 1909, 2004 和 Windows Server 2019, version 1903, version 2004

**利用条件:** 攻击者需要与目标主机在同一网络中，并知道目标主机的IPv6地址（特别是本地链路地址）。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2020-16898 是一个 Windows TCP/IP 协议栈中的远程代码执行漏洞，当协议栈不正确处理 ICMPv6 路由器通告（Router Advertisement）数据包时，可能触发此漏洞。攻击者可以发送特制的 ICMPv6 路由器通告数据包到目标 Windows 计算机，从而获得在目标服务器或客户端上执行代码的能力。根据搜索结果，成功利用此漏洞可能导致蓝屏死机（BSOD），并可能被用于远程代码执行。漏洞出现在处理Option Type 25的ICMPv6 RA包时。

**漏洞利用方式：**

1.  **发送特制的 ICMPv6 数据包：** 攻击者需要构造包含恶意选项的 ICMPv6 路由器通告数据包。
2.  **利用 RDNSS 选项：** 漏洞利用通常涉及操纵 RDNSS (Recursive DNS Server) 选项，通过修改其长度和内容，来触发栈溢出。
3.  **碎片化处理：** 漏洞利用代码中使用了 IPv6 碎片化，将数据包分成小片段发送，以便绕过某些安全检测机制或更有效地触发漏洞。
4.  **覆盖返回地址：** 成功利用漏洞需要覆盖栈上的返回地址，以便在函数返回时执行攻击者控制的代码。

**有效性评估：**

提供的漏洞利用代码 (CVE-2020-16898-exp1.py 和 CVE-2020-16898.py) 似乎有效，至少可以触发蓝屏死机。根据 README 文件和代码注释，这些代码经过测试，并且需要修改目标 IPv6 地址才能使用。exp1 通过构造包含特定长度和内容的 ICMPv6 路由器通告数据包来利用漏洞，exp2 则是通过发送两个精心构造的 RDNSS 选项，触发栈溢出。

**投毒风险评估：**

虽然提供的代码主要用于触发 BSOD，但如果恶意修改，也可能被用于执行任意代码。仓库中的投毒风险较低，约为5%。主要风险点在于:

*   **payload的植入：** 攻击者可能会修改exp, 在exp的Overwrite部分植入恶意payload,当触发漏洞时,执行攻击者植入的payload.
*   **源地址欺骗：** 虽然exp文件注释显示可以伪造源地址，可能被用于中间人攻击或放大攻击。

总体来说，虽然直接的投毒代码并不明显，但攻击者可能通过修改提供的 PoC 代码来实现恶意目的。因此，在使用这些代码时需要格外小心，并在隔离环境中进行测试。

**项目地址:** [komomon/CVE-2020-16898--EXP-POC](https://github.com/komomon/CVE-2020-16898--EXP-POC)

**漏洞详情:** [CVE-2020-16898](https://nvd.nist.gov/vuln/detail/CVE-2020-16898)