## CVE-2018-0114-Node-jose-JWT 签名绕过

**漏洞编号:** CVE-2018-0114

**漏洞类型:** JWT 签名绕过

**影响应用:** Node-jose Library

**危害等级:** 高危，可能导致身份伪造和权限提升

**影响版本:** < 0.11.0

**利用条件:** 应用程序使用存在漏洞的 node-jose 库处理 JWT 令牌

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2018-0114 漏洞存在于 Cisco 的 node-jose 开源库 0.11.0 之前的版本中。攻击者可以利用该漏洞，通过在 JWT 头部嵌入包含攻击者公钥的 JSON Web Key (JWK)，然后使用与该公钥关联的私钥重新签名令牌，从而绕过签名验证。服务器会信任 JWT 头部中嵌入的公钥，用于验证签名，这使得攻击者可以伪造有效的 JWT 令牌。

**有效性评估：**

提供的 POC 代码 `jwt_attacker_gen.py` 似乎有效。代码的主要逻辑是：

1.  生成新的 RSA 密钥对。
2.  解析原始 JWT 令牌，提取头部和载荷。
3.  从新生成的公钥中提取 `n` (模数) 和 `e` (指数)，并将其注入到 JWT 头部中的 `jwk` 对象中。
4.  修改 JWT 载荷中的目标字段。
5.  使用新生成的私钥对修改后的 JWT 重新签名。
6.  利用脚本生成的 payload 替换原始 payload，成功绕过身份验证。

**投毒风险评估：**

代码中存在轻微的投毒风险。虽然核心逻辑是利用 CVE-2018-0114 漏洞，但代码中可能存在以下潜在的投毒点：

*   **依赖项风险：** `jwt_attacker_gen.py` 依赖于多个第三方库，如 `cryptography`, `Crypto`, `jwcrypto`, `jwt`。这些库本身可能存在安全漏洞或被恶意篡改，从而引入安全风险。尽管这些库是常用的，但仍然存在潜在的供应链攻击风险。
*   **后门风险：**虽然代码结构清晰，功能明确，没有发现明显的恶意代码或后门，但作者可以在不影响主要功能的情况下，植入隐蔽的恶意代码，例如收集用户信息、执行任意代码等。

综合考虑，投毒风险评估为 10%。

**利用方式分析：**

1.  **获取目标 JWT 令牌：** 攻击者首先需要获取一个由目标应用程序生成的 JWT 令牌。
2.  **生成新的 RSA 密钥对：** 使用提供的脚本生成一个新的 RSA 密钥对。
3.  **修改 JWT 头部：** 将原始 JWT 头部中的 `jwk` 对象替换为包含攻击者公钥的 JWK 对象。或者，如果原始头部中已经存在 `jwk` 对象，则更新其 `n` 和 `e` 字段。
4.  **修改 JWT 载荷：** 根据需要修改 JWT 载荷中的声明。
5.  **重新签名 JWT：** 使用攻击者生成的私钥对修改后的 JWT 重新签名。
6.  **利用伪造的 JWT：** 将伪造的 JWT 令牌提交给目标应用程序。由于应用程序信任 JWT 头部中的公钥，因此会错误地验证伪造的签名，从而允许攻击者绕过身份验证。

**项目地址:** [amr9k8/jwt-spoof-tool](https://github.com/amr9k8/jwt-spoof-tool)

**漏洞详情:** [CVE-2018-0114](https://nvd.nist.gov/vuln/detail/CVE-2018-0114)