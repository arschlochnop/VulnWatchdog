## CVE-2014-4725 MailPoet Newsletters 插件远程代码执行

**漏洞编号:** CVE-2014-4725

**漏洞类型:** 远程代码执行

**影响应用:** WordPress MailPoet Newsletters 插件

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** 2.6.7 之前版本

**利用条件:** 目标网站安装了存在漏洞的 MailPoet Newsletters 插件，且允许未经身份验证的访问 wp-admin/admin-post.php

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2014-4725 漏洞存在于 WordPress 的 MailPoet Newsletters 插件中，允许未经身份验证的攻击者通过上传恶意主题压缩包，在服务器上执行任意 PHP 代码。 

**漏洞利用方式：**

1.  攻击者首先构造一个包含恶意 PHP 代码的主题压缩包 (zip 文件)。该 PHP 代码可以执行任意系统命令或植入后门。
2.  攻击者利用`wp-admin/admin-post.php`接口，通过 POST 请求上传恶意主题压缩包。请求中需要包含`action=themeupload`等参数，绕过身份验证。
3.  上传成功后，恶意主题文件会被解压到`wp-content/uploads/wysija/themes/mailp/`目录下。
4.  攻击者可以通过访问恶意 PHP 文件的 URL (例如 `http://target/wp-content/uploads/wysija/themes/mailp/evil.php`) 来执行其中的恶意代码，从而控制服务器。

**POC 代码分析：**

提供的 exploit.py 脚本实现了自动化利用该漏洞的功能。脚本包含以下功能：

*   **扫描模式 (--scan):**  用于检测目标网站是否安装了存在漏洞的 MailPoet Newsletters 插件，并验证其是否容易受到攻击。通过访问`wp-admin/admin-post.php?page=wysija_campaigns&action=themes`检查响应内容中是否包含`themeupload`字符串来判断目标是否存在漏洞。
*   **利用模式 (--exploit):**  用于上传恶意主题压缩包到已确认存在漏洞的目标网站。 需要指定目标列表文件和包含恶意 PHP 代码的 payload zip 文件。

**投毒风险分析：**

虽然POC代码主要功能是漏洞利用，但是依旧存在潜在的投毒风险，主要体现在以下几个方面：

1.  **Payload 的控制权：**  `exploit.py` 脚本允许攻击者指定任意 payload zip 文件。 如果攻击者下载和使用其他来源的 payload，可能会被诱骗使用包含恶意代码的 payload。例如，该 payload 可能会在目标网站上植入隐藏的后门，用于长期控制，或者窃取敏感信息。
2.  **shell.txt 文件：** 脚本会将shell的url写入shell.txt文件中，攻击者可能会修改脚本，导致shell.txt的内容指向恶意网站。
3.  **pwdnx 模块：** 脚本调用了pwdnx模块的printmodule函数，虽然此模块没有给出具体代码，但是不排除pwdnx模块存在风险，例如搜集用户信息，或者植入其他恶意代码。

综合考虑，该仓库存在一定的投毒风险，大概占比10%。 用户在使用该脚本时，应该仔细检查 payload zip 文件的内容，以及脚本的逻辑，确保其安全性。 尤其是引用的pwdnx模块，应保持警惕。

**项目地址:** [Pwdnx1337/MASS-CVE-2014-4725](https://github.com/Pwdnx1337/MASS-CVE-2014-4725)

**漏洞详情:** [CVE-2014-4725](https://nvd.nist.gov/vuln/detail/CVE-2014-4725)