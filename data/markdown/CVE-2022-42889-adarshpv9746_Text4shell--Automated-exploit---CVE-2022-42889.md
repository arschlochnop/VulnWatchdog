## CVE-2022-42889-Apache Commons Text-RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行

**影响应用:** Apache Commons Text

**危害等级:** 高危，允许未经身份验证的攻击者执行任意命令

**影响版本:** < 1.10.0 (1.5-1.9)

**利用条件:** 应用程序使用受影响版本的Apache Commons Text，并且允许用户可控的输入传递给文本插值函数

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-42889（又名Text4Shell）是Apache Commons Text库中的一个漏洞，它允许攻击者通过变量插值执行任意代码。该漏洞存在于1.5到1.9版本中。漏洞利用方式是，攻击者可以向应用程序提供包含恶意表达式的输入，例如`${script:javascript:java.lang.Runtime.getRuntime().exec('command')}`。当应用程序使用Commons Text处理此输入时，该表达式将被解析和执行，从而导致远程代码执行。

**有效性评估：**
提供的POC代码似乎有效，因为它演示了如何使用`script`前缀执行任意命令。 Dockerfile 和 README.md 文件描述了如何构建和运行一个易受攻击的应用程序，`exploit.php` 文件构造了利用此漏洞的有效载荷。从搜索结果来看，该漏洞是一个高危漏洞，已经被广泛研究和利用。

**投毒风险分析：**
该仓库中存在潜在的投毒风险，但概率较低。以下是一些需要考虑的因素：

*   `install.sh` 和 `stop-app.sh` 脚本包含一些危险的命令，例如 `sudo` 命令以及`docker kill $(sudo docker ps -q)`。虽然这是为了快速启动和停止 docker 环境，但是也可能会被恶意使用，例如，如果攻击者控制了这些脚本，他们可以利用 `sudo` 命令来执行恶意操作。
*   `exploit.php` 文件中的 `$ip = "172.17.0.1";` 可能是一个陷阱。如果攻击者直接使用这段代码，他们的反向shell可能无法连接，从而暴露出攻击者。

考虑到作者的意图是演示漏洞利用，而并非恶意攻击，将此代码判定为投毒代码的概率为10%。

**利用方式：**
1.  构建和运行易受攻击的应用程序。
2.  构造包含恶意表达式的输入，例如 `${script:javascript:java.lang.Runtime.getRuntime().exec('command')}`。
3.  将此输入传递给应用程序的文本插值函数。
4.  表达式将被解析和执行，从而导致远程代码执行。`exploit.sh`和`exploit.php` 文件提供了一种自动化的利用方式，利用`nc`进行反弹shell。

**项目地址:** [adarshpv9746/Text4shell--Automated-exploit---CVE-2022-42889](https://github.com/adarshpv9746/Text4shell--Automated-exploit---CVE-2022-42889)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)