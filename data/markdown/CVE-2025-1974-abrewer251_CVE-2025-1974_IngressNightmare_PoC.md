## CVE-2025-1974_IngressNightmare

**漏洞编号:** CVE-2025-1974

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** kubernetes ingress-nginx

**危害等级:** 高危，可能导致集群范围内的Secrets泄露和完全控制

**影响版本:** <= 1.11.4 和 1.12.0

**利用条件:** 需要对Pod网络的访问权限

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2025-1974 允许未经身份验证的攻击者，如果他们可以访问 Pod 网络，则可以在 ingress-nginx 控制器的上下文中实现任意代码执行。这可能导致泄露控制器可以访问的 Secrets（在默认安装中，控制器可以访问集群范围内的所有 Secrets）。

**有效性分析：**
根据漏洞库信息、搜索引擎结果和提供的PoC代码，该漏洞是有效的。漏洞等级为严重，CVSS评分为9.8。多个安全厂商博客文章（例如sysdig、wiz、arcticwolf、fortinet）确认了该漏洞的存在，并将其描述为“IngressNightmare”，表明这是一个真实且危险的漏洞。

提供的PoC代码（`poc.py`和`poc.json`）旨在自动化利用该漏洞的过程。`poc.py` 脚本通过 `curl` 向目标 IP 地址列表发送包含 JSON payload 的 HTTPS POST 请求。它会捕获响应，并将结果分类为成功或失败，然后生成 XML 报告。

`poc.json` 文件包含一个 AdmissionReview 对象，该对象用于发送恶意配置到Validating Admission Controller。

**投毒风险分析：**
该PoC代码主要目的是发送恶意请求并记录响应，没有明显的恶意行为。但仍然存在一定的投毒风险，大约为5%。

*   `poc.py` 脚本可能会被修改为包含额外的恶意代码，例如，在成功利用漏洞后执行某些操作（例如，安装后门、删除日志等）。
*   `poc.json` 文件可能会包含更复杂的 payload，这些 payload 不仅利用 CVE-2025-1974，还试图利用其他潜在的漏洞。
*   脚本在处理IP列表时,如果没有做严格的过滤,可能会误导使用者攻击非授权的目标。

**利用方式：**
1.  **攻击者需要能够访问 Kubernetes 集群的 Pod 网络。**
2.  **攻击者使用 `poc.py` 脚本指定目标 IP 地址列表（即 ingress-nginx 控制器的 IP 地址）以及包含恶意 payload 的 `poc.json` 文件。**
3.  **`poc.py` 脚本向每个目标 IP 地址发送一个 HTTPS POST 请求，其中包含 `poc.json` 中的 AdmissionReview 对象。**
4.  **ingress-nginx 控制器中的 Validating Admission Controller 在处理恶意 AdmissionReview 对象时，由于存在漏洞，会允许攻击者执行任意代码。**
5.  **攻击者可以利用执行的代码来访问集群中的 Secrets 或执行其他恶意操作。**

**项目地址:** [abrewer251/CVE-2025-1974_IngressNightmare_PoC](https://github.com/abrewer251/CVE-2025-1974_IngressNightmare_PoC)

**漏洞详情:** [CVE-2025-1974](https://nvd.nist.gov/vuln/detail/CVE-2025-1974)