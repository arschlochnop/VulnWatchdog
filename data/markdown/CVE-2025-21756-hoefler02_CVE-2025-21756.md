## CVE-2025-21756-Linux Kernel vsock Use-After-Free

**漏洞编号:** CVE-2025-21756

**漏洞类型:** Use-After-Free

**影响应用:** Linux Kernel

**危害等级:** 高危，可能导致内核崩溃、权限提升或信息泄露

**影响版本:** Linux kernel versions before the fixes mentioned in the CVE details (e.g., versions before specific commits in the git repository). Affected versions include 5.5 and potentially some versions in the 5.10, 5.15, 6.1, 6.6, 6.12, and 6.13 series.

**利用条件:** 需要本地用户权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2025-21756是Linux内核vsock(虚拟套接字)实现中的一个释放后使用(Use-After-Free)漏洞。该漏洞源于套接字绑定在传输重新分配期间未正确保留，导致在`vsock_bind`函数中对已释放的套接字内存进行访问。攻击者可以利用此漏洞导致内核崩溃、权限提升或信息泄露。

**有效性分析：**

提供的漏洞利用代码看起来是针对此漏洞的，包括了重现漏洞所需的步骤，例如创建和绑定vsock套接字。该代码包含编译脚本(compress.sh)，用于创建包含exploit的initramfs镜像。`run.sh`脚本使用QEMU启动一个包含易受攻击内核的虚拟机，并挂载创建的initramfs。`x.c`是利用代码,它使用了AF_VSOCK相关socket api。
漏洞利用代码`x.c`尝试触发Use-After-Free漏洞，利用`query_vsock_diag`函数,并尝试获取shell。

**投毒风险分析：**

该仓库中存在投毒代码的风险较低，估计为10%。以下是原因：

*   `readme.md`文件声明这是一个漏洞利用程序，并链接到CVE详细信息。
*   `run.sh` 脚本使用 `-nographic` 和 `-monitor /dev/null` 参数，这表明该脚本旨在运行一个headless VM，不太可能包含恶意交互。
*   代码中可能存在后门或恶意逻辑的潜在位置是 `get_shell()` 函数，但该函数只是检查用户 ID 是否为 0，如果为 0 则启动一个 shell。 这在漏洞利用上下文中是合理的。但是，仍然存在轻微风险，即可以修改该函数以执行恶意操作，但概率较低。

**利用方式分析：**

利用方式涉及以下步骤：

1.  **构建环境：** 使用提供的脚本和内核镜像设置易受攻击的Linux内核环境（使用QEMU）。
2.  **编译Exploit：** 使用`compress.sh`脚本编译C代码 (`x.c`) 并创建包含编译后的可执行文件的initramfs镜像。
3.  **触发漏洞：** 在虚拟机中执行利用程序。 该利用程序利用vsock套接字API来触发`vsock_bind`函数中的Use-After-Free漏洞。`query_vsock_diag` 函数被用来辅助漏洞触发。
4.  **权限提升（如果成功）：** 如果成功利用该漏洞，该程序将尝试通过`get_shell`函数获得root shell。

该漏洞是本地权限提升漏洞，需要用户在系统上运行该利用程序。

**项目地址:** [hoefler02/CVE-2025-21756](https://github.com/hoefler02/CVE-2025-21756)

**漏洞详情:** [CVE-2025-21756](https://nvd.nist.gov/vuln/detail/CVE-2025-21756)