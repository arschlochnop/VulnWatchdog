## CVE-2016-10033-PHPMailer-远程代码执行

**漏洞编号:** CVE-2016-10033

**漏洞类型:** 远程代码执行

**影响应用:** PHPMailer

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** < 5.2.18

**利用条件:** 目标系统运行受影响的PHPMailer版本，并且PHP配置为使用sendmail，`sendmail_path`已定义并可访问。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2016-10033 存在于 PHPMailer 5.2.18 之前的版本中。该漏洞是由于 `mailSend` 函数在 `isMail` 传输中，未正确处理 PHP 内置的 `mail()` 函数的 `$additional_parameters` 参数引起的。攻击者可以通过构造恶意的 Sender 属性，在其中注入反斜杠双引号 `\"`，从而向 sendmail 命令传递额外的参数。 

**利用方式：**

1.  攻击者通过POST请求，修改email字段，将payload注入到`email`字段中。
2.  Payload精心构造，包含反斜杠双引号，用于注入额外的 sendmail 参数。
3.  被注入的参数 `-OQueueDirectory=/tmp -X/var/www/html/shell.php`  会将邮件队列目录设置为 /tmp，并将邮件内容写入到 web 目录下的 shell.php 文件中。
4.  攻击者访问 shell.php 文件，触发其中的PHP代码，反弹shell到攻击者的监听端口。

**有效性：**
根据提供的漏洞信息、搜索结果和POC代码，该漏洞利用的有效性较高。漏洞库信息和搜索结果都表明这是一个已知的、可被利用的远程代码执行漏洞。提供的POC代码也较为完整，描述了利用步骤和所需的参数。

**投毒风险：**
POC 代码中可能存在的潜在投毒风险较低，大概在10%左右。虽然 POC 总体上是合法的漏洞利用，但存在以下可能的问题：

*   **硬编码的IP地址和端口：** POC 使用了硬编码的 IP 地址（`<ip_address>`）和端口（4444）来建立反向 shell。攻击者在实际使用中必须修改这些值，否则可能会将 shell 连接到意外的目标。

*   **代理设置：** POC 使用了代理 `http://127.0.0.1:8080`。这可能是为了方便测试或绕过某些限制，但也可能误导用户，导致他们在使用时出现问题。在未设置代理的情况下直接运行POC，可能导致利用失败。

*   **文件写入位置：**` -X/var/www/html/shell.php` ，这个目录取决于目标的web根目录配置，如果根目录不是/var/www/html, 则利用失败。

这些因素可能会导致利用失败，或者在某些情况下造成不必要的风险。因此，用户在使用 POC 时应仔细检查并修改相关参数，确保其符合实际情况。

**项目地址:** [alexander47777/CVE-2016-10033](https://github.com/alexander47777/CVE-2016-10033)

**漏洞详情:** [CVE-2016-10033](https://nvd.nist.gov/vuln/detail/CVE-2016-10033)