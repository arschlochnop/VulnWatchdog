## CVE-2022-27925-Zimbra-路径遍历导致远程代码执行

**漏洞编号:** CVE-2022-27925

**漏洞类型:** 路径遍历/远程代码执行

**影响应用:** Zimbra Collaboration Suite (ZCS)

**危害等级:** 高危，未经授权的管理员可以上传任意文件，导致远程代码执行

**影响版本:** 8.8.15 and 9.0

**利用条件:** 需要目标服务器开启mboximport功能，攻击者需要具备管理员权限，或利用认证绕过漏洞。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

该漏洞存在于Zimbra Collaboration Suite的mboximport功能中。经过身份验证的管理员用户（或利用未经身份验证的漏洞）可以通过上传包含路径遍历字符的恶意ZIP文件，将任意文件写入到服务器的文件系统上。利用提供的POC代码，攻击者首先上传一个包含恶意JSP webshell的ZIP文件到服务器的`/opt/zimbra/jetty/webapps/zimbraAdmin/`目录下，然后通过访问该JSP webshell执行任意命令。POC代码包含删除webshell的选项，可防止进一步的滥用。由于该代码仅仅是利用了漏洞，并没有额外添加恶意代码，因此不存在投毒风险。

利用方式：

1.  攻击者构建一个包含恶意JSP文件的ZIP压缩包，该JSP文件包含执行系统命令的功能。
2.  攻击者通过POST请求将该ZIP文件上传到` /service/extension/backup/mboximport?account-name=admin&account-status=1&ow=cmd` 或者 `/service/extension/backup/mboximport?account-name=admin&ow=2&no-switch=1&append=1`端点。
3.  如果上传成功，攻击者可以通过访问上传的JSP文件，例如`/zimbraAdmin/cmd.jsp?cmd=<command>`来执行任意系统命令。
4.  POC代码还提供了删除上传的webshell的功能，通过访问`/zimbraAdmin/cmd.jsp?cmd=rm -rf /opt/zimbra/jetty/webapps/zimbraAdmin/cmd.jsp`来删除webshell。

**项目地址:** [mohamedbenchikh/CVE-2022-27925](https://github.com/mohamedbenchikh/CVE-2022-27925)

**漏洞详情:** [CVE-2022-27925](https://nvd.nist.gov/vuln/detail/CVE-2022-27925)