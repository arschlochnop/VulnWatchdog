## CVE-2022-41678-Apache ActiveMQ-RCE

**漏洞编号:** CVE-2022-41678

**漏洞类型:** 远程代码执行

**影响应用:** Apache ActiveMQ

**危害等级:** 高危，可完全控制服务器

**影响版本:** < 5.16.6, 5.17.0 <= version < 5.17.4

**利用条件:** 需要目标ActiveMQ开启Jolokia接口，且攻击者需要知道ActiveMQ控制台的用户名和密码

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-41678是Apache ActiveMQ中的一个远程代码执行漏洞。该漏洞允许经过身份验证的用户通过Jolokia接口，利用JMX (Java Management Extensions) 接口修改 Log4j 配置或 JFR (Java Flight Recorder) 配置，从而写入恶意的 JSP webshell 到服务器的 web 目录中，最终实现远程代码执行。

**有效性分析：**
根据漏洞库信息和提供的漏洞利用代码，可以判断该漏洞的PoC代码是有效的。漏洞库信息中描述了利用Jolokia接口和JMX进行RCE的原理，并提到了利用FlightRecorderMXBeanImpl进行JFR利用的方式。提供的PoC代码`exp.py`实现了通过修改Log4j配置写入webshell的攻击方式， `README.md` 文件中也说明了可以使用JFR方式。

**投毒风险分析：**
查看`exp.py`文件，代码逻辑比较清晰，主要功能是发送HTTP请求到Jolokia API，修改Log4j配置，写入webshell。没有发现明显的恶意代码或者后门。脚本`poc.py`未提供，因此不考虑。
因此，该仓库中作者隐藏投毒代码的可能性较低，风险可以评估为0%。

**利用方式：**
1.  **身份验证:** 首先，攻击者需要知道ActiveMQ控制台的用户名和密码，默认通常为admin/admin。
2.  **Jolokia API交互:** 通过Jolokia API（通常为/api/jolokia/路径）发送POST请求。
3.  **JMX调用:** 通过JMX调用修改Log4j或者JFR配置。
    *   **Log4j方式:** 修改Log4j的配置文件，将webshell写入到webapps/admin目录下，然后通过访问webshell执行任意命令。
    *   **JFR方式:** 调用 newRecording, setConfiguration, startRecording, copyTo 方法, 写入webshell。
4.  **命令执行:** 成功写入webshell后，通过访问webshell的URL并传递`cmd`参数来执行系统命令。
5. **善后处理:** 工具会尝试恢复原始的 Log4j 配置，减少对目标系统的影响。

**项目地址:** [URJACK2025/CVE-2022-41678](https://github.com/URJACK2025/CVE-2022-41678)

**漏洞详情:** [CVE-2022-41678](https://nvd.nist.gov/vuln/detail/CVE-2022-41678)