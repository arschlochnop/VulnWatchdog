## CVE-2023-25157-GeoServer-SQL注入

**漏洞编号:** CVE-2023-25157

**漏洞类型:** SQL注入

**影响应用:** GeoServer

**危害等级:** 高危，可能导致数据泄露和远程代码执行

**影响版本:** < 2.21.4, >= 2.22.0, < 2.22.2

**利用条件:** 需要网络访问，GeoServer实例运行，存在可访问的WFS/WMS/WCS服务。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

根据漏洞信息和搜索结果，CVE-2023-25157是GeoServer中的一个SQL注入漏洞。漏洞存在于OGC Filter表达式语言和OGC Common Query Language (CQL) 的处理中，影响Web Feature Service (WFS)、Web Map Service (WMS) 协议以及Web Coverage Service (WCS)协议中ImageMosaic coverages对CQL的支持。

**有效性：**
提供的`docker-compose.yml`文件设置了一个包含易受攻击的GeoServer实例(2.22.1)的环境，它依赖于PostGIS数据库。 `startup.sh`启动脚本如果包含恶意代码，则能成功搭建环境并执行攻击，验证此漏洞的存在。综合搜索引擎结果和漏洞库信息,漏洞利用是有效的。

**投毒风险：**
`docker-compose.yml` 文件本身并不包含恶意代码，但它挂载了`./startup.sh`脚本，这引入了投毒的可能。如果 `startup.sh` 包含任何恶意指令 (例如下载并执行恶意脚本、修改GeoServer配置以允许未授权访问、或安装后门)，那么该仓库就存在投毒风险。在没有`startup.sh` 脚本内容的情况下，无法完全确定投毒的程度，推测投毒概率为10%。 谨慎使用此仓库。

**利用方式：**
该漏洞的利用方式通常涉及构造恶意的CQL或OGC Filter表达式，将其注入到WFS/WMS/WCS请求的参数中。由于GeoServer没有正确过滤这些表达式，恶意SQL代码会被执行，从而可能允许攻击者执行任意SQL命令，包括读取、修改或删除数据库中的数据，甚至执行操作系统命令（如果数据库配置允许）。攻击者可能通过 `PropertyIsLike` filter（配合String字段和任意数据库DataStore，或PostGIS DataStore且开启 encode functions）或 `FeatureId` 配合不安全的设置触发漏洞。修复方案包括升级到指定版本或禁用/启用相应的PostGIS Datastore设置。

**项目地址:** [custiya/geoserver-CVE-2023-25157](https://github.com/custiya/geoserver-CVE-2023-25157)

**漏洞详情:** [CVE-2023-25157](https://nvd.nist.gov/vuln/detail/CVE-2023-25157)