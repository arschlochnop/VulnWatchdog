## CVE-2022-32250-Linux Kernel Privilege Escalation

**漏洞编号:** CVE-2022-32250

**漏洞类型:** Use-After-Free

**影响应用:** Linux Kernel

**危害等级:** 高危，本地用户可提升至root权限

**影响版本:** <= 5.18.1

**利用条件:** 需要创建user/net namespace的能力

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-32250 存在于Linux kernel的netfilter模块的nf_tables_api.c中。漏洞是由于不正确的NFT_STATEFUL_EXPR检查导致use-after-free。本地用户如果可以创建user/net namespace，就可以利用此漏洞提升权限至root。

**有效性：**
根据漏洞库信息、搜索结果，以及提供的POC代码，可以判断该漏洞利用的有效性较高。漏洞库信息明确指出该漏洞允许本地用户提权，并提供了受影响的版本范围。搜索引擎结果中，有多个链接指向了漏洞的分析和利用，例如 theori.io 的博客，以及 NCC Group 的研究博客，这些都表明该漏洞是可以被利用的。POC代码本身也提供了编译和运行的指导，以及一个Demo视频链接。

**投毒风险：**
对提供的exp.c代码进行了分析，发现存在一定的投毒风险。风险点在于：

1.  **编译依赖：** 代码需要依赖 `libmnl` 和 `libnftnl` 库。如果这些库被篡改，可能会引入恶意代码。
2.  **slab 破坏警告：**  代码中的注释明确指出 “This exploit corrupts Linux kernel slabs, which might cause kernel panic when attempting to acquire root privileges.” 虽然这本身是漏洞利用的副作用，但也可能被利用来作为拒绝服务攻击。
3.  **root权限执行bash:** 代码利用成功会调用system("bash")获取shell.如果攻击者篡改了代码,将 bash替换为其他恶意程序，就会造成远端执行。

综上，判断投毒风险的概率约为10%。该风险主要来自于供应链投毒(库被篡改)和利用代码被篡改后传播。

**利用方式：**
1.  **触发UAF：** 漏洞利用的核心是触发use-after-free。通过精心构造的netfilter规则，利用NFT_STATEFUL_EXPR的错误检查释放本不应该释放的内存。
2.  **堆喷射：** 释放后，进行堆喷射，用精心构造的数据填充释放的内存。
3.  **覆盖：** 覆盖关键的内核数据结构，例如 task_struct 结构体中的 cred 字段。
4.  **提权：** 通过修改 cred 字段，将当前进程的 uid、gid 等权限信息修改为 root 权限。
5.  **get shell:** 代码利用成功会调用system("bash")获取shell.

**项目地址:** [theori-io/CVE-2022-32250-exploit](https://github.com/theori-io/CVE-2022-32250-exploit)

**漏洞详情:** [CVE-2022-32250](https://nvd.nist.gov/vuln/detail/CVE-2022-32250)