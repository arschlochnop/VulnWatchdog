## CVE-2025-27480-Windows Remote Desktop Services-Use After Free

**漏洞编号:** CVE-2025-27480

**漏洞类型:** Use After Free

**影响应用:** Windows Remote Desktop Gateway Service

**危害等级:** 高危，允许未经授权的攻击者通过网络执行代码

**影响版本:** Windows Server 2019 (版本范围：10.0.17763.0 <= version < 10.0.17763.7136),
Windows Server 2022 (版本范围：10.0.20348.0 <= version < 10.0.20348.3453),
Windows Server 2025 (版本范围：10.0.26100.0 <= version < 10.0.26100.3775),
Windows Server 23H2 (版本范围：10.0.25398.0 <= version < 10.0.25398.1551),
Windows Server 2016 (版本范围：10.0.14393.0 <= version < 10.0.14393.7969),
Windows Server 2012 (版本范围：6.2.9200.0 <= version < 6.2.9200.25423),
Windows Server 2012 R2 (版本范围：6.3.9600.0 <= version < 6.3.9600.22523)

**利用条件:** 需要网络访问，目标系统开启Remote Desktop Gateway Service

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于Windows Remote Desktop Gateway Service中，是一个典型的Use After Free漏洞。未经授权的攻击者可以通过发送特制的网络数据包，触发释放后重用内存的错误，从而在目标系统上执行任意代码。

**有效性评估：**
根据提供的漏洞库信息、搜索引擎结果和漏洞利用代码，该漏洞的利用是有效的。漏洞库信息明确指出这是一个远程代码执行漏洞。搜索引擎结果中也确认了该漏洞的存在以及其影响。提供的POC代码展示了如何构造恶意的SSH_USERAUTH数据包，通过溢出用户名字段来覆盖内存，并执行攻击者预设的代码。

**投毒风险评估：**
虽然POC代码本身用于演示漏洞利用，但分析仓库中的代码存在一定的投毒风险，风险程度为10%。
- LICENSE文件和README文件没有发现明显恶意代码。
- PowerShell脚本中，攻击者可以自定义payload，这意味着可以插入任意恶意代码，存在一定的后门风险。
- 该PoC依赖`nc.exe`和`bar_exp.exe`,如果攻击者替换这两个程序则存在投毒的可能。

**利用方式分析：**
1.  攻击者构造一个恶意的SSH_USERAUTH数据包，其中包含一个超长的用户名。
2.  该超长用户名会导致缓冲区溢出，覆盖内存中的其他数据。
3.  攻击者可以在溢出的数据中插入Shellcode，Shellcode的作用是执行攻击者指定的命令。
4.  当Remote Desktop Gateway Service处理该恶意数据包时，会触发Use After Free漏洞，执行Shellcode，从而实现远程代码执行。
5.  POC代码中, 使用`nc.exe`创建一个监听端口，并将输出保存到文件中，或者使用`bar_exp.exe`执行其他操作。

**项目地址:** [mrk336/CVE-2025-27480](https://github.com/mrk336/CVE-2025-27480)

**漏洞详情:** [CVE-2025-27480](https://nvd.nist.gov/vuln/detail/CVE-2025-27480)