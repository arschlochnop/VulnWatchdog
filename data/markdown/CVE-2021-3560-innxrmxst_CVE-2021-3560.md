## CVE-2021-3560 - Polkit权限提升

**漏洞编号:** CVE-2021-3560

**漏洞类型:** 权限提升

**影响应用:** Polkit

**危害等级:** 高危，可导致本地普通用户提升为root权限

**影响版本:** polkit 0.119

**利用条件:** 本地用户访问权限，目标系统安装了受影响版本的Polkit

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2021-3560 漏洞允许未经授权的本地用户通过欺骗Polkit绕过凭据检查，从而将权限提升为root。该漏洞利用方式涉及使用dbus-send命令与org.freedesktop.Accounts服务进行交互，尝试快速创建用户，并在创建用户成功后，尝试通过类似的dbus调用来设置密码。攻击利用了Polkit在处理D-Bus请求时的漏洞，通过竞态条件或超时机制绕过权限验证。漏洞利用代码尝试创建用户'ahmed'，然后尝试设置其密码，最后尝试以该用户身份执行'sudo su'来获得root权限。

**有效性：**
根据漏洞库信息和搜索结果，该漏洞已被积极利用。提供的PoC代码试图通过高频率的dbus调用来触发Polkit的漏洞，从而提升权限，该PoC代码是有效的，如果目标系统满足漏洞存在的条件。

**投毒风险：**
PoC代码主要由dbus-send命令组成，用于与systemd交互。虽然代码本身的目的在于利用漏洞，但潜在的投毒风险较低。风险点在于循环体中进程的创建和销毁，如果利用代码本身存在恶意修改，例如，在成功创建用户之后执行其他恶意操作，或者修改密码设置的逻辑以植入后门，则存在一定的投毒风险。从代码内容本身判断，投毒风险为1%，因为其行为模式符合漏洞利用的预期，且未发现明显的恶意代码。

**利用方式：**
1.  利用dbus-send命令与org.freedesktop.Accounts服务通信。
2.  尝试通过竞争条件或超时绕过身份验证。
3.  创建具有已知用户名的用户（例如 'ahmed'）。
4.  尝试为该用户设置密码。
5.  使用新创建的用户和sudo提升权限到root用户。

**项目地址:** [innxrmxst/CVE-2021-3560](https://github.com/innxrmxst/CVE-2021-3560)

**漏洞详情:** [CVE-2021-3560](https://nvd.nist.gov/vuln/detail/CVE-2021-3560)