## CVE-2025-26794-Exim-SQL注入

**漏洞编号:** CVE-2025-26794

**漏洞类型:** SQL注入

**影响应用:** Exim

**危害等级:** 高危，可能导致信息泄露、拒绝服务，甚至远程代码执行

**影响版本:** 4.98 (受影响) - 4.98.1 (修复)

**利用条件:** 需要启用SQLite hints和ETRN序列化。攻击者需要能够发送SMTP ETRN命令

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2025-26794 存在于 Exim 4.98 版本中，并在 4.98.1 版本修复。漏洞原因为当 Exim 使用 SQLite 作为 DBM 并且启用了 ETRN 序列化时，SQL 参数未被正确过滤，导致远程攻击者可以通过构造恶意的 SQL 查询语句进行 SQL 注入攻击。

**有效性：**
提供的 PoC 代码展示了如何利用此漏洞。通过发送特制的 ETRN 命令，攻击者可以在 SQLite 数据库中注入恶意的 SQL 代码。

**利用方式：**
1.  **配置要求：** Exim 需要编译时启用 `USE_SQLITE = yes`，并且需要启用 ETRN 命令 (`acl_smtp_etrn` 在配置文件中设置)。
2.  **触发漏洞：** 攻击者使用 `ETRN #<恶意SQL代码>` 命令，其中 `<恶意SQL代码>` 包含要注入的 SQL 语句。PoC 代码中给出了一个基于时间的盲注示例：`ETRN #',1); SELECT 1 FROM tbl WHERE 1234=LIKE('ABCDEFG',UPPER(HEX(RANDOMBLOB(1000000000/2)))) /*`。
3.  **影响：** 攻击者可以读取其他本地 SQLite 数据库的内容（如果 Exim 进程具有访问权限），甚至可能结合 SQLite 的其他漏洞实现远程代码执行。虽然PoC中提到了ATTACH DATABASE，但实际攻击效果受限于Exim进程的权限。

**投毒风险：**
虽然提供的 PoC 代码本身是为了演示漏洞，但存在一定的投毒风险。以下分析评估投毒的可能性：

*   **Docker Lab:** 仓库包含一个 Docker lab，虽然方便复现漏洞，但如果 Dockerfile 或其他相关脚本被篡改，可能会在启动容器时执行恶意操作。需要仔细检查 `docker_lab` 目录下的所有文件，特别是 Dockerfile 和任何构建脚本。
*   **Payload 隐蔽性:** SQL 注入的 payload 可以非常复杂和隐蔽，攻击者可能会在 payload 中隐藏一些恶意代码，例如尝试执行系统命令或下载恶意文件。需要仔细分析 PoC 代码中使用的 SQL payload，确保其不会执行任何非预期的操作。
*   **依赖项风险:** 尽管主要依赖于 Exim 本身和 SQLite，但仍需检查是否有其他潜在的依赖项或外部资源被引入，这些依赖项可能包含恶意代码。
*   **README.md 内容:** 虽然 README 文件主要用于解释漏洞和提供 PoC 代码，但也需要检查是否存在任何可疑的指令或建议。

综合考虑以上因素，评估该仓库存在 **10%** 的投毒风险，主要是因为 docker 镜像，以及可能存在利用EXIM权限进行提权或文件操作的SQL语句。尽管主要代码看起来是合法的漏洞利用，但也需要仔细审查以确保安全。

**项目地址:** [OscarBataille/CVE-2025-26794](https://github.com/OscarBataille/CVE-2025-26794)

**漏洞详情:** [CVE-2025-26794](https://nvd.nist.gov/vuln/detail/CVE-2025-26794)