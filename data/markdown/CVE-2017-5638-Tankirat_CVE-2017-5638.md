## CVE-2017-5638 - Apache Struts RCE

**漏洞编号:** CVE-2017-5638

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Struts

**危害等级:** 高危，可导致服务器完全控制

**影响版本:** 2.3.x (before 2.3.32), 2.5.x (before 2.5.10.1)

**利用条件:** 目标系统运行存在漏洞的Apache Struts版本，且允许通过HTTP进行访问。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2017-5638 漏洞存在于 Apache Struts 2 框架的 Jakarta Multipart parser 中。当处理文件上传时，由于异常处理和错误消息生成不当，攻击者可以通过构造恶意的 Content-Type, Content-Disposition, 或 Content-Length HTTP 头部来执行任意命令。在野外攻击中，通常使用包含 `#cmd=` 字符串的 Content-Type 头部。

**有效性：**
根据漏洞库信息和搜索结果，该漏洞是一个高危漏洞，并且存在公开可用的PoC。漏洞利用代码描述了漏洞原理和利用方法，表明该漏洞的有效性较高。

**投毒风险：**
提供的漏洞利用代码（`/tmp/3bf1e344cbece4d19a9e8c32c2245913/README.md`） 主要是漏洞的介绍文档，描述了漏洞的原理、影响、利用方法、案例分析（Equifax 数据泄露），以及预防措施和参考链接。其中虽然引用了github上漏洞扫描工具，但本身readme文件不具备可执行的攻击代码。所以投毒风险较低，但不能完全排除作者通过其他方式进行投毒，比如在引用的链接中做手脚。所以评定投毒风险为10%。

**利用方式：**
1.  攻击者发送包含恶意构造的 HTTP 头部（例如，Content-Type）的请求到存在漏洞的 Apache Struts 应用。
2.  恶意的 HTTP 头部包含 Object-Graph Navigation Language (OGNL) 表达式。
3.  Struts 应用在解析 HTTP 头部时，会将 OGNL 表达式传递给 `LocalizedTextUtil.findText` 函数进行处理。
4.  `LocalizedTextUtil.findText` 函数会将 `${...}` 中的内容解释为 OGNL 表达式并执行。
5.  攻击者可以通过 OGNL 表达式执行任意系统命令，从而实现远程代码执行。

攻击成功的关键在于构造包含恶意 OGNL 表达式的 HTTP 头部，例如 `Content-Type: %{#context['com.opensymphony.xwork2.dispatcher.HttpServletRequest'].getSession().setAttribute('rand','vuln')}`。其中OGNL表达式可以执行任意命令，获取敏感信息，或者植入后门。

该漏洞曾被广泛利用，导致了包括 Equifax 数据泄露在内的多起重大安全事件。

**项目地址:** [Tankirat/CVE-2017-5638](https://github.com/Tankirat/CVE-2017-5638)

**漏洞详情:** [CVE-2017-5638](https://nvd.nist.gov/vuln/detail/CVE-2017-5638)