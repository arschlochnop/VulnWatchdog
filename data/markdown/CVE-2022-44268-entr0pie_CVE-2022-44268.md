## CVE-2022-44268-ImageMagick-任意文件读取

**漏洞编号:** CVE-2022-44268

**漏洞类型:** 任意文件读取

**影响应用:** ImageMagick

**危害等级:** 高危，可能导致敏感信息泄露

**影响版本:** 7.1.0-49

**利用条件:** 需要目标系统安装了存在漏洞版本的ImageMagick，且ImageMagick进程有权限读取目标文件。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-44268 是 ImageMagick 7.1.0-49 中存在的一个信息泄露漏洞。当 ImageMagick 解析 PNG 图像（例如，为了调整大小）时，生成的图像可能嵌入了任意文件的内容（如果 magick 二进制文件具有读取它的权限）。

**有效性：**
根据漏洞库信息、搜索结果和提供的PoC代码，该漏洞是有效的。PoC代码演示了如何构造一个恶意的PNG文件，该文件在被 ImageMagick 处理后，会将指定文件的内容嵌入到输出图像中。

**投毒风险：**
分析提供的PoC代码和相关文件（LICENSE、README.md），未发现作者隐藏的恶意代码或后门。 PoC 代码的功能是生成包含文件读取路径的 PNG 文件，利用方式清晰，LICENSE 采用的是公共领域许可，允许自由使用，README 也明确说明了漏洞利用方式。因此，投毒风险评估为0%。

**利用方式：**
1.  **构造恶意PNG文件：** 使用提供的 Python 脚本 `CVE-2022-44268.py`，指定想要读取的文件路径作为参数，生成一个 `output.png` 文件。该脚本修改 PNG 文件的 tEXt 块，将 “Profile” 关键字的值设置为目标文件路径。
2.  **使用ImageMagick处理该PNG文件：** 使用 `convert` 命令或其他 ImageMagick 工具对 `output.png` 进行图像处理操作，例如调整大小。 `convert output.png -resize 50% leak.png`
3.  **提取泄露的文件内容：**  使用 `identify -verbose leak.png` 命令查看 `leak.png` 文件的详细信息，找到 `Raw profile type` 字段，该字段的值即为被读取的文件内容的十六进制表示。然后，可以使用 Python 等工具将十六进制数据转换为原始文件内容。

**总结：**
该漏洞允许攻击者在目标系统上读取任意文件，前提是 ImageMagick 进程具有读取该文件的权限。攻击者可以通过上传特制的PNG文件，诱导服务器上的 ImageMagick 处理该文件，从而实现任意文件读取。

**项目地址:** [entr0pie/CVE-2022-44268](https://github.com/entr0pie/CVE-2022-44268)

**漏洞详情:** [CVE-2022-44268](https://nvd.nist.gov/vuln/detail/CVE-2022-44268)