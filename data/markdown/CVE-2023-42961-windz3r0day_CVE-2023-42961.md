## CVE-2023-42961 - intents_helper.xpc 沙箱逃逸

**漏洞编号:** CVE-2023-42961

**漏洞类型:** 沙箱逃逸

**影响应用:** macOS, iOS, iPadOS

**危害等级:** 中危，可能允许沙箱进程绕过限制

**影响版本:** < macOS Sonoma 14, macOS Ventura 13.6, macOS Monterey 12.7, iOS 17 and iPadOS 17, iOS 16.7 and iPadOS 16.7

**利用条件:** 需要目标程序使用了存在漏洞的Intents framework，以及触发漏洞的特定操作。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-42961 是一个路径处理漏洞，位于 Apple 的 macOS、iOS 和 iPadOS 中。攻击者可以利用此漏洞，通过构造恶意路径，使得沙箱进程绕过沙箱限制。

**有效性评估：**

提供的 POC 代码似乎有效，它利用了 `com.apple.intents.intents-helper` XPC 服务中的漏洞。代码通过 `purgeImageWithIdentifier` 函数传递恶意构造的路径，从而触发路径遍历漏洞，尝试逃逸沙箱。

**投毒风险评估：**

评估 POC 代码后，投毒风险较低。代码结构简单，主要目的是演示沙箱逃逸。`exploit_intents_helper` 函数是利用漏洞的核心，除了漏洞利用之外，没有发现其他可疑操作。考虑到代码的目的是教育和本地测试，以及其基于 Mickey Jin 的原始研究，判断为投毒的可能性较低，大约为5%。风险主要集中在使用来路不明的POC，但代码本身并无明显恶意。

**利用方式分析：**

1.  **漏洞点：** 漏洞存在于 `com.apple.intents.intents-helper` XPC 服务中，具体是其处理文件路径的方式存在缺陷。
2.  **利用方式：**  攻击者通过 `NSXPCConnection` 连接到 `com.apple.intents.intents-helper` 服务，并调用 `purgeImageWithIdentifier` 函数。该函数接受一个字符串作为图像标识符，但未对该字符串进行充分的路径验证，攻击者可以在该字符串中插入 `../../` 等路径遍历字符，从而访问沙箱外的文件系统。
3.  **PoC 细节：**  PoC 代码中的 `exploit_intents_helper` 函数首先加载 `Intents.framework`，然后建立与 `com.apple.intents.intents-helper` 的 XPC 连接。接着，它调用 `purgeImageWithIdentifier` 函数，并传递一个包含路径遍历字符的字符串。`[@[../../../../.." stringByAppendingPathComponent:target]` 实现了路径穿越。目标路径 `target` 来自用户在界面上的输入。
4.  **影响：** 成功利用此漏洞可以允许沙箱进程读取或删除沙箱外的文件，可能泄露敏感信息或导致其他恶意行为。

**项目地址:** [windz3r0day/CVE-2023-42961](https://github.com/windz3r0day/CVE-2023-42961)

**漏洞详情:** [CVE-2023-42961](https://nvd.nist.gov/vuln/detail/CVE-2023-42961)