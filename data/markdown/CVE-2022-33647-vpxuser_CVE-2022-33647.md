## CVE-2022-33647-Windows Kerberos 提权漏洞

**漏洞编号:** CVE-2022-33647

**漏洞类型:** 权限提升

**影响应用:** Windows Kerberos

**危害等级:** 高危，可能导致域权限提升

**影响版本:** 受影响的Windows Server版本包括但不限于2008 SP2, 2008 R2, 2012, 2012 R2, 2016, 2019, 2022

**利用条件:** 需要与目标域建立网络连接，并且目标服务器运行着受影响的Windows Kerberos服务。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-33647是一个Windows Kerberos权限提升漏洞。根据漏洞库信息，该漏洞影响多个版本的Windows Server。搜索结果表明该漏洞可以实现权限提升。提供的POC代码 `exploit.py` 尝试利用此漏洞，通过构造恶意的Kerberos AS_REQ请求，特别是通过PA-PAC-REQUEST和PA_ENC_TIMESTAMP填充已知字节, 欺骗KDC，从而提升权限。从代码分析来看，它修改了AS_REQ请求中的某些字段，可能利用了Kerberos协议的某些缺陷。

**有效性：**
根据搜索结果中的技术分析文章，以及POC代码尝试构造特定格式的Kerberos请求来看，该漏洞的利用是可行的。该POC代码大概率是有效的。

**投毒风险：**
代码主要是在正常的krb5流程中，插入自己构造的数据包，没有发现明显的恶意代码（例如反弹shell、下载执行等）。但由于该POC修改了Kerberos请求的数据包结构，存在一定风险。例如，攻击者可以修改POC代码，在某些特定情况下，向KDC发送畸形的Kerberos请求，导致KDC拒绝服务。或者记录目标环境的krb5数据包，发送到poc作者处，存在一定的风险。

**利用方式：**
1.  攻击者首先需要确定目标服务器运行着受影响的Windows Server版本。
2.  攻击者使用POC代码 `exploit.py`，指定目标域名和用户名。
3.  POC代码构造一个恶意的Kerberos AS_REQ请求，其中包含特制的PA-PAC-REQUEST和PA_ENC_TIMESTAMP字段。
4.  POC代码将构造的请求发送到KDC。
5.  如果KDC存在漏洞，它会错误地处理这个请求，并颁发一个具有提升权限的TGT。
6.  攻击者可以使用这个TGT来访问其他服务，从而提升权限。

**项目地址:** [vpxuser/CVE-2022-33647](https://github.com/vpxuser/CVE-2022-33647)

**漏洞详情:** [CVE-2022-33647](https://nvd.nist.gov/vuln/detail/CVE-2022-33647)