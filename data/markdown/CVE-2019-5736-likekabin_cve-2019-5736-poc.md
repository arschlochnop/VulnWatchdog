## CVE-2019-5736 - runc 容器逃逸

**漏洞编号:** CVE-2019-5736

**漏洞类型:** 容器逃逸

**影响应用:** runc (Docker, containerd, CRI-O)

**危害等级:** 高危，允许恶意容器用户获得宿主机的 root 权限。

**影响版本:** runc <= 1.0-rc6 (Docker < 18.09.2)

**利用条件:** 攻击者需要在受影响的容器内以 root 身份执行命令。可能需要攻击者控制的镜像或已经具有写入权限的现有容器。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-5736 漏洞是 runc 中的一个文件描述符处理错误，允许攻击者覆盖宿主机上的 runc 二进制文件，从而获得宿主机的 root 访问权限。

**利用方式：**

1.  攻击者需要能够以 root 身份在容器内执行代码。这可以通过两种方式实现：
    *   **新容器，攻击者控制镜像：** 攻击者创建一个包含恶意代码的 Docker 镜像。
    *   **现有容器，攻击者具有写入权限：** 攻击者首先获得对现有容器的写入权限（例如，通过另一个漏洞），然后注入恶意代码。
2.  容器内的恶意代码利用 `/proc/self/exe` 打开 runc 二进制文件，并将其文件描述符传递给容器内的另一个进程。
3.  当 Docker 容器启动新进程时，会调用宿主机上的 runc 二进制文件。由于存在文件描述符处理错误，容器内的恶意进程可以利用该文件描述符覆盖宿主机上的 runc 二进制文件。
4.  下次 runc 被调用时（例如，启动另一个容器），恶意代码就会以 root 权限在宿主机上执行。

**POC代码分析：**

*   `Dockerfile`: 用于构建包含攻击代码的镜像。它首先安装编译工具和依赖项，然后将 `stage1.c` 和 `stage2.c` 添加到镜像中，并编译 `stage2.c`。
*   `stage1.c`: 这是一个在容器启动时执行的 C 代码。它打开 `/proc/self/exe` (即 runc 二进制文件)，并使用 `execve` 调用 `/stage2`，将 runc 的文件描述符传递给 `stage2`。
*   `stage2.c`: 这是一个 C 代码，它接收 runc 的文件描述符，并向其中写入字符串 "cve-2019-5736"，从而修改宿主机上的 runc 二进制文件。
*   `README`: 提供运行 POC 的说明。

**有效性：**
提供的 POC 代码是有效的，它可以用于演示 CVE-2019-5736 漏洞。该 POC 通过修改宿主机上的 runc 二进制文件来证明漏洞的存在。

**投毒风险：**
该 POC 代码本身没有明显的投毒代码。该代码的目的是修改宿主机上的 runc 二进制文件以证明漏洞的存在。没有发现作者隐藏的其他恶意功能或后门。因此投毒风险为0%。

**项目地址:** [likekabin/cve-2019-5736-poc](https://github.com/likekabin/cve-2019-5736-poc)

**漏洞详情:** [CVE-2019-5736](https://nvd.nist.gov/vuln/detail/CVE-2019-5736)