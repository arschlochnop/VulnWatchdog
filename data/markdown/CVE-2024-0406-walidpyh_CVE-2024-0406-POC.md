## CVE-2024-0406-mholt/archiver-路径遍历

**漏洞编号:** CVE-2024-0406

**漏洞类型:** 路径遍历

**影响应用:** mholt/archiver

**危害等级:** 中危，可能导致敏感文件读取或覆盖

**影响版本:** < v4.0.0

**利用条件:** 需要用户或应用程序解压恶意构造的tar文件

**POC 可用性:** 是

**投毒风险:** 95%

## 详情

CVE-2024-0406 是一个存在于 mholt/archiver 包中的路径遍历漏洞。攻击者可以创建一个特制的 tar 文件，当该文件被解压时，可能允许访问受限的文件或目录。 

**有效性：**

提供的 PoC 代码有效。它使用 `tarfile` 模块创建一个包含符号链接和payload文件的恶意 tar 归档文件。符号链接指向目标路径（`target_path`），而 payload 文件包含要写入的数据（`payload_data`）。当受害者解压此归档文件时，符号链接会将文件写入到目标路径，从而实现任意文件覆盖。

**投毒风险：**

PoC 代码存在很高的投毒风险（95%）。虽然代码本身展示了如何利用该漏洞，但如果被恶意行为者修改或用于未经授权的渗透测试，则可能造成严重损害。例如，攻击者可以修改 `payload_data` 以注入恶意代码或覆盖关键系统文件。

**利用方式：**

1.  **创建恶意 Tar 文件：** 使用 `tarfile` 模块创建一个包含符号链接的 Tar 文件。符号链接的名称设置为一个特定的值（`symlink_name`），并且链接目标设置为攻击者想要写入的目标文件路径（`target_path`）。
2.  **Payload 创建：** 创建一个与符号链接同名的文件，并将攻击者想要写入目标文件的数据（`payload_data`）写入其中。
3.  **上传恶意文件：** 通过网站upload接口等通道上传恶意构造的tar文件。
4.  **解压 Tar 文件：** 当受害者（应用程序或用户）使用存在漏洞的 `mholt/archiver` 版本解压此 Tar 文件时，符号链接会将 payload 数据写入到目标文件路径，从而实现任意文件覆盖。

**缓解措施：**

*   升级到 `mholt/archiver` v4.0.0 或更高版本。
*   在解压 Tar 文件之前，验证 Tar 文件中的所有路径是否安全。
*   使用安全的文件解压库，这些库可以正确处理符号链接并防止路径遍历攻击。

**项目地址:** [walidpyh/CVE-2024-0406-POC](https://github.com/walidpyh/CVE-2024-0406-POC)

**漏洞详情:** [CVE-2024-0406](https://nvd.nist.gov/vuln/detail/CVE-2024-0406)