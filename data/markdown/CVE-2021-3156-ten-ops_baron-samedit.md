## CVE-2021-3156 (Baron Samedit)

**漏洞编号:** CVE-2021-3156

**漏洞类型:** 堆缓冲区溢出

**影响应用:** Sudo

**危害等级:** 高危，本地提权至root

**影响版本:** < 1.9.5p2

**利用条件:** 本地用户可执行sudo命令

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-3156 存在于 Sudo 1.9.5p2 之前的版本中。它是一个堆缓冲区溢出漏洞，可以通过 `sudoedit -s` 以及以单个反斜杠字符结尾的命令行参数触发。攻击者可以利用此漏洞将权限提升到 root 用户。

**利用方式：**

1.  利用 `sudoedit -s` 命令，该命令会调用 `sudo` 来执行编辑操作。
2.  构造一个以单个反斜杠字符结尾的恶意命令行参数。这个反斜杠字符会导致 `sudo` 在处理参数时出现 off-by-one 错误。
3.  这个 off-by-one 错误会导致堆缓冲区溢出，攻击者可以控制溢出的内容。
4.  通过控制溢出的内容，攻击者可以覆盖堆上的其他数据结构，最终实现权限提升，执行任意代码。
5. 搜索引擎结果中大量的文章提到了此漏洞，并描述了利用方式。

**有效性：**

漏洞库信息和搜索引擎结果都表明这是一个真实且可利用的漏洞。搜索引擎结果中的文章提到了利用 `sudoedit -s` 以及精心构造的命令行参数可以实现提权。因此，可以判断利用代码有效。

**投毒风险：**

提供的漏洞利用代码仅仅是 Apache 2.0 许可协议，并非真正的漏洞利用代码。协议中没有发现任何恶意代码。因此，投毒风险非常低，可以认为是 0%。真正的漏洞利用代码会利用上述的堆溢出过程进行攻击，不会将后门直接写入协议中。


**项目地址:** [ten-ops/baron-samedit](https://github.com/ten-ops/baron-samedit)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)