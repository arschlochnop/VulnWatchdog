## CVE-2021-21353-pug-RCE

**漏洞编号:** CVE-2021-21353

**漏洞类型:** 远程代码执行(RCE)

**影响应用:** pug

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** < 3.0.1

**利用条件:** 目标系统使用存在漏洞的pug版本，并且允许用户控制`pretty`选项。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

该漏洞存在于pug模板引擎中，当pug版本小于3.0.1时，如果攻击者能够控制`pretty`选项，则可以实现远程代码执行。提供的POC代码通过创建一个express应用，将请求参数`pretty`的值直接传递给`res.render`函数，从而影响pug的编译选项。攻击者可以通过构造恶意的`pretty`值来执行任意代码。例如，可以构造`?pretty=true; global.process.mainModule.require('child_process').execSync('touch /tmp/rce');`这样的URL来在服务器上创建`/tmp/rce`文件。

**漏洞利用方式：**

1.  目标应用使用易受攻击的pug版本（< 3.0.1）。
2.  目标应用允许通过URL参数或其他方式控制pug的`pretty`选项。
3.  攻击者构造包含恶意代码的`pretty`参数。
4.  pug编译模板时，恶意代码被执行，导致RCE。

**投毒风险分析：**

分析提供的Dockerfile、docker-compose.yml、index.js、package.json和template.pug文件，没有发现任何明显的恶意代码或后门。所有代码都符合一个简单的基于express的pug应用的基本结构。`index.js`中的漏洞利用是由于直接将用户提供的`pretty`参数传递给pug的渲染函数，这是漏洞本身，而不是人为植入的后门。

**有效性：**

提供的POC代码有效。通过控制`pretty`参数，可以触发RCE漏洞。

**搜索引擎结果分析：**

搜索引擎结果证实了该漏洞的存在，并提供了关于漏洞细节和修复方案的链接。其中，[webpage 6]指出，截止到3月3日，没有公开的exploit代码，且漏洞不在CISA的已知被利用漏洞目录中。这并不代表不存在exploit，只是表明当时exploit可能没有被广泛公开或利用。

**项目地址:** [jinsu9758/PUG-RCE-CVE-2021-21353-POC](https://github.com/jinsu9758/PUG-RCE-CVE-2021-21353-POC)

**漏洞详情:** [CVE-2021-21353](https://nvd.nist.gov/vuln/detail/CVE-2021-21353)