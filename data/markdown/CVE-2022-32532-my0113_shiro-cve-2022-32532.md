## CVE-2022-32532-Apache Shiro-认证绕过

**漏洞编号:** CVE-2022-32532

**漏洞类型:** 认证绕过

**影响应用:** Apache Shiro

**危害等级:** 高危，可能导致未授权访问和数据泄露

**影响版本:** < 1.9.1

**利用条件:** 应用使用了 Shiro 且配置了存在漏洞的 RegexRequestMatcher

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-32532 是 Apache Shiro 1.9.1 之前的版本中存在的一个认证绕过漏洞。该漏洞源于 `RegExPatternMatcher` 类在某些 servlet 容器中可能被错误配置，导致可以通过构造特殊的请求绕过权限验证。具体来说，如果正则表达式中使用了 `.` 并且没有正确地锚定，攻击者可以通过添加额外的字符来绕过匹配。

**有效性：** 提供的 POC 代码有效。它创建了一个最小化的 Web 应用，展示了如何利用该漏洞。`MyFilter.java` 使用 `RegExPatternMatcher` 验证 Token，如果正则表达式配置不当，则可能绕过验证。

**投毒风险：** 该 POC 代码的投毒风险较低，估计为 10%。风险点在于构建maven项目时,存在引入恶意依赖的可能,从而导致恶意代码的执行。

**利用方式：**

1.  **漏洞点：**  Shiro 使用 `RegExPatternMatcher` 来匹配 URL 路径。如果正则表达式没有正确地使用 `^` 和 `$` 进行锚定，攻击者可以通过构造带有额外字符的 URL 来绕过认证。
2.  **利用方法：** 配置Shiro使用存在漏洞的正则表达式，构造特殊的请求URL，例如，如果配置的正则表达式是 `/permit/.*`，那么攻击者可以使用 `/permit/anything` 来绕过身份验证。
3.  **POC 演示：**  POC 代码中，`MyFilter` 类使用 header 中的 `Token` 进行认证。如果 Shiro 配置不当，攻击者可以修改或添加字符绕过身份验证。

**项目地址:** [my0113/shiro-cve-2022-32532](https://github.com/my0113/shiro-cve-2022-32532)

**漏洞详情:** [CVE-2022-32532](https://nvd.nist.gov/vuln/detail/CVE-2022-32532)