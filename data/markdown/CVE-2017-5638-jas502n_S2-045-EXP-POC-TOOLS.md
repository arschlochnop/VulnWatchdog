## CVE-2017-5638 - Apache Struts2 远程代码执行

**漏洞编号:** CVE-2017-5638

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Struts2

**危害等级:** 高危，可直接控制服务器

**影响版本:** 2.3.x (before 2.3.32), 2.5.x (before 2.5.10.1)

**利用条件:** 目标系统运行受影响版本的Apache Struts2，并且存在文件上传功能或使用了Jakarta Multipart parser

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2017-5638 是 Apache Struts2 框架中的一个远程代码执行漏洞，该漏洞源于Jakarta Multipart parser在处理文件上传请求时，对Content-Type等HTTP头信息处理不当，导致OGNL表达式注入。攻击者可以通过构造恶意的Content-Type、Content-Disposition或Content-Length HTTP头，在服务器上执行任意命令。

**有效性：**

根据漏洞库信息、搜索引擎结果以及提供的POC代码，此漏洞的POC是有效的。漏洞库和搜索结果都表明这是一个被广泛利用的漏洞，多个安全厂商和研究人员都发布了相关的分析和利用方法。

**投毒风险：**

分析提供的代码仓库内容，`README.md` 文件描述了漏洞信息和修复建议。`AvailableURL.txt` 包含可能存在漏洞的URL列表，`keyword.txt` 包含用于查找Struts2应用的关键词。`cmd.py` 是一个Python POC脚本，用于发送包含恶意Content-Type的HTTP请求，从而执行命令。

投毒风险较低，约为 5%。 虽然 `AvailableURL.txt` 中包含一些URL，可能被用于测试，但是这些URL并非恶意代码。 POC本身是利用漏洞执行命令，但并不包含主动植入后门或其他恶意行为的代码，因此，主要风险在于使用者可能会将此POC用于非法用途。

**利用方式：**

1.  攻击者构造包含恶意OGNL表达式的Content-Type HTTP头，例如 `Content-Type: multipart/form-data; boundary="+#cmd=whoami"`。
2.  攻击者向存在漏洞的Struts2应用发送包含上述恶意HTTP头的请求。
3.  Struts2应用使用Jakarta Multipart parser解析请求，由于Content-Type中包含恶意OGNL表达式，解析过程中会执行该表达式。
4.  服务器执行攻击者指定的命令，并将结果返回给攻击者。

提供的 `cmd.py` 脚本就是通过构造包含恶意Content-Type的HTTP请求来利用该漏洞的。

**项目地址:** [jas502n/S2-045-EXP-POC-TOOLS](https://github.com/jas502n/S2-045-EXP-POC-TOOLS)

**漏洞详情:** [CVE-2017-5638](https://nvd.nist.gov/vuln/detail/CVE-2017-5638)