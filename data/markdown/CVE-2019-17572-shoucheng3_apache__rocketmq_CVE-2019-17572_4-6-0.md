## CVE-2019-17572 - Apache RocketMQ 目录遍历

**漏洞编号:** CVE-2019-17572

**漏洞类型:** 目录遍历

**影响应用:** Apache RocketMQ

**危害等级:** 高危，可能导致敏感信息泄露和远程代码执行（取决于文件权限）

**影响版本:** 4.2.0 to 4.6.0

**利用条件:** broker的自动topic创建功能默认开启，攻击者能够发送恶意topic名称到broker。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2019-17572 存在于 Apache RocketMQ 4.2.0 到 4.6.0 版本中。当 broker 的自动 topic 创建功能默认开启时，攻击者可以发送类似于 "../../../../topic2020" 这样的恶意 topic 名称到 broker，从而在 broker 的父目录中创建 topic 文件夹，导致目录遍历漏洞。

**漏洞利用方式：**
1. 确认目标 RocketMQ broker 的版本在 4.2.0 到 4.6.0 之间。
2. 确认 broker 的 `autoCreateTopicEnable` 配置项为 `true` (默认情况).
3. 使用 rocketmq-client 发送一个包含恶意路径的 topic 名称的消息到 broker。
4. Broker 将会尝试创建包含恶意路径的目录，攻击者可以利用此漏洞访问或创建文件在 RocketMQ 安装目录之外。

**有效性评估：**
根据漏洞描述，漏洞利用较为简单，成功率取决于broker配置和文件系统权限。

**投毒风险分析：**
提供的漏洞利用代码实际上是 Apache RocketMQ 的构建说明、贡献指南和许可证文件。这些文件本身不包含任何恶意代码或后门，但如果恶意攻击者篡改了这些文件，例如贡献代码时添加恶意代码，则存在投毒风险。由于目前提供的代码是官方文档，因此投毒风险较低，但不能完全排除。我们保守估计其概率为 5%，因为攻击者可能尝试通过提交恶意的 PR 或修改构建脚本来实现投毒，但是通过 review 可以降低这个风险。

**项目地址:** [shoucheng3/apache__rocketmq_CVE-2019-17572_4-6-0](https://github.com/shoucheng3/apache__rocketmq_CVE-2019-17572_4-6-0)

**漏洞详情:** [CVE-2019-17572](https://nvd.nist.gov/vuln/detail/CVE-2019-17572)