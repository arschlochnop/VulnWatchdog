## CVE-2025-29824 - Windows CLFS Use-After-Free EoP

**漏洞编号:** CVE-2025-29824

**漏洞类型:** 权限提升 (Elevation of Privilege)

**影响应用:** Windows Common Log File System (CLFS) Driver

**危害等级:** 高危，可能导致完全系统控制和勒索软件部署

**影响版本:** 受影响的Windows版本请参考漏洞库信息中的CPE匹配规则

**利用条件:** 需要本地访问

**POC 可用性:** 是

**投毒风险:** 20%

## 详情

CVE-2025-29824 是 Windows Common Log File System (CLFS) 驱动中的一个 use-after-free 漏洞，攻击者可以利用此漏洞将权限从普通用户提升到 SYSTEM。

**有效性评估：**

*   根据搜索结果，CVE-2025-29824 是一个真实的漏洞，已被积极利用。
*   多个安全厂商博客（如 Wiz、Socprime、Tenable）和微软官方博客都确认了该漏洞的存在和影响。
*   CISA 已将此漏洞添加到已知被利用的漏洞目录 (KEV)。
*   漏洞利用代码显示，该漏洞与 PipeMagic 勒索软件有关，通过 CLFS 驱动中的 use-after-free 漏洞，攻击者可以覆盖进程令牌，从而获得 SYSTEM 权限。
*   漏洞利用代码中涉及 `CLFS_Trigger_Corruption()` 和 `RtlSetAllBits(exploit_process_token, 0xFFFFFFFF)`，表明通过触发 CLFS 驱动的内存损坏，然后使用 `RtlSetAllBits` 函数覆盖进程令牌，从而获得 SYSTEM 权限。

**投毒风险评估：**

虽然提供的漏洞利用代码主要包含了漏洞利用的必要步骤，但也存在一定的投毒风险，但并不高：

*   **readme.md中的免责声明**: 明确指出该漏洞仅用于研究目的，强调了法律和道德警告，表明作者可能不希望该代码被用于非法活动。
*   **间接性** 漏洞利用代码依赖于 MSBuild， certutil 等进行初始传播,增加了投毒可能性。
*  **解决方案文件（.sln 和 .vcxproj）**: 这些文件本身不太可能包含恶意代码。然而，恶意开发者可能会修改 .vcxproj 文件，添加额外的构建步骤，从而在编译过程中引入恶意行为。但是，这种投毒方式较为明显，容易被发现。
*   **二进制文件缺失：** 真正的威胁通常隐藏在二进制文件中或通过网络连接下载的组件中。如果漏洞利用需要下载额外组件才能执行，则存在下载恶意组件的风险。

综合以上因素，由于缺乏漏洞利用的完整代码，只能判断潜在的投毒风险较低。无法确认在编译过程中引入恶意行为。

**利用方式：**

1.  **初始访问：** 通过未知方式获得目标系统的初始访问权限（可能通过 compromised 网站传播 `certutil` ）。
2.  **PipeMagic Loader：** 运行 PipeMagic 木马的加载器。
3.  **内核漏洞利用：** PipeMagic 调用 CLFS 漏洞利用代码 (`CLFS_Trigger_Corruption()`)，触发 use-after-free 漏洞。
4.  **权限提升：** 使用 `RtlSetAllBits` 函数覆盖当前进程的令牌，将其权限提升到 SYSTEM。
5.  **后渗透：** 获得 SYSTEM 权限后，转储 LSASS 内存以窃取凭据，并部署勒索软件 (RansomEXX)。

**项目地址:** [AfanPan/CVE-2025-29824-Exploit](https://github.com/AfanPan/CVE-2025-29824-Exploit)

**漏洞详情:** [CVE-2025-29824](https://nvd.nist.gov/vuln/detail/CVE-2025-29824)