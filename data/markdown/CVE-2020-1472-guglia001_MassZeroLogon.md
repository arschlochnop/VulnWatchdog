## CVE-2020-1472-Zerologon

**漏洞编号:** CVE-2020-1472

**漏洞类型:** 权限提升

**影响应用:** Windows Server

**危害等级:** 高危，可导致域控被完全控制

**影响版本:** 受影响的Windows Server版本包括2008 R2 SP1, 2012, 2012 R2, 2016, 2019, 2004, 1903, 1909, 20H2

**利用条件:** 需要与域控建立网络连接

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-1472（Zerologon）是一个Netlogon协议中的权限提升漏洞。攻击者可以通过将Netlogon会话的客户端凭据设置为全零来利用此漏洞，从而欺骗身份验证。成功利用此漏洞后，攻击者可以冒充域控制器，窃取域凭据并完全控制整个域。

**有效性:**
提供的Python脚本`MassZeroLogon.py`是Zerologon漏洞的测试工具，基于公开的POC修改而来，用于批量检测目标是否存在此漏洞。脚本通过尝试使用全零凭据进行身份验证来验证漏洞是否存在。如果身份验证成功，则目标被认为是易受攻击的。

**投毒风险:**
代码整体结构清晰，主要功能是漏洞验证。潜在的投毒点可能在于以下几个方面：

*   **`MAX_ATTEMPTS`变量:**虽然当前设置为2000，攻击者可能通过调整此变量来增加攻击的隐蔽性或加大服务器压力，但这不是严格意义上的投毒。
*   **异常处理:**脚本中存在多个`try...except`块。虽然这是为了处理网络连接、RPC调用等可能出现的异常，但也可能被利用来隐藏恶意代码。进一步分析这些异常处理块可以发现是否存在可疑行为。
*   **依赖项:**脚本依赖于`impacket`，`nmb`，`termcolor`, `pyfiglet`等库，如果这些库被篡改，可能导致漏洞利用过程被劫持。

代码中发现恶意投毒代码的可能性较低，约为10%，主要是因为该脚本是从已知的公共存储库复制并针对批量扫描进行了调整。但是，始终应该进行彻底的代码审查，尤其是在生产环境中使用之前。

**利用方式:**
1.  **网络连接:** 攻击者需要与目标域控制器建立网络连接。
2.  **Netlogon会话:** 攻击者使用MS-NRPC协议建立一个Netlogon安全通道连接。
3.  **零凭据认证:** 攻击者发送一个使用全零凭据的身份验证请求。
4.  **权限提升:** 如果域控制器接受了零凭据，攻击者就可以重置域控制器的密码并完全控制域。
5.  **利用工具:** 使用如`impacket-secretsdump`等工具dump域内hash。

**项目地址:** [guglia001/MassZeroLogon](https://github.com/guglia001/MassZeroLogon)

**漏洞详情:** [CVE-2020-1472](https://nvd.nist.gov/vuln/detail/CVE-2020-1472)