## CVE-2024-36587 - dnscrypt-proxy 本地权限提升

**漏洞编号:** CVE-2024-36587

**漏洞类型:** 权限提升

**影响应用:** dnscrypt-proxy

**危害等级:** 高危，允许非特权用户提升到root权限

**影响版本:** v2.0.0alpha9 <= version <= v2.1.5

**利用条件:** 需要本地访问权限，以及dnscrypt-proxy服务已安装并运行。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-36587 是 dnscrypt-proxy v2.0.0alpha9 到 v2.1.5 版本中的一个权限提升漏洞。该漏洞源于不安全的权限配置，允许非特权攻击者通过覆盖 dnscrypt-proxy 二进制文件来提升权限至 root。

**利用方式：**

1.  **恶意二进制文件替换：** 攻击者首先需要在目标系统上拥有本地访问权限。
2.  **权限不足利用：** 利用不安全的权限配置，攻击者可以替换原有的 `dnscrypt-proxy` 二进制文件。
3.  **权限提升：** 当 `dnscrypt-proxy` 服务下次启动时，它将执行攻击者提供的恶意二进制文件，从而以 root 权限运行代码。

**有效性：**

提供的 PoC 代码通过 Docker 容器模拟了漏洞环境。Dockerfile 创建了一个包含存在漏洞的 dnscrypt-proxy 版本的 Ubuntu 24.04 容器。它构建了 dnscrypt-proxy，并创建了一个简单的后门 `/tmp/id`，该后门将 `Pwned_from_Docker` 写入 `/tmp/poc_was_here`。然后，PoC 通过符号链接将 `/tmp/id` 链接到 `/usr/local/bin/id`，模拟了对 id 命令的劫持。

在容器内部运行 PoC，如果 `/tmp/poc_was_here` 存在且包含 `Pwned_from_Docker`，则表明漏洞利用成功。 因此，提供的 PoC 代码是有效的。

**投毒风险：**

查看提供的 Dockerfile 代码和说明文档，发现 `/tmp/id`文件是用于验证漏洞的，而不是用于攻击生产环境的后门程序，该文件本身只在docker环境内部有效，因此不存在作者隐藏的投毒代码。投毒风险为0%。


**项目地址:** [meeeeing/CVE-2024-36587](https://github.com/meeeeing/CVE-2024-36587)

**漏洞详情:** [CVE-2024-36587](https://nvd.nist.gov/vuln/detail/CVE-2024-36587)