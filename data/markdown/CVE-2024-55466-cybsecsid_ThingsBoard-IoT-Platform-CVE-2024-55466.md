## ThingsBoard Stored XSS Privilege Escalation

**漏洞编号:** CVE-2024-55466

**漏洞类型:** Stored Cross-Site Scripting (XSS)

**影响应用:** ThingsBoard

**危害等级:** CRITICAL (CVSS 8.8), 通过盗取认证令牌提升权限

**影响版本:** <= 3.8.1

**利用条件:** 需要低权限用户账户，并能访问ThingsBoard实例

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于ThingsBoard的“Image Gallery”功能中。低权限用户可以上传包含恶意JavaScript代码的SVG文件。当高权限用户（例如Tenant Administrator）访问包含恶意SVG文件的页面时，恶意JavaScript代码会被执行，攻击者可以盗取高权限用户的身份验证令牌，从而提升权限。

**有效性:**  提供的POC代码有效，它描述了如何利用存储型XSS漏洞盗取用户Cookie。POC中提供了详细的重现步骤和截图。

**投毒风险:** 尽管POC代码本身看起来是良性的漏洞演示，但仍然存在一定的投毒风险。风险在于，攻击者可能会修改POC中的XSS payload，使其包含恶意行为，例如：

*   植入后门：通过XSS注入额外的JavaScript代码，在受害者浏览器中执行恶意操作。
*   重定向：将受害者重定向到钓鱼网站。
*   窃取敏感信息：除了Cookie之外，还可以窃取其他敏感信息。

因此，不能完全排除投毒的可能性。这里给出一个较低的百分比(10%)，因为POC的主要目的是演示XSS漏洞，而不是传播恶意代码。

**利用方式:**

1.  攻击者获得一个低权限的ThingsBoard账户。
2.  攻击者导航到`Resources > Image Gallery`。
3.  攻击者上传一个包含恶意JavaScript代码的SVG文件。
4.  攻击者获取上传文件后的`publicLink`。
5.  攻击者诱骗高权限用户访问该`publicLink`，触发XSS。
6.  恶意JavaScript代码执行，盗取高权限用户的认证令牌。
7.  攻击者使用盗取的认证令牌冒充高权限用户，提升权限。

**项目地址:** [cybsecsid/ThingsBoard-IoT-Platform-CVE-2024-55466](https://github.com/cybsecsid/ThingsBoard-IoT-Platform-CVE-2024-55466)

**漏洞详情:** [CVE-2024-55466](https://nvd.nist.gov/vuln/detail/CVE-2024-55466)