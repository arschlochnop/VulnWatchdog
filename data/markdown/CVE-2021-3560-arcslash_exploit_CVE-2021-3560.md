## CVE-2021-3560-polkit权限提升

**漏洞编号:** CVE-2021-3560

**漏洞类型:** 权限提升

**影响应用:** polkit

**危害等级:** 高危，可导致本地普通用户提升至root权限

**影响版本:** polkit 0.119

**利用条件:** 本地用户，目标系统安装受影响版本的polkit

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-3560 允许本地未经授权的用户通过利用 polkit 中的缺陷，获得 root 权限。漏洞原理是利用了 polkit 在处理 D-Bus 请求时对凭据检查的绕过。

**漏洞利用有效性评估：**
根据漏洞库信息、搜索引擎结果以及提供的漏洞利用代码，该漏洞确实存在并且有公开的利用方式。该漏洞已被CISA列入已知被利用的漏洞目录(KEV)。提供的POC代码利用了竞态条件，通过在 `org.freedesktop.Accounts.CreateUser` 方法执行期间的特定时间点终止 `dbus-send` 进程来绕过权限检查，从而创建具有 root 权限的用户。

**投毒风险分析：**
虽然脚本主要功能是实现权限提升，但也存在一定的投毒风险。

*   **用户创建和密码设置：** 脚本会尝试创建一个名为 john 的用户，并设置密码 john@123。如果攻击者在不知情的情况下直接使用该脚本，可能导致系统上存在一个已知的后门账号。
*   **定时炸弹风险：** 理论上，攻击者可以在脚本中添加延时执行的恶意代码，或者根据特定条件触发恶意行为，但当前的脚本并没有发现这种行为。

综合来看，投毒风险较低，但使用者需要谨慎，避免在生产环境直接使用，应进行代码审计。

**漏洞利用方式：**

1.  **竞态条件利用：** 漏洞利用的核心是利用竞态条件。脚本首先测量 `dbus-send` 命令创建用户所需的时间。
2.  **进程中断：** 脚本随后并行执行 `dbus-send` 命令，并在大约一半的测量时间后终止 `dbus-send` 进程。
3.  **绕过权限检查：** 通过在特定时刻中断进程，可以绕过 polkit 的权限检查，从而允许创建具有管理员权限的用户。
4.  **密码设置：** 如果用户创建成功，脚本会尝试使用 `openssl` 生成密码哈希，并通过 `dbus-send` 设置用户密码。
5.  **多次尝试：** 由于竞态条件的不确定性，脚本会多次尝试该过程，以增加漏洞利用的成功率。

**项目地址:** [arcslash/exploit_CVE-2021-3560](https://github.com/arcslash/exploit_CVE-2021-3560)

**漏洞详情:** [CVE-2021-3560](https://nvd.nist.gov/vuln/detail/CVE-2021-3560)