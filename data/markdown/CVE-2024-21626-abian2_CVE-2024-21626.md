## CVE-2024-21626-runc容器逃逸

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可能导致容器逃逸，控制宿主机

**影响版本:** < 1.1.12

**利用条件:** 需要受影响的runc版本，以及运行恶意镜像或执行恶意命令的能力

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-21626是一个runc容器逃逸漏洞，源于runc在处理文件描述符时存在泄漏。攻击者可以利用这个漏洞，通过特制的容器镜像或`runc exec`命令，使得容器进程的当前工作目录（cwd）指向宿主机的文件系统命名空间。提供的Dockerfile展示了利用方式：它将工作目录设置为`/proc/self/fd/8`，其中`8`是一个泄漏的文件描述符，该文件描述符可能指向宿主机上的某个目录。然后，通过`cat ../../../../etc/passwd`读取宿主机的`/etc/passwd`文件，从而实现容器逃逸。根据漏洞描述，还可能利用此漏洞覆盖宿主机上的二进制文件，进一步扩大攻击面。 

**有效性评估：**

提供的POC代码是有效的，可以用来验证该漏洞。搜索结果中的多个链接（如`https://github.com/NitroCao/CVE-2024-21626`和`https://nitroc.org/en/posts/cve-2024-21626-illustrated/`）也表明存在公开可用的利用代码。

**投毒风险评估：**

由于POC代码非常简洁，主要功能是利用文件描述符泄漏读取宿主机文件，因此直接的投毒风险较低。但是，仍存在一定的风险，例如：

1.  **构建时投毒：** Dockerfile中可能存在通过`RUN`指令执行恶意命令，从而在构建镜像时植入后门的风险。
2.  **依赖投毒：** 基础镜像`alpine`可能已被篡改，包含恶意代码（虽然可能性较低）。
3.  **供应链投毒：** 攻击者可能篡改代码仓库或构建流程，从而引入恶意代码。但就提供的Dockerfile本身来说，投毒风险较低。所以综合评估投毒风险为10%。

**利用方式总结：**

1.  **恶意镜像：** 构建包含恶意代码的Docker镜像，利用漏洞读取或修改宿主机文件。
2.  **恶意命令：** 通过`runc exec`等命令，结合泄漏的文件描述符，执行宿主机上的命令。
3.  **文件覆盖：** 利用泄漏的文件描述符，覆盖宿主机上的关键二进制文件，实现持久化控制。

该漏洞的修复方法是升级到runc 1.1.12或更高版本，该版本修复了文件描述符泄漏问题。

**项目地址:** [abian2/CVE-2024-21626](https://github.com/abian2/CVE-2024-21626)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)