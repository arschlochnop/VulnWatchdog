## CVE-2021-26855 - Microsoft Exchange Server Remote Code Execution Vulnerability (ProxyLogon)

**漏洞编号:** CVE-2021-26855

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Microsoft Exchange Server

**危害等级:** 高危，无需身份验证即可远程代码执行

**影响版本:** Microsoft Exchange Server 2013 Cumulative Update 21, 22, 23; 2016 Cumulative Update 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19; 2019 Cumulative Update 1, 2, 3, 4, 5, 6, 7, 8

**利用条件:** Exchange Server对外开放443端口

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2021-26855 是一个存在于 Microsoft Exchange Server 中的服务器端请求伪造（SSRF）漏洞，它允许未经身份验证的攻击者发送任意 HTTP 请求并伪装成 Exchange 服务器的管理员。此漏洞是 ProxyLogon 攻击链的入口点，后续可以配合其他漏洞实现远程代码执行。

**有效性分析：**
根据漏洞库信息、搜索引擎结果和提供的漏洞利用代码，此漏洞利用是有效的。搜索引擎结果中许多链接都表明 CVE-2021-26855 已被积极利用。漏洞利用代码 `26855.py` 实现了利用该漏洞的步骤，包括：

1.  **SSRF 探测：** 通过构造特殊的 `X-BEResource` 请求头，获取 Exchange 后端服务器的计算机名和域名。
2.  **LegacyDN 获取：** 利用 Autodiscover 服务，通过提供用户邮箱地址获取 LegacyDN。
3.  **SID 欺骗：** 伪造 MAPI 请求，通过 LegacyDN 获取用户的 SID。
4.  **ProxyLogon 利用：** 利用获取到的 SID，通过 `proxyLogon.ecp` 绕过身份验证。
5.  **Webshell 部署：** 写入 Webshell 到服务器。

**投毒风险分析：**
漏洞利用代码中存在较低的投毒风险 (大约 5%)。虽然代码的目的是利用漏洞，但攻击者可能在 `webshell_content` 中植入恶意代码，或者修改 `webshell_path` 将webshell写入到不常见的位置，使得后期的权限维持或者横向移动更加隐蔽。例如，如果`webshell_content`包含下载和执行其他恶意文件的指令，这就是一种投毒行为。 目前提供的webshell代码较为简单，判定投毒的概率较低。

**利用方式总结：**
1.  攻击者首先利用 SSRF 漏洞 (CVE-2021-26855) 绕过身份验证。
2.  攻击者通过构造恶意的 HTTP 请求，欺骗 Exchange 服务器，使其认为攻击者已通过身份验证。
3.  成功绕过身份验证后，攻击者可以使用其他漏洞（例如 CVE-2021-27065，写入任意文件）在 Exchange 服务器上执行任意代码，部署 Webshell。
4.  攻击者通过 Webshell 执行系统命令，控制 Exchange 服务器。

**项目地址:** [hosch3n/ProxyVulns](https://github.com/hosch3n/ProxyVulns)

**漏洞详情:** [CVE-2021-26855](https://nvd.nist.gov/vuln/detail/CVE-2021-26855)