## CVE-2024-36401-GeoServer-RCE

**漏洞编号:** CVE-2024-36401

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** GeoServer

**危害等级:** 严重，未经身份验证的远程代码执行

**影响版本:** < 2.22.6, >= 2.23.0 and < 2.23.6, >= 2.24.0 and < 2.24.4, >= 2.25.0 and < 2.25.2

**利用条件:** 默认 GeoServer 安装，网络可访问

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-36401 存在于 GeoServer 中，由于不安全地将属性名称评估为 XPath 表达式，未经身份验证的用户可以通过构造特制的 OGC 请求参数来执行远程代码。

**有效性：**
根据漏洞信息和搜索结果，该漏洞利用已被证实有效，并且在野外已被利用。提供的漏洞利用代码（GeoServer-Tools）旨在简化利用过程，支持不同 JDK 版本的回显和内存马注入。

**投毒风险：**
查看了提供的POC代码，主要是一个GUI工具，利用了`woodpecker-requests`进行网络请求，`flatlaf`做界面美化。主要功能是发送payload到目标服务器，根据描述可以支持内存马注入，回显等功能。经过分析，该工具本身存在投毒的可能性较低。但考虑到代码审查的局限性，仍存在一定的风险，因此评估投毒风险为10%。这些风险可能包括：
  *   **非必要依赖：** 引入了不必要的依赖库，这些库可能包含未知的安全漏洞或被恶意利用。
  *   **后门代码：** 在工具中隐藏了后门代码，例如在内存马功能中，注入恶意代码。

**利用方式：**
1.  攻击者通过构造恶意的 OGC 请求（例如，WFS GetFeature、WFS GetPropertyValue、WMS GetMap、WMS GetFeatureInfo、WMS GetLegendGraphic 和 WPS Execute 请求）来触发漏洞。
2.  恶意请求包含特制的 XPath 表达式，这些表达式在评估属性名称时被 GeoServer 不安全地执行。
3.  通过执行恶意 XPath 表达式，攻击者可以在 GeoServer 服务器上执行任意代码。
4.  漏洞利用代码（GeoServer-Tools）提供了一个图形界面，允许攻击者指定目标 GeoServer 实例的 URL，选择不同的攻击载荷（如 DNSLog、命令回显、内存马注入），并发送恶意请求。

**总结：**
CVE-2024-36401 是一个严重的安全漏洞，允许未经身份验证的攻击者在 GeoServer 上执行任意代码。提供的漏洞利用代码简化了利用过程，但需要谨慎使用，并注意潜在的投毒风险。

**项目地址:** [bmth666/GeoServer-Tools-CVE-2024-36401](https://github.com/bmth666/GeoServer-Tools-CVE-2024-36401)

**漏洞详情:** [CVE-2024-36401](https://nvd.nist.gov/vuln/detail/CVE-2024-36401)