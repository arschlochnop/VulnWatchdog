## CVE-2017-7921 - 海康威视摄像机不当身份验证漏洞

**漏洞编号:** CVE-2017-7921

**漏洞类型:** 不当身份验证

**影响应用:** 海康威视摄像机

**危害等级:** 高危，可能导致权限提升和敏感信息泄露

**影响版本:** DS-2CD2xx2F-I Series V5.2.0 build 140721 to V5.4.0 build 160530, DS-2CD2xx0F-I Series V5.2.0 build 140721 to V5.4.0 Build 160401, DS-2CD2xx2FWD Series V5.3.1 build 150410 to V5.4.4 Build 161125, DS-2CD4x2xFWD Series V5.2.0 build 140721 to V5.4.0 Build 160414, DS-2CD4xx5 Series V5.2.0 build 140721 to V5.4.0 Build 160421, DS-2DFx Series V5.2.0 build 140805 to V5.4.5 Build 160928, and DS-2CD63xx Series V5.0.9 build 140305 to V5.3.5 Build 160106

**利用条件:** 需要网络访问目标摄像机，目标摄像机存在漏洞且未修复。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2017-7921 是海康威视摄像机中存在的一个不当身份验证漏洞。攻击者可以通过在请求中包含特定的 'auth' 参数（包含base64编码的'用户名:密码'字符串，密码可以任意），绕过身份验证，获取管理员权限。利用此漏洞，攻击者可以访问敏感信息，如摄像机配置，甚至可以修改摄像机固件，导致设备永久损坏或植入恶意代码。

**漏洞利用方式:**

1.  **身份验证绕过:**  攻击者构造包含`auth=YWRtaW46MTEK`参数的HTTP请求，其中`YWRtaW46MTEK`是`admin:11`的Base64编码。由于漏洞的存在，摄像机会错误地认为攻击者已通过身份验证。
2.  **配置信息获取:** 通过访问`http://<camera_ip>/System/configurationFile?auth=YWRtaW46MTEK`端点，攻击者可以下载摄像机的配置信息。
3.  **权限提升:** 攻击者利用绕过的身份验证，可以执行需要管理员权限的操作，例如添加新用户或修改摄像机设置。

**有效性:**

提供的PoC代码 `CVE_2017_7921_EXP.py` 看起来是有效的，它利用了上述漏洞，尝试通过发送包含`auth`参数的请求来获取摄像机的配置信息，并尝试提取用户名和密码。

**投毒风险:**

该PoC代码主要功能是利用漏洞进行信息收集，而非直接植入后门。但是,代码中包含一些潜在的风险，例如：

*   **依赖外部库:** 代码依赖于 `requests` 和 `pycryptodome` 库。虽然这些库本身很常用，但如果攻击者控制了代码的运行环境，可能会通过替换这些库来引入恶意代码。
*   **配置解析:** 代码解析摄像机的配置信息，这可能暴露敏感信息。如果攻击者修改代码，可以将这些信息发送到远程服务器。
*   **异常处理:** 代码中的异常处理相对简单，可能存在未考虑到的异常情况，攻击者可以利用这些异常来执行恶意操作。

总体来说，直接的投毒风险较低（约为5%），主要是代码本身可能被滥用或者被修改后用于其他恶意目的。

**项目地址:** [inj3ction/CVE-2017-7921-EXP](https://github.com/inj3ction/CVE-2017-7921-EXP)

**漏洞详情:** [CVE-2017-7921](https://nvd.nist.gov/vuln/detail/CVE-2017-7921)