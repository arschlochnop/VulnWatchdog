## CVE-2024-3400 PAN-OS GlobalProtect 远程命令执行

**漏洞编号:** CVE-2024-3400

**漏洞类型:** 命令注入

**影响应用:** Palo Alto Networks PAN-OS GlobalProtect

**危害等级:** 高危，未经身份验证的攻击者可以root权限执行任意代码

**影响版本:** PAN-OS 10.2 < 10.2.9-h1, PAN-OS 11.0 < 11.0.4-h1, PAN-OS 11.1 < 11.1.2-h3

**利用条件:** 目标系统配置了GlobalProtect网关或门户，攻击者可以发起网络请求

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-3400 是 Palo Alto Networks PAN-OS GlobalProtect 中的一个命令注入漏洞。该漏洞允许未经身份验证的远程攻击者在受影响的系统上以 root 权限执行任意命令。利用方式是通过向目标服务器的/ssl-vpn/hipreport.esp路径发送特制的HTTP POST请求，并在Cookie头中注入恶意代码。

**有效性分析：**
根据漏洞库信息、搜索结果和提供的漏洞利用代码，可以判断此POC代码是有效的。
  * 漏洞库信息表明该漏洞确实存在，并且有可利用的POC。
  * 搜索结果显示存在大量关于该漏洞的分析和利用的文章。
  * POC代码实现了利用该漏洞执行命令的功能，通过构造包含恶意命令的 Cookie 发送到目标服务器，从而实现远程命令执行。

**投毒风险分析：**
提供的 `exploit.py` 脚本的功能主要是生成并发送包含反弹 shell 命令的 HTTP 请求。代码中没有发现明显的恶意行为或者隐藏的后门代码。脚本的行为是可以预测的，即根据用户输入的 IP 地址和端口，生成反弹 shell 命令，并将其嵌入到 Cookie 中发送给目标服务器。`README.md` 文件也只是描述漏洞信息和使用示例。因此，投毒风险较低，可以判断投毒风险为 0%。

**利用方式分析：**
1.  **漏洞触发点：** GlobalProtect 功能的 `/ssl-vpn/hipreport.esp` 路径。
2.  **攻击向量：** 通过构造恶意的 HTTP Cookie，在 Cookie 中嵌入经过 base64 编码的命令。
3.  **命令注入：**  恶意命令被注入到 Cookie `SESSID` 中，服务器在处理 Cookie 时，未对其中的内容进行充分的验证和过滤，导致命令被执行。
4.  **利用过程：**
    *   攻击者首先需要确定目标系统存在 CVE-2024-3400 漏洞，并且配置了 GlobalProtect 功能。
    *   然后，攻击者运行 `exploit.py` 脚本，输入目标服务器的 IP 地址、攻击者用于接收反弹 shell 的 IP 地址和端口。
    *   脚本会生成一个包含反弹 shell 命令的 HTTP 请求，并将该请求发送到目标服务器的 `/ssl-vpn/hipreport.esp` 路径。
    *   目标服务器在处理该请求时，会执行 Cookie 中的恶意命令，从而建立一个反弹 shell 连接到攻击者的机器上。
    *   攻击者即可通过该反弹 shell 连接控制目标系统。

**项目地址:** [0x0d3ad/CVE-2024-3400](https://github.com/0x0d3ad/CVE-2024-3400)

**漏洞详情:** [CVE-2024-3400](https://nvd.nist.gov/vuln/detail/CVE-2024-3400)