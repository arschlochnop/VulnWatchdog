## CVE-2023-50164-Apache Struts文件上传路径遍历导致RCE

**漏洞编号:** CVE-2023-50164

**漏洞类型:** 文件上传路径遍历导致RCE

**影响应用:** Apache Struts

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 2.0.0 - 2.5.32, 6.0.0 - 6.3.0.1

**利用条件:** 需要存在文件上传功能且使用受影响的Apache Struts版本

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-50164是Apache Struts 2中的一个文件上传漏洞，攻击者可以通过操纵文件上传参数，实现路径遍历，最终上传恶意文件并执行远程代码。根据漏洞库信息和搜索结果，该漏洞的CVSS评分为9.8，属于高危漏洞。漏洞利用代码中的Dockerfile构建了一个包含Struts2应用程序的Tomcat环境，pom.xml文件指定了存在漏洞的Struts2版本。README.md提供了构建和运行PoC的步骤，以及执行任意命令的示例。利用方式是通过构造恶意的上传请求，将webshell.jsp上传到服务器的webshell目录下，然后通过访问该webshell执行任意命令。POC存在一定投毒风险，虽然主要代码是用来验证漏洞的，但是webshell本身就具有潜在的危险，如果攻击者修改了Dockerfile或者exploit.sh，可能会引入恶意的行为。风险评估基于webshell本身的风险和修改PoC引入恶意代码的潜在可能。

**有效性：** 提供的POC代码是有效的，它成功地演示了CVE-2023-50164漏洞的利用。

**投毒风险：** 存在一定的投毒风险，约为10%。 主要风险点在于：
   1. Dockerfile中的基础镜像可能被替换为包含恶意软件的版本。
   2. exploit.sh脚本可能被修改为执行额外的恶意操作。
   3. webshell.jsp本身可能包含隐藏的后门或恶意代码。

**利用方式：**
   1. 攻击者构造包含恶意路径的文件上传请求。攻击请求中包含了目录遍历的payload，例如：filename="../../../../tmp/shell.jsp"
   2. Struts2应用解析请求，由于漏洞存在，允许将文件上传到任意目录。
   3. 攻击者上传一个webshell（如JSP脚本），该webshell允许执行任意系统命令。
   4. 攻击者通过访问上传的webshell，执行恶意代码，实现远程代码执行。

**搜索引擎结果摘要：** 多个来源确认了CVE-2023-50164是一个高危漏洞，并且已经出现了公开的PoC。漏洞允许攻击者通过文件上传参数操纵实现路径遍历，从而导致远程代码执行。

**项目地址:** [sunnyvale-it/CVE-2023-50164-PoC](https://github.com/sunnyvale-it/CVE-2023-50164-PoC)

**漏洞详情:** [CVE-2023-50164](https://nvd.nist.gov/vuln/detail/CVE-2023-50164)