## CVE-2024-25641-Cacti-RCE

**漏洞编号:** CVE-2024-25641

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Cacti

**危害等级:** 高危，可完全控制服务器

**影响版本:** < 1.2.27

**利用条件:** 需要具有 "Import Templates" 权限的已认证用户

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2024-25641 是 Cacti 1.2.27 之前版本中的一个远程代码执行漏洞。该漏洞存在于 `import_package()` 函数中，该函数位于 `/lib/import.php` 脚本。具有 "Import Templates" 权限的已认证用户可以通过 "Package Import" 功能利用此漏洞，通过上传恶意的软件包，在服务器上执行任意 PHP 代码。漏洞利用方式如下：

1.  **漏洞描述：** 由于Cacti在处理导入包时未对文件名和文件内容进行充分验证，攻击者可以通过构造包含恶意PHP代码的包文件，覆盖或写入服务器上的任意文件。
2.  **利用条件：** 需要目标Cacti版本低于1.2.27, 并且攻击者拥有"Import Templates"权限。
3.  **利用步骤：**
    *   使用有效凭据登录 Cacti。
    *   构造一个包含恶意 PHP 代码的文件。
    *   创建一个包含该文件的 XML 配置文件，并使用 RSA 密钥签名。
    *   将 XML 配置文件压缩为 gzip 格式。
    *   通过 Cacti 的 "Package Import" 功能上传该 gzip 文件。
    *   Cacti 将会解压并写入恶意文件到服务器上，可能覆盖现有文件。
    *   访问恶意文件，执行其中的 PHP 代码。

4.  **POC 代码分析：**
    *   提供的 exploit.py 脚本自动化了上述利用过程。
    *   它首先登录到 Cacti。
    *   然后，它生成包含 PHP payload 的 gzip 文件。
    *   接着，它通过两次 POST 请求上传该 gzip 文件，第一次用于预览，第二次用于确认导入。
    *   最后，它尝试运行上传的 PHP payload。
5.  **有效性评估：**
    *   根据漏洞描述和 POC 代码，该漏洞利用是有效的。搜索引擎结果也表明该漏洞存在可利用的 POC。
6. **投毒风险评估：**
* 代码主要功能是利用漏洞实现RCE，主要操作都是围绕漏洞展开，没有发现明显的恶意行为
* 脚本会从用户指定的`php/monkey.php`加载payload，如果用户自己下载的`php/monkey.php`被篡改可能会导致后门
* 脚本本身存在一定风险，例如默认payload，用户如果直接使用默认payload可能会被其他人利用，造成损失
* 总的来说，此仓库的投毒风险较低，大概在1%，主要是由于默认payload和用户可能使用被篡改的payload导致。
* 仓库的readme.md文件是对漏洞利用的解释，没有发现可疑代码。

综上所述，该漏洞利用的有效性较高，但存在轻微的投毒风险。

**项目地址:** [5ma1l/CVE-2024-25641](https://github.com/5ma1l/CVE-2024-25641)

**漏洞详情:** [CVE-2024-25641](https://nvd.nist.gov/vuln/detail/CVE-2024-25641)