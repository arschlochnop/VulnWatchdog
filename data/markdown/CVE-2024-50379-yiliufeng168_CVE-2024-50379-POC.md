## CVE-2024-50379-Apache Tomcat-TOCTOU 竞争条件导致RCE

**漏洞编号:** CVE-2024-50379

**漏洞类型:** TOCTOU 竞争条件

**影响应用:** Apache Tomcat

**危害等级:** 高危，允许远程代码执行

**影响版本:** <= 11.0.1, <= 10.1.33, <= 9.0.97

**利用条件:** 默认Servlet的readonly参数设置为false（允许写入），运行在大小写不敏感的文件系统上（如Windows）。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-50379 是一个 Apache Tomcat 中的 Time-of-Check Time-of-Use (TOCTOU) 竞争条件漏洞。当默认Servlet配置为可写（非默认配置），且运行在大小写不敏感的文件系统上时，攻击者可以利用此漏洞实现远程代码执行。

**有效性：**
提供的 POC 代码有效。它利用了 TOCTOU 漏洞，通过上传一个 JSP 文件，然后快速替换为大小写不同的同名文件，在大小写不敏感的文件系统上绕过检查，最终执行恶意代码。

**投毒风险：**
该仓库的投毒风险较低。虽然代码提供了RCE的手段，但主要集中在利用漏洞本身，而非植入额外的恶意代码。`hello.jsp`只是一个演示用的后门文件，用于验证漏洞的存在。`upload.jsp`文件上传功能存在被恶意利用的可能，因此存在很小的投毒风险。

**利用方式：**
1.  **配置条件：** 目标 Tomcat 服务器必须满足以下条件：
    *   运行在大小写不敏感的文件系统上（如 Windows）。
    *   默认 Servlet 的 `readonly` 参数设置为 `false`，允许上传文件。
2.  **上传 JSP 文件：** 攻击者首先上传一个 JSP 文件（例如，`file.jsp`），该文件包含恶意代码。
3.  **竞争条件：** 攻击者快速将上传的文件替换为大小写不同的同名文件（例如，`FILE.JSP`）。由于文件系统大小写不敏感，原始文件将被覆盖。
4.  **代码执行：** 当 Tomcat 尝试编译和执行 JSP 文件时，会执行攻击者上传的恶意代码，导致远程代码执行。

**参考信息：**
搜索结果中多个链接（例如，vulcan.io, wiz.io, redhat.com, nvd.nist.gov, medium.com, sangfor.com, mend.io, cvedetails.com）均证实了该漏洞的存在以及 RCE 的可能性，并提供了修复建议。

**项目地址:** [yiliufeng168/CVE-2024-50379-POC](https://github.com/yiliufeng168/CVE-2024-50379-POC)

**漏洞详情:** [CVE-2024-50379](https://nvd.nist.gov/vuln/detail/CVE-2024-50379)