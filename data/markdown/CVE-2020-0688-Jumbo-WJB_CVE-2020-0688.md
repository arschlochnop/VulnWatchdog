## CVE-2020-0688 Microsoft Exchange Server 远程代码执行

**漏洞编号:** CVE-2020-0688

**漏洞类型:** 远程代码执行

**影响应用:** Microsoft Exchange Server

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** Microsoft Exchange Server 2010 SP3 UR30, 2013 CU23, 2016 CU14/CU15, 2019 CU3/CU4

**利用条件:** 需要有效的Exchange用户凭据（用户名和密码）

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2020-0688 是一个 Microsoft Exchange Server 中的远程代码执行漏洞，源于 Exchange Control Panel (ECP) 未能正确处理内存中的对象。该漏洞利用了静态的validationKey和generator，允许攻击者通过构造恶意的ViewState来反序列化任意对象，从而执行任意代码。

**有效性：**
根据提供的漏洞库信息、搜索引擎结果和漏洞利用代码，可以判断此POC代码有效。搜索引擎结果中多次提到CVE-2020-0688被实际利用。PoC代码 `CVE-2020-0688.py` 的内容显示，它尝试利用Exchange的ECP接口，通过提供用户名和密码来获取`ASP.NET_SessionId`和`__VIEWSTATEGENERATOR`，然后使用ysoserial生成恶意的ViewState payload，并将其注入到请求中。

**投毒风险：**
分析 `CVE-2020-0688.py` 的代码，投毒风险较低，大约为5%。主要风险点在于：
*   该脚本依赖外部程序 `ysoserial.exe` 来生成payload，如果攻击者的 `ysoserial.exe` 被篡改，可能存在投毒风险。但是脚本本身没有执行恶意行为的迹象。
*  脚本在运行时会要求用户手动输入`ysoserial`命令生成的payload, 这增加了人工干预,降低了自动化攻击的可能，同时也降低了脚本本身被植入恶意代码的可能性。 

**利用方式：**
1.  **获取Exchange用户凭据：**  攻击者需要有效的Exchange用户凭据（用户名和密码）才能进行身份验证。
2.  **身份验证：**  使用提供的用户名和密码向 `/owa/auth.owa` 进行身份验证，获取 `ASP.NET_SessionId` 和 `__VIEWSTATEGENERATOR`。
3.  **生成恶意ViewState payload：** 使用 `ysoserial.exe` 工具，基于 `TextFormattingRunProperties` gadget chain，生成包含命令的ViewState payload。
4.  **发送恶意请求：**  将生成的ViewState payload 作为 `__VIEWSTATE` 参数，结合 `__VIEWSTATEGENERATOR` 参数，发送到 `/ecp/default.aspx`。服务器在处理ViewState时，会反序列化恶意对象，从而执行payload中的命令。

总而言之，利用该漏洞需要有效的Exchange用户凭据以及`ysoserial`工具，攻击者能够通过精心构造的ViewState payload在目标Exchange服务器上执行任意代码。

**项目地址:** [Jumbo-WJB/CVE-2020-0688](https://github.com/Jumbo-WJB/CVE-2020-0688)

**漏洞详情:** [CVE-2020-0688](https://nvd.nist.gov/vuln/detail/CVE-2020-0688)