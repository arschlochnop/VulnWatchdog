## CVE-2017-12611 - Apache Struts Freemarker RCE

**漏洞编号:** CVE-2017-12611

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Struts

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** 2.0.0 - 2.3.33, 2.5 - 2.5.10.1

**利用条件:** 目标系统运行受影响版本的 Apache Struts，且使用了存在漏洞的 Freemarker 标签。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2017-12611 是一个 Apache Struts 的远程代码执行漏洞。该漏洞源于在使用 Freemarker 标签时，将意外表达式而非字符串文字作为参数传入，导致攻击者可以执行任意代码。根据漏洞描述和提供的PoC代码，利用方式如下：

1.  **漏洞原理：** Struts2 框架中的 Freemarker 标签在处理用户输入时，如果使用了 OGNL 表达式且没有进行充分的过滤，攻击者可以通过构造恶意的 OGNL 表达式来执行任意代码。
2.  **PoC 分析：** 提供的 PoC 代码是一个 OGNL 表达式，它首先获取 OgnlContext，然后绕过 OGNL 的安全限制（通过清除 excludedPackageNames 和 excludedClasses），最后执行指定的命令（默认为 `id`）。
3.  **利用步骤：**
    *   使用 Burp Suite 等工具拦截 HTTP 请求。
    *   将 PoC 代码作为参数（通常是表单参数或 URL 参数）插入到请求中。
    *   将修改后的请求发送到目标服务器。
    *   如果目标服务器存在漏洞，将会执行 PoC 代码中指定的命令，并将结果返回。
4.  **有效性评估：** 根据漏洞信息和 PoC 代码，该漏洞利用是有效的。大量资料表明该漏洞被广泛利用，并且存在公开可用的 PoC。
5.  **投毒风险：** 仓库本身是一个简单的 PoC，直接的投毒风险较低。 但是，需要注意以下几个潜在的风险点：
    *   **命令执行：** PoC 代码允许执行任意命令。攻击者可能会修改 PoC 代码，执行更危险的命令，例如下载和执行恶意软件，添加后门等。
    *   **依赖项：** 虽然提供的环境设置很简单，但如果引入了其他依赖项，这些依赖项可能存在漏洞，导致投毒。
    *   **开发者疏忽：** 如果开发者直接复制粘贴 PoC 代码到自己的项目中，并且没有进行充分的安全审查，可能会引入漏洞。

考虑到以上风险点，存在10%的投毒风险。此风险主要来自于使用者直接使用PoC并进行修改后，可能产生恶意行为。

**项目地址:** [zeynepsilao/CVE-2017-12611_Exploit](https://github.com/zeynepsilao/CVE-2017-12611_Exploit)

**漏洞详情:** [CVE-2017-12611](https://nvd.nist.gov/vuln/detail/CVE-2017-12611)