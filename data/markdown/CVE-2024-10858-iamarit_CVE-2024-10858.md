## CVE-2024-10858 - Jetpack DOM-XSS

**漏洞编号:** CVE-2024-10858

**漏洞类型:** DOM-XSS

**影响应用:** Jetpack WordPress Plugin

**危害等级:** 中危，可能允许未经身份验证的攻击者在WordPress.com托管的站点上执行任意JavaScript代码

**影响版本:** 13.0 - 14.0 (不包含14.1)

**利用条件:** Jetpack插件版本在13.0到14.0之间，并且网站托管在WordPress.com上。需要用户点击攻击者构造的链接。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-10858 是 Jetpack WordPress 插件中存在的一个 DOM-XSS 漏洞。该漏洞存在于 Jetpack 插件的 13.x 版本中，由于插件未正确检查 postMessage 的 origin，导致攻击者可以绕过同源策略，从而执行恶意 JavaScript 代码。该漏洞影响的版本为 13.0 到 14.0（不包含 14.1）。

**有效性：**

提供的 POC 代码显示，攻击者通过 JavaScript 打开一个包含易受攻击的 Jetpack 插件的 WordPress 网站的新窗口，并使用 `postMessage` 函数将包含恶意 JavaScript 代码的消息发送到该窗口。`payload` 中的 `url` 字段被设置为 `javascript://zerodha.com/z-connect/%0Aalert(document.domain)`，这将导致在目标网站上执行 `alert(document.domain)` 代码。根据漏洞描述和提供的 POC 代码，该 POC 具有有效性。

**投毒风险：**

分析提供的 POC 代码，`index.html` 文件主要包含以下几个部分：

*   一个标题和一个按钮。
*   JavaScript 代码：
    *   监听按钮的点击事件。
    *   在点击时，打开一个新窗口，指向一个疑似存在漏洞的 WordPress 网站 (`https://zerodha.com/z-connect/`)。
    *   构造一个包含 `type` 和 `data` 字段的 `payload` 对象。其中 `data.url` 包含 `javascript:alert(document.domain)`，这是用于执行 XSS 的恶意代码。
    *   使用 `setInterval` 函数，每隔 500 毫秒向新打开的窗口发送 `payload` 消息，直到窗口关闭。

在代码中，`vuln_window.postMessage(payload, '*')` 使用 `*` 作为目标 origin。虽然这样允许来自任何来源的消息，但也是利用此漏洞所必需的。然而，这种使用方式也存在一定的风险，如果攻击者可以控制发送消息的环境，可能会存在一定风险。

在给定的上下文中，**投毒风险较低，大约为 10%**。主要考虑到以下几点：

*   代码的主要目的是演示漏洞利用，而不是隐藏恶意行为。
*   漏洞利用代码的重点是利用 `postMessage` 的 origin 验证不当问题，而不是植入后门。
*   虽然 `vuln_window.postMessage(payload, '*')` 的使用存在风险，但这是利用此漏洞所必需的。
*   POC 使用 `alert(document.domain)`，这仅仅是一个PoC， 并不是投毒代码。


**利用方式：**

1.  攻击者创建一个包含恶意 JavaScript 代码的 HTML 页面。
2.  HTML 页面中的 JavaScript 代码会打开一个包含易受攻击的 Jetpack 插件的 WordPress 网站的新窗口。
3.  JavaScript 代码使用 `postMessage` 函数，将包含恶意 JavaScript 代码的 `payload` 发送到新打开的窗口。
4.  由于 Jetpack 插件未正确检查 postMessage 的 origin，恶意 JavaScript 代码会在目标网站上执行。
5.  成功利用此漏洞可能允许攻击者在受害者浏览器中执行任意 JavaScript 代码，例如窃取 cookie、重定向用户到恶意网站等。

**项目地址:** [iamarit/CVE-2024-10858](https://github.com/iamarit/CVE-2024-10858)

**漏洞详情:** [CVE-2024-10858](https://nvd.nist.gov/vuln/detail/CVE-2024-10858)