## CVE-2020-7247-OpenSMTPD-远程代码执行

**漏洞编号:** CVE-2020-7247

**漏洞类型:** 远程代码执行

**影响应用:** OpenSMTPD

**危害等级:** 高危，可导致以root权限执行任意命令

**影响版本:** < 6.6.2

**利用条件:** 目标服务器运行存在漏洞的OpenSMTPD版本，且允许SMTP连接

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2020-7247 存在于 OpenSMTPD 6.6 版本中，由于在 `smtp_session.c` 文件的 `smtp_mailaddr` 函数中，对输入验证失败时返回了错误的值，导致攻击者可以通过在 `MAIL FROM` 字段中注入 shell 元字符，从而以 root 权限执行任意命令。该漏洞影响使用默认配置（未注释）的 OpenSMTPD 服务器。

**漏洞利用方式：**

1.  **连接目标SMTP服务器：** 利用代码首先尝试连接到目标 OpenSMTPD 服务器的 25 端口 (或其他指定的端口)。
2.  **发送HELO命令：**  与服务器建立 SMTP 会话。
3.  **注入恶意payload：** 在`MAIL FROM`命令中使用shell元字符，执行命令。
4.  **设置接收者：** 使用`RCPT TO`命令设置邮件接收者。
5.  **发送DATA命令：** 发送`DATA`命令，并发送包含反弹shell命令的payload。
6.  **启动监听：**  攻击者使用 `nc` 命令监听指定端口，等待目标服务器反弹 shell 连接。

**有效性：**

根据漏洞信息和POC代码，该漏洞利用的有效性较高。POC代码已经公开，并且多个来源证实可以通过`MAIL FROM`注入执行任意命令。

**投毒风险：**

POC代码主要是利用 OpenSMTPD 漏洞实现反弹 shell。代码中存在设置监听端口和IP地址的操作，但这是反弹shell的必要步骤，不能直接判定为投毒。代码本身较为直接，没有发现明显的恶意或隐藏行为。投毒风险极小，但需要评估代码执行的payload，风险评估约为5%。


**项目地址:** [r0lh/CVE-2020-7247](https://github.com/r0lh/CVE-2020-7247)

**漏洞详情:** [CVE-2020-7247](https://nvd.nist.gov/vuln/detail/CVE-2020-7247)