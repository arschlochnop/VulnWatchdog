## CVE-2024-54772 MikroTik RouterOS 用户名枚举漏洞

**漏洞编号:** CVE-2024-54772

**漏洞类型:** 信息泄露/用户名枚举

**影响应用:** MikroTik RouterOS Winbox服务

**危害等级:** 中危

**影响版本:** v6.43 through v7.17.2 (stable), v6.43.13 through v6.49.13 (long-term)

**利用条件:** 目标设备开启Winbox服务(通常在8291端口)

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-54772 存在于 MikroTik RouterOS 的 Winbox 服务中。攻击者可以通过区分使用有效用户名和无效用户名进行连接尝试时响应大小的差异，枚举有效的用户名。此漏洞存在于 stable 版本的 v6.43 到 v7.17.2 以及 long-term 版本的 v6.43.13 到 v6.49.13。修复版本已在 v6.49.18 和 v7.18 中发布。

**有效性分析：**
根据漏洞库信息、搜索引擎结果和提供的漏洞利用代码（`mikrotik_routeros_username_enum.py` 和 `mikrotik_routeros_username_enum_wordlist.py`），可以确认POC代码有效。这些脚本利用了响应大小的差异来验证用户名是否存在。`mikrotik_routeros_username_enum.py` 脚本针对单个用户名进行验证，而 `mikrotik_routeros_username_enum_wordlist.py` 脚本使用用户名列表对目标进行批量验证。

**投毒风险分析：**
对提供的Python脚本进行了分析。`mikrotik_routeros_username_enum.py`和`mikrotik_routeros_username_enum_wordlist.py`的代码相对简单，主要是构造特定的数据包，发送到目标端口，并根据返回包长度来判断用户名是否有效。代码中没有发现明显的恶意行为，例如执行系统命令或上传/下载文件等。但是,`mikrotik_routeros_username_enum_wordlist.py` 通过`asyncio`并发发送请求，并且有随机休眠时间 `await asyncio.sleep(random.randint(1, 3))`, 增大了一些复杂度，潜在的风险在于: 1. 依赖的第三方库是否存在安全隐患. 2. 并发请求是否对目标系统造成拒绝服务攻击。 3. 随机休眠可能被利用来隐藏恶意行为。
综上，该代码的投毒风险较低，大约为5%。风险主要集中在对目标系统造成拒绝服务或者利用随机休眠进行其他隐藏操作的可能性上。

**利用方式：**
1.  **单用户名验证：** 使用 `mikrotik_routeros_username_enum.py <username> <target>` 验证单个用户名是否存在。  此脚本连接目标设备的 Winbox 服务 (8291 端口)，发送包含指定用户名的特制数据包。通过检查返回数据包的长度，判断用户名是否有效。
2.  **批量用户名枚举：** 使用 `mikrotik_routeros_username_enum_wordlist.py <wordlist_path> <target1,target2,...>` 批量枚举用户名。此脚本读取用户名列表，并针对每个目标设备，逐个尝试用户名。 同样通过检查返回数据包的长度，判断用户名是否有效。这个脚本使用异步IO并发扫描，可以提高扫描速度。

总的来说，该漏洞利用方式相对简单，但可以为攻击者提供有价值的信息，例如确定管理员账户的存在，为后续的攻击（如密码猜测或暴力破解）做准备。

**项目地址:** [deauther890/CVE-2024-54772](https://github.com/deauther890/CVE-2024-54772)

**漏洞详情:** [CVE-2024-54772](https://nvd.nist.gov/vuln/detail/CVE-2024-54772)