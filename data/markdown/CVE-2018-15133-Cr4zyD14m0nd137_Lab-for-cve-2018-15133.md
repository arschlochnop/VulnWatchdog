## CVE-2018-15133-Laravel-反序列化RCE

**漏洞编号:** CVE-2018-15133

**漏洞类型:** 反序列化远程代码执行

**影响应用:** Laravel Framework

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** <= 5.5.40 和 5.6.x <= 5.6.29

**利用条件:** 需要知道应用的APP_KEY

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2018-15133 存在于 Laravel Framework 直到 5.5.40 和 5.6.x 直到 5.6.29 版本中，是由于对 X-XSRF-TOKEN 值进行 unserialize 调用时，可能导致远程代码执行。漏洞存在于 Illuminate/Encryption/Encrypter.php 的 decrypt 方法和 phpggc 中的 gadgetchains/Laravel/RCE/3/chain.php 中。攻击者必须知道应用程序密钥（APP_KEY），通常这是不可能发生的，除非攻击者先前拥有特权访问权限或成功完成了之前的攻击。

**漏洞利用方式：**

1.  攻击者需要获取 Laravel 应用的 APP_KEY。这通常是最困难的一步。
2.  攻击者使用 phpggc (或类似工具) 生成一个恶意的 PHP 对象序列化字符串，该字符串利用了 Laravel 框架中的反序列化漏洞链（例如，PendingBroadcast 和相关的 gadget chain）。
3.  该序列化字符串被加密并编码，然后设置为 X-XSRF-TOKEN cookie 的值。
4.  当 Laravel 应用尝试解密和反序列化 X-XSRF-TOKEN cookie 时，恶意的对象链会被触发，导致远程代码执行。

**POC有效性：**

提供的 POC 代码利用了 CVE-2018-15133 漏洞。代码中包含了生成加密数据，设置 X-XSRF-TOKEN cookie，以及发送请求的代码。给定的命令可以通过反序列化执行。

**投毒风险：**

查看`exploit.go`后，发现代码的主要功能是生成恶意序列化数据，加密数据，以及发送HTTP请求。该`exploit.go`文件代码量较少,功能明确,没有发现明显的恶意代码。
README.md 文档描述了漏洞利用的步骤和所需的环境。其中提到需要下载并运行 Docker 镜像 `kozmico/laravel-poc-cve-2018-15133`。 虽然该 Docker 镜像本身不是本次评估的一部分，但是如果该镜像中包含恶意代码，则可能会导致投毒攻击。该镜像的安全性需要单独评估。此外，该README建议使用 kali linux 虚拟机进行攻击。说明攻击环境搭建比较复杂。总的来说，此仓库存在一定的投毒风险，但主要风险来源于引用的 Docker 镜像，而非提供的Go代码。根据评估，代码本身存在投毒的概率较低，大约在10%。

**项目地址:** [Cr4zyD14m0nd137/Lab-for-cve-2018-15133](https://github.com/Cr4zyD14m0nd137/Lab-for-cve-2018-15133)

**漏洞详情:** [CVE-2018-15133](https://nvd.nist.gov/vuln/detail/CVE-2018-15133)