## CVE-2024-25641-Cacti-RCE

**漏洞编号:** CVE-2024-25641

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Cacti

**危害等级:** 高危，允许攻击者执行任意PHP代码，完全控制受影响的系统。

**影响版本:** < 1.2.27

**利用条件:** 需要具有 'Import Templates' 权限的已认证用户。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2024-25641 存在于 Cacti 1.2.27 之前的版本中。这是一个通过“Package Import”功能利用的任意文件写入漏洞，允许具有“Import Templates”权限的认证用户在Web服务器上执行任意 PHP 代码。漏洞位于 `/lib/import.php` 脚本中的 `import_package()` 函数中。该函数盲目信任 XML 数据中提供的文件名和文件内容，并将这些文件写入 Cacti 基本路径（甚至外部，因为未过滤路径遍历序列）。这可用于在Web服务器上写入或覆盖任意文件，从而导致执行任意 PHP 代码或其他安全影响。

**漏洞利用方式：**

1.  攻击者首先需要拥有一个 Cacti 实例的有效账户，并且该账户具有“Import Templates”权限。
2.  攻击者构造一个恶意的 XML 文件，该文件包含要写入的文件的路径和内容。该 XML 文件旨在利用 `import_package()` 函数中的漏洞，通过路径遍历写入任意文件，或覆盖已经存在的文件。
3.  XML 文件中的文件内容包含恶意 PHP 代码，例如，Webshell 或用于执行系统命令的代码。
4.  攻击者通过 Cacti 的 Web 界面上传恶意 XML 文件，触发 `import_package()` 函数。
5.  `import_package()` 函数将恶意 PHP 代码写入指定位置。
6.  攻击者可以通过访问写入的 PHP 文件来执行恶意代码，从而获得对 Cacti 服务器的远程代码执行权限。

**POC 代码分析：**
提供的 `exploit.py` 脚本自动化了漏洞利用过程。该脚本执行以下步骤：

1.  使用提供的用户名和密码登录到 Cacti Web 界面。
2.  构造一个恶意的 XML 文件，其中包含用于执行反向 shell 的 PHP 代码。
3.  使用 `msfvenom` 生成反向shell的elf文件
4.  通过模拟上传包过程发送恶意 XML 文件到 Cacti 服务器。
5.  在本地启动一个 Netcat 监听器，等待反向 shell 连接。

**投毒风险评估：**

该代码的主要目的是利用 CVE-2024-25641 漏洞实现远程代码执行。检查该仓库并未发现明显的恶意行为或隐藏的后门。`exploit.py`脚本的主要功能是自动化漏洞利用过程，没有发现其他潜在的风险。投毒风险较低。

**结论：**

此漏洞利用代码有效，可用于在易受攻击的 Cacti 实例上实现远程代码执行。虽然存在一定的投毒风险，但通过代码审计和分析，该风险较低。建议用户谨慎使用该代码，并确保只在授权的环境中进行测试。

**项目地址:** [thisisveryfunny/CVE-2024-25641-RCE-Automated-Exploit-Cacti-1.2.26](https://github.com/thisisveryfunny/CVE-2024-25641-RCE-Automated-Exploit-Cacti-1.2.26)

**漏洞详情:** [CVE-2024-25641](https://nvd.nist.gov/vuln/detail/CVE-2024-25641)