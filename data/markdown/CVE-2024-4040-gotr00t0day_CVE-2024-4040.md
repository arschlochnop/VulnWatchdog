## CVE-2024-4040 - CrushFTP Server-Side Template Injection

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** CrushFTP

**危害等级:** 严重，未经身份验证的远程攻击者可以读取文件系统中的任意文件，绕过身份验证以获得管理访问权限，并在服务器上执行远程代码。

**影响版本:** 10.0 - 10.7.0, 11.0 - 11.0.9 (受影响版本低于 10.7.1 和 11.1.0)

**利用条件:** 需要目标 CrushFTP 服务器版本在受影响范围内，且可通过网络访问。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4040 是一个 CrushFTP 中的服务器端模板注入漏洞。未经身份验证的远程攻击者可以利用此漏洞读取 VFS 沙箱之外的文件系统中的文件，绕过身份验证以获得管理访问权限，并在服务器上执行远程代码。

**有效性：**
提供的 Python 脚本 CVE-2024-4040.py 旨在利用此漏洞。脚本允许指定目标服务器和要读取的文件。它通过向 `/WebInterface/login.html` 发送带有特制 `paths` 参数的 POST 请求来利用 SSTI。搜索引擎结果和漏洞库信息表明该漏洞已被积极利用，脚本的 `README.md` 文件也包含如何使用 `<INCLUDE>` 标签利用目标的说明。

**投毒风险：**
*   **代码分析：**脚本主要功能是发送 HTTP 请求并检查响应。虽然看起来比较直接，但以下几个方面值得关注：
    *   **请求的目标：** 脚本直接与目标服务器通信，如果目标服务器受到损害或被恶意控制，可能会导致意外行为。
    *   **依赖关系：** 脚本依赖于 `requests` 和 `colorama` 库。虽然 `requests` 是一个常用的库，但任何依赖项都可能引入安全风险。
*   **`README.md` 文件的说明：** 提供的 `README.md` 示例中给出了带有`ssh_host_rsa_key`文件，可能存在非法入侵的目的

*   **结论：** 鉴于代码的性质和依赖关系，以及提供的漏洞利用代码的功能。**投毒风险为10%**。此估算考虑了以下因素：代码主要目的是利用漏洞，风险源于潜在的依赖项问题和漏洞利用本身可能造成的破坏，而非代码作者有意植入的后门。

**利用方式：**
利用方式包括以下步骤：

1.  **目标识别：** 确定运行易受攻击的 CrushFTP 版本的服务器。
2.  **请求构造：** 构造一个包含恶意模板的 HTTP POST 请求。该模板可能使用 `<INCLUDE>` 标签或其他模板引擎指令来读取文件或执行代码。
3.  **发送请求：** 将构造的请求发送到 `/WebInterface/login.html` 端点。
4.  **结果分析：** 检查响应以确定漏洞是否被成功利用。如果成功，响应将包含请求的文件内容或命令执行的结果。
5.  **权限提升/代码执行：** 如果成功读取到敏感信息（例如配置文件或凭据），则可以使用这些信息来提升权限。利用 SSTI 执行任意代码将导致服务器受到完全控制。

Rapid7 分析中也提供了一个详细的关于漏洞利用方式的说明，可以参考。

**项目地址:** [gotr00t0day/CVE-2024-4040](https://github.com/gotr00t0day/CVE-2024-4040)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)