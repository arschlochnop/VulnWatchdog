## CVE-2020-0423-Android-Binder-UAF

**漏洞编号:** CVE-2020-0423

**漏洞类型:** Use-After-Free

**影响应用:** Android Kernel

**危害等级:** 高危，本地权限提升

**影响版本:** Android kernel

**利用条件:** 无需用户交互，本地执行环境

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2020-0423 漏洞存在于 Android Binder 机制的 `binder_release_work` 函数中，由于不正确的锁定，导致可能出现 Use-After-Free 漏洞。根据漏洞描述，攻击者无需任何额外权限即可在内核中实现本地提权。

**有效性分析：**
根据提供的漏洞利用代码和搜索结果，可以判断提供的POC代码**有效**。

*   搜索引擎结果中[webpage 2]和[webpage 7]明确指出该漏洞可以被利用来实现权限提升，并提供了利用分析的文章。
*   POC 代码尝试通过构造特定的 Binder 事务来触发 UAF。代码首先初始化 Binder 事务，其中包含多个指向共享内存区域中 `flat_binder_object` 结构的引用。然后，通过 `ioctl` 系统调用将构造的事务发送到 Binder 驱动程序。通过多线程竞争和 `BINDER_THREAD_EXIT`，尝试触发在释放 Binder 对象的过程中出现的竞争条件，进而导致 UAF。

**投毒风险分析：**

经过对 POC 代码的仔细检查，**未发现明显的投毒代码**。代码主要集中在 Binder 事务的构造和发送，以及多线程并发上，旨在触发 UAF 漏洞。代码中使用的常量和结构体定义与 Binder 机制相关，没有发现任何可疑的恶意行为。
因此，投毒风险评估为0%。

**利用方式：**

1.  **漏洞触发：** 利用的关键在于 `binder_release_work` 函数中的竞争条件。通过并发发送多个 Binder 事务，并配合 `BINDER_THREAD_EXIT` 来加速竞争，从而触发在对象释放后被再次访问的 UAF 情况。
2.  **利用过程：**
    *   **内存布局：**  首先，使用 `mmap` 创建一块共享内存区域，用于存储 Binder 事务数据和相关对象。
    *   **构造恶意Binder 事务：** 创建包含 BINDER_TYPE_BINDER 对象的 Binder 事务，该事务的 offsets 和 object buffer 指向共享内存。
    *   **多线程竞争：** 创建多个线程同时执行以下操作：
        *   复制 Binder 文件描述符 (`dup`)。
        *   使用 `BINDER_WRITE_READ` ioctl 发送构造的 Binder 事务。
        *   使用 `BINDER_THREAD_EXIT` ioctl 退出 Binder 线程，加速竞争。
        *   关闭复制的文件描述符 (`close`)。
    *   **UAF 触发：**  当一个线程释放了某个 Binder 对象后，另一个线程可能仍然持有指向该对象的指针，并尝试访问它，从而触发 UAF。
3.  **权限提升：** 成功触发 UAF 后，可以通过控制被释放的内存区域的内容，例如通过内存喷射，来劫持程序执行流程，最终实现内核代码执行和权限提升。虽然POC代码主要展示了如何触发漏洞，但是通过进一步的内存布局控制，可以实现最终的权限提升。


**项目地址:** [sparrow-labz/CVE-2020-0423](https://github.com/sparrow-labz/CVE-2020-0423)

**漏洞详情:** [CVE-2020-0423](https://nvd.nist.gov/vuln/detail/CVE-2020-0423)