## CVE-2024-50379-ApacheTomcat-TOCTOU Race Condition RCE

**漏洞编号:** CVE-2024-50379

**漏洞类型:** TOCTOU Race Condition

**影响应用:** Apache Tomcat

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** <= 11.0.1, <= 10.1.33, <= 9.0.97

**利用条件:** 默认Servlet启用写入（非默认配置），文件系统大小写不敏感

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2024-50379 是 Apache Tomcat 中的一个 Time-of-check Time-of-use (TOCTOU) 竞争条件漏洞。当默认 Servlet 启用写入且文件系统不区分大小写时，在 JSP 编译期间可能导致远程代码执行。

**漏洞利用方式：**
1.  攻击者利用PUT方法上传一个JSP文件到一个可写目录。
2.  由于TOCTOU漏洞，在Tomcat检查文件类型和实际编译文件之间存在时间差，攻击者可以利用竞争条件，上传恶意JSP文件绕过检查。
3.  上传的JSP文件会被当做可执行文件执行，从而导致远程代码执行。

**POC有效性：**
提供的`poc.py`脚本通过多线程并发上传包含恶意代码的JSP文件，利用竞争条件触发漏洞。该脚本首先检查目标是否允许PUT请求，然后通过PUT上传一个payload，该payload用于将webshell写入指定路径，最后GET请求访问该webshell，如果返回200则验证成功

**投毒风险评估：**
该仓库中是否存在投毒代码的可能性较低。`poc.py`的主要功能是利用漏洞上传和执行webshell。虽然webshell本身具有潜在的风险，但它属于漏洞利用的范畴，并不构成“投毒”。脚本的功能相对明确，没有发现隐藏的恶意行为。考虑到脚本的开源性质以及其目标是漏洞利用，作者隐藏恶意代码的可能性较低，但不能完全排除，因此评估的投毒风险为1%。

**项目地址:** [dkstar11q/CVE-2024-50379-nuclei](https://github.com/dkstar11q/CVE-2024-50379-nuclei)

**漏洞详情:** [CVE-2024-50379](https://nvd.nist.gov/vuln/detail/CVE-2024-50379)