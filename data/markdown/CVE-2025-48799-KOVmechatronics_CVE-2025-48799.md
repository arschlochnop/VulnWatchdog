## CVE-2025-48799 Windows Update Service Elevation of Privilege Vulnerability

**漏洞编号:** CVE-2025-48799

**漏洞类型:** 特权提升

**影响应用:** Windows Update Service

**危害等级:** 高危，允许本地攻击者提升权限

**影响版本:** 受影响的Windows 10, Windows 11和Windows Server 2025版本（参见漏洞库信息）

**利用条件:** 需要至少两个硬盘驱动器，并且将应用程序安装位置重定向到第二个驱动器

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2025-48799 是 Windows Update Service 中的一个特权提升漏洞。攻击者可以利用此漏洞，通过不正确的文件访问前的链接解析（即“链接跟随”），提升本地权限。漏洞的根本原因是`wuauserv`服务在处理多个硬盘驱动器时，未正确验证路径。当用户使用存储感知功能将新内容的保存位置重定向到辅助驱动器时，`wuauserv`服务可能会在未充分检查符号链接的情况下执行任意文件夹删除。如果遇到文件，服务会使用 `GetFinalPathByHandle` 函数检查最终路径，但这种检查不足以防止攻击者利用符号链接操纵文件系统，导致任意文件删除和特权提升。

**有效性：**

根据漏洞库信息、搜索结果以及PoC代码，该漏洞利用的有效性较高。Github上存在PoC代码，并且多个安全厂商（如Wiz, Qualys, Tenable等）都对该漏洞进行了分析和报告，确认了其存在性和危害。

**利用方式：**

1.  **前提条件：** 系统需要至少两个硬盘驱动器，并且需要将应用程序的默认安装位置更改到第二个驱动器。
2.  **创建符号链接：** 利用者创建一个指向敏感系统文件或目录的符号链接。
3.  **触发更新服务：** 当Windows Update Service尝试清理或更新相关目录时，会跟随符号链接。
4.  **任意文件删除：** 由于缺乏充分的验证，更新服务可能会删除符号链接指向的敏感文件或目录，从而导致权限提升。
5.  **权限提升：** 通过删除特定的系统文件，攻击者可以破坏系统的完整性，并最终获得更高的权限。

**投毒风险：**

评估该PoC是否存在投毒风险，需要仔细分析提供的代码和仓库。虽然PoC本身是为了验证漏洞的存在，但攻击者可能会在其中加入恶意代码。

*   **FileOpLock.cpp：** 从提供的 `FileOpLock.cpp` 来看，它主要是关于文件操作锁，用于控制对文件的并发访问。这段代码本身并没有明显的恶意行为，主要功能是请求和管理文件操作锁，但是，如果利用不当，文件操作锁可以被用于阻止正常的文件访问，造成拒绝服务攻击，或者配合其他漏洞进行更复杂的攻击。`_cb(cb)`的回调函数存在被植入恶意代码的风险,但考虑到文件操作锁本身的特性，以及代码片段的完整性，推测恶意利用的可能性较低。
*   **README.md：** README文件中的代码片段 `trigger_vulnerability()` 只是一个简单的示例，用于演示如何触发漏洞，没有包含任何恶意代码。

总体而言，直接的恶意代码（例如执行任意命令）的概率较低。但是，PoC中可能存在一些细微的缺陷或依赖，在特定环境下可能导致不可预测的行为。此外，发布者也可能在PoC中加入隐蔽的后门或信息收集代码，所以下载和使用PoC时需要格外小心。

综合分析，投毒风险估计为10%。主要是考虑作者可能在release的二进制文件中加入恶意代码，以及利用不当可能造成的拒绝服务攻击。


**项目地址:** [KOVmechatronics/CVE-2025-48799](https://github.com/KOVmechatronics/CVE-2025-48799)

**漏洞详情:** [CVE-2025-48799](https://nvd.nist.gov/vuln/detail/CVE-2025-48799)