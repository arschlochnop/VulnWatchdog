## CVE-2021-22986-F5 BIG-IP/BIG-IQ-iControl REST RCE

**漏洞编号:** CVE-2021-22986

**漏洞类型:** 远程代码执行

**影响应用:** F5 BIG-IP/BIG-IQ

**危害等级:** 高危，允许未经身份验证的远程代码执行

**影响版本:** BIG-IP 16.0.x before 16.0.1.1, 15.1.x before 15.1.2.1, 14.1.x before 14.1.4, 13.1.x before 13.1.3.6, 12.1.x before 12.1.5.3; BIG-IQ 7.1.0.x before 7.1.0.3, 7.0.0.x before 7.0.0.2

**利用条件:** 目标系统存在漏洞版本，且可以访问iControl REST接口

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-22986是F5 BIG-IP和BIG-IQ中iControl REST接口的一个未经身份验证的远程命令执行漏洞。根据漏洞库信息和搜索引擎结果，该漏洞影响多个版本的BIG-IP和BIG-IQ。该漏洞允许未经身份验证的攻击者通过向iControl REST API发送特制的请求来执行任意命令。

**有效性：**

提供的POC代码看起来是有效的。它通过构造一个包含要执行的命令的JSON payload，并将其POST到`/mgmt/tm/util/bash`端点来利用此漏洞。代码首先尝试读取一个url列表，遍历这些url，并且发送post请求，验证是否成功执行。由于`CVE-2021-22986` 是一个被广泛研究的漏洞，有很多公开可用的利用代码，此POC代码是符合漏洞描述的。

**投毒风险：**

POC代码的投毒风险较低，约为10%。 代码本身的功能看起来是正常的漏洞利用，但是存在以下潜在的风险点：

1.  代码中存在一个`proxies`变量,如果使用者不注意修改，可能会将流量转发到攻击者控制的代理服务器。
2.  使用了`requests.packages.urllib3.disable_warnings()`，虽然这通常用于避免SSL证书验证问题，但可能会隐藏其他潜在的安全问题。
3.  代码尝试读取`url.txt`文件，并执行POST请求，如果`url.txt`文件被篡改，可能会导致意外的漏洞利用。
4. 代码中包含一个硬编码的 Basic 认证头 `Authorization: Basic YWRtaW46YWRtaW4=`, 虽然在漏洞利用中不太可能被直接使用，但如果使用者不清楚其含义，可能会在其他场景中错误使用。

这些潜在的风险点使得代码存在一定的投毒风险，但总体而言，代码的主要目的是利用漏洞，而非进行恶意行为。

**利用方式：**

利用方式如下：

1.  攻击者需要找到存在漏洞的F5 BIG-IP或BIG-IQ实例。
2.  攻击者构造一个包含恶意命令的JSON payload，例如`{'command': 'run', 'utilCmdArgs': '-c id'}`，其中`id`命令可以替换为任意系统命令。
3.  攻击者使用POST请求将该payload发送到目标的`/mgmt/tm/util/bash`端点，无需身份验证。
4.  服务器执行该命令，并将结果返回给攻击者。

此外，搜索引擎结果中提到，该漏洞已被Mirai僵尸网络利用，攻击者可以使用此漏洞来感染目标系统，并将其纳入僵尸网络。

**排序优先级：**

搜索引擎结果显示该漏洞已经被广泛利用，并且存在公开的POC，因此优先级最高。漏洞利用代码验证了漏洞的可利用性，并且有助于理解利用方式。漏洞库信息提供了漏洞的官方描述和受影响的版本范围，是重要的参考信息。

**项目地址:** [DDestinys/CVE-2021-22986](https://github.com/DDestinys/CVE-2021-22986)

**漏洞详情:** [CVE-2021-22986](https://nvd.nist.gov/vuln/detail/CVE-2021-22986)