## CVE-2023-38646-Metabase-RCE

**漏洞编号:** CVE-2023-38646

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Metabase

**危害等级:** 高危，未经身份验证的远程代码执行

**影响版本:** Metabase open source < 0.46.6.1, Metabase Enterprise < 1.46.6.1

**利用条件:** 目标Metabase实例未打补丁，且攻击者可以访问Metabase服务。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-38646 允许未经身份验证的攻击者在 Metabase 服务器上执行任意命令，权限级别与服务器相同。根据漏洞库信息和搜索引擎结果，该漏洞影响 Metabase 开源版本低于 0.46.6.1 和 Metabase 企业版本低于 1.46.6.1 的实例。漏洞利用方式分析如下：

**漏洞利用方式：**

1.  **未授权访问：** 该漏洞无需身份验证即可利用。
2.  **RCE：**  攻击者可以发送特制的请求，执行服务器上的任意命令。
3.  **具体利用：** 根据提供的漏洞利用代码，攻击流程主要包括以下步骤：
    *   **验证模块：**  向`/api/session/properties`端点发送请求，获取未授权的token，确认漏洞是否存在。
    *   **命令执行模块：** 利用上一步获取的token，执行任意命令。需要指定metabase.jar的位置。
    *   **内存马注入模块：** 通过修改`x-client-data`请求头注入内存马，支持 cmd 和 godzilla 两种模式。cmd模式直接执行命令，godzilla模式则直接连接哥斯拉webshell。

**投毒风险分析：**

提供的代码是一个 Metabase RCE 图形化利用工具，包含了验证模块、命令执行模块和内存马注入模块。主要的潜在投毒风险存在于以下几个方面：

1.  **内存马注入：** 内存马注入模块本身具有较高的风险，可能被用于植入恶意代码，长期控制服务器。代码中`x-client-data:godzilla`的方式连接哥斯拉webshell，默认密码为pass，可能会被其他人利用。
2.  **命令执行模块：** 虽然命令执行模块的目的是利用漏洞，但恶意攻击者可能会修改该模块，添加额外的恶意行为，例如下载并执行恶意脚本。

考虑到以上风险，该POC工具存在一定的投毒风险，尤其是内存马模块。需要在使用前进行代码审计，确保没有恶意代码。

**风险评估：**

尽管该工具简化了漏洞利用过程，但使用它也可能引入风险。用户应谨慎使用此工具，并充分了解其潜在的危害。建议在非生产环境中使用，并进行充分的安全测试。

**风险概率：**

考虑到内存马注入的风险，且该POC工具由个人开发者提供，并非来自官方或信誉良好的安全厂商，因此综合评估投毒风险为10%。这个10%主要来自于对使用者缺乏安全意识以及对工具的未知性可能带来的风险，而非代码本身一定存在恶意后门。

**项目地址:** [Boogipop/MetabaseRceTools](https://github.com/Boogipop/MetabaseRceTools)

**漏洞详情:** [CVE-2023-38646](https://nvd.nist.gov/vuln/detail/CVE-2023-38646)