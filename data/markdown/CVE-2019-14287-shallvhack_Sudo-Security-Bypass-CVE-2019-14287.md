## CVE-2019-14287-Sudo安全绕过

**漏洞编号:** CVE-2019-14287

**漏洞类型:** 权限提升/安全策略绕过

**影响应用:** Sudo

**危害等级:** 高危，允许低权限用户以root身份执行命令

**影响版本:** < 1.8.28

**利用条件:** 攻击者需要拥有Runas ALL sudoer账户的访问权限

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2019-14287 允许拥有 Runas ALL 权限的用户通过指定特殊的用户ID来绕过某些安全策略和PAM模块。具体来说，通过使用 `sudo -u \#$((0xffffffff))` 或者 `sudo -u -1` 命令，Sudo 可能不会正确地进行用户身份验证和权限检查，导致用户可以以 root 身份执行命令，即使 sudo 配置文件中明确禁止了 root 访问。

**有效性：** 根据漏洞库信息和搜索结果，该漏洞确实存在于 Sudo 1.8.28 之前的版本，并已被广泛报道和修复。提供的 POC 代码 `SudoSecurityBypass.sh` 旨在检测目标系统是否存在此漏洞，通过尝试利用该漏洞执行命令来验证。

**投毒风险：** 查看提供的脚本 `SudoSecurityBypass.sh` 代码，主要作用是检测是否存在漏洞，利用的命令是 `sudo -u \#$((0xffffffff))`。脚本首先检查当前用户是否具有 ALL sudo 权限，如果具有，则建议使用权限较低的用户进行测试。脚本本身相对简单，主要用于漏洞检测，但仍存在极小的投毒风险 (5%) ，风险点在于：

*   **依赖外部资源：** 如果脚本修改为从外部源下载或执行代码，则可能引入恶意代码。
*   **恶意命令执行：** 脚本可能会包含在漏洞利用成功后执行恶意命令的代码，例如添加后门用户等。虽然当前提供的脚本不包含此类代码，但修改是相对容易的。
*   **条件竞争或资源耗尽：** 理论上，可以通过精心构造的命令来利用条件竞争或资源耗尽漏洞，但这需要更复杂的脚本。

**利用方式：**

1.  **前提条件：** 攻击者必须具有可以通过 sudo 执行命令的权限，并且在 sudoers 文件中具有 `Runas ALL` 权限。
2.  **绕过限制：** 使用 `sudo -u \#$((0xffffffff))` 或者 `sudo -u -1` 命令来指定一个无效的用户ID。
3.  **执行命令：** 在上述命令后，添加需要执行的命令。由于漏洞，Sudo 可能会错误地执行该命令，并赋予 root 权限。
4.  **结果：** 命令以 root 权限执行，允许攻击者执行任意操作，例如修改系统文件、安装恶意软件等。

**项目地址:** [shallvhack/Sudo-Security-Bypass-CVE-2019-14287](https://github.com/shallvhack/Sudo-Security-Bypass-CVE-2019-14287)

**漏洞详情:** [CVE-2019-14287](https://nvd.nist.gov/vuln/detail/CVE-2019-14287)