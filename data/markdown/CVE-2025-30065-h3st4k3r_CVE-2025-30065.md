## CVE-2025-30065-Apache Parquet-RCE

**漏洞编号:** CVE-2025-30065

**漏洞类型:** 远程代码执行

**影响应用:** Apache Parquet Java (parquet-avro module)

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** <= 1.15.0

**利用条件:** 应用程序使用 Apache Parquet Java 的 parquet-avro 模块处理不可信来源的 Parquet 文件，且环境中存在可利用的 Gadget Class

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2025-30065 漏洞存在于 Apache Parquet Java 库的 parquet-avro 模块中，允许恶意攻击者通过构造恶意的 Parquet 文件，在受害者系统上执行任意代码。

**利用方式：**

1.  攻击者构造一个包含恶意 Avro schema 的 Parquet 文件。该 schema 的 `default` 字段包含一个指向恶意类的序列化字符串，例如 `!com.securitytest.RCEPayload`。
2.  当受害者应用程序使用 Apache Parquet Java 库（版本 1.15.0 及更早版本）解析该 Parquet 文件时，parquet-avro 模块会尝试反序列化 Avro schema。
3.  由于 `default` 字段的值被当做类名进行实例化，如果受害者环境中存在该类（或攻击者精心构造的 Gadget Class），则会导致任意代码执行。
4.  漏洞利用代码 `POC-CVE-2025-30065-ParquetExploitGenerator.java` 用于生成包含恶意 Avro schema 的 Parquet 文件。

**有效性：**

根据漏洞库信息和搜索结果，该漏洞是一个严重级别的 RCE 漏洞，CVSS 评分为 10.0。提供的 POC 代码旨在生成具有恶意 Avro schema 的 Parquet 文件，从而验证该漏洞。从代码实现逻辑来看，POC代码的有效性较高，能够生成触发漏洞的Parquet文件，成功利用的前提是目标classpath存在利用链。

**投毒风险分析：**

查看提供的 POC 代码，发现该代码主要功能是生成包含恶意 Avro schema 的 Parquet 文件。代码中包含一个警告头，表明这是一个 PoC，用于安全研究目的。`appendWarningHeader` 函数会将此头部信息写入 Parquet 文件开头，以提醒用户。

但是，仍需要注意以下几点：

*   **依赖项：** POC 代码依赖于 `org.apache.avro`、`org.apache.parquet` 和 `org.apache.hadoop` 等库。如果这些库本身存在安全问题，或者攻击者篡改了这些依赖项，可能会引入投毒风险。
*   **恶意类：** POC 代码中的 `com.securitytest.RCEPayload` 类是攻击者预先准备好的恶意类，用于执行任意代码。如果攻击者修改了该类的行为，可能会导致意想不到的后果。
*   **appendWarningHeader 函数：**虽然`appendWarningHeader`函数本身没有明显的投毒行为，但是该操作修改了Parquet文件的内容，一定程度上破坏了文件的完整性，如果Parquet文件有完整性校验，那么会校验失败。

综合来看，该POC代码本身存在潜在投毒风险的可能性较低，但是需要使用者注意依赖项安全以及payload的安全性。投毒风险预估为10%，主要来自于依赖和payload可控性。

**项目地址:** [h3st4k3r/CVE-2025-30065](https://github.com/h3st4k3r/CVE-2025-30065)

**漏洞详情:** [CVE-2025-30065](https://nvd.nist.gov/vuln/detail/CVE-2025-30065)