## CVE-2024-44258-iOS备份恢复Symlink漏洞

**漏洞编号:** CVE-2024-44258

**漏洞类型:** Symlink漏洞

**影响应用:** iOS, iPadOS, visionOS, tvOS

**危害等级:** 高危，可能导致修改受保护的系统文件

**影响版本:** iOS & iPadOS < 17.7, iOS & iPadOS < 18.1, visionOS < 2.1, tvOS < 18.1

**利用条件:** 需要用户主动恢复恶意备份文件

**POC 可用性:** 是，概念验证PoC

**投毒风险:** 10%

## 详情

CVE-2024-44258 漏洞是由于 iOS 在恢复备份时，没有正确处理符号链接导致的。攻击者可以创建一个恶意备份文件，其中包含指向系统关键文件的符号链接，当用户恢复这个恶意备份时，恶意备份中的符号链接会被创建到目标系统上，从而允许攻击者修改受保护的系统文件，例如通过符号链接将恶意文件写入到系统目录。 

**有效性分析：**

提供的PoC代码是一个概念验证（Proof of Concept），它旨在演示漏洞的原理，而不是一个完整的可直接使用的漏洞利用程序。它模拟了备份的结构，并生成了一个包含符号链接的文件，但并没有实现修改`Manifest.mbdb`这个关键步骤，因此不能直接利用。

**投毒风险分析：**

PoC代码本身声明仅用于教育和研究目的，并明确指出了局限性，但依然存在潜在风险。

*   **风险点：** `poc_cve_2024_44258.py`脚本中`SYMLINK_TARGET_ON_DEVICE`变量，如果配置不当，可能导致PoC运行失败甚至影响系统稳定性。虽然示例中给出了沙盒路径，但用户仍可能配置到其他路径。
*   **缓解措施：** 代码中没有发现明显的恶意代码，但是用户需要谨慎配置`SYMLINK_TARGET_ON_DEVICE`变量，避免指向重要的系统文件。
*   **结论：** 总体投毒风险较低，为10%。

**利用方式分析：**

1.  **恶意备份制作：** 攻击者需要创建一个恶意的备份文件。这个备份文件包含精心构造的符号链接，这些链接指向系统中的敏感文件或目录。
2.  **诱导用户恢复：** 攻击者诱骗用户在其设备上恢复这个恶意备份。这可能通过社会工程学或其他欺骗手段实现。
3.  **利用符号链接：** 当用户恢复备份时，系统会尝试创建备份中包含的符号链接。由于漏洞存在，系统没有充分验证这些符号链接的安全性。
4.  **文件覆盖或修改：** 通过精心构造的符号链接，攻击者可以将恶意文件写入到系统目录中，或者修改现有的系统文件，从而实现提权或执行恶意代码。

**项目地址:** [missaels235/POC-CVE-2024-44258-Py](https://github.com/missaels235/POC-CVE-2024-44258-Py)

**漏洞详情:** [CVE-2024-44258](https://nvd.nist.gov/vuln/detail/CVE-2024-44258)