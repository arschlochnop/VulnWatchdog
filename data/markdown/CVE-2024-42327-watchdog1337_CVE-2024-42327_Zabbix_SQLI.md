## CVE-2024-42327-Zabbix-SQL注入

**漏洞编号:** CVE-2024-42327

**漏洞类型:** SQL注入

**影响应用:** Zabbix

**危害等级:** 高危，可能导致权限提升和远程代码执行

**影响版本:** 6.0.0 <= version <= 6.0.31
6.4.0 <= version <= 6.4.16
7.0.0 <= version <= 7.0.1

**利用条件:** 需要Zabbix前端访问权限，并且用户具有API访问权限

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2024-42327是Zabbix前端的一个SQL注入漏洞，存在于`CUser`类的`addRelatedObjects`函数中。该函数被`CUser.get`调用，而`CUser.get`可被任何具有API访问权限的用户访问。漏洞利用方式如下：

1.  **漏洞利用前提：**
    *   拥有Zabbix前端的非管理员用户账户。
    *   该账户具有API访问权限（默认User角色即可）。
2.  **漏洞利用步骤：**
    *   攻击者使用有效的Zabbix用户名和密码通过Zabbix API进行身份验证。
    *   成功身份验证后，获得一个身份验证令牌（auth_token）。
    *   攻击者构造恶意的SQL注入payload，利用`user.get` API方法的`selectRole`参数，将SQL注入语句插入到查询中。
    *   通过Zabbix API发送包含恶意payload的请求。PoC代码提供的exp可用于获取用户credentials, session等信息。

3.  **有效性：**
    根据漏洞库信息、搜索引擎结果和提供的漏洞利用代码，该POC代码是有效的。搜索引擎结果中已经有github仓库公开了POC。

4. **投毒风险：**
 代码本身是比较直白的SQL注入利用，没有发现明显的恶意代码。但是，requests.get 使用了 `verify=False` 禁用了 SSL 证书验证，存在中间人攻击的风险，可能被注入恶意代码或者窃取凭据.风险评估为1%.

5.  **利用方式总结：**
    攻击者通过API接口，利用SQL注入漏洞，可以读取数据库中的敏感信息，例如用户凭据、session信息等。如果Zabbix数据库权限配置不当，可能导致权限提升，甚至远程代码执行，获取服务器控制权。

**项目地址:** [watchdog1337/CVE-2024-42327_Zabbix_SQLI](https://github.com/watchdog1337/CVE-2024-42327_Zabbix_SQLI)

**漏洞详情:** [CVE-2024-42327](https://nvd.nist.gov/vuln/detail/CVE-2024-42327)