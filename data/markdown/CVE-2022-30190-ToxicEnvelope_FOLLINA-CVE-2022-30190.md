## CVE-2022-30190-Microsoft Windows Support Diagnostic Tool (MSDT) 远程代码执行漏洞

**漏洞编号:** CVE-2022-30190

**漏洞类型:** 远程代码执行

**影响应用:** Microsoft Windows Support Diagnostic Tool (MSDT)

**危害等级:** 高危，允许攻击者在目标系统上执行任意代码。

**影响版本:** 受影响的Windows版本和版本范围请参考漏洞库信息。

**利用条件:** 需要用户打开恶意构造的文档，例如Word文档。攻击者需要诱骗用户执行恶意操作。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-30190，也被称为Follina，是一个影响Microsoft Windows Support Diagnostic Tool (MSDT)的远程代码执行漏洞。攻击者可以利用此漏洞，通过诱使用户打开包含恶意URL的文档（例如，利用Word远程模板功能）来执行任意代码。

**有效性：**

根据漏洞库信息、搜索引擎结果以及提供的POC代码，该漏洞的POC代码是有效的。 搜索引擎结果中的多个链接（如hackthebox.com的解释、fortinet的分析以及qualys的博客等）证实了该漏洞的存在和可利用性。POC代码（`exploit.py`）提供了一种生成恶意Word文档，并通过HTTP服务器提供恶意HTML有效载荷的方法，从而利用MSDT执行任意命令。

**投毒风险：**

虽然POC代码的主要功能是生成漏洞利用程序，但存在一定的投毒风险。风险分析如下：

*   **依赖性：**  `exploit.py`脚本依赖于外部资源（HTTP服务器），如果攻击者控制了该服务器，则可以修改返回的HTML内容，从而在目标系统上执行恶意代码。 
*   **自定义命令执行：**  该脚本允许用户自定义要在目标系统上执行的命令 (`--command`参数)。攻击者可以通过精心构造的命令来执行恶意操作，例如下载和执行额外的恶意软件。
*  **Reverse Shell：** `--reverse` 参数会下载 netcat 到目标机器，虽然功能上为了利用，但也可能被滥用。
*   **代码可读性：**  虽然代码本身看起来没有明显的恶意后门，但是代码相对复杂，可能隐藏着一些不易察觉的恶意逻辑。

综合来看，虽然没有明显的投毒代码，但该工具的灵活性和对外部资源的依赖性使其存在一定的投毒风险，估计为10%。

**利用方式：**

1.  **攻击者准备恶意Word文档：**  攻击者使用`exploit.py`脚本生成一个包含恶意URL的Word文档。该URL指向攻击者控制的HTTP服务器。
2.  **攻击者搭建HTTP服务器：**  攻击者在自己的服务器上搭建一个HTTP服务器，用于托管恶意HTML有效载荷。
3.  **诱骗用户打开恶意文档：**  攻击者通过电子邮件、社交媒体或其他方式诱骗用户打开恶意Word文档。
4.  **MSDT被调用并执行恶意代码：**  当用户打开文档时，Word会尝试通过URL协议调用MSDT。MSDT会从攻击者的服务器下载恶意HTML，并执行其中的代码，从而实现远程代码执行。
5.  **攻击者控制目标系统：**  成功利用漏洞后，攻击者可以获得目标系统的控制权，并执行任意操作，例如安装恶意软件、窃取数据或创建新账户。

**项目地址:** [ToxicEnvelope/FOLLINA-CVE-2022-30190](https://github.com/ToxicEnvelope/FOLLINA-CVE-2022-30190)

**漏洞详情:** [CVE-2022-30190](https://nvd.nist.gov/vuln/detail/CVE-2022-30190)