## CVE-2018-11776-Apache Struts2-远程代码执行

**漏洞编号:** CVE-2018-11776

**漏洞类型:** 远程代码执行

**影响应用:** Apache Struts2

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** 2.3 to 2.3.34, 2.5 to 2.5.16

**利用条件:** alwaysSelectFullNamespace为true，且存在特定namespace配置

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2018-11776是Apache Struts2框架中的一个远程代码执行漏洞。当`alwaysSelectFullNamespace`设置为true，并且使用了不带namespace的结果，同时其上层包没有或使用了通配符namespace，或使用了没有value和action属性的url标签，且其上层包没有或使用了通配符namespace时，攻击者可以通过构造恶意的OGNL表达式，并将其作为URL的一部分发送给服务器，即可在服务器上执行任意代码。

**有效性：**
提供的POC代码`exploit.py`基于Rapid7的metasploit-framework，利用了OGNL表达式注入漏洞。该POC通过修改OgnlUtil的excludedPackageNames和excludedClasses来绕过沙箱限制，从而执行任意命令。Dockerfile配置了易受攻击的Struts2环境，因此POC代码有效。

**投毒风险：**
经过对Dockerfile，README.md和`exploit.py`文件的分析，没有发现任何恶意代码或后门。`exploit.py`只是利用漏洞执行命令，没有植入持久后门或其他恶意行为。Dockerfile构建的镜像只是一个易受攻击的环境，没有额外的恶意修改。README.md仅包含如何构建和运行POC的说明。因此，投毒风险评估为0%。

**利用方式：**
1.  目标系统需要运行受影响版本的Apache Struts2，即2.3到2.3.34以及2.5到2.5.16。
2.  `alwaysSelectFullNamespace`参数必须设置为true。
3.  存在特定的namespace配置漏洞触发点 (如描述中所述)。
4.  攻击者构造包含恶意OGNL表达式的URL，该表达式利用了Struts2的OGNL注入漏洞。
5.  当目标系统处理包含恶意OGNL表达式的URL时，该表达式会被执行，从而允许攻击者在服务器上执行任意代码。

**项目地址:** [freshdemo/ApacheStruts-CVE-2018-11776](https://github.com/freshdemo/ApacheStruts-CVE-2018-11776)

**漏洞详情:** [CVE-2018-11776](https://nvd.nist.gov/vuln/detail/CVE-2018-11776)