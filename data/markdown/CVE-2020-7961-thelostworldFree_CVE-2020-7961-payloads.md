## CVE-2020-7961-Liferay Portal 反序列化RCE

**漏洞编号:** CVE-2020-7961

**漏洞类型:** 反序列化远程代码执行

**影响应用:** Liferay Portal

**危害等级:** 高危，可能导致远程代码执行，服务器完全控制

**影响版本:** < 7.2.1 CE GA2

**利用条件:** 需要网络访问Liferay Portal的JSONWS接口

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-7961是Liferay Portal 7.2.1 CE GA2之前版本中存在的一个反序列化漏洞，攻击者可以通过JSON Web Services (JSONWS)接口，发送恶意的序列化数据，导致服务器端执行任意代码。

**有效性：**

根据漏洞信息、搜索结果和漏洞利用代码，该漏洞的POC代码是有效的。多个来源（Rapid7、Synacktiv、NVD、Wiz.io、Medium）都确认了该漏洞的存在和利用方法。

**投毒风险：**

查看提供的漏洞利用代码，尤其是`LifExp.java`和`Liferay_Windows_payload.txt`、`Liferay_linux_payload.txt`，发现其目的是执行系统命令并回传结果。例如，Windows payload使用`certutil.exe`将`whoami`命令的结果发送到Burp Collaborator，Linux payload使用`curl`发送`pwd`命令的结果。

`LifExp.java`文件本身为空，需要用户自己添加恶意代码，这增加了用户引入恶意代码的风险。`poc.py`本身只是负责发送payload。仓库其他文件中，README.md只是提供使用说明，并没有可疑代码。

投毒风险评估：
*   代码编写者可能在`LifExp.java`中提供默认的payload，该payload看似无害，但可能在特定环境下触发恶意行为。但目前提供的`LifExp.java`是空的，不存在这个风险
*   Payload文件的目的是执行命令并将结果发送到指定的服务器。如果作者控制了Burp Collaborator，可以收集受害者的信息。

因此，仓库中存在一定的投毒风险，主要是通过`LifExp.java`或Payload文件本身，但风险较低，判断为10%。

**利用方式：**

1.  **确定目标Liferay Portal的版本小于7.2.1 CE GA2。**
2.  **构造恶意的Java序列化对象。**  这通常涉及到使用Java反序列化漏洞利用工具，例如ysoserial，生成一个包含恶意命令的序列化对象。利用代码中的`LifExp.java`是一个示例，需要用户自行填充恶意payload。
3.  **修改Payload文件，将反弹shell的地址修改为自己的服务器地址**，以便接受反弹的shell。
4.  **将编译好的恶意class文件作为http服务器的文件。**
5.  **通过JSONWS接口发送包含恶意序列化对象的请求。**  请求的URL通常是`/api/jsonws/invoke`。`poc.py`脚本用于自动化这个过程，它会发现目标服务器上的JSONWS接口，并构造包含恶意payload的POST请求。
6.  **服务器端反序列化该对象，导致恶意代码执行。**  成功利用后，攻击者就可以在服务器上执行任意命令，例如添加用户、安装后门等。

总而言之，攻击者需要首先编译恶意类，设置payload，然后通过`poc.py`脚本向目标服务器发送请求。

**项目地址:** [thelostworldFree/CVE-2020-7961-payloads](https://github.com/thelostworldFree/CVE-2020-7961-payloads)

**漏洞详情:** [CVE-2020-7961](https://nvd.nist.gov/vuln/detail/CVE-2020-7961)