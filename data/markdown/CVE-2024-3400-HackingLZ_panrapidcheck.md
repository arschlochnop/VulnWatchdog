## CVE-2024-3400 PAN-OS GlobalProtect 命令注入

**漏洞编号:** CVE-2024-3400

**漏洞类型:** 命令注入

**影响应用:** PAN-OS GlobalProtect

**危害等级:** 高危，未授权攻击者可以root权限执行任意代码

**影响版本:** PAN-OS 10.2 (低于 10.2.9-h1), 11.0 (低于 11.0.4-h1), 和 11.1 (低于 11.1.2-h3)

**利用条件:** 目标系统配置了 GlobalProtect 网关或 Portal

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-3400 是 Palo Alto Networks PAN-OS 软件 GlobalProtect 功能中的一个命令注入漏洞。由于任意文件创建漏洞的存在，未经身份验证的攻击者可以在具有 root 权限的防火墙上执行任意代码。 

**有效性分析：**

根据漏洞库信息和搜索结果，此漏洞已被积极利用，并且存在公开的PoC。漏洞库信息中提到 “Palo Alto Networks is aware of an increasing number of attacks that leverage the exploitation of this vulnerability. Proof of concepts for this vulnerability have been publicly disclosed by third parties.”
搜索结果中也包含多个威胁情报报告和分析，表明该漏洞的利用已经发生。
提供的代码， `panparse.py`,本身并不是直接的漏洞利用代码，而是一个用于分析 Palo Alto Networks 技术支持文件的 Python 脚本。它旨在帮助安全分析师查找与 CVE-2024-3400 相关的入侵痕迹（IOCs）。此脚本分析日志文件，例如gpsvc.log，sslvpn-access.log 和 nginx 的访问日志，以查找可疑活动。`iocs.txt` 文件包含已知的恶意IP地址，脚本将使用这些IP地址在日志中进行搜索。

因此，提供的PoC代码的有效性在于辅助分析，而不是直接利用漏洞。

**投毒风险分析：**

*   `README.md`：只是一个说明文件，描述了脚本的用途和使用方法，没有投毒风险。
*   `iocs.txt`：包含一个IP地址。虽然可以通过添加额外的恶意IP地址来误导分析，但这不是传统的代码投毒。风险较低。
*   `panparse.py`：Python脚本，分析日志文件。潜在的投毒方式可能包括：
    *   **恶意正则表达式：** 正则表达式如果构造不当，可能导致拒绝服务（ReDoS）攻击。
    *   **文件路径操纵：** 脚本处理文件路径，如果存在路径遍历漏洞，可能导致脚本访问或修改不应访问的文件。
    *   **执行任意命令：** 如果脚本包含执行系统命令的功能（虽然提供的代码中未直接体现，但可以通过构造特定的日志内容来实现），则可能被利用执行恶意命令。
*   **综合评估：** 由于脚本主要是分析日志文件，投毒的直接危害较小，主要集中在误导分析人员或造成拒绝服务。但如果配合精心构造的日志文件，可能存在一定的风险。

整体来看，投毒风险较低，大约为10%。 风险主要来自于被分析的日志内容和脚本本身存在的潜在漏洞，而不是恶意代码。

**利用方式：**

1.  **未授权访问：** 攻击者不需要身份验证即可触发漏洞。
2.  **文件创建：** 漏洞允许攻击者在系统上创建任意文件。
3.  **命令注入：** 通过创建包含恶意代码的文件，攻击者可以利用命令注入漏洞执行任意命令，从而获得 root 权限。
4.  **GlobalProtect配置：** 该漏洞仅影响配置了GlobalProtect网关或Portal的PAN-OS系统。


**项目地址:** [HackingLZ/panrapidcheck](https://github.com/HackingLZ/panrapidcheck)

**漏洞详情:** [CVE-2024-3400](https://nvd.nist.gov/vuln/detail/CVE-2024-3400)