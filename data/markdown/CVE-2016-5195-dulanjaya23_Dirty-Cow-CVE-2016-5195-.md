## CVE-2016-5195-Dirty COW-权限提升漏洞

**漏洞编号:** CVE-2016-5195

**漏洞类型:** 权限提升

**影响应用:** Linux Kernel

**危害等级:** 高危，可导致本地用户获取 root 权限

**影响版本:** 2.x through 4.x before 4.8.3

**利用条件:** 本地用户权限，目标系统内核版本在受影响范围内

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2016-5195，又名“Dirty COW”，是 Linux 内核中 mm/gup.c 文件中的一个竞争条件漏洞。该漏洞允许本地用户利用写时复制（COW）功能的不正确处理，写入只读内存映射，从而获得提升的权限。

**有效性：**
根据漏洞库信息和搜索结果，该漏洞在野外已被利用，存在多个公开的 PoC 代码，因此可以判断漏洞是有效的。

**投毒风险：**
提供的 PoC 代码仓库中只有一个 `README.md` 文件，只包含漏洞描述。无法直接从提供的代码片段分析是否存在投毒代码。但是由于exploit-db网站和github上公开的POC代码非常多，攻击者可以修改已存在的POC代码加入后门。因此，在使用网络上下载的POC时需要谨慎，人工审计POC代码可以降低投毒风险。总体来说，直接提供的 PoC 代码本身存在作者隐藏的投毒代码的概率较低, 可以预估风险为10%。

**利用方式：**
1.  **利用原理：** 该漏洞的根本原因是 Linux 内核在处理写时复制 (COW) 时存在竞争条件。当多个进程同时尝试写入同一块只读内存区域时，COW 机制会创建该内存区域的副本，每个进程都可以独立地修改自己的副本。但是，如果两个进程几乎同时尝试写入同一块内存区域，则可能发生竞争条件，导致其中一个进程写入原始的只读内存区域，而不是写入副本。
2.  **利用步骤：**
    *   **寻找目标文件：** 攻击者首先需要找到一个具有权限的只读文件，例如 `/etc/passwd`。
    *   **内存映射：** 使用 `mmap()` 系统调用将该文件映射到内存中。
    *   **竞争条件：** 创建两个线程：一个线程负责循环调用 `madvise()` 系统调用，请求内核释放该内存区域的写保护；另一个线程负责循环写入该内存区域。
    *   **权限提升：** 通过竞争条件，攻击者可以绕过只读保护，修改原始文件，从而提升权限，例如通过修改 `/etc/passwd` 文件添加具有 root 权限的用户。

3.  **缓解措施：**
    *   **内核升级：** 将 Linux 内核升级到 4.8.3 或更高版本，其中已修复此漏洞。
    *   **应用补丁：** 应用相应的安全补丁。

**项目地址:** [dulanjaya23/Dirty-Cow-CVE-2016-5195-](https://github.com/dulanjaya23/Dirty-Cow-CVE-2016-5195-)

**漏洞详情:** [CVE-2016-5195](https://nvd.nist.gov/vuln/detail/CVE-2016-5195)