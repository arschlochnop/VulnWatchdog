## CVE-2021-29447-WordPress-XXE

**漏洞编号:** CVE-2021-29447

**漏洞类型:** XXE (XML External Entity)

**影响应用:** WordPress

**危害等级:** 高危，可能导致敏感信息泄露

**影响版本:** >= 5.6.0, < 5.7.1, PHP 8

**利用条件:** 需要WordPress版本在受影响范围内，PHP版本为8，并且攻击者需要具有上传文件的权限（例如，作者角色）。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于WordPress的媒体库中，由于XML解析问题导致XXE攻击。攻击者需要具有上传文件的权限，上传包含恶意XML Payload的特制文件（例如，wav文件）。该Payload会包含指向外部DTD文件的引用，从而导致服务器解析该DTD文件，进而读取服务器上的敏感文件。

**有效性评估：**
根据漏洞信息和搜索结果，该漏洞确实存在，并且有公开的PoC利用代码。PoC代码通过上传包含恶意XML的wav文件来触发XXE。攻击流程包括创建包含外部实体声明的恶意wav文件，搭建一个HTTP服务器来托管恶意的DTD文件，以及利用WordPress的上传功能上传wav文件。当WordPress解析该wav文件时，会请求攻击者控制的DTD文件，从而触发XXE漏洞，实现任意文件读取。

**投毒风险评估：**
PoC代码主要包含三个文件：README.md, controller.py, listener.py, main.py。
*   `README.md`: 描述了漏洞和利用方法，以及一些注意事项，未发现恶意代码。
*   `controller.py`: 包含了WordPress的登录信息（`wp_login`，`login_form`），目标WordPress地址 (`http://metapress.htb`)，以及上传恶意文件的逻辑。如果攻击者直接使用此脚本，需要修改登录信息和目标地址。这里面硬编码的登录信息存在一定风险，因为使用相同的登录信息可能会被检测到。此外，`controller.py`中的`mediaUpload`函数包含一个Timeout参数，默认设置为2秒。如果网络环境不好或者服务器响应较慢，可能会导致利用失败。
*   `listener.py`: 搭建一个简单的HTTP服务器，用于接收XXE Payload发送的请求，并打印base64编码后的文件内容。也没有发现明显的恶意代码。
*   `main.py`: 简单的交互命令行，用于用户输入文件名，然后调用controller.py和listener.py。

总体来说，PoC代码的功能比较明确，主要用于漏洞验证和利用，没有发现明显的恶意代码。风险点在于硬编码的登录信息和目标地址，以及Timeout参数可能导致利用失败。因此，判断存在10%的投毒风险，主要是一些可能影响使用，但没有主动攻击行为。

**利用方式总结：**
1.  **权限获取：** 攻击者需要拥有WordPress的作者或以上级别的权限，能够上传文件。
2.  **恶意文件构造：** 构造包含恶意XML Payload的wav文件。Payload中需要包含指向外部DTD文件的实体引用。
3.  **DTD文件托管：** 搭建一个HTTP服务器，用于托管恶意的DTD文件。DTD文件中定义了文件读取和base64编码的逻辑。
4.  **文件上传：** 通过WordPress的媒体库上传构造的wav文件。
5.  **触发XXE：** WordPress解析wav文件时，会请求攻击者控制的DTD文件，从而触发XXE漏洞。
6.  **文件读取：** 攻击者通过HTTP服务器接收到的请求，获取base64编码后的文件内容，并进行解码。

**项目地址:** [elf1337/blind-xxe-controller-CVE-2021-29447](https://github.com/elf1337/blind-xxe-controller-CVE-2021-29447)

**漏洞详情:** [CVE-2021-29447](https://nvd.nist.gov/vuln/detail/CVE-2021-29447)