## CVE-2018-9206 - Blueimp jQuery File Upload 未授权任意文件上传

**漏洞编号:** CVE-2018-9206

**漏洞类型:** 未授权任意文件上传

**影响应用:** Blueimp jQuery File Upload

**危害等级:** 高危，可能导致远程代码执行和服务器控制

**影响版本:** <= 9.22.0

**利用条件:** 目标系统运行存在漏洞版本的Blueimp jQuery File Upload，且上传目录具有执行权限。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞允许未经身份验证的攻击者上传任意文件到服务器，包括恶意脚本。通过构造特定的请求，攻击者可以上传包含恶意代码的PHP或其他脚本文件，然后通过访问该文件来执行任意命令，从而完全控制服务器。

**有效性评估：**

根据漏洞库信息和搜索结果，此漏洞是一个已知的、被广泛利用的未授权文件上传漏洞。Exploit-DB 上有相关的利用代码（46182, 45790），证明其有效性。搜索结果也显示该漏洞已被武器化，并在实际攻击中使用。

提供的POC代码 `jqshell.py` 是一个武器化的版本，可以针对单个目标或目标列表进行攻击，并支持通过Tor代理隐藏攻击流量，进一步证实了漏洞的可利用性。

**投毒风险分析：**

分析POC代码 `jqshell.py`，虽然存在作者信息以及免责声明，但不能完全排除投毒风险。代码中使用了 `requests` 库进行网络请求，`subprocess` 库执行系统命令，具有一定的潜在风险。例如，如果作者在代码中加入了恶意hook，或者篡改了上传的文件内容，可能会导致被攻击的服务器感染恶意软件。代码中使用了 `misc` 模块，需要进一步检查 `misc.py` 的内容才能更准确地评估投毒风险。考虑到作者已经公开了该漏洞利用工具，并且有免责声明，投毒的可能性相对较低，但仍需保持警惕。

**利用方式：**

1.  **漏洞发现：** 确定目标系统上使用的 Blueimp jQuery File Upload 版本小于或等于 9.22.0。
2.  **文件上传：** 构造一个包含恶意代码（如PHP webshell）的文件。
3.  **请求构造：**  使用 POST 请求将恶意文件上传到服务器上的文件上传目录。由于漏洞是未授权的，因此无需身份验证。
4.  **代码执行：**  通过访问上传的恶意文件，触发服务器执行其中的代码，从而获得服务器的控制权。

`jqshell.py` 脚本简化了这一过程，它接受目标 URL、webshell 路径等参数，并自动完成文件上传和代码执行。  它还提供了Tor代理选项，增加了攻击的隐蔽性。通过 `-t` 指定目标，`-s` 指定 webshell 的路径，`-o` 指定成功利用的主机列表的保存位置，`-tor` 选项启用 Tor 代理。

**项目地址:** [Stahlz/JQShell](https://github.com/Stahlz/JQShell)

**漏洞详情:** [CVE-2018-9206](https://nvd.nist.gov/vuln/detail/CVE-2018-9206)