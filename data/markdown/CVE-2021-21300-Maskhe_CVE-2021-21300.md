## CVE-2021-21300-Git-远程代码执行

**漏洞编号:** CVE-2021-21300

**漏洞类型:** 远程代码执行

**影响应用:** Git

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** >= 2.14.2, < 2.17.6
>= 2.18.0, < 2.18.5
>= 2.19.0, < 2.19.6
>= 2.20.0, < 2.20.5
>= 2.21.0, < 2.21.4
>= 2.22.0, < 2.22.5
>= 2.23.0, < 2.23.4
>= 2.24.0, < 2.24.4
>= 2.25.0, < 2.25.5
>= 2.26.0, < 2.26.3
>= 2.27.0, < 2.27.1
>= 2.28.0, < 2.28.1
>= 2.29.0, < 2.29.3
>= 2.30.0, < 2.30.1

**利用条件:** 目标系统使用受影响的Git版本，并且文件系统是大小写不敏感的 (如 NTFS, HFS+, APFS)，开启了core.symlinks配置，同时配置了clean/smudge filters（如Git LFS）。用户克隆恶意仓库。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-21300 漏洞允许攻击者通过构造包含恶意符号链接和带有clean/smudge filter（比如Git LFS）的文件，在克隆仓库时执行任意代码。漏洞主要存在于大小写不敏感的文件系统上，例如 Windows 和 macOS 默认的文件系统。攻击者需要托管一个恶意的 Git 仓库，并诱使用户克隆该仓库。提供的POC代码通过在 `.git/hooks/post-checkout` 目录下放置一个名为 `post-checkout` 的可执行脚本来实现。当用户 `clone` 或者 `checkout` 包含该脚本的仓库时，Git 会自动执行该脚本，从而实现任意代码执行。 `post-checkout`脚本的内容是打印 "PWNED" 到标准错误输出，表明攻击成功。由于POC代码的功能简单，仅用于验证漏洞，投毒风险较低，主要风险在于该仓库可能包含其他恶意文件或配置，在不知情的情况下执行。

**漏洞利用方式:**

1.  攻击者创建一个包含恶意符号链接以及使用 clean/smudge 过滤器的文件的 Git 仓库。
2.  攻击者在 `.git/hooks` 目录下放置恶意脚本，例如 `post-checkout`。
3.  攻击者诱使用户克隆该仓库。
4.  当用户克隆仓库后，Git 会执行 `post-checkout` 脚本，从而执行攻击者预设的恶意代码。

**有效性：**
提供的POC代码有效，可以触发远程代码执行。

**投毒风险分析：**
POC 代码本身比较简单，主要功能是执行一个打印 "PWNED" 的脚本。但仍存在一定的投毒风险，因为攻击者可能在仓库中隐藏其他恶意代码，或者利用 Git LFS 执行更复杂的攻击。因此，虽然直接的投毒风险较低，但用户仍然需要谨慎对待来自未知来源的 Git 仓库。仓库作者有可能在其他地方植入后门或者恶意代码，因此综合判定投毒可能性为10%。

**项目地址:** [Maskhe/CVE-2021-21300](https://github.com/Maskhe/CVE-2021-21300)

**漏洞详情:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)