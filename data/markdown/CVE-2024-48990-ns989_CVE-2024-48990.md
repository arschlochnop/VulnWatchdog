## CVE-2024-48990-needrestart-本地权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 本地权限提升

**影响应用:** needrestart

**危害等级:** 高危，允许本地用户以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地用户权限，目标系统需要安装且运行存在漏洞版本的needrestart

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-48990 漏洞允许本地用户通过操纵 `PYTHONPATH` 环境变量，欺骗 `needrestart` 以 root 权限运行恶意 Python 代码，从而提升权限。

**利用方式：**

1.  **创建包含恶意代码的Python模块：**  攻击者创建一个包含恶意代码的Python模块，例如提供的 `exploit.c` 编译后的 `exploit.so`。
2.  **设置PYTHONPATH环境变量：** 攻击者设置 `PYTHONPATH` 环境变量指向包含恶意模块的目录。需要注意的是，这个目录需要创建一个 `importlib` 子目录并将恶意模块命名为 `__init__.so`。
3.  **触发needrestart：** 攻击者触发 `needrestart` 运行。这通常发生在系统更新或重新启动服务时。
4.  **权限提升：**  当 `needrestart` 运行时，它会使用攻击者控制的 `PYTHONPATH` 加载恶意模块，从而以 root 权限执行恶意代码。POC中使用 `sed` 命令修改 `/etc/passwd` 文件，添加一个UID/GID为0的恶意用户。

**有效性：**

提供的 POC 代码有效，能够成功利用该漏洞提升权限。它通过在 `PYTHONPATH` 中插入恶意模块，使得 `needrestart` 在扫描进程时加载该模块，执行其中的恶意代码。

**投毒风险：**

基于提供的代码，未发现明显的投毒代码。`exploit.c` 中的代码仅用于修改 `/etc/passwd` 文件，添加一个root权限的用户。 虽然这个行为本身是恶意的，但它直接对应了漏洞利用的目的，没有发现隐藏的、与漏洞利用无关的恶意行为。因此，投毒风险评估为 0%。 仓库只是提供漏洞验证代码，一切行为都围绕漏洞本身进行展开。

**项目地址:** [ns989/CVE-2024-48990](https://github.com/ns989/CVE-2024-48990)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)