## CVE-2019-2115-Android-GateKeeper Double Free

**漏洞编号:** CVE-2019-2115

**漏洞类型:** 双重释放 (Double Free)

**影响应用:** Android GateKeeper

**危害等级:** 高危，可能导致本地权限提升

**影响版本:** Android 7.1.1, Android 7.1.2, Android 8.0, Android 8.1, Android 9

**利用条件:** 需要System执行权限

**POC 可用性:** 是

**投毒风险:** 80%

## 详情

CVE-2019-2115 存在于 Android GateKeeper 组件的 `gatekeeper.cpp` 文件中 `GateKeeper::MintAuthToken` 函数中。由于双重释放漏洞，攻击者可以在本地提升权限。利用过程涉及：

1.  **符号解析：**  POC 代码首先通过读取 `/proc/kallsyms` 文件来动态解析内核符号地址，如 `init_task`、`init_user_ns`、`selinux_enabled` 和 `selinux_enforcing`。
2.  **版本检测：**  检测内核版本，并根据版本调整偏移量。
3.  **内核读写：**  POC 代码创建了一个 pipe，用于在用户空间和内核空间之间进行读写操作，实现任意内核内存读写能力。
4.  **漏洞触发：** 虽然提供的代码片段不包含漏洞触发的明确代码，但根据漏洞描述，利用的关键在于构造特定的输入，触发 `GateKeeper::MintAuthToken` 中的双重释放。
5. **权限提升：** 利用 double free 造成的内存损坏，进而篡改进程的凭据，将进程权限提升为 root 权限。代码尝试通过 `kwrite` 函数修改 `selinux_enforcing` 的值，禁用 SELinux，为后续提权做准备。
6. **清理现场：**  POC 代码包含清理和恢复原始值的函数，试图在利用后恢复系统状态，以减少被检测到的可能性。包括恢复 `selinux_enforcing` 的值，以及修改进程名称以隐藏踪迹。

**有效性评估：** 根据漏洞描述和POC 代码分析，如果漏洞触发代码存在且能成功执行，则漏洞利用有效。

**投毒风险评估：** 考虑到POC的复杂性和提权敏感性，以及代码中包含修改内核数据的操作（如禁用SELinux），存在潜在的投毒风险，例如，修改内核后可能导致系统不稳定或者崩溃，恶意代码可能隐藏在符号解析、版本检测或者内核读写的部分，因此判定存在较高可能性投毒风险。

**搜索引擎补充：**
*   搜索引擎结果显示，CVE-2019-2115 是 Android 系统中的一个权限提升漏洞，存在于 `gatekeeper.cpp` 中。
*   多个来源都确认了该漏洞可能导致本地权限提升，需要 System 执行权限。
*   搜索结果还表明，该漏洞已在 Android Security Bulletin 中修复。

**项目地址:** [Fred12301/CVE-2019-2115-Pixel-2-2-XL](https://github.com/Fred12301/CVE-2019-2115-Pixel-2-2-XL)

**漏洞详情:** [CVE-2019-2115](https://nvd.nist.gov/vuln/detail/CVE-2019-2115)