## CVE-2025-24813-Apache Tomcat-路径遍历/反序列化RCE

**漏洞编号:** CVE-2025-24813

**漏洞类型:** 路径遍历/反序列化RCE

**影响应用:** Apache Tomcat

**危害等级:** 高危，可能导致信息泄露和远程代码执行

**影响版本:** 9.0.0.M1 <= version <= 9.0.98, 10.1.0-M1 <= version <= 10.1.34, 11.0.0-M1 <= version <= 11.0.2

**利用条件:** 1. 默认Servlet启用写入 (默认禁用)
2. 支持部分PUT (默认启用)
3. 对于信息泄露/文件注入：目标URL是公共上传目标URL的子目录；攻击者知道安全敏感文件的名称；安全敏感文件也通过部分PUT上传。
4. 对于RCE：应用程序使用Tomcat基于文件的会话持久性与默认存储位置；应用程序包含一个可以在反序列化攻击中利用的库。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2025-24813 是 Apache Tomcat 中的一个漏洞，它允许攻击者通过路径等价（'file.Name' 中的内部点）导致远程代码执行（RCE）或信息泄露，或通过启用了写入的 Default Servlet 向上传的文件中添加恶意内容。 根据漏洞库信息，该漏洞存在两种利用场景：

**信息泄露/文件注入：**

*   需要 Default Servlet 启用写入，默认是禁用的。
*   支持部分 PUT 请求，默认启用。
*   目标 URL 是公共上传目标 URL 的子目录。
*   攻击者知道安全敏感文件的名称。
*   安全敏感文件也通过部分 PUT 上传。

**远程代码执行：**

*   需要 Default Servlet 启用写入，默认是禁用的。
*   支持部分 PUT 请求，默认启用。
*   应用程序使用 Tomcat 基于文件的会话持久性与默认存储位置。
*   应用程序包含一个可以在反序列化攻击中利用的库。

**POC代码分析：**

提供的 Dockerfile 修改了 Tomcat 的 `web.xml` 和 `context.xml` 文件，启用了 Default Servlet 的写入功能，并配置了基于文件的会话持久性。这满足了漏洞利用的先决条件。

POC代码尝试利用文件上传漏洞，如果成功，可以向Tomcat服务器写入恶意文件，并利用反序列化漏洞执行任意命令。

**利用方式：**

1.  **检查Default Servlet是否可写:** POC首先尝试通过PUT请求写入文件来检查Default Servlet是否可写。
2.  **生成Payload:** 如果Default Servlet可写，POC会生成恶意payload，可以是一个简单的Java WebShell或更复杂的ysoserial payload。
3.  **上传和验证Payload:** POC通过分块PUT请求将payload上传到Tomcat服务器，并尝试访问上传的文件，以验证payload是否成功执行。
4.  **反序列化攻击(RCE):**  如果Tomcat配置满足反序列化攻击的条件，那么攻击者可以通过上传精心构造的序列化对象，利用存在漏洞的库执行任意代码。

**投毒风险：**

此仓库的投毒风险较低。Dockerfile 仅用于配置 Tomcat 以暴露漏洞，python脚本用于漏洞验证和利用，目的是远程命令执行。 唯一潜在的投毒风险在于：

*   `cve-2025-24813-poc.py`  下载的`ysoserial` 可能包含恶意gadget，但此风险可以通过检查下载源和ysoserial的hash值来降低。

**有效性：**

根据漏洞信息和POC代码，该漏洞利用是有效的，如果目标环境满足先决条件，可以实现RCE或信息泄露。


**项目地址:** [ps-interactive/lab-cve-2025-24813](https://github.com/ps-interactive/lab-cve-2025-24813)

**漏洞详情:** [CVE-2025-24813](https://nvd.nist.gov/vuln/detail/CVE-2025-24813)