## CVE-2016-3088 - Apache ActiveMQ 文件上传与执行漏洞

**漏洞编号:** CVE-2016-3088

**漏洞类型:** 文件上传/远程代码执行

**影响应用:** Apache ActiveMQ

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** 5.x before 5.14.0

**利用条件:** 需要 ActiveMQ Fileserver 模块启用，并存在可用的管理员账户密码（默认admin:admin）

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2016-3088 漏洞存在于 Apache ActiveMQ 的 Fileserver web application 中。攻击者可以通过发送一个 HTTP PUT 请求上传任意文件，然后利用 HTTP MOVE 请求将上传的文件移动到 webapps 目录下，从而执行恶意代码。 

**有效性：**
提供的 POC 代码 `cve_2016_3088.py` 实现了该漏洞的利用过程。代码首先尝试使用提供的用户名和密码登录 ActiveMQ 管理界面，获取 `activemq.home` 属性值，该属性指示了 ActiveMQ 的安装目录。然后，代码向 `/fileserver/shell.txt` 发送 PUT 请求，上传一段 shell 脚本。最后，代码使用 HTTP MOVE 请求将 `shell.txt` 移动到 `webapps/api/shell.jsp`，从而使得该文件可以通过 Web 访问执行。如果上传和移动都成功，则程序会输出 shell.jsp 的访问 URL。

**投毒风险：**
该仓库中主要包含一个 README.md 文件和一个 Python 脚本 `cve_2016_3088.py`。虽然脚本中存在 `uptext = '''your code'''` 这样提示可以插入任意代码的地方，但是这个本身就是漏洞利用的一部分，不能算是作者投毒。简单浏览代码后，未发现明显的恶意代码或后门，风险极低。可以认为投毒风险为 1%。

**利用方式：**
1.  **身份验证：** 利用漏洞的前提是需要有效的 ActiveMQ 管理员账号密码，如果使用默认密码，风险极大。
2.  **上传文件：** 使用 HTTP PUT 方法将恶意 JSP 文件上传到 `/fileserver` 目录。需要注意的是，这里上传的文件名可以是任意的，如 shell.txt。
3.  **移动文件：** 使用 HTTP MOVE 方法将上传的文件从 `/fileserver` 目录移动到 `webapps` 目录下，通常是 `webapps/api/shell.jsp`。这个操作会将上传的文件变成可执行的 JSP 页面。
4.  **远程执行：** 通过访问 `shell.jsp` 页面，执行任意命令。由于文件上传到了webapps下，攻击者通过构造恶意的请求即可执行服务器命令。

总的来说，该漏洞利用简单，危害性高，如果 ActiveMQ 管理界面使用了默认密码，则很容易被攻击者利用。

**项目地址:** [pudiding/CVE-2016-3088](https://github.com/pudiding/CVE-2016-3088)

**漏洞详情:** [CVE-2016-3088](https://nvd.nist.gov/vuln/detail/CVE-2016-3088)