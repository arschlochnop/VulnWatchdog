## CVE-2018-14847 - MikroTik RouterOS WinBox 目录遍历漏洞

**漏洞编号:** CVE-2018-14847

**漏洞类型:** 目录遍历

**影响应用:** MikroTik RouterOS

**危害等级:** 高危，可能导致敏感信息泄露和远程代码执行（通过写入文件）

**影响版本:** <= 6.42

**利用条件:** 目标设备开启WinBox服务（默认端口8291），且版本在受影响范围内。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2018-14847 漏洞存在于 MikroTik RouterOS 的 WinBox 接口中，允许未经验证的远程攻击者读取任意文件，以及经过身份验证的攻击者写入任意文件。漏洞原因是 WinBox 处理文件请求时存在目录遍历漏洞。

**漏洞利用方式：**

1.  攻击者发送特制的 WinBox 协议数据包，其中包含目录遍历的路径，例如 `../../../../flash/rw/store/user.dat`，以尝试读取敏感文件。
2.  提供的PoC代码通过构造特定的 WinBox 协议数据包，利用目录遍历漏洞读取 `/flash/rw/store/user.dat` 文件，该文件包含加密的用户凭据。
3.  PoC代码解密提取的凭据，并打印到控制台。

**有效性：**

根据漏洞库信息、搜索结果以及提供的漏洞利用代码，该漏洞的PoC是有效的。搜索结果中多个链接都提到了该漏洞的存在和利用方法，并且漏洞利用代码已经实现了读取和解密用户凭据的功能。

**投毒风险：**

通过分析提供的PoC代码，大部分代码逻辑是用于构造 WinBox 协议数据包，发送到目标设备，并处理响应。主要功能集中在读取用户凭据并解密。投毒代码风险主要体现在以下几个方面：

1.  **异常处理：** PoC代码中存在 `try...except` 块，但 `except Exception` 可能捕获所有异常，包括恶意代码引起的异常，从而掩盖了恶意行为。 虽然这是为了增强程序的健壮性，但也可能被利用来隐藏恶意代码的执行。
2.  **依赖项：** PoC代码依赖 `rich` 和 `alive_progress` 库。虽然这些库本身是安全的，但如果攻击者控制了这些库的安装源，则有可能引入恶意代码。
3.  **网络连接：** PoC代码创建网络连接以发送恶意请求。如果攻击者修改了代码，可能会利用该连接下载和执行其他恶意代码。
4.  **文件操作:** 代码只读文件。

综上所述，此PoC代码存在投毒风险，但风险较低，代码中没有明显的恶意行为。绝大部分代码是为了实现漏洞利用，风险点在于异常处理和潜在的依赖库污染。风险评估为 5%。

**项目地址:** [K3ysTr0K3R/CVE-2018-14847-EXPLOIT](https://github.com/K3ysTr0K3R/CVE-2018-14847-EXPLOIT)

**漏洞详情:** [CVE-2018-14847](https://nvd.nist.gov/vuln/detail/CVE-2018-14847)