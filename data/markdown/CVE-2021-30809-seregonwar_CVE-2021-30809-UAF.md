## CVE-2021-30809 - Apple WebKit Use-After-Free

**漏洞编号:** CVE-2021-30809

**漏洞类型:** Use-After-Free (UAF)

**影响应用:** WebKit (Safari, iOS, iPadOS, tvOS, watchOS)

**危害等级:** 高危，可能导致任意代码执行

**影响版本:** < Safari 15, tvOS 15, watchOS 8, iOS/iPadOS 15，WebKitGTK and WPE WebKit before 2.32.4

**利用条件:** 需要用户访问恶意构造的网页内容

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2021-30809 是一个 Apple WebKit 中的 Use-After-Free 漏洞。该漏洞存在于国际化/日期时间格式化代码路径中。攻击者可以通过构造恶意的 Web 内容，利用 `Intl.DateTimeFormat` 对象和特定的选项，触发释放后使用，从而导致程序崩溃甚至任意代码执行。

**有效性：**
提供的 PoC 代码旨在触发浏览器崩溃，而不是完整的利用链。代码使用精心设计的选项和循环来增加内存压力，从而暴露 UAF 漏洞。根据描述，该 PoC 可以稳定地在易受攻击的构建上触发崩溃，因此认为该 PoC 是有效的。

**投毒风险：**
PoC 代码的主要目的是触发崩溃，避免了 ROP/spray 或提权步骤，因此投毒风险较低。代码很短，功能清晰，主要是通过 `Intl.DateTimeFormat` 触发漏洞，没有发现隐藏的恶意代码。`server.py` 只是提供静态资源服务，没有其它功能。但如果攻击者替换 `poc.js` 或 `exploit.html` 文件，就有可能引入恶意代码。仓库中作者隐藏的投毒代码的可能性非常低。

**利用方式：**
1.  攻击者构建一个包含恶意 JavaScript 代码的网页。
2.  用户访问该网页。
3.  JavaScript 代码使用 `Intl.DateTimeFormat` 对象和恶意选项触发 UAF 漏洞。
4.  如果漏洞成功触发，可能导致浏览器崩溃或任意代码执行。
5. 该漏洞影响WebKit内核的多个产品，包括Safari, iOS, iPadOS, tvOS, watchOS以及WebKitGTK等，表明此漏洞可能影响的范围比较广泛。 

**搜索引擎结果重要性：**
搜索结果确认了 CVE-2021-30809 的存在，并提供了受影响的组件和版本信息，以及供应商发布的修复程序。也指出了WebKitGTK中存在该漏洞。 


**项目地址:** [seregonwar/CVE-2021-30809-UAF](https://github.com/seregonwar/CVE-2021-30809-UAF)

**漏洞详情:** [CVE-2021-30809](https://nvd.nist.gov/vuln/detail/CVE-2021-30809)