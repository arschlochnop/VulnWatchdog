## CVE-2015-3224 Ruby on Rails Web Console IP Whitelist Bypass RCE

**漏洞编号:** CVE-2015-3224

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Ruby on Rails Web Console

**危害等级:** 高危，允许未经授权的远程代码执行

**影响版本:** Web Console < 2.1.3, Ruby on Rails 3.x/4.x

**利用条件:** 目标服务器运行存在漏洞的Ruby on Rails Web Console，且攻击者能发送HTTP请求。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2015-3224 漏洞允许攻击者通过伪造 `X-Forwarded-For` HTTP头来绕过 Web Console 的 IP 白名单限制，从而获得未授权的访问权限并执行任意代码。

**有效性：**
提供的漏洞利用代码（`exploit.py`）看起来是有效的。它包含以下关键步骤：

1.  **路径探测：** 通过访问 `/force_routing_error` 强制路由错误，以此探测 Web Console 的动态路径。
2.  **IP 欺骗：** 设置 `X-Forwarded-For` 头，伪造受信任的 IP 地址 (例如 `127.0.0.1`)。
3.  **代码执行：** 利用 Web Console 执行任意代码，通常通过 `render inline` 实现。
4.  **交互式 Shell：**  支持简单 shell 和反向 TTY shell 两种模式，后者提供更稳定的交互式体验。

搜索引擎结果也确认了该漏洞的存在和利用方式。多个页面（如 HackerOne 报告、Pentest-Tools 页面）指出该漏洞可能导致远程代码执行。

**投毒风险：**
评估投毒风险较低，约为5%。以下是评估过程：
* `README.md` 中声明该脚本仅用于授权安全测试，并免责声明滥用责任。尽管这不能完全排除恶意行为，但降低了投毒的可能性。
* 代码检查显示，该脚本主要功能是利用漏洞，并没有发现明显的后门或恶意代码。脚本的功能围绕利用已知的漏洞，而非植入新的漏洞。
* 存在轻微的投毒风险原因在于作者可能通过服务器日志等方式获取目标信息，或者预留了不明显的回调后门，但从代码可读性来看，可能性很小。

**利用方式：**
1.  **安装依赖：** 确保安装了 Python 3 和 `requests` 库。
2.  **运行脚本：** 使用 `exploit.py` 脚本，指定目标服务器的 URL。
3.  **选择 Shell 模式：**
    *   **简单 Shell：** 适用于执行简单的命令。
    *   **反向 TTY Shell：** 需要先在本地机器上启动一个 `netcat` 监听器，然后在运行脚本时指定本地 IP 地址和端口。连接建立后，需要执行一些命令来稳定 shell，例如 `stty raw -echo; fg` 和 `reset`。
4.  **利用 X-Forwarded-For 绕过白名单:**  脚本会自动设置 `X-Forwarded-For` 头，从而绕过 IP 白名单限制，获得 Web Console 的访问权限。
5.  **执行任意代码:** 成功绕过白名单后，可以通过 Web Console 执行任意代码。

**项目地址:** [Sic4rio/CVE-2015-3224](https://github.com/Sic4rio/CVE-2015-3224)

**漏洞详情:** [CVE-2015-3224](https://nvd.nist.gov/vuln/detail/CVE-2015-3224)