## CVE-2019-11043 - PHP-FPM 远程代码执行

**漏洞编号:** CVE-2019-11043

**漏洞类型:** 远程代码执行

**影响应用:** PHP-FPM (搭配 Nginx)

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** PHP 7.1.x (< 7.1.33), 7.2.x (< 7.2.24), 7.3.x (< 7.3.11)

**利用条件:** Nginx 配置不当，启用 php-fpm，且使用 fastcgi_split_path_info 指令。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-11043 漏洞是 PHP-FPM 在特定 Nginx 配置下存在的远程代码执行漏洞。当 Nginx 未正确配置，特别是使用了 `fastcgi_split_path_info` 指令时，攻击者可以通过在 URL 中注入换行符（%0a）来绕过路径检查，导致 PATH_INFO 为空。PHP-FPM 处理 PATH_INFO 为空的逻辑存在缺陷，使得攻击者可以通过精心构造的请求，覆盖 FPM 模块分配的缓冲区，最终实现远程代码执行。

**利用方式：**

1.  **利用条件确认：** 目标服务器必须同时满足以下条件：
    *   运行 Nginx 作为 Web 服务器。
    *   使用 PHP-FPM 处理 PHP 请求。
    *   Nginx 配置文件中存在 `fastcgi_split_path_info` 指令。
    *   使用的 PHP 版本在受影响范围内 (PHP 7.1.x < 7.1.33, 7.2.x < 7.2.24, 7.3.x < 7.3.11)。
2.  **QSL（Query String Length）探测：** 通过发送包含大量 "Q" 字符的请求，找到能使服务器返回 502 错误的 QSL 值。这个值是成功利用漏洞的关键参数。
3.  **漏洞利用：** 使用找到的 QSL 值构造恶意请求，该请求会触发缓冲区溢出，允许攻击者执行任意代码。

**有效性：**

提供的 POC 代码 (CVE-2019-11043.py) 主要用于检测漏洞是否存在，它通过发送不同长度的请求，检查服务器是否返回 502 错误。如果服务器返回 502，则表明可能存在漏洞，并给出可能的 QSL 值。根据搜索结果和漏洞信息，这个POC的检测部分是有效的。

**投毒风险：**

提供的 POC 代码相对简单，主要功能是漏洞检测。代码中包含一些不友好的HTTP头，如`'D-Pisos': '8=D'`和`'Ebut': 'mamku tvoyu'`，但并未发现明显的恶意代码或后门。`README.md`文件提供了使用`phuip-fpizdam`工具进行漏洞检测和利用的指导。虽然直接投毒风险较低，但需要注意的是，利用该漏洞执行任意代码本身就存在极高的安全风险。用户在使用POC进行验证时，应该在隔离环境中进行，并严格控制利用过程，以防被恶意利用。投毒风险评估为10%，主要是考虑到利用该漏洞的最终目的是远程代码执行，而执行的代码内容完全由攻击者控制，存在极大的潜在风险。



**项目地址:** [AleWong/PHP-FPM-Remote-Code-Execution-Vulnerability-CVE-2019-11043-](https://github.com/AleWong/PHP-FPM-Remote-Code-Execution-Vulnerability-CVE-2019-11043-)

**漏洞详情:** [CVE-2019-11043](https://nvd.nist.gov/vuln/detail/CVE-2019-11043)