## CVE-2023-38646-Metabase-RCE

**漏洞编号:** CVE-2023-38646

**漏洞类型:** 远程代码执行

**影响应用:** Metabase

**危害等级:** 高危，可完全控制服务器

**影响版本:** < 0.46.6.1 和 Metabase Enterprise < 1.46.6.1

**利用条件:** 目标Metabase实例未进行身份验证配置或已完成初始设置但未执行后续安全加固。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-38646 是 Metabase 中的一个未经身份验证的远程代码执行漏洞。根据漏洞描述和搜索引擎结果，未经身份验证的攻击者可以利用此漏洞在服务器上以服务器的权限级别执行任意命令。

**漏洞利用有效性：**

根据漏洞库信息、搜索引擎结果以及提供的PoC代码，该漏洞的利用是有效的。存在多个公开的PoC，证明该漏洞可以被成功利用。

提供的PoC代码 `CVE-2023-38646-POC.py` 旨在获取 Metabase 实例的 setup-token。如果 Metabase 实例处于未设置状态，攻击者可以利用此 token 进行初始化设置，并进一步利用其 RCE 的能力。

提供的PoC代码 `CVE-2023-38646-Reverse-Shell.py` 可能用于更进一步的利用，尝试获取Metabase的版本信息和setup token。

**投毒风险：**

PoC 代码 `CVE-2023-38646-POC.py` 主要功能是发现未配置的 Metabase 实例并获取 setup token，本身没有明显的投毒代码。 但是，不能完全排除其作者在代码中隐藏恶意代码的可能性，例如在获取 token 后尝试执行其他操作，或者将 token 发送到外部服务器。风险评估为 10%。

PoC 代码 `CVE-2023-38646-Reverse-Shell.py` 同样是漏洞利用相关，主要涉及获取setup token等信息。需要人工审计该部分代码，进一步确认是否存在植入后门的风险。

**漏洞利用方式：**

1.  **信息收集：** 攻击者首先需要确定目标 Metabase 实例的版本是否在受影响的范围内。通过访问`/api/session/properties`端点可以获取 Metabase 版本。
2.  **获取Setup Token (如果未设置):** 如果 Metabase 实例尚未完成初始化设置，攻击者可以通过访问`/api/session/properties`端点获取 setup-token。这个token可以用来完成Metabase的初始化。
3.  **执行任意代码：**  利用获取的setup token或者其他漏洞，攻击者可以通过构造恶意的请求来执行任意代码。具体 RCE 的利用方式可能涉及多个步骤，例如通过创建一个恶意的数据源或仪表板，触发代码执行。

总而言之，该漏洞的利用相对简单，危害性极高。攻击者可以利用该漏洞完全控制受影响的 Metabase 服务器。 

**项目地址:** [XiaomingX/cve-2023-38646-poc](https://github.com/XiaomingX/cve-2023-38646-poc)

**漏洞详情:** [CVE-2023-38646](https://nvd.nist.gov/vuln/detail/CVE-2023-38646)