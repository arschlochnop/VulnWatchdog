## CVE-2023-28121-WooCommerce Payments 插件未授权提权

**漏洞编号:** CVE-2023-28121

**漏洞类型:** 权限提升

**影响应用:** WooCommerce Payments WordPress Plugin

**危害等级:** 高危，未经身份验证的攻击者可以发送代表具有提升权限（如管理员）的用户发出的请求，从而获得管理员访问权限。

**影响版本:** <= 5.6.1

**利用条件:** 需要目标站点安装了WooCommerce Payments插件，且版本低于或等于5.6.1，网络可访问。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-28121 漏洞是 WooCommerce Payments WordPress 插件中的一个权限提升漏洞。未经身份验证的攻击者可以通过发送带有 `X-WCPAY-PLATFORM-CHECKOUT-USER: 1` 头部的请求来绕过身份验证，并以管理员身份执行操作。 

**漏洞利用方式：**

1.  攻击者发送一个POST请求到`/wp/v2/users`路由，绕过`wp-json` 添加 `?rest_route=` 
2.  在请求头中包含`X-WCPAY-PLATFORM-CHECKOUT-USER: 1`。
3.  请求体中包含要创建的管理员用户的信息，例如用户名、密码和角色。

**POC有效性分析：**

提供的POC代码 `woo-request.py` 实现了上述漏洞利用流程。 它读取 `targets.txt` 文件中的目标URL，然后对每个目标发送包含恶意header和json数据的POST请求，尝试创建一个新的管理员用户。

**投毒风险分析：**

虽然POC代码的主要功能是利用漏洞，但仍然存在一定的投毒风险。风险主要来源于以下几个方面：

*   `targets.txt`：攻击者可能会修改 `targets.txt` 文件，使其包含恶意URL，例如指向蜜罐或者恶意站点的链接，从而误导使用者。
*   结果保存：攻击者可以通过在 `save_results` 函数中添加恶意代码，例如将目标站点的敏感信息发送到攻击者控制的服务器。
*  `check_vulnerability`函数，目前只判断了状态码是否为200，存在误判的可能，如果目标不是wordpress站点，可能导致利用代码发送到不应该发送的地方。

尽管存在上述风险，但总体而言，该POC代码的投毒风险较低，因为主要功能还是漏洞利用。 作者添加恶意代码的可能性较低，但使用者仍然需要谨慎，仔细检查代码后再使用。

**总结：**

该漏洞是一个高危漏洞，利用简单，危害巨大。POC代码有效，但存在一定的投毒风险，使用前请务必谨慎检查。

**项目地址:** [1337nemojj/CVE-2023-28121](https://github.com/1337nemojj/CVE-2023-28121)

**漏洞详情:** [CVE-2023-28121](https://nvd.nist.gov/vuln/detail/CVE-2023-28121)