## CVE-2018-10933-libssh认证绕过

**漏洞编号:** CVE-2018-10933

**漏洞类型:** 认证绕过

**影响应用:** libssh

**危害等级:** 高危，可能导致未授权访问

**影响版本:** 0.6 <= version < 0.7.6, 0.8 <= version < 0.8.4

**利用条件:** 目标系统运行受影响版本的libssh，且服务端开启并监听SSH连接。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2018-10933 存在于 libssh 的服务器端状态机中，允许未经身份验证的客户端绕过身份验证过程并创建 channel。攻击者通过发送 SSH2_MSG_USERAUTH_SUCCESS 消息而不是服务器期望的 SSH2_MSG_USERAUTH_REQUEST 消息来利用此漏洞。

**有效性评估：**

提供的PoC代码包括一个Dockerfile，用于构建一个包含漏洞版本的libssh服务器的Docker镜像。Dockerfile中包含应用cve-2018-10933.patch的步骤，以及server.patch。README.md 文件描述了如何使用Docker镜像来利用漏洞。说明该POC代码可以有效重现该漏洞。

**投毒风险分析：**

*   **Dockerfile:**  Dockerfile 的主要作用是构建一个包含漏洞版本的 libssh，以及应用漏洞补丁。其中构建过程涉及从源代码编译 libssh，并安装必要的工具。检查发现，Dockerfile中存在添加并应用名为`server.patch`的补丁文件的操作，这个可能是作者隐藏的投毒代码。虽然目的是为了能够利用该漏洞，但是不能排除作者添加恶意代码，进行后门植入。

*   **cve-2018-10933.patch:** 这个补丁本身是为了修复漏洞，因此不存在投毒的可能。

*   **README.md:** README 文件仅包含关于如何使用 Docker 镜像和 PoC 代码的信息，不包含任何可疑代码。

基于以上分析，Dockerfile 中的`server.patch`文件最有可能包含投毒代码。考虑到该文件是为了方便漏洞利用，而该利用本身可以理解为一种“后门”，因此，不能完全将该行为判定为恶意投毒，但仍然存在一定风险。估计的投毒风险为10%。

**利用方式：**

1.  攻击者连接到存在漏洞的 libssh 服务器。
2.  攻击者不发送 SSH2_MSG_USERAUTH_REQUEST 消息，而是直接发送 SSH2_MSG_USERAUTH_SUCCESS 消息。
3.  服务器错误地将客户端状态设置为已认证。
4.  攻击者现在可以创建 channel，执行未授权的操作，例如端口转发或执行命令。

**项目地址:** [hackerhouse-opensource/cve-2018-10933](https://github.com/hackerhouse-opensource/cve-2018-10933)

**漏洞详情:** [CVE-2018-10933](https://nvd.nist.gov/vuln/detail/CVE-2018-10933)