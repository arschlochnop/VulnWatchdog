## CVE-2019-13272 - Linux Kernel PTRACE_TRACEME 本地提权漏洞

**漏洞编号:** CVE-2019-13272

**漏洞类型:** 本地提权

**影响应用:** Linux Kernel

**危害等级:** 高危，允许本地用户获取root权限

**影响版本:** < 5.1.17

**利用条件:** 需要本地用户权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-13272 漏洞存在于 Linux kernel 5.1.17 之前的版本中，是由于 `kernel/ptrace.c` 中的 `ptrace_link` 函数在处理进程创建 ptrace 关系时的凭据记录时存在缺陷，可能导致本地用户利用父子进程关系获得 root 权限。该漏洞利用场景通常是父进程降低权限后调用 `execve`，攻击者可以控制子进程，或者通过 Polkit 的 pkexec helper 利用 `PTRACE_TRACEME` 进行攻击。

**有效性评估：**

根据提供的漏洞信息、搜索结果以及漏洞利用代码，该漏洞的POC代码是有效的。漏洞描述中明确说明了利用场景以及成功利用的案例，并且POC代码中也列出了多个成功测试过的Linux发行版和内核版本。

**投毒风险评估：**

分析POC代码内容，代码主要逻辑是利用`ptrace`系统调用，结合`pkexec`或其它helper程序，通过特定的父子进程关系来提权。没有发现明显的恶意代码，例如反弹shell，添加后门用户等。但存在一定风险，因为攻击者可以修改代码，例如在获取root权限后执行任意恶意指令。这种风险是通用的，所有exploit代码都存在这种风险，攻击者有能力修改代码的情况下，可以做任何事情。但就提供的代码本身而言，直接包含投毒代码的可能性较低，评估为10%。

**漏洞利用方式：**

1.  **利用`PTRACE_TRACEME`：** 攻击者首先运行一个父进程，该父进程降低权限并调用 `execve`。然后，攻击者可以控制子进程。
2.  **利用`pkexec` helper：**  利用Polkit的pkexec helper，通过`PTRACE_TRACEME`来利用该漏洞。POC代码就是使用的这种方式，它首先查找系统上可用的 helper 程序（例如，gnome-settings-daemon 的 helper），然后使用该 helper 程序来触发漏洞。
3.  **进程关系利用：** 漏洞利用依赖于进程间的父子关系，父进程需要调用`execve`并且放弃权限，攻击者才有机会控制子进程。

**缓解措施：**

*   升级Linux内核到5.1.17或更高版本。
*   在某些环境中，可以使用SELinux的`deny_ptrace`作为临时缓解方案。

**项目地址:** [jas502n/CVE-2019-13272](https://github.com/jas502n/CVE-2019-13272)

**漏洞详情:** [CVE-2019-13272](https://nvd.nist.gov/vuln/detail/CVE-2019-13272)