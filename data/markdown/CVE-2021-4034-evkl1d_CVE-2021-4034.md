## CVE-2021-4034-polkit-pkexec 本地提权

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地权限提升

**影响应用:** polkit

**危害等级:** 高危，允许低权限用户获得 root 权限

**影响版本:** all

**利用条件:** 目标系统存在 polkit 且 pkexec 可执行

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-4034 是 polkit pkexec 工具中的一个本地权限提升漏洞。pkexec 是一个 setuid 工具，旨在允许非特权用户按照预定义的策略以特权用户的身份运行命令。漏洞利用方式如下：

1.  **漏洞原理：** pkexec 在处理参数计数时存在缺陷，导致它尝试将环境变量作为命令执行，从而可能导致任意代码执行。
2.  **利用方式：** 攻击者可以精心构造环境变量，诱使 pkexec 执行任意代码。这个 POC 通过创建特定的目录结构和文件 (GCONV_PATH=. , exploit/gconv-modules) 以及设置特定的环境变量 (PATH, LC_MESSAGES, XAUTHORITY)，利用 gconv 机制加载恶意的共享库 (payload.so)。该共享库包含提权的 shellcode (通过 msfvenom 生成)，一旦加载，将会以 root 权限执行。
3.  **有效性评估：** 根据漏洞库信息、搜索结果，该漏洞被广泛利用，并且提供了 POC 代码。该 POC 利用了 polkit 的参数处理错误和 gconv 机制，应该能够有效提权。
4.  **投毒风险评估：** 该 POC 代码的主要功能是创建目录和文件，设置环境变量，然后调用 `execve` 执行 `/usr/bin/pkexec`。Payload 是使用 `msfvenom` 生成的，目的是反弹一个 root shell。虽然该 payload 可以替换成其他 payload，但该代码本身并未发现明显的投毒行为。代码的风险在于，如果攻击者替换了 payload，可能会植入恶意后门，但就提供的代码本身而言，投毒的可能性较低。作者的目的更多的是为了证明该漏洞的可利用性. 因此投毒风险为0%。

总而言之，该 POC 代码有效，并且可以稳定复现 CVE-2021-4034 漏洞，实现本地权限提升。

**项目地址:** [evkl1d/CVE-2021-4034](https://github.com/evkl1d/CVE-2021-4034)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)