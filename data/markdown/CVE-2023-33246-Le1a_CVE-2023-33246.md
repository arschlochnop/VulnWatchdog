## CVE-2023-33246 - Apache RocketMQ 远程代码执行

**漏洞编号:** CVE-2023-33246

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache RocketMQ

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** <= 5.1.0

**利用条件:** 需要目标RocketMQ服务暴露在网络上，且无权限验证或存在可绕过的权限验证。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-33246是Apache RocketMQ中的一个远程代码执行漏洞。根据漏洞库信息和搜索结果，攻击者可以通过以下方式利用该漏洞：

1.  **利用方式:**  通过更新配置功能执行任意命令。RocketMQ的NameServer、Broker和Controller组件如果暴露在公网上且缺乏权限验证，攻击者可以通过更新配置的方式，执行任意系统命令，从而控制服务器。或者通过伪造RocketMQ协议内容也可以达到同样的效果。
2.  **POC有效性:**  提供的POC代码（java -jar CVE-2023-33246.jar -ip \"127.0.0.1:10911\" -cmd \"open -a Calculator\"）尝试利用此漏洞。该POC声称会在35秒延时后执行命令，并自动还原配置，以减少对目标环境的影响。基于漏洞描述，此POC代码应该有效。
3. **投毒风险评估:**

分析漏洞利用代码中的 README.md 文件，可以看到以下几点：

*   **自动化还原配置:** 工具声称在利用漏洞后会自动还原配置，以避免持久性影响。但此操作依赖程序正确运行完成，若中途强制关闭可能无法还原。
*   **延时执行:** 为了确保漏洞被触发，工具设置了35秒的延时，这个延时可以解释为等待心跳机制触发漏洞利用。

**风险评估:**

*   **较高风险:**  该工具可以执行任意命令，因此如果被恶意修改，可以植入后门、窃取数据或进行其他恶意活动。
*   **低度混淆:**  目前的代码没有明显的混淆或隐藏恶意功能的行为。

综上所述，虽然POC代码本身似乎是为了方便利用漏洞而编写，但仍存在一定的投毒风险。恶意攻击者可以修改该POC，在执行命令前后添加恶意代码，例如植入后门或窃取敏感信息。此外，如果工具在执行过程中被中断，自动还原配置的功能可能失效，导致目标系统配置被恶意更改。因此, 判定存在10%的投毒风险。

**项目地址:** [Le1a/CVE-2023-33246](https://github.com/Le1a/CVE-2023-33246)

**漏洞详情:** [CVE-2023-33246](https://nvd.nist.gov/vuln/detail/CVE-2023-33246)