## CVE-2020-7961-Liferay Portal反序列化RCE

**漏洞编号:** CVE-2020-7961

**漏洞类型:** 反序列化漏洞

**影响应用:** Liferay Portal

**危害等级:** 高危，远程代码执行

**影响版本:** < 7.2.1 CE GA2

**利用条件:** 需要目标开启JSONWS服务且未打补丁

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2020-7961是Liferay Portal 7.2.1 CE GA2之前的版本中存在的一个反序列化漏洞。攻击者可以通过JSON Web Services (JSONWS)接口，发送特制的恶意请求，利用不安全的反序列化操作，执行任意代码。

**有效性评估：**

根据漏洞库信息、搜索引擎结果以及提供的漏洞利用代码，可以判断该漏洞的POC代码是有效的。搜索引擎结果中包含了Rapid7、Synacktiv等安全厂商的分析报告和PoC，表明该漏洞已经被广泛研究和利用。提供的代码库中包含rce.py和mass.py，分别用于单个目标和批量目标的漏洞利用，shell.py提供了简单的shell交互，说明漏洞利用已经比较成熟。

**投毒风险分析：**

虽然提供的代码库主要功能是实现RCE，但存在少量潜在的投毒风险。主要分析如下：

*   **隐蔽的恶意命令：** rce.py 脚本中的 `command = 'lollulzkid'` 变量看起来像一个占位符，但攻击者可能将其替换为更隐蔽和恶意的命令，例如下载和执行恶意脚本。
*   **依赖包风险：** 虽然脚本中使用的requests和colorama是常见的Python库，但如果攻击者发布修改后的版本，可能会引入恶意代码。
*   **Mass.py 批量攻击风险：** mass.py 脚本用于批量攻击，如果攻击者控制了受害者网络中的一台机器，可以利用该脚本快速传播恶意软件。
*   **Shell.py 简单webshell：** shell.py 在成功利用漏洞后，能建立简单webshell，攻击者可进行恶意操作。

综合评估，投毒风险较低，约为5%，主要来自替换命令、使用恶意依赖包以及批量攻击带来的扩大影响的可能性。

**利用方式分析：**

1.  **漏洞触发点：** 该漏洞通过Liferay Portal的`/api/jsonws/invoke`端点触发，利用JSONWS服务。
2.  **利用过程：** 攻击者发送包含恶意序列化数据的POST请求到`/api/jsonws/invoke`。恶意序列化数据通常包含一个精心构造的Java对象，该对象在反序列化时会执行任意代码。
3.  **RCE实现：** 提供的代码使用`com.mchange.v2.c3p0.WrapperConnectionPoolDataSource`类以及`org.apache.commons.collections.functors.ChainedTransformer`等类构造恶意序列化数据，从而实现远程代码执行。
4.  **POC使用：**
    *   `rce.py`：针对单个目标URL，发送包含恶意序列化数据的POST请求。
    *   `mass.py`：批量利用，从文件中读取目标URL列表，然后调用`rce.py`对每个目标进行攻击。
    *   `shell.py`:  提供简单的shell访问界面。

**项目地址:** [CrackerCat/CVE-2020-7961-Mass](https://github.com/CrackerCat/CVE-2020-7961-Mass)

**漏洞详情:** [CVE-2020-7961](https://nvd.nist.gov/vuln/detail/CVE-2020-7961)