## CVE-2019-5736-runc容器逃逸

**漏洞编号:** CVE-2019-5736

**漏洞类型:** 容器逃逸

**影响应用:** runc (Docker)

**危害等级:** 高危，允许容器逃逸并获取宿主机Root权限

**影响版本:** runc <= 1.0-rc6，Docker < 18.09.2

**利用条件:** 攻击者需要在容器内执行代码的能力（例如，通过docker exec连接到现有容器，或通过构建恶意镜像启动新容器），并且容器需要具有root权限。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-5736漏洞是runc在处理文件描述符时的一个错误，导致攻击者可以覆盖宿主机的runc二进制文件，从而获得宿主机的root权限。攻击者可以通过以下步骤利用此漏洞：

1.  **准备阶段：**
    *   攻击者需要能够在一个容器内执行代码，并且该容器需要拥有root权限。
    *   攻击者可以将恶意代码（如提供的POC）放置在容器内。

2.  **漏洞触发：**
    *   当在容器内执行`docker exec`或者创建一个新的容器时，会调用宿主机上的runc。
    *   恶意代码会尝试打开`/proc/self/exe`，并获取runc二进制文件的文件描述符。
    *   由于文件描述符处理不当，恶意代码可以覆盖宿主机上的runc二进制文件。

3.  **权限提升：**
    *   一旦runc二进制文件被覆盖，下次任何容器操作（例如`docker exec`或`docker run`）都会执行被替换的恶意代码，从而允许攻击者在宿主机上以root权限执行任意命令。

**有效性评估：**

根据漏洞描述和搜索结果，提供的POC代码是有效的，可以用于利用CVE-2019-5736漏洞。

**投毒风险评估：**

提供的POC代码主要功能是替换宿主机上的`runc`二进制文件，并执行预先设定的命令。检查`Makefile`，`src/exploit.c`和`src/main.c`，发现其功能是编译和执行漏洞利用，并没有发现明显的恶意代码。但是存在一定的投毒风险，因为：

*   **自定义命令执行：** 漏洞利用允许攻击者在宿主机上执行任意命令。虽然默认的POC可能只是复制`/etc/shadow`，但攻击者可以修改`-c`参数来执行更具破坏性的操作，例如安装后门或删除关键文件。
*   **依赖外部脚本：**  `scripts` 目录下的脚本负责环境搭建和漏洞触发，攻击者可能会在这些脚本中添加恶意逻辑，例如下载并执行恶意程序。

因此，虽然直接的POC代码没有明显的投毒特征，但其灵活性和对外部脚本的依赖使得投毒风险依然存在。建议用户在使用前仔细审查所有代码和脚本，确保其安全性。

**项目地址:** [Perimora/cve_2019-5736-PoC](https://github.com/Perimora/cve_2019-5736-PoC)

**漏洞详情:** [CVE-2019-5736](https://nvd.nist.gov/vuln/detail/CVE-2019-5736)