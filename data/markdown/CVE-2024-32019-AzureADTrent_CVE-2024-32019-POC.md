## CVE-2024-32019-netdata-ndsudo本地提权

**漏洞编号:** CVE-2024-32019

**漏洞类型:** 本地提权

**影响应用:** netdata

**危害等级:** 高危，本地用户可提升至root权限

**影响版本:** >= 1.44.0-60, < 1.45.0-169 及 >= 1.45.0, < 1.45.3

**利用条件:** 目标系统安装了受影响版本的netdata，且具有本地shell访问权限。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-32019 存在于Netdata的`ndsudo`工具中，该工具是具有SUID root权限的可执行文件。漏洞原因是`ndsudo`的搜索路径由`PATH`环境变量控制，攻击者可以通过修改`PATH`环境变量，将恶意程序放置在前面，当`ndsudo`执行信任的命令时，会执行攻击者放置的恶意程序，从而实现本地提权。提供的POC代码通过以下步骤利用该漏洞：

1.  **编译恶意payload:**  `poc.c` 编译成 `nvme`，该程序的功能是执行 `/bin/bash`，并设置 UID 和 GID 为 0，即root权限。
2.  **传输payload到目标系统:**  将编译好的`nvme`上传到目标系统的`/tmp`目录。
3.  **准备payload执行:**  给`/tmp/nvme`添加可执行权限，然后将`/tmp`添加到`PATH`环境变量的最前面。
4.  **触发`ndsudo`执行payload:** 运行`./ndsudo nvme-list`，`ndsudo`会执行`/tmp/nvme`，由于该程序会将权限提升为root，因此攻击者可以获得root shell。

**有效性：** 该POC代码描述的利用方式是有效的。

**投毒风险：** 提供的`poc.c`代码功能清晰，仅为执行`/bin/bash`并提升权限，不存在隐藏的投毒代码。README文件描述了完整的利用过程。因此，投毒风险为0%。

**利用方式：** 攻击者通过控制`PATH`环境变量，欺骗`ndsudo`执行恶意程序，从而获得root权限。

**项目地址:** [AzureADTrent/CVE-2024-32019-POC](https://github.com/AzureADTrent/CVE-2024-32019-POC)

**漏洞详情:** [CVE-2024-32019](https://nvd.nist.gov/vuln/detail/CVE-2024-32019)