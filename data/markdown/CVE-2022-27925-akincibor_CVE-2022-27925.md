## CVE-2022-27925-Zimbra-目录遍历/远程代码执行

**漏洞编号:** CVE-2022-27925

**漏洞类型:** 目录遍历/远程代码执行

**影响应用:** Zimbra Collaboration Suite (ZCS)

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** 8.8.15 and 9.0

**利用条件:** 需要管理员权限或借助其他漏洞绕过身份验证

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-27925是一个Zimbra Collaboration Suite（ZCS）中的目录遍历漏洞。攻击者通过利用mboximport功能，上传包含恶意构造的ZIP压缩包，ZIP压缩包中包含带有目录遍历的jsp文件，上传文件最终解压写入到服务器任意目录。漏洞需要管理员权限，但是存在认证绕过，所以可以未经授权直接访问。

**有效性：**

提供的POC代码是一个nuclei模板，通过发送精心构造的POST请求到`/service/extension/backup/mboximport`端点，上传包含恶意JSP文件的ZIP压缩包。ZIP包里的目录结构为`../../../../mailboxd/webapps/zimbraAdmin/cmd.jsp`，利用目录遍历将JSP文件写入到目标目录。该JSP文件`cmd.jsp`是一个简单的命令执行webshell，允许攻击者通过GET请求的`cmd`参数执行任意系统命令。搜索引擎结果表明该漏洞在野外已被积极利用，该POC利用方式是有效的。

**投毒风险：**

该POC代码本身就是一个漏洞利用程序，目的是在目标服务器上部署webshell。从代码本身来看，不存在额外的、作者隐藏的恶意代码或后门。ZIP压缩包中包含的是一个标准的命令执行JSP webshell，其行为是可预测和可理解的。可以判定此仓库中不存在作者隐藏的投毒代码。

**利用方式：**

1.  攻击者首先需要访问Zimbra服务器的`/service/extension/backup/mboximport`端点。这个端点通常需要管理员权限，但是可能存在身份验证绕过漏洞（例如CVE-2022-37042），允许未经授权的访问。
2.  攻击者构造一个包含恶意JSP文件的ZIP压缩包，其中JSP文件的路径包含目录遍历序列（`../`），将文件写入到`/mailboxd/webapps/zimbraAdmin/`目录下，命名为`cmd.jsp`。
3.  攻击者将构造好的ZIP文件作为POST请求的内容上传到`/service/extension/backup/mboximport`端点。
4.  Zimbra服务器解压上传的ZIP文件，由于目录遍历漏洞，恶意JSP文件被写入到`/mailboxd/webapps/zimbraAdmin/cmd.jsp`。
5.  攻击者通过访问`/zimbraAdmin/cmd.jsp?cmd=<command>`来执行任意系统命令，从而控制服务器。


**项目地址:** [akincibor/CVE-2022-27925](https://github.com/akincibor/CVE-2022-27925)

**漏洞详情:** [CVE-2022-27925](https://nvd.nist.gov/vuln/detail/CVE-2022-27925)