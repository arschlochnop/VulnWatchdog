## CVE-2022-29464 - WSO2 Unrestricted File Upload

**漏洞编号:** CVE-2022-29464

**漏洞类型:** 文件上传漏洞

**影响应用:** WSO2 API Manager, Identity Server, Enterprise Integrator, Open Banking AM/KM

**危害等级:** 高危，远程代码执行

**影响版本:** WSO2 API Manager 2.2.0 - 4.0.0, WSO2 Identity Server 5.2.0 - 5.11.0, WSO2 Identity Server Analytics 5.4.0, 5.4.1, 5.5.0, 5.6.0, WSO2 Identity Server as Key Manager 5.3.0 - 5.11.0, WSO2 Enterprise Integrator 6.2.0 - 6.6.0, WSO2 Open Banking AM 1.4.0 - 2.0.0, WSO2 Open Banking KM 1.4.0 - 2.0.0

**利用条件:** 需要网络访问，目标存在 /fileupload 接口

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-29464 是一个存在于多个 WSO2 产品中的严重漏洞，它允许未经身份验证的攻击者上传任意文件，从而导致远程代码执行。漏洞的根源在于 /fileupload 接口缺乏适当的文件类型验证，攻击者可以通过构造包含目录遍历序列的 Content-Disposition 头，将恶意文件上传到 Web 根目录下的可执行位置，例如 repository/deployment/server/webapps 目录。上传的文件可以是 JSP 文件或其他服务器支持的脚本类型。 

**漏洞利用方式：**

1.  **确定目标：** 找到运行存在漏洞的 WSO2 产品的服务器。
2.  **构造恶意请求：**  构造一个包含恶意文件的 HTTP POST 请求，该请求发送到 /fileupload 接口。Content-Disposition 头必须包含目录遍历序列，以将文件上传到 Web 根目录下的指定位置。
3.  **上传文件：**  将构造的请求发送到目标服务器。
4.  **执行代码：**  通过访问上传的文件来触发恶意代码的执行。例如，如果上传的是 JSP 文件，则可以通过 Web 浏览器访问该文件来执行其中的代码。

**有效性：**

根据漏洞库信息、搜索引擎结果和提供的漏洞利用代码，该漏洞利用是有效的。多个来源都证实了该漏洞的存在和利用方式，并且提供了可用的 POC 代码。

**投毒风险：**

提供的 POC 代码（wso.py）主要功能是利用漏洞进行文件上传和远程代码执行。代码包含以下部分：

*   **请求库 (requests)：**  用于发送 HTTP 请求。
*   **目录创建 (os.mkdir)：**  用于创建结果目录。
*   **命令行清除 (os.system)：**  用于清除屏幕。
*   **Banner 打印：** 用于打印作者信息及免责声明

虽然没有明显的恶意代码，但仍存在一些潜在的风险：

*   **依赖项风险：** requirements.txt 文件中列出的依赖项（requests, urllib3, colorama）本身可能存在漏洞。如果这些依赖项被篡改或包含恶意代码，则可能导致安全问题。
*   **编码风险：** 代码没有对用户输入进行严格的验证，可能存在潜在的代码注入风险。例如，如果目标 URL 可控，攻击者可能会注入恶意代码。
*   **免责声明：** 作者的免责声明也暗示了使用该工具可能存在的风险，虽然正常的漏洞利用工具都有免责声明，但是也暗示此工具有一定的风险。

综上所述，该仓库存在较低的投毒风险，约为 10%。主要风险来自于依赖项和编码风险，需要仔细审查代码和依赖项，确保安全性。


**项目地址:** [ThatNotEasy/CVE-2022-29464](https://github.com/ThatNotEasy/CVE-2022-29464)

**漏洞详情:** [CVE-2022-29464](https://nvd.nist.gov/vuln/detail/CVE-2022-29464)