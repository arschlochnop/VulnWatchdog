## CVE-2019-14287-Sudo权限绕过

**漏洞编号:** CVE-2019-14287

**漏洞类型:** 权限绕过

**影响应用:** Sudo

**危害等级:** 高危，可能导致权限提升

**影响版本:** < 1.8.28

**利用条件:** 攻击者需要拥有Runas ALL的sudoers账户，但受到策略黑名单或PAM模块的限制

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-14287 漏洞允许具有 Runas ALL 权限的 sudoer 账户绕过某些策略黑名单和会话 PAM 模块，以及导致不正确的日志记录。这是通过使用特制的 user ID 调用 sudo 来实现的。例如，这允许绕过 !root 配置，以及 USER= 日志记录，对于 `sudo -u \#$((0xffffffff))` 命令。

**有效性分析：**

根据漏洞信息和搜索结果，POC代码是有效的。漏洞利用的关键在于使用 `-u#-1` 或 `-u #4294967295`（0xffffffff 的十进制表示）来指定用户，这会导致 sudo 在权限检查时出现错误，从而绕过某些限制。

**投毒风险分析：**

提供的 shell 脚本 `sudo.sh` 的主要功能是检测目标系统上 sudo 是否易受攻击，并尝试利用它。脚本首先检查当前用户是否拥有 sudo ALL 权限。如果没有，它会检查用户是否具有任何 sudo 权限。如果用户具有 sudo 权限，脚本将确定 sudo 版本，并将其与易受攻击的版本进行比较。如果 sudo 版本易受攻击，则脚本会尝试使用 `sudo -u#-1` 运行用户通常使用的程序。这个脚本看起来主要是为了利用漏洞，但是依然有潜在投毒风险,例如如果用户具有某些特定的命令执行权限, 利用后可能会影响正常使用或者收集敏感信息等。另外，脚本的开发作者也无法完全信任。

结合代码分析，将投毒风险评估为 10%。

**利用方式：**

1.  **条件：** 攻击者必须具有 sudo ALL 权限，但由于某些策略（例如 `!root`）或 PAM 模块的限制，无法直接以 root 身份运行命令。
2.  **利用：** 攻击者使用 `sudo -u#-1 <command>` 或 `sudo -u #4294967295 <command>` 的形式运行命令。这里的 `-1` 或 `4294967295` 会被 sudo 内部处理为未识别的用户 ID。
3.  **结果：** 由于 sudo 的错误处理，它不会正确地进行权限检查，从而允许攻击者以 root 身份（或其他被允许的用户身份）运行命令，绕过原本的限制。
4.  **修复：** 升级到 Sudo 1.8.28 或更高版本。

**项目地址:** [h3x0v3rl0rd/CVE-2019-14287](https://github.com/h3x0v3rl0rd/CVE-2019-14287)

**漏洞详情:** [CVE-2019-14287](https://nvd.nist.gov/vuln/detail/CVE-2019-14287)