## CVE-2025-52970-FortiWeb-身份验证绕过和远程代码执行

**漏洞编号:** CVE-2025-52970

**漏洞类型:** 身份验证绕过和远程代码执行

**影响应用:** FortiWeb

**危害等级:** 高危，允许未经身份验证的远程攻击者获得管理员权限并在设备上执行任意代码

**影响版本:** <= 7.6.3, <= 7.4.7, <= 7.2.10, <= 7.0.10

**利用条件:** 需要目标FortiWeb设备可以通过网络访问，并且攻击者需要具备关于目标设备和目标用户的非公开信息。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2025-52970 是 Fortinet FortiWeb 中的一个参数处理不当漏洞，允许未经身份验证的远程攻击者利用非公开信息构造恶意请求，绕过身份验证并获得设备的管理员权限。攻击利用方式主要分为三个阶段：

1.  **SQL 注入：**
    *   POC 代码利用了 `/api/fabric/device/status` API 接口的 SQL 注入漏洞。通过在 `Authorization` header 中注入恶意 SQL 代码，攻击者可以执行任意 SQL 查询。注入点在 `Bearer` 字段后，利用 `;` 分隔符注入SQL语句。

2.  **远程代码执行 (RCE)：**
    *   利用 SQL 注入，攻击者可以向数据库表中写入 webshell 和执行 chmod 命令的恶意代码（pylab.py）。具体流程是：
        *   首先，清空并重新创建名为 `fabric_user.a` 的表，用于存储 webshell 代码片段。
        *   将 webshell 代码分割成 16 字节的小块，并通过 SQL 注入将这些小块逐步写入到 `fabric_user.a` 表的 `a` 列中。
        *   使用 `select ... into outfile` 语句将 `fabric_user.a` 表中的内容写入到 `/migadmin/cgi-bin/x.cgi` 文件，该文件成为 webshell。
        *   类似地，将用于执行 chmod 命令的代码写入到 `/var/log/lib/python3.10/pylab.py` 文件。
        *   通过访问 `/cgi-bin/ml-draw.py` 触发 pylab.py 的执行，进而执行 chmod 命令，为 webshell 赋予执行权限。

3.  **命令执行：**
    *   webshell 部署在 `/migadmin/cgi-bin/x.cgi`。攻击者可以通过修改 `User-Agent` HTTP 头来传递要执行的命令，webshell 会执行该命令并将结果返回。

**有效性评估：**

根据漏洞信息和 POC 代码，该漏洞利用的有效性较高。搜索引擎结果也表明该漏洞已被公开利用，并且存在可用的 exploit 代码。

**投毒风险评估：**

该 POC 代码本身主要包含漏洞利用所需的必要步骤，但仍然存在轻微的投毒风险的可能性，例如：

*   **依赖项风险：** 代码依赖于 `requests` 和 `urllib3` 库。虽然这些库本身是安全的，但如果用户的环境中存在被恶意篡改的同名库，则可能引入安全风险。
*   **后门植入：** 攻击者可能会在 webshell 代码中插入额外的恶意代码，例如反向 shell 或持久化机制。
*   **日志清除失败：** 代码中没有明确的日志清除功能。如果攻击成功，但系统日志中留下了痕迹，可能会暴露攻击行为。
*   **webshell路径存在风险:**webshell 路径是 `/migadmin/cgi-bin/x.cgi` , 如果代码的作者提前在相同路径下放置一个恶意的文件,将会存在风险.该文件会在脚本成功写入webshell文件之前执行

综合考虑，投毒风险大约为 10%。

**项目地址:** [imbas007/POC-CVE-2025-52970](https://github.com/imbas007/POC-CVE-2025-52970)

**漏洞详情:** [CVE-2025-52970](https://nvd.nist.gov/vuln/detail/CVE-2025-52970)