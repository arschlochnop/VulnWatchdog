## CVE-2022-46604 - Responsive FileManager 文件上传绕过导致RCE

**漏洞编号:** CVE-2022-46604

**漏洞类型:** 文件上传绕过

**影响应用:** Responsive FileManager

**危害等级:** 高危，允许未经授权的用户执行任意代码

**影响版本:** <= 9.9.5

**利用条件:** 需要登录后台,但权限较低

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-46604 存在于 Tecrail Responsive FileManager 9.9.5 及更低版本中。攻击者可以绕过文件扩展名检查机制，上传精心制作的 PHP 文件，从而导致任意代码执行。从搜索引擎结果可以看到该漏洞已经被公开披露，并且存在可利用的exp。

**有效性：**
根据提供的漏洞信息和搜索结果，此漏洞是存在的，并且存在公开的利用代码。提供的POC代码是一个Python脚本，它利用了文件创建时的扩展名绕过漏洞，允许攻击者上传包含恶意代码的PHP文件，从而实现远程代码执行（RCE）。脚本通过以下步骤利用漏洞：

1.  获取PHPSESSID：通过访问/filemanager/dialog.php获取有效的PHPSESSID cookie。
2.  构造恶意请求：构造一个包含恶意PHP代码的文件创建请求，其中包含要上传的PHP代码。
3.  上传webshell：利用/filemanager/execute.php?action=create_file接口上传webshell。
4.  执行命令：使用上传的webshell执行任意命令。

**投毒风险：**
此仓库存在一定的投毒风险,根据人工审核代码.发现以下行为值得注意:

1.  代码作者尝试使用 `<?=` 这种短标签,但是注释掉了.攻击者有概率通过修改这个标签植入后门代码。
2.  webshell 上传后的默认路径写死在代码里了，攻击者可能通过修改默认路径躲避检测。
3.  脚本尝试获取PHPSESSID，这是一个正常的行为，但如果攻击者修改了获取PHPSESSID的URL，可能会导致脚本无法正常工作，或者将用户的PHPSESSID发送到攻击者控制的服务器。

综上所述，该仓库存在大约10%的投毒可能性。

**利用方式：**
1.  目标系统运行着存在漏洞版本的 Responsive FileManager。
2.  攻击者需要具有一定的权限才能访问文件上传功能。
3.  攻击者运行提供的 Python 脚本，脚本会自动完成利用过程，上传webshell并执行命令。

**项目地址:** [galoget/ResponsiveFileManager-CVE-2022-46604](https://github.com/galoget/ResponsiveFileManager-CVE-2022-46604)

**漏洞详情:** [CVE-2022-46604](https://nvd.nist.gov/vuln/detail/CVE-2022-46604)