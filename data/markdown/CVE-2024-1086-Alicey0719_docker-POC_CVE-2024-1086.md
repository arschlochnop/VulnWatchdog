## CVE-2024-1086 - Linux Kernel Use-After-Free in nf_tables

**漏洞编号:** CVE-2024-1086

**漏洞类型:** Use-After-Free

**影响应用:** Linux Kernel

**危害等级:** 高危，本地权限提升至 root

**影响版本:** 3.15 到 6.8-rc1 之间的 Linux Kernel 版本

**利用条件:** 本地用户权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-1086 是 Linux 内核 nf_tables 组件中的一个 Use-After-Free 漏洞，攻击者可以利用此漏洞将普通用户权限提升到 root 权限。 

**有效性:** 根据搜索引擎结果和漏洞库信息，此漏洞已经被公开利用，存在可用的PoC。

**投毒风险评估:**

*   **Dockerfile:** 用于构建包含漏洞环境的 Docker 镜像。安装了构建工具和依赖，并从 GitHub 克隆了漏洞利用代码。
*   **README.md:** 提供了漏洞利用的说明和示例，包括如何使用 Docker Compose 启动环境，以及如何执行漏洞利用程序。
*   **compose.yaml:** 定义了 Docker Compose 服务的配置，包括添加 SYS_ADMIN 能力、禁用 seccomp 以及以特权模式运行容器。

这些配置是为了确保漏洞利用程序能够正常运行,提高root权限, 因此不属于恶意投毒代码。

虽然代码库本身是为了利用漏洞，但其中潜藏的风险在于：

1.  **第三方依赖：** Dockerfile 使用了来自 github.com/Notselwyn/CVE-2024-1086 的代码。虽然目前看来是 PoC 代码，但如果作者未来修改仓库，加入恶意代码，使用者在不知情的情况下构建镜像并执行，可能会受到影响。
2.  **滥用权限:**compose.yaml 中的 `privileged: true` ,`cap_add: - SYS_ADMIN`,`security_opt: - seccomp:unconfined` 配置会使容器拥有极高的权限，如果容器被攻破，攻击者可以利用这些权限对宿主机造成更大的危害。

综上，该代码库本身是合法的PoC，用于演示和利用漏洞。但是，潜在的风险在于第三方依赖和滥用权限，因此需要谨慎使用。综合来看，投毒风险较低，大概为10%。

**利用方式：**

1.  **漏洞触发:** `nft_verdict_init()` 函数允许将正值作为 hook verdict 中的 drop error。在 `nf_hook_slow()` 函数中，当使用类似于 `NF_ACCEPT` 的 drop error 发出 `NF_DROP` 时，会导致 double free 漏洞。
2.  **权限提升:** 成功利用此漏洞后，攻击者可以将本地普通用户权限提升为 root 权限。
3.  **PoC 利用:**
    *   构建包含漏洞环境的 Docker 镜像。
    *   进入容器，执行编译好的漏洞利用程序。
    *   漏洞利用程序将触发 Use-After-Free 漏洞，最终获得 root 权限。

**总结:** 该漏洞利用方式通过精心构造的网络数据包，触发内核中的 Use-After-Free 漏洞，从而实现本地权限提升。PoC代码的有效性较高，但使用者应注意潜在的第三方依赖风险和滥用权限带来的安全隐患。

**项目地址:** [Alicey0719/docker-POC_CVE-2024-1086](https://github.com/Alicey0719/docker-POC_CVE-2024-1086)

**漏洞详情:** [CVE-2024-1086](https://nvd.nist.gov/vuln/detail/CVE-2024-1086)