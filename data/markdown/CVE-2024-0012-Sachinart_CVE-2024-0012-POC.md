## CVE-2024-0012 PAN-OS Authentication Bypass

**漏洞编号:** CVE-2024-0012

**漏洞类型:** Authentication Bypass

**影响应用:** PAN-OS

**危害等级:** 高危，允许未授权的攻击者获取管理员权限，执行任意命令，篡改配置。

**影响版本:** 10.2, 11.0, 11.1, and 11.2 (受影响版本详见漏洞库信息)

**利用条件:** 需要网络访问到 PAN-OS 管理 Web 界面，且管理界面可以从互联网或不受信任的网络访问。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2024-0012 是 Palo Alto Networks PAN-OS 软件中的一个身份验证绕过漏洞。未经身份验证的攻击者如果能够访问管理 Web 界面，可以利用此漏洞获得 PAN-OS 管理员权限，执行管理操作，篡改配置，或利用其他经过身份验证的提权漏洞，例如 CVE-2024-9474。

**漏洞利用方式：**

1.  **会话创建：**  攻击者首先发送一个特制的 POST 请求到 `/php/utils/createRemoteAppwebSession.php/watchTowr.js.map` 路径，其中包含一个命令注入payload，这个payload的作用是向`/var/appweb/htdocs/unauth/watchTowr.php`写入系统信息。此请求设置 `X-PAN-AUTHCHECK: off` 头部，绕过身份验证检查。如果成功，服务器会返回一个 PHPSESSID cookie。
2.  **命令执行触发：**  攻击者使用获得的 PHPSESSID cookie 发送一个 GET 请求到 `/index.php/.js.map` 路径，同样设置 `X-PAN-AUTHCHECK: off` 头部。这个请求会触发之前注入的命令的执行。
3.  **执行验证：**  攻击者通过访问 `/unauth/watchTowr.php` 路径来验证命令是否成功执行。如果该文件存在且包含预期的系统信息，则表明漏洞利用成功。

**有效性评估：**

根据漏洞库信息、搜索结果和提供的 POC 代码，该漏洞的利用是有效的。漏洞库中明确指出存在针对该漏洞的威胁活动。POC 代码的实现方式与 WatchTowr Labs 的分析报告相符，进一步证实了其有效性。CISA 将该漏洞添加到了已知被利用的漏洞目录中，表明该漏洞正在被积极利用。

**投毒风险评估：**

该 POC 代码本身旨在利用漏洞，将 `uname -a` 命令的输出写入一个 Web 可访问的文件。虽然此操作本身具有一定的风险，因为它允许未经身份验证的访问者查看系统信息，但该 POC 代码的主要目的是验证漏洞的存在。代码本身较为简短，主要功能集中在利用漏洞上，不包含明显的恶意代码或者后门。投毒风险较低，估计为 1%。如果使用者不仔细审查，直接使用，可能会暴露一些系统信息，但不会直接导致系统被完全控制，因此投毒风险较低。

**缓解措施：**

*   限制管理 Web 界面的访问，仅允许来自受信任的内部 IP 地址的访问。
*   升级到已修复漏洞的 PAN-OS 版本 (10.2.12-h2, PAN-OS 11.0.6-h1, PAN-OS 11.1.5-h1, PAN-OS 11.2.4-h1 或更高版本)。
*   部署威胁防御签名（如果可用）以检测和阻止针对此漏洞的攻击（Threat IDs 95746, 95747, 95752, 95753, 95759, 和 95763）。

**项目地址:** [Sachinart/CVE-2024-0012-POC](https://github.com/Sachinart/CVE-2024-0012-POC)

**漏洞详情:** [CVE-2024-0012](https://nvd.nist.gov/vuln/detail/CVE-2024-0012)