## CVE-2021-23017-Nginx Resolver 内存覆盖

**漏洞编号:** CVE-2021-23017

**漏洞类型:** 内存覆盖

**影响应用:** Nginx

**危害等级:** 中危，可能导致worker进程崩溃或潜在的其他影响。

**影响版本:** Nginx Web Server versions 0.6.18 thru 1.20.0 before 1.20.1, Nginx plus versions R13 thru R23 before R23 P1. Nginx plus version R24 before R24 P1

**利用条件:** Nginx需要配置resolver，并且攻击者能够伪造来自DNS服务器的UDP数据包。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-23017是Nginx resolver中的一个安全问题，允许攻击者通过伪造来自DNS服务器的UDP数据包，造成1字节的内存覆盖，导致worker进程崩溃或者其他潜在影响。

**有效性：**
提供的PoC代码尝试通过发送一个包含超长Host头的HTTP请求来触发该漏洞。如果Nginx配置了resolver并且存在漏洞，超长的Host头可能导致缓冲区溢出，从而触发内存覆盖。
根据搜索引擎结果，存在公开的PoC，表明该漏洞可以被利用。

**投毒风险：**
PoC 代码非常简单，主要功能是发送一个恶意的HTTP请求。README文件也声明这是一个被动的检测工具，不会执行恶意代码。尽管如此，仍然存在很小的投毒风险，例如作者可能在代码中隐藏了某些不易察觉的后门或恶意行为。鉴于代码的简洁性以及安全研究的声明，投毒风险较低，大约为10%。

**利用方式：**
1.  **配置Nginx resolver:**  Nginx需要配置resolver，并且在配置中需要使用到受影响的DNS服务器。
2.  **伪造DNS数据包:**  攻击者需要能够伪造来自DNS服务器的UDP数据包。
3.  **发送恶意Host头:**  攻击者发送一个包含超长Host头的HTTP请求。如果Nginx resolver处理不当，超长的Host头会导致缓冲区溢出，覆盖内存中的某个字节。
4.  **触发崩溃或进一步利用:**  内存覆盖可能导致worker进程崩溃，造成拒绝服务。在某些情况下，攻击者可能能够精心构造数据包，覆盖关键数据，实现更高级的利用，例如代码执行。

根据漏洞信息，利用该漏洞需要满足一定条件，并且只能造成1字节的内存覆盖，因此利用难度较高，影响相对有限。

**项目地址:** [moften/CVE-2021-23017](https://github.com/moften/CVE-2021-23017)

**漏洞详情:** [CVE-2021-23017](https://nvd.nist.gov/vuln/detail/CVE-2021-23017)