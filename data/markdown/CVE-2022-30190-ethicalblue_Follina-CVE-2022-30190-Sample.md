## CVE-2022-30190 - Microsoft MSDT "Follina" RCE

**漏洞编号:** CVE-2022-30190

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Microsoft Windows Support Diagnostic Tool (MSDT)

**危害等级:** 高危，允许攻击者以调用应用程序的权限执行任意代码

**影响版本:** 受影响的多个Windows版本，详见漏洞库信息

**利用条件:** 用户需要打开包含恶意链接或文件的应用程序（例如Word）。攻击通常通过诱骗用户打开恶意文档触发。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-30190，又名"Follina"，是一个存在于Microsoft Windows Support Diagnostic Tool (MSDT) 中的远程代码执行漏洞。该漏洞允许攻击者通过MSDT URL协议，从调用应用程序（如Microsoft Word）执行任意代码。攻击者通常会制作恶意的Word文档或RTF文件，其中包含指向恶意HTML文件的链接。当用户打开文档时，Word会通过MSDT协议加载HTML文件，从而导致恶意代码执行。

**漏洞利用方式：**

1.  **诱骗用户打开恶意文档：** 攻击者通过电子邮件、网络钓鱼或其他方式，诱骗用户打开特制的Word文档或RTF文件。
2.  **文档包含恶意链接：** 该文档包含一个指向远程服务器上托管的恶意HTML文件的链接，通常使用`ms-msdt:/`协议触发。
3.  **利用MSDT执行代码：** 当Word尝试打开链接时，会调用MSDT，并执行HTML文件中嵌入的恶意代码，最终实现远程代码执行。

**POC分析：**

提供的POC代码包含以下文件：

*   `App.xaml` 和 `App.xaml.cs`: 定义WPF应用程序的入口点和资源。
*   `AssemblyInfo.cs`: 包含程序集的元数据，例如主题信息。
*   `FollinaExtractor.cs`:  包含用于从受感染的Word文档（.docx）或RTF文件中提取恶意链接的代码。它解析`word/_rels/document.xml.rels`文件以查找`Target="mhtml:`开头的字符串，或RTF文件寻找恶意链接，从而提取恶意MHTML链接。
*   `Follina_PoC.csproj`:  定义项目设置，例如目标框架和使用的WPF。

此POC代码用于分析和提取Follina漏洞相关的恶意URL，不包含直接执行恶意代码的部分，是一个分析工具。

**投毒风险评估：**

此仓库的主要功能是提取已知的漏洞利用代码。通过检查`FollinaExtractor.cs`，我们可以确定它主要用于读取文件内容并搜索特定的字符串模式。因此，该仓库的作者可以通过隐藏在不太明显的地方的代码（例如，通过引入额外的库或修改现有的解析逻辑），在提取过程中执行一些额外的操作（例如，记录提取的URL，收集系统信息等）。但是，由于其主要功能是分析文件，因此恶意代码的插入点有限。投毒风险较低。
基于漏洞利用代码的分析，我们认为该仓库存在投毒风险的可能性为5%。大部分代码都是标准WPF应用程序结构和字符串解析功能。

**项目地址:** [ethicalblue/Follina-CVE-2022-30190-Sample](https://github.com/ethicalblue/Follina-CVE-2022-30190-Sample)

**漏洞详情:** [CVE-2022-30190](https://nvd.nist.gov/vuln/detail/CVE-2022-30190)