## CVE-2023-27372-SPIP-RCE

**漏洞编号:** CVE-2023-27372

**漏洞类型:** 远程代码执行

**影响应用:** SPIP

**危害等级:** 高危，允许未经身份验证的远程代码执行

**影响版本:** < 4.2.1

**利用条件:** 目标系统运行受影响的SPIP版本，并且可以通过网络访问。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-27372是一个SPIP CMS中的远程代码执行漏洞，存在于4.2.1之前的版本中。该漏洞允许攻击者通过`spip.php?page=spip_pass`页面的password recovery机制，利用`ecrire/inc/filtres.php` 文件中`reset_cache` 函数中的缓存投毒漏洞，将恶意PHP代码注入到`ecrire/data/cache/reset_cache.php`文件中。攻击者可以利用此漏洞上传webshell并执行任意命令。

**漏洞利用方式：**

1.  **获取CSRF令牌：** PoC代码首先尝试获取服务器的Anti-CSRF令牌。
2.  **构造恶意序列化Payload：**  PoC构造一个包含恶意PHP代码的序列化Payload，该Payload会被写入缓存文件。
3.  **发送Payload：** 将构造的Payload通过POST请求发送到`spip.php?page=spip_pass` 页面。
4.  **上传Webshell：**  利用`file_put_contents`函数写入webshell。
5.  **执行命令：** 访问webshell，通过GET参数执行任意系统命令。
6.  **后渗透利用** 脚本尝试通过上传的webshell收集基本系统信息。

**有效性：**

根据漏洞描述和PoC代码，该漏洞利用方式是有效的。搜索引擎结果也表明存在公开可用的PoC。

**投毒风险：**

该PoC脚本主要是利用漏洞上传webshell，初步分析没有明显的投毒代码。 `-d`参数允许自定义webshell内容，存在一定风险，使用该参数务必确保代码安全。  
该仓库代码的投毒风险评估为5%，主要风险存在于自定义webshell代码，作者植入后门的概率较小。

**项目地址:** [1Ronkkeli/spip-cve-2023-27372-rce](https://github.com/1Ronkkeli/spip-cve-2023-27372-rce)

**漏洞详情:** [CVE-2023-27372](https://nvd.nist.gov/vuln/detail/CVE-2023-27372)