## CVE-2024-57394 - Qi-ANXIN Tianqing Endpoint Security Management System 本地提权

**漏洞编号:** CVE-2024-57394

**漏洞类型:** 本地提权

**影响应用:** Qi-ANXIN Tianqing Endpoint Security Management System

**危害等级:** 高危，可导致系统权限被提升到 SYSTEM

**影响版本:** 10.0 (tested on)

**利用条件:** 需要在目标机器上安装 Qi-ANXIN Tianqing Endpoint Security Management System，并具有低权限用户账户

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于奇安信天擎终端安全管理系统。低权限用户可以通过该漏洞将隔离的文件恢复到任意位置，例如 `C:\Windows\System32`。攻击者可以构造一个恶意的DLL文件，将其恢复到 `C:\Windows\System32`，然后利用已知的DLL劫持漏洞（例如通过 StorSvc 的 LPE）将权限提升到 SYSTEM。

**利用方式：**

1.  **构造恶意DLL：** 构造一个恶意的 DLL 文件（例如 `sprintcsp.dll`），该 DLL 文件包含执行恶意命令的代码。
2.  **上传并隔离DLL：** 将恶意 DLL 文件上传到目标机器，确保该文件被天擎终端安全管理系统隔离。
3.  **恢复DLL到System32：** 在天擎终端安全管理系统的客户端中，恢复被隔离的恶意 DLL 文件到 `C:\Windows\System32` 目录。
4.  **利用DLL劫持漏洞：** 创建一个利用 StorSvc 服务中的 DLL 劫持漏洞的程序（例如 `RpcClient.exe`）。该程序会加载位于 `C:\Windows\System32` 的恶意 DLL 文件 (`sprintcsp.dll`)。
5.  **权限提升：** 当 `RpcClient.exe` 运行时，它会加载恶意 DLL 文件，从而以 SYSTEM 权限执行恶意代码。

**投毒风险分析：**
POC 代码主要包含恢复文件到特定目录和进行dll劫持，本身不包含明显的后门代码。但是，恶意 DLL 的内容是未知的，存在被植入后门的可能，或者利用 StorSvc 本身被作为后门。因此有一定比例的投毒风险。主要风险在于用户使用该 POC 时，未经验证地直接使用了POC中提供的恶意DLL。

**搜索引擎信息补充：**
搜索引擎中没有直接关于 CVE-2024-57394 的信息，但提供了其他 CVE 的信息。 CVE-2024-57395 涉及到密码漏洞，但和本次分析的 CVE 无关。 这些搜索信息和本漏洞分析相关性不大。

**项目地址:** [cwjchoi01/CVE-2024-57394](https://github.com/cwjchoi01/CVE-2024-57394)

**漏洞详情:** [CVE-2024-57394](https://nvd.nist.gov/vuln/detail/CVE-2024-57394)