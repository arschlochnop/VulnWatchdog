## CVE-2022-34155 - miniOrange OAuth Single Sign-On Plugin Authentication Bypass

**漏洞编号:** CVE-2022-34155

**漏洞类型:** Authentication Bypass

**影响应用:** miniOrange OAuth Single Sign On – SSO (OAuth Client) plugin

**危害等级:** 高危，可导致未经授权的管理员访问和潜在的远程代码执行

**影响版本:** <= 6.23.3

**利用条件:** 需要用户安装存在漏洞的miniOrange OAuth Single Sign-On插件

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-34155存在于miniOrange OAuth Single Sign-On WordPress插件中，允许低权限用户绕过身份验证。PoC代码展示了如何通过配置恶意的OAuth provider，并利用插件对OAuth provider返回信息的信任，伪造管理员身份登录。漏洞利用过程包括：

1.  部署一个恶意的OAuth服务器，该服务器可以返回包含任意用户信息的JSON响应。
2.  通过`save_app`和`test_finish` AJAX请求，在插件中配置该恶意OAuth服务器。
3.  当用户使用“Login with OAuth Provider”登录时，插件将从恶意服务器获取用户信息，并根据返回的`user_login`或`email`进行用户映射。
4.  由于恶意服务器返回的是管理员的用户名或电子邮件，攻击者可以未经授权地登录管理员帐户。

该漏洞的根源在于插件对`mo_oauth_ajax` AJAX handler缺少严格的权限控制和nonce验证，以及对OAuth资源端点返回的JSON数据的信任。建议更新插件到最新版本（>= 6.23.4）以修复此漏洞。

**投毒风险分析：**
虽然提供的PoC代码主要集中在利用漏洞进行身份验证绕过，但存在一些小的投毒风险。恶意攻击者可能会在搭建OAuth服务器或者在提交的ajax请求中，插入恶意代码，例如用于收集用户信息的脚本或者重定向到恶意网站的链接。尽管这种风险较低（约5%），但仍然值得注意，特别是在使用未经充分审查的第三方PoC代码时。 风险主要来源于攻击者可以控制OAuth服务器的返回内容，从而间接影响用户。


**项目地址:** [vanh-88/CVE-2022-34155](https://github.com/vanh-88/CVE-2022-34155)

**漏洞详情:** [CVE-2022-34155](https://nvd.nist.gov/vuln/detail/CVE-2022-34155)