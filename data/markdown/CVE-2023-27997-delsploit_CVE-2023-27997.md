## CVE-2023-27997-FortiOS-SSL-VPN堆溢出

**漏洞编号:** CVE-2023-27997

**漏洞类型:** 堆溢出

**影响应用:** FortiOS 和 FortiProxy

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 受影响版本包括 FortiOS 7.2.4 及以下，7.0.11 及以下，6.4.12 及以下，6.0.16 及以下，FortiProxy 7.2.3 及以下，7.0.9 及以下，2.0.12 及以下，1.2 所有版本，1.1 所有版本。

**利用条件:** 需要目标系统开启SSL-VPN服务，并且攻击者能够通过网络访问该服务。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-27997 是 FortiOS 和 FortiProxy SSL-VPN 中的一个堆溢出漏洞。远程攻击者可以通过构造特制的请求利用此漏洞执行任意代码或命令。

**有效性评估：**

根据漏洞库信息和搜索结果，此漏洞是真实存在的，并且已经被积极利用。漏洞利用代码仓库提供了一个可行的 PoC，表明该漏洞可以被成功利用。

**投毒风险分析：**

分析提供的PoC代码，初步判断投毒风险较低，大概在10%。

*   **`calc_hashes.py`**: 此脚本用于预计算一些哈希值，以便在漏洞利用过程中使用。没有发现任何可疑代码。
*   **`exploit.py`**: 此脚本是实际的漏洞利用程序。它首先生成 shellcode，然后通过堆喷射技术将 shellcode 注入到目标进程的内存中。最后，它触发漏洞，覆盖返回地址，并将执行流程重定向到 shellcode。可能存在的投毒风险在于shellcode本身，shellcode复用已有的代码，相对安全，但仍然有风险.

**漏洞利用方式：**

1.  **目标确定：** 攻击者首先需要确定目标 FortiOS 或 FortiProxy 设备，并确认其运行着受影响的版本。
2.  **哈希预计算：** 使用 `calc_hashes.py` 预计算一些哈希值。 这些哈希值用于绕过一些安全检查。
3.  **Shellcode 生成：** 生成用于反弹 shell 的 shellcode。 PoC 中使用了 `shellcode.py` 模块 (未提供全部内容)， 用于生成反向shell的shellcode,将目标设备连接到攻击者的机器。
4.  **堆喷射：** 通过建立大量SSL连接, 在堆上喷射数据, 增加shellcode执行的概率
5.  **漏洞触发：**  发送特制的 SSL-VPN 请求，触发堆溢出漏洞，覆盖返回地址。
6.  **代码执行：** 控制程序执行流程，跳转到 shellcode，从而在目标设备上执行任意代码。
7.  **反向 Shell：** Shellcode 运行后，与攻击者控制的服务器建立反向 shell 连接，从而允许攻击者远程控制目标设备。

总而言之，该漏洞是一个高危漏洞，利用难度相对较低，且存在公开可用的 PoC 代码。强烈建议受影响的用户尽快升级到安全版本。

**项目地址:** [delsploit/CVE-2023-27997](https://github.com/delsploit/CVE-2023-27997)

**漏洞详情:** [CVE-2023-27997](https://nvd.nist.gov/vuln/detail/CVE-2023-27997)