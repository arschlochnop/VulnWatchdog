## CVE-2025-22131-PhpSpreadsheet-XSS

**漏洞编号:** CVE-2025-22131

**漏洞类型:** 跨站脚本 (XSS)

**影响应用:** PhpSpreadsheet

**危害等级:** 中危，可能导致用户信息泄露和恶意脚本执行

**影响版本:** < 1.29.8, >= 2.0.0 and < 2.1.7, >= 2.2.0 and < 2.3.6, >= 3.0.0 and < 3.8.0

**利用条件:** 需要用户打开包含恶意XLSX文件的网页

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

该漏洞存在于 PhpSpreadsheet 的 `generateNavigation()` 函数中，当将 XLSX 文件转换为 HTML 表示并在响应中显示时，由于未正确转义用户输入，导致 XSS 漏洞。攻击者可以通过构造恶意的 XLSX 文件，在 `xl/workbook.xml` 文件的 `Sheet2` 标签中插入恶意 JavaScript 代码。当用户打开由存在漏洞的 PhpSpreadsheet 版本处理的恶意 XLSX 文件时，恶意脚本将在用户的浏览器中执行，从而可能导致会话劫持、cookie 窃取或页面重定向等攻击。

**有效性分析：**
提供的 PoC 代码通过修改 `xl/workbook.xml` 文件中的 `Sheet2` 标签，将 HTML 转义后的恶意 JavaScript 代码嵌入到 XLSX 文件中。利用方式是替换固定的字符串`Sheet2`为恶意代码，从而在HTML输出中触发XSS。根据漏洞信息和搜索结果，这种方法是有效的。PoC代码完整可运行，可以生成包含恶意payload的xlsx文件。

**投毒风险分析：**
PoC 代码本身功能明确，主要由一个 Python 脚本 `generate.py` 构成，用于生成包含 XSS payload 的 XLSX 文件。 代码中没有发现任何尝试连接外部服务器、执行恶意命令或修改系统文件的行为。脚本的功能仅限于读取 sample.xlsx 文件，修改其中的内容，并生成 exploit.xlsx 文件。该PoC的目的是进行演示和测试，目前没发现隐藏的投毒代码。因此，投毒风险较低，判定投毒代码风险为0%。

**利用方式总结：**
1.  攻击者构造包含恶意 JavaScript 代码的 XLSX 文件。
2.  攻击者将恶意 XLSX 文件发送给受害者。
3.  受害者使用存在漏洞的 PhpSpreadsheet 版本打开该文件。
4.  PhpSpreadsheet 将 XLSX 文件转换为 HTML 页面，由于未正确转义，恶意 JavaScript 代码被插入到 HTML 页面中。
5.  受害者的浏览器执行恶意 JavaScript 代码，导致 XSS 攻击。

**修复建议：**
升级 PhpSpreadsheet 到不受影响的版本，例如 >= 1.29.8, >= 2.1.7, >= 2.3.6, >= 3.8.0，或使用输入验证和输出编码来防止 XSS 攻击。

**项目地址:** [s0ck37/CVE-2025-22131-POC](https://github.com/s0ck37/CVE-2025-22131-POC)

**漏洞详情:** [CVE-2025-22131](https://nvd.nist.gov/vuln/detail/CVE-2025-22131)