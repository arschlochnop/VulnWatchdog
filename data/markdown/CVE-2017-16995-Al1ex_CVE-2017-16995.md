## CVE-2017-16995-Linux Kernel-BPF权限提升

**漏洞编号:** CVE-2017-16995

**漏洞类型:** 本地权限提升

**影响应用:** Linux Kernel

**危害等级:** 高危，允许低权限用户获得root权限

**影响版本:** <= 4.4

**利用条件:** 本地用户访问，需要开启BPF syscall (CONFIG_BPF_SYSCALL)

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2017-16995 存在于Linux内核的BPF验证器模块中。`check_alu_op` 函数在 `kernel/bpf/verifier.c` 中存在不正确的符号扩展，允许本地用户通过构造恶意的BPF程序，使eBPF验证器模块产生计算错误，导致任意内存读写问题，从而实现本地权限提升。

**有效性:**
根据漏洞库信息、搜索引擎结果(如Exploit-DB链接)和提供的POC代码，此漏洞利用是有效的。 POC 代码 `exploit.c` 旨在通过利用 eBPF 验证器中的缺陷来提升权限。 `README.md` 中包含 Ubuntu 16.04 上的漏洞利用演示，以及成功获得 root 权限的输出。

**投毒风险:**
分析提供的 `exploit.c` 代码，没有发现明显的恶意代码或者后门代码，主要功能是利用BPF漏洞进行提权。不过依然存在一定投毒风险，例如：
1.  **依赖特定内核版本/配置：** 该漏洞利用程序可能依赖于特定版本的内核以及编译配置。如果目标环境不满足这些条件，利用程序可能会失败，甚至导致系统崩溃，攻击者可以伪造成功率很高。
2.  **修改关键系统文件：** 提权过程中，可能会修改 `/etc/passwd`、`/etc/shadow` 等关键系统文件，如果操作不当，可能导致系统不稳定甚至无法启动。虽然目的是提权，但潜在风险存在。
3.  **隐蔽性不足：** 简单的提权脚本容易被安全软件检测到，攻击者可能会添加一些混淆或者反检测手段，但这些手段本身也可能被安全研究人员识别为恶意行为。
4.  **信息收集：** 漏洞利用程序可能包含信息收集代码，用于收集目标系统的敏感信息，例如内核版本、硬件配置、用户列表等。这些信息可能会被用于后续的攻击。

基于以上分析，判定投毒风险为5%。

**利用方式:**
1.  编译 `exploit.c`：`gcc exploit.c -o exploit`
2.  运行编译后的可执行文件：`./exploit`
3.  如果漏洞利用成功，将会获得一个 root shell。

**缓解措施:**
1.  禁用非特权 BPF：`echo 1 > /proc/sys/kernel/unprivileged_bpf_disabled`
2.  升级内核版本到修复此漏洞的版本。
3.  应用代码补丁。

**项目地址:** [Al1ex/CVE-2017-16995](https://github.com/Al1ex/CVE-2017-16995)

**漏洞详情:** [CVE-2017-16995](https://nvd.nist.gov/vuln/detail/CVE-2017-16995)