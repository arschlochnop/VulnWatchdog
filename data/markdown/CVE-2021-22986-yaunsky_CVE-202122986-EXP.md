## CVE-2021-22986-F5 BIG-IP iControl REST 远程命令执行

**漏洞编号:** CVE-2021-22986

**漏洞类型:** 远程命令执行

**影响应用:** F5 BIG-IP / BIG-IQ

**危害等级:** 高危，未经身份验证的远程命令执行

**影响版本:** BIG-IP 16.0.x before 16.0.1.1, 15.1.x before 15.1.2.1, 14.1.x before 14.1.4, 13.1.x before 13.1.3.6, 12.1.x before 12.1.5.3; BIG-IQ 7.1.0.x before 7.1.0.3, 7.0.0.x before 7.0.0.2

**利用条件:** 目标系统存在漏洞版本，且iControl REST接口对外开放。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-22986是F5 BIG-IP和BIG-IQ设备中iControl REST接口存在的一个未经身份验证的远程命令执行漏洞。攻击者可以通过发送特制的HTTP请求到/mgmt/tm/util/bash端点来执行任意命令。

**有效性：**

根据漏洞库信息、搜索引擎结果以及提供的漏洞利用代码，可以判断该漏洞利用代码是有效的。搜索引擎结果显示，该漏洞在野外被积极利用，并且存在公开的PoC代码。提供的Python脚本`CVE202122986.py`实现了该漏洞的利用，通过向目标URL的`/mgmt/tm/util/bash`端点发送包含恶意命令的POST请求，从而实现远程命令执行。

**投毒风险：**

经过对提供的Python脚本`CVE202122986.py`的分析，发现以下几点可能存在的风险：

1.  **硬编码的认证信息：** 脚本中使用了硬编码的`Authorization: Basic YWRtaW46QVNhc1M=`头，虽然是默认的用户名密码，但如果被恶意修改，可能会导致利用失败，或者留下后门。
2.  **命令执行方式：** 脚本使用了`base64`编码来绕过某些检测，虽然增加了命令执行的灵活性，但也可能被用于执行更复杂的恶意命令。
3.  **错误处理：** 脚本中的错误处理比较简单，可能会在出现异常时直接退出，无法进行更深入的利用。

综合评估，该脚本本身存在一定的风险，例如使用硬编码的认证信息，以及潜在的命令执行风险。考虑到脚本的目的是执行任意命令，所以将payload隐藏在命令中具有一定的隐蔽性。因此，存在投毒风险的可能性较高，大约为10%。

**利用方式：**

1.  **发送POST请求：** 攻击者构造一个恶意的POST请求，目标URL为存在漏洞的F5 BIG-IP或BIG-IQ设备的`/mgmt/tm/util/bash`端点。
2.  **设置请求头：** 设置必要的请求头，包括`Authorization`（包含Base64编码的用户名密码），`X-F5-Auth-Token`（可能为空），以及`Content-Type: application/json`。
3.  **构造JSON数据：** 在POST请求的body中，构造一个JSON数据，包含`command`和`utilCmdArgs`字段。`command`字段设置为`run`，`utilCmdArgs`字段包含要执行的命令，例如`'-c id'`。
4.  **发送请求并执行命令：** 将构造好的POST请求发送到目标URL，目标设备将执行`utilCmdArgs`中指定的命令，并将结果返回在响应的`commandResult`字段中。
5.  **命令执行：** 使用`-c`参数执行单条命令，或者利用`base64`编码执行更复杂的命令，例如反弹shell等。


**项目地址:** [yaunsky/CVE-202122986-EXP](https://github.com/yaunsky/CVE-202122986-EXP)

**漏洞详情:** [CVE-2021-22986](https://nvd.nist.gov/vuln/detail/CVE-2021-22986)