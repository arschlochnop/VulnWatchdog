## CVE-2024-43425-Moodle-远程代码执行

**漏洞编号:** CVE-2024-43425

**漏洞类型:** 远程代码执行

**影响应用:** Moodle

**危害等级:** 高危，可能导致服务器完全控制，数据泄露，安装勒索软件等

**影响版本:** 4.1.x (< 4.1.12), 4.2.x (< 4.2.9), 4.3.x (< 4.3.6), 4.4.x (< 4.4.2)

**利用条件:** 需要能够添加/更新问题（calculated question types），默认情况下未经身份验证的攻击者利用难度较高，但如果允许匿名用户创建包含恶意代码的问题，则可能被远程利用。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-43425 是 Moodle 中计算问题类型中的一个远程代码执行漏洞。攻击者可以通过在计算问题中插入恶意代码来利用此漏洞，从而在服务器上执行任意代码。

**有效性：**
提供的 POC 代码通过 `validation.php` 和 `validation-fixed.php` 演示了漏洞的存在。`validation.php` 文件使用了存在漏洞的验证逻辑，可以执行 PHP 代码，而 `validation-fixed.php` 文件则修复了此漏洞，会返回错误信息。

**投毒风险：**
尽管该仓库主要是为了测试输入验证逻辑，并提供了修复后的验证代码，但仍然存在一定的投毒风险。`xor-generator.py` 脚本虽然本身用于生成函数名称的混淆表达式，但如果攻击者修改该脚本生成包含恶意代码的表达式，则可能被用于恶意目的。总体来看，投毒风险较低，约为10%。主要的风险在于用户可能不理解这些脚本的含义，直接使用。

**利用方式：**
1.  攻击者需要具有添加或更新“计算问题”的权限。在某些配置下，未授权用户可能具备此权限。
2.  攻击者构造包含恶意 PHP 代码的表达式，例如 `(1)->{phpinfo()}` 或使用 `xor-generator.py` 生成的混淆表达式。
3.  将此恶意表达式插入到“计算问题”的公式或答案字段中。
4.  当 Moodle 处理该“计算问题”时，由于存在漏洞的验证逻辑，恶意 PHP 代码将被执行，导致远程代码执行。

**项目地址:** [RedTeamPentesting/moodle-rce-calculatedquestions](https://github.com/RedTeamPentesting/moodle-rce-calculatedquestions)

**漏洞详情:** [CVE-2024-43425](https://nvd.nist.gov/vuln/detail/CVE-2024-43425)