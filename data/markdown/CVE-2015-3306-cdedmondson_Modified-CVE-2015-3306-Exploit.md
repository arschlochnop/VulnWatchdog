## CVE-2015-3306 ProFTPD mod_copy 任意文件读写漏洞

**漏洞编号:** CVE-2015-3306

**漏洞类型:** 任意文件读写

**影响应用:** ProFTPD

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 1.3.5

**利用条件:** 目标服务器运行ProFTPD 1.3.5，且开启mod_copy模块

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于ProFTPD 1.3.5的mod_copy模块中，允许未经授权的远程攻击者使用`SITE CPFR`和`SITE CPTO`命令读取和写入任意文件。通过覆盖或修改服务器上的配置文件或上传恶意脚本，攻击者可以实现远程代码执行。

**有效性分析：**

根据漏洞库信息、搜索结果以及提供的漏洞利用代码，可以判断该漏洞利用的有效性较高。存在多个公开的PoC代码和Metasploit模块，证明该漏洞可被利用。

**投毒风险分析：**

分析提供的PoC代码：

*   `modified_cve_2015_3306.py`: 此脚本利用CVE-2015-3306漏洞，通过`SITE CPFR`和`SITE CPTO`命令将包含PHP代码的字符串写入目标服务器的`/tmp`目录，然后将其复制到Web目录下的`backdoor.php`文件中。修改后的脚本增加了从远程服务器下载shell的功能。
*   `README.md`: 描述了如何使用该脚本。要求用户创建一个PHP反向Shell，并通过HTTP服务器托管。然后，该脚本使用漏洞将这个shell下载到目标服务器上。

**潜在的投毒风险：**

虽然脚本本身是为了利用漏洞，但存在以下潜在的投毒风险：

1.  **反向Shell托管服务器：** 攻击者可能会诱导用户使用恶意的PHP反向Shell，从而在用户不知情的情况下控制目标服务器。用户需要自行生成php reverse shell, 并且在本地启动一个http服务来提供下载，此步骤存在一定风险, 如果下载的shell是恶意代码，则可以控制受害者主机。
2.  **依赖外部资源：** 脚本依赖于外部的PHP反向Shell文件和HTTP服务器。如果这些资源被篡改，可能会导致意外的行为或安全问题。

总体来说，投毒风险主要集中在用户自定义的PHP反向Shell脚本本身。虽然脚本作者可能没有直接植入恶意代码，但是脚本利用了外部资源，增加了潜在风险。

**利用方式：**

1.  **漏洞利用：** 使用`SITE CPFR`和`SITE CPTO`命令，将恶意PHP代码写入目标服务器的Web目录下。
2.  **后门植入：** 在Web目录下创建一个PHP后门文件（例如`backdoor.php`），允许攻击者执行任意命令。
3.  **远程代码执行：** 通过访问后门文件，并传递`cmd`参数，执行任意系统命令。
4.  **反向Shell：** 通过`wget`或者`curl`下载并执行反向shell, 从而控制目标主机。

**安全建议：**

*   升级ProFTPD到不受漏洞影响的版本。
*   禁用或限制mod_copy模块的使用。
*   对Web目录进行严格的权限控制，防止未经授权的文件写入。
*   使用安全扫描工具检测Web目录下的恶意文件。

**项目地址:** [cdedmondson/Modified-CVE-2015-3306-Exploit](https://github.com/cdedmondson/Modified-CVE-2015-3306-Exploit)

**漏洞详情:** [CVE-2015-3306](https://nvd.nist.gov/vuln/detail/CVE-2015-3306)