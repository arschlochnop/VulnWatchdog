## CVE-2024-2961-glibc-iconv缓冲区溢出

**漏洞编号:** CVE-2024-2961

**漏洞类型:** 缓冲区溢出

**影响应用:** glibc

**危害等级:** 高危，可能导致程序崩溃或覆盖相邻变量，甚至远程代码执行（根据搜索结果）

**影响版本:** < 2.40

**利用条件:** 需要使用iconv()函数进行字符集转换，且目标系统glibc版本低于2.40，字符集为ISO-2022-CN-EXT

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-2961 漏洞是 glibc 中 iconv() 函数在处理 ISO-2022-CN-EXT 字符集转换时存在的缓冲区溢出漏洞。具体来说，当 iconv() 将字符串转换为 ISO-2022-CN-EXT 字符集时，可能会溢出输出缓冲区最多 4 个字节。这可能导致应用程序崩溃或覆盖相邻变量。搜索结果表明该漏洞可能被利用于远程代码执行。

**漏洞利用方式：**

1.  **触发条件：**  利用iconv函数进行字符集转换，源字符集未知，目标字符集需要指定为ISO-2022-CN-EXT，且glibc版本低于2.40。
2.  **溢出：**  构造特定的输入字符串，当 iconv() 函数尝试将其转换为 ISO-2022-CN-EXT 时，导致输出缓冲区溢出 4 个字节。
3.  **利用：**  通过控制溢出的内容，可以覆盖相邻的变量，或者改变程序的执行流程，最终达到远程代码执行的目的。

**POC 代码分析：**

*   `iconvfix.sh` 脚本首先从 sansec.io 下载 `cve-2024-2961.c` 文件，然后编译并运行它。`cve-2024-2961.c` 应该是一个用于检测系统是否受 CVE-2024-2961 漏洞影响的程序。
*   如果检测到系统是易受攻击的，脚本会备份 `/usr/lib64/gconv/gconv-modules` 文件，然后注释掉该文件中与 ISO-2022-CN-EXT 相关的行。这样做可以禁用 ISO-2022-CN-EXT 字符集，从而缓解该漏洞。
*   `iconvconfig` 命令用于重建 iconv 的配置缓存。
*   脚本会再次运行漏洞检测程序，以确认补丁是否成功应用。

**有效性：**

提供的 `iconvfix.sh` 脚本通过注释掉 `/usr/lib64/gconv/gconv-modules` 文件中与 `ISO-2022-CN-EXT` 相关的行来缓解漏洞。这种方法能够阻止程序使用有漏洞的字符集转换，从而达到修复漏洞的效果。脚本的有效性依赖于系统是CentOS 7。

**投毒风险分析：**

*   脚本的主要操作是下载并执行来自 `sansec.io` 的代码。这意味着脚本的安全性取决于 `sansec.io` 的可信度。如果 `sansec.io` 被攻破或者提供恶意代码，那么执行该脚本的系统也会受到威胁。 *   脚本会修改 `/usr/lib64/gconv/gconv-modules` 文件，如果修改过程出现错误，可能会导致字符集转换出现问题。 *   尽管如此，代码本身没有明显的恶意行为，脚本意图在于修补漏洞，而非植入后门。投毒风险主要在于外部依赖 `sansec.io`，因此投毒风险相对较低。

**风险比例：** 下载外部脚本存在潜在风险，但是该脚本的内容更多的是修复行为，所以判断投毒风险为10%。

**项目地址:** [absolutedesignltd/iconvfix](https://github.com/absolutedesignltd/iconvfix)

**漏洞详情:** [CVE-2024-2961](https://nvd.nist.gov/vuln/detail/CVE-2024-2961)