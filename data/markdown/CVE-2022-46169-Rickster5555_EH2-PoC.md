## CVE-2022-46169-Cacti-命令注入

**漏洞编号:** CVE-2022-46169

**漏洞类型:** 命令注入

**影响应用:** Cacti

**危害等级:** 高危，允许未授权用户执行任意命令

**影响版本:** < 1.2.23

**利用条件:** 目标系统运行受影响版本的Cacti，且存在具有`POLLER_ACTION_SCRIPT_PHP`动作类型的poller_item。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-46169是Cacti中存在的一个命令注入漏洞，允许未经身份验证的攻击者在服务器上执行任意命令。漏洞存在于`remote_agent.php`文件中，由于对客户端IP地址的验证不严谨，攻击者可以通过设置`X-Forwarded-For`等HTTP头部绕过身份验证。绕过验证后，可以调用`polldata`动作，并利用`poller_id`参数的命令注入漏洞执行系统命令。

**利用方式：**

1.  攻击者发送带有恶意`X-Forwarded-For`头部的HTTP请求到`remote_agent.php`，伪造客户端IP地址，绕过身份验证。
2.  攻击者构造包含命令注入的`poller_id`参数的HTTP请求，发送到`remote_agent.php`，执行任意系统命令。 为了成功利用，必须存在一个`poller_item`，其`action`类型为`POLLER_ACTION_SCRIPT_PHP`（值为2）。

**POC有效性：**

提供的PoC代码通过发送带有特定HTTP头部的GET请求，利用`poller_id`参数执行命令注入。根据漏洞描述和PoC代码，该PoC是有效的，可以用于验证漏洞的存在。

**投毒风险：**

查看提供的文件，包括`README.md`、`cacti-CI-poc.py`、`docker-compose.yml`和`entrypoint.sh`。

*   `README.md`：包含漏洞描述、复现步骤和参考链接，没有发现恶意代码。
*   `cacti-CI-poc.py`：PoC脚本，用于发送HTTP请求触发命令注入，没有发现恶意代码，但利用时执行的命令完全由使用者控制，具有潜在风险。
*   `docker-compose.yml`：Docker Compose配置文件，用于构建包含漏洞版本的Cacti环境，没有发现恶意配置。
*   `entrypoint.sh`：Docker容器的入口脚本，用于初始化Cacti数据库和设置权限，没有发现明显的恶意代码，但其中`mysql --host=db --user=root --password=root cacti -e "UPDATE user_auth SET must_change_password='' WHERE username = 'admin'"`语句禁用了管理员密码强制修改，这可能会降低安全性。

总体来说，该仓库的投毒风险较低，但入口脚本中禁用了管理员密码强制修改，存在潜在的安全风险。

投毒风险评估：5%。

**项目地址:** [Rickster5555/EH2-PoC](https://github.com/Rickster5555/EH2-PoC)

**漏洞详情:** [CVE-2022-46169](https://nvd.nist.gov/vuln/detail/CVE-2022-46169)