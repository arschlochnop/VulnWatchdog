## CVE-2022-29464-WSO2-Unrestricted File Upload

**漏洞编号:** CVE-2022-29464

**漏洞类型:** 未限制文件上传

**影响应用:** WSO2 API Manager, WSO2 Identity Server, WSO2 Enterprise Integrator, WSO2 Open Banking AM/KM

**危害等级:** 高危，可导致远程代码执行

**影响版本:** WSO2 API Manager 2.2.0 up to 4.0.0, WSO2 Identity Server 5.2.0 up to 5.11.0, WSO2 Identity Server Analytics 5.4.0, 5.4.1, 5.5.0 and 5.6.0, WSO2 Identity Server as Key Manager 5.3.0 up to 5.11.0, WSO2 Enterprise Integrator 6.2.0 up to 6.6.0, WSO2 Open Banking AM 1.4.0 up to 2.0.0 and WSO2 Open Banking KM 1.4.0, up to 2.0.0

**利用条件:** 需要能够访问 /fileupload 接口

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-29464 是 WSO2 产品中的一个未限制文件上传漏洞，允许未经身份验证的攻击者上传任意文件，从而导致远程代码执行。攻击者利用 `/fileupload` 接口，通过构造包含目录遍历序列 `../../../../` 的 `Content-Disposition` 头，将恶意文件（如 JSP webshell）上传到 Web 根目录下的 `repository/deployment/server/webapps` 目录。成功上传后，攻击者可以通过访问该恶意文件来执行任意代码。根据提供的POC代码，`exploit.py` 脚本首先创建一个包含恶意代码的 `cmd.jsp` 文件，然后使用 `requests` 库向目标 WSO2 服务器的 `/fileupload/toolsAny` 接口发送 POST 请求，上传该文件。如果上传成功，则会在目标服务器的 `user-portal` 目录下创建一个可执行命令的webshell `cmd.jsp`，攻击者可以通过访问 `user-portal/cmd.jsp?cmd=<command>` 来执行任意命令。根据搜索引擎结果，此漏洞已被积极利用，建议尽快修复。POC代码中未发现明显的投毒迹象，其功能明确为上传webshell并执行命令。因此，投毒风险为 0%。

**项目地址:** [mr-r3bot/WSO2-CVE-2022-29464](https://github.com/mr-r3bot/WSO2-CVE-2022-29464)

**漏洞详情:** [CVE-2022-29464](https://nvd.nist.gov/vuln/detail/CVE-2022-29464)