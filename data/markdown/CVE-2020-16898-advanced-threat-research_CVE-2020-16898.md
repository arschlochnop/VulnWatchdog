## CVE-2020-16898: Windows TCP/IP 远程代码执行漏洞 ("Bad Neighbor")

**漏洞编号:** CVE-2020-16898

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Windows TCP/IP Stack

**危害等级:** 高危，可能导致远程代码执行、拒绝服务

**影响版本:** Windows 10 Version 1709, 1803, 1809, 1903, 1909, 2004; Windows Server 2019, version 1903, version 2004

**利用条件:** 攻击者需要与目标系统处于同一网络邻接，发送特制的 ICMPv6 路由器通告数据包

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2020-16898 "Bad Neighbor" 漏洞存在于 Windows TCP/IP 堆栈中，当其不正确地处理 ICMPv6 路由器通告数据包时，可能导致远程代码执行。攻击者可以通过发送特制的 ICMPv6 数据包利用此漏洞。

**有效性：**
提供的 POC 代码（Suricata 规则和 Lua 脚本）旨在检测利用 CVE-2020-16898 的攻击，而非直接利用该漏洞。它通过检查 ICMPv6 路由器通告数据包中的 RDNSS 选项长度是否为偶数来识别潜在的攻击行为。根据漏洞描述，偶数长度的 RDNSS 选项是非法的，可能触发漏洞。搜索引擎结果显示该漏洞存在PoC，可导致蓝屏死机（BSOD），因此可以判断存在有效的利用方式。

**投毒风险：**
该仓库主要提供的是检测规则和相关的lua脚本，用于检测尝试利用漏洞的流量。Lua 脚本的功能是解析 ICMPv6 数据包并检查 RDNSS 选项的长度。代码逻辑相对简单，没有发现明显的恶意行为或后门。但是，任何代码都存在被恶意修改的风险，尽管此仓库中直接植入恶意代码的可能性较低。可以判定存在极低的投毒风险。

**利用方式：**
1.  攻击者需要与目标 Windows 系统处于同一网络邻接（因为 ICMPv6 邻居发现协议在本地链路操作）。
2.  攻击者发送特制的 ICMPv6 路由器通告数据包。
3.  此数据包包含一个 RDNSS 选项（类型 25），其长度字段被设置为偶数。这违反了 RFC 规定。
4.  Windows TCP/IP 堆栈在处理此非法 RDNSS 选项时，由于不正确的边界检查或缓冲区溢出，导致崩溃或执行任意代码。利用的根本原因是由于ICMPv6 Router Advertisement报文处理不当，Option Type 25长度校验存在缺陷。
5.  如果攻击成功，攻击者可以在目标系统上执行任意代码，或者造成拒绝服务（BSOD）。

**项目地址:** [advanced-threat-research/CVE-2020-16898](https://github.com/advanced-threat-research/CVE-2020-16898)

**漏洞详情:** [CVE-2020-16898](https://nvd.nist.gov/vuln/detail/CVE-2020-16898)