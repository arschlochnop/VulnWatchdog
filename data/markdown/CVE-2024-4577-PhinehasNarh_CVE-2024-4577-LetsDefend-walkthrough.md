## CVE-2024-4577 PHP-CGI 参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，允许未经身份验证的攻击者在受影响的 PHP 服务器上执行任意代码。

**影响版本:** PHP 8.1.* < 8.1.29, 8.2.* < 8.2.20, 8.3.* < 8.3.8

**利用条件:** Windows 系统，运行于 CGI 模式下的 PHP，且系统启用了使用 "Best Fit" 策略的代码页。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-4577 漏洞是 PHP 在 Windows 系统以 CGI 模式运行时，由于系统代码页的 "Best Fit" 行为导致参数注入的远程代码执行漏洞。攻击者可以通过构造恶意的 HTTP 请求，将恶意参数传递给 PHP 解释器，从而执行任意代码。

**有效性评估：**

根据提供的漏洞库信息、搜索引擎结果和漏洞利用代码，该漏洞的有效性很高。漏洞库明确指出该漏洞的存在，并提供了受影响的版本范围。搜索引擎结果显示，该漏洞在野外已存在利用，且有公开的 PoC 代码可供验证。漏洞利用代码（Incident Response Walkthrough）提供了一个应对 CVE-2024-4577 攻击的案例分析，虽未直接提供 PoC 代码，但分析过程表明了该漏洞可被利用，并附带了模拟攻击场景。

**投毒风险分析：**

提供的漏洞利用代码主要是一个事件响应的演练文档，用于分析和缓解 CVE-2024-4577 漏洞。它主要关注识别漏洞、分析攻击者行为以及确定受影响的系统。虽然该文档提到了攻击者可能执行的命令（whoami.exe、calc.exe），但它本身并不包含任何恶意代码。因此，可以认为此仓库中作者隐藏的投毒代码的可能性较低，约为 5%。 这 5% 的可能性是基于对任何代码库都不能完全排除潜在风险的一般安全考虑。

**利用方式分析：**

1.  **环境要求：** 目标系统必须是 Windows，PHP 运行于 CGI 模式，并且启用了使用 "Best Fit" 策略的代码页。
2.  **漏洞触发：** 攻击者发送包含恶意构造参数的 HTTP 请求。这些参数会被 Windows 的 "Best Fit" 代码页转换机制错误地解释为 PHP 选项。
3.  **代码执行：** PHP 解释器执行被注入的恶意选项，导致任意代码执行。

攻击者通过构造特殊的 URL 或 POST 数据，将恶意的 PHP 参数注入到 PHP 进程中。例如，攻击者可以使用 `-d` 参数来修改 `php.ini` 配置，或者使用 `-r` 参数直接执行 PHP 代码。利用方式依赖于服务器的配置和 PHP 版本的具体细节。

**项目地址:** [PhinehasNarh/CVE-2024-4577-LetsDefend-walkthrough](https://github.com/PhinehasNarh/CVE-2024-4577-LetsDefend-walkthrough)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)