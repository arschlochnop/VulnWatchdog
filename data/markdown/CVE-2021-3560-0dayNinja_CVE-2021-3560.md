## CVE-2021-3560 - Polkit D-Bus 认证绕过

**漏洞编号:** CVE-2021-3560

**漏洞类型:** 权限提升

**影响应用:** Polkit

**危害等级:** 高危，允许本地普通用户提升至root权限，导致数据泄露、完整性破坏和系统不可用。

**影响版本:** Polkit 0.119

**利用条件:** 需要本地访问权限。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-3560 漏洞存在于 Polkit 中，允许本地未授权用户通过 D-Bus 消息绕过认证检查，从而获得 root 权限。

**有效性:**

根据漏洞信息、搜索结果和提供的 Metasploit 模块代码，该漏洞的利用是有效的。漏洞库信息和搜索结果都表明这是一个已知的、可被利用的权限提升漏洞。Metasploit 模块的存在进一步证实了这一点。

**投毒风险:**

分析 Metasploit 模块代码，投毒风险较低，约为 10%。主要风险在于：

*   **选项参数修改:**  攻击者可能会修改`USERNAME`和`PASSWORD`选项，添加一个后门账户，但这种行为容易被发现。
*   **模块逻辑篡改:**  攻击者可能修改模块的核心逻辑，例如在提权后执行恶意代码，或修改/etc/sudoers文件，但是由于metasploit-framework的开源特性，所以容易被检测出来
*   **依赖风险:**  模块依赖于 ruby 环境和 dbus-send 命令。攻击者可能会利用这些依赖项的漏洞进行投毒。

**利用方式:**

1.  **D-Bus 消息发送:**  利用 `dbus-send` 命令向 Polkit 发送特定的 D-Bus 消息。
2.  **竞争条件触发:**  在发送 D-Bus 消息的同时，通过 `kill` 命令终止客户端进程，从而触发竞争条件。
3.  **认证绕过:**  竞争条件导致 Polkit 绕过认证检查。
4.  **权限提升:**  成功绕过认证后，执行特权操作，例如添加具有 sudo 权限的新用户，或直接执行 payload。
5.  **Payload 执行:** 使用新增的账户执行payload，获取root权限

总而言之，该漏洞利用的有效性较高，但投毒风险相对较低。利用方式涉及发送恶意的 D-Bus 消息并利用竞争条件绕过认证检查，最终提升权限。

**项目地址:** [0dayNinja/CVE-2021-3560](https://github.com/0dayNinja/CVE-2021-3560)

**漏洞详情:** [CVE-2021-3560](https://nvd.nist.gov/vuln/detail/CVE-2021-3560)