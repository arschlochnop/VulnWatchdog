## CVE-2024-32002

**漏洞编号:** CVE-2024-32002

**漏洞类型:** 远程代码执行

**影响应用:** Git

**危害等级:** 高危，允许攻击者在受害者机器上执行任意代码

**影响版本:** 受影响版本包括：2.45.0, 2.44.0, >= 2.43.0 且 < 2.43.4, >= 2.42.0 且 < 2.42.2, 2.41.0, >= 2.40.0 且 < 2.40.2, < 2.39.4

**利用条件:** 需要目标系统使用受影响的Git版本，并允许递归克隆包含恶意submodule的仓库。目标文件系统需要大小写不敏感且支持符号链接。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-32002 漏洞存在于 Git 的 submodule 处理机制中。攻击者可以构造包含恶意 submodule 的仓库，当受害者递归克隆该仓库时，Git 会被欺骗将文件写入 `.git/` 目录而不是 submodule 的工作目录。这样，攻击者就可以在克隆过程中执行恶意 hook，从而实现远程代码执行。

**有效性分析：**
根据漏洞信息和搜索结果，该漏洞是一个远程代码执行漏洞，利用 submodules 中的缺陷，通过在`.git/`目录下写入恶意 hook 脚本，在 clone 过程中执行该脚本，从而实现 RCE。提供的POC代码尝试模拟此攻击，克隆恶意仓库，设置 git 配置以允许文件协议和符号链接，然后创建包含恶意payload的post-checkout hook，并将其推送到远端仓库，最后添加恶意的submodule。因此，提供的POC代码在满足漏洞利用条件的情况下是有效的。

**投毒风险分析：**
POC代码中存在潜在的投毒风险，作者可能通过恶意修改`shell.sh`，在受害者执行漏洞利用代码时执行意料之外的代码。例如，作者可能添加代码来窃取受害者的凭据、安装后门或进行其他恶意活动。但是从现有代码看，可能性较低。判断依据如下：

*   `rm -rf nothing` 和 `rm -rf toSeeHere` 看上去是无害的操作，但可能用于清理攻击痕迹，或者迷惑分析人员。
*   设置全局git配置，例如`git config --global protocol.file.allow always`，可能允许其他攻击向量。如果受害者在其他环境中使用了被更改的全局git配置，可能会带来安全风险。
*   `git clone http://<server ip>:<port>/<username>/repo1.git` 和 `git clone http://<server ip>:<port>/<username>/repo2.git` 依赖外部的git服务器。该服务器可能包含后门代码，或者在特定的IP/用户环境下，返回不同的内容，实现有选择的攻击。
*   `cat > y/hooks/post-checkout <<EOF
#!bin/sh.exe
#your payload goes here
EOF` 这部分是payload注入点, 攻击者可以伪装成漏洞利用代码，将恶意代码放在此处。

**利用方式分析：**
1.  攻击者创建一个包含恶意 submodule 的 Git 仓库。
2.  在 submodule 中，攻击者创建一个 hook 脚本（例如 `post-checkout`），该脚本包含恶意代码。
3.  攻击者将 submodule 添加到主仓库中，并创建一个特殊的 `.git` 文件或符号链接，指向恶意 submodule 的 `.git` 目录。
4.  当受害者递归克隆包含恶意 submodule 的仓库时，Git 会尝试初始化 submodule。
5.  由于存在特殊的 `.git` 文件或符号链接，Git 会被欺骗将文件写入 `.git/` 目录而不是 submodule 的工作目录。
6.  写入 `.git/` 目录中的 hook 脚本会被执行，从而实现远程代码执行。

**项目地址:** [daemon-reconfig/CVE-2024-32002](https://github.com/daemon-reconfig/CVE-2024-32002)

**漏洞详情:** [CVE-2024-32002](https://nvd.nist.gov/vuln/detail/CVE-2024-32002)