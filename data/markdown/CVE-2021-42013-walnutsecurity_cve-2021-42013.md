## CVE-2021-42013 - Apache HTTP Server Path Traversal 和 Remote Code Execution

**漏洞编号:** CVE-2021-42013

**漏洞类型:** 路径遍历和远程代码执行

**影响应用:** Apache HTTP Server

**危害等级:** 高危，可能导致敏感文件泄露和远程代码执行

**影响版本:** 2.4.49 和 2.4.50

**利用条件:** 需要目标服务器运行受影响的 Apache HTTP Server 版本，并且Alias配置不当，允许访问受限目录，如果开启了CGI脚本支持，则可能造成RCE

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-42013 是 Apache HTTP Server 2.4.49 和 2.4.50 中存在的路径遍历和远程代码执行漏洞。该漏洞是 CVE-2021-41773 的不完整修复。

**漏洞利用方式：**

攻击者可以利用路径遍历攻击，将 URL 映射到 Alias 指令配置目录之外的文件。如果这些目录之外的文件没有受到 “require all denied” 等常见默认配置的保护，请求就会成功。如果为这些别名路径启用了 CGI 脚本，则可能允许远程代码执行。

根据提供的 Dockerfile 和 Python 脚本，利用方式如下：

1.  **路径遍历：** 通过构造包含 ".." 的恶意 URL，绕过 Alias 限制，访问服务器上的任意文件。
2.  **远程代码执行：** 如果服务器启用了 CGI，攻击者可以上传一个包含恶意代码的 CGI 脚本，然后通过路径遍历漏洞执行该脚本，从而实现远程代码执行。

**POC 代码分析：**

提供的 POC 代码包含一个 Dockerfile 和一个 Python 脚本。Dockerfile 用于构建一个存在漏洞的 Apache HTTP Server 2.4.50 实例。Python 脚本 `cve-2021-42013.py` 用于检测和利用该漏洞，支持以下功能：

*   检查是否存在路径遍历漏洞
*   执行路径遍历 PoC，尝试读取敏感文件
*   执行远程代码执行 PoC，尝试执行任意命令

**投毒风险分析：**

对提供的`cve-2021-42013.py`脚本进行分析，发现存在一定的投毒风险。例如：
1.   **执行任意命令的潜在风险**：远程代码执行PoC中，如果构造的命令过于复杂或者包含恶意代码，可能会对目标系统造成破坏。
2.  **批量扫描的风险**：批量扫描功能可能会被用于非法用途，例如扫描大量服务器并尝试利用该漏洞。
3.  **依赖风险**：脚本中用到了requests和urllib库，如果这些库被篡改，可能会导致脚本执行恶意代码。

尽管脚本提供了路径遍历和RCE的验证，存在滥用的可能性，但恶意代码本身没有隐藏在代码中，考虑到其他风险，投毒风险相对较低，暂定为10%。

**项目地址:** [walnutsecurity/cve-2021-42013](https://github.com/walnutsecurity/cve-2021-42013)

**漏洞详情:** [CVE-2021-42013](https://nvd.nist.gov/vuln/detail/CVE-2021-42013)