## CVE-2021-3560-Polkit权限提升

**漏洞编号:** CVE-2021-3560

**漏洞类型:** 权限提升

**影响应用:** Polkit

**危害等级:** 高危，可能导致普通用户获取root权限

**影响版本:** polkit 0.119

**利用条件:** 本地访问，目标系统安装了存在漏洞的Polkit版本，并且运行了D-Bus服务。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-3560 漏洞允许未经授权的本地攻击者通过 D-Bus 请求绕过 Polkit 的凭据检查，从而将权限提升到 root 用户。

**有效性：**
提供的POC代码看起来是有效的。它通过 `dbus-send` 命令与 `org.freedesktop.Accounts` 服务进行交互，尝试创建用户并设置密码。利用了Polkit在处理D-Bus请求时存在的缺陷，达到了提权的目的。

**投毒风险：**
虽然脚本的主要目的是利用漏洞进行提权，但仍存在一定的投毒风险。

1.  **用户创建行为：** 脚本会尝试创建一个名为`n3on`的用户。如果攻击者在受害者系统上成功执行此脚本，将会留下一个具有潜在后门的账户。虽设置密码为空，但攻击者也可以利用该账户进行进一步的渗透或破坏。
2.  **sudo -s 调用：** 脚本在最后调用了 `sudo -s`，强制切换到root用户。虽然看起来是为了方便用户在使用漏洞后立即获得root权限，但也可能被用于执行其他恶意命令。虽然whoami只是验证代码有效性
3.  **sleep 函数：** 脚本里存在 `sleep` 函数，会延迟脚本运行时间。如果攻击者恶意延长 `sleep` 的时间，可能会对系统造成拒绝服务攻击。

因此，虽然脚本的主要功能是漏洞利用，但其创建用户、执行 `sudo -s` 操作和存在sleep函数，都增加了潜在的风险。

**利用方式：**

1.  **D-Bus 交互：** 漏洞利用的核心在于通过 `dbus-send` 命令与 `org.freedesktop.Accounts` 服务通信。`dbus-send` 用于发送方法调用到D-Bus总线上的服务。
2.  **用户创建：** 脚本多次尝试创建用户`n3on`。重复尝试结合kill来绕过 polkit 的某些安全检查。
3.  **密码设置：** 通过D-Bus调用`/org/freedesktop/Accounts/User1000`（假设User1000代表当前用户）的`SetPassword`方法，将密码设置为空字符串。这可能会导致用户账户安全风险。
4.  **提权：** 在成功创建用户后，脚本尝试通过`su n3on`切换到新创建的用户，然后使用 `sudo -s` 命令尝试获取 root 权限。

该漏洞利用方式的本质是利用Polkit对D-Bus消息处理的缺陷，绕过认证并执行特权操作。该漏洞利用的成功依赖于目标系统存在漏洞版本的Polkit，并且D-Bus服务正常运行。


**项目地址:** [NeonWhiteRabbit/CVE-2021-3560](https://github.com/NeonWhiteRabbit/CVE-2021-3560)

**漏洞详情:** [CVE-2021-3560](https://nvd.nist.gov/vuln/detail/CVE-2021-3560)