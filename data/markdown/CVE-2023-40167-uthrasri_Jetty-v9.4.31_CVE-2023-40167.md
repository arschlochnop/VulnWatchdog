## CVE-2023-40167-Jetty Content-Length 注入

**漏洞编号:** CVE-2023-40167

**漏洞类型:** 请求走私

**影响应用:** Jetty

**危害等级:** 中危，可能导致请求走私

**影响版本:** 9.0.0 <= version <= 9.4.51, 10.0.0 <= version <= 10.0.15, 11.0.0 <= version <= 11.0.15, version == 12.0.0

**利用条件:** Jetty与其他服务器或代理一起使用，且其他服务器或代理对`+`前缀的Content-Length处理方式不同

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2023-40167 漏洞是 Jetty 在处理 `Content-Length` 头时，允许 `+` 字符作为前缀。根据 RFC 规范，这是不被允许的，其他服务器通常会返回 400 错误。如果 Jetty 与不关闭连接并发送 400 响应的服务器一起使用，可能导致请求走私。

**有效性：**
根据漏洞库信息和搜索引擎结果，该漏洞本身并不直接造成危害，而是在特定情况下（与其他服务器或代理组合使用）可能导致请求走私。提供的代码片段 `HttpParser.java` 是 Jetty 的 HTTP 解析器部分，但并非直接利用代码，而只是展示了 Jetty 如何解析 HTTP 头部。有效性取决于下游服务器对 `Content-Length` 的解析情况。

**投毒风险：**
提供的代码片段 `HttpParser.java` 只是 Jetty 源码的一部分，没有发现作者隐藏的投毒代码。该文件是Jetty项目中的一个解析器类,负责解析HTTP请求.它主要涉及协议的实现,而不是恶意代码的插入.没有理由怀疑其存在投毒风险。

**利用方式：**
攻击者可以发送包含 `+` 前缀的 `Content-Length` 头的 HTTP 请求到 Jetty 服务器。如果前端服务器（例如代理服务器）不接受 `+` 前缀，并将其视为无效的 `Content-Length`，但仍然将请求转发到 Jetty，Jetty 会错误地解析该 `Content-Length`。这导致请求的长度计算出现偏差，从而允许攻击者走私后续的请求。攻击者可以利用此漏洞来绕过安全策略、获取敏感信息或者执行未授权操作。

**项目地址:** [uthrasri/Jetty-v9.4.31_CVE-2023-40167](https://github.com/uthrasri/Jetty-v9.4.31_CVE-2023-40167)

**漏洞详情:** [CVE-2023-40167](https://nvd.nist.gov/vuln/detail/CVE-2023-40167)