## CVE-2023-51385-OpenSSH-命令注入

**漏洞编号:** CVE-2023-51385

**漏洞类型:** 命令注入

**影响应用:** OpenSSH

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** < 9.6

**利用条件:** 受害者需要使用存在漏洞的OpenSSH版本，并连接到包含恶意配置的Git仓库子模块或者其他存在恶意用户名/主机名的配置

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-51385 漏洞存在于 OpenSSH 9.6 之前的版本中。当用户名或主机名包含 shell 元字符时，如果这些名称被特定的扩展令牌引用，可能导致操作系统命令注入。例如，一个不受信任的 Git 仓库的子模块可能在用户名或主机名中包含 shell 元字符。 

**有效性:** 根据漏洞库信息和搜索引擎结果，该漏洞真实存在并且影响 OpenSSH 9.6 之前的版本。提供的 POC 代码利用了 `~/.ssh/config` 文件中的 `ProxyCommand` 指令，通过在主机名中使用 shell 元字符来执行任意命令。通过`git clone --recurse-submodules`下载包含恶意配置的子模块，即可触发漏洞。 

**投毒风险:** 该POC提供了一个通过恶意配置子模块触发计算器弹出的例子，帮助用户验证该漏洞，提高安全意识。但是，如果攻击者修改了 `~/.ssh/config` 文件或通过其他方式将恶意的用户名/主机名注入到配置中，就有可能执行任意命令，造成安全风险。因此，虽然POC本身是为了演示漏洞，但也存在被滥用的可能。 投毒风险评估为10%，主要考虑攻击者可能在公开的漏洞利用代码中添加恶意代码，诱导用户执行，但是该POC主要依赖配置文件的恶意构造，直接添加恶意代码到POC文件中的可能性较低。

**利用方式:**  利用方式主要通过以下步骤：
1.  攻击者创建一个包含恶意子模块的Git仓库，该子模块的用户名或主机名包含shell元字符。
2.  受害者克隆该仓库，并使用 `--recurse-submodules` 参数初始化子模块。
3.  当 OpenSSH 使用 `ProxyCommand` 指令处理包含恶意元字符的用户名或主机名时，会执行攻击者构造的恶意命令。

另一种利用方式是攻击者诱导受害者在`~/.ssh/config`中添加包含恶意shell元字符的配置信息，当ssh连接目标主机时触发该配置，执行恶意命令。


**项目地址:** [thinkliving2020/CVE-2023-51385-](https://github.com/thinkliving2020/CVE-2023-51385-)

**漏洞详情:** [CVE-2023-51385](https://nvd.nist.gov/vuln/detail/CVE-2023-51385)