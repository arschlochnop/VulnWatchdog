## CVE-2023-22527-Confluence-RCE

**漏洞编号:** CVE-2023-22527

**漏洞类型:** 远程代码执行

**影响应用:** Atlassian Confluence Server and Data Center

**危害等级:** 高危，未经身份验证的攻击者可以执行任意代码

**影响版本:** 8.0.0 <= version < 8.5.4

**利用条件:** 目标Confluence实例的版本在受影响范围内，且可以通过网络访问

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-22527是一个存在于Atlassian Confluence Server和Data Center的模板注入漏洞，允许未经身份验证的攻击者实现远程代码执行（RCE）。

**有效性：**
根据漏洞库信息、搜索引擎结果和提供的漏洞利用代码，此漏洞利用的有效性很高。
*   漏洞库信息将此漏洞标记为严重，CVSS评分为10，并已被添加到CISA KEV目录，表明该漏洞已被积极利用。
*   搜索引擎结果显示，该漏洞已被广泛讨论和利用，出现了恶意软件投放、cryptojacking甚至ransomware攻击的案例。
*   提供的漏洞利用代码（CVE-2023-22527-Godzilla-MEMSHELL）旨在通过注入内存Shell来实现持久的远程访问。README.md文件提供了使用示例，表明其能够在受影响的Confluence实例上部署Godzilla webshell。

**投毒风险：**
分析提供的POC代码后，存在一定的投毒风险，但可能性相对较低。主要关注点在于ConfluenceFilterMemshell.java文件，该文件负责将内存Shell注入到Confluence服务器中。
*   `ConfluenceFilterMemshell.java` 文件通过反射动态地将一个 ServletRequestListener 添加到 Confluence 的 StandardContext 中。 这个 Listener 实际上是一个 Proxy 对象，代理了 ConfluenceFilterMemshell 实例，在每次请求初始化时，执行 `backDoor` 方法。
*   `backDoor` 方法的功能未完全提供，因为提供的代码被截断。 完整的 `backDoor` 方法中可能存在恶意代码，例如后门，数据收集或未记录的功能。 但从代码结构上看，这是一个webshell注入器，主要目标是植入webshell。
*   投毒的风险主要存在于作者在未提供的代码部分（`getMethodByClass`、`getFieldValue`、`invokeMethod`，完整的`backDoor`方法等）中，可能嵌入了额外的恶意逻辑，例如连接特定IP地址，上传额外文件等。如果没有完整代码，难以100%确定是否存在恶意代码。

综合考虑，判断投毒风险为10%，主要是考虑到该POC的目的是植入webshell，而 webshell 本身已经提供了非常高的权限，额外的恶意代码收益不高，但不能完全排除作者出于其他目的嵌入恶意代码的可能性。

**利用方式：**
1.  攻击者利用模板注入漏洞，通过构造恶意的OGNL表达式，在目标Confluence服务器上执行任意代码。
2.  提供的POC代码通过注入一个恶意的ServletRequestListener来实现内存webshell的植入。
3.  攻击者可以通过访问特定的URL（例如`/template/aui/text-inline.vm`）触发漏洞，将恶意代码注入到Confluence服务器的内存中。
4.  成功注入内存webshell后，攻击者可以使用Godzilla等webshell管理工具，通过指定的密码和密钥连接到服务器，并执行任意命令。

**项目地址:** [Boogipop/CVE-2023-22527-Godzilla-MEMSHELL](https://github.com/Boogipop/CVE-2023-22527-Godzilla-MEMSHELL)

**漏洞详情:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)