## CVE-2020-1472 Zerologon 权限提升漏洞

**漏洞编号:** CVE-2020-1472

**漏洞类型:** 权限提升

**影响应用:** Microsoft Windows Server

**危害等级:** 高危，允许未经身份验证的攻击者获取域管理员权限

**影响版本:** 见漏洞库信息

**利用条件:** 攻击者需要位于目标域网络中，并能够与域控制器进行通信

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2020-1472（Zerologon）是一个严重的权限提升漏洞，存在于Windows Server使用的Netlogon远程协议（MS-NRPC）的加密实现中。攻击者可以通过建立与域控制器的脆弱Netlogon安全通道连接来利用此漏洞。该漏洞允许未经身份验证的攻击者通过将域控制器的计算机密码重置为空密码，从而冒充域控制器，最终获得域管理员权限。利用过程涉及多个步骤：

1.  **建立连接：** 使用MS-NRPC与目标域控制器建立连接。
2.  **零认证：** 利用加密漏洞，使用全零的challenge和credential进行身份验证。该漏洞的核心在于AES-CFB8的实现缺陷。
3.  **密码重置：** 成功通过零认证后，攻击者可以通过NetrServerPasswordSet2函数将域控制器的机器帐户密码设置为空字符串。
4.  **权限获取：** 攻击者可以使用空密码对域控制器进行身份验证，并获取域管理员权限。

**有效性：**

根据漏洞信息和搜索结果，该漏洞的POC代码是有效的。多个来源（如CrowdStrike博客，NVD，Unit42）确认了漏洞的存在和严重性。提供的POC代码旨在利用该漏洞，并通过将域控制器的密码重置为空来验证其有效性。

**投毒风险：**

提供的Dockerfile拉取了impacket和CVE-2020-1472的exploit代码。cve-2020-1472-exploit.py是漏洞利用脚本。乍一看，脚本的功能是利用Zerologon漏洞重置域控密码。风险主要来自以下几个方面：

*   **依赖项：** Dockerfile中安装了impacket，这是一个常用的渗透测试工具包。虽然impacket本身不是恶意软件，但它提供的功能可能被滥用。
*   **脚本内容：** `cve-2020-1472-exploit.py`脚本的目的是利用漏洞，这本身就具有潜在的风险。如果脚本被修改，可能会包含恶意代码，例如：
    *   **密码泄露：**  修改后的脚本可能会尝试在重置密码后，将原始密码或重置后的密码发送到外部服务器。
    *   **后门植入：**  脚本可能会在域控制器上安装后门，允许攻击者在以后访问系统。
    *   **数据窃取：**  脚本可能会尝试窃取域控制器上的敏感数据。

考虑到脚本的功能和潜在的风险，**投毒风险约为5%**。虽然该脚本的核心功能是利用已知的漏洞，但攻击者可能会在其中添加恶意代码，以扩大攻击范围或持久化访问。

**利用方式：**

1.  **环境准备：** 搭建包含域控制器的Windows Server环境，确保目标域控制器未安装CVE-2020-1472补丁。
2.  **执行POC代码：** 运行提供的`cve-2020-1472-exploit.py`脚本，指定目标域控制器的NetBIOS名称和IP地址。
3.  **验证漏洞：** 脚本将尝试通过零认证重置域控制器的密码。如果成功，脚本将显示漏洞利用成功的消息。
4.  **获取权限：** 使用空密码对域控制器进行身份验证，并获取域管理员权限。可以使用工具如`secretsdump.py` (在 Dockerfile 复制到工作目录中) 提取域哈希值。
5.  **清理（可选）：** 在完成测试后，应尽快将域控制器的密码恢复到原始状态，并应用CVE-2020-1472补丁。

**项目地址:** [itssmikefm/CVE-2020-1472](https://github.com/itssmikefm/CVE-2020-1472)

**漏洞详情:** [CVE-2020-1472](https://nvd.nist.gov/vuln/detail/CVE-2020-1472)