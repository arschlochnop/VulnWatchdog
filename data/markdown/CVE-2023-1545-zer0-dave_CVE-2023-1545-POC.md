## CVE-2023-1545-Teampass-SQL注入

**漏洞编号:** CVE-2023-1545

**漏洞类型:** SQL注入

**影响应用:** Teampass

**危害等级:** 高危，可能导致数据泄露

**影响版本:** < 3.0.0.23

**利用条件:** API功能需要启用，需要网络访问。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2023-1545是Teampass 3.0.0.23之前的版本中存在的一个SQL注入漏洞。根据漏洞描述和搜索结果，该漏洞允许未经授权的攻击者通过`/api/index.php/authorize`端点进行SQL注入，从而读取数据库中的敏感信息。提供的POC脚本演示了如何利用此漏洞提取用户名和密码哈希值。

**漏洞利用有效性：**
提供的POC脚本通过构造恶意的`login`参数，利用SQL注入漏洞绕过身份验证。脚本首先检查API是否启用，然后构造包含SQL注入的JSON数据，并使用curl向`/api/index.php/authorize`端点发送POST请求。如果注入成功，API将返回包含用户信息的token，脚本解析该token以提取所需的数据。

**投毒风险：**
通读POC脚本，主要的风险点在于脚本的用途描述是"reference to those who might have missed the original.",  说明这本身不是一个正式的POC，有可能是作者为了规避风险。
- 脚本中使用了硬编码的哈希值`$2y$10$u5S27wYJCVbaPTRiHRsx7.iImx/WxRA8/tKvWdaWQ/iDuKlIkMbhq`，并在SQL注入中使用UNION SELECT语句将其插入到pw字段中，这是一种替换密码的后门尝试，但本身验证了漏洞的存在。如果用户直接使用该脚本，可能会意外地将部分用户的密码替换为该哈希值。该行为具有一定的迷惑性，因为初学者可能会误以为这是漏洞利用的必要步骤，而忽略了其潜在的风险。
- `jq`命令被用于解析JSON响应，如果目标系统上没有安装`jq`，脚本会出错。虽然这不是恶意代码，但可能导致脚本无法正常执行。
-  `base64 -d` 命令如果无法正常解码可能会导致错误.

综合来看，脚本中存在后门性质的代码，但可以判定不是投毒代码，因为后门是明确写入的，不是隐藏的恶意行为。
脚本的投毒风险较低，约为1%。风险主要来源于用户未审查代码直接使用。

**利用方式：**
1.  确定目标Teampass版本低于3.0.0.23，并且启用了API功能。
2.  修改POC脚本中的`base-url`为目标Teampass的URL。
3.  运行脚本，脚本将尝试利用SQL注入漏洞提取用户名和密码哈希值。如果注入成功，脚本将输出数据库中所有用户的用户名和密码哈希值。

**项目地址:** [zer0-dave/CVE-2023-1545-POC](https://github.com/zer0-dave/CVE-2023-1545-POC)

**漏洞详情:** [CVE-2023-1545](https://nvd.nist.gov/vuln/detail/CVE-2023-1545)