## CVE-2018-6574 Go "go get" 远程命令执行

**漏洞编号:** CVE-2018-6574

**漏洞类型:** 远程命令执行

**影响应用:** Go

**危害等级:** 高危，允许攻击者在构建过程中执行任意代码

**影响版本:** Go before 1.8.7, Go 1.9.x before 1.9.4, and Go 1.10 pre-releases before Go 1.10rc2

**利用条件:** 目标系统使用受影响的Go版本，并且执行`go get`命令获取恶意代码。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2018-6574 允许通过`go get`命令执行远程命令，利用了 gcc/clang 插件功能未正确过滤 `-fplugin=` 和 `-plugin=` 参数。攻击者可以创建一个包含恶意代码的Go项目，并在项目的CGO指令中指定恶意的插件。当受害者使用受影响的Go版本通过`go get`获取并构建该项目时，指定的恶意插件会被执行，从而导致远程命令执行。

分析提供的POC代码：

*   `attack.c`：这是一个 C 源代码文件，定义了一个名为 `exploit` 的函数，该函数使用 `system` 函数执行命令 `/usr/local/bin/score afd78b87-2130-4509-be41-e2bc661c338e`。`__attribute__((constructor))` 使得 `exploit` 函数在共享库加载时自动执行。
*   `main.go`：这是一个 Go 源代码文件，它使用 CGO（C Go 接口）来调用 C 代码。`// #cgo CFLAGS: -fplugin=./attack.so` 指令告诉 Go 编译器在构建过程中使用 `attack.so` 作为 gcc/clang 的插件。`attack.so` 是由 `attack.c` 编译生成的共享库。当 `go get` 构建该项目时，会编译 `attack.c` 生成 `attack.so`，然后将其作为插件加载，从而执行 `exploit` 函数中的命令。

**有效性：**

该POC代码有效。通过 `go get` 命令获取并构建包含上述代码的项目，可以触发远程命令执行。

**投毒风险：**

代码本身的功能是明确的：执行一个特定的命令。**并没有隐藏任何其他的后门代码或者恶意行为**。因此，投毒风险为 0%。

**利用方式：**

1.  攻击者创建一个包含恶意 `attack.c` 和 `main.go` 的 Go 项目。
2.  攻击者将该项目托管在公共代码仓库（如 GitHub）。
3.  攻击者诱导受害者使用受影响的 Go 版本执行 `go get <attacker's repository>` 命令。
4.  受害者的 Go 工具链在构建项目时，会加载 `attack.so` 插件，从而执行攻击者指定的任意命令。

**项目地址:** [mux0x/CVE-2018-6574](https://github.com/mux0x/CVE-2018-6574)

**漏洞详情:** [CVE-2018-6574](https://nvd.nist.gov/vuln/detail/CVE-2018-6574)