## CVE-2022-0944 - SQLPad 模板注入导致RCE

**漏洞编号:** CVE-2022-0944

**漏洞类型:** 模板注入

**影响应用:** SQLPad

**危害等级:** 高危，可导致远程代码执行

**影响版本:** < 6.10.1

**利用条件:** 需要高权限用户访问，目标存在 /api/test-connection 接口

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-0944 漏洞是 SQLPad 6.10.1 之前版本中存在的一个模板注入漏洞。该漏洞位于 `/api/test-connection` 接口，攻击者可以通过构造恶意的模板注入payload，执行任意代码。根据漏洞库信息，该漏洞的CVSS 3.0评分为9.1，属于严重级别。搜索引擎结果显示，已经存在公开的漏洞利用代码。

**有效性：**

根据提供的漏洞利用代码，该PoC使用 Python 编写，通过向 `/api/test-connection` 发送包含恶意payload的请求来触发漏洞。Payload 使用 `process.mainModule.require('child_process').exec()` 执行系统命令。代码中还包含一个反弹shell的功能，方便攻击者进行利用。该POC代码看起来是有效的，因为漏洞信息和代码逻辑是符合的.

**投毒风险：**

查看了提供的PoC代码，包含`LICENSE`，`README.md` 和 `main.py` 文件，没有发现明显的恶意代码或者后门，只是实现了漏洞的利用。代码功能比较直观，主要是发送恶意请求并监听端口获取反弹shell。因此，投毒风险评估为0%。

**利用方式：**

1.  **身份验证（可选）：** 如果目标SQLPad实例启用了身份验证，攻击者需要提供有效的用户名和密码才能利用该漏洞。PoC代码提供了身份验证功能。
2.  **发送恶意请求：** 攻击者构造一个包含恶意payload的JSON数据，并将其发送到 `/api/test-connection` 接口。Payload中利用了模板注入的特性，执行任意系统命令，启动反弹shell.
3.  **监听反弹Shell：** 攻击者在本地设置一个监听器，等待目标服务器连接，从而获得对目标服务器的控制权。

总而言之，该漏洞的利用方式简单直接，只需要发送一个精心构造的请求即可实现远程代码执行，风险极高。在sqlpad 6.10.1之前的版本应该升级。

**项目地址:** [shhrew/CVE-2022-0944](https://github.com/shhrew/CVE-2022-0944)

**漏洞详情:** [CVE-2022-0944](https://nvd.nist.gov/vuln/detail/CVE-2022-0944)