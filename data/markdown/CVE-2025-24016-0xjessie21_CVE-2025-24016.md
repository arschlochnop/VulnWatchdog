## CVE-2025-24016-Wazuh-RCE

**漏洞编号:** CVE-2025-24016

**漏洞类型:** 反序列化漏洞导致远程代码执行

**影响应用:** Wazuh

**危害等级:** 严重，可能导致完全系统控制

**影响版本:** >= 4.4.0, < 4.9.1

**利用条件:** 需要API访问权限（可能通过被入侵的dashboard、Wazuh集群服务器或配置不当的agent），以及目标Wazuh服务器监听在网络端口。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于Wazuh服务器的DistributedAPI组件中，由于对JSON反序列化数据处理不当，攻击者可以通过发送特制的DAPI请求，在服务器上执行任意代码。利用方式如下：

1.  **漏洞原理：**  Wazuh服务器使用`as_wazuh_object`函数反序列化DAPI请求中的JSON数据。攻击者可以构造包含`__unhandled_exc__`键的恶意JSON，该键的值包含一个类名（如`os.system`）和相应的参数，从而触发任意代码执行。
2.  **利用步骤：**
    *   获取API访问权限（例如，通过Wazuh dashboard或集群中的其他服务器）。
    *   构造恶意的JSON payload，利用`__unhandled_exc__`执行反向shell命令，连接到攻击者的IP地址和端口。
    *   将payload作为DAPI请求发送到Wazuh服务器。
    *   在攻击者的机器上监听指定端口，接收反向shell。
3.  **POC代码分析：**  提供的POC代码是一个Python脚本，它接受目标URL、攻击者IP地址和端口作为参数，并生成包含恶意payload的DAPI请求。该脚本使用`requests`库发送POST请求，并使用`HTTPBasicAuth`进行身份验证。payload中的`__unhandled_exc__`被设置为执行反向shell的命令。
4.  **投毒风险分析：**  POC代码本身逻辑较为简单，主要用于利用漏洞。潜在的投毒风险可能存在于以下几个方面：
    *   **依赖项：**  检查`requirements.txt`或`setup.py`等文件，确保没有引入恶意依赖项。
    *   **混淆代码：**  查看代码中是否存在混淆或隐藏的恶意代码。
    *   **网络请求：**  监控代码是否尝试连接到未知的外部服务器。
    *   **反向shell：** 虽然反向shell是PoC的一部分，但恶意版本可能会试图下载payload或执行其他未经授权的操作。代码中存在明显的反向shell创建逻辑，因此这部分代码并非隐藏的投毒。
    *   **信息收集：**  代码可能包含收集目标系统信息的行为，例如用户名、操作系统版本等，并将其发送给攻击者。当前代码收集信息行为并不明显，但要仔细检查与系统交互的部分。

  综合评估，该POC代码的投毒风险较低（约10%），主要是因为其功能相对直接，但仍需要谨慎审查代码和相关依赖项，以确保其安全性。要特别注意payload中命令执行的参数，是否存在编码或格式化问题，导致其他恶意代码被注入。

**项目地址:** [0xjessie21/CVE-2025-24016](https://github.com/0xjessie21/CVE-2025-24016)

**漏洞详情:** [CVE-2025-24016](https://nvd.nist.gov/vuln/detail/CVE-2025-24016)