## CVE-2022-23940 - SuiteCRM 远程代码执行

**漏洞编号:** CVE-2022-23940

**漏洞类型:** PHP反序列化漏洞导致远程代码执行

**影响应用:** SuiteCRM

**危害等级:** 高危，允许攻击者执行任意代码，完全控制服务器

**影响版本:** <= 7.12.1 和 8.x <= 8.0.1

**利用条件:** 需要拥有 SuiteCRM 的账户，且该账户具备创建计划报表（Scheduled Reports）的权限。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-23940 是 SuiteCRM 中的一个 PHP 反序列化漏洞，存在于计划报表模块中。攻击者需要首先通过身份验证，获得创建计划报表的权限。然后，攻击者可以通过构造恶意的请求，在 email_recipients 字段中插入 PHP 反序列化 payload。当服务器处理该报表时，会对 email_recipients 字段进行反序列化，从而执行攻击者预设的恶意代码，最终导致远程代码执行。

**利用方式：**

1.  攻击者登录 SuiteCRM，并确保拥有创建计划报表的权限。
2.  攻击者构造包含恶意 PHP 反序列化 payload 的请求，该 payload 位于 email_recipients 字段中。该字段会被base64编码并序列化后存储。
3.  攻击者发送该恶意请求到 SuiteCRM 服务器，创建一个恶意的计划报表。
4.  当有用户访问该报表时（或者计划任务执行该报表），SuiteCRM 会尝试反序列化 email_recipients 字段的内容。
5.  由于该字段包含恶意的 PHP 反序列化 payload，服务器会执行该 payload，从而实现远程代码执行。

**有效性：**

根据漏洞信息和提供的漏洞利用代码（PoC），该漏洞利用是有效的。PoC 提供了详细的利用步骤和示例，包括如何构建包含恶意 payload 的请求，以及如何利用该漏洞执行任意命令。

**投毒风险：**

提供的漏洞利用代码看起来比较直接，主要目的是为了演示如何利用该漏洞。虽然存在一些风险，例如作者可能在payload生成部分留下后门。代码中主要逻辑为利用漏洞，因此投毒的可能性较低，个人评估约为 10%。需要注意的是，最终是否信任此代码取决于使用者自身的安全评估。

**项目地址:** [manuelz120/CVE-2022-23940](https://github.com/manuelz120/CVE-2022-23940)

**漏洞详情:** [CVE-2022-23940](https://nvd.nist.gov/vuln/detail/CVE-2022-23940)