## CVE-2020-11651-SaltStack认证绕过与远程代码执行

**漏洞编号:** CVE-2020-11651

**漏洞类型:** 认证绕过/远程代码执行

**影响应用:** SaltStack Salt

**危害等级:** 高危，可完全控制Salt Master及Minions

**影响版本:** < 2019.2.4, < 3000.2

**利用条件:** 可网络访问Salt Master的4506端口

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2020-11651 存在于 SaltStack Salt 的 ClearFuncs 类中，由于其对方法调用的验证不充分，导致未经身份验证的远程用户可以访问某些方法。利用方式主要有三种：

1.  **获取Root Key：** 通过`_prep_auth_info`方法获取Salt Master的Root Key，后续可利用该Key进行更高级的操作。
2.  **在Minions上执行任意命令：** 通过`_send_pub`方法，可以在所有（或指定）Salt Minions上执行任意命令，实现远程代码执行。
3.  **读取Master服务器上的文件：** 获取Root Key后，可以读取Master服务器上的任意文件。

**POC有效性：** 根据漏洞信息和POC代码，此POC代码是有效的，因为它能够利用未经身份验证的接口执行上述操作。

**投毒风险：** POC代码本身较为简洁，主要功能是利用漏洞，没有发现明显的恶意代码或后门。但是考虑到代码来自第三方，仍然存在一定的投毒风险。 风险主要在于以下几点：

*   **依赖包风险：**  POC依赖`pyzmq`和`msgpack`，如果攻击者篡改了这些依赖包，可能会引入恶意代码。
*   **远程连接风险：** 代码需要连接到目标Salt Master，如果目标服务器被攻陷，可能会被重定向到恶意的服务器。

 建议在使用此POC之前，仔细审查代码，并在隔离环境中运行。

**综合评估：**虽然POC主要目标是复现漏洞，但从供应链安全角度来看，存在5%的潜在投毒风险，主要源于依赖库和远程连接。

**项目地址:** [kevthehermit/CVE-2020-11651](https://github.com/kevthehermit/CVE-2020-11651)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)