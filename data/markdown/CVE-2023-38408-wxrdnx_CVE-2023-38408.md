## CVE-2023-38408-OpenSSH-Agent转发RCE

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 高危，允许远程代码执行

**影响版本:** < 9.3p2

**利用条件:** 开启了ssh-agent转发，且连接到恶意或受控的服务器。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2023-38408 漏洞存在于 OpenSSH 的 ssh-agent 中，由于 PKCS#11 功能对搜索路径的信任不足导致。如果启用了 agent 转发，恶意服务器可以利用此漏洞在客户端上执行任意代码。利用方式如下：

1.  **攻击者控制的服务器:** 攻击者需要控制一个SSH服务器，或者能够影响客户端连接到的服务器。
2.  **Agent 转发:**  受害者使用 `ssh -A` 或者在 ssh config 中配置 `ForwardAgent yes` 启用了 ssh-agent 转发。
3.  **恶意 PKCS#11 模块:** 攻击者在受害者连接的服务器上放置一个恶意的 PKCS#11 模块（.so 文件），该模块包含恶意代码。
4.  **触发漏洞:** 当 ssh-agent 尝试加载 PKCS#11 模块时，会执行攻击者放置的恶意代码，从而实现远程代码执行。

**有效性评估：**

根据漏洞描述、搜索结果（尤其是Qualys的分析）以及github上的poc，该漏洞利用是有效的，可以实现远程代码执行。

**投毒风险评估：**

提供的代码片段是Apache License 2.0的许可证文本，并非漏洞利用代码本身，因此无法通过此代码片段判断是否存在投毒行为。但是，需要警惕实际漏洞利用代码中可能存在的恶意Payload，建议在测试和使用任何漏洞利用代码之前，进行彻底的代码审查和安全分析，以防被植入后门或者其他恶意代码。

由于提供的license文本不涉及任何可执行代码，投毒风险评估为0%。实际利用代码如果来自不可信来源，需要重点评估。

**项目地址:** [wxrdnx/CVE-2023-38408](https://github.com/wxrdnx/CVE-2023-38408)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)