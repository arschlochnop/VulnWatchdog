## CVE-2025-1974-ingress-nginx-RCE

**漏洞编号:** CVE-2025-1974

**漏洞类型:** 远程代码执行

**影响应用:** ingress-nginx

**危害等级:** 高危，允许未经身份验证的攻击者在ingress-nginx controller上下文中执行任意代码，可能导致集群范围内的Secret泄露

**影响版本:** <= 1.11.4, 1.12.0

**利用条件:** 需要能够访问Pod网络

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2025-1974 是 Kubernetes ingress-nginx 中的一个严重漏洞，未经身份验证的攻击者通过 Pod 网络访问，可以在 ingress-nginx 控制器的上下文中执行任意代码。该漏洞与 Validating Admission Controller 的功能有关。POC通过构造恶意的Ingress资源，特别是 `nginx.ingress.kubernetes.io/auth-url` 注释，利用路径遍历漏洞覆盖SSL引擎，实现RCE。漏洞利用代码中的`docker-compose.yml`文件用于快速搭建存在漏洞的环境，方便验证。`exploit.py` 脚本执行攻击， 通过fuzzing proc文件描述符，将恶意payload注入到nginx的配置中，导致远程代码执行。

**漏洞利用方式：**

1.  **环境准备：** 搭建存在漏洞版本的 ingress-nginx 的 Kubernetes 环境（例如使用 `docker-compose.yml`）。
2.  **构造恶意Ingress资源：**  攻击者需要创建或更新一个Ingress资源，其中包含特制的 `nginx.ingress.kubernetes.io/auth-url` 注释。该注释包含一个指向本地文件系统的路径，该路径用于覆盖SSL引擎。
3.  **发送请求：**  将构造的Ingress资源发送到 Kubernetes API 服务器，触发 Validating Admission Controller 的验证流程。
4.  **路径遍历：**  利用路径遍历漏洞，覆盖  ingress-nginx  的SSL引擎。
5.  **远程代码执行：**  通过覆盖SSL引擎文件，实现远程代码执行。

**投毒风险分析：**

尽管提供的 POC 代码主要功能是漏洞利用，但仍存在一定程度的投毒风险，约为10%。主要体现在以下几个方面：

1.  **Shell 文件内容：** POC 中需要用户提供一个 shell 文件 (`shell_file`)，这个 shell 文件的内容是完全由攻击者控制的。如果用户使用了恶意 shell 文件，就可能导致受害者系统被植入后门、信息泄露等问题。
2.  **Payload执行:** PoC覆盖SSL引擎，恶意代码会被Ingress Controller加载并执行，执行时机和权限依赖于Ingress Controller的运行方式。若Ingress Controller以特权模式运行，危害更大。
3.  **潜在后门：**  作者可能在提供的脚本中添加了额外的功能，例如收集目标环境信息、留下隐蔽的后门等。虽然目前的代码没有明显体现，但需要保持警惕。

**项目地址:** [salt318/CVE-2025-1974](https://github.com/salt318/CVE-2025-1974)

**漏洞详情:** [CVE-2025-1974](https://nvd.nist.gov/vuln/detail/CVE-2025-1974)