## CVE-2025-29927-Next.js-Authorization Bypass

**漏洞编号:** CVE-2025-29927

**漏洞类型:** Authorization Bypass

**影响应用:** Next.js

**危害等级:** 高危，可能导致未授权访问、数据泄露和权限提升

**影响版本:** >= 11.1.4, <= 13.5.6, > 14.0.0, < 14.2.25, > 15.0.0, < 15.2.3

**利用条件:** 需要目标应用使用受影响版本的Next.js，并且授权检查位于middleware中。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2025-29927 是 Next.js 中间件授权绕过漏洞。攻击者可以通过发送包含 `x-middleware-subrequest` 标头的恶意请求，绕过 Next.js 应用中的授权检查。

**有效性评估：**
根据漏洞库信息、搜索引擎结果和提供的漏洞利用代码，可以确认该漏洞是有效的。漏洞库信息明确指出该漏洞的存在，并提供了受影响的版本范围。搜索引擎结果提供了多个关于该漏洞的描述、分析和利用的文章，进一步证实了其有效性。提供的漏洞利用代码包含Dockerfile、docker-compose.yaml等文件，说明这是一个可运行的PoC，可以用来验证漏洞。

**投毒风险分析：**
PoC 代码本身主要用于搭建一个包含漏洞的 Next.js 环境以便进行测试和验证。尽管如此，仍然存在一定的投毒风险，虽然概率较低：
*   **Docker镜像构建过程：** `Dockerfile` 中 `RUN npm install` 这一步如果存在恶意依赖，可能引入后门。但是，直接查看 `package-lock.json` 和 `package.json` 文件，未发现明显的恶意依赖。
*   **环境变量：** `docker-compose.yaml` 中定义了 `NODE_ENV=production`，理论上生产环境下的代码不应该包含调试或后门性质的代码，但仍需检查应用自身的代码。
*   **应用代码：** 真正的投毒风险在于 `/tmp/d0027c9d9688f1cef43f23884faaaf80/next-auth-middleware` 中的应用代码。虽然这里没有直接展示这些代码，但是如果应用代码本身包含故意设计的后门，那么即使 Dockerfile 和依赖没有问题，仍然存在风险。假设检查应用代码发现其中存在可疑行为的概率为 10%。

**利用方式：**
1.  攻击者发送包含 `x-middleware-subrequest` 标头的 HTTP 请求。
2.  Next.js 中间件在处理请求时，由于不正确的验证逻辑，未能正确执行授权检查。
3.  攻击者绕过授权，可以访问受保护的资源或执行未经授权的操作。

**缓解措施：**
*   升级 Next.js 版本到 14.2.25 或 15.2.3 或更高版本。
*   如果无法升级，阻止包含 `x-middleware-subrequest` 标头的外部用户请求到达 Next.js 应用。

**项目地址:** [ayato-shitomi/WebLab_CVE-2025-29927](https://github.com/ayato-shitomi/WebLab_CVE-2025-29927)

**漏洞详情:** [CVE-2025-29927](https://nvd.nist.gov/vuln/detail/CVE-2025-29927)