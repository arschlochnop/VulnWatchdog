## CVE-2024-4367 - PDF.js 任意JavaScript代码执行

**漏洞编号:** CVE-2024-4367

**漏洞类型:** 任意JavaScript代码执行

**影响应用:** Firefox, Firefox ESR, Thunderbird (通过PDF.js)

**危害等级:** 高危，允许在PDF.js上下文中执行任意JavaScript代码，可能导致信息泄露，远程代码执行等。

**影响版本:** Firefox < 126, Firefox ESR < 115.11, Thunderbird < 115.11

**利用条件:** 用户需要打开恶意的PDF文件。PDF.js 必须配置为 isEvalSupported=true (默认)

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-4367 是一个存在于 PDF.js 中的漏洞，由于在处理字体时缺少类型检查，允许在 PDF.js 上下文中执行任意 JavaScript 代码。攻击者可以构造恶意的 PDF 文件，当受害者使用存在漏洞的 Firefox、Firefox ESR 或 Thunderbird 版本打开该文件时，即可触发漏洞。 

**有效性：**
提供的PoC代码是有效的。`CVE-2024-4367.py` 脚本用于生成包含恶意 JavaScript 代码的 PDF 文件。 README.md 提供了使用示例，包括执行 `alert(document.domain)` 以证明 JavaScript 代码执行，以及利用 `require('child_process').exec()` 执行操作系统命令（仅在 Electron 环境下）。

**投毒风险：**
PoC 代码本身是为了利用漏洞，而不是植入后门，其目的是生成包含恶意 JavaScript 的 PDF 文件，该文件旨在利用目标应用程序（Firefox, Thunderbird）中的漏洞。 该仓库中投毒的风险较低，大约为 5%。 主要的潜在风险可能来自：

1.  **依赖项投毒:** 脚本本身很简单，不依赖于外部库。因此，依赖项投毒的风险很低。
2.  **代码逻辑混淆:**  代码相对清晰，没有明显的恶意逻辑或混淆。
3.  **供应链攻击:** 由于该 PoC 是一个独立的脚本，并没有复杂的构建或分发过程，供应链攻击的风险也较低。

然而，在使用任何第三方提供的漏洞利用代码时，都应保持谨慎，仔细审查代码，并在隔离环境中测试，以避免潜在的风险。

**利用方式：**

1.  **漏洞点：** PDF.js 在处理字体时的类型检查缺失。
2.  **攻击向量：** 构造恶意的 PDF 文件，该文件利用字体处理中的漏洞嵌入恶意 JavaScript 代码。
3.  **利用步骤：**
    *   使用 `CVE-2024-4367.py` 脚本生成恶意的 `poc.pdf` 文件，指定要执行的 JavaScript 代码作为参数。
    *   诱导受害者使用存在漏洞的 Firefox, Firefox ESR 或 Thunderbird 打开该 `poc.pdf` 文件。
    *   如果 PDF.js 配置允许执行 JavaScript 代码（默认情况下 `isEvalSupported` 为 true），则嵌入在 PDF 中的 JavaScript 代码将在 PDF.js 的上下文中执行。
4.  **潜在影响：** 成功利用此漏洞可能允许攻击者执行任意 JavaScript 代码，从而导致:
    *   在浏览器上下文中窃取敏感信息（例如，cookies，会话令牌）。
    *   进行跨站脚本攻击（XSS）。
    *   如果 PDF.js 运行在 Electron 等环境中，可能执行任意操作系统命令。

**项目地址:** [LOURC0D3/CVE-2024-4367-PoC](https://github.com/LOURC0D3/CVE-2024-4367-PoC)

**漏洞详情:** [CVE-2024-4367](https://nvd.nist.gov/vuln/detail/CVE-2024-4367)