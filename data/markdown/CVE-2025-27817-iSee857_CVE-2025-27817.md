## CVE-2025-27817-Apache Kafka Client-任意文件读取/SSRF

**漏洞编号:** CVE-2025-27817

**漏洞类型:** 任意文件读取/SSRF

**影响应用:** Apache Kafka Client

**危害等级:** 高危，可能导致敏感信息泄露、SSRF攻击，以及在Kafka Connect中提权

**影响版本:** 3.1.0 <= Apache Kafka <= 3.9.0

**利用条件:** 需要Kafka Connect REST API可访问，且允许客户端配置SASL/OAUTHBEARER相关参数

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2025-27817 存在于 Apache Kafka Client 中，由于对 SASL/OAUTHBEARER 连接的配置数据处理不当。攻击者可以通过 `sasl.oauthbearer.token.endpoint.url` 和 `sasl.oauthbearer.jwks.endpoint.url` 参数，读取服务器上的任意文件或发起 SSRF 攻击。

**漏洞利用方式：**

1.  攻击者利用 Kafka Connect REST API 创建或修改 Connector 配置。
2.  在 Connector 配置中，设置 `producer.override.sasl.oauthbearer.token.endpoint.url` 为 `file:///etc/passwd`（或其他目标文件）以进行任意文件读取，或者设置为恶意 URL 以进行 SSRF 攻击。
3.  通过重启 Connector 触发漏洞。
4.  如果成功，服务器的错误日志中将包含被读取的文件内容，或者服务器会向恶意 URL 发起请求。

**POC 分析：**

提供的 Python POC 代码模拟了上述过程。它首先尝试创建一个恶意的 Kafka Connect Connector，然后重启该 Connector，最后检查 Connector 的状态，判断是否成功读取了 `/etc/passwd` 文件。如果 `/etc/passwd` 的内容出现在响应中，则认为漏洞存在。

**投毒风险分析：**

代码中存在微小的投毒风险，例如修改读取的文件路径为关键的配置文件，但总体风险较低，因为主要目的是验证漏洞。一些免责声明也出现在文档中，说明代码仅供研究目的使用。风险评估为5%。主要风险在于如果脚本被用于扫描，可能会给目标系统带来不必要的负载。

**缓解措施：**

*   升级到 Apache Kafka 3.9.1 或更高版本，并设置 `-Dorg.apache.kafka.sasl.oauthbearer.allowed.urls` 系统属性来限制允许的 URL。
*   不要允许不受信任的来源配置 Kafka Connect Connector。

**项目地址:** [iSee857/CVE-2025-27817](https://github.com/iSee857/CVE-2025-27817)

**漏洞详情:** [CVE-2025-27817](https://nvd.nist.gov/vuln/detail/CVE-2025-27817)