## CVE-2024-32002 - Git 递归克隆远程代码执行漏洞

**漏洞编号:** CVE-2024-32002

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Git

**危害等级:** 高危，可导致完全控制受害者机器

**影响版本:** 受影响版本包括 2.39.4 之前的所有版本，以及 2.40.0 到 2.40.2，2.41.0，2.42.0 到 2.42.2，2.43.0 到 2.43.4，2.44.0 和 2.45.0。

**利用条件:** 受害者需要使用受影响的Git版本克隆恶意构造的包含submodule的仓库，并且需要在大小写不敏感的文件系统上克隆。

**POC 可用性:** 是

**投毒风险:** 20%

## 详情

CVE-2024-32002 漏洞存在于 Git 的 submodule 处理中。恶意攻击者可以构造包含恶意 submodule 的 Git 仓库，当受害者使用 `git clone --recurse-submodules` 命令克隆该仓库时，Git 会被诱导将文件写入 `.git/` 目录而不是 submodule 的工作目录。攻击者可以在 `.git/hooks` 目录下写入恶意 hook 脚本，这些脚本会在克隆操作期间执行，从而实现远程代码执行。攻击成功的关键在于利用了大小写不敏感文件系统的特性，使得恶意文件能够覆盖 `.git/` 目录下的合法文件。

**有效性评估：** 根据漏洞库信息和搜索结果（特别是 webpage 5），该漏洞的PoC是可用的，并且描述了利用方式。

**投毒风险评估：** 提供的 PoC 代码 `post-checkout` 脚本主要执行以下操作：

*   显示一段消息。
*   打开计算器程序 (`calc.exe`)，这是一个常见的 PoC 行为。
*   打开 Edge 浏览器并播放 YouTube 视频，同样是 PoC 行为，表明代码执行。
*   在用户 Home 目录下的每个目录中创建一个名为 `trace.txt` 的文件，写入一段消息。

虽然 PoC 代码本身没有明显的恶意行为，但创建 `trace.txt` 文件的操作可能被滥用。如果攻击者精心构造 `trace.txt` 的内容，例如包含恶意脚本或者利用其他漏洞的 payload，可能会造成进一步的危害。因此，存在一定的投毒风险，但风险相对较低，因为其行为是比较明显的。所以判定投毒概率为20%。

**利用方式：**

1.  攻击者创建一个包含恶意 submodule 的 Git 仓库。
2.  恶意 submodule 中包含一个精心构造的 `.git/hooks/post-checkout` 脚本，该脚本包含攻击 payload。
3.  攻击者诱导受害者使用 `git clone --recurse-submodules` 命令克隆该仓库。
4.  当 Git 处理 submodule 时，会将恶意 `post-checkout` 脚本写入受害者机器的 `.git/hooks` 目录下。
5.  Git 在克隆完成后会自动执行 `post-checkout` 脚本，从而执行攻击 payload，实现远程代码执行。

**缓解措施：**

*   升级 Git 到已修复的版本。
*   禁用 symbolic link 支持 (`git config --global core.symlinks false`)，但这可能会影响正常的 Git 使用。
*   避免克隆来自不受信任来源的仓库。


**项目地址:** [Julian-gmz/hook_CVE-2024-32002](https://github.com/Julian-gmz/hook_CVE-2024-32002)

**漏洞详情:** [CVE-2024-32002](https://nvd.nist.gov/vuln/detail/CVE-2024-32002)