## CVE-2024-11392-Hugging Face Transformers MobileViTV2反序列化远程代码执行漏洞

**漏洞编号:** CVE-2024-11392

**漏洞类型:** 反序列化

**影响应用:** Hugging Face Transformers

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 940fde8dafaecb8f17b588c5078291f1c1a420c8 及更早版本

**利用条件:** 目标用户需要访问恶意页面或打开恶意文件, 且运行`convert_mlcvnets_to_pytorch.py`脚本并加载恶意配置文件

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-11392是Hugging Face Transformers MobileViTV2中的一个反序列化漏洞。攻击者可以构造恶意的YAML配置文件，当目标用户使用`convert_mlcvnets_to_pytorch.py`脚本处理该文件时，由于使用了`yaml.load(yaml_file, Loader=yaml.FullLoader)`函数进行不安全的反序列化，会导致远程代码执行。

**漏洞分析:**
该漏洞的根本原因是`convert_mlcvnets_to_pytorch.py`脚本使用了`yaml.FullLoader`来加载YAML文件，而`FullLoader`会执行YAML文件中包含的Python代码。

**利用方式:**
1.  攻击者创建一个恶意的YAML配置文件，其中包含执行任意代码的payload。例如，提供的`malicious.yaml`文件包含打开反向shell的payload。
2.  攻击者将该恶意YAML文件与一个看似正常的ml-cvnet模型一起分发。
3.  受害者下载了该模型及其配置后，使用`convert_mlcvnets_to_pytorch.py`脚本来转换模型。
4.  当脚本加载恶意的YAML配置文件时，payload会被执行，从而导致远程代码执行。

**POC有效性:**
提供的POC代码（`malicious.yaml`）通过利用`yaml.load`函数进行反序列化时执行`os.system`命令，因此**有效**。

**投毒风险分析:**
检查提供的漏洞利用代码（`LICENSE`, `README.md`, `malicious.yaml`）。代码库包含一个`LICENSE`文件，赋予用户使用、复制、修改、合并、发布、分发、许可和/或销售副本的权限，且不包含任何担保。`README.md` 文件详细描述了漏洞以及利用方式。`malicious.yaml`文件包含漏洞利用的payload。综上所述，没有发现任何作者隐藏的投毒代码。因此，评估投毒风险为**0%**。

**修复建议:**
将`yaml.load(yaml_file, Loader=yaml.FullLoader)`替换为`yaml.safe_load(yaml_file)`，以避免执行YAML文件中包含的任意Python代码。

**项目地址:** [Piyush-Bhor/CVE-2024-11392](https://github.com/Piyush-Bhor/CVE-2024-11392)

**漏洞详情:** [CVE-2024-11392](https://nvd.nist.gov/vuln/detail/CVE-2024-11392)