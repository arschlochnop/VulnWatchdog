## CVE-2024-28397-js2py沙箱逃逸

**漏洞编号:** CVE-2024-28397

**漏洞类型:** 沙箱逃逸/远程代码执行

**影响应用:** js2py

**危害等级:** 高危，允许攻击者执行任意代码

**影响版本:** <= 0.74

**利用条件:** 需要目标应用使用js2py库并且允许执行JavaScript代码

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-28397是js2py <= 0.74版本中的一个沙箱逃逸漏洞。攻击者可以通过精心构造的JavaScript代码，利用js2py的缺陷，绕过沙箱环境的限制，执行任意Python代码甚至系统命令。

**有效性分析：**

根据漏洞信息、搜索结果和提供的POC代码，该漏洞利用是有效的。POC代码清晰地展示了如何通过JavaScript访问Python对象层级结构，找到`subprocess.Popen`类，并利用它执行任意命令。搜索引擎结果也表明该漏洞已被公开披露，并存在可利用的POC。

**投毒风险分析：**

在提供的POC代码中，主要的投毒风险来自于`exploit.py`脚本中的目标URL和反向shell的IP地址和端口。如果攻击者将恶意payload注入到目标环境中，并诱导用户使用该payload，则存在潜在的风险。

此外，虽然`LICENSE`文件和`README.md`文件本身不包含恶意代码，但攻击者可能会修改这些文件，添加误导性信息或隐藏的payload。

对当前提供的仓库进行分析，认为存在10%的投毒风险。该风险主要体现在，如果攻击者修改了`exploit.py`脚本，植入恶意代码，或者通过其他方式，使用户在不知情的情况下执行恶意操作，则存在潜在的风险。

**漏洞利用方式：**

1.  **利用JavaScript反射机制：** POC代码利用了JavaScript的反射机制，通过`Object.getOwnPropertyNames({}).__class__.__base__.__getattribute__`访问Python的`object`基类。
2.  **遍历Python对象层级结构：** 通过`__subclasses__()`方法，递归地遍历Python对象层级结构，寻找`subprocess.Popen`类。
3.  **执行任意命令：** 找到`subprocess.Popen`类后，创建一个新的进程来执行恶意的反向shell命令。
4.  **建立反向Shell连接：** 通过执行反向shell命令，攻击者可以在目标系统上建立一个反向shell连接，从而完全控制目标系统。

**项目地址:** [naclapor/CVE-2024-28397](https://github.com/naclapor/CVE-2024-28397)

**漏洞详情:** [CVE-2024-28397](https://nvd.nist.gov/vuln/detail/CVE-2024-28397)