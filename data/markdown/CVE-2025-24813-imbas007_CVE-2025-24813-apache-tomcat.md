## CVE-2025-24813-Apache Tomcat Path Equivalence-RCE/信息泄露

**漏洞编号:** CVE-2025-24813

**漏洞类型:** 路径等价/远程代码执行/信息泄露

**影响应用:** Apache Tomcat

**危害等级:** 高危，可能导致远程代码执行，信息泄露以及服务器完全控制

**影响版本:** 11.0.0-M1 <= version <= 11.0.2, 10.1.0-M1 <= version <= 10.1.34, 9.0.0.M1 <= version <= 9.0.98

**利用条件:** 需要 writes enabled for the default servlet (默认禁用), support for partial PUT (默认启用), application 使用 Tomcat 的基于文件的 session 持久化，默认存储位置, application 包含可用于反序列化攻击的库。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2025-24813 是 Apache Tomcat 中的一个路径等价漏洞。攻击者可以利用此漏洞绕过安全限制，通过精心设计的目录遍历序列覆盖关键配置文件，部署 web shell，并可能实现远程代码执行 (RCE)。

**有效性：**
提供的 Nuclei 模板（CVE-2025-24813.yaml）似乎有效。它包含三个请求：
1.  **PUT 请求覆盖 tomcat-users.xml：** 用于创建一个新的管理员用户，从而允许未经授权的访问。
2.  **PUT 请求部署 JSP Web Shell：** 用于在服务器上部署一个简单的 Web Shell，允许执行任意命令。
3.  **GET 请求执行 `id` 命令：**  用于验证 Web Shell 是否已成功部署并且可以执行命令。

该模板使用匹配器来验证请求是否成功，并提取相关信息。`README.md` 文件还提供了关于如何使用该模板和执行 Web Shell 的说明。

**投毒风险：**
虽然 POC 代码本身的目的在于利用漏洞，但其中潜在的投毒风险较低（约 5%）。风险主要存在于以下几个方面：
1.  **Web Shell 功能：** Web Shell 允许执行任意命令，如果攻击者在测试环境之外使用它，可能会造成恶意行为。虽然提供的 Web Shell 相对简单，但攻击者可以修改它以包含恶意功能，例如下载和执行其他恶意软件。
2.  **配置文件覆盖：** 覆盖 `tomcat-users.xml` 文件虽然是利用漏洞的一部分，但如果攻击者使用恶意配置替换该文件，可能会导致服务器不稳定或更容易受到其他攻击。
3.  **第三方依赖：** Nuclei 模板本身依赖于 Nuclei 工具。如果 Nuclei 工具被篡改，则可能存在其他风险。

总体而言，直接投毒的风险较低，因为代码主要集中在利用已知漏洞上。然而，通过 Web Shell 执行恶意操作的可能性仍然存在。

**利用方式：**
利用 CVE-2025-24813 漏洞的步骤如下：
1.  **利用路径等价漏洞：** 攻击者利用 Tomcat 默认 servlet 处理文件上传时存在的路径等价漏洞。通过在文件名中使用 ".." 序列，攻击者可以绕过目录限制，将文件上传到 Tomcat 配置目录或 Web 应用程序的根目录。
2.  **覆盖 `tomcat-users.xml` 文件：** 攻击者使用 PUT 请求将包含恶意用户的 `tomcat-users.xml` 文件上传到 `../conf/` 目录。此文件覆盖现有的 `tomcat-users.xml` 文件，从而创建一个具有管理员权限的新用户。
3.  **部署 Web Shell：** 攻击者使用 PUT 请求将 JSP Web Shell 文件上传到 Web 应用程序的根目录（`../webapps/ROOT/`）。此 Web Shell 允许攻击者在服务器上执行任意命令。
4.  **执行任意命令：** 攻击者使用浏览器访问 Web Shell 的 URL，并通过 `cmd` 参数执行任意命令。例如，`http://target.com/updates.jsp?cmd=id` 命令将显示服务器的用户 ID 信息。

**需要注意的是，默认情况下，Tomcat 的 default servlet 的写入是禁用的，需要手动启用。** 除此之外，如果启用了基于文件的 session 持久化，并且应用包含了可用于反序列化攻击的库，则可以通过上传恶意的 session 文件来实现 RCE。

攻击者可以通过上传恶意文件，执行任意代码，并完全控制受影响的 Tomcat 服务器。

**项目地址:** [imbas007/CVE-2025-24813-apache-tomcat](https://github.com/imbas007/CVE-2025-24813-apache-tomcat)

**漏洞详情:** [CVE-2025-24813](https://nvd.nist.gov/vuln/detail/CVE-2025-24813)