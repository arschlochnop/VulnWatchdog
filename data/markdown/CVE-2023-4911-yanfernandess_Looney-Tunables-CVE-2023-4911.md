## CVE-2023-4911 Looney Tunables 本地权限提升

**漏洞编号:** CVE-2023-4911

**漏洞类型:** 缓冲区溢出

**影响应用:** glibc (ld.so)

**危害等级:** 高危，本地权限提升至root

**影响版本:** glibc 2.34 至 glibc 2.39（不含）

**利用条件:** 需要本地用户权限，目标系统glibc版本在受影响范围内，程序需要SUID权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-4911 漏洞（Looney Tunables）是 GNU C 库 (glibc) 动态链接器 ld.so 中发现的缓冲区溢出漏洞。该漏洞出现在处理 GLIBC_TUNABLES 环境变量时。攻击者可以利用此漏洞，通过构造恶意的 GLIBC_TUNABLES 环境变量，在使用 SUID 权限启动二进制文件时，执行具有提升权限的代码。

**有效性：**
提供的 PoC 代码利用了该漏洞。`exp.c` 文件包含利用此漏洞的exp代码。`gen_libc.py` 生成一个恶意的 `libc.so.6` 文件，该文件被利用来劫持程序执行流程。

**投毒风险：**
代码仓库中存在轻微的投毒风险。虽然核心的漏洞利用代码看起来是合法的，但`gen_libc.py` 的功能是生成自定义的libc.so.6，如果该脚本中包含恶意代码，则可能导致生成的libc.so.6包含后门或恶意功能。尽管如此，主要的利用流程依赖于缓冲区溢出，所以投毒风险相对较低，约为 10%。

**利用方式：**
1.  **生成恶意 libc.so.6：** 使用 `gen_libc.py` 脚本生成一个特制的 `libc.so.6` 文件。这个文件应该包含一些用于利用漏洞的payload。
2.  **编译漏洞利用程序：** 使用 `gcc` 编译 `exp.c` 文件。这个程序将设置必要的环境变量并执行 SUID 程序。
3.  **设置环境变量：** 漏洞利用程序设置 `GLIBC_TUNABLES` 环境变量，并设置大量的环境变量填充内存，以及使用特制的 `dt_rpath` 变量。
4.  **执行 SUID 程序：** 漏洞利用程序使用 `execve` 函数执行一个具有 SUID 权限的程序，如 `/usr/bin/su`。由于设置了恶意的 `GLIBC_TUNABLES` 环境变量，`ld.so` 加载器在处理这个环境变量时会触发缓冲区溢出。
5.  **权限提升：** 缓冲区溢出允许攻击者覆盖内存中的重要区域，进而劫持程序的控制流。通过覆盖返回地址或其他关键数据，攻击者可以执行任意代码，通常是提权的代码，最终获得 root 权限。

**项目地址:** [yanfernandess/Looney-Tunables-CVE-2023-4911](https://github.com/yanfernandess/Looney-Tunables-CVE-2023-4911)

**漏洞详情:** [CVE-2023-4911](https://nvd.nist.gov/vuln/detail/CVE-2023-4911)