## CVE-2016-3088 - Apache ActiveMQ Fileserver 任意文件上传/RCE

**漏洞编号:** CVE-2016-3088

**漏洞类型:** 任意文件上传/远程代码执行

**影响应用:** Apache ActiveMQ

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** 5.x before 5.14.0

**利用条件:** 需要目标ActiveMQ的Fileserver应用启用且未配置安全限制，需要知道管理账号密码，默认账号密码为admin/admin

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2016-3088 存在于 Apache ActiveMQ 的 Fileserver Web 应用中。攻击者可以通过先使用 HTTP PUT 请求上传任意文件，然后使用 HTTP MOVE 请求将文件移动到 Web 目录，从而实现任意代码执行。

**有效性分析：**
提供的POC代码`CVE-2016-3088.py`利用了该漏洞。代码首先检查 fileserver 是否启用，然后尝试使用默认凭据 `admin:admin` 登录。如果成功，它会尝试获取 `activemq.home` 属性以确定 ActiveMQ 的安装路径。然后，它会上传一个包含恶意代码的 jsp 文件，并使用 MOVE 请求将其移动到 `webapps/api` 目录下。如果成功，攻击者就可以通过访问 `host/api/evil.jsp?pwd=9527&i=whoami` 来执行任意命令。

**投毒风险分析：**
POC代码中，主要风险在于以下几点：

*   **webshell内容：** POC 提供了 webshell 的内容，但用户可以自行修改，所以 webshell 本身不是投毒点。但恶意用户可能会替换成具有恶意功能的 webshell。
*   **利用流程：**  整个利用流程相对清晰，虽然存在修改 webshell 的可能，但不会引入额外的恶意代码。程序目的是getshell，实现逻辑较为完善，暂未发现明显的投毒代码。 综合判断，投毒风险较低，但是需要人工审计修改后的webshell。

基于上述分析，该仓库中存在作者隐藏的投毒代码的风险约为 10%。风险主要来源于用户是否使用了作者提供的webshell payload。

**利用方式：**

1.  使用 HTTP PUT 请求上传一个包含恶意代码的 JSP 文件到 Fileserver。文件名可以为任意名称，例如 `noharm.txt`。
2.  使用 HTTP MOVE 请求将上传的文件移动到 ActiveMQ Web 应用的 Web 目录下，例如 `webapps/api/evil.jsp`。`Destination` header 需要设置为目标路径。
3.  通过访问移动后的 JSP 文件，执行其中的恶意代码，从而实现远程代码执行。

该漏洞利用成功的关键在于目标 ActiveMQ 实例的 Fileserver 应用已启用，并且攻击者能够获取到 ActiveMQ 的安装路径。默认的admin/admin弱口令也大大增加了漏洞的利用成功率。升级到 5.14.0 或更高版本是修复此漏洞的建议方法。

**项目地址:** [cl4ym0re/CVE-2016-3088](https://github.com/cl4ym0re/CVE-2016-3088)

**漏洞详情:** [CVE-2016-3088](https://nvd.nist.gov/vuln/detail/CVE-2016-3088)