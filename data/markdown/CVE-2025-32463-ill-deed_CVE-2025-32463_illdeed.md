## CVE-2025-32463-Sudo-本地提权

**漏洞编号:** CVE-2025-32463

**漏洞类型:** 本地提权

**影响应用:** Sudo

**危害等级:** 高危，本地用户可以获得root权限

**影响版本:** 1.9.14 <= version < 1.9.17p1

**利用条件:** 需要本地shell访问权限，并且sudo版本在受影响范围内，sudo -R命令不需要密码

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2025-32463是一个存在于Sudo 1.9.14到1.9.17p1版本中的本地提权漏洞。该漏洞的利用方式是，攻击者可以利用`sudo -R`选项指定一个用户可控的目录作为chroot根目录，并在该目录下放置一个恶意的`/etc/nsswitch.conf`文件。当sudo尝试在chroot环境中查找用户时，会加载用户指定的`/etc/nsswitch.conf`，从而加载攻击者构造的恶意NSS模块（`.so`文件），并在root权限下执行其中的代码。 

**POC有效性分析：**
提供的POC代码通过以下步骤利用该漏洞：
1.  创建一个临时目录作为工作目录。
2.  创建一个假的chroot环境`fake_root`，包含恶意的`/etc/nsswitch.conf`，指向`/illdeed`。
3.  编写一个包含恶意代码的C程序`illdeed.c`，该程序使用`setreuid(0, 0)`和`setregid(0, 0)`来改变用户ID和组ID为root，然后执行一个shell，或指定的命令。
4.  使用gcc将`illdeed.c`编译成动态链接库`libnss_illdeed.so.2`，并放置在`fake_root`下，位置为 `/illdeed`。
5.  使用`sudo -R fake_root`命令运行shell，这将导致加载恶意的NSS模块，从而以root权限执行`illdeed.c`中的代码。

**投毒风险分析：**
该POC代码的主要功能是提权。投毒风险在于`illdeed.c`中的代码，虽然示例中是直接提权执行shell，但可以被修改为执行其他恶意操作，例如植入后门，窃取敏感数据等。此外，该PoC在README中声明会创建一个名为`illdeed`的payload，用于追踪和分析，这本身也可能被认为是某种形式的“投毒”，尽管目的是为了安全测试。综合考虑，此处判断投毒风险为10%，主要风险在于使用者恶意篡改`illdeed.c`。

**漏洞利用方式总结：**
1.  准备：在用户可控目录下，构造包含恶意配置文件的chroot环境（`/etc/nsswitch.conf`）和恶意的NSS模块。
2.  触发：使用`sudo -R <chroot_path>`命令，使sudo加载用户提供的恶意NSS模块。
3.  利用：恶意NSS模块中的代码将在root权限下执行，从而实现提权。

**项目地址:** [ill-deed/CVE-2025-32463_illdeed](https://github.com/ill-deed/CVE-2025-32463_illdeed)

**漏洞详情:** [CVE-2025-32463](https://nvd.nist.gov/vuln/detail/CVE-2025-32463)