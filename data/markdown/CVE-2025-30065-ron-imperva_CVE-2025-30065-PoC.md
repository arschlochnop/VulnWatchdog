## CVE-2025-30065-Apache Parquet-反序列化漏洞

**漏洞编号:** CVE-2025-30065

**漏洞类型:** 反序列化漏洞

**影响应用:** Apache Parquet Java (parquet-avro module)

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** <= 1.15.0

**利用条件:** 需要能够上传或控制Parquet文件的Avro schema

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2025-30065是Apache Parquet Java库中parquet-avro模块的一个反序列化漏洞。攻击者可以通过构造恶意的Parquet文件，特别是其中的Avro schema，利用不安全的反序列化机制执行任意代码。漏洞存在于1.15.0及之前的版本。根据漏洞库信息，CVSS v4.0评分为10.0，为最高危等级，表明该漏洞易于利用且影响严重。

**有效性分析：**

根据提供的漏洞利用代码（Dockerfile、README.md、entrypoint.sh、pom.xml、GeneratePayload.java、MaliciousObject.java、TriggerVuln.java），可以判断该POC代码是有效的。Dockerfile构建了一个包含易受攻击的Apache Parquet版本的环境，并且包含了生成恶意Parquet文件以及触发漏洞的必要组件。README提供了使用说明，包括构建Docker镜像，生成恶意Parquet文件，以及触发漏洞的步骤。

**投毒风险分析：**

分析POC代码后，没有发现作者隐藏的恶意代码。代码的功能集中于利用反序列化漏洞生成payload和触发漏洞，没有额外连接外部服务器、修改系统配置或执行其他恶意操作的部分。
* `Dockerfile`: 用于构建包含漏洞环境的Docker镜像。没有发现恶意行为。
* `README.md`: 提供使用说明，不包含任何代码。
* `entrypoint.sh`: 用于执行Java程序，根据参数选择生成payload或触发漏洞，没有发现恶意行为。
* `pom.xml`: 定义项目依赖，其中`parquet-avro`的版本为1.12.0，存在漏洞。
* `GeneratePayload.java`: 用于生成包含恶意payload的Parquet文件。它将一个实现了`Serializable`接口的`MaliciousObject`类序列化后，写入Parquet文件。`MaliciousObject`在反序列化时会执行预定义的命令。
* `MaliciousObject.java`: 实现了`Serializable`接口，并在反序列化时执行命令。这个是漏洞利用的核心，但本身不是投毒代码。
* `TriggerVuln.java`: 用于读取Parquet文件并触发反序列化漏洞。没有发现恶意行为。

因此，投毒风险估计为0%。

**利用方式：**

1.  **构建包含漏洞版本的环境：** 使用Dockerfile构建包含Apache Parquet Java库（版本<= 1.15.0）的环境。
2.  **生成恶意Parquet文件：** 运行`GeneratePayload`类，指定要执行的命令和输出文件名。`GeneratePayload`会将包含恶意`MaliciousObject`对象的序列化数据嵌入到Parquet文件的Avro schema中。
3.  **触发漏洞：** 运行`TriggerVuln`类，指定恶意Parquet文件。`TriggerVuln`会读取Parquet文件的Avro schema，并反序列化其中的恶意对象，从而执行任意代码。

**缓解措施：**
升级到Apache Parquet Java 1.15.1或更高版本可以修复此漏洞。

**项目地址:** [ron-imperva/CVE-2025-30065-PoC](https://github.com/ron-imperva/CVE-2025-30065-PoC)

**漏洞详情:** [CVE-2025-30065](https://nvd.nist.gov/vuln/detail/CVE-2025-30065)