## CVE-2022-0847

**漏洞编号:** CVE-2022-0847

**漏洞类型:** 本地权限提升

**影响应用:** Linux Kernel

**危害等级:** 高危，允许本地用户提升权限至 root

**影响版本:** Linux Kernel 5.8+

**利用条件:** 需要本地用户权限

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-0847，也被称为 “Dirty Pipe”，是一个 Linux 内核中的本地权限提升漏洞。该漏洞允许未经授权的本地用户覆盖只读文件中的内容，从而提升权限。漏洞根源在于 `copy_page_to_iter_pipe` 和 `push_pipe` 函数中，新的 pipe buffer 结构的 "flags" 成员缺乏适当的初始化，可能包含陈旧的值。漏洞利用方式如下：

1.  **打开目标文件：** 首先，攻击者以只读方式打开`/etc/passwd`文件。
2.  **创建管道：** 创建一个管道 (`pipe`) 用于数据传输。
3.  **填充管道：**  通过写入并读取管道来初始化管道缓冲区。
4.  **splice 注入：** 使用 `splice` 系统调用将目标文件（`/etc/passwd`）的部分内容注入到管道中。`splice` 的关键在于利用未初始化的标志位。
5.  **写入恶意 payload：** 紧接着，攻击者将恶意的 payload（在本例中是修改 root 密码的字符串）写入管道。这个 payload 会覆盖先前通过 `splice` 注入的部分文件内容。
6.  **利用完成：**  由于管道机制，payload 会被写入到文件系统中，从而修改了 `/etc/passwd` 文件，导致 root 密码被清除。下次重启或者使用`passwd`命令修改密码时生效。

**关于有效性：** 从搜索引擎结果和漏洞库信息来看，该漏洞已经被广泛研究，存在大量可用的 POC 代码。提供的 POC 代码直接修改`/etc/passwd`文件，清除root密码，是一种有效的利用方式。

**关于投毒风险：**  代码本身功能明确,就是修改`/etc/passwd`文件，清除root密码。但仍存在一些细微的投毒可能，例如在编译时通过编译器选项引入恶意代码，或者利用一些不常见的库函数实现恶意功能。因此认为存在**非常低**的投毒风险。即使加入恶意代码，例如反弹shell等，成功概率也不高，因为`/etc/passwd`文件属于关键系统文件，篡改会直接影响系统稳定性。

**综上所述，**提供的 POC 代码是有效的，且具备较低的投毒风险。

**项目地址:** [Shadow-Spinner/CVE-2022-0847](https://github.com/Shadow-Spinner/CVE-2022-0847)

**漏洞详情:** [CVE-2022-0847](https://nvd.nist.gov/vuln/detail/CVE-2022-0847)