## CVE-2023-38646-Metabase-RCE

**漏洞编号:** CVE-2023-38646

**漏洞类型:** 远程代码执行(RCE)

**影响应用:** Metabase

**危害等级:** 高危，允许未经身份验证的攻击者以服务器权限执行任意命令

**影响版本:** Metabase open source versions before 0.46.6.1 and Metabase Enterprise versions before 1.46.6.1

**利用条件:** 目标Metabase实例运行在受影响的版本，且网络可达。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2023-38646是一个存在于Metabase 0.46.6.1之前版本和Metabase Enterprise 1.46.6.1之前版本的远程代码执行漏洞。攻击者无需身份验证即可利用此漏洞，通过精心构造的请求，在服务器上执行任意命令，从而完全控制系统。

**利用方式：**

1.  **获取Setup Token:** POC脚本首先尝试从`/api/session/properties`端点获取setup-token，这个token用于后续的利用。
2.  **构造恶意Payload:**  脚本构造一个包含恶意H2数据库连接字符串的JSON payload。该连接字符串利用H2数据库的特性，在连接时执行任意Java代码。具体来说，它创建了一个触发器，在访问 `INFORMATION_SCHEMA.TABLES` 表时执行一段 JavaScript 代码。
3.  **执行命令:**  JavaScript 代码调用 `java.lang.Runtime.getRuntime().exec()` 来执行一个包含base64编码的bash命令。此命令解码并执行反向shell命令。
4.  **发送Payload:**  构造好的payload通过POST请求发送到`/api/setup/validate`端点。
5.  **反向Shell:**  如果漏洞利用成功，攻击者将在指定的IP地址和端口上获得一个反向shell。

**投毒风险分析：**

提供的代码主要是利用漏洞获取反向shell。通过检查代码，没有发现明显的恶意代码，例如删除文件、传播恶意软件等。代码结构清晰，目的是利用漏洞。虽然代码本身是为了攻击，但它没有主动进行恶意传播或其他破坏行为。考虑到代码的功能主要是漏洞利用，而非植入后门或进行其他恶意活动，因此判定存在投毒代码的可能性较低。

该项目中可能存在投毒的风险较低，评估结果为1%。

**项目地址:** [Mrunalkaran/CVE-2023-38646](https://github.com/Mrunalkaran/CVE-2023-38646)

**漏洞详情:** [CVE-2023-38646](https://nvd.nist.gov/vuln/detail/CVE-2023-38646)