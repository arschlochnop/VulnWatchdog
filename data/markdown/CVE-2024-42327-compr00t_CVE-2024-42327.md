## CVE-2024-42327-Zabbix-SQL注入

**漏洞编号:** CVE-2024-42327

**漏洞类型:** SQL注入

**影响应用:** Zabbix

**危害等级:** 严重，可能导致权限提升和远程代码执行

**影响版本:** <= 7.0.1, 6.4.16, 6.0.31

**利用条件:** 需要Zabbix前端的非管理员用户账户，且该账户具备API访问权限。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-42327 是 Zabbix 前端中的一个 SQL 注入漏洞，存在于 `CUser` 类的 `addRelatedObjects` 函数中。此函数被 `CUser.get` 函数调用，而 `CUser.get` 可供任何具有 API 访问权限的用户使用。

**漏洞利用的有效性：**

根据提供的漏洞库信息、搜索引擎结果和漏洞利用代码，可以判断该漏洞利用的有效性较高。

*   漏洞库信息明确指出该漏洞的存在，并给出了受影响的版本范围。
*   搜索引擎结果中，多个网页都提到了该漏洞，包括 NVD、Wiz.io、Qualys 等安全厂商的分析报告，进一步证实了该漏洞的存在。
*   POC 代码中提供了一个可用于测试的 SQL 注入 payload，并详细说明了漏洞触发的条件。

**投毒风险：**

通过分析提供的 POC 代码，发现主要的投毒风险较低，大约为5%。虽然存在一个`compose.yaml`文件用于构建docker环境,但是需要注意,如果攻击者修改了`compose.yaml`或者`compose_zabbix_components.yaml`，可能会引入包含恶意镜像或其他恶意配置的容器。

*   `cve-2024-42327.py` 本身是一个相对简单的 Python 脚本，用于验证漏洞的存在，没有发现明显的恶意代码。
*   `README.md` 文件只是提供了漏洞的描述、POC 代码和参考链接，也没有发现恶意内容。
*   docker-compose 文件(`compose.yaml`, `compose_zabbix_components.yaml`)定义了 Zabbix 服务器和代理的容器配置。虽然这些文件本身没有直接的恶意代码，但恶意修改过的docker-compose文件可能导致以下风险：
    *   **使用被污染的镜像：** 攻击者可以修改 docker-compose 文件，将 ZABBIX_SERVER_MYSQL_IMAGE 等变量指向包含恶意软件的镜像仓库。虽然原文件引用了变量，增加了一点分析难度，但是仍然存在被替换镜像的风险
    *   **卷挂载不当：** 可以通过挂载宿主机目录到容器内，实现文件读写，造成数据泄露或篡改。

**利用方式：**

1.  **获取 Zabbix 前端的非管理员用户账户，并确保该账户具有 API 访问权限。**
2.  **使用 `user.login` 方法获取 API 认证 token。**
3.  **构造包含 SQL 注入 payload 的 `user.get` 请求。**Payload 利用了 `selectRole` 参数，通过注入 `SLEEP(5)` 函数来测试 SQL 注入。
4.  **发送构造好的请求到 `/api_jsonrpc.php` 接口。**
5.  **如果服务器响应时间超过 5 秒，则表明存在 SQL 注入漏洞。**

攻击者成功利用此漏洞后，可以执行任意 SQL 查询，从而可能泄露敏感数据、修改系统配置，甚至获取管理员权限，最终实现远程代码执行。

**项目地址:** [compr00t/CVE-2024-42327](https://github.com/compr00t/CVE-2024-42327)

**漏洞详情:** [CVE-2024-42327](https://nvd.nist.gov/vuln/detail/CVE-2024-42327)