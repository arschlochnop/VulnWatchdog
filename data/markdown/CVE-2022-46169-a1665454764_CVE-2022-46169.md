## CVE-2022-46169-Cacti-远程命令执行

**漏洞编号:** CVE-2022-46169

**漏洞类型:** 远程命令执行

**影响应用:** Cacti

**危害等级:** 高危，允许未经身份验证的攻击者执行任意命令

**影响版本:** < 1.2.23

**利用条件:** 目标系统运行Cacti，并且存在具有 'POLLER_ACTION_SCRIPT_PHP' action类型的poller_item。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2022-46169 是 Cacti 1.2.23 之前版本中的一个未经验证的远程命令执行漏洞。攻击者可以通过构造特定的 HTTP 请求，绕过身份验证，并在目标系统上执行任意命令。

**漏洞利用方式：**

1.  **身份验证绕过：** 攻击者通过设置`X-Forwarded-For`等HTTP Header, 伪造客户端 IP 地址，绕过`remote_agent.php`的身份验证。
2.  **命令注入：** 成功绕过身份验证后，攻击者可以通过 `polldata` action，并控制 `poller_id` 参数，将恶意命令注入到 `proc_open` 函数的参数中，从而执行任意系统命令。
3.  **前提条件：** 漏洞利用需要存在一个 `poller_item`，其 `action` 字段设置为 `POLLER_ACTION_SCRIPT_PHP` (值为2)。默认安装的Cacti，很可能存在满足此条件的`poller_item`。
4.  **POC有效性:** 提供的POC代码有效, 利用`remote_agent.php`，设置`X-Forwarded-For` header，构造包含恶意命令的URL,发送请求来执行命令。
5. **投毒风险:** README.md 为漏洞复现步骤，以及github仓库的使用方式说明。POC代码本身除了写入output.txt之外没有发现其他恶意行为。虽然存在一定的风险，例如该代码可能被恶意修改后传播，但当前提供的代码投毒概率较低，大约为1%。该POC的主要功能是检测漏洞是否存在并执行命令，而不是植入后门。

**项目地址:** [a1665454764/CVE-2022-46169](https://github.com/a1665454764/CVE-2022-46169)

**漏洞详情:** [CVE-2022-46169](https://nvd.nist.gov/vuln/detail/CVE-2022-46169)