## CVE-2016-0792-Jenkins-远程代码执行

**漏洞编号:** CVE-2016-0792

**漏洞类型:** 反序列化漏洞

**影响应用:** Jenkins

**危害等级:** 高危，允许远程认证用户执行任意代码

**影响版本:** Jenkins < 1.650 和 LTS < 1.642.2

**利用条件:** 需要Jenkins实例可访问，并且攻击者需要拥有Jenkins的认证用户权限。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2016-0792 漏洞是 Jenkins 中一个严重的反序列化漏洞，存在于 Jenkins 1.650 之前和 LTS 1.642.2 之前的版本中。该漏洞位于多个未指定的 API 接口，允许远程认证用户通过 XML 文件中的序列化数据执行任意代码。该漏洞与 XStream 和 groovy.util.Expando 相关。

**有效性：**

根据漏洞描述和搜索结果，提供的 POC 代码似乎是有效的。搜索结果中包含了 Metasploit 模块，表明存在可利用的漏洞利用。

**投毒风险：**

代码本身的功能是创建一个 Jenkins Job，然后触发执行。Job的内容执行一个名为`/usr/local/bin/exfiltrate`的命令，并将输出结果重定向到`exfiltrate_output.log`。该脚本会循环检查这个命令的进程状态，输出，文件系统变更和exfiltration server 响应，最后会输出`exfiltrate_output.log` 的内容。该脚本中`exfiltrate` 命令并没有提供, 这意味着漏洞使用者需要自行构造该命令，存在一定的风险，

总体来看，该 POC 代码本身存在投毒风险较低，但需要警惕执行的命令 `/usr/local/bin/exfiltrate` 本身可能被恶意利用。

**利用方式：**

1.  **认证：** 攻击者需要拥有一个有效的 Jenkins 用户账号。
2.  **构造Payload：** 攻击者构造包含恶意代码的 XML 格式的 Payload，利用 XStream 反序列化漏洞执行命令。这个 Payload 通常会被嵌入到 Job 的配置中。
3.  **发送请求：** 攻击者将构造好的 Payload 发送到 Jenkins 的 API 接口（如创建 Job 的接口）。
4.  **触发执行：** Jenkins 解析 XML 数据时，会由于 XStream 的反序列化漏洞执行 Payload 中包含的恶意代码，从而导致远程代码执行。
5.  **代码分析:** 漏洞利用代码首先获取 Jenkins 的 crumb 用于绕过 CSRF 保护，然后构造包含恶意命令的 XML 格式 Job 配置，通过 createItem API 创建 Job，并触发 Job 执行。Job 执行后，会不断监控执行结果，并将结果输出到控制台。

**项目地址:** [gonn4cry/CVE-2016-0792](https://github.com/gonn4cry/CVE-2016-0792)

**漏洞详情:** [CVE-2016-0792](https://nvd.nist.gov/vuln/detail/CVE-2016-0792)