## CVE-2023-4911: Glibc ld.so 本地提权漏洞

**漏洞编号:** CVE-2023-4911

**漏洞类型:** 缓冲区溢出

**影响应用:** glibc

**危害等级:** 高危，可导致本地权限提升

**影响版本:** 2.34 <= glibc < 2.39

**利用条件:** 本地用户，目标系统使用存在漏洞的glibc版本，程序具有SUID权限

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2023-4911 漏洞是 glibc 动态链接器 ld.so 在处理 GLIBC_TUNABLES 环境变量时发生的缓冲区溢出漏洞。该漏洞允许本地攻击者在启动具有 SUID 权限的二进制文件时，利用恶意构造的 GLIBC_TUNABLES 环境变量来执行具有提升权限的代码。

**有效性：**

根据漏洞库信息、搜索引擎结果和提供的漏洞利用代码，可以判断该POC代码是有效的。 搜索引擎结果中多个链接（如Qualys的博客、Uptycs的博客）都确认了漏洞的存在和利用的可能性。POC代码也实现了利用 GLIBC_TUNABLES 环境变量进行缓冲区溢出的功能。

**投毒风险：**

分析POC代码，发现主要由Dockerfile，README.md，exp.c，gen_libc.py 四个文件组成。
*   Dockerfile：用于构建包含漏洞利用代码的Docker镜像。
*   README.md：提供漏洞利用的说明和参考链接。
*   exp.c：漏洞利用的C代码，核心部分。该代码通过设置大量的环境变量，特别是 GLIBC_TUNABLES，来触发缓冲区溢出。
*   gen_libc.py：一个python脚本，用于生成包含漏洞的glibc文件。

代码中没有发现明显的恶意代码或后门。`gen_libc.py` 用于生成特定的 libc.so.6 文件，这是漏洞利用的一部分，并非恶意投毒。`exp.c` 尝试利用 `GLIBC_TUNABLES` 环境变量来溢出，从而提权。虽然利用本身具有破坏性，但这属于漏洞利用的正常行为，而不是投毒。

因此，判断此仓库中不存在作者隐藏的投毒代码的可能性为99%。

**利用方式：**

1.  **漏洞原理：** `ld.so` 在加载程序时会解析 `GLIBC_TUNABLES` 环境变量，由于对该环境变量的长度验证不足，导致缓冲区溢出。
2.  **利用过程：**
    *   设置 `GLIBC_TUNABLES` 环境变量为超长字符串，覆盖 `ld.so` 的内存。
    *   `exp.c` 代码通过设置大量的环境变量，特别构造 `GLIBC_TUNABLES`，利用环境变量来覆盖 `l_info[DT_RPATH]`，使其指向攻击者控制的内存区域。
    *   通过 `execve` 执行具有 SUID 权限的程序（如 `/usr/bin/su`），触发动态链接过程。
    *   `ld.so` 在解析被污染的 `l_info[DT_RPATH]` 时，执行攻击者控制的内存区域的代码，从而实现提权。
3.  **先决条件：**
    *   目标系统使用存在漏洞的 glibc 版本。
    *   存在具有 SUID 权限的程序。
    *   攻击者需要具有本地用户权限。

总而言之，CVE-2023-4911 是一个严重的安全漏洞，攻击者可以利用它来提升权限并完全控制受影响的系统。应尽快应用相应的补丁程序。

**项目地址:** [xiaoQ1z/CVE-2023-4911](https://github.com/xiaoQ1z/CVE-2023-4911)

**漏洞详情:** [CVE-2023-4911](https://nvd.nist.gov/vuln/detail/CVE-2023-4911)