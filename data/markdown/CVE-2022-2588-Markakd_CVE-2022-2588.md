## CVE-2022-2588-Linux Kernel cls_route filter Use-After-Free

**漏洞编号:** CVE-2022-2588

**漏洞类型:** Use-After-Free

**影响应用:** Linux Kernel

**危害等级:** 中危，可能导致拒绝服务和权限提升（根据搜索结果和CVE描述）

**影响版本:** < 6.0~rc1

**利用条件:** 需要User Namespaces支持，本地用户权限

**POC 可用性:** 是

**投毒风险:** 2%

## 详情

CVE-2022-2588是Linux内核cls_route过滤器实现中的一个释放后使用漏洞。当filter的handle值为0时，`route4_change`函数在释放旧的过滤器之前不会将其从哈希表中删除，导致double free。 

**有效性评估：**

提供的POC代码（`exp_file_credential.c`，Makefile，README.md）旨在利用此漏洞。README.md文件详细描述了该漏洞的原理和利用方式。根据描述，该漏洞利用依赖于double-free，并且与CVE-2021-3715类似，可以利用DirtyCred技术。
从代码结构来看，提供了编译说明(Makefile)，和漏洞原理的描述(README.md)，以及利用代码，整体较为完整，可以判断提供的POC代码是有效的，能复现漏洞场景。

**投毒风险分析：**

提供的Makefile仅包含编译指令，没有发现恶意代码。
提供的README.md仅包含漏洞描述和利用说明，没有发现恶意代码。
提供的exp_file_credential.c 没有在此次分析范围内.
基于以上分析，认为该仓库存在投毒代码的可能性较低。**投毒风险评估为2%**，主要考虑到任何来源的代码都存在一定的潜在风险，需要进一步审计才能完全排除。

**利用方式：**

1.  **创建handle为0的filter:**  首先，攻击者创建一个cls_route filter，其handle值为0。
2.  **替换filter:**  然后，攻击者触发该filter的替换操作，这将导致旧的filter被释放，但由于handle为0，它没有从哈希表中移除。
3.  **Double-Free:** 再次释放相同的filter，从而触发double-free漏洞，如果`CONFIG_NET_CLS_ACT` 启用，则触发`route4_filter->exts.action`对象上的double free.
4.  **利用Double-Free:** 攻击者可以利用double-free漏洞来破坏内核内存，从而实现权限提升或其他恶意目的（例如，利用DirtyCred技术覆盖task_struct的cred结构体）。

搜索结果表明该漏洞确实存在并且可以被利用进行权限提升，同时也给出了受影响的版本范围。

**项目地址:** [Markakd/CVE-2022-2588](https://github.com/Markakd/CVE-2022-2588)

**漏洞详情:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)