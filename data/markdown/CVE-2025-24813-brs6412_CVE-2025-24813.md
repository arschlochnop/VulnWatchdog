## CVE-2025-24813-Apache Tomcat-Path Equivalence/Deserialization

**漏洞编号:** CVE-2025-24813

**漏洞类型:** 路径等价/反序列化

**影响应用:** Apache Tomcat

**危害等级:** 高危，可能导致信息泄露和远程代码执行

**影响版本:** 9.0.0.M1 <= 9.0.98, 10.1.0-M1 <= 10.1.34, 11.0.0-M1 <= 11.0.2

**利用条件:** Default Servlet 启用写入 (默认禁用), 启用 partial PUT (默认启用), 目标 URL 是公共上传 URL 的子目录（对于信息泄露），或者应用使用 Tomcat 的基于文件的会话持久化且使用默认存储位置，以及应用程序包含可能被利用于反序列化攻击的库（对于 RCE）。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

根据CVE信息和搜索结果，CVE-2025-24813是Apache Tomcat中的一个路径等价漏洞，与DefaultServlet处理文件上传的逻辑相关。如果启用了 DefaultServlet 的写入功能，并且启用了 partial PUT 支持，攻击者可以通过构造包含 `file.Name` (内部点) 的路径来覆盖敏感文件或执行恶意代码。漏洞可能导致远程代码执行、信息泄露，或向已上传文件中添加恶意内容。

**有效性：**

提供的代码是一个利用反序列化漏洞进行远程代码执行的POC。它包含一个易受攻击的Servlet（`ExploitServlet.java`），该Servlet接受序列化的Java对象，并使用 `ObjectInputStream` 对其进行反序列化。`SafeGadget.java` 中提供了一个简单的Gadget，它在反序列化时会写入`/tmp/pwn.txt`。利用方式是上传恶意构造的序列化对象到 `/vuln-app/vulnerable_endpoint`，触发反序列化，从而执行任意代码。结合CVE描述，如果Tomcat配置允许，并满足利用条件（partial PUT, session持久化等），则该POC有效。

**投毒风险：**

从代码上看，投毒的概率较低（约 5%）。主要风险点在于`SafeGadget.java`。尽管名称是 "SafeGadget"，但它实际上执行了文件写入操作。这本身不是投毒，而是漏洞利用的一部分。真正的投毒风险可能在于：

1.  **更隐蔽的后门：** 虽然给出的例子写入 "Pwned!" 到文件，但实际的Gadget可能执行更隐蔽的操作，例如添加用户、执行系统命令等。
2.  **供应链投毒：** 如果攻击者能够控制构建环境，他们可能会修改 `ExploitServlet.java` 或添加额外的依赖项，从而引入后门或恶意功能。

由于给出的代码非常简单，并且漏洞利用的目的是明确的（通过反序列化写入文件），因此直接投毒的风险相对较低。但是，在实际的利用场景中，攻击者可能会使用更复杂的Gadget，从而隐藏恶意行为。

**利用方式：**

1.  **信息泄露/文件覆盖：** 如果满足以下条件：
    *   Default Servlet 启用写入
    *   支持 partial PUT
    *   目标 URL 是公共上传 URL 的子目录
    *   攻击者知道敏感文件名
    *   敏感文件也使用 partial PUT 上传
    攻击者可以使用路径等价绕过，例如 `public_upload/../../sensitive_file.txt` 覆盖敏感文件。
2.  **远程代码执行：** 如果满足以下条件：
    *   Default Servlet 启用写入
    *   支持 partial PUT
    *   应用使用 Tomcat 的基于文件的会话持久化和默认存储位置
    *   应用包含可用于反序列化攻击的库
    攻击者可以利用反序列化漏洞，例如通过上传恶意构造的序列化session文件到session存储目录中，从而执行任意代码。POC代码展示了基本的反序列化利用方式。实际利用中，需要找到Tomcat实例中可用的Gadget链。 

**项目地址:** [brs6412/CVE-2025-24813](https://github.com/brs6412/CVE-2025-24813)

**漏洞详情:** [CVE-2025-24813](https://nvd.nist.gov/vuln/detail/CVE-2025-24813)