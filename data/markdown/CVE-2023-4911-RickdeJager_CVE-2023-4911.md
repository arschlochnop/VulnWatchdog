## CVE-2023-4911 - Glibc ld.so 本地权限提升

**漏洞编号:** CVE-2023-4911

**漏洞类型:** 缓冲区溢出

**影响应用:** glibc

**危害等级:** 高危，本地权限提升至 root

**影响版本:** glibc 2.34 到 2.39 之前版本

**利用条件:** 本地用户，需要目标系统存在 SUID 程序

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-4911 是 glibc 动态链接器 ld.so 中 GLIBC_TUNABLES 环境变量处理不当导致的缓冲区溢出漏洞。攻击者可以通过设置恶意的 GLIBC_TUNABLES 环境变量，在运行具有 SUID 权限的程序时，利用该漏洞执行任意代码，从而提升权限至 root。

**利用方式：**

1.  **环境准备：** 确保目标系统存在存在漏洞的 glibc 版本，并且存在 SUID 程序。
2.  **编译 PoC：** 使用提供的 Makefile 编译 exploit 和 suid_lib.so。
3.  **创建 U 目录：** PoC 会在当前目录下创建名为 `U` 的目录，并将 libc.so.6 和 suid_lib.so 复制到该目录中。
4.  **设置 GLIBC_TUNABLES 环境变量：** PoC 代码通过填充大量的 GLIBC_TUNABLES 环境变量，触发缓冲区溢出。
5.  **栈喷射：**  使用 stack spray 技术，将恶意代码布置在栈上。
6.  **覆盖 l_info[DT_RPATH]：** 通过溢出，覆盖 `l_info[DT_RPATH]` 指针，使其指向栈上的恶意代码。
7.  **执行 SUID 程序：** 运行 SUID 程序，ld.so 加载器会尝试加载 `DT_RPATH` 指定的路径下的库文件，由于 `DT_RPATH` 被篡改为栈地址，因此会执行栈上的恶意代码，从而提升权限。

**有效性：**

根据漏洞信息和 PoC 代码分析，该 PoC 大概率有效。PoC 代码基本实现了 Qualys 漏洞分析报告中描述的利用方法。但是，该 PoC 存在一些硬编码的偏移量，可能需要根据不同的 glibc 版本和系统环境进行调整。

**投毒风险：**

该 PoC 代码的投毒风险较低，约 5%。

*   **Makefile:** Makefile 中只包含了编译和清理操作，没有发现恶意指令。
*   **README.md:** README 文件只是对漏洞和 PoC 的简单描述，没有包含任何可疑内容。
*   **main.c:** PoC 代码主要实现了环境变量设置、内存分配、栈喷射和地址覆盖等操作。虽然代码中包含了一些硬编码的偏移量，但这些偏移量是为了实现漏洞利用，并非恶意代码。
*   **suid_lib.c:** suid_lib.c 库的代码未提供，增加了分析难度，存在一定风险。从 main.c 的代码来看，suid_lib.so 大概率是执行提权操作的代码，用于替换 SUID 程序的原有功能。

尽管如此，在实际使用 PoC 之前，仍然建议对代码进行详细审查，确保没有隐藏的恶意代码。


**项目地址:** [RickdeJager/CVE-2023-4911](https://github.com/RickdeJager/CVE-2023-4911)

**漏洞详情:** [CVE-2023-4911](https://nvd.nist.gov/vuln/detail/CVE-2023-4911)