## CVE-2023-4911 Looney Tunables 本地提权漏洞

**漏洞编号:** CVE-2023-4911

**漏洞类型:** 缓冲区溢出

**影响应用:** glibc

**危害等级:** 高危，本地权限提升

**影响版本:** 2.34 < glibc version < 2.39

**利用条件:** 需要本地用户权限，目标系统glibc版本在受影响范围内，且目标程序具有SUID权限。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-4911 (又名"Looney Tunables") 是 glibc 动态链接器 ld.so 在处理 GLIBC_TUNABLES 环境变量时发现的缓冲区溢出漏洞。攻击者可以通过精心构造的 GLIBC_TUNABLES 环境变量，在启动具有 SUID 权限的二进制文件时执行代码，从而获得提升的权限。

**漏洞利用方式：**

1.  **环境变量操纵：** 漏洞利用的关键在于控制 `GLIBC_TUNABLES` 环境变量。利用代码通过设置大量的 `GLIBC_TUNABLES` 环境变量，精心构造了堆上的内存布局，通过缓冲区溢出覆盖了关键数据结构。
2.  **地址覆盖：**  利用代码通过溢出覆盖了`link_map`结构体中`l_info[DT_RPATH]`字段. `DT_RPATH`用于指定动态链接库的搜索路径。通过覆盖此字段，攻击者可以控制动态链接器加载恶意库。
3.  **劫持控制流:** 通过修改`DT_RPATH`，动态链接器会优先加载当前目录下的恶意`libc.so.6`，从而劫持控制流，执行恶意代码，最终提升权限。
4. **SUID程序:** 漏洞利用需要结合SUID程序，利用SUID程序的权限来提升当前用户的权限。

**有效性：**

根据提供的漏洞库信息、搜索引擎结果以及漏洞利用代码，可以判断该漏洞POC代码是有效的。网上已经有大量关于此漏洞的分析和利用文章，并且该漏洞已被CISA列入已知被利用的漏洞目录。

**投毒风险：**

分析提供的POC代码，发现投毒风险较低。代码主要由Makefile、README.md、exp.c和gen_libc.py组成。

*   **Makefile：** 用于编译和运行exp.c。
*   **README.md：** 提供了漏洞的简要描述和作者信息。
*   **exp.c：** 包含漏洞利用的核心代码，通过操纵环境变量进行缓冲区溢出。
*   **gen_libc.py：** 用于生成伪造的`libc.so.6`文件。

可能的投毒点在于`gen_libc.py`，恶意作者可能会在生成的libc.so.6中植入后门。虽然此POC代码本身没有明显的投毒行为，但是不能排除作者在生成的`libc.so.6`中隐藏恶意代码的可能性，可能性约为5%。因此，在使用此POC时，需要仔细检查`gen_libc.py`脚本和生成的`libc.so.6`文件，确保其安全性。

**项目地址:** [leesh3288/CVE-2023-4911](https://github.com/leesh3288/CVE-2023-4911)

**漏洞详情:** [CVE-2023-4911](https://nvd.nist.gov/vuln/detail/CVE-2023-4911)