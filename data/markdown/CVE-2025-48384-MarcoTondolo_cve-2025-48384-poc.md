## CVE-2025-48384-Git-任意代码执行

**漏洞编号:** CVE-2025-48384

**漏洞类型:** 配置解析漏洞导致任意代码执行

**影响应用:** Git

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** < 2.43.7, >= 2.44.0-rc0, < 2.44.4, >= 2.45.0-rc0, < 2.45.4, >= 2.46.0-rc0, < 2.46.4, >= 2.47.0-rc0, < 2.47.3, >= 2.48.0-rc0, < 2.48.2, >= 2.49.0-rc0, < 2.49.1, >= 2.50.0-rc0, < 2.50.1

**利用条件:** 用户需要克隆包含恶意配置的仓库并且执行`git submodule update --init --recursive`，用户需要交互。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2025-48384 漏洞源于Git在解析配置文件时对换行符处理不当。具体来说，Git在读取配置值时会去除结尾的回车符和换行符（CRLF）。但在写入配置时，如果值以回车符结尾，则不会被正确引用，导致回车符丢失。利用该漏洞，攻击者可以精心构造包含恶意配置的Git仓库，当用户克隆并初始化子模块时，子模块路径中的回车符会被错误解析，导致子模块被检出到错误的位置。如果此时存在一个指向子模块钩子目录的符号链接，并且该子模块包含一个可执行的 post-checkout 钩子，则该脚本可能会在检出后被意外执行，从而导致任意代码执行。

提供的POC代码是一个简单的恶意post-checkout钩子脚本，其功能是在被执行时输出 "Malicious hook executed!"。该脚本本身并没有隐藏任何额外的投毒代码，它的目的是验证漏洞是否成功利用，而不是进行实际的恶意攻击。

**利用方式：**

1.  攻击者创建一个包含恶意`.gitmodules`配置文件的Git仓库。该配置文件中的子模块路径包含一个尾部的回车符。
2.  攻击者在仓库中创建一个符号链接，将错误解析后的子模块路径链接到`.git/modules/<submodule_name>/hooks`目录。
3.  攻击者在子模块中创建一个名为`post-checkout`的可执行钩子脚本。这个脚本包含攻击者想要执行的恶意代码。
4.  攻击者将仓库共享给受害者。
5.  受害者克隆该仓库并执行`git submodule update --init --recursive`命令。
6.  由于配置解析错误，子模块会被检出到错误的位置。
7.  符号链接会将对错误位置的访问重定向到子模块的钩子目录。
8.  `post-checkout`钩子脚本被执行，导致任意代码执行。

**项目地址:** [MarcoTondolo/cve-2025-48384-poc](https://github.com/MarcoTondolo/cve-2025-48384-poc)

**漏洞详情:** [CVE-2025-48384](https://nvd.nist.gov/vuln/detail/CVE-2025-48384)