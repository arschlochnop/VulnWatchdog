## CVE-2024-42327-Zabbix-SQL注入

**漏洞编号:** CVE-2024-42327

**漏洞类型:** SQL注入

**影响应用:** Zabbix

**危害等级:** 高危，可导致权限提升和远程代码执行

**影响版本:** < 6.0.32rc1, < 6.4.17rc1, < 7.0.2rc1

**利用条件:** 需要Zabbix前端的非管理员用户账户，且该账户需要具有API访问权限

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2024-42327是Zabbix前端存在的一个SQL注入漏洞。攻击者通过利用该漏洞，可以泄漏管理员API认证令牌，并在目标服务器上创建item以实现反向shell，最终达到远程代码执行的目的。

**有效性：**

根据漏洞描述和提供的POC代码，该漏洞的POC代码是有效的。POC利用了`CUser.get`函数中的SQL注入点，通过注入恶意SQL语句，可以读取`zabbix.sessions`表中的`sessionid`，从而获取管理员的API token，进一步利用API创建监控项，执行任意命令。

**投毒风险：**

分析POC代码后，发现投毒的风险较低。主要代码功能围绕SQL注入利用，获取管理员Token并执行反向shell，没有发现明显恶意或隐藏后门的代码。一些参数如`sleep_time`控制延迟，`threads`控制线程数，这些都是正常利用参数。故风险评估极低。

**利用方式：**

1.  **身份验证：** 使用一个具有API访问权限的非管理员用户账户登录Zabbix前端。
2.  **获取用户API Token：** 调用user.login接口，获取当前用户的API Token
3.  **SQL注入：** 利用`CUser.get` API 中的 SQL 注入点，通过构造恶意的SQL语句来从zabbix.sessions表中提取管理员用户的sessionid。这个sessionid很可能就是管理员用户的API Token。
4.  **获取 Host ID：** 使用host.get方法获取目标主机的hostid
5.  **权限提升：** 使用管理员API认证令牌，提升权限。
6.  **远程代码执行：** 创建一个恶意的监控项，该监控项执行反向shell命令。将反向shell指向攻击者的监听地址。
7.  **反向 Shell：**  目标服务器执行反向shell命令，攻击者获得目标服务器的shell访问权限。

**项目地址:** [godylockz/CVE-2024-42327](https://github.com/godylockz/CVE-2024-42327)

**漏洞详情:** [CVE-2024-42327](https://nvd.nist.gov/vuln/detail/CVE-2024-42327)