## CVE-2024-37032-Ollama-路径遍历

**漏洞编号:** CVE-2024-37032

**漏洞类型:** 路径遍历

**影响应用:** Ollama

**危害等级:** 高危，可能导致任意文件读取和写入，甚至远程代码执行

**影响版本:** < 0.1.34

**利用条件:** 需要Ollama服务运行，并能够通过网络访问该服务

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

该漏洞存在于Ollama 0.1.34之前的版本中，由于没有充分验证模型路径中的摘要格式（sha256哈希值），攻击者可以通过构造包含路径遍历字符（如`../`）的恶意摘要，来读取或写入Ollama服务器文件系统上的任意文件。攻击者可以搭建一个恶意的registry服务器，Ollama客户端在拉取模型时，由于没有正确校验，会去恶意registry上下载manifest文件，manifest文件中的digest包含路径遍历payload，从而造成任意文件读取或写入。POC代码提供了一个rogue registry server（`rogue_registry_server/server.py`）和利用脚本（`poc.py`）。利用脚本配置了恶意registry地址，并通过`pull`和`push`接口触发漏洞。恶意registry server的`fake_manifests`函数返回包含路径遍历payload的manifest文件。利用过程中，恶意服务器模拟了Ollama期望的响应头，以便进行路径遍历。通过修改`HOST`可以指定恶意registry服务器的地址。由于没有发现作者隐藏的payload代码段，因此投毒风险为0%。

**项目地址:** [Bi0x/CVE-2024-37032](https://github.com/Bi0x/CVE-2024-37032)

**漏洞详情:** [CVE-2024-37032](https://nvd.nist.gov/vuln/detail/CVE-2024-37032)