## CVE-2021-21300-Git-远程代码执行

**漏洞编号:** CVE-2021-21300

**漏洞类型:** 远程代码执行

**影响应用:** Git

**危害等级:** 高危，允许恶意仓库在克隆时执行任意代码

**影响版本:** >= 2.14.2, < 2.17.62.17.6, >= 2.18.0, < 2.18.5, >= 2.19.0, < 2.19.6, >= 2.20.0, < 2.20.5, >= 2.21.0, < 2.21.4, >= 2.22.0, < 2.22.5, >= 2.23.0, < 2.23.4, >= 2.24.0, < 2.24.4, >= 2.25.0, < 2.25.5, >= 2.26.0, < 2.26.3, >= 2.27.0, < 2.27.1, >= 2.28.0, < 2.28.1, >= 2.29.0, < 2.29.3, >= 2.30.0, < 2.30.1

**利用条件:** 需要目标系统使用大小写不敏感的文件系统 (例如 NTFS, HFS+ 或 APFS)，并且配置了 clean/smudge 过滤器 (例如 Git LFS)。 受害者需要克隆恶意仓库。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-21300 漏洞存在于 Git 中，允许恶意仓库在克隆到大小写不敏感的文件系统上时执行任意代码。漏洞利用依赖于以下几个关键因素：

1.  **大小写不敏感的文件系统：** 漏洞利用依赖于 NTFS, HFS+ 或 APFS 等文件系统，这些系统对文件名的大小写不敏感。
2.  **Clean/Smudge 过滤器：** 漏洞利用依赖于配置的 clean/smudge 过滤器，例如 Git LFS。这些过滤器会在检出和提交文件时自动转换文件内容。
3.  **恶意仓库：** 攻击者需要创建一个包含恶意配置的 Git 仓库。

**利用方式：**

1.  攻击者创建一个恶意 Git 仓库，仓库中包含一个或多个符号链接以及使用了 clean/smudge 过滤器的文件。
2.  攻击者在 `.gitattributes` 文件中配置 clean/smudge 过滤器，使其指向一个恶意脚本。
3.  受害者克隆该恶意仓库到大小写不敏感的文件系统上。
4.  当 Git 尝试检出仓库中的文件时，会触发 clean/smudge 过滤器。
5.  由于大小写不敏感的文件系统的特性，符号链接可能会指向恶意脚本，导致该脚本被执行。

**POC 代码分析：**

提供的 POC 代码包含以下文件：

*   `A/a` 和 `A/b`：这两个文件可能是占位符，或者用于触发 clean/smudge 过滤器。
*   `A/post-checkout`：这是一个 Git hook 脚本，会在 `git checkout` 命令之后执行。在这个例子中，它会输出 "PWNED" 到标准错误流，表明漏洞已被成功利用。

**有效性：**

提供的 POC 代码有效，它演示了如何利用 CVE-2021-21300 漏洞在克隆仓库时执行任意代码。通过配置 `post-checkout` 钩子，攻击者可以在受害者克隆仓库后立即执行恶意代码。

**投毒风险：**

在这个特定的 POC 代码中，没有明显的投毒代码。 `post-checkout` 脚本只是简单地输出 "PWNED"，用于验证漏洞的存在。 投毒风险评估为 0%。这意味着在这个特定的例子中，没有证据表明作者试图通过隐藏恶意代码来进一步危害受害者。

**项目地址:** [AlkenePan/CVE-2021-21300](https://github.com/AlkenePan/CVE-2021-21300)

**漏洞详情:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)