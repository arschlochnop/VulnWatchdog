## CVE-2022-41082-Microsoft Exchange Server Remote Code Execution

**漏洞编号:** CVE-2022-41082

**漏洞类型:** 远程代码执行

**影响应用:** Microsoft Exchange Server

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** Exchange Server 2013 Cumulative Update 23 (versionStartIncluding: 15.00.0, versionEndExcluding: 15.00.1497.044), Exchange Server 2016 Cumulative Update 22 (versionStartIncluding: 15.0.0, versionEndExcluding: 15.01.2375.037), Exchange Server 2019 Cumulative Update 11 (versionStartIncluding: 15.02.0, versionEndExcluding: 15.02.0986.036), Exchange Server 2019 Cumulative Update 12 (versionStartIncluding: 15.02.0, versionEndExcluding: 15.02.1118.020), Exchange Server 2016 Cumulative Update 23 (versionStartIncluding: 15.01.0, versionEndExcluding: 15.01.2507.016)

**利用条件:** 需要 Exchange PowerShell 可被攻击者访问, 并且需要已经过身份验证。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-41082 是一个 Microsoft Exchange Server 远程代码执行漏洞，与 CVE-2022-41040 (ProxyNotShell) 组合利用。CVE-2022-41040 是一个服务器端请求伪造 (SSRF) 漏洞，允许经过身份验证的攻击者触发 CVE-2022-41082。CVE-2022-41082 允许远程代码执行，攻击者可以通过构造特定的请求，在 Exchange 服务器上执行任意代码。 

**漏洞利用方式:**

1.  攻击者首先利用 CVE-2022-41040 (SSRF) 漏洞获取对 Exchange 服务器的访问权限。
2.  然后，攻击者使用获得的权限构造恶意请求，触发 CVE-2022-41082，从而在服务器上执行任意代码。

提供的 Nmap 脚本 (`exchange-vuln-check.nse` 和 `vuln-CVE-2022-41082.nse`) 旨在检测目标 Exchange 服务器是否存在此漏洞。它们通过发送特制的 HTTP 请求到 `/autodiscover/autodiscover.json` 端点，并检查服务器的响应来判断漏洞是否存在。如果服务器返回 `401` 状态码并包含 `X-OWA-Version` 头部，则表示服务器可能存在漏洞。

**投毒风险分析:**

代码中 `rand.random_alpha(10)` 用于生成随机字符串，以避免缓存。这个操作本身没有问题。但是，由于代码主要用于漏洞检测，如果作者在其他地方加入恶意代码，比如在发送请求时附加恶意载荷，或者在报告结果时篡改信息，就可能构成投毒。
代码中的 `description` 字段包含西班牙语，初步判断作者存在翻译痕迹，可能使用了翻译工具，虽然不会直接导致投毒，但也增加了代码审查的难度, 通过审计代码，没有发现明显的恶意行为，但是存在一定的风险，因此认定投毒风险为10%。

**项目地址:** [notareaperbutDR34P3r/http-vuln-CVE-2022-41082](https://github.com/notareaperbutDR34P3r/http-vuln-CVE-2022-41082)

**漏洞详情:** [CVE-2022-41082](https://nvd.nist.gov/vuln/detail/CVE-2022-41082)