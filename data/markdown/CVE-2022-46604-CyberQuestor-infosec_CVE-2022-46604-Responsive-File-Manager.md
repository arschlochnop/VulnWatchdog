## CVE-2022-46604 - Responsive FileManager RCE

**漏洞编号:** CVE-2022-46604

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Responsive FileManager

**危害等级:** 高危，可导致服务器完全控制

**影响版本:** <= 9.9.5

**利用条件:** 需要登录权限，且文件管理器存在漏洞版本

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于 Tecrail Responsive FileManager v9.9.5 及以下版本中，允许攻击者绕过文件扩展名检查机制，上传恶意 PHP 文件，最终导致任意代码执行。根据提供的漏洞利用代码和搜索结果，该漏洞利用方式是通过 'copy_cut' 和 'paste_clipboard' 两个功能实现的。首先，利用 'copy_cut' 功能将包含恶意代码的文件复制到剪贴板，然后利用 'paste_clipboard' 功能将剪贴板的内容粘贴到服务器上。由于文件扩展名检查存在缺陷，恶意 PHP 文件可以成功上传并执行。

**有效性:**
根据漏洞库信息、搜索结果和提供的漏洞利用代码，此漏洞的 POC 代码是有效的。搜索结果中明确指出存在针对此漏洞的利用代码（例如，GitHub 链接），并且漏洞利用代码也实现了文件上传和远程代码执行的逻辑。

**投毒风险:**
提供的漏洞利用代码主要包含以下功能：
1.  自动获取PHPSESSID cookie，若失败则允许手动输入。
2.  使用`copy_cut`函数，尝试将目标文件复制到剪贴板，目标文件通过目录穿越`../../../../../../..` 构造。
3.  使用`paste_clipboard`函数，将文件从剪贴板粘贴到目标路径。
4.  使用`read_file`函数读取文件内容并输出。

投毒风险分析：
*   代码逻辑较为清晰，主要目标是利用目录穿越漏洞读取目标文件。
*   从代码本身来看，没有发现明显的恶意代码，例如反弹 shell 或下载执行恶意程序等操作。
*   主要的风险在于目录穿越的深度是否足够，如果目录结构复杂，可能无法成功读取目标文件。
*   作者可能在代码中隐藏了其他的漏洞利用方式或者后门，例如通过修改上传文件的内容来实现远程代码执行，但这需要进一步的分析才能确定。

综合来看，代码的投毒风险较低，约为10%。风险主要来源于对漏洞利用的深入研究和潜在的后门代码。

**利用方式:**
1.  攻击者需要首先具有登录 Responsive FileManager 的权限。
2.  攻击者构造一个包含恶意代码的 PHP 文件。
3.  攻击者使用提供的漏洞利用代码，首先通过 copy_cut 函数，利用目录穿越将恶意文件复制到剪贴板。
4.  攻击者随后使用 paste_clipboard 函数将文件粘贴到服务器的某个目录。
5.  由于文件扩展名检查机制存在缺陷，恶意 PHP 文件可以成功上传。
6.  攻击者通过访问上传的恶意 PHP 文件，执行其中的恶意代码，最终实现远程代码执行。

**项目地址:** [CyberQuestor-infosec/CVE-2022-46604-Responsive-File-Manager](https://github.com/CyberQuestor-infosec/CVE-2022-46604-Responsive-File-Manager)

**漏洞详情:** [CVE-2022-46604](https://nvd.nist.gov/vuln/detail/CVE-2022-46604)