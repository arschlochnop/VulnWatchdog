## CVE-2021-43857-Gerapy-远程代码执行

**漏洞编号:** CVE-2021-43857

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Gerapy

**危害等级:** 高危，允许未经授权的攻击者在服务器上执行任意代码

**影响版本:** < 0.9.8

**利用条件:** 需要目标Gerapy实例可网络访问，并知道或猜测到有效的用户名和密码（默认admin/admin可能有效）。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2021-43857 是 Gerapy 0.9.8 之前版本中的一个远程代码执行漏洞。根据漏洞信息和搜索结果，攻击者可以通过构造恶意请求，利用操作系统命令注入漏洞，在目标系统上执行任意命令。

**有效性:**
提供的PoC代码有效，因为它通过以下步骤利用漏洞：
1.  **登录:** 使用提供的用户名和密码登录 Gerapy 管理界面。
2.  **获取项目列表:** 登录后，获取项目列表，选择第一个项目进行攻击。
3.  **获取项目ID：** 获取项目构建信息，从中提取项目ID
4.  **触发Payload:**  构造包含反向shell命令的payload，通过`/api/project/{project_id}/parse`接口发送给Gerapy服务器。服务器执行该命令，建立与攻击者控制的机器之间的反向shell连接。

**投毒风险:**
PoC代码本身的主要目的是利用漏洞，并未发现明显的恶意投毒代码。但是，在安全领域，任何代码都存在潜在的风险，以下情况可能构成风险：
*  **依赖包篡改：** PoC 依赖于 requests 等第三方库。如果这些库被恶意篡改，可能会引入恶意代码。
*  **代码逻辑缺陷：** 虽然PoC的主要逻辑是漏洞利用，但如果存在未知的代码缺陷，可能会被利用执行其他恶意操作。
* **监听端口恶意程序:**subprocess.Popen使用存在恶意替换的程序.例如nc程序被替换
综合考虑，投毒风险较低，可以估计为5%。

**利用方式:**
1.  攻击者需要能够访问 Gerapy 实例的网络。
2.  攻击者需要知道或猜测到有效的用户名和密码（例如默认的 admin/admin）。
3.  攻击者运行 PoC 脚本，指定目标 IP 地址、端口、用户名、密码以及攻击者用于接收反向 shell 的 IP 地址和端口。
4.  PoC 脚本登录 Gerapy 管理界面，获取项目ID，然后发送包含恶意命令的请求到`/api/project/{project_id}/parse`接口，触发漏洞。
5.  Gerapy 服务器执行恶意命令，建立与攻击者控制的机器之间的反向 shell 连接，攻击者从而获得对服务器的控制权。

**项目地址:** [G4sp4rCS/CVE-2021-43857-POC](https://github.com/G4sp4rCS/CVE-2021-43857-POC)

**漏洞详情:** [CVE-2021-43857](https://nvd.nist.gov/vuln/detail/CVE-2021-43857)