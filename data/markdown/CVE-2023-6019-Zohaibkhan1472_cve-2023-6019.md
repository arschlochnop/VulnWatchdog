## CVE-2023-6019-ray-project/ray-命令注入

**漏洞编号:** CVE-2023-6019

**漏洞类型:** 命令注入

**影响应用:** ray-project/ray

**危害等级:** 高危，允许未经身份验证的远程命令执行

**影响版本:** <= 2.7.0 (修复于2.8.1+)

**利用条件:** Ray Dashboard必须启用且可公开访问

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-6019是Ray项目中的一个命令注入漏洞，存在于cpu_profile URL参数中。未授权的攻击者可以利用此漏洞在运行Ray Dashboard的系统上执行任意操作系统命令。提供的`docker-compose.yml`文件配置了一个易受攻击的Ray Dashboard实例（版本2.7.0），以及模拟WAF、监控服务和前端界面的其他组件，形成一个可利用的环境。

**有效性：**
提供的POC代码是有效的。它包含一个`docker-compose.yml`文件，它启动了一个易受攻击的Ray集群，该集群运行着存在漏洞的Ray Dashboard。这个环境可以用来测试和验证CVE-2023-6019漏洞。

**投毒风险：**
评估代码的投毒风险为10%。原因是：
* `waf_filter.py` 文件中包含一个基本的Web应用防火墙（WAF），其黑名单规则可能不完整，存在绕过的可能性。
* `setup.sh` 脚本创建目录并复制文件，但没有明确的恶意操作，例如下载或执行未经授权的脚本。
* `frontend/dashboard.py` 和 `monitoring/request_monitor.py` 的源代码未提供，因此无法评估它们是否包含恶意代码。
* `docker-compose.yml` 文件配置了多个服务（监控、WAF、前端），这些服务之间可能存在交互，增加了潜在的攻击面。

尽管存在一些不确定性，但该仓库中存在恶意投毒代码的概率相对较低，为10%。不过，在实际使用这些代码时，仍然需要进行仔细的代码审查和安全测试，以确保环境的安全性和完整性。

**利用方式：**
1.  **环境搭建：** 使用`docker-compose.yml`文件创建包含易受攻击的Ray Dashboard的Docker环境。该环境模拟了一个带有waf,监控服务和界面的系统，使得漏洞利用场景更加贴近真实情况
2.  **漏洞触发：** 向易受攻击的Ray Dashboard的`/api/launch_profiling`端点发送包含恶意命令的`cpu_profile`参数的POST请求。
3.  **命令执行：** Ray Dashboard未正确验证`cpu_profile`参数，导致恶意命令得以执行。
4.  **WAF绕过:** WAF会尝试过滤掉恶意代码，可以尝试通过编码,大小写,畸形绕过.

利用代码展示了如何设置一个包含易受攻击的Ray Dashboard的环境，虽然包含简单的WAF, 但是利用方式仍然是通过构造恶意的cpu_profile参数来远程执行命令。

**项目地址:** [Zohaibkhan1472/cve-2023-6019](https://github.com/Zohaibkhan1472/cve-2023-6019)

**漏洞详情:** [CVE-2023-6019](https://nvd.nist.gov/vuln/detail/CVE-2023-6019)