## CVE-2019-18935 - Telerik UI for ASP.NET AJAX Deserialization RCE

**漏洞编号:** CVE-2019-18935

**漏洞类型:** .NET Deserialization Remote Code Execution

**影响应用:** Telerik UI for ASP.NET AJAX

**危害等级:** 高危，可导致远程代码执行

**影响版本:** <= 2019.3.1023

**利用条件:** 需要能够访问存在漏洞的Telerik UI 组件的ASP.NET应用，且已知加密密钥 (由于 CVE-2017-11317 或 CVE-2017-11357 或其他方式)。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-18935 是一个存在于 Progress Telerik UI for ASP.NET AJAX (版本直至 2019.3.1023) 中的 .NET 反序列化漏洞，位于 RadAsyncUpload 功能中。利用该漏洞的前提是攻击者需要已知加密密钥，而获取密钥可以通过利用 CVE-2017-11317 或 CVE-2017-11357，或者通过其他方式。成功利用此漏洞可能导致远程代码执行。

**漏洞利用方式：**

1.  **密钥获取:** 攻击者首先需要获取用于加密 RadAsyncUpload 上传组件的密钥。这可以通过利用 CVE-2017-11317 或 CVE-2017-11357 等已知漏洞，或者通过其他方式获取，例如密钥泄露。
2.  **构造恶意Payload:**  攻击者使用获取的密钥，构造包含恶意 .NET 对象的序列化数据。这个恶意对象旨在执行任意代码。
3.  **上传Payload:**  攻击者将构造的恶意 Payload 作为文件通过 RadAsyncUpload 组件上传。
4.  **反序列化触发:**  当 Telerik UI 组件尝试反序列化上传的文件时，恶意对象被实例化，从而执行攻击者预设的任意代码。

**POC代码分析：**

提供的 POC 代码通过 C++ 编写一个 DLL，该 DLL 在加载时会尝试在当前进程的所有 .NET AppDomain 中寻找 `Telerik.Web.UI` 程序集，如果找到，就将一段硬编码的 `rawData` （代表编译后的 .NET 程序集）加载到该 AppDomain 中，并实例化 `G` 类。

该POC的利用方式是通过创建一个内存马，将恶意代码注入到正在运行的应用程序中。具体步骤为：

*   将包含恶意代码的C#代码编译成DLL。
*   将DLL转换为字节数组(`rawData`)并嵌入到C++代码中。
*   编译C++代码为DLL。
*   将编译后的DLL作为payload，通过漏洞上传并触发执行，从而将恶意代码注入到目标应用程序。

**投毒风险分析：**

POC代码中，`rawData` 部分是需要特别关注的。如果 `rawData` 包含恶意代码，则该 POC 可能被用于传播恶意软件。当前代码中 `rawData` 部分被省略，没有具体内容，因此判断投毒风险主要依赖于 `rawData` 的来源。该代码的作者给出了 `SharpMemshell` 作为生成 `rawData` 的来源，但如果攻击者替换 `SharpMemshell` 为其他恶意代码，则存在投毒风险。此外，C++代码逻辑也可能存在隐藏的恶意行为，但目前看比较简单，风险较低。综合考虑，投毒风险评估为10%。

**项目地址:** [dust-life/CVE-2019-18935-memShell](https://github.com/dust-life/CVE-2019-18935-memShell)

**漏洞详情:** [CVE-2019-18935](https://nvd.nist.gov/vuln/detail/CVE-2019-18935)