## CVE-2022-22963-Spring Cloud Function-远程代码执行

**漏洞编号:** CVE-2022-22963

**漏洞类型:** 远程代码执行

**影响应用:** Spring Cloud Function

**危害等级:** 高危，可能导致完全控制受影响的系统

**影响版本:** Spring Cloud Function versions 3.1.6, 3.2.2 及所有旧的和不受支持的版本

**利用条件:** 应用程序使用了Spring Cloud Function的路由功能，并且允许用户控制`routing-expression`。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2022-22963 存在于 Spring Cloud Function 中，当使用路由功能时，攻击者可以通过提供特制的 SpEL 表达式作为 `routing-expression` 来执行任意代码并访问本地资源。 

**有效性：**

提供的 POC 代码有效。它演示了如何通过设置 `spring.cloud.function.routing-expression` header来执行任意命令。例如，`T(java.lang.Runtime).getRuntime().exec("open -a /System/Applications/Calculator.app")`  会在目标系统上打开计算器应用程序。另一个POC通过DNS请求验证命令执行.

**投毒风险：**

该仓库主要包含漏洞利用代码和演示。虽然代码的功能是执行任意命令，但就该仓库本身而言，直接的、明显的投毒代码的风险较低，接近1%。需要防范的是通过该POC进入后，攻击者植入的后门。

**利用方式：**

1.  **确定目标：** 找到运行易受攻击的 Spring Cloud Function 应用程序的服务器。
2.  **构造恶意请求：** 创建一个 HTTP POST 请求，其中包含 `spring.cloud.function.routing-expression` header，并将值设置为包含恶意 SpEL 表达式的字符串。
3.  **发送请求：** 将请求发送到应用程序的路由端点 (如 `/functionRouter`)。
4.  **执行代码：** 服务器将解析 SpEL 表达式并执行其中包含的命令。

通过搜索引擎结果,得知此漏洞为未授权远程代码执行漏洞，CVSS评分为9.8分，危害巨大。利用过程简单，构造恶意header即可。

**项目地址:** [hktalent/spring-spel-0day-poc](https://github.com/hktalent/spring-spel-0day-poc)

**漏洞详情:** [CVE-2022-22963](https://nvd.nist.gov/vuln/detail/CVE-2022-22963)