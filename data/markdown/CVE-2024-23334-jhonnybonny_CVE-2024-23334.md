## CVE-2024-23334-aiohttp-目录遍历

**漏洞编号:** CVE-2024-23334

**漏洞类型:** 目录遍历

**影响应用:** aiohttp

**危害等级:** 中危，可能导致敏感信息泄露

**影响版本:** < 3.9.2

**利用条件:** 需要目标服务器启用静态文件服务，且follow_symlinks=True

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2024-23334是aiohttp框架中存在的一个目录遍历漏洞。当aiohttp作为web服务器，并且配置了静态路由时，如果`follow_symlinks`选项设置为True，则可能允许攻击者通过构造包含`../`的URL来访问静态文件根目录之外的文件。

**有效性:**

提供的POC代码有效。根据漏洞描述和搜索引擎结果，该漏洞允许未经授权的访问，POC利用LFI从 `/etc/passwd` 读取用户数据，可以验证漏洞的存在。

**投毒风险:**

查看POC代码：

*   `server.py`: 该脚本启动一个简单的aiohttp web服务器，设置静态路由，并启用`follow_symlinks=True`， 漏洞利用的关键配置。
*   `exploit.py`: 该脚本通过构造包含多个`../`的URL来尝试访问`/etc/passwd`文件，验证漏洞。
*   `aiohttp.yaml`: nuclei 扫描模板定义，可以检测漏洞。
*   `requirements.txt`:  定义了aiohttp==3.9.1，说明存在漏洞。

所有代码都是漏洞利用相关的，没有发现恶意代码或后门，但是考虑到是互联网上下载的，还是存在一定的风险，因为可能存在隐藏的、未被发现的恶意代码。综上，投毒风险极低，估计为1%。

**利用方式:**

1.  服务器端需要使用aiohttp搭建web服务，并且配置静态资源目录，设置`follow_symlinks=True`，允许访问符号链接指向的目录。
2.  攻击者构造包含`../`的URL，例如 `/static/../../../../etc/passwd`，试图绕过静态文件根目录的限制。
3.  服务器如果未正确验证URL，则会返回`/etc/passwd`文件的内容，导致敏感信息泄露。

**项目地址:** [jhonnybonny/CVE-2024-23334](https://github.com/jhonnybonny/CVE-2024-23334)

**漏洞详情:** [CVE-2024-23334](https://nvd.nist.gov/vuln/detail/CVE-2024-23334)