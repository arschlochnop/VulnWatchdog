## CVE-2024-12877-GiveWP-PHP对象注入

**漏洞编号:** CVE-2024-12877

**漏洞类型:** PHP对象注入

**影响应用:** GiveWP – Donation Plugin and Fundraising Platform

**危害等级:** 高危，可能导致远程代码执行、敏感数据泄露、权限提升和完全服务器控制

**影响版本:** <= 3.19.2

**利用条件:** 目标WordPress站点安装了受影响的GiveWP插件，且攻击者可以访问捐赠表单（未认证）

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-12877是GiveWP插件中一个PHP对象注入漏洞。由于插件对用户可控的输入使用`unserialize()`函数时存在缺陷，未经身份验证的攻击者可以通过构造恶意的序列化对象，利用POP链触发`__wakeup()`等魔术方法，从而实现远程代码执行。该漏洞的关键在于`unserialize()`函数的使用以及插件中是否存在可利用的POP链。漏洞利用代码中展示了如何构造恶意的序列化对象,尽管新的正则表达式有所改进，但是无法完全阻止反序列化攻击,因此POC的有效性较高。

投毒风险评估：
该漏洞利用代码仓库包含漏洞说明文档和一个利用示例。虽然示例代码本身看起来无害，但存在一定的投毒风险。攻击者可能通过以下方式进行投毒：

*   **隐蔽的恶意代码：** 在示例代码的注释或不常用的函数中插入恶意代码，这些代码在漏洞利用过程中被执行，例如下载恶意软件或修改系统配置。
*   **后门：** 在漏洞利用过程中，植入一个后门程序，允许攻击者在之后无需漏洞利用即可访问系统。
*   **依赖项劫持：** 如果示例代码依赖于外部库或组件，攻击者可以劫持这些依赖项，插入恶意代码。
*   **误导性代码：** 提供看似有效的漏洞利用代码，但实际上存在缺陷或陷阱，导致攻击失败或留下痕迹，从而迷惑安全研究人员。

根据代码分析，利用代码本身相对清晰，但为了防范投毒，在实际使用或部署前务必进行彻底的代码审计，检查是否存在任何可疑的代码或行为，建议在沙箱环境中测试利用代码，以避免对生产环境造成损害。因此，投毒风险评定为10%。

利用方式：
1.  攻击者构造包含恶意代码的PHP序列化对象。
2.  攻击者将构造的序列化对象作为`firstName`等捐赠表单的参数提交给存在漏洞的GiveWP插件。
3.  插件在处理捐赠表单时，使用`unserialize()`函数反序列化用户提交的数据。
4.  反序列化过程触发PHP魔术方法，例如`__wakeup()`。
5.  如果存在可利用的POP链，则执行恶意代码，实现远程代码执行或文件删除等恶意操作。

**项目地址:** [soltanali0/CVE-2024-12877-Exploit](https://github.com/soltanali0/CVE-2024-12877-Exploit)

**漏洞详情:** [CVE-2024-12877](https://nvd.nist.gov/vuln/detail/CVE-2024-12877)