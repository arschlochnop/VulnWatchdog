## CVE-2024-32002 - Git Submodule RCE

**漏洞编号:** CVE-2024-32002

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Git

**危害等级:** 高危，允许攻击者在受害者机器上执行任意代码

**影响版本:** 受影响版本包括：< 2.39.4, >= 2.40.0, < 2.40.2, = 2.41.0, >= 2.42.0, < 2.42.2, >= 2.43.0, < 2.43.4, = 2.44.0, = 2.45.0

**利用条件:** 需要目标系统安装受影响版本的Git，且允许clone包含恶意submodule的仓库

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-32002 是一个存在于 Git submodules 中的远程代码执行漏洞。当 Git 在大小写不敏感的文件系统上递归克隆存储库时，攻击者可以利用此漏洞。通过精心构造包含恶意 submodule 的 Git 仓库，攻击者可以欺骗 Git 将文件写入到 `.git/` 目录，而不是 submodule 的工作目录中。这使得攻击者可以写入一个 hook 文件，该 hook 文件在 clone 操作期间执行，从而实现远程代码执行。该漏洞的利用依赖于 `core.symlinks` 配置项是否启用。如果 `core.symlinks` 被禁用，攻击将无法成功。提供的 POC 代码通过创建一个包含恶意 post-checkout hook 的 submodule，然后将其包含在一个主仓库中。当受害者克隆主仓库时，post-checkout hook 会被执行，从而导致代码执行。考虑到此漏洞的利用方式，远程仓库本身就可能包含恶意代码，存在一定投毒的风险。

**漏洞利用方式:**
1.  攻击者创建一个恶意 Git 仓库，其中包含一个 submodule。
2.  Submodule 包含一个恶意的 `post-checkout` hook，用于执行攻击者的 payload。
3.  攻击者诱使受害者克隆包含恶意 submodule 的仓库。
4.  在克隆过程中，Git 会递归克隆 submodule。
5.  由于漏洞，恶意的 `post-checkout` hook 被写入 `.git/` 目录并执行，导致 RCE。

**POC 代码分析和投毒风险评估:**
提供的POC代码主要功能是自动化漏洞利用流程, 简化了恶意仓库的创建过程。代码本身没有明显的投毒行为。 投毒风险主要来源于clone的远程仓库本身。POC中push到远程仓库步骤也有潜在的投毒风险，虽然可能性较低，但不能完全排除。

**有效性:**
根据搜索引擎结果，有多个来源证实了此漏洞的存在以及POC的有效性。

**项目地址:** [grecosamuel/CVE-2024-32002](https://github.com/grecosamuel/CVE-2024-32002)

**漏洞详情:** [CVE-2024-32002](https://nvd.nist.gov/vuln/detail/CVE-2024-32002)