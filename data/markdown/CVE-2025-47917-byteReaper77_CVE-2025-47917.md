## CVE-2025-47917-mbedtls-Use-After-Free

**漏洞编号:** CVE-2025-47917

**漏洞类型:** Use-After-Free

**影响应用:** mbedtls

**危害等级:** 高危，可能导致代码执行

**影响版本:** < 3.6.4

**利用条件:** 应用程序需要调用 mbedtls_x509_string_to_names() 函数且san string 包含多个DN

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

该漏洞存在于mbedtls 3.6.4之前的版本中，是由于mbedtls_x509_string_to_names()函数对head参数的处理不当导致的use-after-free漏洞。该函数文档中没有声明会释放head指针，但实际上函数内部会调用mbedtls_asn1_free_named_data_list()对head执行deep free()，导致应用程序在后续代码中如果继续使用该指针，则会触发use-after-free漏洞。

**漏洞利用方式：**

1.  **触发漏洞函数：** 利用程序调用 `mbedtls_x509_string_to_names` 函数，且传入的san string 包含多个DN。 
2.  **UAF触发：** 该函数内部在处理 `san` 字符串时，会释放 `head` 指针所指向的内存，如果程序后续继续使用 `head` 指针，则会触发 `use-after-free` 漏洞。
3.  **shellcode 注入:**  漏洞利用代码中通过 `mmap` 分配一块可读、可写、可执行的内存，并将shellcode 复制到该内存中。
4.  **控制流劫持:**  利用 UAF 漏洞，通过精心构造的输入，覆盖 `head->val.p`, 使其指向shellcode 内存地址，从而控制程序执行流程，跳转到 shellcode 执行。
5.  **获取shell:** shellcode 执行反弹shell等操作，攻击者即可获取目标系统的控制权。

**有效性评估：**

根据漏洞信息和提供的利用代码来看，该POC代码的有效性较高。代码中包含了禁用ASLR的检查，并直接提供了shellcode。利用流程与漏洞描述一致。

**投毒风险评估：**

查看`exploit.c`代码, 主要功能是利用UAF漏洞，没有发现明显的恶意行为或后门代码。`LICENSE`文件也是标准的MIT许可协议，不存在投毒代码。所以判定投毒风险为0%。

**搜索引擎结果分析:**

搜索引擎结果表明该漏洞是一个高危漏洞，存在于Mbed TLS库中，需要及时升级到3.6.4或更高版本。

**项目地址:** [byteReaper77/CVE-2025-47917](https://github.com/byteReaper77/CVE-2025-47917)

**漏洞详情:** [CVE-2025-47917](https://nvd.nist.gov/vuln/detail/CVE-2025-47917)