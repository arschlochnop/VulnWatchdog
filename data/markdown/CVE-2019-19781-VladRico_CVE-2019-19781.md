## CVE-2019-19781-Citrix ADC/Gateway-目录遍历与RCE

**漏洞编号:** CVE-2019-19781

**漏洞类型:** 目录遍历与远程代码执行

**影响应用:** Citrix Application Delivery Controller (ADC) 和 Gateway

**危害等级:** 高危，可能导致信息泄露和远程代码执行

**影响版本:** 10.5, 11.1, 12.0, 12.1, 和 13.0

**利用条件:** 需要网络访问目标设备的Web服务端口（通常是80或443）

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-19781 是 Citrix ADC 和 Gateway 产品中的一个目录遍历漏洞，允许未经身份验证的远程攻击者读取敏感文件，甚至执行任意代码。根据搜索引擎结果和漏洞利用代码，该漏洞已被积极利用。

**漏洞利用方式：**

1.  **目录遍历：** 攻击者利用 `../` 序列来绕过目录访问限制，访问受限目录下的文件。
2.  **模板注入/代码执行：**  通过构造特殊的URL和HTTP头部，尤其是 `NSC_USER` 头部，将恶意命令注入到模板引擎中。Citrix设备会将此命令作为系统命令执行，从而实现远程代码执行。

**POC有效性：**

提供的 Python POC 脚本通过以下步骤来验证和利用该漏洞：

1.  **构建Payload：** `parseCmd` 函数格式化要执行的命令，替换空格和斜杠，以绕过某些过滤。
2.  **发送请求：** 脚本发送两个 HTTP GET 请求，第一个请求利用目录遍历和模板注入设置环境变量，第二个请求触发代码执行，并返回执行结果。
3.  **处理响应：** 脚本检查 HTTP 状态码，以确定漏洞是否成功利用，并打印执行结果。

**投毒风险：**

该代码存在一定的投毒风险，可能性约为10%。
*   **默认代理配置：** 该POC默认使用Tor代理 (`127.0.0.1:9050`)，虽然这可能是为了匿名化攻击者的身份，但也可能被用于隐蔽恶意活动，增加溯源难度。需要用户自行安装和配置Tor，存在钓鱼风险，攻击者可能提供配置错误的Tor安装包。
*   **依赖项：**  POC 依赖于 `requests`、`urllib3` 和 `PySocks` 库。虽然这些库本身是常见的，但攻击者可能会在恶意克隆的仓库中替换这些依赖项，引入恶意代码。
*  **命令执行的风险：** 攻击者使用此POC，可以执行任意命令。虽然这不是POC本身的投毒，但是如果其他人下载了POC，并执行了恶意代码，可能会导致被攻击。
**总结：**

CVE-2019-19781 是一个严重的安全漏洞，需要立即修复。提供的 POC 代码可以有效地验证该漏洞的存在，但也需要注意潜在的投毒风险，使用者需要检查代理设置、依赖项的安全性，并在隔离环境中运行该 POC。

**项目地址:** [VladRico/CVE-2019-19781](https://github.com/VladRico/CVE-2019-19781)

**漏洞详情:** [CVE-2019-19781](https://nvd.nist.gov/vuln/detail/CVE-2019-19781)