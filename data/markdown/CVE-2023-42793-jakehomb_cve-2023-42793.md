## CVE-2023-42793-JetBrains TeamCity-身份验证绕过导致RCE

**漏洞编号:** CVE-2023-42793

**漏洞类型:** 身份验证绕过导致RCE

**影响应用:** JetBrains TeamCity

**危害等级:** 高危，未经身份验证的远程代码执行

**影响版本:** < 2023.05.4

**利用条件:** 目标TeamCity服务器版本低于2023.05.4，且可通过HTTP(S)访问。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

根据漏洞信息和搜索结果，CVE-2023-42793 允许未经身份验证的攻击者在 TeamCity 服务器上执行远程代码。该漏洞利用方式是通过绕过身份验证机制，直接访问受保护的资源并执行恶意操作。

**有效性：**
根据提供的漏洞信息、搜索结果以及漏洞利用代码，可以判断该漏洞的 POC 代码有效。CVE 详情中提到存在身份验证绕过导致 RCE，搜索结果也表明该漏洞存在公开可用的exploit，并且已经被APT29等恶意行为者利用。

**投毒风险：**
提供的漏洞利用代码主要由两部分组成：获取 Token 和创建用户。getToken 函数尝试从 /app/rest/users/id:1/token/RPC2 获取一个 Token，createUser 函数使用这个 Token 来创建一个具有管理员权限的用户。代码本身功能明确，没有发现隐藏的恶意代码。因此，评估该仓库中存在作者隐藏的投毒代码的风险为0%。

**利用方式：**
1.  **目标探测：** 确定目标 TeamCity 服务器的版本是否低于 2023.05.4。
2.  **Token 获取：** 使用 `getToken` 函数，通过向 `https://<teamcity_url>/app/rest/users/id:1/token/RPC2` 发送 GET 请求，尝试获取一个 Token。服务器无需授权即可响应。  `extractToken` 函数从响应中提取 Token。
3.  **用户创建：** 使用 `createUser` 函数，携带上一步获取的 Token，向 `https://<teamcity_url>/app/rest/users` 发送 POST 请求，创建一个具有 SYSTEM_ADMIN 角色的新用户。请求的 Body 为包含用户名、密码和邮箱的JSON格式。
4.  **权限提升：** 使用新创建的管理员用户登录 TeamCity 服务器，获得完全控制权限，从而执行任意代码。

**项目地址:** [jakehomb/cve-2023-42793](https://github.com/jakehomb/cve-2023-42793)

**漏洞详情:** [CVE-2023-42793](https://nvd.nist.gov/vuln/detail/CVE-2023-42793)