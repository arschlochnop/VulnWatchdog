## CVE-2025-32463-Sudo-本地权限提升

**漏洞编号:** CVE-2025-32463

**漏洞类型:** 本地权限提升

**影响应用:** Sudo

**危害等级:** 高危，允许本地用户获取root权限

**影响版本:** 1.9.14 <= version < 1.9.17p1

**利用条件:** 本地用户权限

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2025-32463 漏洞存在于 Sudo 1.9.14 到 1.9.17p1 之间的版本中。该漏洞允许本地用户通过 `--chroot` 选项使用用户控制目录下的 `/etc/nsswitch.conf` 文件，从而提升权限至 root。

**漏洞利用方式：**

1.  创建一个临时目录，并进入该目录。
2.  创建一个包含恶意代码的 C 语言源文件 `woot1337.c`，该代码在执行时会设置用户的 uid 和 gid 为 0 (root)，然后执行 `/bin/bash`。
3.  创建 `woot/etc` 目录，用于存放伪造的 `nsswitch.conf` 文件。
4.  创建 `libnss_` 目录，用于存放编译后的动态链接库。
5.  创建一个 `woot/etc/nsswitch.conf` 文件，其中 `passwd` 行指定使用 `/woot1337` 作为密码数据库。这个路径指向编译后生成的动态链接库 `libnss_/woot1337.so.2`。
6.  复制 `/etc/group` 文件到 `woot/etc` 目录下，以满足一些程序对 group 文件的依赖。
7.  使用 `gcc` 将 `woot1337.c` 编译成动态链接库 `libnss_/woot1337.so.2`。编译时使用 `-shared`、`-fPIC` 和 `-Wl,-init,woot` 选项，其中 `-Wl,-init,woot` 指定在加载库时执行 `woot` 函数。
8.  使用 `sudo -R woot woot` 命令，利用 Sudo 的 `--chroot` 选项，指定 `woot` 目录作为根目录。由于 `nsswitch.conf` 文件被配置为使用恶意动态链接库，因此在 Sudo 执行过程中会加载并执行该库，从而提升权限。
9. 清理临时文件。

**有效性评估：**

根据漏洞描述和提供的 POC 代码，该漏洞利用是有效的。POC 代码演示了如何利用用户可控的 `/etc/nsswitch.conf` 文件劫持 Sudo 的行为，从而提升到 root 权限。

**投毒风险评估：**

分析提供的 POC 代码，没有发现明显的投毒代码。代码的功能集中于利用漏洞进行权限提升，没有额外的恶意行为。因此，投毒风险评估为 0%。代码本身的行为就是在目标机器上编译执行，可以明确预知。


**项目地址:** [dr4x-c0d3r/sudo-chroot](https://github.com/dr4x-c0d3r/sudo-chroot)

**漏洞详情:** [CVE-2025-32463](https://nvd.nist.gov/vuln/detail/CVE-2025-32463)