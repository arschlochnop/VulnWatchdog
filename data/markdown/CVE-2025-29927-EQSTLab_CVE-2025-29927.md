## CVE-2025-29927-Next.js-Middleware-Bypass

**漏洞编号:** CVE-2025-29927

**漏洞类型:** 权限绕过

**影响应用:** Next.js

**危害等级:** 高危，可能导致未授权访问

**影响版本:** >= 11.1.4, <= 13.5.6; > 14.0.0, < 14.2.25; > 15.0.0, < 15.2.3

**利用条件:** 目标应用使用了受影响版本的Next.js，并且权限验证逻辑位于中间件中

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

该漏洞存在于Next.js的中间件中，由于对 `x-middleware-subrequest` 请求头处理不当，导致可以绕过权限验证。攻击者可以通过发送包含特定构造的 `x-middleware-subrequest` 请求头的HTTP请求，访问原本需要身份验证的受保护路由，例如 `/admin`。 

**有效性：**
根据漏洞信息、搜索结果和提供的POC代码，该漏洞利用是有效的。漏洞库信息描述了该漏洞，并指出可以通过设置 `x-middleware-subrequest` 请求头绕过中间件的权限验证。搜索结果中的多个链接也证实了该漏洞的存在和利用方式。提供的POC代码包含了一个简单的 bash 脚本，该脚本使用 curl 命令发送包含恶意构造的 `X-Middleware-Subrequest` 请求头的请求，从而尝试绕过对 `/admin` 路由的权限验证。

**投毒风险：**
审查了提供的文件内容，包括 `README.md`，`poc.sh`，`Dockerfile`， `middleware.ts`等文件，没有发现任何隐藏的、恶意的代码。该存储库主要用于演示CVE-2025-29927漏洞，并且相关文件仅包含PoC代码，配置文件和说明文档。因此，投毒的风险较低。

**利用方式：**
1.  目标应用必须使用受影响版本的 Next.js，并且权限验证逻辑必须在中间件中实现。
2.  攻击者构造一个HTTP请求，其中包含 `X-Middleware-Subrequest` 请求头，该请求头的值可以包含多个 `middleware` 字符串，例如 `middleware:middleware:middleware:middleware:middleware`。
3.  攻击者将构造的HTTP请求发送到受保护的路由（例如 `/admin`）。
4.  由于Next.js对 `X-Middleware-Subrequest` 请求头的处理存在缺陷，中间件的权限验证会被绕过。
5.  攻击者可以未经授权访问受保护的资源。

**项目地址:** [EQSTLab/CVE-2025-29927](https://github.com/EQSTLab/CVE-2025-29927)

**漏洞详情:** [CVE-2025-29927](https://nvd.nist.gov/vuln/detail/CVE-2025-29927)