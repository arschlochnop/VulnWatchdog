## CVE-2018-0114 - Node-jose JWT 签名伪造

**漏洞编号:** CVE-2018-0114

**漏洞类型:** JWT 签名伪造

**影响应用:** Node-jose Library

**危害等级:** 高危，允许未授权的远程攻击者重新签名令牌，可能导致权限提升和身份验证绕过

**影响版本:** < 0.11.0

**利用条件:** 需要目标应用使用存在漏洞的 node-jose 库，并接受包含嵌入式 JWK 的 JWT。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2018-0114 漏洞存在于 node-jose 0.11.0 之前的版本中。该漏洞源于 node-jose 库在处理 JWT 时，信任 JWT 头部中嵌入的 JSON Web Key (JWK) 用于签名验证。攻击者可以构造一个包含恶意 JWK 的 JWT，该 JWK 包含攻击者控制的公钥，然后使用与该公钥关联的私钥对 JWT 进行签名。由于 node-jose 信任头部中的 JWK，它会使用攻击者的公钥验证签名，从而成功伪造 JWT。 

**漏洞利用方式:**
1.  攻击者获取或构造一个 JWT。
2.  攻击者生成一个新的 RSA 密钥对（公钥和私钥）。
3.  攻击者修改 JWT 头部，添加一个 `jwk` 字段，该字段包含攻击者生成的公钥。
4.  攻击者使用其私钥对修改后的 JWT 进行签名。
5.  攻击者将伪造的 JWT 发送给目标应用程序。
6.  如果目标应用程序使用存在漏洞的 node-jose 库进行 JWT 验证，它将信任 JWT 头部中的 JWK，使用攻击者的公钥验证签名，并认为 JWT 是有效的。

**POC 代码分析:**
提供的 POC 代码是一个 Go 程序，用于生成包含指定声明（claim）的 JWT，并在 JWT 头部嵌入攻击者生成的公钥。 

*   `main.go`:  程序的入口点，负责解析命令行参数（`claim`），生成 RSA 密钥对，构造 JWT 头部，并输出生成的 JWT。
*   `keys.go`:  包含生成 RSA 密钥对和使用私钥对数据进行签名的函数。
*   `jwt.go`:  包含用于构造 JWT 头部和有效负载的结构体和函数。
*   `banner.go`: 用于在控制台中显示 CVE 信息。

**有效性评估:**
根据漏洞描述和 POC 代码，该 POC 代码是有效的。它能够生成包含恶意 JWK 的 JWT，可以用于利用 CVE-2018-0114 漏洞。

**投毒风险评估:**
代码本身逻辑是生成存在漏洞的JWT，不太容易植入后门.考虑到代码较为简单，依赖的外部库较少，且代码功能集中于 JWT 生成，投毒的概率较低，主要风险可能在于对外部库`github.com/mbndr/figlet4go`的供应链攻击。但总的来说，投毒的概率相对较低。


**项目地址:** [n0m-d/CVE-2018-0114-Go](https://github.com/n0m-d/CVE-2018-0114-Go)

**漏洞详情:** [CVE-2018-0114](https://nvd.nist.gov/vuln/detail/CVE-2018-0114)