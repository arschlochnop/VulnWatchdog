## CVE-2024-40898-Apache HTTP Server-SSRF

**漏洞编号:** CVE-2024-40898

**漏洞类型:** SSRF

**影响应用:** Apache HTTP Server

**危害等级:** 高危，可能导致NTLM哈希泄露

**影响版本:** 2.4.0 <= version <= 2.4.61

**利用条件:** Apache HTTP Server运行于Windows，且mod_rewrite在server/vhost上下文中启用

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-40898是Apache HTTP Server在Windows平台上的一个SSRF漏洞，当mod_rewrite模块在server/vhost上下文中启用时，攻击者可以通过构造恶意的HTTP请求，利用服务器发起SSRF攻击，从而可能泄露NTLM哈希。漏洞存在于2.4.0到2.4.61版本。利用方式是诱使服务器向攻击者控制的服务器发起请求，该服务器记录或利用收到的 NTLM 认证信息。

提供的POC代码并非直接利用该SSRF漏洞，而是尝试检测是否存在SSL证书验证绕过，与漏洞描述略有偏差，但是也可以辅助攻击者在攻击前验证是否存在该问题. 该POC代码通过创建一个不进行hostname验证和证书不验证的SSLContext，然后尝试连接目标服务器，并发送一个HEAD请求。如果服务器返回200 OK，则可能存在SSL验证绕过。此处的'绕过' 可能为攻击者提供更多可乘之机，例如更容易地进行中间人攻击。

**关于投毒风险分析：**

虽然代码主要功能是检测SSL证书验证绕过，但仔细审查后发现，代码本身没有明显的恶意行为，例如直接执行系统命令或上传敏感数据。`README.md` 文件中声明该脚本仅用于教育和授权安全测试，并警告不要在未经授权的系统上使用。 但是，任何代码都可能被滥用，因此存在一定的投毒风险，风险较低。由于该POC代码检测的是SSL验证绕过，理论上配合SSRF漏洞利用可以放大SSRF漏洞的危害。综上所述，判定投毒风险为5%。

**项目地址:** [anilpatel199n/CVE-2024-40898](https://github.com/anilpatel199n/CVE-2024-40898)

**漏洞详情:** [CVE-2024-40898](https://nvd.nist.gov/vuln/detail/CVE-2024-40898)