## CVE-2022-24086-Magento-RCE

**漏洞编号:** CVE-2022-24086

**漏洞类型:** 远程代码执行（RCE）

**影响应用:** Magento Commerce

**危害等级:** 高危，未经身份验证的远程代码执行

**影响版本:** <= 2.4.3-p1, <= 2.3.7-p2

**利用条件:** 需要网络访问Magento实例，且目标实例未打补丁。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-24086 是一个 Magento Commerce 中的远程代码执行漏洞。漏洞原因是 checkout 过程中存在不正确的输入验证。攻击者无需身份验证即可通过网络发送恶意请求，最终导致远程代码执行。

**有效性：**
根据漏洞描述和搜索结果，此漏洞已被证实存在并被积极利用。提供的PoC代码 `{{var this.getTemplateFilter().addAfterFilterCallback("system").filter("whoami")}}` 看起来是利用 Magento 的模板引擎执行 `whoami` 命令，验证代码执行权限。

**投毒风险：**
仓库中只包含一个 `README.md` 文件，其中包含 PoC 代码，恶意作者可能会尝试通过较为隐蔽的方式进行投毒，例如在 PoC 中添加看似无害但实际会执行恶意操作的代码。考虑到 PoC 比较简洁，主要验证 RCE 能力，投毒风险较低，大约为 10%。PoC验证的后门代码，目的是为了验证漏洞是否存在。

**利用方式：**
1.  攻击者构造包含恶意模板代码的请求，该代码会被 Magento 的模板引擎解析和执行。
2.  `this.getTemplateFilter()` 获取模板过滤器对象。
3.  `addAfterFilterCallback("system")`  注册一个回调函数，该回调函数会调用 `system()` 函数执行命令。
4.  `filter("whoami")`  实际执行命令，这里是 `whoami`，用于获取当前用户。
通过以上步骤，攻击者可以在服务器上执行任意代码。

**项目地址:** [akr3ch/CVE-2022-24086](https://github.com/akr3ch/CVE-2022-24086)

**漏洞详情:** [CVE-2022-24086](https://nvd.nist.gov/vuln/detail/CVE-2022-24086)