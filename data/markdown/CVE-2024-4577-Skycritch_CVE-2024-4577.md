## CVE-2024-4577 PHP CGI Argument Injection

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8

**利用条件:** Windows系统，PHP以CGI模式运行，开启了使用"Best Fit"策略的代码页。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2024-4577是PHP的一个远程代码执行漏洞，存在于Windows系统上以CGI模式运行的PHP中。当系统配置为使用某些代码页时，Windows可能会使用“Best-Fit”行为来替换传递给Win32 API函数的命令行中的字符。PHP CGI模块可能会错误地将这些字符解释为PHP选项，从而允许恶意用户将选项传递给正在运行的PHP二进制文件，从而泄露脚本的源代码，在服务器上运行任意PHP代码等。 

**有效性分析：**
根据漏洞库信息和搜索结果，此漏洞是一个严重的安全问题，存在公开的PoC利用代码。漏洞利用代码 `CVE-2024-4577.py` 尝试通过在URL中注入PHP选项来利用此漏洞。具体来说，它设置 `allow_url_include` 为 1，并使用 `auto_prepend_file` 包含 `php://input`，然后将要执行的PHP代码通过POST请求发送到目标URL。如果返回结果中包含“1337”，则认为漏洞利用成功。

**投毒风险分析：**
查看提供的POC代码，主要功能是利用漏洞执行任意PHP代码。 `CVE-2024-4577.py`  没有发现明显的恶意代码，该脚本的主要作用是发送包含恶意PHP代码的请求。风险很低。
`README.md`文件只包含漏洞名称，没有投毒风险。
整体投毒风险评估为1%。

**利用方式：**
利用方式如下：
1.  攻击者需要找到运行在Windows服务器上的、使用CGI模式的、且存在漏洞的PHP版本（8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8）。
2.  攻击者构造包含恶意PHP选项的URL，并将其附加到目标PHP脚本的URL后面。
3.  攻击者使用POST请求将要执行的PHP代码发送到服务器。
4.  如果漏洞利用成功，服务器将执行攻击者提供的PHP代码。

**优先级排序依据：**
根据您的要求，分析时遵循以下优先级：搜索引擎结果 > 漏洞利用代码 > 漏洞库信息。
搜索引擎结果用于确认漏洞的广泛性和影响，漏洞利用代码用于分析利用方式和潜在的投毒风险，漏洞库信息用于验证漏洞的存在和影响范围。

**项目地址:** [Skycritch/CVE-2024-4577](https://github.com/Skycritch/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)