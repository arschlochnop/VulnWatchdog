## CVE-2024-3094 - XZ Utils Supply Chain Backdoor

**漏洞编号:** CVE-2024-3094

**漏洞类型:** 供应链攻击/后门

**影响应用:** XZ Utils

**危害等级:** 极危，允许未经授权的远程SSH访问和潜在的远程代码执行

**影响版本:** 5.6.0, 5.6.1

**利用条件:** 目标系统必须使用受感染的 XZ Utils 版本，且SSH服务需要链接到受感染的liblzma库。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-3094 是一个供应链攻击，恶意代码被插入到 XZ Utils 的上游 tarball 中。此恶意代码在构建过程中被提取并用于修改 liblzma 库的特定函数。修改后的库允许攻击者绕过 SSH 身份验证并可能执行任意代码。

**有效性评估：**

根据漏洞库信息和搜索引擎结果，此漏洞的威胁级别为“Critical”，且有公开的利用方法。尽管提供的漏洞利用代码针对 CVE-2024-6387，似乎是一个独立的漏洞，但考虑到 CVE-2024-3094 允许在受感染的系统上远程执行代码，可以推断针对该漏洞的攻击利用的有效性很高。特别是考虑到多个安全公告和分析报告都证实了漏洞的存在和潜在影响。

**投毒风险评估：**

提供的漏洞利用代码针对不同的漏洞 (CVE-2024-6387)，但是，分析`exploit.c` 文件的结构可以发现一些潜在的风险。

*   **Shellcode 替换：** 代码包含一个 `shellcode` 变量，明确指出需要“替换为实际的 shellcode”。如果用户直接使用此代码而不替换 shellcode，那么漏洞利用将不会成功。然而，恶意攻击者可能通过替换 shellcode 来植入恶意负载，从而实现投毒。
*   **GLIBC 基地址：** 代码依赖于预定义的 `GLIBC_BASES` 地址。如果目标系统的 GLIBC 基地址不在列表中，则漏洞利用将失败。攻击者可以在此部分加入不稳定的地址或者恶意地址进行投毒。
*   **Timing 参数：** 注释中提到需要根据目标系统调整 Timing 参数。不正确的 Timing 参数可能会导致拒绝服务或其他意外行为。
*  **潜在的后门：**  代码中包含了绕过身份验证的逻辑和执行远程代码的能力，这本身就可以被视为一个后门。但是，这部分代码是漏洞利用的一部分，并非作者隐藏的恶意代码。

总体而言，该漏洞利用代码本身不包含明显的投毒代码，但是如果用户不小心使用了不正确的shellcode或者参数，可能会造成系统不稳定，或者被攻击者利用。投毒风险评估为 10%。

**利用方式：**

1.  **供应链攻击：** 攻击者首先将恶意代码注入到 XZ Utils 的上游 tarball 中。
2.  **构建过程劫持：** 在构建过程中，恶意代码被提取并用于修改 liblzma 库。
3.  **SSH 身份验证绕过：** 修改后的 liblzma 库被用于 SSH 服务，允许攻击者绕过身份验证。
4.  **远程代码执行：** 成功绕过身份验证后，攻击者可以执行任意代码。

**项目地址:** [DANO-AMP/CVE-2024-3094](https://github.com/DANO-AMP/CVE-2024-3094)

**漏洞详情:** [CVE-2024-3094](https://nvd.nist.gov/vuln/detail/CVE-2024-3094)