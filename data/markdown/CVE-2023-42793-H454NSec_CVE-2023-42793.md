## CVE-2023-42793 - JetBrains TeamCity 身份验证绕过导致RCE

**漏洞编号:** CVE-2023-42793

**漏洞类型:** 身份验证绕过

**影响应用:** JetBrains TeamCity

**危害等级:** 高危，未经身份验证的远程代码执行

**影响版本:** < 2023.05.4

**利用条件:** 目标TeamCity服务器可从攻击者控制的网络访问。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-42793 漏洞存在于JetBrains TeamCity 2023.05.4 之前的版本中，允许未经身份验证的攻击者绕过身份验证，最终实现远程代码执行。根据漏洞库信息，该漏洞的 CVSS 3.1 评分为 9.8，属于严重级别。搜索结果表明，该漏洞已被广泛利用，甚至被 APT 组织用于攻击活动。 

**漏洞利用方式：**

1.  **身份验证绕过：** 漏洞利用代码通过发送特制的 HTTP 请求来绕过 TeamCity 的身份验证机制。具体利用细节需要分析补丁或者参考其他分析报告。
2.  **创建管理员用户：** 漏洞利用代码首先删除 id 为 1 的用户的token，然后创建一个新的用户 token。使用这个 token，攻击者可以创建一个具有管理员权限的新用户。新用户的用户名和密码可以通过命令行参数指定，默认用户名为 `H454NSec[随机数]`，密码为 `@H454NSec`。利用成功后，即可使用创建的管理员用户登录TeamCity控制台。
3.  **远程代码执行：** 通过管理员权限，攻击者可以在 TeamCity 服务器上执行任意代码，实现远程控制。

**有效性：**

根据漏洞库信息、搜索引擎结果和提供的漏洞利用代码，可以确定该 POC 代码是有效的。漏洞已被公开披露且有可用的利用代码。

**投毒风险：**

该 POC 代码存在一定的投毒风险。风险分析如下：

*   **代码结构：** 代码结构相对清晰，主要功能是利用漏洞创建管理员用户。
*   **可疑行为：** 代码中存在以下潜在风险：
    *   **默认用户名和密码：** 使用默认的用户名和密码 `@H454NSec` 创建管理员帐户，这可能会让其他攻击者更容易入侵，或者导致安全审计告警。
    *   **硬编码的 User-Agent：**  User-Agent头 `Mozilla/5.0 (https://github.com/H454NSec/CVE-2023-42793) Gecko/20100101 Firefox/113.0`  可能被用于追踪攻击源。但同时也降低了攻击的隐蔽性。
    *   **未处理异常：** 虽然代码有异常处理，但仅仅是简单的`pass`，可能会隐藏一些错误信息，增加调试难度。
*   **高危操作：**  漏洞利用本身就是高危操作，如果攻击者通过修改poc加入恶意命令，将会造成严重危害，例如植入后门。

综合考虑以上因素，该 POC 代码的投毒风险评估为 10%。主要风险在于攻击者可能利用该代码进行二次修改，加入恶意代码或后门，从而扩大攻击范围。

**项目地址:** [H454NSec/CVE-2023-42793](https://github.com/H454NSec/CVE-2023-42793)

**漏洞详情:** [CVE-2023-42793](https://nvd.nist.gov/vuln/detail/CVE-2023-42793)