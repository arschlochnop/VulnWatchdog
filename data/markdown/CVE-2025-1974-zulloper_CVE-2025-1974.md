## CVE-2025-1974-ingress-nginx-RCE

**漏洞编号:** CVE-2025-1974

**漏洞类型:** 远程代码执行

**影响应用:** ingress-nginx

**危害等级:** 高危，可导致集群范围内的Secrets泄露和任意代码执行

**影响版本:** <= 1.11.4 和 1.12.0

**利用条件:** 需要访问Pod网络

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2025-1974 是 Kubernetes ingress-nginx 中的一个严重漏洞，允许未经身份验证的攻击者通过访问 Pod 网络在 ingress-nginx 控制器的上下文中执行任意代码。漏洞位于 Validating Admission Controller 中，攻击者可以通过构造特制的 Ingress 对象，向 webhook 发送恶意负载，从而绕过验证并注入恶意配置到 Nginx 中。利用链如下：

1.  **环境准备:** 设置 Kubernetes 集群并部署受影响版本的 ingress-nginx controller。
2.  **端口转发:** 将 ingress-nginx pod 的 80 端口（HTTP）和 8443 端口（Webhook）转发到本地端口，例如 8888 和 1337。
3.  **恶意共享对象准备:** 编译一个共享对象（.so 文件），其中包含反向 shell 代码。需要根据目标环境的架构进行交叉编译。
4.  **构造 AdmissionReview 请求:**  创建一个 AdmissionReview 请求，该请求包含一个恶意的 Ingress 对象，该对象利用 `nginx.ingress.kubernetes.io/auth-url` 注解注入恶意 Nginx 指令。`admission_test.yml` 和 `admission_review_req_body.json` 文件用于构建此请求。关键在于`PAYLOAD` 字段，此处会被替换成恶意指令。
5.  **上传恶意共享对象:**  使用 `exploit.py` 脚本将编译好的共享对象上传到 ingress-nginx controller 可以访问的位置。该脚本通过向转发的 8888 端口发送 POST 请求来实现上传。Content-Length 设置为 1000000 允许上传较大的so文件
6.  **触发恶意代码执行:**  通过向 webhook 发送包含恶意 Ingress 对象的 AdmissionReview 请求，触发 Validating Admission Controller 的处理。控制器将执行 Ingress 对象中注入的恶意 Nginx 指令，导致共享对象被加载，从而执行反向 shell 代码。
7.  **获得反向 Shell:** 攻击者使用 `nc -lv 4444` 监听指定端口，一旦恶意代码执行，将建立反向 shell 连接。

**有效性评估：**
提供的 POC 代码看起来是有效的，它详细描述了如何利用该漏洞进行远程代码执行。该 POC 包括了环境设置，恶意共享对象编译，构建 AdmissionReview 请求，上传恶意共享对象以及触发代码执行的完整步骤。

**投毒风险评估：**
代码中存在微小的投毒风险，可能性约为 1%。 主要集中在以下几个方面：

*   **共享对象中的反向 Shell:** 反向 shell 本身可以被视为后门，但这是漏洞利用的必要组成部分，不算作投毒。
*   **潜在的恶意指令注入：** 如果 `exploit.py` 中用于生成 Ingress 对象的代码被修改，可能会注入其他恶意指令，超出反向 shell 的范围。不过，从提供的代码来看，并没有明显的迹象表明存在此类行为。

总体而言，该 POC 的主要目的是演示漏洞利用，而不是植入恶意后门。因此，投毒的风险较低。

**项目地址:** [zulloper/CVE-2025-1974](https://github.com/zulloper/CVE-2025-1974)

**漏洞详情:** [CVE-2025-1974](https://nvd.nist.gov/vuln/detail/CVE-2025-1974)