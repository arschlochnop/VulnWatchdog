## CVE-2018-14847-MikroTik RouterOS-目录遍历

**漏洞编号:** CVE-2018-14847

**漏洞类型:** 目录遍历

**影响应用:** MikroTik RouterOS

**危害等级:** 高危，可能导致敏感信息泄露和任意文件读写

**影响版本:** <= 6.42

**利用条件:** 需要网络访问 Winbox 接口 (通常是 8291 端口)

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2018-14847是一个存在于MikroTik RouterOS 6.42及更早版本中的目录遍历漏洞。该漏洞存在于Winbox接口中，允许未经身份验证的远程攻击者读取任意文件，以及经过身份验证的攻击者写入任意文件。

**有效性：**

根据漏洞库信息和搜索结果，此漏洞是真实存在的，并且有公开的PoC代码可用。Tenable等安全公司已经发布了关于此漏洞的报告和利用代码。漏洞利用代码 `MACServerDiscover.py` 用于发现局域网内的MikroTik设备，而 `MACServerExploit.py` 则尝试利用该漏洞。

**利用方式：**

1.  **设备发现：** 使用`MACServerDiscover.py`脚本，通过广播在局域网内查找运行MikroTik RouterOS且Winbox服务开启的设备。这个脚本发送一个特定的广播包，然后监听来自MikroTik设备的响应，从中提取设备的MAC地址。
2.  **漏洞利用：** 使用`MACServerExploit.py`脚本，它包含硬编码的路径（`../../flash/rw/store/user.dat`），试图利用目录遍历漏洞读取存储用户凭据的`user.dat`文件。
3.  **数据提取：** 该脚本可能使用定制的 Winbox 协议与目标设备通信，发送恶意请求以读取文件内容。 `extract_user.py` 用于从读取到的`user.dat`文件中提取用户名和密码。

**投毒风险：**

审查提供的PoC代码，特别是 `MACServerExploit.py`，发现以下潜在风险：

*   **硬编码的路径：** PoC 代码依赖于已知的默认文件路径 (`../../flash/rw/store/user.dat`)。如果目标设备的配置或文件系统结构与预期不符，则利用可能会失败。利用成功与否取决于目标设备上特定文件的存在和位置。
*   **广播地址：**  该脚本默认使用广播地址 (`255.255.255.255`) 发送数据包，可能导致网络拥塞，同时增加被防火墙或入侵检测系统拦截的风险。
*   **未授权访问风险：** 成功利用此漏洞可能导致攻击者获得对路由器配置的未授权访问，从而允许他们更改设置、安装后门或执行其他恶意操作。
*    **依赖的`extract_user.py`** 作者可以在这个文件中加入恶意代码，此文件中未提供，无法判断。

尽管存在上述风险，但代码主要目的是验证漏洞的存在并提取敏感信息，没有发现明显的恶意代码注入或后门植入行为。投毒风险评估为 10%。这个评估考虑到硬编码路径，导致利用的成功率降低，而且并没有发现明显的恶意代码。但仍然需要进一步审查 `extract_user.py`。


**项目地址:** [sinichi449/Python-MikrotikLoginExploit](https://github.com/sinichi449/Python-MikrotikLoginExploit)

**漏洞详情:** [CVE-2018-14847](https://nvd.nist.gov/vuln/detail/CVE-2018-14847)