## CVE-2017-16995-Linux Kernel-BPF 权限提升

**漏洞编号:** CVE-2017-16995

**漏洞类型:** 本地权限提升

**影响应用:** Linux Kernel

**危害等级:** 高危，可能导致root权限获取

**影响版本:** <= 4.4

**利用条件:** 需要本地用户权限，开启BPF_SYSCALL

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2017-16995是Linux内核BPF验证器中`check_alu_op`函数的一个整数溢出漏洞。该漏洞允许本地用户通过构造恶意的BPF程序，利用符号扩展错误导致内存损坏，从而实现权限提升。

**有效性:**

根据漏洞库信息、搜索引擎结果以及提供的PoC代码，该漏洞存在并且PoC代码可利用。漏洞库信息明确指出漏洞影响Linux Kernel 4.4及以下版本，并提供了多个Exploit-DB的链接，表明存在公开的利用代码。搜索引擎结果也指向了多个关于该漏洞的讨论和分析，确认了其存在和危害。

提供的PoC代码（44298.c）是一个针对Ubuntu 16.04.4的本地权限提升漏洞利用程序。代码通过构造恶意的BPF程序，利用`check_alu_op`函数中的符号扩展错误，覆盖内核内存中的`cred`结构，从而将当前用户的UID、GID等权限信息修改为root用户的权限信息。

**投毒风险:**

PoC代码本身的功能是权限提升，不是恶意后门。但任何PoC代码都存在被修改为恶意代码的风险。检查发现，代码本身较为精简，主要功能集中在利用BPF漏洞覆盖`cred`结构。潜在的投毒风险可能存在于以下几个方面：

1.  **覆盖地址的修改：** 攻击者可能会修改PoC代码中覆盖`cred`结构的地址，指向其他敏感的内核数据结构，导致系统崩溃或其他不可预测的行为。
2.  **恶意代码注入：** 攻击者可能会在PoC代码中注入额外的恶意代码，例如，创建一个后门账户，或者执行任意命令。
3.  **依赖项修改：** 攻击者可能会修改PoC代码的依赖项，例如，修改`#include`的文件，引入包含恶意代码的头文件。

考虑到PoC代码的功能相对明确，代码量较小，因此投毒风险较低，估计为10%。

**利用方式:**

1.  **漏洞触发：**  攻击者首先需要编译并运行提供的PoC代码。PoC代码会创建一个恶意的BPF程序，并通过`setsockopt`系统调用将其附加到socket上。
2.  **内存覆盖：**  当socket接收或发送数据时，恶意的BPF程序会被执行，触发`check_alu_op`函数中的漏洞，导致内核内存中的`cred`结构被覆盖。
3.  **权限提升：**  `cred`结构被覆盖后，当前用户的权限信息被修改为root用户的权限信息，从而实现权限提升。

**总结:**

CVE-2017-16995是一个高危的Linux内核漏洞，PoC代码的有效性较高，可以实现本地权限提升。虽然PoC代码本身不是恶意后门，但存在被修改为恶意代码的风险。利用方式主要是通过构造恶意的BPF程序，覆盖内核内存中的`cred`结构，从而实现权限提升。

**项目地址:** [xxxTectationxxx/CVE-2017-16995](https://github.com/xxxTectationxxx/CVE-2017-16995)

**漏洞详情:** [CVE-2017-16995](https://nvd.nist.gov/vuln/detail/CVE-2017-16995)