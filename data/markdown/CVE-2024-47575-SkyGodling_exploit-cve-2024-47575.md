## CVE-2024-47575 - FortiManager 未授权远程代码执行漏洞 (FortiJump)

**漏洞编号:** CVE-2024-47575

**漏洞类型:** 未授权远程代码执行

**影响应用:** FortiManager

**危害等级:** 高危，允许未授权的远程攻击者执行任意代码或命令

**影响版本:** FortiManager 7.6.0, 7.4.0-7.4.4, 7.2.0-7.2.7, 7.0.0-7.0.12, 6.4.0-6.4.14, 6.2.0-6.2.12, FortiManager Cloud 7.4.1-7.4.4, FortiManager Cloud 7.2.1-7.2.7, FortiManager Cloud 7.0.1-7.0.12, FortiManager Cloud 6.4.1-6.4.7

**利用条件:** 目标FortiManager实例暴露在互联网上，且端口541可访问

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2024-47575 是 FortiManager 的一个严重漏洞，也被称为 "FortiJump"。该漏洞由于 fgfmsd 守护进程中缺少身份验证，允许未经身份验证的远程攻击者通过特制的请求执行任意代码或命令。攻击者首先需要获取目标设备的一个 'remoteid'，通过构造特定的报文可以获取未授权的id， 然后使用'channel'请求，上传恶意的json payload，在payload中植入反弹shell的命令。

**漏洞利用方式：**

1.  **目标发现：** 确定暴露在互联网上且运行受影响 FortiManager 版本的实例。
2.  **获取Remote ID：** 通过`get file_exchange`请求获取一个有效的`remoteid`。
3.  **构造恶意请求：** 创建包含恶意命令的 JSON payload，该命令会在目标系统上执行反弹shell。
4.  **发送Channel Open请求：** 使用'channel'请求，将构造的 JSON payload 发送到目标。
5.  **反弹 Shell：** 成功利用后，攻击者将获得目标系统的反弹 shell。
6.  **Channel Close请求：** 关闭已打开的channel。

**投毒风险分析：**

该POC代码本身旨在利用 CVE-2024-47575 漏洞，实现远程代码执行。代码中，反弹 shell 的 IP 地址和端口由用户通过 `--lhost` 和 `--lport` 参数指定。恶意攻击者可能会修改此 POC，在反弹 shell 之外，添加额外的恶意功能，例如安装后门、收集敏感信息等，并在网络上广泛传播修改后的 POC。但是提供的代码只是实现了反弹shell的功能，没有发现明显的投毒代码，风险较低，大概1%。证书文件 `w00t_cert.bin`和`w00t_key.bin`可能包含后门，不在本次分析范围内。

**项目地址:** [SkyGodling/exploit-cve-2024-47575](https://github.com/SkyGodling/exploit-cve-2024-47575)

**漏洞详情:** [CVE-2024-47575](https://nvd.nist.gov/vuln/detail/CVE-2024-47575)