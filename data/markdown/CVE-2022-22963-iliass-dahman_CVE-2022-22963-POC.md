## CVE-2022-22963-Spring Cloud Function-远程代码执行

**漏洞编号:** CVE-2022-22963

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Spring Cloud Function

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** Spring Cloud Function versions 3.1.6, 3.2.2 and older unsupported versions

**利用条件:** 使用了Spring Cloud Function的路由功能，且允许用户提供路由表达式。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22963 是 Spring Cloud Function 框架中的一个远程代码执行漏洞。当应用程序使用路由功能，并且允许用户提供 SpEL 表达式作为路由条件时，攻击者可以构造恶意的 SpEL 表达式，从而在服务器上执行任意代码。从提供的漏洞利用代码可以看出，该漏洞利用的有效性较高，因为该代码提供了一个docker环境，模拟了攻击者与服务器。其中exploit.py 脚本构造包含反弹shell命令的payload，然后通过设置 `spring.cloud.function.routing-expression` 请求头将其注入到 `/functionRouter` 路径。服务器收到请求后，会将 SpEL 表达式解析执行，从而实现远程代码执行。该仓库中存在作者隐藏的投毒代码的可能性较低，因为Dockerfile文件中使用的镜像源都是官方源。exploit.py的逻辑较为简单，没有发现恶意代码，主要是构造payload和发送请求。 run.sh 脚本只是辅助执行docker命令，也没有发现恶意代码。因此可以判断投毒风险较低。

**利用方式：**

1.  **确定目标：** 找到运行着受影响版本 Spring Cloud Function 的应用程序。
2.  **构造恶意 SpEL 表达式：** 构造一个包含恶意代码的 SpEL 表达式，例如执行系统命令的反弹shell命令。
3.  **发送请求：**  通过构造包含 `spring.cloud.function.routing-expression` 请求头的 HTTP POST 请求，将恶意 SpEL 表达式发送到 `/functionRouter` 路径。
4.  **执行代码：**  服务器解析并执行恶意 SpEL 表达式，从而在服务器上执行任意代码。
5.  **反弹 Shell:** 攻击者使用 netcat 监听端口，等待目标服务器反弹 shell。

搜索引擎结果和漏洞库信息也确认了该漏洞的存在和危害，并且公开可用exp的存在也佐证了该漏洞的可利用性。

**项目地址:** [iliass-dahman/CVE-2022-22963-POC](https://github.com/iliass-dahman/CVE-2022-22963-POC)

**漏洞详情:** [CVE-2022-22963](https://nvd.nist.gov/vuln/detail/CVE-2022-22963)