## CVE-2025-1974 - Ingress-nginx Admission Controller RCE Escalation

**漏洞编号:** CVE-2025-1974

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** ingress-nginx

**危害等级:** 严重，未经身份验证的攻击者可能在 Ingress Nginx 控制器的上下文中执行任意代码，导致泄露集群范围内的 Secrets。

**影响版本:** <= 1.11.4, 1.12.0

**利用条件:** 攻击者需要能够访问 Pod 网络，并且目标系统正在运行受影响版本的 ingress-nginx，并且启用了 Validating Admission Controller。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2025-1974 是一个存在于 Kubernetes ingress-nginx 中的严重漏洞，攻击者可以通过注入恶意的 Nginx 配置指令来利用此漏洞。提供的 PoC 代码通过 `auth-url` 注释注入 `error_log` 指令，该指令会将日志发送到攻击者控制的 DNS 服务器。如果目标系统存在漏洞，Nginx 配置验证过程将尝试解析攻击者的 DNS 服务器，从而确认漏洞存在。该 PoC 仅用于检测漏洞是否存在，不会执行任意代码。

**漏洞利用方式：**

1.  **攻击者访问 Pod 网络：** 攻击者必须位于可以访问 Kubernetes 集群 Pod 网络的网络中。
2.  **注入恶意配置：** 攻击者利用 Ingress 资源的 annotation 功能，特别是 `nginx.ingress.kubernetes.io/auth-url`，注入恶意的 Nginx 配置指令。PoC 中注入的配置包括 resolver 和 error_log 指令。
3.  **触发配置验证：** 当 Admission Controller 处理包含恶意配置的 Ingress 资源时，它会尝试验证 Nginx 配置。
4.  **DNS 解析：** 在配置验证期间，Nginx 尝试解析恶意 `error_log` 指令中指定的攻击者控制的域名。
5.  **漏洞确认：** 攻击者通过监控其 DNS 服务器的日志来确认漏洞的存在，如果看到来自目标系统的 DNS 查询，则表明该系统易受攻击。

**投毒风险分析：**

提供的代码主要用于检测漏洞，并没有发现恶意代码。`detect.py` 脚本用于发送特制的 AdmissionReview 请求以触发 DNS 查询，以此来验证漏洞是否存在，该行为属于漏洞验证行为，不属于投毒。因此，该代码的投毒风险极低。

**项目地址:** [m-q-t/ingressnightmare-detection-poc](https://github.com/m-q-t/ingressnightmare-detection-poc)

**漏洞详情:** [CVE-2025-1974](https://nvd.nist.gov/vuln/detail/CVE-2025-1974)