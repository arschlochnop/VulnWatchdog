## CVE-2024-21413 Microsoft Outlook 远程代码执行漏洞

**漏洞编号:** CVE-2024-21413

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Microsoft Outlook

**危害等级:** 严重，无需用户交互即可远程执行代码

**影响版本:** 受影响版本包括 Microsoft Office 2016 (版本低于 16.0.5435.1001)、Microsoft Office 2019、Microsoft 365 Apps for Enterprise 和 Microsoft Office LTSC 2021 (版本低于 https://aka.ms/OfficeSecurityReleases)

**利用条件:** 需要目标用户使用受影响的Outlook版本，并预览或点击包含恶意链接的邮件。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-21413 是一个 Microsoft Outlook 远程代码执行漏洞，也称为 "MonikerLink" 漏洞。攻击者可以通过构造包含恶意 `file://` 链接的电子邮件，诱使用户点击或预览该邮件，从而在目标系统上执行任意代码。根据POC代码，攻击者可以使用一个 Expect 脚本发送特制的电子邮件，该邮件包含一个指向远程SMB服务器的 `file://` 链接。当 Outlook 处理此链接时，它会尝试连接到远程服务器，从而泄露用户的 NTLM 哈希值。如果攻击者能够破解哈希值或利用 NTLM 中继攻击，他们就可以获得对系统的访问权限。此外，此漏洞可以与CVE-2023-21716链接以达到远程代码执行的目的。

**有效性：**
提供的POC代码似乎有效，因为它演示了如何利用 `file://` 协议发送包含恶意链接的电子邮件。从漏洞信息和搜索引擎结果来看，该漏洞已经被积极利用。CISA 将其添加到已知被利用的漏洞列表中，表明该漏洞在现实世界中具有很高的威胁。

**投毒风险：**
虽然提供的代码主要目的是演示漏洞利用过程，但存在一些潜在的投毒风险。 Expect脚本本身没有明显的后门,主要利用了telnet发送恶意邮件. 但是，考虑到以下几点，风险评估为10%：
1.  **对外部依赖的信任：** 该脚本依赖于 `expect` 工具，如果该工具被篡改，则可能引入恶意行为。
2.  **脚本执行环境：** 该脚本的执行环境可能存在安全漏洞，攻击者可以利用这些漏洞来执行恶意代码。
3.  **社会工程学：** 攻击者可能会修改脚本以使其更具欺骗性，例如伪造发件人地址或使用更具吸引力的主题行，从而提高攻击成功率。

**利用方式：**
1.  攻击者设置一个 SMB 服务器来监听传入的连接。
2.  攻击者使用提供的 `cve-2024-21413.sh` 脚本生成包含恶意 `file://` 链接的电子邮件。
3.  攻击者将该电子邮件发送给目标用户。
4.  当目标用户在受影响的 Outlook 版本中预览或点击该邮件中的链接时，Outlook 会尝试连接到攻击者的 SMB 服务器。
5.  此连接会导致用户的 NTLM 哈希值被发送到攻击者的服务器。
6.  攻击者可以使用破解工具（如 Hashcat）破解哈希值，或者利用 NTLM 中继攻击来获得对目标系统的访问权限。
7. 攻击者可以将此漏洞与 CVE-2023-21716 结合使用，以实现远程代码执行。


**项目地址:** [duy-31/CVE-2024-21413](https://github.com/duy-31/CVE-2024-21413)

**漏洞详情:** [CVE-2024-21413](https://nvd.nist.gov/vuln/detail/CVE-2024-21413)