## CVE-2023-21768

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升

**影响应用:** Windows Ancillary Function Driver for WinSock (AFD)

**危害等级:** 高危，本地权限提升

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 需要本地访问，且系统版本在受影响范围内

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-21768 是 Windows AFD (Ancillary Function Driver for WinSock) 驱动中的一个本地权限提升漏洞。攻击者可以利用此漏洞在受影响的系统上执行任意代码并获得提升的权限。 

**利用方式：**

1.  该漏洞是由于 AFD 驱动程序中存在未受信指针解引用缺陷（CWE-822）导致的。
2.  攻击者可以通过精心构造的输入数据，诱使 AFD 驱动程序解引用一个恶意的指针，从而控制程序的执行流程。
3.  成功利用此漏洞后，攻击者可以获得 `SYSTEM` 权限。
4.  根据搜索结果，github上已经存在完整的exp：https://github.com/Malwareman007/CVE-2023-21768， 经验证可在存在漏洞的win11 22H2上稳定提权。

**有效性：**

根据搜索结果，漏洞利用代码是有效的，并且可以在脆弱的Windows 11 22H2系统上稳定运行。Rapid7， SentinelOne 等安全厂商也对此漏洞进行了分析和验证，证明其危害性。

**投毒风险：**

提供的漏洞利用代码是一个 Visual Studio 解决方案，其中包括一个 C++ 项目。 代码中包含完整的项目结构和源代码，虽然许可协议是 GNU Affero General Public License v3，但仍存在一定的投毒风险。潜在的投毒方式可能包括：

*   **隐藏的恶意代码：** 在代码中插入难以察觉的后门或恶意代码，例如，在触发漏洞利用的同时执行其他恶意操作。
*   **依赖项劫持：** 通过修改项目配置或添加恶意依赖项，在编译或运行时引入恶意代码。
*   **构建过程投毒：** 在构建脚本或编译过程中插入恶意代码，例如，下载并执行恶意payload。

考虑到该漏洞利用代码相对简单，且已经公开，攻击者手动添加恶意代码的动机较弱。 但考虑到代码的复杂性，无法完全排除投毒的可能。因此，保守估计投毒风险为5%。 建议使用者仔细审查源代码，并在隔离环境中构建和测试漏洞利用代码。

**项目地址:** [Malwareman007/CVE-2023-21768](https://github.com/Malwareman007/CVE-2023-21768)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)