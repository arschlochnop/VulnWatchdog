## CVE-2023-4911 - Glibc ld.so 本地权限提升

**漏洞编号:** CVE-2023-4911

**漏洞类型:** 缓冲区溢出

**影响应用:** glibc

**危害等级:** 高危，本地权限提升至root

**影响版本:** 2.34 <= glibc < 2.39

**利用条件:** 需要本地用户权限，目标系统glibc版本符合漏洞影响范围，并且存在SUID程序。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-4911 漏洞是glibc动态链接器ld.so在处理GLIBC_TUNABLES环境变量时发生的缓冲区溢出。攻击者可以利用特制的GLIBC_TUNABLES环境变量，在启动具有SUID权限的二进制文件时执行代码，从而提升权限。 

**有效性评估：**
根据漏洞信息和搜索结果，这是一个已知的、严重性高的本地权限提升漏洞。多个来源（包括Qualys、Red Hat、NVD）都确认了该漏洞的存在和影响。漏洞利用代码的描述与漏洞原理一致，通过构造特定的环境变量`GLIBC_TUNABLES`来触发缓冲区溢出。

**利用方式分析：**
1.  **漏洞触发：**  通过设置`GLIBC_TUNABLES`环境变量为一个超长字符串，导致在`ld.so`加载器处理该环境变量时发生缓冲区溢出。
2.  **权限提升：**  利用SUID程序，当SUID程序启动时，`ld.so`会加载并处理环境变量。如果`GLIBC_TUNABLES`环境变量被恶意构造，溢出发生时可以覆盖内存中的某些关键区域，例如函数指针或返回地址，从而劫持程序的执行流程，最终执行攻击者控制的代码，获取root权限。
3.  **POC代码分析：**
    *   **步骤1：** 验证目标机器是否存在漏洞，如果出现`Segmentation fault (core dumped)`，则存在漏洞。
    *   **步骤2：** `libc.py`的作用是从目标机器的glibc中提取`__libc_start_main`函数的地址，并将shellcode注入到该位置生成攻击用的`libc.so.6`，这个生成的`libc.so.6`会被exp.c调用。
    *   **步骤3：** `exp.c`程序设置环境变量`GLIBC_TUNABLES`，构造payload，替换`l_info[DT_RPATH]`，通过`execve`函数执行`/usr/bin/su --help`来触发漏洞。 程序尝试通过 fork 循环执行 `execve`，提高了利用成功的概率。

**投毒风险评估：**
代码主要目的是利用该漏洞进行权限提升。分析发现存在轻微的投毒风险，代码中替换`libc.so.6`的行为可能被利用植入恶意代码，但是概率较低。`libc.py`从目标系统提取`__libc_start_main`地址，生成攻击用的`libc.so.6`，也降低了恶意替换的可能性。`exp.c`的修改主要集中在利用漏洞的层面，没有发现明显的恶意代码注入。

**结论：**
该漏洞利用的有效性较高，风险等级为高危。通过利用精心构造的`GLIBC_TUNABLES`环境变量，攻击者可以实现本地权限提升。该漏洞利用代码存在较低的投毒风险。

**项目地址:** [teraGL/looneyCVE](https://github.com/teraGL/looneyCVE)

**漏洞详情:** [CVE-2023-4911](https://nvd.nist.gov/vuln/detail/CVE-2023-4911)