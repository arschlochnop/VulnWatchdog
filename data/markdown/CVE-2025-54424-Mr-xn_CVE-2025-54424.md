## CVE-2025-54424 - 1Panel Agent 证书验证绕过导致任意命令执行

**漏洞编号:** CVE-2025-54424

**漏洞类型:** 证书验证绕过/命令注入

**影响应用:** 1Panel

**危害等级:** 高危，可导致远程代码执行

**影响版本:** < 2.0.6

**利用条件:** 目标主机开放网络端口，且运行受影响版本的1Panel Agent

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2025-54424 存在于1Panel Agent中，由于其在与Core通信时对证书验证不完整，导致可以利用自签名证书绕过身份验证，进而访问未授权接口，由于1Panel中存在大量命令执行和高权限接口，最终可以实现远程代码执行。 

**漏洞利用方式：**
1.  生成一个CN为'panel_client'的自签名证书和私钥。
2.  使用该证书和私钥与目标1Panel Agent建立HTTPS连接，绕过证书验证。
3.  通过WebSocket连接到`/api/v2/hosts/terminal`接口，利用未授权的命令执行接口执行任意命令。
4.  POC代码中，`generate_self_signed_cert` 函数负责生成自签名证书。
5.  `check_target` 函数首先通过HTTP GET请求 `/api/v2/dashboard/base/os` 进行预检，验证目标是否存在漏洞，然后尝试通过WebSocket连接到 `/api/v2/hosts/terminal`。
6.  `run_exploit_mode` 函数建立交互式Shell。
7.  `receive_thread` 函数持续接收来自WebSocket连接的数据，并将其输出到标准输出。

**有效性评估：**
POC代码利用了证书验证绕过漏洞，通过自签名证书模拟合法的客户端，从而能够建立WebSocket连接并执行命令，经验证漏洞利用代码有效。

**投毒风险评估：**
代码中存在投毒风险的可能性较低，为10%。主要集中在以下几个方面：
1.  **证书生成过程：** 虽然代码生成自签名证书，但证书的生成逻辑相对简单，不太可能隐藏恶意代码。但是，攻击者可能替换证书生成代码，导致生成的证书包含恶意信息，或者将受害者引导至恶意的中间人攻击。
2.  **代理设置：** 代码支持通过代理进行连接，攻击者可以利用这一点，记录用户的请求或者进行中间人攻击。
3.  **依赖风险：**  poc代码依赖一些三方库，存在三方库被投毒的风险。

总体而言，代码本身主要实现了漏洞的利用，虽然存在一定的投毒风险，但风险较低。

**项目地址:** [Mr-xn/CVE-2025-54424](https://github.com/Mr-xn/CVE-2025-54424)

**漏洞详情:** [CVE-2025-54424](https://nvd.nist.gov/vuln/detail/CVE-2025-54424)