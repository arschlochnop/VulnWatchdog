## CVE-2021-44026-Roundcube-SQL注入

**漏洞编号:** CVE-2021-44026

**漏洞类型:** SQL注入

**影响应用:** Roundcube

**危害等级:** 高危，可能导致数据泄露和远程代码执行

**影响版本:** 1.3.0 < version < 1.3.17 和 1.4.0 < version < 1.4.12

**利用条件:** 需要Roundcube Webmail实例，且目标用户能够接收并打开包含恶意payload的邮件。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2021-44026是Roundcube Webmail中存在的一个SQL注入漏洞，位于搜索功能或search_params参数中。攻击者可以通过构造恶意的SQL语句，注入到搜索参数中，从而执行任意SQL查询。 

**有效性分析：**
提供的POC代码包含两个文件：
1.  `exploit_chain_xss_sqli.py`：这是一个Python脚本，用于发送包含XSS payload的邮件，并在本地启动一个Flask服务器，用于接收从目标Roundcube实例导出的数据。
2.  `static/x-fetch-sqli.js`：这是一个JavaScript文件，包含利用SQL注入漏洞的payload。该payload首先通过UNION SELECT语句从session表中提取SESSID和VARS信息，然后通过搜索功能触发SQL注入，最后将导出的数据发送到攻击者的服务器。

根据漏洞描述、搜索结果和POC代码，此漏洞利用的有效性较高，因为:
* 漏洞库信息明确指出此漏洞的存在，并且影响了特定的Roundcube版本。
* 搜索结果中包含利用此漏洞的实例，以及相关的分析文章。
* POC代码提供了一种利用XSS和SQL注入组合攻击的方法，可以提取敏感信息。

**投毒风险分析：**
在提供的POC代码中，`x-fetch-sqli.js` 文件中定义了C2服务器的地址 `let c2 = "http://192.168.1.2:8181"`。如果攻击者控制了此C2服务器，或者更改了代码中的C2服务器地址，则可以收集所有受害者的敏感信息。在 `exploit_chain_xss_sqli.py`中，攻击者可以通过修改邮件内容，诱使用户点击恶意链接或执行恶意脚本。

但整体代码的目的是利用已知漏洞，而非植入后门，投毒风险较低。因此，判断投毒风险为 **1%** 。

**利用方式分析：**
1.  **发送恶意邮件：** 攻击者首先使用`exploit_chain_xss_sqli.py`脚本，构造包含XSS payload的邮件，并将其发送给目标用户。
2.  **触发XSS：** 目标用户打开邮件后，XSS payload会被执行，从而加载`x-fetch-sqli.js`文件。
3.  **SQL注入：** `x-fetch-sqli.js`文件利用Roundcube的搜索功能，构造SQL注入payload，从数据库中提取SESSID和VARS信息。
4.  **数据导出：** 通过地址簿导出功能，再次触发SQL注入，将包含SESSID和VARS信息的vCard文件导出。
5.  **数据回传：**  将导出的vCard文件使用base64编码后，发送到攻击者的C2服务器。
6.  **获取敏感信息：** 攻击者在C2服务器上接收到数据后，进行base64解码，从而获得目标用户的SESSID和VARS信息，进而可能控制目标用户的账户。

**项目地址:** [skyllpro/CVE-2021-44026-PoC](https://github.com/skyllpro/CVE-2021-44026-PoC)

**漏洞详情:** [CVE-2021-44026](https://nvd.nist.gov/vuln/detail/CVE-2021-44026)