## CVE-2022-26134-Confluence-OGNL注入

**漏洞编号:** CVE-2022-26134

**漏洞类型:** OGNL注入

**影响应用:** Confluence Server and Data Center

**危害等级:** 高危，允许未授权的远程代码执行

**影响版本:** 1.3.0 < version < 7.4.17, 7.13.0 <= version < 7.13.7, 7.14.0 <= version < 7.14.3, 7.15.0 <= version < 7.15.2, 7.16.0 <= version < 7.16.4, 7.17.0 <= version < 7.17.4, 7.18.0 <= version < 7.18.1

**利用条件:** 目标Confluence服务器可访问

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-26134 是 Atlassian Confluence Server 和 Data Center 中的一个严重的 OGNL 注入漏洞。未经身份验证的攻击者可以通过此漏洞在受影响的 Confluence 实例上执行任意代码。

**有效性：**
根据漏洞库信息和搜索结果，该漏洞被广泛利用，且POC代码已经公开，证明其有效性。多个安全厂商（如Rapid7, Qualys, Palo Alto Networks, Darktrace, Trend Micro, Akamai, Splunk, Sysdig, Datadog）的分析和博客文章都证实了该漏洞的活跃利用。

**投毒风险：**
分析提供的POC代码，发现`confusploit.py`脚本主要功能是发送包含 OGNL 表达式的 HTTP 请求，并从响应头中提取命令执行结果。 该脚本结构清晰，没有明显的恶意代码或后门。风险主要在于使用者执行此脚本针对未授权的目标进行渗透测试，从而造成的法律风险，而非代码本身的投毒。 `requirements.txt` 文件中包含的库都是常见的安全测试工具包，没有发现可疑的第三方库。`readme.md`中提示仅用于合法的用途。

`check_vesion` 函数检查 Confluence 的版本，`send_payload` 函数通过构造 OGNL 表达式将命令注入到 URL 中，从而执行任意命令。因此脚本的主要作用是辅助漏洞利用，风险较低。

评估仓库投毒的可能性为10%，因为任何下载和使用第三方工具都存在一定的风险，虽然代码本身看似无害，但作者可能在未来版本中引入恶意代码，或者存在其他的安全风险。

**利用方式：**
1.  攻击者构造包含恶意 OGNL 表达式的 HTTP 请求。
2.  恶意表达式被 Confluence 服务器解析并执行，导致任意代码执行。
3.  攻击者可以在 Confluence 服务器上执行任意命令，例如安装恶意软件、窃取数据或控制服务器。

攻击者通过发送特制的HTTP GET请求，并在URL中包含恶意的OGNL表达式来实现远程代码执行。此表达式允许攻击者执行任意系统命令，并将结果通过HTTP响应头返回。


**项目地址:** [p4b3l1t0/confusploit](https://github.com/p4b3l1t0/confusploit)

**漏洞详情:** [CVE-2022-26134](https://nvd.nist.gov/vuln/detail/CVE-2022-26134)