## CVE-2017-5638 - Apache Struts2 S2-045

**漏洞编号:** CVE-2017-5638

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Struts2

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** 2.3.x before 2.3.32, 2.5.x before 2.5.10.1

**利用条件:** 目标系统运行受影响版本的Apache Struts2，且可从外部网络访问。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2017-5638 漏洞是 Apache Struts2 框架中的一个远程代码执行漏洞。该漏洞源于 Jakarta Multipart parser 在处理文件上传时的异常处理和错误消息生成存在缺陷，允许攻击者通过构造恶意的 Content-Type、Content-Disposition 或 Content-Length HTTP 头部来执行任意命令。

**有效性评估：**

根据漏洞库信息、搜索引擎结果以及提供的 PoC 代码，该漏洞的 PoC 代码是有效的。搜索引擎结果中多个链接表明该漏洞曾被广泛利用，并造成了严重的安全事件，如 Equifax 数据泄露事件。PoC 代码通过构造特定的 HTTP 头部，利用 OGNL 表达式注入执行系统命令，从而控制服务器。

**投毒风险评估：**

提供的 PoC 代码主要功能是利用漏洞执行命令。投毒风险评估如下：

*   **README.md:** 描述了漏洞利用方式，提供用法示例，没有发现恶意代码。
*   **cve-2017-5638.py:**  
    *   代码结构清晰，功能明确，实现了漏洞利用的核心逻辑。
    *   使用了 `requests` 库发送 HTTP 请求，符合漏洞利用的需要。
    *   OGNL 表达式的构造较为复杂，但其目的是为了绕过安全限制并执行命令。
    *   对执行命令的结果进行输出。
    *  try...except 块处理了可能的请求错误，使得程序更加健壮。
    
虽然代码功能正常，但存在以下潜在风险：

*   **命令执行权限：**  如果目标服务器以高权限运行，攻击者可以通过该漏洞获取高权限，造成更大的危害。
*   **日志记录：**  恶意利用可能被服务器日志记录，但攻击者可以尝试清除日志来隐藏踪迹。
*   **依赖风险：**  `requests` 库本身可能存在安全漏洞，间接影响该 PoC 的安全性。

综合来看，该代码主要风险在于被滥用，利用漏洞攻击目标系统，本身包含作者恶意投毒代码的可能性较低。投毒风险评估为10%。

**利用方式分析：**

1.  **构造恶意 HTTP 头部：**  攻击者通过修改 HTTP 请求的 Content-Type 头部，插入包含恶意 OGNL 表达式的字符串。
2.  **OGNL 表达式注入：**  恶意 OGNL 表达式被 Struts2 框架解析和执行，绕过安全限制，获取执行系统命令的权限。
3.  **执行任意命令：**  攻击者可以通过 OGNL 表达式执行任意系统命令，例如下载恶意文件、反弹 Shell 等。
4.  **获取服务器控制权：**  通过执行系统命令，攻击者可以获取服务器的控制权，进行恶意操作，例如数据窃取、恶意软件传播等。

**项目地址:** [jongmartinez/CVE-2017-5638](https://github.com/jongmartinez/CVE-2017-5638)

**漏洞详情:** [CVE-2017-5638](https://nvd.nist.gov/vuln/detail/CVE-2017-5638)