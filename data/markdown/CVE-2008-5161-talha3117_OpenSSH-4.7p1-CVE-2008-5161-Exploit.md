## CVE-2008-5161 OpenSSH CBC 信息泄露漏洞利用辅助脚本

**漏洞编号:** CVE-2008-5161

**漏洞类型:** 信息泄露 (辅助利用)

**影响应用:** OpenSSH

**危害等级:** 中危，可能泄露SSH会话中的部分明文数据

**影响版本:** OpenSSH 4.7p1 及可能存在的其他版本，当使用 CBC 模式的块加密算法时

**利用条件:** 目标系统运行受影响的OpenSSH版本，并使用CBC模式加密

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞(CVE-2008-5161) 本身是 OpenSSH 在 CBC 模式下加密时存在的信息泄露漏洞。提供的代码并非直接利用该漏洞，而是辅助利用。它的主要功能是：

1.  **版本检测：** 连接到目标 SSH 服务，读取 Banner 信息，判断是否为 `OpenSSH_4.7p1 Debian-8ubuntu1`。
2.  **自动化密码审计：** 如果版本匹配，则使用 Metasploit 的 `auxiliary/scanner/ssh/ssh_login` 模块进行密码爆破。

**有效性：**

该代码的有效性取决于目标系统是否满足以下条件：

*   运行 `OpenSSH_4.7p1 Debian-8ubuntu1` 或可以通过修改脚本绕过版本检测。
*   启用了 SSH 服务，并且允许密码登录 (如果禁用了密码登录，则无法爆破)。
*   存在弱口令，可以被 `ssh_login` 模块爆破出来。

**投毒风险：**

分析代码，主要关注是否存在恶意行为。

*   该脚本使用 `msfconsole` 启动 Metasploit 框架，存在一定风险。如果 Metasploit 被篡改，则可能执行恶意代码。
*   脚本会运行 `auxiliary/scanner/ssh/ssh_login` 模块，这个模块本身可能存在漏洞或被篡改。
*   脚本依赖于一个用户密码字典 `/usr/share/wordlists/metasploit/piata_ssh_userpass.txt`，如果这个字典被替换成包含恶意 payload 的文件，可能导致安全问题。默认情况下，该文件是Metasploit自带的。
*  脚本作者引入风险。因为需要启动`msfconsole`如果Metasploit被篡改,那么会存在一定风险。
*   **总体来说，投毒风险较低，主要集中在使用被篡改的 Metasploit 框架或用户密码字典上。**

**利用方式：**

1.  运行脚本，输入目标 IP 地址。
2.  脚本连接到目标 SSH 服务，检查版本信息。
3.  如果版本匹配，脚本启动 Metasploit，加载 `auxiliary/scanner/ssh/ssh_login` 模块。
4.  `ssh_login` 模块使用用户密码字典对目标 SSH 服务进行爆破。
5.  如果爆破成功，则获得 SSH 登录凭据，可以登录目标系统。
6. CVE-2008-5161 漏洞本身并未直接利用，该脚本只是使用已知的弱口令攻击来尝试进行自动化入侵。
7. 该脚本的真正目的是自动化密码破解，而不是直接利用 CVE-2008-5161 漏洞。

**项目地址:** [talha3117/OpenSSH-4.7p1-CVE-2008-5161-Exploit](https://github.com/talha3117/OpenSSH-4.7p1-CVE-2008-5161-Exploit)

**漏洞详情:** [CVE-2008-5161](https://nvd.nist.gov/vuln/detail/CVE-2008-5161)