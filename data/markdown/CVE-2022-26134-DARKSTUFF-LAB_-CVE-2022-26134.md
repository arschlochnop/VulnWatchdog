## CVE-2022-26134 - Atlassian Confluence OGNL 注入远程代码执行

**漏洞编号:** CVE-2022-26134

**漏洞类型:** OGNL 注入

**影响应用:** Atlassian Confluence Server 和 Data Center

**危害等级:** 高危，允许未经身份验证的攻击者执行任意代码。

**影响版本:** 1.3.0 到 7.4.17, 7.13.0 到 7.13.7, 7.14.0 到 7.14.3, 7.15.0 到 7.15.2, 7.16.0 到 7.16.4, 7.17.0 到 7.17.4, 以及 7.18.0 到 7.18.1 之前的版本

**利用条件:** 目标 Confluence 实例需要存在于可访问的网络中，且未打补丁。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-26134 是一个存在于 Atlassian Confluence Server 和 Data Center 的 OGNL 注入漏洞。未经身份验证的攻击者可以利用此漏洞在受影响的 Confluence 实例上执行任意代码。

**有效性：**

根据漏洞库信息、搜索引擎结果和提供的漏洞利用代码，此漏洞的POC代码是有效的。搜索结果表明该漏洞已被积极利用，并且存在公开可用的利用代码。

**投毒风险：**

检查提供的 `exploit.py` 代码，发现以下可疑点：
1. 代码使用了 `requests` 库发送 HTTP 请求，并禁用了 SSL 证书验证 (`urllib3.disable_warnings()` 和 `verify=False`)。 这可能导致中间人攻击的风险，攻击者可以拦截和修改请求，从而执行恶意代码。
2. 代码从目标服务器的响应头 `X-Cmd-Response` 中获取命令执行结果。虽然这本身不是投毒，但依赖响应头可能存在被篡改的风险，也为投毒提供了可乘之机，例如恶意服务器伪造响应头。
3. 代码使用了 `multiprocessing` 库，可能存在进程间通信的问题，增加了复杂性，也可能为恶意代码提供隐藏点。
4. 代码中包含从 URL 中获取参数后未经过严格校验就执行，存在一定的安全风险，允许用户自定义请求头，增加了一些安全隐患。

总体而言，代码本身没有明显的恶意行为，但是代码质量不高，存在一定的安全隐患，有被利用进行投毒的潜在风险，因此判断为存在10% 的投毒风险。

**利用方式：**

1.  **漏洞原理：**  该漏洞源于 Confluence 中 OGNL 表达式处理不当，允许攻击者在请求中注入恶意 OGNL 代码。
2.  **攻击步骤：**
    *   攻击者构造包含恶意 OGNL 表达式的 HTTP 请求。此表达式可以执行任意命令。
    *   受影响的 Confluence 实例解析并执行 OGNL 表达式。
    *   服务器执行攻击者指定的命令，并将结果通过 `X-Cmd-Response` 响应头返回。
3.  **POC 利用：**  提供的 `exploit.py` 脚本通过构造包含 OGNL 表达式的 URL 来利用此漏洞。脚本将命令注入到 URL 中，发送请求，然后从响应头中提取命令执行的结果。

**项目地址:** [DARKSTUFF-LAB/-CVE-2022-26134](https://github.com/DARKSTUFF-LAB/-CVE-2022-26134)

**漏洞详情:** [CVE-2022-26134](https://nvd.nist.gov/vuln/detail/CVE-2022-26134)