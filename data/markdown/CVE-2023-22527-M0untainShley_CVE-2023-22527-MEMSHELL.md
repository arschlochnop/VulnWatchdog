## CVE-2023-22527-Confluence-远程代码执行

**漏洞编号:** CVE-2023-22527

**漏洞类型:** 远程代码执行

**影响应用:** Atlassian Confluence Data Center 和 Server

**危害等级:** 高危，未经身份验证的远程代码执行

**影响版本:** 8.0.0 <= version < 8.5.4

**利用条件:** 目标Confluence实例版本在受影响范围内，且网络可达。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-22527是Atlassian Confluence Data Center和Server中的一个模板注入漏洞。未经身份验证的攻击者可以通过构造恶意的OGNL表达式，利用Velocity模板注入，在目标服务器上执行任意代码。

**漏洞利用方式：**

1.  攻击者构造包含恶意OGNL表达式的HTTP请求，发送到Confluence服务器的`/template/aui/text-inline.vm`端点或其他Velocity模板渲染的端点。
2.  Confluence服务器在渲染Velocity模板时，会执行OGNL表达式，从而导致远程代码执行。
3.  根据提供的漏洞利用代码，POC利用了javassist动态生成内存马，支持注入冰蝎和哥斯拉两种类型的webshell。

**有效性：**

根据漏洞库信息和搜索引擎结果，该漏洞已被积极利用，存在公开的POC。提供的POC代码功能较为完整，支持多种webshell注入，并提供HTTP代理功能，因此判断该POC有效。

**投毒风险：**

代码总体结构清晰，主要功能集中在内存马注入。但是，仍存在一些潜在的投毒风险：

1.  **恶意依赖：** 虽然代码中使用了javassist和commons-cli，但攻击者可能通过修改pom.xml或手动添加恶意依赖，引入包含后门的第三方库。
2.  **后门代码：** 攻击者可能在生成payload的过程中插入恶意代码，例如在`ctClass.makeClassInitializer().insertBefore`插入额外的指令，执行恶意操作。
3.  **代理劫持：**  虽然POC支持代理，但攻击者可以通过控制代理服务器，在流量中注入恶意代码。

考虑到代码的复杂性，且存在动态生成类的行为，隐藏恶意代码的概率较高。因此，判断存在10%的投毒风险。

**总结：**

CVE-2023-22527是一个严重的安全漏洞，利用难度低，危害性高。建议Confluence用户尽快升级到安全版本，并对POC代码进行仔细审查，确保其安全性。

**项目地址:** [M0untainShley/CVE-2023-22527-MEMSHELL](https://github.com/M0untainShley/CVE-2023-22527-MEMSHELL)

**漏洞详情:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)