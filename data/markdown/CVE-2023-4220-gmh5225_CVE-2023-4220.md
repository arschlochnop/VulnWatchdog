## CVE-2023-4220 - Chamilo LMS 未授权文件上传导致远程代码执行

**漏洞编号:** CVE-2023-4220

**漏洞类型:** 未授权文件上传

**影响应用:** Chamilo LMS

**危害等级:** 高危，未经身份验证的攻击者可以上传WebShell，最终导致远程代码执行

**影响版本:** <= 1.11.24

**利用条件:** 目标系统运行着Chamilo LMS <= 1.11.24，且攻击者可以访问该系统的网络端口

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-4220 存在于Chamilo LMS的 `/main/inc/lib/javascript/bigupload/inc/bigUpload.php` 文件中。该文件存在未授权的文件上传漏洞，允许未经身份验证的攻击者上传任意文件，包括WebShell。 

**利用方式：**

1.  攻击者通过发送POST请求到`/main/inc/lib/javascript/bigupload/inc/bigUpload.php?action=post-unsupported`，上传一个包含恶意代码的PHP文件（WebShell），文件名可以为任意值。
2.  上传的文件会被保存在 `/main/inc/lib/javascript/bigupload/files/` 目录下。
3.  攻击者通过访问 `/main/inc/lib/javascript/bigupload/files/{webshell_name}.php` 执行上传的WebShell，从而实现远程代码执行。

提供的POC代码（exploit.py）自动化了这一过程，首先检查目标是否存在漏洞，然后上传一个简单的WebShell (insomnia.php)，允许攻击者执行任意命令。 

**有效性：**

根据漏洞库信息、搜索引擎结果和漏洞利用代码，该POC代码是有效的，可以成功利用该漏洞实现远程代码执行。 搜索结果中的pentest-tools.com的描述和github上的POC都确认了漏洞的存在和利用方式。

**投毒风险：**

查看了POC代码，该代码主要功能是上传webshell，并无发现恶意投毒代码，代码有域名作者信息。但是仍然需要谨慎，因为上传的WebShell本身就是恶意代码，攻击者可以通过WebShell执行任何操作。我假设存在5%的风险, 代码库维护者或者代码贡献者在未来可能会添加一些恶意代码。

**项目地址:** [gmh5225/CVE-2023-4220](https://github.com/gmh5225/CVE-2023-4220)

**漏洞详情:** [CVE-2023-4220](https://nvd.nist.gov/vuln/detail/CVE-2023-4220)