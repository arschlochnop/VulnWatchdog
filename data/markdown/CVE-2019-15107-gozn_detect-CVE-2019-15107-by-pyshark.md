## CVE-2019-15107-Webmin-命令注入

**漏洞编号:** CVE-2019-15107

**漏洞类型:** 命令注入

**影响应用:** Webmin

**危害等级:** 高危，可导致远程代码执行

**影响版本:** <= 1.920

**利用条件:** Webmin版本小于等于1.920，且开启了允许用户更改密码的功能 (passwd_mode = 2 in miniserv.conf),受害者开启了“Prompt users with expired password to enter a new one”设置

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-15107 是 Webmin <=1.920 版本中 password_change.cgi 文件存在的一个命令注入漏洞。攻击者可以通过在 `old` 参数中注入恶意命令，从而执行任意系统命令。 

**利用方式:**

1.  **漏洞定位:** 漏洞存在于 password_change.cgi 文件，该文件用于处理用户密码更改。
2.  **漏洞触发:** 当 Webmin 配置允许用户更改密码时，攻击者可以通过构造包含恶意命令的 HTTP POST 请求，发送到 password_change.cgi 接口。
3.  **payload构造:** 在POST请求的old参数中，使用管道符 `|` 连接原始密码和要执行的命令。例如：`old=test|恶意命令`
4.  **命令执行:** Webmin 在处理密码更改请求时，会将 `old` 参数的值传递给系统命令，导致恶意命令被执行。
5.  **获取权限：** 可以使用 Metasploit 生成反向 shell 的 payload，然后将其嵌入到 `old` 参数中，从而获取目标系统的 shell 权限。

**有效性:**

根据漏洞库信息、搜索引擎结果和提供的漏洞利用代码，可以确认此漏洞是有效的。漏洞利用代码详细描述了利用步骤，并提供了示例，证明了攻击者可以利用此漏洞执行任意命令。

**投毒风险:**

提供的漏洞利用代码主要是一个README文件，描述了漏洞原理和利用步骤。虽然没有直接发现恶意代码，但是有以下几点需要注意：

*   **代码片段依赖：** 文档描述了使用 Burp Suite 和 Metasploit 进行漏洞利用，这些工具本身可能存在安全风险，如果从不可信的来源下载，可能被植入恶意代码。
*   **反向shell：** 利用过程中使用反向 shell，攻击者可以完全控制受害者系统。
*   **Payload来源：** 文档没有说明 Metasploit payload 的来源，如果 payload 是从不可信的来源获取，则可能包含恶意代码。
*   **图片托管风险:** 文档中图片托管在Github,可能会被替换。

综合以上因素，考虑到POC代码主要是利用流程描述，且需要结合其他工具使用，因此判定投毒风险为10%。

**项目地址:** [gozn/detect-CVE-2019-15107-by-pyshark](https://github.com/gozn/detect-CVE-2019-15107-by-pyshark)

**漏洞详情:** [CVE-2019-15107](https://nvd.nist.gov/vuln/detail/CVE-2019-15107)