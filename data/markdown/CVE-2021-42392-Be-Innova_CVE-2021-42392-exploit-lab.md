## CVE-2021-42392-H2数据库-JNDI注入/远程代码执行

**漏洞编号:** CVE-2021-42392

**漏洞类型:** JNDI注入/远程代码执行

**影响应用:** H2 Database

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** < 2.0.206

**利用条件:** H2数据库暴露在TCP端口(默认9092)或启用Web Console，并且允许远程访问。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-42392 漏洞是 H2 数据库中一个严重的 JNDI 注入漏洞，允许未经身份验证的攻击者通过构造特定的 JDBC URL 利用 `CREATE ALIAS` 功能执行任意代码。攻击者可以指定一个恶意的 JNDI 驱动程序和指向 LDAP 或 RMI 服务器的 URL，从而在目标系统上执行代码。该漏洞类似于 Log4Shell，但影响的是 H2 数据库。

**利用方式：**

1.  攻击者需要能够通过 TCP 端口（默认 9092）或 Web Console 访问到存在漏洞的 H2 数据库实例。
2.  攻击者构造一个包含恶意 JNDI URL 的 JDBC 连接字符串。这个URL会指向攻击者控制的LDAP或RMI服务器。
3.  利用 `CREATE ALIAS` SQL 命令，创建一个指向攻击者控制的 JNDI 资源的别名。
4.  当 H2 数据库尝试加载和执行该别名时，它会从攻击者的 JNDI 服务器加载恶意代码并执行。

**有效性：**

根据漏洞描述和提供的 PoC 代码，该漏洞的利用是有效的。PoC 代码提供了一个可以直接利用 TCP 端口的 Python 脚本，通过 `CREATE ALIAS` 执行命令。

**投毒风险：**

虽然PoC的主要功能是利用漏洞，但仍然存在一定的投毒风险，主要体现在以下几个方面：

1.  **依赖项：**  PoC 依赖于 `jaydebeapi` 和 `JPype1` 库，如果这些库被恶意篡改，可能会引入恶意代码。  需要确保从可信的源安装这些依赖项。
2.  **JAR 文件：**  PoC 使用 H2 数据库的 JAR 文件。  虽然PoC本身指定了2.0.202版本，作者可能在构建环境时替换成包含后门的JAR文件。但可能性较小。
3.  **自定义 JNDI 服务器：**  漏洞利用需要设置一个 JNDI 服务器来提供恶意代码。 攻击者可能会诱导用户使用包含恶意代码的 JNDI 服务器，或者在 JNDI 服务器上执行恶意操作。
4. **不常见的JVM启动参数**: PoC中可能存在不常见的JVM启动参数，这些参数可能会影响JVM的安全性。

总体来说，投毒的风险相对较低（大约10%），主要集中在依赖项和对 JNDI 服务器的控制上。需要仔细审查代码和配置，确保使用的依赖项和 JNDI 服务器是可信的。


**项目地址:** [Be-Innova/CVE-2021-42392-exploit-lab](https://github.com/Be-Innova/CVE-2021-42392-exploit-lab)

**漏洞详情:** [CVE-2021-42392](https://nvd.nist.gov/vuln/detail/CVE-2021-42392)