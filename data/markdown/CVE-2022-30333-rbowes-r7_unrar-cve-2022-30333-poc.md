## CVE-2022-30333-UnRAR目录遍历

**漏洞编号:** CVE-2022-30333

**漏洞类型:** 目录遍历

**影响应用:** UnRAR (Linux/UNIX)

**危害等级:** 高危，可覆盖任意文件，可能导致RCE

**影响版本:** < 6.12

**利用条件:** 需要目标系统安装受影响的UnRAR版本，且允许解压RAR文件

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-30333是UnRAR在Linux和UNIX系统上的一个目录遍历漏洞。该漏洞允许攻击者在解压RAR文件时，通过构造恶意的文件名，将文件写入到文件系统的任意位置。根据漏洞库信息和搜索结果，攻击者可以利用该漏洞创建`~/.ssh/authorized_keys`文件或者在Web服务器的Web目录写入后门文件，从而实现远程代码执行。

**有效性评估：**
根据提供的POC代码和搜索结果，该POC代码是有效的。POC代码通过创建一个恶意的RAR文件，其中包含一个指向目标位置的符号链接和一个包含实际数据的文件。当UnRAR解压这个RAR文件时，会首先创建符号链接，然后将数据写入符号链接指向的位置，从而实现任意文件写入。

**投毒风险评估：**
POC代码本身的主要功能是生成恶意RAR文件以利用目录遍历漏洞，没有明显的恶意或后门代码，风险相对较低。`cve-2022-30333.rb`脚本通过ruby实现生成恶意rar压缩包，该压缩包在解压时会将指定文件写入指定目录，其中`PAYLOAD_SYMLINK`变量是写入文件的目标地址，`PAYLOAD_DATA`变量是要写入的内容。恶意行为依赖于使用者提供的目标文件路径和payload，本身不会主动产生恶意行为。仓库中提供的README.md文件也只是使用msfvenom生成后门，并使用ruby脚本生成恶意的rar文件，没有隐藏投毒代码。因此,投毒风险较低，估计为5%。

**利用方式分析：**
1.  **构造恶意RAR文件：**  使用POC代码（`cve-2022-30333.rb`）生成一个包含恶意符号链接的RAR文件。符号链接指向目标系统上的任意文件路径，攻击者希望覆盖该文件。
2.  **目标文件覆盖：**  当受害者使用存在漏洞的UnRAR版本解压该RAR文件时，UnRAR会跟随符号链接，将RAR文件中包含的数据写入到符号链接指向的目标文件，从而实现任意文件覆盖。
3.  **权限提升或远程代码执行：**  攻击者可以通过覆盖系统关键文件（如`~/.ssh/authorized_keys`）来实现权限提升，或者通过覆盖Web服务器的Web目录中的文件（如JSP文件）来执行任意代码。


**项目地址:** [rbowes-r7/unrar-cve-2022-30333-poc](https://github.com/rbowes-r7/unrar-cve-2022-30333-poc)

**漏洞详情:** [CVE-2022-30333](https://nvd.nist.gov/vuln/detail/CVE-2022-30333)