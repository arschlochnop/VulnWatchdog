## CVE-2022-26134-Confluence-OGNL注入远程代码执行

**漏洞编号:** CVE-2022-26134

**漏洞类型:** 远程代码执行

**影响应用:** Atlassian Confluence Server/Data Center

**危害等级:** 高危，未经身份验证的远程代码执行

**影响版本:** 1.3.0 < version < 7.4.17, 7.13.0 < version < 7.13.7, 7.14.0 < version < 7.14.3, 7.15.0 < version < 7.15.2, 7.16.0 < version < 7.16.4, 7.17.0 < version < 7.17.4, 7.18.0 < version < 7.18.1

**利用条件:** 目标Confluence实例在受影响版本范围内，且攻击者能够通过网络访问Confluence服务。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-26134 是 Atlassian Confluence Server 和 Data Center 中的一个 OGNL 注入漏洞。未经身份验证的攻击者可以利用此漏洞在受影响的系统上执行任意代码。

**有效性：**
根据漏洞库信息、搜索引擎结果（Rapid7, Qualys, NVD, Unit 42, Darktrace, Trend Micro, Akamai, Splunk, Datadoghq 等安全厂商均有报告）以及提供的 PoC 代码，该漏洞的有效性极高，且在野利用情况广泛。

**投毒风险：**
PoC代码主要功能是验证漏洞是否存在，即通过 OGNL 注入执行 `id` 命令，并将结果通过 HTTP 响应头返回。虽然 PoC 执行了系统命令，但这属于漏洞验证的正常行为，PoC 主要作用是漏洞验证和利用，本身不算是恶意投毒代码。但是`README.md`中提到的安装方式`pip3 install -r requirements.txt`,可能存在投毒的风险,通过分析给出的代码,投毒的概率大约是10%,代码本身没有发现明显的恶意行为。

**利用方式：**
利用方式是通过构造包含恶意 OGNL 表达式的 URL，发送到存在漏洞的 Confluence Server 或 Data Center 实例。PoC 代码中的 URL 构造方式为：`self.url.strip() + "/%24%7B%28%23a%3D%40org.apache.commons.io.IOUtils%40toString%28%40java.lang.Runtime%40getRuntime%28%29.exec%28%22id%22%29.getInputStream%28%29%2C%22utf-8%22%29%29.%28%40com.opensymphony.webwork.ServletActionContext%40getResponse%28%29.setHeader%28%22X-Cmd-Response%22%2C%23a%29%29%7D/"`。该 URL 包含一个 OGNL 表达式，该表达式执行 `id` 命令，并将输出写入 HTTP 响应头 `X-Cmd-Response`。攻击者可以将 `id` 命令替换为其他命令，从而在目标系统上执行任意代码。由于漏洞未经身份验证，攻击者无需任何凭据即可利用此漏洞。

**项目地址:** [kelemaoya/CVE-2022-26134](https://github.com/kelemaoya/CVE-2022-26134)

**漏洞详情:** [CVE-2022-26134](https://nvd.nist.gov/vuln/detail/CVE-2022-26134)