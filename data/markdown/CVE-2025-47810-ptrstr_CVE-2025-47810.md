## CVE-2025-47810 - PunkBuster LPE

**漏洞编号:** CVE-2025-47810

**漏洞类型:** 本地权限提升 (LPE)

**影响应用:** PunkBuster

**危害等级:** 高危，允许低权限用户提升至SYSTEM权限

**影响版本:** 受影响版本未知，需根据PunkBuster版本和具体代码逻辑判断

**利用条件:** 需要在目标系统上安装了PunkBuster，且攻击者具有本地访问权限。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2025-47810 是 PunkBuster 服务中的一个 TOCTOU（Time-of-Check Time-of-Use）漏洞，允许本地用户提升权限至 `NT AUTHORITY\SYSTEM`。攻击者可以利用 `PnkBstrA` 服务的 load handler (`l`) 中的漏洞，在验证证书后，替换 `PnkBstrB.exe` 文件，从而执行任意代码。

**有效性：**
根据提供的POC代码，漏洞利用的有效性较高。POC 代码详细描述了漏洞原理、触发点，并提供了关键代码片段。通过替换经过证书验证的 `PnkBstrB.exe` 文件，攻击者可以执行恶意代码，从而提升权限。

**投毒风险：**
此仓库的投毒风险较低。分析了POC代码和仓库中的文件，没有发现明显的恶意代码。虽然不能完全排除作者隐藏的投毒代码的可能性，但就目前可见信息来看，风险较低。

*   `README.md`: 包含了漏洞的详细信息和利用说明，用于解释漏洞的原理和利用方式。
*   `media/screenshot.png`: 一个截图文件，可能用于展示漏洞利用的效果。

潜在的投毒风险可能存在于以下方面：

*   **隐藏Payload：**  恶意Payload 可以隐藏在看似无害的区域中，但由于未提供实际可执行 Payload，无法确认其性质。
*   **漏洞误导：**  通过对漏洞描述进行细微修改，诱导研究人员在不安全的环境中尝试利用，从而暴露个人信息或系统。


**利用方式：**
1.  `PnkBstrA` 服务监听本地 UDP 端口（44301-44400）。
2.  攻击者发送包含 `l` 命令的 UDP 数据包到该端口，并附带一个恶意 `PnkBstrB.exe` 文件的路径。
3.  `PnkBstrA` 服务首先删除现有的 `PnkBstrB` 服务。
4.  服务计算指定文件的 MD5 值，然后验证该文件的 Authenticode 证书，确保证书主题为 `Even Balance, Inc.`。
5.  在证书验证通过后，服务休眠一段时间（750ms - 2.25s）。
6.  **漏洞触发点：** 在休眠期间，攻击者替换掉之前验证过的 `PnkBstrB.exe` 文件。
7.  服务将替换后的恶意 `PnkBstrB.exe` 文件复制到系统目录（`C:\Windows\SysWOW64\PnkBstrB.exe` 或 `C:\Windows\System32\PnkBstrB.exe`）。
8.  服务再次计算系统目录中 `PnkBstrB.exe` 的 MD5 值，并与之前的 MD5 值进行比较。
9.  如果 MD5 值匹配，服务创建并启动 `PnkBstrB` 服务，以 `LocalSystem` 权限运行。

由于存在 TOCTOU 漏洞，攻击者可以在证书验证后、文件复制前替换 `PnkBstrB.exe`，从而执行任意代码并提升权限。

**项目地址:** [ptrstr/CVE-2025-47810](https://github.com/ptrstr/CVE-2025-47810)

**漏洞详情:** [CVE-2025-47810](https://nvd.nist.gov/vuln/detail/CVE-2025-47810)