## CVE-2017-5638-Apache Struts RCE

**漏洞编号:** CVE-2017-5638

**漏洞类型:** 远程代码执行

**影响应用:** Apache Struts

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** 2.3.x before 2.3.32, 2.5.x before 2.5.10.1

**利用条件:** 目标系统运行存在漏洞的Apache Struts版本，且可通过HTTP访问。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2017-5638是Apache Struts 2中的一个远程代码执行漏洞。该漏洞源于Jakarta Multipart parser在处理文件上传时的异常处理不当。攻击者可以通过构造恶意的Content-Type, Content-Disposition, 或 Content-Length HTTP 头，在服务器上执行任意代码。

**有效性：**

根据漏洞库信息和搜索结果，CVE-2017-5638是一个被广泛利用的漏洞。存在公开可用的PoC代码，并且Metasploit框架中也存在利用模块，因此该漏洞的利用有效性很高。

提供的Dockerfile和Jenkinsfile用于构建和部署一个Struts2应用，但本身不包含漏洞利用代码。而是提供了一个包含漏洞的Struts2环境，方便演示和复现。

**投毒风险：**

虽然提供的Dockerfile和Jenkinsfile本身不包含明显的恶意代码，但存在一定的投毒风险：

*   **依赖风险：** Dockerfile中使用了`tomcat:7`镜像，存在该镜像可能包含已知漏洞的风险。Jenkinsfile中maven deploy可能会将构建的组件上传到外部maven仓库，若该仓库被入侵，则存在组件投毒的风险
*   **间接投毒：** Dockerfile中的`COPY target/struts2-rest-showcase.war /usr/local/tomcat/webapps/ROOT.war`，如果`struts2-rest-showcase.war`本身被替换为包含恶意代码的版本，则可能造成投毒。Jenkinsfile拉取的scm如果被恶意人员修改，则存在投毒风险。
*   **Jenkinsfile风险:** Jenkinsfile 中的`postGitHub` 函数，使用了github api token，若该token泄露，则可能导致项目代码被篡改。

综合评估，投毒风险大约为10%，主要来自于依赖风险和构建过程中的潜在恶意代码注入。

**利用方式：**

利用CVE-2017-5638漏洞的典型方式如下：

1.  **构造恶意HTTP请求：**  攻击者构造包含恶意Ognl表达式的Content-Type头部的HTTP请求。
2.  **发送请求：**  将构造好的HTTP请求发送到存在漏洞的Struts2服务器。
3.  **远程代码执行：**  Struts2服务器解析Content-Type头部时，会执行其中的恶意Ognl表达式，从而导致远程代码执行。

攻击者可以通过远程代码执行在服务器上执行任意命令，例如反弹shell、读取敏感文件、修改系统配置等。

一些公开的PoC利用了`#cmd=`字符串来执行系统命令，如`Content-Type: multipart/form-data; boundary=----WebKitFormBoundary7MA4YWxkTrZu0gW; #cmd=whoami`



**项目地址:** [Iletee/struts2-rce](https://github.com/Iletee/struts2-rce)

**漏洞详情:** [CVE-2017-5638](https://nvd.nist.gov/vuln/detail/CVE-2017-5638)