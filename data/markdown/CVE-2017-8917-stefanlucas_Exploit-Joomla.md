## CVE-2017-8917-Joomla-SQL注入

**漏洞编号:** CVE-2017-8917

**漏洞类型:** SQL注入

**影响应用:** Joomla!

**危害等级:** 高危，可能导致数据泄露和远程代码执行

**影响版本:** 3.7.x before 3.7.1

**利用条件:** 目标Joomla!站点未升级至3.7.1或更高版本，且攻击者可访问该站点。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2017-8917是Joomla! 3.7.x版本（3.7.1之前）中存在的一个SQL注入漏洞。根据漏洞库信息和搜索结果，该漏洞允许未经身份验证的攻击者执行任意SQL命令。利用方式如下：

1.  **漏洞触发点：** 漏洞存在于`com_fields`组件的`fields`视图中，通过`list[fullordering]`参数传递SQL注入payload。
2.  **利用方式：** 攻击者构造恶意的SQL查询语句，并通过`list[fullordering]`参数发送到`/index.php?option=com_fields&view=fields&layout=modal`。由于Joomla!对用户输入过滤不严格，导致SQL注入。
3.  **POC代码分析：**
    *   `joomblah.py`是一个Python脚本，用于利用CVE-2017-8917漏洞。
    *   该脚本首先获取CSRF token，然后利用`UpdateXML`函数执行SQL注入。
    *   脚本可以提取数据库表名、用户名、用户密码哈希以及session信息。
    *   `extract_token(resp)`函数用于从登录页面提取CSRF token。
    *   `joomla_370_sqli(options, sess, token, sqli)`函数负责构建和发送SQL注入payload，并解析响应以提取结果。
    *   `extract_joomla_tables`、`extract_joomla_users`和`extract_joomla_sessions`函数分别用于提取表名、用户名和session信息。
4.  **投毒风险：**
    *   虽然POC代码看起来是用于漏洞利用，但仍存在轻微的投毒风险，例如：
        *   代码中可能存在后门，允许攻击者在目标系统上执行任意代码。
        *   该代码可能被修改为删除或破坏目标系统上的数据。
        *   该代码依赖于外部库，这些库可能包含恶意代码。
    *   风险评估：虽然存在风险，但是相对较低，因为代码的主要功能是SQL注入利用，并且代码结构清晰，逻辑较为简单。需要人工审计所有依赖库，确认没有恶意行为。
5.  **有效性：** POC代码可以有效利用该漏洞，提取数据库信息。

**综上所述：**  该漏洞利用代码的有效性较高。投毒风险较低，但是代码审计人员必须审计依赖库，检查恶意行为。利用方式主要是通过构造特殊的URL参数，绕过Joomla!的输入验证机制，从而执行任意SQL命令。

**项目地址:** [stefanlucas/Exploit-Joomla](https://github.com/stefanlucas/Exploit-Joomla)

**漏洞详情:** [CVE-2017-8917](https://nvd.nist.gov/vuln/detail/CVE-2017-8917)