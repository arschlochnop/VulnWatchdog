## CVE-2020-1472 (Zerologon)

**漏洞编号:** CVE-2020-1472

**漏洞类型:** 权限提升

**影响应用:** Microsoft Windows Server

**危害等级:** 高危，可导致域控被完全控制

**影响版本:** 受影响的Windows Server版本包括但不限于 2008 R2 SP1, 2012, 2012 R2, 2016, 2019, 2004, 1903, 1909, 20H2

**利用条件:** 攻击者需要位于与域控制器相同的网络中

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2020-1472 (Zerologon) 漏洞存在于 Netlogon 远程协议 (MS-NRPC) 的加密实现中。攻击者可以通过将域控制器的计算机密码设置为全零，从而控制域控制器。

**有效性：** 根据提供的漏洞信息、搜索结果和漏洞利用代码，该POC代码是有效的。搜索结果显示该漏洞已被广泛利用，且存在公开可用的POC代码。

**投毒风险：** 分析提供的POC代码和`README.md`文件，发现以下潜在的投毒风险：

*   `README.md` 明确指出，默认情况下，该POC会更改域控制器帐户的密码，导致域控制器之间的通信中断。虽然这本身是漏洞利用的一部分，但如果攻击者不了解此副作用并贸然使用，可能会导致严重的生产环境故障。
*   `README.md` 文件中提到需要使用特定版本的 Impacket，如果用户从不可信的来源下载 Impacket，可能存在被植入恶意代码的风险。
*   `cve-2020-1472-exploit.py` 脚本中设置了 `MAX_ATTEMPTS` 为2000，虽然这个值是用来限制尝试次数，防止无限循环，但如果恶意修改此值，可能会降低攻击的成功率。但从代码逻辑来看，这个并不是投毒代码。

综合来看，投毒风险较低，主要集中在用户对POC的误用和对第三方库的依赖上。因此，我给出的投毒风险为5%。

**利用方式：**

1.  攻击者使用`cve-2020-1472-exploit.py`脚本，通过 Netlogon 协议与域控制器建立连接。
2.  脚本利用 MS-NRPC 中的漏洞，将域控制器的计算机帐户密码设置为全零。
3.  攻击者可以使用 secretsdump.py 之类的工具，通过DCSync 协议获取域控制器的敏感信息（例如域管理员哈希）。
4.  攻击者可以使用获取到的域管理员权限控制整个域。
5.  攻击者可以选择使用 `restorepassword.py` 恢复域控制器的原始密码，以避免引起注意（但这需要提前备份原始密码）。

**项目地址:** [whoami-chmod777/Zerologon-Attack-CVE-2020-1472-POC](https://github.com/whoami-chmod777/Zerologon-Attack-CVE-2020-1472-POC)

**漏洞详情:** [CVE-2020-1472](https://nvd.nist.gov/vuln/detail/CVE-2020-1472)