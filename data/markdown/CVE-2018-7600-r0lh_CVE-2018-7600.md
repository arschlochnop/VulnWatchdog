## CVE-2018-7600-Drupal-远程代码执行

**漏洞编号:** CVE-2018-7600

**漏洞类型:** 远程代码执行

**影响应用:** Drupal

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** Drupal before 7.58, 8.x before 8.3.9, 8.4.x before 8.4.6, and 8.5.x before 8.5.1

**利用条件:** Drupal网站存在漏洞且允许未授权用户访问

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2018-7600，又名Drupalgeddon2，是一个存在于Drupal核心中的远程代码执行漏洞。攻击者可以通过构造恶意请求，利用Drupal的多个子系统（默认或常见模块配置）中的缺陷，在服务器上执行任意代码。 

**有效性分析：**

根据漏洞库信息和搜索结果，此漏洞是真实存在的，并且影响了多个Drupal版本。漏洞利用代码（PoC）的存在进一步证实了漏洞的可利用性。PoC代码的分析表明，它通过构造一个特殊的请求到`/user/register`路径，利用`element_parents`参数中的注入点执行命令。该PoC代码使用`drupal_ajax`的`_wrapper_format`，允许绕过一些安全检查。PoC首先设置目标URL，然后进入一个循环，该循环允许用户输入命令。命令通过`bash -c`执行，并将输出写入`poutput.txt`文件，然后读取此文件以显示命令的执行结果。

**投毒风险分析：**

分析提供的Go代码和相关文件，没有发现明显的投毒代码。该代码的主要功能是利用CVE-2018-7600漏洞在目标Drupal服务器上执行命令。代码使用`net/http`库发送HTTP请求，并使用`golang.org/x/net/proxy`库支持SOCKS5代理。代码从标准输入读取命令，并通过POST请求将其发送到目标服务器。然后，代码从服务器读取命令的输出并将其打印到标准输出。虽然该代码本身不包含恶意行为，但漏洞利用本身可能被滥用。

**利用方式总结：**

1.  **漏洞入口点：** `/user/register?element_parents=account/mail/%23value&ajax_form=1&_wrapper_format=drupal_ajax`
2.  **攻击方式：** 通过POST请求，利用`mail[#post_render][]`、`mail[#type]`和`mail[#markup]`参数注入恶意代码。
3.  **命令执行：**  `mail[#markup]`参数中包含要执行的bash命令，利用`bash -c`执行。
4.  **结果获取：** 命令执行结果被写入`poutput.txt`文件，然后通过GET请求获取。
5.  **利用流程：**
    *   构造包含恶意代码的POST请求发送到漏洞入口点。
    *   Drupal解析请求并执行`mail[#markup]`参数中的命令。
    *   执行结果写入`poutput.txt`文件。
    *   攻击者通过GET请求读取`poutput.txt`文件获取命令执行结果。

**缓解措施：**

*   尽快将Drupal升级到不受影响的版本（7.58及以上，8.3.9及以上，8.4.6及以上，或8.5.1及以上）。
*   应用官方提供的补丁。
*   实施Web应用防火墙（WAF）规则来检测和阻止利用此漏洞的攻击。

**项目地址:** [r0lh/CVE-2018-7600](https://github.com/r0lh/CVE-2018-7600)

**漏洞详情:** [CVE-2018-7600](https://nvd.nist.gov/vuln/detail/CVE-2018-7600)