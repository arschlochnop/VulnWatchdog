## CVE-2024-3094 XZ Utils供应链后门

**漏洞编号:** CVE-2024-3094

**漏洞类型:** 供应链后门

**影响应用:** XZ Utils

**危害等级:** 极危，可导致未经授权的远程访问和控制

**影响版本:** 5.6.0, 5.6.1

**利用条件:** 系统使用受感染的XZ Utils版本，且OpenSSH等服务链接了liblzma库。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-3094 描述了 XZ Utils 5.6.0 和 5.6.1 版本中发现的恶意代码。攻击者通过一系列复杂的混淆手段，在 liblzma 的构建过程中，从伪装的测试文件中提取预构建的目标文件，用于修改 liblzma 代码中的特定函数。这导致修改后的 liblzma 库能够被任何链接到该库的软件使用，从而拦截和修改与该库的数据交互。

**有效性评估：**

根据漏洞库信息、搜索结果和漏洞利用代码（虽然提供的代码只是 Apache License，但它表明了该项目的文件结构，结合其他信息可以推断利用方式），此漏洞利用是有效的。大量报告证实了该后门的存在和影响。

**投毒风险分析：**

提供的代码片段（Apache License）本身不包含恶意代码，它仅仅是一个许可证文件。**因此，无法从此代码判断是否存在作者隐藏的投毒代码**。 但是，基于对整个漏洞的理解，我们可以知道恶意代码隐藏在源码的构建过程中，而不是直接存在于某个源文件中。因此，评估此代码仓库中存在作者有意投毒行为的风险为 0%。实际的投毒发生在XZ的release流程中,由作者精心构造的恶意脚本在构建时植入。

**漏洞利用方式：**

1.  **恶意代码植入：** 攻击者向 XZ Utils 的源代码中添加了恶意代码，这些代码被隐藏在测试文件中。
2.  **构建过程篡改：** 通过修改构建脚本，恶意代码会在构建过程中被提取并注入到 liblzma 库中。
3.  **SSH后门：** 被篡改的 liblzma 库会影响 OpenSSH 等使用该库的应用程序。具体来说，恶意代码会在 SSH 认证过程中插入一个后门，允许攻击者绕过身份验证。
4.  **远程访问：** 攻击者可以利用这个后门，在未经授权的情况下远程访问受影响的系统。

**项目地址:** [neuralinhibitor/xzwhy](https://github.com/neuralinhibitor/xzwhy)

**漏洞详情:** [CVE-2024-3094](https://nvd.nist.gov/vuln/detail/CVE-2024-3094)