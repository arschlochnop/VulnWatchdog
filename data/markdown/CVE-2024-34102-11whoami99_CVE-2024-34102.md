## CVE-2024-34102-Adobe Commerce XXE

**漏洞编号:** CVE-2024-34102

**漏洞类型:** XML外部实体注入 (XXE)

**影响应用:** Adobe Commerce (Magento)

**危害等级:** 高危，可能导致任意代码执行，敏感信息泄露

**影响版本:** <= 2.4.7, 2.4.6-p5, 2.4.5-p7, 2.4.4-p8

**利用条件:** 需要网络访问，无需用户交互

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-34102是Adobe Commerce中一个未经身份验证的XXE漏洞。根据漏洞库信息和搜索引擎结果，攻击者可以通过发送精心构造的XML文档，其中包含对外部实体的引用，来利用此漏洞。漏洞利用代码中的`POST /rest/V1/guest-carts/1/estimate-shipping-methods`请求，通过修改`address`中的`totalsCollector`和`sourceData`，使得Magento尝试从攻击者控制的URL加载数据，从而触发XXE。

**有效性：**
提供的POC代码有效，因为它利用了Adobe Commerce中存在XXE漏洞的端点。虽然提供的两个文件，一个是POST请求数据,一个是xml文件，但是从描述来看，应该重点关注第一个POST请求，通过第一个POST请求将`data`指向恶意的`xml`文件，从而触发XXE。

**投毒风险：**
从提供的漏洞利用代码来看，主要包含一个README文件，一个POST请求示例，以及一个xxe.xml文件。xxe.xml 文件仅仅是读取了`/etc/passwd`文件。POST 请求中`http://YOUR-webhook`如果被替换成恶意地址,可能会存在风险，但是并不能算作仓库作者投毒, 因此推断仓库中不存在作者隐藏的投毒代码。

**利用方式：**
1.  **构造恶意XML:**  攻击者创建一个包含外部实体声明的XML文档，该实体指向攻击者控制的URL或者本地文件。在给定的例子中，`xxe.xml`文件尝试读取`/etc/passwd`。
2.  **发送恶意请求:** 攻击者构造一个HTTP POST请求到`/rest/V1/guest-carts/1/estimate-shipping-methods`，并在请求体中包含恶意的XML数据。`address.totalsCollector.collectorList.totalCollector.sourceData.data`字段的值被设置为攻击者控制的URL，Magento会尝试解析该URL返回的数据，从而触发XXE漏洞。
3.  **信息泄露/代码执行:** 如果成功利用XXE漏洞，攻击者可以读取服务器上的敏感文件（如`/etc/passwd`）或执行任意代码。

总的来说，该漏洞的利用相对简单，且危害严重，无需用户交互即可触发，因此需要及时修补。

**项目地址:** [11whoami99/CVE-2024-34102](https://github.com/11whoami99/CVE-2024-34102)

**漏洞详情:** [CVE-2024-34102](https://nvd.nist.gov/vuln/detail/CVE-2024-34102)