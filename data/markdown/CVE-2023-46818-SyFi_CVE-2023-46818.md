## CVE-2023-46818-ISPConfig-PHP代码注入

**漏洞编号:** CVE-2023-46818

**漏洞类型:** PHP代码注入

**影响应用:** ISPConfig

**危害等级:** 高危，可导致远程代码执行

**影响版本:** <= 3.2.11

**利用条件:** 需要管理员权限，且admin_allow_langedit 必须启用

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-46818 漏洞存在于 ISPConfig 3.2.11p1 之前的版本中。当 `admin_allow_langedit` 启用时，具有管理员权限的用户可以通过语言文件编辑器注入 PHP 代码，从而导致远程代码执行。

**利用方式：**

1.  **身份验证：** 首先，攻击者需要使用有效的管理员用户名和密码登录 ISPConfig 控制面板。
2.  **漏洞触发条件判断:** 需要`admin_allow_langedit`配置开启.
3.  **语言文件编辑：** 登录后，攻击者需要访问语言文件编辑器。
4.  **代码注入：** 在语言文件编辑器中，攻击者可以插入恶意的 PHP 代码。
5.  **代码执行：** 当 ISPConfig 执行包含恶意代码的语言文件时，攻击者注入的 PHP 代码将被执行，从而导致远程代码执行。

**POC有效性：**
提供的 Metasploit 模块利用了该漏洞，如果目标满足漏洞利用的条件（ISPConfig 版本 <= 3.2.11, 管理员权限，`admin_allow_langedit`启用），则该 POC 代码有效。

**投毒风险分析：**

通过分析提供的 POC 代码，发现其主要功能是利用漏洞进行代码注入，并创建一个反向 shell。其中存在投毒代码的可能性较低，主要是因为代码整体结构清晰，功能明确，没有发现隐藏的恶意逻辑。
`Metasploit-module/ispconfig_language_edit.rb` 代码的功能是构造恶意请求，向目标服务器发送包含 PHP 代码的payload。该payload 会执行反向连接，获取shell。虽然代码本身不包含恶意逻辑，但攻击者可以使用该模块执行任意命令，存在一定风险。但是根据代码逻辑和模块用途来判断，其目的就是为了漏洞利用，所以不能完全确定存在投毒风险。

**风险评估：**

尽管代码本身没有明显的投毒迹象，但考虑到其漏洞利用的性质，攻击者可以利用该模块进行恶意活动。因此，建议在使用该模块时，对代码进行仔细审查，并仅在授权的渗透测试环境中使用。

**投毒百分比评估：**

由于 POC 代码的主要功能是漏洞利用，没有明显的投毒行为，所以判定投毒风险较低，大约为 10%。 这个风险主要来自于使用者可能会修改payload为恶意脚本,或者作者后期更新版本,添加恶意功能。

**项目地址:** [SyFi/CVE-2023-46818](https://github.com/SyFi/CVE-2023-46818)

**漏洞详情:** [CVE-2023-46818](https://nvd.nist.gov/vuln/detail/CVE-2023-46818)