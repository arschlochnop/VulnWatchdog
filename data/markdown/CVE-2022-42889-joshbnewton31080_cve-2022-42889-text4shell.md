## CVE-2022-42889-Apache Commons Text-RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行

**影响应用:** Apache Commons Text

**危害等级:** 高危，允许远程代码执行

**影响版本:** 1.5 <= version <= 1.9

**利用条件:** 应用程序使用受影响的Apache Commons Text版本，并且允许用户控制的输入传递给StringSubstitutor.replace()方法

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2022-42889，也被称为Text4Shell，是Apache Commons Text库中的一个远程代码执行漏洞。该漏洞源于库中使用的字符串插值功能，攻击者可以通过构造包含恶意脚本的输入，例如`${script:javascript:java.lang.Runtime.getRuntime().exec('touch /tmp/foo')}`，来执行任意代码。提供的POC代码通过创建一个简单的Spring Boot应用程序，演示了如何利用该漏洞。`HelloController.java`文件中的`attack`方法使用`StringSubstitutor.createInterpolator()`创建插值器，并使用`interpolator.replace(search)`来替换用户提供的输入。如果应用程序使用Commons Text 1.5到1.9版本，并且允许用户控制的输入传递给`replace()`方法，则攻击者可以利用此漏洞执行任意代码。

**有效性：**

根据提供的漏洞库信息、搜索引擎结果和POC代码，可以判断该漏洞利用是有效的。POC代码展示了利用`script`前缀执行`touch`命令的例子。搜索引擎结果也确认了该漏洞的存在以及利用方式。

**投毒风险：**

审查提供的文件，Dockerfile文件用于构建Docker镜像，pom.xml是Maven的配置文件，用于管理项目依赖和构建过程，src/main/java包含了应用程序的源代码，src/test/java 包含了测试代码。这些文件本身不包含明显的恶意代码，因此可以判断投毒风险较低。pom.xml 中指定的 commons-text 版本是1.8， 属于漏洞版本。 Dockerfile文件也没问题。

**利用方式：**

1.  应用程序使用Apache Commons Text 1.5到1.9版本。
2.  应用程序允许用户控制的输入传递给`StringSubstitutor.replace()`方法。
3.  攻击者构造包含恶意脚本的输入，例如`${script:javascript:java.lang.Runtime.getRuntime().exec('command')}`，其中`command`是要执行的任意命令。
4.  应用程序使用`StringSubstitutor.replace()`方法替换输入，触发漏洞，执行恶意代码。

**项目地址:** [joshbnewton31080/cve-2022-42889-text4shell](https://github.com/joshbnewton31080/cve-2022-42889-text4shell)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)