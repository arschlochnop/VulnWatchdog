## CVE-2020-0688 Microsoft Exchange Server 远程代码执行漏洞

**漏洞编号:** CVE-2020-0688

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Microsoft Exchange Server

**危害等级:** 高危，可完全控制 Exchange 服务器

**影响版本:** Microsoft Exchange Server 2010 SP3 UR30, 2013 CU23, 2016 CU14/15, 2019 CU3/4

**利用条件:** 需要有效的 Exchange 用户凭据 (用户名/密码) 和目标 Exchange 服务器未打补丁。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-0688 是 Microsoft Exchange Server 中的一个远程代码执行漏洞，源于 Exchange 控制面板 (ECP) 未能正确处理内存中的对象。该漏洞允许经过身份验证的攻击者通过发送特制的请求到 Exchange 服务器执行任意代码。利用的关键在于静态密钥 `validationKey` 和 `decryptionKey` 的使用，攻击者利用这些密钥构造恶意的 ViewState 数据，将其发送到服务器，从而触发反序列化漏洞并执行恶意代码。PoC 代码 `PSForgot2kEyXCHANGE.ps1` 利用 ysoserial.net 生成恶意的 ViewState，通过 PowerShell 发送包含该 ViewState 的请求到 Exchange 服务器的 ECP 路径，从而实现远程代码执行。

**有效性:** 提供的 PoC 代码 `PSForgot2kEyXCHANGE.ps1` 看起来是有效的。它利用了 CVE-2020-0688 漏洞，通过构造恶意的 ViewState 数据来实现远程代码执行。搜索引擎结果中也有多个链接指向了关于该漏洞的利用和分析。

**投毒风险:**  `LICENSE.md` 文件是标准的 MIT 许可证，没有发现恶意代码。 `PSForgot2kEyXCHANGE.ps1` 本身是 PoC，但如果攻击者修改了 `-Command` 参数，就可以执行任意命令。PoC 主要功能是利用漏洞，而不是植入后门。但是，不排除作者在代码中加入一些隐蔽的、难以察觉的恶意代码（例如，在特定条件下执行某些操作）。考虑到作者贡献的其他安全工具的信誉，以及代码的复杂性，投毒风险评为10%。

**利用方式:**
1.  **获取用户凭据：** 攻击者需要拥有有效的 Exchange 用户名和密码。
2.  **定位目标 Exchange 服务器：** 确定未打补丁的 Exchange 服务器。
3.  **生成恶意 ViewState：** 使用 `PSForgot2kEyXCHANGE.ps1` 脚本和 ysoserial.net 工具，根据目标服务器的配置，生成包含恶意命令的 ViewState 数据。
4.  **发送恶意请求：** 将包含恶意 ViewState 的请求发送到 Exchange 服务器的 ECP 路径（例如，`/ecp/default.aspx`）。
5.  **执行任意代码：** 服务器反序列化 ViewState 数据，执行攻击者预先设定的恶意命令，从而实现远程代码执行。

**项目地址:** [justin-p/PSForgot2kEyXCHANGE](https://github.com/justin-p/PSForgot2kEyXCHANGE)

**漏洞详情:** [CVE-2020-0688](https://nvd.nist.gov/vuln/detail/CVE-2020-0688)