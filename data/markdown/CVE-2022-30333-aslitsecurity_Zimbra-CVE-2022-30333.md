## CVE-2022-30333-UnRAR目录遍历

**漏洞编号:** CVE-2022-30333

**漏洞类型:** 目录遍历

**影响应用:** UnRAR (Linux/UNIX)

**危害等级:** 高危，可能导致任意文件写入

**影响版本:** < 6.12

**利用条件:** 目标系统运行受影响版本的UnRAR，且攻击者可以控制RAR文件的内容

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-30333是一个存在于Linux和UNIX系统上UnRAR 6.12之前版本的目录遍历漏洞。该漏洞允许攻击者在解压（unpack）操作期间写入任意文件，如创建~/.ssh/authorized_keys文件。根据漏洞库信息、搜索结果和提供的漏洞利用代码，该漏洞利用的有效性较高，并且存在一定的投毒风险。

**有效性：**

根据搜索结果，CVE-2022-30333已被CISA添加到已知被利用的漏洞目录中，并且被用于攻击Zimbra等软件。提供的POC代码旨在利用此漏洞在目标系统的特定目录下写入任意文件，通常是Web根目录，以植入JSP webshell。该POC代码通过构造包含目录遍历字符的RAR文件来实现这一点。因此，提供的POC代码在特定条件下是有效的。

**投毒风险：**

代码中存在轻微的投毒风险。具体体现在以下几个方面：

1.  **依赖特定路径：** POC代码假设Zimbra安装在默认路径`/opt/zimbra/jetty_base/webapps/zimbra`下。如果Zimbra安装在其他路径，则利用会失败。虽然这不是恶意行为，但限制了利用范围。
2. **webshell自身风险:**  POC文档中明确说明，需要保证webshell 未被检测。存在植入恶意webshell的风险。

考虑到POC的主要目的是演示漏洞，而非隐藏恶意代码，因此投毒风险较低，大约为5%。

**利用方式：**

1.  **准备恶意RAR文件：** 攻击者首先创建一个包含恶意JSP webshell的目录（如`root_ver`）。
2.  **构造RAR文件：**  攻击者使用提供的Python脚本`CVE-2022-30333_webroot.py`，该脚本修改原始RAR文件，在文件头中插入包含目录遍历序列的字符串，使UnRAR在解压时将webshell写入到目标系统的Web根目录。
3.  **触发解压：** 攻击者诱使用户或系统（如Zimbra服务器）使用存在漏洞的UnRAR版本解压该恶意RAR文件。
4.  **利用webshell：** 一旦webshell被写入Web根目录，攻击者就可以通过Web浏览器访问该webshell，从而执行任意命令。

总而言之，CVE-2022-30333是一个严重的安全漏洞，攻击者可以利用它在目标系统上写入任意文件，从而导致远程代码执行等严重后果。提供的POC代码展示了该漏洞的利用方法，虽然存在轻微的限制，但总体而言是有效的。由于漏洞利用的简易性，建议受影响的用户尽快升级UnRAR到最新版本。

**项目地址:** [aslitsecurity/Zimbra-CVE-2022-30333](https://github.com/aslitsecurity/Zimbra-CVE-2022-30333)

**漏洞详情:** [CVE-2022-30333](https://nvd.nist.gov/vuln/detail/CVE-2022-30333)