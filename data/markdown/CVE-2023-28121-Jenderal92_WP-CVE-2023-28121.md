## CVE-2023-28121 - WooCommerce Payments Plugin 权限提升漏洞

**漏洞编号:** CVE-2023-28121

**漏洞类型:** 权限提升

**影响应用:** WooCommerce Payments WordPress Plugin

**危害等级:** 高危，可能导致网站完全控制

**影响版本:** <= 5.6.1

**利用条件:** 目标网站安装了受影响版本的WooCommerce Payments插件，且可以通过HTTP/HTTPS访问

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-28121 存在于 WooCommerce Payments WordPress 插件的 5.6.1 及更早版本中。未经验证的攻击者可以代表具有提升权限的用户（如管理员）发送请求。这使得未经身份验证的远程攻击者能够获得对启用了受影响版本插件的站点的管理员访问权限。

**有效性分析：**

提供的POC代码（CVE-2023-28121.py）利用了此漏洞。它通过发送带有特定header (`X-WCPAY-PLATFORM-CHECKOUT-USER: 1`)的POST请求到WordPress站点，并在请求体中包含创建管理员用户的参数，从而创建一个新的管理员账户。

搜索结果表明该漏洞已经被积极利用（Active Exploitation of WooCommerce Payments Improper Authentication Vulnerability (CVE-2023-28121)）。多个来源确认了漏洞的存在以及受影响的版本。

**投毒风险分析：**

代码主要功能是利用漏洞创建管理员用户。可能的风险点在于:

*   **RandomGenerator 函数：** 虽然使用`random.sample`生成随机字符串，但如果random seed被预测或者存在其他问题，可能导致生成的用户名和邮箱可预测，存在一定的信息泄露风险。
*   **错误处理：**  异常处理部分只打印错误信息，可能无法完全处理所有异常情况，导致攻击失败，但是不属于投毒。
*   **域名硬编码:** 脚本中包含 `@` + url,存在泄漏域名的可能,不属于投毒
*   **Version 检测:** 脚本会尝试读取readme.txt文件获取woocommerce-payments版本号，如果读取失败，则跳过 version 检测。这可能会导致exp对不符合版本的网站进行攻击, 但不属于投毒。

综合评估，认为该仓库投毒的可能性较低（约5%）。主要的风险在于依赖于外部资源（目标网站）的可用性，以及随机字符串的安全性。

**利用方式：**

1.  确定目标WordPress网站使用了存在漏洞的WooCommerce Payments插件（版本 <= 5.6.1）。
2.  运行提供的Python脚本，并提供目标网站的URL列表。
3.  脚本会发送精心构造的POST请求，创建一个新的管理员账户。
4.  攻击者可以使用新创建的管理员账户登录WordPress后台，并完全控制该网站。

**缓解措施：**

*   立即更新WooCommerce Payments插件到5.6.2或更高版本。
*   监控WordPress站点的用户账户，查找未经授权创建的管理员账户。
*   使用Web应用防火墙（WAF）阻止包含`X-WCPAY-PLATFORM-CHECKOUT-USER` header的恶意请求。

**项目地址:** [Jenderal92/WP-CVE-2023-28121](https://github.com/Jenderal92/WP-CVE-2023-28121)

**漏洞详情:** [CVE-2023-28121](https://nvd.nist.gov/vuln/detail/CVE-2023-28121)