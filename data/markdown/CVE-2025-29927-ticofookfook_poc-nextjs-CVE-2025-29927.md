## CVE-2025-29927 - Next.js Middleware 授权绕过

**漏洞编号:** CVE-2025-29927

**漏洞类型:** 授权绕过

**影响应用:** Next.js

**危害等级:** 高危，可能导致未授权访问和数据泄露

**影响版本:** >= 11.1.4, <= 13.5.6; > 14.0.0, < 14.2.25; > 15.0.0, < 15.2.3

**利用条件:** 目标 Next.js 应用使用了存在漏洞的中间件，且对外开放服务。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2025-29927 存在于 Next.js 的中间件中，允许攻击者通过 `x-middleware-subrequest` 标头绕过授权检查。 根据 Next.js 的版本，可以使用不同的 payload：

*   **早期版本（低于 12.2）**: `x-middleware-subrequest: pages/_middleware`
*   **版本 12.2 及更高版本**: `x-middleware-subrequest: middleware` 或 `x-middleware-subrequest: src/middleware`（如果应用程序使用 src 目录）
*   **更新版本（例如 15.x）**: `x-middleware-subrequest: middleware:middleware:middleware:middleware:middleware` 或 `x-middleware-subrequest: src/middleware:src/middleware:src/middleware:src/middleware:src/middleware`

**有效性：**

根据漏洞信息和搜索结果，该漏洞是有效的。提供的 PoC 代码旨在通过发送带有特定 `x-middleware-subrequest` 标头的 HTTP 请求来检测此漏洞。PoC 包含针对不同 Next.js 版本的 payload，这表明它能够检测各种受影响的应用程序。

**投毒风险：**

PoC 代码本身主要用于检测漏洞。但是，存在少量投毒风险。PoC 代码执行 HTTP 请求，如果目标服务器容易受到命令注入或其他服务器端漏洞的影响，则可能会被利用。例如，如果 PoC 允许用户指定任意路径，则攻击者可以注入恶意代码。此外，该 PoC 使用了第三方库（requests, colorama）,虽然这些库本身不被认为是恶意的，但始终存在供应链攻击的风险。考虑到这些风险，投毒风险估计为 10%。大部分代码是扫描器和输出，没有明显的恶意行为。

**利用方式：**

1.  攻击者构造包含恶意 `x-middleware-subrequest` 标头的 HTTP 请求。
2.  此请求发送到目标 Next.js 应用程序。
3.  如果应用程序易受攻击，中间件中的授权检查将被绕过。
4.  攻击者可以访问受保护的资源或执行未经授权的操作。例如，通过绕过身份验证或授权机制，访问管理面板或敏感数据。

**项目地址:** [ticofookfook/poc-nextjs-CVE-2025-29927](https://github.com/ticofookfook/poc-nextjs-CVE-2025-29927)

**漏洞详情:** [CVE-2025-29927](https://nvd.nist.gov/vuln/detail/CVE-2025-29927)