## CVE-2022-22963-Spring Cloud Function-远程代码执行

**漏洞编号:** CVE-2022-22963

**漏洞类型:** 远程代码执行

**影响应用:** Spring Cloud Function

**危害等级:** 高危，可能导致远程代码执行和敏感信息泄露

**影响版本:** Spring Cloud Function versions 3.1.6, 3.2.2 and all old and unsupported versions

**利用条件:** 需要目标系统运行Spring Cloud Function，并且启用了路由功能，可通过网络访问

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-22963 是一个存在于 Spring Cloud Function 中的远程代码执行漏洞。当使用路由功能时，攻击者可以构造一个特制的 SpEL 表达式作为路由表达式，导致远程代码执行和本地资源访问。

**有效性：**
根据漏洞库信息、搜索引擎结果和提供的 POC 代码，此漏洞是有效的，并且利用的细节已经被公开。POC代码可以复现漏洞。

**投毒风险：**
POC代码主要包含一个bash脚本和一个README。bash脚本的功能是发送一个包含恶意SpEL表达式的POST请求，从而在目标服务器上执行命令。虽然该脚本可能会被用于恶意目的，但是其中并不包含明显的投毒代码。脚本中读取LHOST和LPORT的方式可能存在风险，攻击者可以借此诱导使用者输入错误的参数，但这不是脚本本身投毒，而是使用者的误操作。README 包含免责声明。
因此，投毒风险较低，评估为5%。

**利用方式：**
1.  攻击者准备一个恶意的SpEL表达式，该表达式能够执行任意命令。
2.  攻击者通过HTTP POST请求的Header，将构造好的SpEL表达式传递给目标服务器。
3.  目标服务器的Spring Cloud Function路由功能解析并执行该SpEL表达式，从而导致远程代码执行。
4.  POC代码利用`curl`命令发送精心构造的HTTP POST请求，请求的header中包含恶意的SpEL表达式，该表达式使用`T(java.lang.Runtime).getRuntime().exec()`执行命令。命令将执行反向shell连接到攻击者的机器上。
5.  攻击者需要提前监听指定端口(`nc -lvnp $LPORT`)，等待目标服务器连接。

**项目地址:** [BearClaw96/CVE-2022-22963-Poc-Bearcules](https://github.com/BearClaw96/CVE-2022-22963-Poc-Bearcules)

**漏洞详情:** [CVE-2022-22963](https://nvd.nist.gov/vuln/detail/CVE-2022-22963)