## CVE-2019-11043 - PHP-FPM 远程代码执行

**漏洞编号:** CVE-2019-11043

**漏洞类型:** 缓冲区溢出

**影响应用:** PHP-FPM

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** PHP 7.1.x (< 7.1.33), 7.2.x (< 7.2.24), 7.3.x (< 7.3.11)

**利用条件:** 需要 Nginx + PHP-FPM 配置，且 Nginx 配置不当（如缺少 try_files 检查）

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-11043 漏洞存在于 PHP-FPM 中，当与 Nginx 结合使用时，如果 Nginx 配置不正确，可能导致远程代码执行。具体来说，该漏洞是由于 `env_path_info` 处理中的 underflow 导致的。攻击者可以通过构造特定的请求，利用 `fastcgi_split_path_info` 指令中的正则表达式缺陷，使得 `PATH_INFO` 变量为空，触发缓冲区溢出，覆盖 FCGI 协议数据，最终实现远程代码执行。

**漏洞利用方式：**

1.  利用 `fastcgi_split_path_info` 的缺陷，通过在 URL 中注入换行符等字符，使 `PATH_INFO` 为空。
2.  利用缓冲区溢出覆盖 FCGI 协议数据，修改 PHP 配置，例如设置 `session.auto_start=0`。
3.  通过 `?a=<command>` 方式执行任意命令。

**关于投毒风险：**

查看提供的 exploit 代码仓库 `https://github.com/neex/phuip-fpizdam`，其中包含 Go 语言编写的漏洞利用程序。虽然该代码已经公开，且被广泛使用，但仍然存在一定的投毒风险。例如，攻击者可能修改该代码，添加恶意功能，例如植入后门、窃取敏感信息等。考虑到该漏洞利用的复杂性，以及对目标环境的特殊要求，投毒风险评估为10%。

**项目地址:** [neex/phuip-fpizdam](https://github.com/neex/phuip-fpizdam)

**漏洞详情:** [CVE-2019-11043](https://nvd.nist.gov/vuln/detail/CVE-2019-11043)