## CVE-2017-16995-Linux Kernel BPF权限提升

**漏洞编号:** CVE-2017-16995

**漏洞类型:** 本地权限提升

**影响应用:** Linux Kernel

**危害等级:** 高危，本地用户可以获得root权限

**影响版本:** through 4.4

**利用条件:** 需要本地用户权限，并开启BPF syscall (CONFIG_BPF_SYSCALL)

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2017-16995是Linux内核中BPF验证器模块中的一个漏洞，由于`check_alu_op`函数在进行符号扩展时存在错误，导致任意内存读写。本地用户可以利用此漏洞，构造恶意的BPF程序，绕过BPF验证器的检查，从而实现内核内存的任意读写，最终提升到root权限。

**有效性：**
从提供的漏洞信息和利用代码来看，此漏洞利用是有效的。漏洞库信息和搜索引擎结果均表明该漏洞存在且可以被利用。POC代码本身也提供了在Ubuntu 16.04上提权的演示。

**投毒风险：**
提供的代码主要包括一个README.md文件和一个exploit.c文件。README.md文件用于描述漏洞信息、影响版本、利用演示和修复方法，看起来没有包含恶意代码。exploit.c文件是漏洞利用的C代码，主要利用BPF验证器的缺陷实现任意内存读写。对exploit.c代码进行分析，并没有发现明显的恶意代码或后门。该漏洞本身是利用了内核的一个缺陷，如果部署的环境打了缓解补丁，可能会造成利用失败, 考虑到github上公开的poc投毒风险较低，因此评估为10%。

**利用方式：**
1.  **编译PoC代码：** 使用gcc编译提供的exploit.c文件。
2.  **运行PoC代码：** 运行编译后的可执行文件。
3.  **PoC利用原理：**
    *   该PoC利用了eBPF验证器模块中的计算错误漏洞。
    *   通过构造特定的BPF程序，使得eBPF验证器产生错误的计算结果，绕过安全检查。
    *   PoC通过精心构造BPF指令，实现对内核内存的任意读写。
    *   利用任意内存写的能力，修改当前进程的`cred`结构体中的uid、gid等字段，将当前用户提升为root权限。
4.  **权限提升：** 成功利用漏洞后，将会获得一个root shell。

**优先级：**
利用代码>搜索引擎结果>漏洞库信息. 漏洞利用代码是直接用于验证和利用漏洞的，因此其优先级最高。搜索引擎结果提供漏洞的背景信息、影响范围和可能的利用方法，因此其优先级次之。漏洞库信息提供漏洞的基本描述和参考链接，但缺乏实际的利用细节，因此其优先级最低。

**项目地址:** [fei9747/CVE-2017-16995](https://github.com/fei9747/CVE-2017-16995)

**漏洞详情:** [CVE-2017-16995](https://nvd.nist.gov/vuln/detail/CVE-2017-16995)