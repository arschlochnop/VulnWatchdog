## CVE-2018-6574-Go-远程命令执行

**漏洞编号:** CVE-2018-6574

**漏洞类型:** 远程命令执行

**影响应用:** Go

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** Go before 1.8.7, Go 1.9.x before 1.9.4, Go 1.10 pre-releases before Go 1.10rc2

**利用条件:** 受害者使用存在漏洞的go版本执行`go get`命令获取恶意模块

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2018-6574 允许通过 `go get` 命令执行远程命令。攻击者可以通过在恶意Go模块中，利用 gcc 或 clang 的 plugin 特性，在构建时执行任意代码。`main.go` 包含 `#cgo CFLAGS: -fplugin=./exploit.so` 指令，这会指示 go 编译器加载并执行 `exploit.so` 作为插件。如果该`.so`文件包含恶意代码，它将在构建过程中被执行。提供的`CORS.html`文件尝试利用CORS漏洞从`http://api-ptl-fbafd824-4fabf863.libcurl.so/api/v1/keys`获取敏感信息，然后将信息发送到攻击者的服务器`https://09ef-186-141-133-245.sa.ngrok.io`。这种组合表明漏洞利用可能涉及到引诱用户下载包含恶意`exploit.so`文件的Go模块，并在构建时执行恶意代码，同时利用CORS漏洞窃取其他域的数据。

**有效性：** `main.go`中的`-fplugin`标志结合`exploit.so`的潜在恶意性，使得该漏洞利用具有有效性。`CORS.html` 的存在表明攻击者可能试图结合利用其他漏洞。

**投毒风险：** 投毒风险为10%。虽然主要的攻击向量看起来是利用`go get`的远程代码执行漏洞，`CORS.html`的存在提出了可能的其他恶意目的。`CORS.html`本身不直接与go编译器或`-fplugin`漏洞相关，因此将其视为完全独立的投毒行为是合理的。 然而，如果恶意作者试图通过其他途径使用该POC，那么使用CORS代码有风险。`main.go`中的核心漏洞利用机制更直接且易于理解。

**利用方式：**

1.  **创建恶意的Go模块：** 攻击者创建一个包含恶意 `exploit.so` 文件的Go模块，该文件将在编译时执行恶意代码。
2.  **利用 `-fplugin` 标志：** 在Go代码中使用 `#cgo CFLAGS: -fplugin=./exploit.so` 指令，指示编译器加载恶意插件。
3.  **诱导受害者 `go get`：** 攻击者诱骗受害者使用 `go get` 命令获取该恶意模块。
4.  **代码执行：** 当受害者构建恶意模块时，`exploit.so` 中的代码将被执行。
5. **结合CORS攻击 (可选):** CORS.html 是可选的攻击辅助，旨在获取其他域的敏感数据。但这需要目标API存在CORS配置错误。
综上，该漏洞的利用方式是结合了`go get`的远程代码执行漏洞和潜在的CORS漏洞，旨在实现远程代码执行和数据窃取。

**项目地址:** [Cypheer/exploit_CVE-2018-6574](https://github.com/Cypheer/exploit_CVE-2018-6574)

**漏洞详情:** [CVE-2018-6574](https://nvd.nist.gov/vuln/detail/CVE-2018-6574)