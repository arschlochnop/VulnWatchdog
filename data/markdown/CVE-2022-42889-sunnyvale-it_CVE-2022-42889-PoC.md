## CVE-2022-42889-Text4Shell-RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，允许未经授权的远程代码执行

**影响版本:** 1.5 <= version <= 1.9

**利用条件:** 应用程序使用受影响版本的Apache Commons Text，并允许用户可控的输入传递给文本插值功能

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-42889，也被称为Text4Shell，是一个影响Apache Commons Text库的远程代码执行漏洞。受影响的版本中，默认的文本插值器包含不安全的查找器，例如`script`、`dns`和`url`。攻击者可以通过构造包含恶意表达式的输入，利用这些查找器执行任意代码或与远程服务器交互。

**有效性分析：**
提供的PoC代码是一个Spring Boot应用程序，它使用了存在漏洞的Apache Commons Text版本。Dockerfile用于构建包含该漏洞的Docker镜像。README.md文件详细说明了如何构建、运行该镜像，并通过构造特定的URL来触发远程代码执行。PoC通过在容器内部创建一个名为`p0wned`的文件来验证漏洞的成功利用。根据README.md文件的描述，以及`docker scan`的输出，可以确认该PoC是有效的。

**投毒风险分析：**
该仓库中存在一定概率的投毒风险，因为作者可以很容易地在可执行的payload中植入恶意代码。例如，`script:javascript:java.lang.Runtime.getRuntime().exec()`可以执行任何系统命令，作者可以在这里插入后门代码，例如反弹shell或下载执行恶意脚本。虽然PoC本身是为了演示漏洞，但潜在的恶意行为者可能会修改PoC以包含其他恶意功能。这里判断投毒风险为10%，主要考虑到该PoC相对简单，直接，旨在演示 RCE，但不能完全排除隐蔽投毒的可能性。

**利用方式：**
1.  攻击者需要找到一个应用程序，该应用程序使用了存在漏洞的Apache Commons Text版本（1.5到1.9）。
2.  攻击者需要确定应用程序中是否存在任何接受用户输入并将其传递给Commons Text的文本插值功能的位置。
3.  攻击者构造一个包含恶意表达式的输入。该表达式利用`script`、`dns`或`url`查找器来执行任意代码。例如：`${script:javascript:java.lang.Runtime.getRuntime().exec('command')}`
4.  应用程序处理该输入，触发文本插值，导致恶意代码被执行。

**项目地址:** [sunnyvale-it/CVE-2022-42889-PoC](https://github.com/sunnyvale-it/CVE-2022-42889-PoC)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)