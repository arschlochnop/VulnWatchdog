## CVE-2023-22809-Sudoedit权限提升

**漏洞编号:** CVE-2023-22809

**漏洞类型:** 权限提升

**影响应用:** Sudo

**危害等级:** 高危，可能导致本地用户权限提升至root

**影响版本:** 1.8.0 through 1.9.12p1

**利用条件:** 需要目标系统安装受影响版本的Sudo，并允许用户通过sudoedit或sudo -e编辑文件。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-22809漏洞存在于Sudo 1.8.0到1.9.12p1版本中，`sudoedit` (或者 `sudo -e`) 功能在处理用户提供的环境变量（`SUDO_EDITOR`, `VISUAL`, 和 `EDITOR`）时，错误地处理了额外的参数，导致本地攻击者可以附加任意条目到待处理的文件列表中，从而导致权限提升。例如，设置`EDITOR='vim -- /path/to/extra/file'`可以绕过保护机制。

**有效性评估：**

提供的Python和Bash脚本旨在利用此漏洞，它们通过设置恶意的环境变量来欺骗`sudoedit`，从而允许用户编辑`/etc/sudoers`或其他特权文件。根据漏洞描述，以及提供的代码，该利用方式是有效的，可以导致权限提升。

**投毒风险分析：**

分析提供的代码，发现存在以下风险：

1.  **信息收集：**  脚本中存在收集sudo版本信息的代码，用于判断目标是否受影响。但可能存在未声明的信息收集行为，虽然目前没有发现明显的后门代码，但仍然存在一定的风险，概率约为10%。
2.  **依赖风险：**  虽然脚本自身没有明显的投毒代码，但是考虑到开源项目的依赖风险，以及作者声明免责声明，需要谨慎使用。

**利用方式：**

1.  **漏洞触发：**  通过设置`SUDO_EDITOR`、`VISUAL`或`EDITOR`环境变量，在其中包含`--`参数，以及想要编辑的恶意文件路径。
2.  **权限提升：**  当用户执行`sudoedit`命令时，由于漏洞，`sudoedit`会将恶意文件添加到编辑列表，允许低权限用户编辑高权限文件，例如`/etc/sudoers`，从而获得root权限。
3.  **POC脚本利用：**  提供的POC脚本简化了上述过程，通过执行脚本自动设置环境变量，检查Sudo版本，并尝试利用漏洞。

**项目地址:** [D0rDa4aN919/CVE-2023-22809-Exploiter](https://github.com/D0rDa4aN919/CVE-2023-22809-Exploiter)

**漏洞详情:** [CVE-2023-22809](https://nvd.nist.gov/vuln/detail/CVE-2023-22809)