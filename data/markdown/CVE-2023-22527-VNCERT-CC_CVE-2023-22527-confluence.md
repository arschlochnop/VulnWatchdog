## CVE-2023-22527-Confluence-远程代码执行

**漏洞编号:** CVE-2023-22527

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Atlassian Confluence Server and Data Center

**危害等级:** 高危，允许未授权的攻击者执行任意代码。

**影响版本:** 8.0.0 <= version < 8.5.4

**利用条件:** 目标Confluence实例版本在受影响范围内，且可以通过网络访问。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-22527 是一个存在于 Atlassian Confluence Server 和 Data Center 中的模板注入漏洞。 根据漏洞库信息和搜索结果，该漏洞允许未经身份验证的攻击者在受影响的实例上执行任意代码。

**利用方式：**

1.  **漏洞原理：** 该漏洞是由于Confluence中使用的模板引擎（可能是 Velocity 或 FreeMarker）存在缺陷，允许攻击者注入恶意的表达式。
2.  **攻击过程：**
    *   攻击者构造包含 OGNL 表达式的恶意请求，该表达式会被Confluence服务器解析和执行。
    *   POC代码通过将命令分块写入临时文件，然后使用freemarker的Execute类执行该文件。利用的关键点在于利用了 `/template/aui/text-inline.vm` 模板文件进行OGNL注入。
    *   攻击者可以使用 OGNL 表达式来执行任意命令，例如反弹 shell 或执行系统命令。

**POC有效性：**

根据提供的漏洞利用代码和搜索结果，该POC代码是有效的。 该POC利用了OGNL注入漏洞，能够实现远程代码执行。

**投毒风险：**

分析POC代码，发现存在一定的投毒风险。 代码中虽然没有明显的恶意代码，但存在以下潜在风险：

*   **文件写入：** POC将命令写入`/tmp/a`，攻击者可以修改POC，写入恶意脚本，然后执行，但是由于文件路径是固定的，危害较小。
*   **依赖环境：** 该POC依赖`bun`环境，如果`bun`环境存在安全问题，可能会被利用。
*   **网络请求：** POC会发起网络请求，攻击者可以修改POC，将受害者的信息发送到攻击者的服务器。

综合考虑，该仓库存在一定的投毒风险，但风险较低。 建议在使用该POC时，仔细检查代码，确保没有恶意代码。

**其他风险点:** 搜索引擎结果中提到该漏洞已经被恶意行为者利用于加密货币挖矿和勒索软件攻击，表明此漏洞的真实危害性较高。

**项目地址:** [VNCERT-CC/CVE-2023-22527-confluence](https://github.com/VNCERT-CC/CVE-2023-22527-confluence)

**漏洞详情:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)