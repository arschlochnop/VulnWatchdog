## CVE-2023-46604-Apache ActiveMQ-远程代码执行

**漏洞编号:** CVE-2023-46604

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache ActiveMQ

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** < 5.15.16, < 5.16.7, < 5.17.6, < 5.18.3

**利用条件:** 需要网络访问到 ActiveMQ 的 OpenWire 协议端口

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-46604 是 Apache ActiveMQ 中 Java OpenWire 协议marshaller的一个远程代码执行漏洞。攻击者可以通过操纵 OpenWire 协议中的序列化类类型，使客户端或 Broker 实例化 classpath 上的任何类，从而执行任意 shell 命令。

**有效性：**

根据漏洞库信息、搜索引擎结果，以及提供的漏洞利用代码（ActiveMQ_RCE_GUI），可以判断此漏洞的 POC 代码是有效的。多个来源表明该漏洞已被积极利用。

**投毒风险：**

分析提供的 POC 代码，`README.md` 只是一个说明文件，`pom.xml` 是 Maven 的项目配置文件，用于管理依赖项。`Main.java` 是一个简单的 Java 类，没有恶意代码。`ActiveMQ_RCE_GUI.form` 是一个 IntelliJ IDEA 的 GUI 描述文件，用于定义 GUI 界面。由于代码量较少，且没有发现明显的可疑行为，但存在远程调用和网络连接,所以投毒风险评估为10%。

**利用方式：**

1.  **攻击者需要能够访问 ActiveMQ Broker 或客户端的 OpenWire 协议端口。**
2.  **攻击者构造恶意的 OpenWire 消息，其中包含精心设计的序列化数据，利用不安全的反序列化过程。**
3.  **该消息被 ActiveMQ Broker 或客户端接收后，会尝试反序列化消息中的对象。**
4.  **通过操纵序列化的类类型，攻击者可以使 ActiveMQ 实例化 classpath 上的任意类。**
5.  **攻击者选择一个可以执行任意代码的类（例如，包含静态代码块或可利用的构造函数的类）。**
6.  **成功实例化恶意类后，即可在服务器上执行任意 shell 命令，从而实现远程代码执行。**

搜索引擎结果表明，该漏洞已被 Kinsing 恶意软件和勒索软件组织利用，因此需要及时修复。

**项目地址:** [ImuSpirit/ActiveMQ_RCE_Pro_Max](https://github.com/ImuSpirit/ActiveMQ_RCE_Pro_Max)

**漏洞详情:** [CVE-2023-46604](https://nvd.nist.gov/vuln/detail/CVE-2023-46604)