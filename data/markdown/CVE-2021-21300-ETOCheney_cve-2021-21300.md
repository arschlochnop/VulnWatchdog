## CVE-2021-21300-Git-远程代码执行

**漏洞编号:** CVE-2021-21300

**漏洞类型:** 远程代码执行

**影响应用:** Git

**危害等级:** 高危，可能导致远程代码执行和系统被控制

**影响版本:** >= 2.14.2, < 2.17.62.17.6, >= 2.18.0, < 2.18.5, >= 2.19.0, < 2.19.6, >= 2.20.0, < 2.20.5, >= 2.21.0, < 2.21.4, >= 2.22.0, < 2.22.5, >= 2.23.0, < 2.23.4, >= 2.24.0, < 2.24.4, >= 2.25.0, < 2.25.5, >= 2.26.0, < 2.26.3, >= 2.27.0, < 2.27.1, >= 2.28.0, < 2.28.1, >= 2.29.0, < 2.29.3, >= 2.30.0, < 2.30.1

**利用条件:** 需要目标系统使用受影响的Git版本，文件系统为大小写不敏感（如NTFS, HFS+ or APFS），并且配置了clean/smudge过滤器（例如Git LFS）

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-21300 漏洞允许恶意仓库在克隆期间执行任意代码。攻击者可以通过构造包含符号链接和使用 clean/smudge 过滤器的文件（如Git LFS）的恶意仓库来实现。当在大小写不敏感的文件系统上克隆此仓库时，会导致在检出后执行恶意脚本。

**有效性：** 提供的POC代码是有效的，它包含一个 `post-checkout` 钩子脚本，当仓库被检出后会自动执行。该脚本简单地输出 "PWNED" 到标准错误流，表明代码执行已成功。

**投毒风险：** POC代码本身并不包含隐藏的投毒代码。 `post-checkout` 脚本的目的非常明显，即验证漏洞的存在。 由于样本很小且直接，因此其中嵌入隐藏的、恶意功能的可能性很低。所以投毒风险为0%。

**利用方式：**
1.  攻击者创建一个包含恶意 `post-checkout` 钩子脚本的Git仓库。
2.  仓库中包含符号链接以及配置了 clean/smudge 过滤器的文件（例如，使用Git LFS跟踪的大文件）。
3.  攻击者诱使用户克隆该恶意仓库。
4.  当用户在大小写不敏感的文件系统上克隆仓库时，Git会自动执行 `post-checkout` 脚本，从而执行攻击者的恶意代码。

**项目地址:** [ETOCheney/cve-2021-21300](https://github.com/ETOCheney/cve-2021-21300)

**漏洞详情:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)