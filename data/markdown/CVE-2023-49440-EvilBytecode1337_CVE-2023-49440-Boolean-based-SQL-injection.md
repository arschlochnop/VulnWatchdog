## XXX SQL注入漏洞

**漏洞编号:** CVE-2023-49440

**漏洞类型:** SQL注入

**影响应用:** XXX

**危害等级:** 高危，可能导致敏感数据泄露

**影响版本:** 未知，根据代码推测存在于使用console/ems接口的XXX应用

**利用条件:** 需要知道目标XXX服务器的URL，以及至少一个有效的管理员用户名。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞利用方式如下：

1.  **获取Conceal Key：**  首先，POC通过访问`/api/console/ems/conceal`接口获取用于加密密码的`conceal_key`。
2.  **加密密码：**  使用获取到的`conceal_key`和AES加密算法对管理员密码进行加密。
3.  **登录：**  使用加密后的密码和用户名，通过`/api/console/ems/admin/force_login`接口进行登录，获取`access_token`。如果已经有用户登录，登录会失败。
4.  **SQL注入：**  使用获取到的`access_token`，构造SQL注入payload，通过`/api/console/ems/query/report/preview`接口执行SQL查询，获取`tb_admin`表中的管理员用户名和密码哈希。

**投毒风险分析：**
代码中存在`CryptoJS`库的使用，虽然看起来是标准加密库，但需要确认其来源是否可靠，是否存在被篡改的风险。`iv = CryptoJS.enc.Base64.parse("<react base64>")` 中的`<react base64>`看起来像是占位符，需要确认实际环境中是如何替换的。如果该值被替换为恶意内容，可能导致加密过程出现问题，甚至执行恶意代码。代码的`sqli` 函数中的 `query = "select admin_id, password from tb_admin"`可以直接dump 数据库中的 admin_id 和 password,这个可能是攻击者编写恶意软件的投毒点，用于直接盗取数据库中的用户认证信息。

**总结：**  
该POC利用了SQL注入漏洞，通过获取加密密钥、模拟登录、构造恶意SQL查询等步骤，最终获取管理员的用户名和密码哈希。 尽管POC本身目的是验证漏洞，但攻击者可以利用此代码竊取用戶密码。因此存在一定的投毒风险，但是整体投毒的风险较低。

**项目地址:** [EvilBytecode1337/CVE-2023-49440-Boolean-based-SQL-injection](https://github.com/EvilBytecode1337/CVE-2023-49440-Boolean-based-SQL-injection)

**漏洞详情:** [CVE-2023-49440](https://nvd.nist.gov/vuln/detail/CVE-2023-49440)