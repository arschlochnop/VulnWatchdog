## CVE-2017-12617-Apache Tomcat 远程代码执行

**漏洞编号:** CVE-2017-12617

**漏洞类型:** 远程代码执行

**影响应用:** Apache Tomcat

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** 9.0.0.M1 to 9.0.0, 8.5.0 to 8.5.22, 8.0.0.RC1 to 8.0.46, 7.0.0 to 7.0.81

**利用条件:** 需要目标Tomcat实例开启了HTTP PUT方法（readonly 初始化参数设置为false）

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2017-12617 漏洞允许攻击者通过构造特制的HTTP PUT请求上传JSP文件到服务器上，然后通过访问上传的JSP文件来执行任意代码。从漏洞库信息和搜索引擎结果来看，该漏洞是一个已知且高危的漏洞，存在公开的利用代码。提供的POC代码 `apachetomcat.py` 尝试通过 PUT 方法上传包含恶意代码的 JSP 文件。代码中 `construct_put` 函数构造 PUT 请求，上传名为 `${shell_name}.jsp` 的文件，文件内容为一段简单的 JSP 代码。`main` 函数从 `apaches2.txt` 文件读取目标主机列表，并循环尝试利用漏洞。 

**有效性：**
根据漏洞信息和搜索结果，该漏洞的利用是有效的，只要目标环境满足漏洞触发的条件（Tomcat版本在受影响范围内，且启用了HTTP PUT）。 POC 代码通过尝试上传JSP文件来验证漏洞。

**投毒风险：**
POC代码中存在轻微的投毒风险（约10%）。
1. `README.md`文件声明 "don't use maliciously please", 但这个声明并不代表任何实际的约束，仅仅是作者的免责声明，属于一种社会工程学上的伪装，降低用户对恶意行为的警惕性。
2. 代码中存在注释，链接到了另一个GitHub仓库 `https://raw.githubusercontent.com/cyberheartmi9/CVE-2017-12617/master/tomcat-cve-2017-12617.py`，这可能诱导用户使用其他潜在的恶意脚本。
3. POC中默认从`apaches2.txt` 读取目标，这是一个隐蔽的控制方式，攻击者可能通过修改这个文件来批量攻击。

**利用方式：**
1.  **条件判断：**  检查目标 Tomcat 服务器是否运行在受影响的版本范围内（9.0.0.M1 to 9.0.0, 8.5.0 to 8.5.22, 8.0.0.RC1 to 8.0.46, 7.0.0 to 7.0.81）。
2.  **PUT 权限：** 确定目标 Tomcat 服务器是否启用了 HTTP PUT 方法，这通常通过检查 `Default` servlet 的 `readonly` 初始化参数是否设置为 `false` 来判断。
3.  **JSP 上传：**  使用构造好的 HTTP PUT 请求，上传包含恶意代码的 JSP 文件到目标服务器。通常，攻击者会使用`.jsp`或者`.jspx`作为后缀, 但是由于Tomcat对后缀的处理问题， 可以使用`/`绕过。
4.  **代码执行：**  通过访问上传的 JSP 文件，触发服务器执行其中的恶意代码，从而实现远程代码执行。

**项目地址:** [devcoinfet/CVE-2017-12617](https://github.com/devcoinfet/CVE-2017-12617)

**漏洞详情:** [CVE-2017-12617](https://nvd.nist.gov/vuln/detail/CVE-2017-12617)