## CVE-2024-36401-GeoServer-远程代码执行

**漏洞编号:** CVE-2024-36401

**漏洞类型:** 远程代码执行

**影响应用:** GeoServer

**危害等级:** 高危，允许未授权的远程代码执行

**影响版本:** 2.23.0 < 2.23.6, 2.24.0 < 2.24.4, 2.25.0 < 2.25.2, < 2.22.6

**利用条件:** GeoServer实例需要能够处理WFS GetPropertyValue等OGC请求

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-36401 是 GeoServer 中的一个远程代码执行漏洞，该漏洞源于 GeoTools 库 API 不安全地将属性名称传递给 commons-jxpath 库，从而允许执行任意代码。PoC 代码通过构造 WFS GetPropertyValue 请求，利用 XPath 表达式注入来执行恶意命令。该 PoC 包含一个 Python 脚本 (exploit.py) 和一个类型名称列表 (type_names.txt)。脚本首先在攻击者主机上启动一个反向 shell 监听器，然后将反向 shell 命令进行 Base64 编码，最后通过特制的 WFS GetPropertyValue 请求发送到目标 GeoServer 实例。如果成功，GeoServer 将执行该命令，并将反向 shell 连接回攻击者主机。

**有效性：**

根据漏洞描述和搜索结果，该漏洞在野外已被利用，PoC代码是有效的。

**投毒风险：**

分析提供的 PoC 代码，未发现明显的恶意代码或后门。代码功能清晰，主要用于利用漏洞执行远程命令。`type_names.txt` 文件包含 GeoServer 已知类型名称列表，用于构造请求，本身不构成安全风险。`exploit.py` 脚本的功能是生成反向 shell 命令，对其进行编码，并通过构造的 WFS GetPropertyValue 请求发送它。不存在隐藏的恶意功能。

**利用方式：**

1.  攻击者需要一台能够建立网络连接的主机。
2.  攻击者运行 PoC 脚本，指定目标 GeoServer URL，以及反向 shell 的 IP 地址和端口。
3.  PoC 脚本构造包含恶意 XPath 表达式的 WFS GetPropertyValue 请求，其中 XPath 表达式注入了反向 shell 命令。
4.  GeoServer 在处理请求时，由于漏洞，会执行该恶意命令。
5.  攻击者主机收到来自 GeoServer 实例的反向 shell 连接，从而获得对服务器的控制。

总的来说，提供的PoC没有发现有投毒代码，主要通过java.lang.Runtime.getRuntime()执行命令。

**项目地址:** [yisas93/CVE-2024-36401-PoC](https://github.com/yisas93/CVE-2024-36401-PoC)

**漏洞详情:** [CVE-2024-36401](https://nvd.nist.gov/vuln/detail/CVE-2024-36401)