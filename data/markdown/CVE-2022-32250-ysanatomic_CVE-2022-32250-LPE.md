## CVE-2022-32250-Linux Kernel Netfilter UAF LPE

**漏洞编号:** CVE-2022-32250

**漏洞类型:** Use-After-Free (UAF)

**影响应用:** Linux Kernel Netfilter

**危害等级:** 高危，本地用户权限提升至 root

**影响版本:** <= 5.18.1

**利用条件:** 需要创建 user/net 命名空间的能力

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2022-32250 是 Linux 内核 netfilter 模块中的一个使用后释放漏洞。漏洞位于 `net/netfilter/nf_tables_api.c` 文件中。由于 `NFT_STATEFUL_EXPR` 检查不正确，导致可以利用此漏洞将本地用户权限提升到 root 权限。 

**利用方式：**

1.  **触发 UAF：** 创建一个包含 `nft_lookup` 操作的 netfilter 规则集，该操作引用一个命名集合。在创建集合时，没有正确设置 `NFT_STATEFUL_EXPR` 标志，导致释放后仍然可以访问集合。
2.  **堆喷射：** 使用户空间 key payload 来覆盖 UAF 后的内存，控制内存中的数据。
3.  **KASLR 绕过:** 通过堆泄漏利用UAF来获取kernel地址,绕过KASLR。
4.  **权限提升：** 利用UAF修改`modprobe_path`变量，指向一个恶意脚本。当内核尝试加载一个无法识别的模块时，会执行 `modprobe_path` 指向的脚本，从而获得 root 权限。

**有效性：**

提供的 POC 代码声称在 5.12.0 版本上有效。根据漏洞信息和搜索结果，此漏洞存在于 Linux kernel 5.18.1 之前的版本中，因此该 POC 代码很可能有效。

**投毒风险：**

查看了提供的 exploit.c 代码和 README.md 文件。虽然不能完全保证没有隐藏的恶意代码，但是从代码的结构和逻辑来看，以及作者在 README.md 中的声明，投毒风险较低。 代码主要流程是利用 netfilter 的 UAF 漏洞进行堆喷射和 `modprobe_path` 覆盖，逻辑比较清晰。 但是，仍存在极小的可能性作者存在隐藏后门代码，故概率为1%。

综上所述，此漏洞利用的有效性较高，投毒风险较低。

**项目地址:** [ysanatomic/CVE-2022-32250-LPE](https://github.com/ysanatomic/CVE-2022-32250-LPE)

**漏洞详情:** [CVE-2022-32250](https://nvd.nist.gov/vuln/detail/CVE-2022-32250)