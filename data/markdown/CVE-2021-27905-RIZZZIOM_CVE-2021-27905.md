## CVE-2021-27905 - Apache Solr SSRF

**漏洞编号:** CVE-2021-27905

**漏洞类型:** SSRF (Server-Side Request Forgery)

**影响应用:** Apache Solr

**危害等级:** 高危，可能导致信息泄露、内部服务访问、远程代码执行（取决于内部网络的配置）

**影响版本:** < 8.8.2

**利用条件:** 需要Solr实例运行在受影响版本，并且`/replication`处理器对外开放（或至少可被攻击者访问）

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-27905 是一个存在于 Apache Solr ReplicationHandler 中的 SSRF 漏洞。在受影响的版本中，ReplicationHandler 的 `masterUrl` 参数未经过充分的验证，允许攻击者指定任意 URL，导致 Solr 服务器向该 URL 发起请求。 

**有效性：**
根据提供的漏洞信息和漏洞利用代码，该漏洞的POC代码是有效的。漏洞库信息明确指出该漏洞存在于 8.8.2 之前的版本，而提供的 PoC 代码和 Docker Compose 文件使用了 `solr:8.8.1` 镜像，证明了该漏洞的存在。

**投毒风险：**
该仓库中存在投毒代码的可能性较低，约为 10%。主要基于以下几点：
*   PoC代码相对简单，主要功能是利用 SSRF 漏洞发送 HTTP 请求。
*   代码结构清晰，易于理解和审查。
*   PoC的目的是验证漏洞的存在，而不是执行恶意操作。虽然SSRF本身具有潜在的危害，但这取决于攻击者指定的 payload。投毒指的是作者在代码中隐藏的恶意逻辑。

然而，仍然存在一定的风险：
*   依赖关系 (`requirements.txt`) 可能会被篡改，引入包含恶意代码的第三方库。但目前`requirements.txt`仅包含`requests`库，风险较低。
*   攻击者可能会误用该 PoC，将内部服务或敏感信息暴露在外部。
*   payload 本身可能包含恶意代码（例如，如果目标内部服务存在其他漏洞）。

**利用方式：**
利用方式如下：
1.  确定目标 Solr 实例的版本低于 8.8.2。
2.  找到或创建一个 Solr Core。
3.  使用提供的 PoC 代码 `cve-2021-27905.py`，指定目标 Solr 实例的 URL (`--target`) 和要发送的 payload URL (`--payload`)。
4.  如果没有指定 core，程序会自动尝试获取。
5.  PoC 代码会构造一个包含 `masterUrl` 参数的请求，发送到 `/solr/<CORE_NAME>/replication` 路径，触发 SSRF 漏洞。
6.  Solr 服务器会向 `masterUrl` 指定的 URL 发起请求，攻击者可以利用这一点探测内部网络、读取内部服务数据或者利用其他漏洞。


**项目地址:** [RIZZZIOM/CVE-2021-27905](https://github.com/RIZZZIOM/CVE-2021-27905)

**漏洞详情:** [CVE-2021-27905](https://nvd.nist.gov/vuln/detail/CVE-2021-27905)