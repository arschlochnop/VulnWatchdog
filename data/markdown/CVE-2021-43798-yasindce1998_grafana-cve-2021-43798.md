## CVE-2021-43798-Grafana-目录遍历

**漏洞编号:** CVE-2021-43798

**漏洞类型:** 目录遍历

**影响应用:** Grafana

**危害等级:** 高危，可能导致敏感信息泄露

**影响版本:** 8.0.0-beta1 to 8.3.0 (除已修补版本)

**利用条件:** 需要网络访问，且目标Grafana实例未打补丁

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-43798 是 Grafana 中的一个目录遍历漏洞。根据漏洞库信息和搜索引擎结果，攻击者可以通过构造包含目录遍历序列的 URL，未经授权访问服务器上的本地文件。漏洞 URL 路径为 `<grafana_host_url>/public/plugins/<plugin ID>/<path traversal>`，其中 `<plugin ID>` 是已安装插件的 ID，`<path traversal>` 包含诸如 `../../..` 这样的序列。

**有效性分析：**
根据漏洞库信息、搜索引擎结果和提供的漏洞利用代码，该漏洞利用是有效的。漏洞利用代码提供了一个 `grafana-vuln-app.yaml` 文件，用于在 Kubernetes 集群中部署一个存在漏洞的 Grafana 实例（版本 8.2.0），从而重现该漏洞。

**投毒风险分析：**
该 YAML 文件定义了一个 Grafana deployment，service，configmap。代码本身没有明显的恶意操作，例如反弹 shell 或植入后门。但该代码将部署一个**存在漏洞的** Grafana 实例。 如果攻击者使用该 YAML 文件部署 Grafana 实例，然后未及时修补漏洞，则该 Grafana 实例可能会受到攻击。

更细致地看：
*   `grafana-vuln-app.yaml`：此文件用于在 Kubernetes 集群中部署存在漏洞的 Grafana 实例，没有发现直接的投毒代码。
*   `README.md`：此文件包含部署说明，也没有投毒代码。

总的来说，该仓库主要目的是重现 CVE-2021-43798 漏洞，没有明显的投毒代码。然而，部署一个存在已知漏洞的实例本身就具有风险，如果部署后未及时修补，则可能被恶意利用。由于部署行为本身需要用户参与，且漏洞是已知的，因此将此评定为投毒有一定的争议。

**利用方式：**
1.  找到目标 Grafana 实例，确定其版本在受影响范围内（8.0.0-beta1 到 8.3.0，除已修补版本）。
2.  确定 Grafana 实例上已安装的插件 ID。
3.  构造包含目录遍历序列的 URL：` <grafana_host_url>/public/plugins/<plugin ID>/../../../../../../etc/passwd`。
4.  发送 HTTP GET 请求到构造的 URL。如果漏洞存在，服务器将返回 `/etc/passwd` 文件的内容。

**结论：** 漏洞利用有效，但需要目标 Grafana 实例未打补丁，且攻击者需要知道已安装的插件 ID。 投毒风险较低，主要风险在于部署了存在漏洞的 Grafana 实例后未及时修补。

**项目地址:** [yasindce1998/grafana-cve-2021-43798](https://github.com/yasindce1998/grafana-cve-2021-43798)

**漏洞详情:** [CVE-2021-43798](https://nvd.nist.gov/vuln/detail/CVE-2021-43798)