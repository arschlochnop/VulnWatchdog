## CVE-2023-0386 OverlayFS 本地提权漏洞

**漏洞编号:** CVE-2023-0386

**漏洞类型:** 本地权限提升

**影响应用:** Linux Kernel

**危害等级:** 高危，可使普通用户获得root权限

**影响版本:** < 6.2

**利用条件:** 需要本地访问权限，目标系统内核版本低于6.2且OverlayFS未修复

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-0386 是 Linux 内核 OverlayFS 子系统中的一个漏洞，允许本地用户提升权限。该漏洞源于内核在执行 copy-up 操作期间未能正确验证用户/组所有权映射。攻击者可以利用此漏洞：

1.  创建一个具有 root 拥有的 SUID 二进制文件的恶意 FUSE 文件系统。
2.  使用用户和挂载命名空间隔离操作。
3.  创建一个 OverlayFS 挂载，并将 FUSE 文件系统作为 lower layer。
4.  触发一个 copy-up 操作，错误地保留 SUID 位。
5.  执行生成的 SUID 二进制文件以获得 root 权限。

**有效性：** 根据漏洞信息和搜索结果，该漏洞已被积极利用，PoC 代码的存在进一步证实了其有效性。提供的 `README.md` 文件描述了一个完整的安全工具包，包含漏洞测试、缓解和取证分析脚本，说明此漏洞的利用代码已经比较成熟。

**投毒风险：** 虽然该工具包提供了漏洞测试脚本，但同时也包含了缓解和取证分析脚本，相对比较完整。考虑到该漏洞被 CISA 列入已知被利用漏洞目录，说明此漏洞利用的公开程度较高。`README.md` 文件中也包含了免责声明，提示仅在测试系统上运行 PoC。因此，虽然不排除作者可能在脚本中隐藏恶意代码，但概率相对较低，约为10%。需要对脚本内容进行详细审计以确认是否存在投毒行为。

**利用方式：**

1.  **环境准备：** 攻击者需要一个存在漏洞的 Linux 系统，并且能够创建挂载点和用户命名空间。
2.  **FUSE 文件系统创建：** 创建一个 FUSE 文件系统，并在其中放置一个 root 用户拥有的 SUID 可执行文件。
3.  **OverlayFS 挂载：** 使用 FUSE 文件系统作为 lower layer，创建一个 OverlayFS 挂载。
4.  **触发 Copy-up：** 通过访问或修改 FUSE 文件系统中的文件，触发 copy-up 操作。这将导致 SUID 可执行文件被复制到 OverlayFS 的 upper layer。
5.  **权限提升：** 执行 upper layer 中的 SUID 可执行文件，由于漏洞的存在，该文件仍然保留 SUID 位，从而使攻击者获得 root 权限。

**项目地址:** [bchevCH/CVE-2023-0386](https://github.com/bchevCH/CVE-2023-0386)

**漏洞详情:** [CVE-2023-0386](https://nvd.nist.gov/vuln/detail/CVE-2023-0386)