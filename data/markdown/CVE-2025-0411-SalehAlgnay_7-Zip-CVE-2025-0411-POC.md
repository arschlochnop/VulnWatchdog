## CVE-2025-0411-7-Zip-Mark-of-the-Web Bypass

**漏洞编号:** CVE-2025-0411

**漏洞类型:** Mark-of-the-Web (MotW) Bypass

**影响应用:** 7-Zip

**危害等级:** 高危，允许攻击者在用户上下文中执行任意代码

**影响版本:** 24.08 (x64)

**利用条件:** 用户必须访问恶意页面或打开恶意文件。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2025-0411 存在于 7-Zip 24.08 (x64) 版本中，允许攻击者绕过 Mark-of-the-Web (MotW) 保护机制。当 7-Zip 从带有 MotW 标记的恶意压缩文件中提取文件时，不会将 MotW 标记传播到提取的文件。这使得攻击者可以利用此漏洞在当前用户的上下文中执行任意代码。根据搜索结果，该漏洞已被积极利用，针对乌克兰组织发起的攻击中使用了 SmokeLoader 恶意软件，攻击者使用鱼叉式网络钓鱼活动和同形字攻击来伪装恶意文件。

**有效性：**
根据漏洞库信息和搜索引擎结果，该漏洞的POC是有效的，并且已被公开利用。

**利用方式：**
1.  攻击者创建一个恶意的压缩文件，该文件包含恶意payload，但绕过了 MotW 标记。
2.  攻击者诱骗用户下载并使用 7-Zip 打开此压缩文件。
3.  7-Zip 解压文件时，没有将 MotW 标记传播到解压后的文件。
4.  用户执行解压后的恶意文件，从而允许攻击者在用户上下文中执行任意代码。

**投毒风险分析：**
提供的 `loader.cpp` 文件显示了一个shellcode加载器，其中 shellcode 部分被注释为 `//calc.exe shellcode`。这意味着在原始代码中，这段 shellcode 应该会启动计算器。然而，攻击者可以替换这段 shellcode 为任何恶意代码，例如下载器、后门等。由于仓库中提供的 `Application.zip` 文件是从外部链接下载的，因此无法验证其安全性，存在潜在的投毒风险。`README.md` 文件使用了一个图片链接指向外部资源，这本身不是直接的投毒，但如果该链接被篡改指向恶意网站，可能会导致用户下载恶意软件。
综合来看，该仓库本身并非完全安全，存在潜在的投毒风险，大概为10%，主要体现在以下几个方面：
*   `loader.cpp` 中可以嵌入任意恶意 shellcode。
*   `Application.zip` 文件是从外部链接下载的，无法保证其安全性。
*   `README.md` 文件中的外部链接存在被篡改的风险，引导用户访问恶意网站。

**POC 代码分析：**
`loader.cpp` 实现了以下功能：
1.  分配内存：使用 `VirtualAlloc` 在进程空间中分配一块具有读写权限的内存区域。
2.  复制 shellcode：使用 `RtlMoveMemory` 将 shellcode 复制到分配的内存中。
3.  修改内存保护属性：使用 `VirtualProtect` 将内存区域的保护属性修改为可执行和读取，以便 CPU 可以执行 shellcode。
4.  创建线程：使用 `CreateThread` 创建一个新的线程，该线程的起始地址为 shellcode 的地址。
5.  等待线程结束：使用 `WaitForSingleObject` 等待新创建的线程执行完成。

这段代码的主要目的是执行shellcode。shellcode的具体功能取决于其内容。在示例中，如果shellcode确实是启动计算器，那么这段代码的目的是在目标系统上启动计算器。

**项目地址:** [SalehAlgnay/7-Zip-CVE-2025-0411-POC](https://github.com/SalehAlgnay/7-Zip-CVE-2025-0411-POC)

**漏洞详情:** [CVE-2025-0411](https://nvd.nist.gov/vuln/detail/CVE-2025-0411)