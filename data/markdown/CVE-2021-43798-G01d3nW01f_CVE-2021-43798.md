## CVE-2021-43798-Grafana-目录遍历

**漏洞编号:** CVE-2021-43798

**漏洞类型:** 目录遍历

**影响应用:** Grafana

**危害等级:** 高危，可能导致敏感信息泄露

**影响版本:** 8.0.0-beta1 到 8.3.0 (除已修复版本)

**利用条件:** 需要网络访问，并且目标 Grafana 实例存在受影响版本的插件。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-43798 是 Grafana 中的一个目录遍历漏洞。攻击者可以通过构造特殊的 URL，利用`/public/plugins/<plugin_id>/`路径绕过访问限制，读取服务器上的任意文件。漏洞存在于Grafana 8.0.0-beta1 到 8.3.0版本（已修复版本除外）。

**利用方式：**

1.  **确定目标 Grafana 版本：** 通过服务器 banner 信息或 API 接口判断目标 Grafana 版本是否在受影响范围内。
2.  **选择一个已安装的插件：**  利用提供的 `plugin_list` 或者其他方式获取 Grafana 实例中已安装的插件 ID。
3.  **构造恶意 URL：**  使用以下格式构造包含目录遍历的 URL：
    `http://<grafana_host_url>/public/plugins/<plugin_id>/../../../../../../../../../../../../<想要读取的文件路径>`
4.  **发送请求：**  向构造的 URL 发送 GET 请求，如果漏洞存在，服务器将返回目标文件的内容。

**POC 代码分析：**

提供的 Python 脚本 `grafana-exploit.py` 实现了上述利用过程：

*   **指定目标主机：** 使用 `-H` 或 `--host` 参数指定目标 Grafana 实例的 URL。
*   **选择插件：** 脚本从 `plugin_list` 列表中随机选择一个插件 ID。
*   **构造 URL：** 脚本构造包含目录遍历的 URL，并允许用户指定要读取的文件路径。
*   **发送请求：** 脚本发送 HTTP GET 请求，读取指定文件。
*   **输出结果：** 如果成功读取文件，脚本会将文件内容输出到控制台，同时输出可用的 curl 命令。

**投毒风险分析：**

*   分析了提供的脚本，没有发现恶意代码或后门，该脚本的主要功能是发送 HTTP 请求并读取文件内容，不具备持久化或控制目标系统的能力。
*   `readme.md` 文件仅包含脚本的使用说明，没有发现任何可疑内容。

因此，认为此仓库中不存在作者隐藏的投毒代码。

**项目地址:** [G01d3nW01f/CVE-2021-43798](https://github.com/G01d3nW01f/CVE-2021-43798)

**漏洞详情:** [CVE-2021-43798](https://nvd.nist.gov/vuln/detail/CVE-2021-43798)