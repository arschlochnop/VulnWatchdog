## CVE-2023-0830 - EasyNAS backup.pl 操作系统命令注入

**漏洞编号:** CVE-2023-0830

**漏洞类型:** 操作系统命令注入

**影响应用:** EasyNAS

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 1.1.0

**利用条件:** 需要身份验证（已登录的低权限用户）和网络访问

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

该漏洞存在于EasyNAS 1.1.0的 `/backup.pl` 文件中的 `system` 函数中。攻击者可以利用经过身份验证的会话，通过构造恶意的 `name` 参数，将操作系统命令注入到 `backup.pl` 脚本执行的命令中，导致远程代码执行。利用方式是发送包含base64编码的恶意命令的GET请求。PoC代码通过base64编码命令，并通过管道符 `|` 将命令注入到 `backup.pl` 的 `name` 参数中。  

**有效性：** 根据漏洞描述和PoC代码，该漏洞利用是有效的。PoC代码实现了登录验证和命令执行两个阶段。 首先, 尝试使用提供的用户名和密码登录到EasyNAS Web界面, 如果登录成功, 则继续执行命令注入。

**投毒风险：** PoC代码的投毒风险极低。 代码的主要功能是利用已知的命令注入漏洞。代码结构清晰，仅包含登录、命令编码和发送请求等功能，没有发现明显的恶意代码或隐藏后门。虽然不排除作者在其他提交或版本中加入恶意代码的可能性，但当前提供的代码片段本身风险较低。

**利用方式：**
1.  **身份验证：** 首先，攻击者需要使用有效的用户名和密码登录EasyNAS Web界面。
2.  **构造恶意请求：** 成功登录后，攻击者构造一个包含恶意命令的GET请求，该命令经过Base64编码。
3.  **命令注入：** 将构造的恶意命令注入到`/backup.pl`的`name`参数中。
4.  **执行命令：** 服务器端的`backup.pl`脚本在没有充分验证`name`参数的情况下，将其传递给`system`函数执行，从而导致操作系统命令注入。
5.  **获取回显：** PoC代码通过正则表达式匹配响应内容，尝试提取命令执行的结果。如果无法直接提取，则使用两阶段方法，将命令输出重定向到临时文件，然后再读取该文件。


**项目地址:** [xbz0n/CVE-2023-0830](https://github.com/xbz0n/CVE-2023-0830)

**漏洞详情:** [CVE-2023-0830](https://nvd.nist.gov/vuln/detail/CVE-2023-0830)