## CVE-2021-29427-Gradle依赖投毒

**漏洞编号:** CVE-2021-29427

**漏洞类型:** 依赖投毒/信息泄露

**影响应用:** Gradle

**危害等级:** 高危，可能导致远程代码执行和信息泄露

**影响版本:** >= 5.1, <= 6.8.3

**利用条件:** 使用settings.gradle中的pluginManagement块配置仓库内容过滤，且Gradle版本在受影响范围内。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-29427是Gradle的一个依赖投毒漏洞。当在`settings.gradle`文件的`pluginManagement`块中使用仓库内容过滤时，Gradle可能会忽略内容过滤器，从而从未经授权的仓库下载恶意依赖。攻击者可以通过在公共仓库中注册具有相同名称的恶意依赖，从而实现依赖投毒。

**POC有效性分析：**

提供的POC代码包含`SafeDownloader.java`和`VulnerableDownloader.java`。`VulnerableDownloader.java`模拟了从不受信任的URL下载插件的行为，没有进行任何的来源验证，直接下载并保存，证明了可以从任意位置下载依赖。
`SafeDownloader.java`展示了如何缓解这种风险，通过设置白名单和文件扩展名检查来防止恶意依赖的下载。因此，结合漏洞描述信息，提供的POC代码能够有效模拟漏洞。

**投毒风险分析：**

提供的代码库主要目的是演示CVE-2021-29427漏洞，并提供一个安全下载插件的示例。`fix.sh`脚本用于将易受攻击的文件替换为安全版本。这个仓库的主要目的是为了演示漏洞和修复方案，而不是包含任何隐藏的投毒代码。 投毒风险为 0%。

**利用方式：**

1.  攻击者需要找到一个使用存在漏洞的Gradle版本（5.1 <= version <= 6.8.3）的项目，并且该项目在`settings.gradle`的`pluginManagement`块中配置了仓库内容过滤。
2.  攻击者创建一个恶意依赖，并将其上传到一个公共仓库。
3.  恶意依赖需要与项目配置中使用的依赖项具有相同的groupId和artifactId，以此进行”投毒“攻击。
4.  当Gradle构建项目时，它可能会忽略内容过滤器，从公共仓库下载恶意依赖。
5.  恶意依赖中的代码将在构建过程中执行，从而导致远程代码执行。

**项目地址:** [arsalanraja987/gradle-cve-2021-29427-demo](https://github.com/arsalanraja987/gradle-cve-2021-29427-demo)

**漏洞详情:** [CVE-2021-29427](https://nvd.nist.gov/vuln/detail/CVE-2021-29427)