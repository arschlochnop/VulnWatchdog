## CVE-2025-24016-Wazuh-反序列化RCE

**漏洞编号:** CVE-2025-24016

**漏洞类型:** 反序列化漏洞

**影响应用:** Wazuh

**危害等级:** 高危，可导致远程代码执行

**影响版本:** >= 4.4.0, < 4.9.1

**利用条件:** 需要API访问权限（可能通过被入侵的dashboard、集群中的Wazuh服务器或特定配置下的被入侵的Agent获得）

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2025-24016 是 Wazuh 服务器中的一个远程代码执行 (RCE) 漏洞，源于不安全的反序列化。攻击者可以利用 `DistributedAPI` 的参数反序列化过程，通过注入恶意的 JSON 数据，在服务器上执行任意代码。

**有效性分析：**

根据提供的漏洞信息和PoC代码，该漏洞利用是有效的。PoC通过向 `/security/user/authenticate/run_as` 端点发送包含 `__unhandled_exc__` 字段的恶意JSON payload，触发了反序列化漏洞，进而执行了代码。PoC代码清晰地展示了攻击向量和触发条件，可以复现。

**投毒风险分析：**

PoC代码中主要包含一个 README.md 文件和一个rce.png文件。README.md 文件详细描述了漏洞原理、影响版本、PoC利用方法和缓解措施。代码较为简洁，目的明确，旨在展示和验证漏洞。rce.png 是 Burp Suite 的截图，作为PoC的辅助说明。作者隐藏恶意代码的可能性较低，但仍不能完全排除。由于缺乏更深入的代码分析，假设存在很小的可能作者隐藏了例如通过图片隐写术将后门代码隐藏在rce.png图片中，故投毒风险为5%。

**利用方式：**

1.  **漏洞位置：** `framework/wazuh/core/cluster/common.py` 中的 `as_wazuh_object` 函数。
2.  **攻击向量：** 通过构造恶意的 `DistributedAPI` 请求，将包含特殊键 `__unhandled_exc__` 的 JSON 数据发送到服务器。
3.  **触发点：** `run_as` 接口，利用 `auth_context` 参数。
4.  **利用流程：**
    *   攻击者首先获取 Wazuh API 的访问权限（通过被入侵的 dashboard、集群中的 Wazuh 服务器或特定配置下的被入侵的 Agent）。
    *   攻击者构造包含恶意 JSON payload 的 HTTP POST 请求，发送到 `/security/user/authenticate/run_as` 端点。
    *   Wazuh 服务器在反序列化 JSON 数据时，由于不安全的反序列化操作，导致 `__unhandled_exc__` 字段中的代码被执行。
    *   攻击者可以利用此漏洞执行任意代码，例如，PoC 中使用了 `exit()` 函数导致服务器退出。
5.  **修复方案：** 升级到 Wazuh 4.9.1 或更高版本，该版本已修复此漏洞。

**项目地址:** [GloStarRx1/CVE-2025-24016](https://github.com/GloStarRx1/CVE-2025-24016)

**漏洞详情:** [CVE-2025-24016](https://nvd.nist.gov/vuln/detail/CVE-2025-24016)