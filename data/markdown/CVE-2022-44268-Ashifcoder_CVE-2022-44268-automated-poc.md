## CVE-2022-44268 ImageMagick Arbitrary File Read

**漏洞编号:** CVE-2022-44268

**漏洞类型:** 信息泄露

**影响应用:** ImageMagick

**危害等级:** 高危，可能导致敏感信息泄露

**影响版本:** 7.1.0-49 及之前版本

**利用条件:** 目标系统安装了受影响的 ImageMagick 版本，并且ImageMagick进程有权读取目标文件。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-44268 是 ImageMagick 中的一个信息泄露漏洞。当 ImageMagick 解析 PNG 图像（例如，为了调整大小）时，可能在生成的图像中嵌入任意文件的内容（如果 ImageMagick 进程具有读取该文件的权限）。

**有效性评估：**

提供的 POC 代码似乎有效。它使用 `pngcrush` 工具将指定文件的内容作为文本元数据嵌入到 PNG 图像中。然后，使用 `convert` 命令处理这个被修改过的 PNG 图像，使得嵌入的文件内容可以被提取出来。

**投毒风险分析：**

该仓库中存在一定投毒风险，但风险较低。

*   **README.md：** 存在恶意链接的可能性极低，但不能排除。
*   **CVE-2022-44268_poc.sh：** 该脚本主要利用已知的 ImageMagick 漏洞，脚本本身没有明显的恶意代码。但用户需要手动输入要读取的文件路径，这本身存在风险（例如，如果用户输入了不应该读取的文件路径）。脚本中使用的命令 `pngcrush`, `exiv2`, `convert`, `identify`, `sed`, `xxd` 都是常见的系统命令，本身不是恶意代码。

总体评估，该仓库的投毒风险较低，大约为 5%。主要是因为脚本依赖用户输入，且执行的命令都是常见的系统命令，隐藏恶意行为比较困难。

**漏洞利用方式：**

1.  攻击者需要准备一个 PNG 图像文件。
2.  攻击者运行 POC 脚本，脚本会提示输入 PNG 文件路径和要读取的目标文件路径。
3.  脚本使用 `pngcrush` 将目标文件的内容嵌入到 PNG 图像的文本元数据中。
4.  脚本使用 `convert` 命令处理修改后的 PNG 图像。
5.  脚本使用 `identify` 命令提取嵌入在图像中的数据，并使用 `xxd` 命令将十六进制数据转换为原始文件内容。
6.  攻击者可以从输出中获取目标文件的内容。

**项目地址:** [Ashifcoder/CVE-2022-44268-automated-poc](https://github.com/Ashifcoder/CVE-2022-44268-automated-poc)

**漏洞详情:** [CVE-2022-44268](https://nvd.nist.gov/vuln/detail/CVE-2022-44268)