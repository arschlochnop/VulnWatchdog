## CVE-2023-52927 - Linux Kernel Netfilter UAF

**漏洞编号:** CVE-2023-52927

**漏洞类型:** Use-After-Free (UAF)

**影响应用:** Linux Kernel

**危害等级:** 高危，本地权限提升

**影响版本:** <= 6.1.129 和 < 6.6 的早期版本

**利用条件:** 需要能够与netfilter子系统交互，可能需要特定的网络配置和权限。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-52927 是 Linux 内核 netfilter 组件中的一个 Use-After-Free 漏洞，该漏洞发生在 `nf_ct_find_expectation` 函数中，当期望连接(expectation)未被正确移除时。 

**有效性评估：**

根据漏洞库信息和搜索结果，此漏洞存在于 Linux Kernel 直到版本 6.1.129。提供的漏洞利用代码包含 Makefile、README.md 和 exploit.c 等文件。README.md 提到了一个 kCTF 环境的利用，exploit.c 包含了利用漏洞的代码。Makefile 文件显示它使用了 `libnetfilter_queue`、`libnfnetlink`、`libnftnl` 和 `libmnl` 等 netfilter 相关的库。这些信息表明，该 POC 具备一定的有效性，因为它针对特定的内核版本和 netfilter 功能。

**投毒风险评估：**

虽然代码看起来像是合法的漏洞利用，但仍然存在一定的投毒风险。 代码中包含一些硬编码的地址(例如`INIT_NSPROXY`, `COMMIT_CREDS`等) 并且代码从网络中下载库文件，这存在潜在的风险，例如，如果下载链接被篡改，则可能引入恶意代码。此外，复杂的网络配置也可能被用来隐藏恶意行为。
综合来看，投毒风险大约为 10%。 这是因为:

*   漏洞利用代码直接利用了已知的漏洞，并且提供了相关的库依赖和编译方法。
*   但是，该漏洞需要联网下载依赖，如果依赖被篡改可能会植入恶意代码。
*   代码中硬编码的地址是针对特定内核版本编译的，不通用。

**利用方式：**

1.  **环境准备：** 搭建存在漏洞的内核环境，或者使用 kCTF 提供的环境。
2.  **依赖安装：** 使用 `make prerequisites` 下载并编译 netfilter 相关的库。
3.  **漏洞触发：** 通过构造特定的网络数据包，利用`nf_ct_find_expectation`函数，触发 Use-After-Free 漏洞。
4.  **权限提升：** 利用 UAF 漏洞，覆盖内核对象，修改进程的凭据结构体（`cred`），将当前进程的 uid 和 gid 设置为 0，从而获得 root 权限。

**总结：**

提供的 POC 代码具有较高的可信度，能够利用 CVE-2023-52927 漏洞实现本地权限提升。但是，仍然需要注意代码中存在的硬编码地址和潜在的投毒风险，使用前需要进行充分的评估和验证。

**项目地址:** [seadragnol/CVE-2023-52927](https://github.com/seadragnol/CVE-2023-52927)

**漏洞详情:** [CVE-2023-52927](https://nvd.nist.gov/vuln/detail/CVE-2023-52927)