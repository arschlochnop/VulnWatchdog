## CVE-2018-19207 - WP GDPR Compliance Plugin - 权限提升/代码执行

**漏洞编号:** CVE-2018-19207

**漏洞类型:** 权限提升/代码执行

**影响应用:** WP GDPR Compliance Plugin

**危害等级:** 高危，允许未授权用户执行任意代码和提升权限

**影响版本:** <= 1.4.2

**利用条件:** 需要目标WordPress站点安装了WP GDPR Compliance插件且版本低于等于1.4.2，并且允许未授权访问wp-admin/admin-ajax.php和wp-login.php

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

该漏洞存在于Van Ons开发的WP GDPR Compliance插件1.4.3之前的版本中。由于插件对$wpdb->prepare()函数的输入处理不当，导致未授权的远程攻击者可以执行任意代码。PoC代码通过以下步骤利用此漏洞：

1.  **获取ajaxSecurity nonce:** 从网站首页提取ajaxSecurity nonce，该nonce用于后续的API请求验证。
2.  **启用用户注册:** 通过`wpgdprc_process_action` action，将`users_can_register`选项设置为1，启用用户注册功能。
3.  **设置默认角色为管理员:**  同样通过`wpgdprc_process_action` action，将`default_role`选项设置为`administrator`，这意味着新注册的用户将自动获得管理员权限。
4.  **注册用户:** 使用标准的WordPress注册接口（`wp-login.php?action=register`）注册一个新用户。
5.  **禁用用户注册并恢复默认角色:**  为了不让其他人利用该漏洞，PoC在注册完成后，会禁用用户注册，并将默认角色恢复为`subscriber`。

通过以上步骤，攻击者可以在目标WordPress站点上创建一个具有管理员权限的用户。由于该过程利用了插件的功能缺陷而非SQL注入，因此利用成本较低。该POC代码看起来简洁明了，主要用于提权，并未发现明显的恶意投毒代码。 投毒风险较低， 仅有很小可能存在隐蔽的恶意行为,例如尝试安装恶意插件或修改主题文件等。 但整体代码逻辑没有明显投毒行为。

**项目地址:** [aeroot/WP-GDPR-Compliance-Plugin-Exploit](https://github.com/aeroot/WP-GDPR-Compliance-Plugin-Exploit)

**漏洞详情:** [CVE-2018-19207](https://nvd.nist.gov/vuln/detail/CVE-2018-19207)