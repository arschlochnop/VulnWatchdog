## CVE-2024-4367-PDF.js-任意JavaScript代码执行

**漏洞编号:** CVE-2024-4367

**漏洞类型:** 任意JavaScript代码执行

**影响应用:** PDF.js (Firefox, Firefox ESR, Thunderbird)

**危害等级:** 高危，可能导致数据泄露、XSS或RCE

**影响版本:** Firefox < 126, Firefox ESR < 115.11, Thunderbird < 115.11

**利用条件:** 用户打开恶意PDF文件

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4367是PDF.js中的一个严重漏洞，由于对PDF文件中FontMatrix对象的类型检查不足，允许执行任意JavaScript代码。攻击者可以制作恶意PDF文件，在受害者的浏览器中执行JavaScript，从而导致数据盗窃、XSS或远程代码执行。

**有效性分析：**

根据漏洞库信息和搜索引擎结果，该漏洞允许在PDF.js环境中执行任意JavaScript代码，影响Firefox、Firefox ESR和Thunderbird的特定版本。提供的漏洞利用代码(README.md) 描述了如何利用此漏洞制作恶意PDF文件。该代码提供了一个完整的利用流程，包括环境设置、漏洞利用、社工和后处理。综合来看，提供的POC代码**有效**。

**投毒风险分析：**

虽然README.md文件本身看起来像一个合法的漏洞利用指南，但仔细分析脚本描述和操作步骤，发现其依赖于Social Engineering Toolkit (SET)来发起钓鱼攻击，并且包含执行任意js的payload, 存在一定的**投毒风险**。Payload可能被修改为执行恶意操作，例如窃取用户凭据或执行任意代码。该POC代码中，风险主要体现在以下几个方面：

1.  **依赖外部工具：** 脚本依赖于SET，攻击者可能会利用SET的配置过程进行恶意配置，诱导用户执行有害操作。
2.  **Payload可定制：** 脚本允许用户自定义JavaScript payload，这意味着攻击者可以注入任意恶意代码。
3.  **社会工程：** 脚本使用社会工程手段传播恶意PDF，这增加了攻击成功的可能性。
4.  **数据外泄：** Payload可以窃取数据（如cookie），并将其发送到攻击者的服务器。

因此，我估计此仓库存在**10%**的投毒风险，主要集中在payload的潜在恶意性和利用社工手段传播上。需要注意的是，此处讨论的“投毒”并非指传统意义上的供应链投毒，而是指利用该POC进行攻击时，攻击者可以嵌入恶意代码或进行欺骗。

**利用方式：**

1.  **准备环境：** 安装Python 3.x, SET，以及PyPDF2等依赖。
2.  **创建恶意PDF：** 使用提供的脚本，通过修改`template.pdf`的`/FontMatrix`字段，注入JavaScript payload，生成`malicious.pdf`。
3.  **社工攻击：** 使用SET或其他工具，通过电子邮件或其他方式，将`malicious.pdf`发送给目标用户。
4.  **服务器监听：** 运行一个HTTP服务器，用于托管`malicious.pdf`，并收集payload窃取的数据。
5.  **受害者交互：** 受害者打开`malicious.pdf`后，payload执行，窃取数据并发送到攻击者的服务器。

**项目地址:** [exfil0/WEAPONIZING-CVE-2024-4367](https://github.com/exfil0/WEAPONIZING-CVE-2024-4367)

**漏洞详情:** [CVE-2024-4367](https://nvd.nist.gov/vuln/detail/CVE-2024-4367)