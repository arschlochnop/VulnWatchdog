## CVE-2018-14847 - MikroTik RouterOS WinBox Directory Traversal

**漏洞编号:** CVE-2018-14847

**漏洞类型:** 目录遍历

**影响应用:** MikroTik RouterOS WinBox

**危害等级:** 高危，可能导致敏感信息泄露或任意文件写入

**影响版本:** <= 6.42

**利用条件:** 目标设备运行受影响版本的RouterOS，且WinBox服务开启。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2018-14847 是一个存在于 MikroTik RouterOS 6.42 及更早版本中的目录遍历漏洞，攻击者可以利用 WinBox 接口读取任意文件（未认证）或写入任意文件（需认证）。

**有效性：**

从漏洞库信息、搜索引擎结果以及提供的 POC 代码来看，此漏洞的利用是有效的。搜索引擎结果表明，该漏洞已经被广泛研究和利用，并且存在公开的 Metasploit 模块（webpage 7），表明其可利用性较高。提供的 POC 代码包含两个 Python 脚本 (`MACServerDiscover.py` 和 `MACServerExploit.py`) 以及 `extract_user.py` (未提供完整代码)，显示了利用此漏洞读取 `/flash/rw/store/user.dat` 文件的尝试，该文件包含用户凭据。

**投毒风险：**

`MACServerDiscover.py` 用于发现局域网内的 Mikrotik 设备，本身不具备投毒功能。 `MACServerExploit.py` 的主要功能是利用目录遍历漏洞读取 `user.dat` 文件。虽然提供的 `extract_user.py` 代码不完整，但 `MACServerExploit.py` 依赖于它进行用户凭据的提取，所以如果恶意修改 `extract_user.py` 文件，使其在提取用户凭据的同时执行其他恶意操作，则存在投毒风险。 此外，`MACServerExploit.py` 中使用了硬编码的payload a 和 b，如果修改这些payload，可能会造成未知后果。 因此，风险估计为10%。

**利用方式：**

1.  **设备发现：** 使用 `MACServerDiscover.py` 脚本发现局域网内的 MikroTik 设备，获取其 MAC 地址。
2.  **漏洞利用：** 使用 `MACServerExploit.py` 脚本，通过构造包含目录遍历的恶意请求，尝试读取 `/flash/rw/store/user.dat` 文件。该脚本模拟了 WinBox 协议通信，利用了协议中存在的漏洞。
3.  **凭据提取：** 如果成功读取 `user.dat` 文件，则使用（未完整提供的）`extract_user.py` 脚本从中提取用户名和密码。

利用的关键在于构造正确的 WinBox 协议数据包，利用目录遍历绕过访问限制，读取敏感文件。该漏洞既可以未授权读取文件，也可以在认证后写入文件，因此危害较大。

**项目地址:** [jas502n/CVE-2018-14847](https://github.com/jas502n/CVE-2018-14847)

**漏洞详情:** [CVE-2018-14847](https://nvd.nist.gov/vuln/detail/CVE-2018-14847)