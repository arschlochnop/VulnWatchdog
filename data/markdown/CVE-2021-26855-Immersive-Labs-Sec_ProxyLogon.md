## CVE-2021-26855 - Microsoft Exchange Server Remote Code Execution Vulnerability (ProxyLogon)

**漏洞编号:** CVE-2021-26855

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Microsoft Exchange Server

**危害等级:** 高危，可能导致完全控制 Exchange 服务器

**影响版本:** 受影响版本包括 Exchange Server 2013, 2016, 和 2019 的多个累积更新版本（具体版本见漏洞库信息）

**利用条件:** 需要能够访问 Exchange 服务器的 Web 接口 (OWA/ECP)。利用链中需要与其他漏洞配合（如 CVE-2021-26857）。通常不需要身份验证即可发起攻击。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-26855 是 Microsoft Exchange Server 中的一个服务器端请求伪造 (SSRF) 漏洞，它是 ProxyLogon 攻击链的入口点。未经身份验证的远程攻击者可以利用此漏洞发送任意 HTTP 请求并伪装成 Exchange 服务器。通过利用此 SSRF 漏洞，攻击者可以绕过身份验证，然后利用其他漏洞（如 CVE-2021-26857，一个不安全的反序列化漏洞）来执行任意代码。 

**有效性：**
根据搜索结果和漏洞利用代码描述，此漏洞的 POC 代码是有效的。多个来源（例如 UpGuard，NVD，Microsoft 官方博客，Tenable 等）都确认了该漏洞的存在和被积极利用的情况。提供的代码文件 `proxylogon.py` 似乎是实现了 ProxyLogon 攻击链的利用程序，可以链式利用 CVE-2021-26855 和 CVE-2021-26857 来执行代码。

**投毒风险：**
代码中存在一定的投毒风险，比例估计为10%。 风险点主要在于`proxylogon.py` 中使用`eval(Request["cmd"],"unsafe")` 执行用户传入的 `cmd` 参数，具有高风险。此方法允许服务器端执行任意代码，如果攻击者恶意构造 `cmd` 的内容，则可能导致服务器被完全控制。虽然作者可能出于方便利用的目的添加此功能，但也为恶意使用者打开了方便之门。另一个风险点在于，脚本中的powershell命令（通过`revPSScriptUrl`传入）可能包含恶意代码，下载和执行来自不受信任源的powershell脚本是危险的。然而，代码中提供了免责声明，声明其用于教育和研究目的，并且给出了Immersive Labs的链接以供安全环境中使用。

**利用方式：**
1.  **SSRF (CVE-2021-26855):** 利用 SSRF 漏洞绕过身份验证，使攻击者可以冒充 Exchange 服务器。
2.  **不安全的反序列化 (CVE-2021-26857):** 通过 SSRF 漏洞获得权限后，利用不安全的反序列化漏洞在 Exchange 服务器上执行任意代码。
3.  **Web Shell 部署:** 上传并部署 Web Shell，以便攻击者可以持续访问 Exchange 服务器并执行命令。POC 代码中的 `shell_payload` 变量定义了用于部署 Web shell 的 JScript 代码。
4.  **远程代码执行:** 使用Web Shell执行系统命令，例如执行powershell脚本。

**项目地址:** [Immersive-Labs-Sec/ProxyLogon](https://github.com/Immersive-Labs-Sec/ProxyLogon)

**漏洞详情:** [CVE-2021-26855](https://nvd.nist.gov/vuln/detail/CVE-2021-26855)