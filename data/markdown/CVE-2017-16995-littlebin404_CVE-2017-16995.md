## CVE-2017-16995-Linux Kernel BPF权限提升

**漏洞编号:** CVE-2017-16995

**漏洞类型:** 本地权限提升

**影响应用:** Linux Kernel

**危害等级:** 高危，可导致普通用户获取root权限

**影响版本:** <= 4.4

**利用条件:** 本地用户，需要开启BPF syscall (CONFIG_BPF_SYSCALL)

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2017-16995 漏洞存在于 Linux kernel 的 `kernel/bpf/verifier.c` 文件中的 `check_alu_op` 函数中，允许本地用户利用不正确的符号扩展导致拒绝服务（内存损坏）或可能造成其他未指定的危害。

**有效性:**
根据漏洞库信息、搜索引擎结果和提供的 PoC 代码，可以判断此漏洞是有效的。漏洞库信息明确指出该漏洞的存在，以及受影响的 Linux kernel 版本范围。搜索引擎结果中也包含了该漏洞的详细信息，以及多个漏洞利用的链接（例如 Exploit-DB）。提供的 PoC 代码 `upstream44.c` 是一个 C 语言程序，声称可以在 Ubuntu 16.04 上利用此漏洞来提升权限。该 PoC 代码通过构造恶意的 BPF 程序，利用 eBPF 验证器模块的计算错误，导致任意内存读写，从而获得 root 权限。

**投毒风险:**
分析提供的 PoC 代码 `upstream44.c`，主要功能是利用 BPF 漏洞进行提权。代码本身逻辑较为清晰，主要利用了BPF特性进行内存操作，虽然代码中存在硬编码的偏移地址 (CRED_OFFSET)，这依赖于特定的内核版本，可能会导致在其他版本上利用失败，但这不属于恶意投毒行为。 代码中 `__exit` 函数会直接退出程序，可能会导致一些清理工作没有完成，这是一种不良编程习惯，但也不能算作投毒。代码中利用了`socketpair`和`setsockopt`来加载BPF程序，这本身是利用漏洞的正常行为。
但是，`README.md`文件过于简单，没有详细的说明漏洞原理和利用方法，这可能会让使用者不了解风险。综合判断，投毒风险较低，大约为 10%。

**利用方式:**
1.  编译 PoC 代码：`gcc -o upstream44 upstream44.c`
2.  运行编译后的程序：`./upstream44`

程序会利用 BPF 漏洞修改当前用户的 credentials 结构，将其 UID、GID 等设置为 0，从而获得 root 权限。

**项目地址:** [littlebin404/CVE-2017-16995](https://github.com/littlebin404/CVE-2017-16995)

**漏洞详情:** [CVE-2017-16995](https://nvd.nist.gov/vuln/detail/CVE-2017-16995)