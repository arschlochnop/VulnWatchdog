## CVE-2023-45866

**漏洞编号:** CVE-2023-45866

**漏洞类型:** 蓝牙HID协议未授权连接漏洞

**影响应用:** BlueZ

**危害等级:** 高危，可能导致未授权的键盘输入注入

**影响版本:** bluez 5.64-0ubuntu1 in Ubuntu 22.04LTS (受影响版本可能更多)

**利用条件:** 攻击者需要在蓝牙通信范围内，目标设备开启蓝牙且未进行适当的配对授权

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-45866 允许未经身份验证的蓝牙外围设备（如恶意键盘）在 BlueZ 中发起和建立加密连接，并发送 HID 键盘报告。由于在中央角色设备上未进行用户交互以授权访问，攻击者可以注入 HID 消息。POC代码 `BlueDucky.py` 通过模拟蓝牙键盘，尝试绕过认证过程并向目标主机发送预定义的按键序列（duckyscript）。

**有效性评估：**
根据漏洞描述和搜索引擎结果，该漏洞允许攻击者在没有用户交互的情况下，注入键盘输入，因此提供的POC代码理论上是有效的，只要满足漏洞利用的先决条件，如目标设备运行受影响的 BlueZ 版本，并且攻击者在蓝牙通信范围内。

**投毒风险评估：**
分析 `BlueDucky.py` 代码，存在一定的投毒风险，但风险较低。主要风险点体现在以下几个方面：
1.  **依赖项安装：** 代码依赖于 `pydbus` 和 `bluetooth` 库，如果攻击者篡改安装源，可能引入恶意依赖。
2.  **duckyscript内容：**虽然代码本身没有明显恶意行为，但duckyscript 内容可以被修改成任何指令，从而达到植入后门，执行恶意程序等目的。
3. **subprocess 滥用**: 代码中频繁使用了 `subprocess` 模块，如果参数构造不当，容易引入命令注入风险。
4.  **注册HID配置文件：** 代码使用 `register_hid_profile` 注册HID profile，如果profile内容被篡改，可以导致目标系统出现意外行为。
综合考虑，主要风险来自duckyscript的内容，和profile内容，以及对`subprocess`模块的滥用，因此投毒风险评估为10%。

**利用方式：**
1.  **扫描目标：** 攻击者使用蓝牙扫描工具找到可攻击的目标设备。
2.  **模拟蓝牙键盘：** 攻击者运行 `BlueDucky.py` 脚本，模拟一个蓝牙键盘。
3.  **绕过认证：** 脚本利用漏洞，尝试与目标设备建立未经授权的加密连接。
4.  **注入按键：** 成功建立连接后，脚本执行 duckyscript 文件中的指令，向目标主机注入预定义的按键序列，从而控制目标设备。

**项目地址:** [pentestfunctions/BlueDucky](https://github.com/pentestfunctions/BlueDucky)

**漏洞详情:** [CVE-2023-45866](https://nvd.nist.gov/vuln/detail/CVE-2023-45866)