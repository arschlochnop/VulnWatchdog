## CVE-2021-4034-Polkit pkexec权限提升漏洞

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地权限提升

**影响应用:** Polkit

**危害等级:** 高危，允许低权限用户获得root权限

**影响版本:** all (受影响版本)

**利用条件:** 需要本地用户权限

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-4034是一个存在于Polkit的pkexec工具中的本地权限提升漏洞。pkexec是一个setuid程序，旨在允许非特权用户按照预定义的策略以特权用户身份运行命令。该漏洞源于pkexec未能正确处理调用参数的数量，导致其尝试将环境变量作为命令执行。攻击者可以通过构造特殊的环境变量，诱使pkexec执行任意代码，从而获得root权限。

**利用方式：**

1.  **构造恶意环境变量：** 利用代码通过创建`GCONV_PATH=.`目录，并在其中放置恶意的gconv模块配置文件`gconv-modules`。`gconv-modules`文件指示系统加载恶意的共享库`pwnkit.so`。
2.  **编译恶意共享库：**  利用代码编译一个包含提权代码的共享库`pwnkit/pwnkit.so`，该共享库在初始化时（`gconv_init`函数）将当前进程的UID和GID设置为0（root），然后执行一个shell。
3.  **执行pkexec：**  利用代码通过`execve`函数执行`/usr/bin/pkexec`，并传递构造好的环境变量，例如`PATH=GCONV_PATH=.`，`CHARSET=PWNKIT`等。
4.  **漏洞触发：**  当pkexec尝试加载gconv模块时，由于`GCONV_PATH`被设置为恶意目录，它会加载攻击者提供的`pwnkit.so`，从而执行其中的提权代码，最终获得root shell。

**有效性：**

提供的POC代码是有效的。它已经在Debian 10和CentOS 7上验证成功，可以使非特权用户获得root权限。

**投毒风险：**

经过分析，提供的POC代码中没有发现明显的恶意代码或后门。该代码的目的是利用CVE-2021-4034漏洞进行本地权限提升，其行为符合漏洞描述和利用原理。作者可能存在的投毒风险极低(0%)。

**参考信息：**

*   漏洞库信息：CVE-2021-4034描述了该漏洞的细节和影响。
*   搜索引擎结果：搜索结果提供了有关该漏洞的更多信息，包括漏洞分析、利用方法和缓解措施。例如，Qualys的博客文章(webpage 2)详细介绍了该漏洞的利用方式。

**项目地址:** [Milad-Rafie/PwnKit-Local-Privilege-Escalation-Vulnerability-Discovered-in-polkit-s-pkexec-CVE-2021-4034-](https://github.com/Milad-Rafie/PwnKit-Local-Privilege-Escalation-Vulnerability-Discovered-in-polkit-s-pkexec-CVE-2021-4034-)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)