## CVE-2023-21768 Windows AFD LPE

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 本地提权

**影响应用:** Windows Ancillary Function Driver for WinSock (AFD)

**危害等级:** 高危，允许本地用户提升权限至SYSTEM

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 需要本地用户权限，目标系统存在漏洞

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-21768 是 Windows AFD 驱动中的一个本地提权漏洞。攻击者可以利用此漏洞，通过运行特制的应用程序，提升权限至 SYSTEM。根据提供的漏洞信息和搜索结果，此漏洞影响 Windows Server 2022 和 Windows 11 的特定版本。提供的 POC 代码利用 I/O Ring LPE 原语，允许攻击者向目标进程写入数据并将其提升到 SYSTEM 权限。

**有效性：**
根据提供的资料，POC 代码似乎是有效的。README 文件提到，完整的利用程序适用于易受攻击的 Windows 11 22H2 系统，而写原语适用于所有易受攻击的系统。搜索结果也表明该漏洞已被积极利用。

**投毒风险：**
虽然提供的代码本身看起来像一个合法的漏洞利用程序，但仍然存在一些投毒风险。例如，构建利用程序需要 Visual Studio，而构建过程中可能会引入恶意代码。此外，利用程序可能会执行意外操作，导致系统不稳定或损坏。总体评估该POC代码投毒风险较低，只有10%，作者更关注于完成验证，风险主要来源于使用者环境。

**利用方式：**
利用过程如下：
1.  **编译 PoC 代码：** 使用 Visual Studio 编译提供的源代码。
2.  **获取目标进程 PID：** 确定要提升权限的进程的进程 ID。
3.  **运行利用程序：** 运行编译后的可执行文件，并将目标进程 PID 作为命令行参数传递给它。
4.  **权限提升：** 如果利用成功，目标进程的权限将提升到 SYSTEM。

**项目地址:** [chompie1337/Windows_LPE_AFD_CVE-2023-21768](https://github.com/chompie1337/Windows_LPE_AFD_CVE-2023-21768)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)