## CVE-2015-3306-ProFTPD-mod_copy任意文件读写

**漏洞编号:** CVE-2015-3306

**漏洞类型:** 任意文件读写

**影响应用:** ProFTPD

**危害等级:** 高危，可能导致信息泄露和远程代码执行

**影响版本:** 1.3.5

**利用条件:** 需要mod_copy模块启用，并且目标服务器运行ProFTPD 1.3.5。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2015-3306是ProFTPD 1.3.5版本中mod_copy模块存在的一个漏洞，允许未经授权的远程攻击者通过`SITE CPFR`和`SITE CPTO`命令读取和写入任意文件。 

**有效性:**
根据漏洞库信息、搜索引擎结果和提供的漏洞利用代码，此漏洞的POC代码应该是有效的。多个来源 (NVD, Trend Micro, pentest-tools, Exploit-DB) 证实了漏洞的存在和利用的可能性。提供的代码实现了一个针对该漏洞的利用工具。

**投毒风险:**
提供的代码包含以下几个文件：`README.md`, `attack.cpp`, `hdr.h`, `main.cpp`, `misc.cpp`。
*   `README.md`: 描述了工具的使用方法。没有发现恶意代码。
*   `attack.cpp`: 包含`local`和`remote`函数，分别用于在目标服务器上进行本地文件复制和将本地文件内容上传到目标服务器并进行复制。 `remote`函数存在一定的风险，它会将本地文件内容复制到服务器，并尝试将此内容作为文件名进行复制，如果本地文件内容包含恶意指令，可能会存在命令注入风险。但是，主要功能是利用漏洞进行文件读写，没有明显的恶意后门代码，因此，投毒风险较低，估计为10%。这个10%的风险来源于remote函数对本地文件内容的直接使用，可能被利用进行进一步的攻击。
*   `hdr.h`: 包含头文件和函数声明，没有发现恶意代码。
*   `main.cpp`: 程序的入口点，解析命令行参数并调用相应的函数。没有发现恶意代码。
*   `misc.cpp`: 包含网络连接函数，没有发现恶意代码。

虽然代码本身主要是利用已知的漏洞，但`remote`函数中存在潜在的风险，即如果恶意用户构造包含恶意代码的文件并利用此工具上传，可能会在服务器上执行任意命令。但这更多是漏洞利用方式本身的风险，而非代码作者故意植入的后门。

**利用方式:**
利用该漏洞的攻击者可以通过以下步骤进行攻击：
1.  使用`SITE CPFR`命令指定要复制的源文件路径。
2.  使用`SITE CPTO`命令指定要复制的目标文件路径。
如果mod_copy模块没有正确验证文件路径，攻击者可以读取或写入ProFTPD服务器上的任何文件。`remote`函数还允许攻击者将本地文件内容上传到服务器并进行复制，从而实现更高级的攻击，例如覆盖配置文件或执行任意代码。

**项目地址:** [jptr218/proftpd_bypass](https://github.com/jptr218/proftpd_bypass)

**漏洞详情:** [CVE-2015-3306](https://nvd.nist.gov/vuln/detail/CVE-2015-3306)