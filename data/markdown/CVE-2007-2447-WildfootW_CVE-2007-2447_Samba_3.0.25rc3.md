## CVE-2007-2447 - Samba usermap script命令注入

**漏洞编号:** CVE-2007-2447

**漏洞类型:** 命令注入

**影响应用:** Samba

**危害等级:** 高危，允许远程攻击者执行任意命令

**影响版本:** 3.0.0 through 3.0.25rc3, 3.0.20 through 3.0.25rc3

**利用条件:** 目标Samba服务器启用了 'username map script' 选项，且攻击者能够访问Samba服务。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2007-2447 存在于Samba的MS-RPC功能中。当启用了 'username map script' 配置时，通过 `SamrChangePassword` 函数可以利用此漏洞。攻击者可以通过SMB协议，利用特制的用户名（包含shell元字符），执行任意命令。提供的PoC代码利用了这一漏洞，构建包含反弹shell命令的用户名，并尝试连接到目标SMB服务器，触发命令执行。

**有效性:**
根据漏洞描述和PoC代码，该漏洞利用是有效的。PoC通过构造包含shell命令的用户名尝试连接目标服务器，若目标服务器存在漏洞，将导致命令执行。

**投毒风险:**
分析了提供的PoC代码，包括 `56dcf.py` 和 `74371.py`。代码的目的是利用CVE-2007-2447漏洞在目标系统上执行命令，建立反向连接。没有发现明显的恶意代码或后门植入行为。代码的功能与漏洞利用的描述一致，即通过Samba服务执行指定的shell命令。

**利用方式:**
1.  攻击者需要确定目标Samba服务器的版本在受影响的范围内 (3.0.0 - 3.0.25rc3, 3.0.20 - 3.0.25rc3)。
2.  目标服务器必须启用 `username map script` 选项。
3.  攻击者需要构造包含恶意shell命令的用户名。
4.  使用SMB协议连接到目标服务器，触发 `SamrChangePassword` 或其他MS-RPC函数调用 `username map script`。
5.  服务器执行shell命令，例如反弹shell到攻击者的机器。

**项目地址:** [WildfootW/CVE-2007-2447_Samba_3.0.25rc3](https://github.com/WildfootW/CVE-2007-2447_Samba_3.0.25rc3)

**漏洞详情:** [CVE-2007-2447](https://nvd.nist.gov/vuln/detail/CVE-2007-2447)