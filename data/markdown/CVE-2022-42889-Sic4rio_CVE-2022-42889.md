## CVE-2022-42889-Apache Commons Text-RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** 1.5 <= version <= 1.9

**利用条件:** 应用程序使用受影响的 Apache Commons Text 版本，且允许用户可控的输入传递给 Commons Text 的文本插值功能。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-42889 (Text4Shell) 是 Apache Commons Text 库中的一个远程代码执行漏洞。该漏洞源于库中的变量插值功能，允许攻击者通过构造恶意输入，利用`script`, `dns`, 和 `url` 等 StringLookup 实现执行任意代码或与远程服务器进行交互。 

**有效性：**

根据漏洞信息、搜索结果和提供的POC代码，此漏洞利用是有效的。搜索结果中多个链接（例如：[webpage 1], [webpage 2], [webpage 4], [webpage 6], [webpage 9]）都表明此漏洞是远程代码执行漏洞，且危害严重。POC代码通过 `${script:javascript:java.lang.Runtime.getRuntime().exec(...) }` 构造恶意payload，利用 `script` StringLookup 执行系统命令，验证了漏洞的存在。

**投毒风险：**

提供的python POC代码主要功能是发送包含恶意payload的HTTP请求，payload会利用目标服务器上的java环境来执行命令。投毒代码分析如下：
*   代码的功能相对清晰，主要是构造payload发送请求，执行反弹shell。
*   风险点在于 `busybox nc` 命令，攻击者可能通过修改 IP 地址和端口来连接受害者的机器，但这是漏洞利用本身需要的，不能算是作者特意植入的后门。
*   虽然使用了`verify=False` 绕过了ssl证书校验，但这是为了方便测试自签名证书的情况，也属于正常情况。
*   代码中存在TerminalColors类，为输出添加颜色。这部分代码不会影响payload的执行，可以认为是正常的。

总体来看，代码本身并没有明显的恶意行为，但使用者需要注意，在未授权的情况下使用此脚本进行攻击属于非法行为。因此，投毒风险评估为5%。

**利用方式：**

1.  **确定目标：** 确定目标应用程序使用了存在漏洞的 Apache Commons Text 版本（1.5 到 1.9）。
2.  **构造Payload：**  构造包含恶意代码的字符串，利用`${prefix:name}` 格式进行变量插值。其中，`prefix` 可以是 `script`、`dns` 或 `url` 等，利用这些 StringLookup 实现执行命令或访问远程资源。
3.  **发送请求：**  将构造的恶意字符串作为输入，通过HTTP请求或其他方式发送给目标应用程序。该输入需要到达使用 Apache Commons Text 进行插值处理的地方。
4.  **执行代码：**  如果目标应用程序存在漏洞，Apache Commons Text 会解析恶意字符串，执行其中的代码。
5.  **反弹shell：**  POC中使用 `busybox nc` 命令反弹 shell，攻击者可以控制目标系统。

**项目地址:** [Sic4rio/CVE-2022-42889](https://github.com/Sic4rio/CVE-2022-42889)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)