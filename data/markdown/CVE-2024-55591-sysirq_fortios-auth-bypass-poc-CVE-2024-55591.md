## CVE-2024-55591-FortiOS/FortiProxy-认证绕过

**漏洞编号:** CVE-2024-55591

**漏洞类型:** 认证绕过

**影响应用:** FortiOS/FortiProxy

**危害等级:** 高危，可能导致超级管理员权限获取

**影响版本:** FortiOS 7.0.0 through 7.0.16, FortiProxy 7.0.0 through 7.0.19 and 7.2.0 through 7.2.12

**利用条件:** 目标设备开启WebSocket服务，且存在于受影响版本范围内。

**POC 可用性:** 是

**投毒风险:** 20%

## 详情

CVE-2024-55591是一个影响FortiOS和FortiProxy的认证绕过漏洞。攻击者可以通过构造特殊的请求到Node.js websocket模块绕过身份验证，获取超级管理员权限。根据漏洞信息和搜索结果，此漏洞危害极大，且已被积极利用。

**有效性：**
提供的POC代码尝试利用websocket协议与目标建立连接，并发送特定格式的请求。代码中包含websocket握手过程的实现（生成key、验证accept key），以及发送和接收websocket frame的函数。POC代码中使用了`local_access_token=a5a5a5a5a5a5adasda8sd8sd8ewerfgfg`，这很可能是漏洞利用的关键参数，用于绕过认证。

**投毒风险：**
代码总体结构清晰，主要功能集中在websocket连接建立和数据交互上。潜在的投毒风险点在于：

1.  **依赖库篡改：** 代码使用了requests, pwn等库，如果这些库被篡改，可能引入恶意代码。
2.  **HOST变量：** HOST变量硬编码了目标IP，如果攻击者将HOST修改为恶意IP，可能导致受害者连接到错误的服务器。
3.  **`local_access_token`值：** 此值如果被替换为其他值,可能导致利用失败或者其他问题.但从代码本身来看，并不直接包含后门代码，只是攻击利用的有效载荷.如果poc作者将此payload做了记录,可能会造成一定的风险.

总体来说，投毒风险较低，主要集中在依赖库和变量被篡改的可能性上。**因此，投毒风险评估为20%。**

**利用方式：**
1.  **建立WebSocket连接：** POC首先尝试与目标设备的WebSocket服务建立SSL连接。
2.  **发送握手请求：**  发送包含特定`Sec-WebSocket-Key`的HTTP GET请求，尝试升级协议为WebSocket。
3.  **认证绕过：** 在WebSocket握手请求的URL中包含`local_access_token=a5a5a5a5a5a5adasda8sd8sd8ewerfgfg`，利用此参数绕过认证。
4.  **数据交互：**  如果握手成功，则可以发送和接收WebSocket frame，执行进一步的攻击操作，如发送恶意命令或获取敏感信息。

根据搜索结果，此漏洞已经被野外利用，攻击者利用此漏洞可以获取FortiOS/FortiProxy设备的超级管理员权限。

**项目地址:** [sysirq/fortios-auth-bypass-poc-CVE-2024-55591](https://github.com/sysirq/fortios-auth-bypass-poc-CVE-2024-55591)

**漏洞详情:** [CVE-2024-55591](https://nvd.nist.gov/vuln/detail/CVE-2024-55591)