## CVE-2007-2447 - Samba 命令注入

**漏洞编号:** CVE-2007-2447

**漏洞类型:** 命令注入

**影响应用:** Samba

**危害等级:** 高危，允许远程攻击者执行任意命令

**影响版本:** 3.0.0 到 3.0.25rc3

**利用条件:** 需要目标系统运行存在漏洞的Samba版本，且可能需要启用 'username map script' 配置或利用其他 MS-RPC 功能。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2007-2447漏洞存在于Samba的smbd服务中，版本范围为3.0.0到3.0.25rc3。攻击者可以通过MS-RPC功能，利用shell元字符注入执行任意命令。根据漏洞描述，以下三种情况可能存在漏洞：（1）当启用了 'username map script' smb.conf选项时，通过SamrChangePassword函数。（2）通过远程打印机管理中的MS-RPC函数。（3）通过文件共享管理中的MS-RPC函数。

漏洞利用代码（CVE-2007-2447.py）通过构造包含shell元字符的用户名，尝试连接到目标SMB服务。如果目标系统存在漏洞且配置满足条件，则Samba服务器会执行注入的命令。该POC代码提供两种利用方式：一是通过指定lhost和lport参数，反弹shell到攻击者控制的机器；二是通过-c参数，执行自定义的命令。从代码本身来看，没有发现明显的投毒代码。

根据搜索引擎结果，多个来源确认了该漏洞的存在和危害。cvedetails.com表明该漏洞利用需要username map script配置，但其他途径的利用也是可行的。

综合来看，提供的POC代码是有效的，可以用于验证和利用CVE-2007-2447漏洞。鉴于该漏洞可能导致远程命令执行，应及时修补Samba服务器。

**项目地址:** [xbufu/CVE-2007-2447](https://github.com/xbufu/CVE-2007-2447)

**漏洞详情:** [CVE-2007-2447](https://nvd.nist.gov/vuln/detail/CVE-2007-2447)