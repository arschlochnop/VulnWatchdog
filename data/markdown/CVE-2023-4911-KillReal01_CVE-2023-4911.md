## CVE-2023-4911 Glibc ld.so 本地提权漏洞

**漏洞编号:** CVE-2023-4911

**漏洞类型:** 缓冲区溢出

**影响应用:** Glibc

**危害等级:** 高危，本地提权

**影响版本:** 2.34 <= version < 2.39

**利用条件:** 需要本地用户权限，目标系统glibc版本在受影响范围内，需要存在SUID权限的程序。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2023-4911 漏洞存在于 GNU C Library (glibc) 的动态链接器 ld.so 中，由于处理 GLIBC_TUNABLES 环境变量时存在缓冲区溢出。攻击者可以利用精心构造的 GLIBC_TUNABLES 环境变量，在启动具有 SUID 权限的二进制文件时执行任意代码，从而获得提升的权限。

**漏洞利用方式：**

1.  **环境变量操控：** 攻击者设置 `GLIBC_TUNABLES` 环境变量，该变量包含精心构造的字符串，用于触发缓冲区溢出。
2.  **SUID 程序执行：** 攻击者执行一个具有 SUID 权限的程序（例如 `/usr/bin/su`）。当程序启动时，`ld.so` 会加载并处理 `GLIBC_TUNABLES` 环境变量。
3.  **缓冲区溢出：** 由于 `ld.so` 在处理 `GLIBC_TUNABLES` 环境变量时存在缓冲区溢出漏洞，攻击者构造的字符串会覆盖内存中的其他数据，例如返回地址或者其他重要数据。
4.  **代码执行：** 通过覆盖返回地址，攻击者可以控制程序的执行流程，跳转到攻击者预先准备好的代码（通常是 shellcode），从而获得提升的权限。

**POC 代码分析：**

*   `Makefile`: 用于编译exp.c 生成exploit程序,通过python3 gen_libc.py生成假的libc.so.6，并将其放置到 "/libc.so.6 目录，方便控制程序的加载。
*   `exp.c`: 这是漏洞利用的主要代码。它构造恶意的 `GLIBC_TUNABLES` 环境变量，并使用 `execve` 函数启动 `/usr/bin/su` 程序。程序设置了大量的环境变量，以及栈大小，通过fork调用execve来增大成功率。
*   `gen_libc.py`,`patch_libc.c`: 代码不全,无法分析作用

**有效性评估：**

根据漏洞描述和 POC 代码的分析，提供的 POC 代码是有效的。该代码展示了如何利用 `GLIBC_TUNABLES` 环境变量触发缓冲区溢出，并执行代码以获得提升的权限。

**投毒风险评估：**

该仓库中可能存在作者隐藏的投毒代码的风险较低，约为 1%。虽然 `patch_libc.c`和`gen_libc.py`无法提供完整内容，但是其他的代码逻辑是符合漏洞利用的逻辑，可能存在通过替换恶意lib，进行恶意提权，但是概率较小。

**项目地址:** [KillReal01/CVE-2023-4911](https://github.com/KillReal01/CVE-2023-4911)

**漏洞详情:** [CVE-2023-4911](https://nvd.nist.gov/vuln/detail/CVE-2023-4911)