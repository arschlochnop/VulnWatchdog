## CVE-2024-32462-Flatpak-SandboxEscape

**漏洞编号:** CVE-2024-32462

**漏洞类型:** 沙箱逃逸

**影响应用:** Flatpak

**危害等级:** 高危，可能导致沙箱逃逸，在宿主机上执行任意代码

**影响版本:** < 1.10.9, >= 1.12.0 < 1.12.9, >= 1.14.0 < 1.14.6, >= 1.15.0 < 1.15.8

**利用条件:** 需要在受影响版本的Flatpak环境中运行恶意Flatpak应用。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-32462 是一个 Flatpak 沙箱逃逸漏洞。攻击者可以构造恶意的 `org.freedesktop.portal.Background.RequestBackground` portal 请求，通过参数注入的方式，将 `--bind` 等 bwrap 参数传递给 `flatpak run` 命令，从而逃逸沙箱。

**漏洞利用方式：**

1.  攻击者创建一个恶意的 Flatpak 应用，该应用包含利用漏洞的代码。
2.  该应用使用 `org.freedesktop.portal.Background.RequestBackground` portal 接口请求后台权限。
3.  在请求中，`commandline` 参数被构造为包含 bwrap 参数，例如 `--bind / /hostroot`。
4.  Flatpak 在处理该请求时，会将恶意参数传递给 bwrap，导致沙箱逃逸。
5.  逃逸后，攻击者可以在宿主机上执行任意代码，例如读取敏感文件（/etc/passwd）或执行系统命令。

**POC 代码分析：**

提供的 POC 代码包含以下文件：

*   `README.md`: 漏洞描述。
*   `exploit.desktop`: 桌面入口文件，用于启动利用程序。
*   `exploit.py`: Python 脚本，利用漏洞的代码。该脚本使用 `dbus` 库与 portal 接口交互，构造恶意的 `commandline` 参数。
*   `org.exploit.SandboxEscape.yaml`: Flatpak 应用程序的清单文件。

`exploit.py` 脚本的核心是构造包含 `--bind` 参数的 `commandline` 数组，并将其传递给 `org.freedesktop.portal.Background.RequestBackground` portal 接口。这样，当 Flatpak 启动该应用时，`--bind / /hostroot` 参数会被传递给 bwrap，将宿主机的根目录挂载到沙箱内的 `/hostroot` 目录，从而实现沙箱逃逸。后续脚本会尝试读取 `/hostroot/etc/passwd`，验证逃逸是否成功。

**投毒风险分析：**

检查提供的 POC 代码，没有发现明显的投毒代码。该代码的功能是利用 CVE-2024-32462 漏洞进行沙箱逃逸，并通过读取 `/etc/passwd` 文件来验证漏洞。代码没有执行任何恶意操作，例如安装后门、上传数据等。因此，可以认为该 POC 代码不包含投毒风险。

**项目地址:** [SpiralBL0CK/CVE-2024-32462](https://github.com/SpiralBL0CK/CVE-2024-32462)

**漏洞详情:** [CVE-2024-32462](https://nvd.nist.gov/vuln/detail/CVE-2024-32462)