## CVE-2023-30258-MagnusBilling-命令注入

**漏洞编号:** CVE-2023-30258

**漏洞类型:** 命令注入

**影响应用:** MagnusBilling

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 6.x and 7.x

**利用条件:** 目标系统运行MagnusBilling 6.x或7.x版本，且攻击者可以发起未认证的HTTP请求。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2023-30258是一个存在于MagnusBilling 6.x和7.x版本的命令注入漏洞。未经身份验证的远程攻击者可以通过发送特制的HTTP请求来执行任意操作系统命令。

**有效性:**
根据漏洞库信息和搜索引擎结果，此漏洞允许未授权的远程命令执行，危害极大。提供的PoC代码 `poc.py` 验证了这一点。PoC代码通过向 `lib/icepay/icepay.php` 接口发送包含恶意命令的请求来触发漏洞。代码使用 `requests.utils.quote` 函数对命令进行URL编码，防止特殊字符干扰，然后通过GET请求发送到目标URL。

**投毒风险:**
PoC代码本身结构简单，主要功能是发送HTTP请求并根据响应时间判断命令是否执行成功。代码中包含 `sleep 2` 语句，用于检测命令执行情况。没有发现明显的恶意代码或者后门，但是使用该脚本可能存在一些潜在风险。需要注意的一点是，PoC代码的作者信息标明日期是未来的日期（2025年），这可能需要引起警惕。但是综合代码功能来看，投毒风险较低。因此评估投毒风险为1%。

**利用方式:**
1.  确定目标系统正在运行受影响的MagnusBilling版本（6.x或7.x）。
2.  使用PoC脚本（`poc.py`）或类似工具，构造包含恶意命令的HTTP GET请求。
3.  将构造的请求发送到目标URL的 `lib/icepay/icepay.php` 接口，通过 `democ` 参数传递经过URL编码的命令。
4.  观察响应时间和结果，验证命令是否执行成功。

利用该漏洞的根本原因在于MagnusBilling的代码中未对用户提供的输入进行充分的验证和过滤，导致攻击者可以通过构造恶意的输入来执行任意的系统命令。

**项目地址:** [n00o00b/CVE-2023-30258-RCE-POC](https://github.com/n00o00b/CVE-2023-30258-RCE-POC)

**漏洞详情:** [CVE-2023-30258](https://nvd.nist.gov/vuln/detail/CVE-2023-30258)