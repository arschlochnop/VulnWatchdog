## CVE-2025-21756-Linux Kernel vsock Use-After-Free

**漏洞编号:** CVE-2025-21756

**漏洞类型:** Use-After-Free

**影响应用:** Linux Kernel

**危害等级:** 高危，可能导致本地权限提升

**影响版本:** Linux Kernel 5.5之前及多个5.x、6.x版本的中间版本 (具体参考漏洞库信息)

**利用条件:** 需要本地用户权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2025-21756 是 Linux kernel vsock (Virtual Socket) 实现中的一个 Use-After-Free 漏洞。攻击者可以通过不当的 socket unbinding 时序触发该漏洞，导致释放后的内存被再次访问，从而可能实现本地权限提升。

**漏洞分析：**
漏洞源于 `vsock_remove_bound` 函数在 transport reassignment 期间没有检查 socket 是否已绑定并移至绑定列表。当 `vsock_bind` 假设 socket 位于 unbound 列表时，`__vsock_insert_bound` 尝试调用 `__vsock_remove_bound`，导致对已释放的 socket 对象执行操作。

**利用方式：**
1.  创建一个 vsock socket。
2.  触发 transport 的 release 操作，这会导致 `vsock_remove_bound` 被调用，但 socket 仍然被认为是 unbound。
3.  调用 `vsock_bind`，此时 `__vsock_remove_bound` 会尝试删除一个已经释放的 socket，导致 Use-After-Free。

根据提供的漏洞利用代码，该POC主要分为两部分：KASLR 绕过和漏洞利用。`entrybleed.c` 使用侧信道攻击来泄露内核基地址，绕过 KASLR。泄露内核基址后，可以利用该地址构造ROP链或者直接修改内核数据，从而实现提权。提供的 `README.md` 说明该利用基于 [Michael Hoefler's writeup](https://hoefler.dev/articles/vsock.html)，并指出exploit的spray步骤有所不同。说明该漏洞已经有公开的分析文章，更容易利用。 `extract-image.sh` 是一个辅助脚本，用于从内核镜像中提取未压缩的 vmlinux，可能用于静态分析或者调试。

**有效性评估：**
根据漏洞库信息和搜索结果，该漏洞是一个已确认的 Linux kernel Use-After-Free 漏洞，并且存在利用代码，所以判断提供的POC代码有效。

**投毒风险评估：**
虽然POC代码包含一个 `flag` 文件，这更像是CTF的题目配置，并不代表投毒。`entrybleed.c` 看起来是用于泄露内核基地址，没有明显的恶意行为。`compile.sh` 只是编译脚本。 `local_runner.sh` 主要作用是设置运行环境，看起来没有植入恶意代码。 总体来看，代码仓库没有明显的投毒行为。风险主要在于漏洞本身可能被用于恶意目的。考虑到作者在 `README.md` 中提到了与原始利用的不同之处（spray step），存在作者修改了原始利用，插入恶意代码的可能性，但是概率较低，故评估投毒风险为10%。

**项目地址:** [khoatran107/cve-2025-21756](https://github.com/khoatran107/cve-2025-21756)

**漏洞详情:** [CVE-2025-21756](https://nvd.nist.gov/vuln/detail/CVE-2025-21756)