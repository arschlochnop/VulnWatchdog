## CVE-2020-7378-OpenCRX-Unverified Password Change

**漏洞编号:** CVE-2020-7378

**漏洞类型:** 未经验证的密码更改

**影响应用:** OpenCRX

**危害等级:** 高危，允许未经授权的密码重置，可能导致账户接管。

**影响版本:** <= 4.30, <= 5.0-20200717

**利用条件:** 需要能够访问 OpenCRX 实例的网络连接。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2020-7378 是 OpenCRX 中的一个未经验证的密码更改漏洞。攻击者可以通过向 `RequestPasswordReset.jsp` 发送包含目标用户 ID 的 POST 请求，然后使用生成的 token 向`PasswordResetConfirm.jsp`发送密码修改请求，从而无需任何凭据即可更改任何用户的密码，包括管理员帐户。提供的 POC 代码 `opencrx-reset-spray.py` 利用了此漏洞。它首先通过发送 POST 请求到 `RequestPasswordReset.jsp` 来触发密码重置流程，然后使用 `OpenCRXToken.java` 生成可能的 token，并使用这些 token 尝试更改目标用户的密码。

**漏洞利用方式：**

1.  **请求密码重置：** 攻击者提供目标用户 ID，脚本向 `RequestPasswordReset.jsp` 发送请求，触发密码重置邮件的发送（即使邮件可能未实际发送，但服务器内部会生成 token）。
2.  **时间戳获取：** 脚本通过在请求前后获取时间戳，确定 token 生成的起始时间范围。
3.  **Token 生成：** 脚本使用 Java 程序 `OpenCRXToken.java`，基于起始时间戳范围生成一系列可能的 token。`OpenCRXToken.java` 通过 `seed` 值生成伪随机字符串，`seed` 来源于起始时间戳范围。
4.  **密码重置尝试：** 脚本将生成的 token 与新的密码一起，发送到 `PasswordResetConfirm.jsp`，尝试重置目标用户的密码。

**有效性评估：**
根据漏洞描述和提供的 POC 代码，该 POC 代码是有效的，因为它能够利用未经验证的密码更改漏洞来重置用户的密码。

**投毒风险分析：**
仔细检查了 `opencrx-reset-spray.py` 和 `OpenCRXToken.java` 的代码，没有发现任何明显的投毒代码。代码的功能与描述相符，主要用于生成 token 并尝试密码重置。`OpenCRXToken.java` 的作用是生成随机字符串，`opencrx-reset-spray.py` 则负责发送请求和处理响应。两个脚本都没有执行任何恶意操作，例如植入后门或窃取数据。因此，可以认为此仓库中不存在作者隐藏的投毒代码。

根据Rapid7的报告，禁用`RequestPasswordReset.jsp`是缓解措施。

**项目地址:** [loganpkinfosec/CVE-2020-7378](https://github.com/loganpkinfosec/CVE-2020-7378)

**漏洞详情:** [CVE-2020-7378](https://nvd.nist.gov/vuln/detail/CVE-2020-7378)