## CVE-2024-3400 PAN-OS GlobalProtect 远程命令执行

**漏洞编号:** CVE-2024-3400

**漏洞类型:** 远程命令执行

**影响应用:** PAN-OS GlobalProtect

**危害等级:** 高危，未授权攻击者可利用此漏洞以 root 权限执行任意代码

**影响版本:** PAN-OS 10.2.0 < 10.2.9-h1, PAN-OS 11.0.0 < 11.0.4-h1, PAN-OS 11.1.0 < 11.1.2-h3

**利用条件:** 目标系统需启用 GlobalProtect 网关或门户，无需身份验证

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-3400 是 Palo Alto Networks PAN-OS GlobalProtect 功能中的一个命令注入漏洞，源于任意文件创建。未经身份验证的远程攻击者可以通过构造特定的请求，利用此漏洞在受影响的防火墙上以 root 权限执行任意代码。漏洞影响启用了 GlobalProtect 网关或门户的 PAN-OS 10.2、11.0 和 11.1 的特定版本。\n\n**有效性：**\n根据漏洞库信息和搜索结果，CVE-2024-3400 漏洞已被积极利用，并且存在公开可用的PoC。提供的 Python 脚本旨在检查 Palo Alto Networks 设备的 tech support 文件中是否存在 CVE-2024-3400 攻击的迹象，它本身并非利用代码，而是用于检测受害者是否已经被攻击。所以此POC代码不直接体现漏洞的利用,而是在侧面验证漏洞是否被利用,存在一定的有效性。\n\n**投毒风险：**\n提供的Python脚本用于分析日志文件，搜索恶意行为的迹象。该脚本主要功能是解压和搜索指定的日志文件（'md_out.log', 'md_out.log.old', 'gpsvc.log'）中是否存在特定的恶意关键词（'wget', 'bash', 'device_telemetry/minute/', 'unmarshal'）。\n\n*   **投毒点分析：**
    * 脚本本身不包含直接的恶意代码或后门，其主要功能是文件解压和字符串搜索，风险较低。
    *  **误报风险:**  脚本依赖于预定义的`search_terms`列表，如果该列表被篡改，例如添加了常见的正常字符串，可能导致大量的误报，降低脚本的可用性。
    * **依赖库风险:** 脚本依赖于Python的`gzip`和`tarfile`库，如果这些库本身存在漏洞，可能被利用。但这是所有Python脚本的通用风险。
    * **文件路径风险:** 脚本需要用户指定`filepath`变量，如果用户指定了错误的或恶意的`.tar.gz`文件，可能导致脚本分析错误的文件，并给出错误的结论。
    * **代码缺陷:** return使用不当,会导致未能完全检查文件。\n\n总的来说，该脚本的投毒风险较低，主要的风险在于被篡改的`search_terms`列表可能导致误报。因此，投毒风险评估为10%。\n\n**利用方式：**\n根据漏洞描述和搜索结果，攻击者利用 CVE-2024-3400 的方式如下：\n1.  **构造恶意请求：**  攻击者构造包含恶意命令的特定请求，发送到启用了 GlobalProtect 的 PAN-OS 设备。\n2.  **利用任意文件创建漏洞：**  该请求触发了 PAN-OS 中的任意文件创建漏洞，允许攻击者在系统上创建恶意文件。\n3.  **命令注入：**  创建的恶意文件被执行，从而实现命令注入，允许攻击者以 root 权限执行任意代码。\n4.  **完全控制：**  成功利用该漏洞后，攻击者可以完全控制受影响的防火墙设备。

**项目地址:** [terminalJunki3/CVE-2024-3400-Checker](https://github.com/terminalJunki3/CVE-2024-3400-Checker)

**漏洞详情:** [CVE-2024-3400](https://nvd.nist.gov/vuln/detail/CVE-2024-3400)