## CVE-2024-3400 PAN-OS GlobalProtect 命令注入

**漏洞编号:** CVE-2024-3400

**漏洞类型:** 命令注入

**影响应用:** PAN-OS GlobalProtect

**危害等级:** 高危，未经身份验证的攻击者可以root权限执行任意代码

**影响版本:** PAN-OS 10.2.0 < 10.2.9-h1, PAN-OS 11.0.0 < 11.0.4-h1, PAN-OS 11.1.0 < 11.1.2-h3

**利用条件:** 目标系统配置了GlobalProtect gateway或GlobalProtect portal，且运行受影响的PAN-OS版本。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-3400是Palo Alto Networks PAN-OS软件GlobalProtect功能中的一个命令注入漏洞。该漏洞源于任意文件创建，允许未经身份验证的远程攻击者在防火墙上以root权限执行任意代码。

**有效性分析：**

*   漏洞库信息明确指出该漏洞影响特定版本的PAN-OS，并且Palo Alto Networks已经意识到有越来越多的攻击利用此漏洞。同时，第三方已经公开了PoC。
*   搜索引擎结果也显示，该漏洞已被广泛关注，并有相关的威胁情报和检测方法发布。
*   提供的PoC代码包含一个Bash脚本和一个Nuclei模板，可以用于验证漏洞的存在。

**利用方式：**

1.  **0-Byte File Creation (CVE-2024-3400.sh):**
    *   攻击者使用`curl`命令向目标服务器的`/ssl-vpn/hipreport.esp`发送一个POST请求，并在Cookie中设置`SESSID`为恶意路径，尝试在`/var/appweb/sslvpndocs/global-protect/portal/images/`目录下创建一个0字节的`CVE20243400.txt`文件。
    *   脚本验证文件是否成功创建，如果服务器返回200 OK，则认为创建成功。
    *   然后，脚本尝试访问创建的文件，如果服务器返回403 Forbidden，则表明目标服务器存在漏洞。

2.  **OS Command Injection (CVE20243400.yaml):**
    *   该Nuclei模板使用多个POST请求，在Cookie中设置恶意的`SESSID`值，目标路径为`/../../../opt/panlogs/tmp/device_telemetry/minute/`，通过命令注入执行`curl`命令，将目标系统的`uname`或`hostname`信息发送到攻击者的`interactsh`服务器，从而验证是否存在命令注入漏洞。

**投毒风险分析：**

虽然提供的代码主要目的是为了验证漏洞，但仍然存在轻微的投毒风险：

*   **依赖外部资源:** Nuclei模板依赖于攻击者控制的`interactsh`服务器。如果攻击者恶意地将`interactsh`配置为执行某些恶意操作（比如记录受害者的IP地址并进行后续攻击），则可能存在风险。此风险评估为10%。
*   **脚本下载:**  虽然本分析直接提供了漏洞利用脚本内容，但在实际情况中，攻击者可能提供脚本下载链接，如果脚本被篡改，则可能存在风险。

**总结：**

提供的PoC代码是有效的，可以用于验证CVE-2024-3400漏洞。利用方式主要是通过构造恶意的HTTP请求，利用任意文件创建漏洞实现命令注入，从而在目标系统上执行任意代码。 尽管代码本身主要是漏洞验证，但是仍然存在一些投毒风险，需要谨慎使用。

**项目地址:** [schooldropout1337/CVE-2024-3400](https://github.com/schooldropout1337/CVE-2024-3400)

**漏洞详情:** [CVE-2024-3400](https://nvd.nist.gov/vuln/detail/CVE-2024-3400)