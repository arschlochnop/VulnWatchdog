## CVE-2018-7600-Drupalgeddon 2

**漏洞编号:** CVE-2018-7600

**漏洞类型:** 远程代码执行

**影响应用:** Drupal

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** Drupal before 7.58, 8.x before 8.3.9, 8.4.x before 8.4.6, and 8.5.x before 8.5.1

**利用条件:** Drupal网站允许未授权用户访问用户注册页面或其他类似的form API接口

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2018-7600 (Drupalgeddon 2) 允许未经身份验证的远程攻击者在受影响的Drupal网站上执行任意代码。漏洞存在于 Drupal 的 Form API 中，通过构造特定的POST请求，可以绕过输入验证，导致代码执行。

**有效性：**
根据漏洞库信息、搜索结果和提供的POC代码，可以确认此漏洞利用是有效的。大量资料表明该漏洞已被广泛利用。

**投毒风险：**
分析提供的文件，包括`README.md`, `README.zh-cn.md`, 和 `docker-compose.yml`。这些文件主要包含漏洞描述、环境搭建说明和POC使用方法。`docker-compose.yml` 文件指定了使用 `vulhub/drupal:8.5.0` 镜像，这个镜像本身如果存在后门，可能导致投毒。此外，虽然直接的恶意代码在提供的文件中未发现，但由于攻击者能够执行任意代码，意味着他们完全有可能在目标系统上植入后门或其他恶意程序。

因此，该仓库本身直接包含投毒代码的可能性较低，但通过漏洞利用植入后门的可能性非常高，综合判断投毒风险为10%。

**利用方式：**
1.  **环境搭建：** 使用`docker-compose up -d`命令启动一个包含漏洞的Drupal环境(例如8.5.0版本)。
2.  **发送恶意请求：** 向`/user/register`或其他类似的 form API 接口发送精心构造的POST请求。该请求包含以下关键参数：
    *   `element_parents`: 用于指定表单元素路径，绕过访问控制。
    *   `ajax_form=1`: 触发 Drupal 的 AJAX 处理机制。
    *   `_wrapper_format=drupal_ajax`:  指定响应格式为 Drupal AJAX。
    *   `mail[#post_render][]`:  利用`#post_render`属性执行PHP函数（例如`exec`）。
    *   `mail[#type]=markup`:  将`mail`字段类型设置为markup，允许插入HTML代码。
    *   `mail[#markup]`:  包含要执行的命令（例如`id`）。
3.  **代码执行：** Drupal 在处理该请求时，会执行`mail[#markup]`中指定的命令，从而实现远程代码执行。

**项目地址:** [Dowonkwon/drupal-cve-2018-7600-poc](https://github.com/Dowonkwon/drupal-cve-2018-7600-poc)

**漏洞详情:** [CVE-2018-7600](https://nvd.nist.gov/vuln/detail/CVE-2018-7600)