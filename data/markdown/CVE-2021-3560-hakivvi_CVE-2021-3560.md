## CVE-2021-3560 - polkit 权限提升

**漏洞编号:** CVE-2021-3560

**漏洞类型:** 权限提升

**影响应用:** polkit

**危害等级:** 高危，允许本地非特权用户获得root权限

**影响版本:** polkit 0.119

**利用条件:** 本地用户访问，目标系统安装受影响版本的polkit

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-3560 是 polkit 中的一个认证绕过漏洞。该漏洞源于 `polkit_system_bus_name_get_creds_sync` 函数在获取调用者的 UID 和 PID 时存在缺陷。当调用 `GetConnectionUnixUser` 和 `GetConnectionUnixProcessID` 方法时，即使发生错误，`data.uid` 和 `data.pid` 仍然可能保持为初始化的零值。由于 polkit 认为 UID 为 0 的用户是 root 用户，因此可以绕过权限检查，从而允许非特权用户执行特权操作。

**有效性分析：**
根据提供的漏洞信息、搜索结果和漏洞利用代码，此漏洞利用是有效的。漏洞库信息明确指出该漏洞允许权限提升，并且CISA已将其添加到已知被利用的漏洞目录中。搜索引擎结果中也存在大量关于此漏洞的描述和利用方法。提供的POC代码描述了利用此漏洞的详细过程，包括利用D-Bus调用`CreateUser`和`SetPassword`等特权方法创建具有root权限的用户。

**投毒风险分析：**
提供的POC代码主要是C代码的解释和利用方法的描述，以及一些调用D-Bus的命令示例。从readme文件来看，它旨在通过accountsservice创建和设置密码来提升权限。虽然没有发现明显的恶意代码，但任何下载和编译的第三方代码都存在一定的风险。此外，攻击者可能修改漏洞利用代码，例如更改创建的用户名，使其更具隐蔽性或恶意性。例如，可以将用户名设置成和系统服务名称类似，以此来混淆管理员的视线。

**利用方式分析：**
1.  利用 D-Bus 向 polkit 发送特权方法调用请求（如 accountsservice 提供的 `CreateUser` 和 `SetPassword`）。
2.  利用漏洞绕过 polkit 的认证检查。
3.  polkit 错误地将非特权用户识别为 root 用户，从而允许执行特权方法。
4.  攻击者通过创建具有 root 权限的用户或修改现有用户的密码来获得系统控制权。

**投毒风险评估百分比：**
虽然README.md中提供的代码片段本身没有明显的恶意代码，但考虑到任何第三方提供的未经验证的代码都存在潜在风险，因此投毒风险评估为10%。 这个数值表示作者可能在完整代码或编译过程中隐藏恶意行为，但目前的代码片段本身看起来是合法的漏洞利用。

**项目地址:** [hakivvi/CVE-2021-3560](https://github.com/hakivvi/CVE-2021-3560)

**漏洞详情:** [CVE-2021-3560](https://nvd.nist.gov/vuln/detail/CVE-2021-3560)