## CVE-2018-15473 OpenSSH 用户枚举漏洞

**漏洞编号:** CVE-2018-15473

**漏洞类型:** 用户枚举

**影响应用:** OpenSSH

**危害等级:** 中危，可为后续攻击提供用户名信息

**影响版本:** <= 7.7

**利用条件:** 需要目标主机开放SSH端口

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2018-15473 漏洞是 OpenSSH 7.7 及更早版本中存在的一个用户枚举漏洞。由于 OpenSSH 在完全解析包含请求的数据包之前，不会延迟无效身份验证用户的退出，导致可以通过时间差判断用户是否存在。

**有效性：**

根据提供的漏洞信息和漏洞利用代码，该漏洞利用代码 (ssh-username-enum.py) 通过修改 Paramiko 库来发送畸形的 SSH 数据包，并捕获服务器的响应。如果服务器立即拒绝连接，则表明用户名无效。如果服务器需要更多时间来处理请求，则表明用户名有效。利用方式清晰，针对性强，因此POC代码有效。

**投毒风险：**

漏洞利用代码 (ssh-username-enum.py) 的主要功能是利用 CVE-2018-15473 漏洞进行用户枚举。代码中存在一定的投毒风险，主要体现在以下几个方面：

1.  **依赖项：** 该脚本依赖 Paramiko 库。虽然 Paramiko 是一个常用的 SSH 库，但攻击者可能会通过修改 Paramiko 库来引入恶意代码，从而实现远程代码执行或其他恶意行为。在安装依赖项时，应验证库的来源和完整性。
2.  **异常处理：** 代码中使用了 `try...except` 块来处理可能出现的异常，例如连接错误和无效用户名。但是，如果攻击者能够构造特殊的请求，可能会绕过这些异常处理机制，从而导致程序崩溃或执行意外的代码。存在利用漏洞进行拒绝服务攻击的可能性。
3.  **Monkey Patch:** 代码使用了 monkey patch技术修改了`paramiko`内部函数，存在引入未知的安全隐患。虽然代码作者解释了原因，但是仍然需要人工审核确认。

综合以上因素，可以认为该漏洞利用代码存在较低的投毒风险 (5%)。在使用该代码时，应仔细审查代码，并确保从可信的来源获取依赖项。

**利用方式：**

1.  **目标确定：** 确定运行 OpenSSH <= 7.7 的目标主机，并且开放了 SSH 端口（通常为 22）。
2.  **用户名列表准备：** 准备一个可能的用户名列表。这个列表可以包含常见的用户名、目标组织员工姓名等。
3.  **执行漏洞利用代码：** 运行 `ssh-username-enum.py` 脚本，并指定目标主机的 IP 地址和端口，以及用户名列表。
4.  **结果分析：** 脚本会尝试使用每个用户名连接到目标主机，并根据服务器的响应时间判断用户名是否存在。
5.  **后续利用：** 获取有效的用户名列表后，攻击者可以使用其他攻击手段，例如密码破解、漏洞利用等，来进一步入侵目标系统。

**项目地址:** [WildfootW/CVE-2018-15473_OpenSSH_7.7](https://github.com/WildfootW/CVE-2018-15473_OpenSSH_7.7)

**漏洞详情:** [CVE-2018-15473](https://nvd.nist.gov/vuln/detail/CVE-2018-15473)