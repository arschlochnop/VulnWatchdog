## CVE-2024-21413-Microsoft Outlook远程代码执行

**漏洞编号:** CVE-2024-21413

**漏洞类型:** 远程代码执行

**影响应用:** Microsoft Outlook

**危害等级:** 高危，CVSS评分9.8，允许远程代码执行

**影响版本:** 受影响版本包括但不限于：Microsoft Office 2016 (版本低于 16.0.5435.1001)，Microsoft Office 2019 (版本低于https://aka.ms/OfficeSecurityReleases)，Microsoft 365 Apps for Enterprise (版本低于 https://aka.ms/OfficeSecurityReleases)，Microsoft Office LTSC 2021 (版本低于 https://aka.ms/OfficeSecurityReleases)

**利用条件:** 攻击者需要诱骗受害者点击包含恶意链接的邮件。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-21413是一个Microsoft Outlook远程代码执行漏洞，也被称为"MonikerLink" bug。该漏洞源于不正确的输入验证。攻击者可以通过发送特制的电子邮件，诱使用户点击其中的恶意链接，从而在用户系统上执行任意代码。

**有效性分析：**

提供的POC代码尝试利用该漏洞。它创建一封包含HTML链接的电子邮件，该链接指向一个`file://` URL。 此URL试图访问远程SMB共享，从而可能导致NTLM凭据泄露或远程代码执行，这取决于服务器的配置和Outlook的漏洞利用机制。

**投毒风险分析：**

提供的`Exploit.py`脚本主要功能是发送电子邮件。代码中没有发现明显的恶意或隐藏的投毒代码。该脚本会获取发件人的Outlook电子邮件地址和密码，以及收件人的电子邮件地址和邮件主题。脚本允许用户选择是否添加链接附件。 如果选择添加，则会添加指向指定IP地址（例子中为`file://///192.168.0.103/test!exploit`）的链接，否则添加用户自定义的邮件正文。该脚本使用`smtplib`库连接到Outlook的SMTP服务器（`smtp-mail.outlook.com`），并发送电子邮件。 没有发现任何会将用户凭据泄露给第三方的行为。

**漏洞利用方式分析：**

该漏洞利用方式依赖于`file://`协议处理中的缺陷。当Outlook处理包含指向SMB共享的`file://`链接的电子邮件时，它可能会尝试自动访问该共享，从而可能泄露用户的NTLM凭据或允许攻击者执行任意代码。 该PoC 通过构造包含恶意链接的HTML电子邮件来尝试利用此漏洞。 攻击者诱使用户点击此链接，从而触发漏洞。

总而言之，POC代码尝试通过`file://`协议利用Outlook的漏洞来实现远程代码执行，虽然该POC本身没有明显的投毒代码，但成功利用依赖于目标的网络配置和安全设置。

**项目地址:** [ShubhamKanhere307/CVE-2024-21413](https://github.com/ShubhamKanhere307/CVE-2024-21413)

**漏洞详情:** [CVE-2024-21413](https://nvd.nist.gov/vuln/detail/CVE-2024-21413)