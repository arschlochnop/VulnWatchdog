## CVE-2018-7600 - Drupalgeddon2 - 远程代码执行

**漏洞编号:** CVE-2018-7600

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Drupal

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** Drupal before 7.58, 8.x before 8.3.9, 8.4.x before 8.4.6, and 8.5.x before 8.5.1

**利用条件:** Drupal 实例需要存在漏洞且可网络访问，无需身份验证。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2018-7600，又名 Drupalgeddon2，是一个存在于 Drupal 多个子系统中的远程代码执行漏洞。该漏洞是由于对用户提供的输入验证不足而造成的。攻击者可以通过构造特殊的请求来执行任意代码。\n\n**有效性：**
提供的 exploit.py 代码通过 `user/register` 路径利用 Drupal 的一个 AJAX 表单处理缺陷，通过修改 `element_parents` 参数来注入恶意代码。它通过设置 `mail[#post_render][]` 为 `exec`，并利用 `mail[#markup]` 来执行任意命令。代码通过检查目标服务器上是否存在 `hello.txt` 文件来验证漏洞是否利用成功。根据漏洞信息和搜索结果，这个POC 是有效的。\n\n**投毒风险：**
代码仓库主要包含漏洞利用代码、ModSecurity 规则和 .htaccess 规则，旨在利用或防御 CVE-2018-7600 漏洞。`exploit.py` 会在目标机器上写入一个名为 `hello.txt` 的文件，这是一个测试性的操作。\n
`README.md` 文件中明确表示该代码仅用于教育和信息目的，并建议用户采取防护措施，例如更新 Drupal 和设置 WAF 规则。虽然作者声明的意图是好的，但攻击者可能会修改 `exploit.py` 以执行更危险的命令，或者在其他文件中插入恶意代码。\n
`ModSecurity.txt` 和 `htaccess.txt` 文件提供了防御规则，如果使用不当，可能会导致拒绝服务或绕过某些安全策略。\n
综合考虑，该仓库存在一定的投毒风险，但主要体现在用户使用不当或攻击者修改利用代码上，作者有意投毒的可能性较低。因此，我认为投毒风险大约为 10%。\n\n**利用方式：**
1.  攻击者发送包含恶意参数的 POST 请求到 `user/register?element_parents=account/mail/%23value&ajax_form=1&_wrapper_format=drupal_ajax`。
2.  `element_parents` 参数允许攻击者控制表单元素的属性。
3.  `mail[#post_render][]` 设置为 `exec`，指示 Drupal 执行命令。
4.  `mail[#markup]` 包含要执行的命令。
5.  Drupal 执行 `mail[#markup]` 中指定的命令，从而导致远程代码执行。

**项目地址:** [a2u/CVE-2018-7600](https://github.com/a2u/CVE-2018-7600)

**漏洞详情:** [CVE-2018-7600](https://nvd.nist.gov/vuln/detail/CVE-2018-7600)