## CVE-2019-5736-Docker容器逃逸

**漏洞编号:** CVE-2019-5736

**漏洞类型:** 容器逃逸

**影响应用:** runc/Docker

**危害等级:** 高危，可导致主机Root权限泄露

**影响版本:** <= 1.0-rc6 (runc), Docker before 18.09.2

**利用条件:** 需要在受影响的Docker容器中具有Root权限，或者能够通过`docker exec`进入容器

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2019-5736 漏洞允许攻击者通过利用文件描述符处理不当的问题，覆盖主机上的 runc 二进制文件，从而获得主机上的 Root 权限。该漏洞存在于 runc 1.0-rc6 及其之前版本中，影响 Docker 18.09.2 之前的版本。 

**利用方式：**

1.  **预置条件：** 攻击者需要在容器内部具有 Root 权限，或者能够通过 docker exec 等方式进入容器。同时目标主机运行着存在漏洞的runc版本。
2.  **漏洞触发：** 当容器内进程调用某个命令（如 /bin/sh）时，利用 /proc/self/exe 特性，将该命令指向宿主机的 runc 二进制文件。
3.  **覆盖 runc：** 攻击者通过文件描述符操作，在 runc 二进制文件退出时，尝试写入恶意代码，覆盖原有的 runc 二进制文件。
4.  **权限提升：** 当新的容器启动时，由于 runc 二进制文件已被篡改，恶意代码将以 Root 权限在宿主机上执行，导致容器逃逸。

**关于投毒风险：**

提供的PoC代码主要展示了漏洞利用的逻辑，即通过文件描述符覆盖宿主机上的runc二进制文件。PoC本身的功能集中于利用漏洞，没有明显的迹象表明作者有意添加恶意或后门代码。

但是，PoC的使用者需要注意以下几点：
* 恶意的使用PoC代码本身会对目标系统造成破坏。
* 攻击者可能修改PoC，添加额外的恶意代码，例如反向Shell，密钥窃取等。在使用PoC前，务必仔细审查代码，避免引入安全风险。

基于以上分析，判定代码中存在恶意投毒代码的概率较低，约为5%， 主要来自使用者恶意篡改。

**有效性：**

根据漏洞描述和PoC代码，该漏洞利用的有效性较高，漏洞库信息和搜索结果中也有相关验证信息。在满足利用条件（存在漏洞的runc版本，容器内root权限或docker exec访问）的情况下，可以成功实现容器逃逸。

**项目地址:** [Frichetten/CVE-2019-5736-PoC](https://github.com/Frichetten/CVE-2019-5736-PoC)

**漏洞详情:** [CVE-2019-5736](https://nvd.nist.gov/vuln/detail/CVE-2019-5736)