## CVE-2023-4220 Chamilo LMS Unauthenticated Big Upload File Remote Code Execution

**漏洞编号:** CVE-2023-4220

**漏洞类型:** 文件上传漏洞

**影响应用:** Chamilo LMS

**危害等级:** 高危，可导致远程代码执行和跨站脚本攻击

**影响版本:** <= 1.11.24

**利用条件:** 目标Chamilo LMS实例运行在受影响的版本上，且`/main/inc/lib/javascript/bigupload/inc/bigUpload.php` 路径可访问。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-4220 存在于 Chamilo LMS 的大文件上传功能中，攻击者可以通过上传恶意文件，例如 webshell，从而实现远程代码执行。由于该漏洞无需身份验证，因此任何未经授权的攻击者都可能利用此漏洞。 

**漏洞利用方式：**

1.  攻击者向 `/main/inc/lib/javascript/bigupload/inc/bigUpload.php` 发送包含恶意 webshell 的上传请求。
2.  由于文件上传功能存在漏洞，恶意文件成功上传到服务器的 `/main/inc/lib/javascript/bigupload/files/` 目录。
3.  攻击者通过访问上传的 webshell，执行任意代码。

**POC代码分析：**

POC 代码 `CVE-2023-4220.py`  实现了漏洞的利用。代码首先检查目标是否存在漏洞利用所需的目录，然后上传包含PHP代码的 webshell。上传成功后，该脚本提供了一个交互式 shell，攻击者可以使用它在服务器上执行命令。该脚本还尝试通过 Tor 网络进行连接，并进行 User-Agent 伪装，以增加攻击的隐蔽性。 命令输入和输出被记录到 `command.log` 文件中。

**投毒风险分析：**

虽然 POC 代码的核心功能是漏洞利用，但存在轻微的投毒风险。风险点主要在于 `command.log` 文件。 虽然日志本身不是恶意的，但它会记录攻击者执行的所有命令，这些信息在某些情况下可能会被滥用或者泄露敏感信息。 此外，代码强制通过Tor代理, 也有可能被用于恶意目的。因此，投毒风险评估为10%。该评估是基于作者在其他地方增加恶意代码，如反向shell或数据窃取的可能性。没有直接证据表明存在恶意代码，但增加Tor代理使用的这种行为本身会引起警惕。

**项目地址:** [MikeyPPPPPPPP/CVE-2023-4220](https://github.com/MikeyPPPPPPPP/CVE-2023-4220)

**漏洞详情:** [CVE-2023-4220](https://nvd.nist.gov/vuln/detail/CVE-2023-4220)