## CVE-2019-0708 (BlueKeep)

**漏洞编号:** CVE-2019-0708

**漏洞类型:** 远程代码执行

**影响应用:** Windows Remote Desktop Services

**危害等级:** 高危，可远程代码执行，可能导致系统完全控制

**影响版本:** Windows 7 SP1, Windows Server 2008 R2 SP1, Windows Server 2008 SP2

**利用条件:** 目标系统开启RDP服务（3389端口），且未安装相应补丁。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-0708 (BlueKeep) 是一个存在于 Windows 远程桌面服务中的远程代码执行漏洞。未经身份验证的攻击者可以通过 RDP 连接发送特制请求来触发此漏洞，从而在目标系统上执行任意代码。

**有效性评估：**

提供的`poc.py`代码看起来是一个利用 CVE-2019-0708 漏洞的 PoC（概念验证）脚本。它包含建立 RDP 连接并发送恶意数据包所需的步骤，例如 X.224 连接请求和 MCS 连接初始 PDU。 根据搜索引擎结果，存在多个关于 BlueKeep 的利用方法，该 PoC 尝试触发漏洞以导致蓝屏死机 (BSOD)。

**投毒风险评估：**

分析了提供的 PoC 代码，发现以下风险点，但不能完全确定为投毒：

1.  **依赖 OpenSSL 库：** PoC 使用 OpenSSL 库进行 TLS 握手。虽然 OpenSSL 是一个常用的库，但也可能存在潜在的漏洞或配置问题，攻击者可以利用这些问题在受害者系统上执行恶意代码。但是，正常的TLS链接也依赖于此。
2.  **异常处理不足：** PoC 中的异常处理可能不足，未能充分处理连接错误、数据接收错误或 TLS 握手失败等情况。这可能导致 PoC 在某些情况下崩溃，或在受害者系统上留下不稳定的状态。
3.  **目的单一：** 该POC目标为BSOD，若修改为植入后门等恶意代码，则更具危害性，应关注后续利用。

考虑到以上风险点以及PoC的复杂性，我给予10%的投毒风险评估。

**漏洞利用方式分析：**

1.  **RDP 连接初始化：** PoC 首先建立与目标系统的 RDP 连接。这涉及发送 X.224 连接请求 PDU 并执行 TLS 握手。
2.  **MCS 连接建立：** 建立 TLS 连接后，PoC 发送 MCS 连接初始 PDU 以启动 MCS 连接。
3.  **触发漏洞：** PoC 的目标是发送精心构造的 RDP 数据包，以触发漏洞，可能是一个 use-after-free 漏洞。根据PacketstormSecurity的信息，存在针对此漏洞的Use-After-Free的EXP。
4.  **远程代码执行 (RCE)：** 成功利用此漏洞会导致在目标系统上执行任意代码。攻击者可以利用此漏洞来安装恶意软件、窃取敏感数据或完全控制受感染的系统。

需要注意的是，成功利用 CVE-2019-0708 需要对 RDP 协议和漏洞的内部工作原理有深入的了解。PoC 代码可能需要进行修改才能在不同的目标系统上可靠地工作。

**项目地址:** [pywc/CVE-2019-0708](https://github.com/pywc/CVE-2019-0708)

**漏洞详情:** [CVE-2019-0708](https://nvd.nist.gov/vuln/detail/CVE-2019-0708)