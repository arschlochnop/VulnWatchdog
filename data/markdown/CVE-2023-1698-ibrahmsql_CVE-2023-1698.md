## CVE-2023-1698-WAGO-远程代码执行

**漏洞编号:** CVE-2023-1698

**漏洞类型:** 远程代码执行(RCE)

**影响应用:** WAGO Compact Controller CC100, Edge Controller, PFC100, PFC200, Touch Panel 600 系列

**危害等级:** 高危，可能导致完全系统控制、拒绝服务、未授权访问和配置更改

**影响版本:** FW20 <= 版本 <= FW22, FW23 (部分产品)

**利用条件:** 目标设备开启了Web管理界面，且攻击者可以发起网络请求。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-1698 是 WAGO 产品中的一个远程代码执行漏洞。未经身份验证的远程攻击者可以通过构造恶意请求，利用该漏洞在目标系统上执行任意命令，例如创建新用户和更改设备配置。漏洞存在于 `/wbm/plugins/wbm-legal-information/platform/pfcXXX/licenses.php` 接口。POC代码通过构造包含恶意命令的JSON数据包，利用 `Package` 字段中的命令注入点执行系统命令，并通过 `[PWNED_START]` 和 `[PWNED_END]` 标记来解析命令执行结果。

**有效性：**
根据漏洞库信息、搜索引擎结果和提供的漏洞利用代码，该漏洞利用的有效性较高。搜索引擎中存在多个关于此漏洞的描述和利用工具的链接，表明该漏洞已得到广泛关注和研究。提供的漏洞利用代码是一个使用 Go 语言编写的 PoC，能够远程执行命令，进一步验证了漏洞的有效性。

**投毒风险：**
该PoC代码存在轻微的投毒风险。主要风险点在于以下几个方面：
1.  **自定义User-Agent：** PoC允许自定义User-Agent，攻击者可以将User-Agent设置为恶意值，用于进一步攻击或识别。
2.  **InsecureSkipVerify：** PoC中的TLS配置`InsecureSkipVerify: true` 会跳过SSL证书验证，如果目标网络存在中间人攻击，可能导致敏感信息泄露。
3. **命令执行回显：** PoC会将命令执行结果回显，这可能泄露敏感信息。
4. **交互式Shell：** PoC包含一个启动交互式shell的函数，该shell存在被滥用的风险。

虽然以上存在一些风险，但是PoC代码主体是实现了漏洞利用的功能，恶意投毒概率较低，故投毒概率为5%.

**利用方式：**
1.  **确定目标：** 找到存在漏洞的WAGO设备，并确认其Web管理界面开启。确认目标设备的固件版本是否在受影响的范围内。
2.  **构造Payload：**  使用提供的 PoC 脚本，构造包含要执行命令的 JSON Payload。关键在于 `Package` 字段，攻击者将要执行的命令嵌入到该字段中。
3.  **发送请求：**  使用 HTTP POST 请求将构造的 Payload 发送到目标设备的 `/wbm/plugins/wbm-legal-information/platform/pfcXXX/licenses.php` 接口。
4.  **解析结果：**  从响应中提取命令执行的结果。PoC 使用 `[PWNED_START]` 和 `[PWNED_END]` 作为分隔符，方便解析命令执行的输出。
5.  **后续操作：** 根据执行命令的结果，进一步控制系统，例如创建新用户、修改配置、安装恶意软件等。

**项目地址:** [ibrahmsql/CVE-2023-1698](https://github.com/ibrahmsql/CVE-2023-1698)

**漏洞详情:** [CVE-2023-1698](https://nvd.nist.gov/vuln/detail/CVE-2023-1698)