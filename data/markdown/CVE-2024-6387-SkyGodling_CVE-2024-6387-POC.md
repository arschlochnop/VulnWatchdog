## CVE-2024-6387-OpenSSH-竞争条件RCE/DoS

**漏洞编号:** CVE-2024-6387

**漏洞类型:** 竞争条件

**影响应用:** OpenSSH

**危害等级:** 高危，可能导致远程代码执行（RCE）或拒绝服务（DoS）

**影响版本:** 8.5p1 <= version <= 9.7p1

**利用条件:** 目标系统运行受影响版本的OpenSSH，且基于glibc的Linux系统。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-6387（regreSSHion）是OpenSSH服务器中的一个安全回归漏洞，源于CVE-2006-5051。它是一个竞争条件漏洞，可能导致sshd以不安全的方式处理信号。远程攻击者可以通过在设定的时间内未能成功验证身份来触发此漏洞，从而可能导致远程代码执行或拒绝服务。

**有效性评估：**

根据漏洞库信息、搜索结果以及提供的POC代码来看，此漏洞的POC是存在的，并且多个安全厂商都发布了相关的分析报告和检测方法。搜索结果也表明此漏洞允许远程未授权代码执行。

**利用方式：**

1.  攻击者建立与目标OpenSSH服务器的连接。
2.  进行SSH握手，获取服务器banner。
3.  准备堆，发送一定量的填充数据。
4.  尝试触发竞争条件，通过发送包含`glibc_base`地址的payload，并附加一些`nop`指令。
5.  如果成功，则在服务器上执行代码，获得root权限。
6.  脚本使用了多线程来增加攻击成功的几率，并对时序进行调整。

**投毒风险评估：**

提供的POC代码（`Exploit_2024_6387.py`）本身是一个漏洞利用脚本，其目的是利用目标系统的漏洞。评估投毒风险主要关注作者是否在脚本中植入了恶意代码，例如：

*   **后门代码：**  脚本在成功利用漏洞后，是否会创建一个后门，允许攻击者在未经授权的情况下再次访问系统。
*   **破坏性代码：**  脚本是否包含旨在破坏目标系统或数据的代码。
*   **信息窃取代码：**  脚本是否会窃取目标系统上的敏感信息。

分析代码发现，虽然脚本本身旨在利用漏洞，但并未发现明显的后门、破坏性或信息窃取代码。 然而，需要注意的是，该脚本的`TARGET_IP`和`TARGET_PORT`是硬编码的，在实际使用中需要进行修改。此外，攻击者可能会修改此脚本以包含恶意功能。此处的`glibc_base`地址也需要根据目标环境进行调整，否则利用大概率会失败，这也是成功利用此漏洞的难点之一。

综合来看，该仓库存在投毒风险的可能性较低，但是不排除有攻击者对代码进行修改后，二次传播。因此，建议在使用前仔细审查代码。

**风险评估：**
`poison`的百分比评估主要考虑以下几个方面：

*   **代码复杂性：** 代码越复杂，隐藏恶意代码的可能性越高。
*   **作者信誉：** 如果作者的信誉未知或可疑，则风险越高。
*   **代码审查：** 代码是否经过其他安全研究人员的审查。

根据以上分析，此脚本的`poison`风险评估为10%。

**项目地址:** [SkyGodling/CVE-2024-6387-POC](https://github.com/SkyGodling/CVE-2024-6387-POC)

**漏洞详情:** [CVE-2024-6387](https://nvd.nist.gov/vuln/detail/CVE-2024-6387)