## CVE-2025-21420 Windows Disk Cleanup Tool Elevation of Privilege Vulnerability

**漏洞编号:** CVE-2025-21420

**漏洞类型:** 权限提升

**影响应用:** Windows Disk Cleanup Tool (cleanmgr.exe)

**危害等级:** 高危，允许低权限用户获取SYSTEM权限

**影响版本:** 受影响的Windows版本详见CVE信息，在指定版本范围内

**利用条件:** 需要本地访问权限

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2025-21420 存在于 Windows 磁盘清理工具中，是一个权限提升漏洞。根据漏洞库信息，多个 Windows 版本均受影响。搜索引擎结果显示，该漏洞允许攻击者获得 SYSTEM 权限。PoC 代码利用了 `SilentCleanup` 任务中存在的任意文件夹删除/移动/重命名漏洞，通过创建特定目录结构和结合其他 PoC（FolderOrFileDeleteToSystem, FolderContentsDeleteToFolderDelete）将清理操作重定向到 `C:/Config.msi` 目录，最终导致权限提升。 Diffing cleanmgr.exe表明新版本引入了 ProcessRedirectionTrustPolicy 缓解措施，暗示了漏洞与目录重定向有关。

**有效性：**
PoC代码似乎是有效的，因为它指向了利用 `SilentCleanup` 任务进行权限提升的已知方法。

**投毒风险：**
PoC 代码主要包含创建目录、写入文件和运行计划任务的命令。虽然这些操作本身看起来无害，但是结合文档中的描述，利用这个PoC需要下载另外的两个存储库，即`FolderOrFileDeleteToSystem`和`FolderContentsDeleteToFolderDelete`。因此，投毒风险主要来自未提供的两个利用代码，此处PoC只是一种触发方式，投毒可能性较低，风险估计为 5% 。

**利用方式：**
1.  创建必要的目录结构：`C:\$Windows.~WS`, `C:\ESD\Windows`, `C:\ESD\Download`，并在每个目录中创建一个 `text.txt` 文件。
2.  利用`FolderOrFileDeleteToSystem`设置`Config.msi`目录
3.  利用`FolderContentsDeleteToFolderDelete`重定向清理目标
4.  运行 `SilentCleanup` 计划任务，触发磁盘清理工具。
5.  利用权限提升执行任意代码（例如，通过 `osk.exe`）。

**项目地址:** [moiz-2x/CVE-2025-21420_POC](https://github.com/moiz-2x/CVE-2025-21420_POC)

**漏洞详情:** [CVE-2025-21420](https://nvd.nist.gov/vuln/detail/CVE-2025-21420)