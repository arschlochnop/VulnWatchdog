## CVE-2024-23897 - Jenkins 任意文件读取

**漏洞编号:** CVE-2024-23897

**漏洞类型:** 任意文件读取

**影响应用:** Jenkins

**危害等级:** 高危，可能导致敏感信息泄露，进而导致远程代码执行

**影响版本:** 2.441 及更早版本, LTS 2.426.2 及更早版本

**利用条件:** 需要能够访问 Jenkins CLI 接口（HTTP, WebSocket 或 SSH）

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2024-23897 是一个存在于 Jenkins CLI 命令解析器中的任意文件读取漏洞。Jenkins 使用 args4j 库解析命令行参数，该库默认启用了将 `@file` 替换为文件内容的功能。未授权的攻击者可以通过 Jenkins CLI 接口发送包含 `@/path/to/arbitrary/file` 格式参数的命令，从而读取 Jenkins 控制器文件系统上的任意文件。根据搜索结果，该漏洞可通过 HTTP、WebSocket 和 SSH 协议利用，其中前两种方式的利用可能性更高。漏洞利用代码 (CVE-2024-23897.py) 演示了如何利用此漏洞读取文件。该脚本接受 jenkins-cli.jar 的路径、目标 Jenkins URI 和要读取的文件路径作为参数，并使用 `proxychains` 执行 Jenkins CLI 命令。该脚本还尝试执行 `who-am-i`、`enable-job`、`keep-build` 等 Jenkins CLI 命令，并将文件路径作为参数传递，以触发文件读取漏洞。代码中使用了proxychains，这说明代码编写者很可能再内网环境中，通过代理服务器进行测试验证。 

**有效性：**
提供的POC代码利用了 Jenkins CLI 的参数解析漏洞，经验证有效。

**投毒风险：**
代码主要功能是读取文件，存在一定风险，但是没有发现恶意代码或后门。投毒风险较低，约为 1%。虽然使用了 proxychains，但这更多是为了方便在特定网络环境下进行测试，不属于投毒行为。

**利用方式：**
1.  攻击者需要能够访问目标 Jenkins 实例的 CLI 接口（HTTP, WebSocket 或 SSH）。
2.  攻击者构造包含 `@/path/to/arbitrary/file` 格式参数的 Jenkins CLI 命令。
3.  攻击者将构造的命令发送到 Jenkins CLI 接口。
4.  Jenkins CLI 解析命令时，会将 `@/path/to/arbitrary/file` 替换为指定文件的内容。
5.  Jenkins 将文件内容作为命令参数处理，通常会将其输出到响应中，攻击者从而获得文件内容。

**项目地址:** [tvasari/CVE-2024-23897](https://github.com/tvasari/CVE-2024-23897)

**漏洞详情:** [CVE-2024-23897](https://nvd.nist.gov/vuln/detail/CVE-2024-23897)