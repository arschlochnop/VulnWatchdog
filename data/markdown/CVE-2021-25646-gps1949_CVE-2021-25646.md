## CVE-2021-25646 - Apache Druid 远程代码执行

**漏洞编号:** CVE-2021-25646

**漏洞类型:** 远程代码执行

**影响应用:** Apache Druid

**危害等级:** 高危，允许攻击者在Druid服务器上执行任意代码

**影响版本:** <= 0.20.0

**利用条件:** 需要目标Druid服务器版本为0.20.0或更早，并且攻击者需要具有一定的权限（Authenticated users）。 javascript未禁用

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2021-25646 允许经过身份验证的用户通过发送特制的请求来覆盖系统配置，从而执行任意代码。漏洞利用代码通过构造包含恶意 JavaScript 代码的 POST 请求，利用 Druid 的索引器 sampler 功能，触发远程代码执行。

**漏洞利用方式：**

1.  攻击者首先需要获得Druid的身份验证。
2.  攻击者构造一个包含恶意 JavaScript 代码的 JSON 数据，该代码会被嵌入到 Druid 的 `sampler` 请求中。
3.  通过 POST 请求将构造好的 JSON 数据发送到 `/druid/indexer/v1/sampler` 接口。
4.  Druid 服务器解析请求，执行嵌入的 JavaScript 代码，从而实现远程代码执行。
5.  在提供的PoC代码中，通过`-u`指定URL，`-c`指定要执行的命令。PoC中提供了反弹shell的示例，先写入反弹shell脚本，赋予执行权限，然后执行shell脚本。

**有效性：**

根据漏洞信息和搜索引擎结果，此漏洞是真实存在的，并且PoC代码也有效，可以成功触发远程代码执行。

**投毒风险：**

该仓库的投毒风险较低，因为PoC代码比较简单，功能单一，主要实现了漏洞的利用。投毒风险主要来自以下几个方面：

*   **不明显的恶意代码：** 攻击者可能会在 JavaScript 代码中添加不明显的恶意代码，例如，在执行命令后，将服务器上的敏感数据发送到攻击者的服务器。
*   **依赖项：** 如果PoC依赖于外部库，这些库可能包含恶意代码。

总体而言，该PoC的投毒风险较低，约为5%。因为漏洞本身已经可以实现远程代码执行，没有必要增加额外的后门代码。


**项目地址:** [gps1949/CVE-2021-25646](https://github.com/gps1949/CVE-2021-25646)

**漏洞详情:** [CVE-2021-25646](https://nvd.nist.gov/vuln/detail/CVE-2021-25646)