## CVE-2019-9193 - PostgreSQL authenticated remote code execution

**漏洞编号:** CVE-2019-9193

**漏洞类型:** 远程代码执行

**影响应用:** PostgreSQL

**危害等级:** 高危，允许经过身份验证的用户执行任意操作系统命令。

**影响版本:** 9.3 到 11.2 (根据漏洞信息), POC 验证版本 9.6.1

**利用条件:** 需要PostgreSQL数据库的有效用户名和密码,以及数据库服务器允许执行 'COPY TO/FROM PROGRAM' 命令。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-9193 允许具有足够权限（通常是超级用户或 'pg_execute_server_program' 组的成员）的 PostgreSQL 用户，利用 `COPY TO/FROM PROGRAM` 命令在数据库服务器的操作系统上执行任意代码。漏洞利用方式如下：

1.  **连接到 PostgreSQL 数据库：** 使用有效的用户名和密码连接到目标 PostgreSQL 数据库。
2.  **创建恶意函数和触发器：** 创建一个函数 `triggeroffsecexeccmd()`，该函数使用 `COPY triggeroffsec (cmdout) FROM PROGRAM` 执行指定的系统命令。然后创建一个表 `triggeroffsecsource`，并创建一个触发器 `shoottriggeroffsecexeccmd`，该触发器在 `triggeroffsecsource` 表上每次插入操作后执行 `triggeroffsecexeccmd()` 函数。
3.  **触发触发器：**  向 `triggeroffsecsource` 表插入一行数据，从而触发 `shoottriggeroffsecexeccmd` 触发器，进而执行 `triggeroffsecexeccmd()` 函数。
4.  **执行命令并获取结果：**  该函数会执行指定的命令，并将结果存储在 `triggeroffsec` 表中。然后可以查询 `triggeroffsec` 表来获取命令的输出。

**有效性：** 根据漏洞库信息、搜索引擎结果和提供的POC代码，该漏洞是有效的，尤其是在未经适当配置的PostgreSQL实例上。尽管PostgreSQL团队认为这不是一个真正的漏洞，而是一个功能，但它确实允许经过身份验证的用户执行任意代码，从而带来安全风险。

**投毒风险：** 检查POC代码发现，代码本身用于利用CVE-2019-9193执行命令，没有发现任何额外的、与预期功能不符的代码。因此，投毒风险评估为0%。该代码的目的是方便快捷的调用漏洞，本身的行为也完全符合漏洞利用的逻辑。

**利用方式总结：** 该漏洞的利用方式主要是通过PostgreSQL的`COPY TO/FROM PROGRAM`功能，结合触发器，实现在数据库服务器操作系统上执行任意命令。攻击者需要有效的数据库凭据才能利用此漏洞。即使目标不属于超级用户，但属于 `pg_execute_server_program` 组的成员依然可以执行。


**项目地址:** [paulotrindadec/CVE-2019-9193](https://github.com/paulotrindadec/CVE-2019-9193)

**漏洞详情:** [CVE-2019-9193](https://nvd.nist.gov/vuln/detail/CVE-2019-9193)