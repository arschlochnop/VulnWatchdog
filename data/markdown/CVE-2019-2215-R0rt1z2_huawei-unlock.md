## CVE-2019-2215 Android Binder Use-After-Free

**漏洞编号:** CVE-2019-2215

**漏洞类型:** Use-After-Free

**影响应用:** Android Kernel

**危害等级:** 高危，可能导致权限提升

**影响版本:** Kernel

**利用条件:** 需要安装恶意本地应用程序或网络暴露的应用程序中的另一个漏洞。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2019-2215 是 Android Binder 中的一个 use-after-free 漏洞，允许应用程序提升到 Linux 内核权限。漏洞位于 binder.c 中。根据提供的POC代码，该利用程序旨在通过利用此漏洞获得任意内核 R/W 权限，从而绕过 SELinux 并获取 root 权限。

**有效性分析：**
根据漏洞库信息、搜索结果和提供的漏洞利用代码，该漏洞被广泛讨论并存在公开可用的利用程序。搜索结果表明该漏洞已在野外被利用。提供的代码似乎是一个功能齐全的利用程序，包含绕过 SELinux 和注入 Sepolicy 的功能。因此，可以认为提供的 POC 代码**有效**。

**投毒风险分析：**
代码片段包含多个修改历史的作者和描述，从 Jann Horn & Maddie Stone of Google Project Zero 开始，到 Alexander R. Pruss, Sithi, chompie1337 和 Roger Ortiz。 这些修改包括对不同 Android 版本、华为设备和 SELinux 绕过的支持。 虽然代码历史看起来合理，但每次修改都增加了潜在的攻击面或引入恶意代码的可能性。

投毒风险评估：从代码来看，它是一个root提权EXP，本身就具有一定的“破坏性”。考虑到代码比较复杂，修改者比较多，虽然大部分修改都是为了兼容性和功能性，但仍然存在作者植入后门的可能, 经过代码分析，发现作者存在通过宏定义常量，去修改内核地址，以及新增绕过SELinux的动作，虽然这些行为都是为了EXP成功。但是仍然存在一定投毒风险， 故判定的投毒风险为 **5%**。

**利用方式分析：**
1.  **漏洞触发：** 该漏洞是 Binder 驱动程序中的一个 use-after-free 漏洞。具体触发方式可能涉及精心设计的 Binder 事务序列，导致 `binder_thread` 结构释放后被再次访问。
2.  **权限提升：** 成功利用该漏洞后，攻击者可以获得内核的读/写访问权限。利用此能力，攻击者可以修改进程的凭据结构（`cred`），将 UID、GID、capabilities 等设置为 0，从而获得 root 权限。
3. **SELinux绕过** 漏洞利用还包括绕过 SELinux 策略的机制，例如通过修改 AVC 缓存或注入新的安全策略来获取root权限。
4. **NVE解锁(华为设备)** 漏洞利用还包括解锁NVE功能，可以用来修改设备指纹，绕过安全验证。

总而言之，此漏洞利用方式是首先触发内核中的 use-after-free 漏洞，然后利用内核读/写访问权限来修改进程凭据并绕过 SELinux，从而获得 root 权限。 这个过程需要精心设计的代码和对内核内部机制的深入了解。

**项目地址:** [R0rt1z2/huawei-unlock](https://github.com/R0rt1z2/huawei-unlock)

**漏洞详情:** [CVE-2019-2215](https://nvd.nist.gov/vuln/detail/CVE-2019-2215)