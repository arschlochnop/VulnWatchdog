## CVE-2017-7269 Microsoft IIS WebDav ScStoragePathFromUrl Overflow

**漏洞编号:** CVE-2017-7269

**漏洞类型:** 缓冲区溢出

**影响应用:** Microsoft IIS 6.0

**危害等级:** 高危，允许远程攻击者执行任意代码

**影响版本:** Microsoft Windows Server 2003 R2 开启WebDAV服务的IIS 6.0

**利用条件:** 需要目标服务器开启WebDAV服务

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2017-7269是一个存在于Microsoft IIS 6.0 WebDAV服务中的缓冲区溢出漏洞。攻击者可以通过发送一个包含特制`If:`头的`PROPFIND`请求来利用此漏洞，其中`If:`头包含一个超长的URL，导致`ScStoragePathFromUrl`函数处理时发生缓冲区溢出，从而执行任意代码。

**有效性评估：**

根据提供的漏洞库信息、搜索引擎结果和漏洞利用代码，该漏洞被广泛报告和利用，存在公开可用的POC，并且Metasploit框架中也存在相应的利用模块。因此，可以认为提供的POC代码是有效的。

**投毒风险评估：**

提供的POC代码是一个Metasploit模块，主要功能是构造恶意的HTTP请求来触发缓冲区溢出。代码中包含一些用于计算缓冲区大小和构造溢出数据的逻辑，以及用于执行payload的部分。经过分析，没有发现明显的恶意代码或后门，该exp主要通过精心构造的payload实现攻击目的，没有发现隐藏的、非预期的恶意行为。因此，投毒风险较低。

**利用方式分析：**

1.  **漏洞触发：** 攻击者向目标IIS 6.0服务器发送一个`PROPFIND`请求，该请求的`If:` header 包含一个以`http://`开头的极长的URL。
2.  **缓冲区溢出：** IIS 6.0的WebDAV服务中的`ScStoragePathFromUrl`函数在处理该URL时，由于未正确检查URL的长度，导致缓冲区溢出。
3.  **代码执行：** 攻击者可以通过控制溢出的数据来覆盖内存中的关键区域，例如函数返回地址，从而执行任意代码。
4.  **Payload执行：** Metasploit模块通常会将shellcode作为payload注入到溢出缓冲区中，当程序执行到被覆盖的返回地址时，shellcode会被执行，从而允许攻击者在目标服务器上运行任意命令。
5.  **利用细节：**
    * 模块中可以自定义HttpHost和PhysicalPathLength两个参数. PhysicalPathLength的值需要根据目标服务器的物理路径长度进行调整，如果配置不正确，可能导致利用失败。
    * Payload使用了AlphanumUnicodeMixed编码,为了绕过某些检测.
    * 利用过程中需要确保目标服务器开启了WebDAV服务。

**项目地址:** [Al1ex/CVE-2017-7269](https://github.com/Al1ex/CVE-2017-7269)

**漏洞详情:** [CVE-2017-7269](https://nvd.nist.gov/vuln/detail/CVE-2017-7269)