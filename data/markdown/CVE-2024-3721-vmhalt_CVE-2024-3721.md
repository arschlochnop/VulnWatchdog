## CVE-2024-3721-TBK DVR-4104/DVR-4216-OS命令注入

**漏洞编号:** CVE-2024-3721

**漏洞类型:** OS命令注入

**影响应用:** TBK DVR-4104/DVR-4216

**危害等级:** 高危，可能导致设备完全控制

**影响版本:** <= 20240412

**利用条件:** 需要网络访问设备，且Cookie中uid=1

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2024-3721是一个存在于TBK DVR-4104和DVR-4216设备（版本至20240412）中的操作系统命令注入漏洞。攻击者可以通过操纵`/device.rsp?opt=sys&cmd=___S_O_S_T_R_E_A_MAX___`接口中的`mdb`和`mdc`参数来执行任意系统命令。根据提供的POC代码，利用方式如下：

1.  **漏洞触发点：** `device.rsp`接口的`mdb`和`mdc`参数。
2.  **攻击方法：** 攻击者构造包含恶意命令的HTTP GET请求，通过`mdc`参数传递经过URL编码的操作系统命令。
3.  **利用条件：** 需要知道目标设备的IP地址和端口号，以及Cookie中`uid=1`，并且受影响的设备必须是TBK DVR-4104或DVR-4216，版本小于等于20240412。
4.  **POC有效性：** 提供的Python POC脚本利用`requests`库发送带有恶意命令的HTTP GET请求。它从文件中读取目标主机列表，并使用多线程加速漏洞利用过程，因此POC是有效的。
5. **投毒风险：** POC 代码主要是发送请求，风险较低。主要风险在于攻击者可以使用该脚本对大量设备进行批量攻击，产生规模效应。对于仓库投毒风险主要是防止作者在代码中隐藏后门，经过分析，代码中只存在`requests`进行get请求，无任何恶意代码。认为存在1%风险是因为可能后续版本存在风险。

**搜索引擎结果分析：**

*   搜索结果确认了漏洞的存在，并指向了NVD、CVE、INCIBE-CERT等权威漏洞信息源。
*   部分搜索结果提供了关于漏洞的描述、影响和技术细节，以及缓解策略。
*   `ogma.in` 的链接给出了CVE-2024-3721的缓解措施

**总结：**

该漏洞的利用较为简单，攻击者只需构造特定的HTTP请求即可触发。由于漏洞利用代码已经公开，且目标设备通常暴露在互联网上，因此该漏洞的威胁程度较高，建议及时修复。

**项目地址:** [vmhalt/CVE-2024-3721](https://github.com/vmhalt/CVE-2024-3721)

**漏洞详情:** [CVE-2024-3721](https://nvd.nist.gov/vuln/detail/CVE-2024-3721)