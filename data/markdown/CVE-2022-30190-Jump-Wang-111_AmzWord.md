## CVE-2022-30190 (Follina) - Microsoft MSDT 远程代码执行

**漏洞编号:** CVE-2022-30190

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Microsoft Windows Support Diagnostic Tool (MSDT)

**危害等级:** 高危，可能导致远程代码执行，系统控制，数据泄露

**影响版本:** 见漏洞库信息中受影响的版本列表

**利用条件:** 用户需要打开包含恶意链接或文档的应用程序（如 Microsoft Word）。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-30190（又名Follina）是一个存在于 Microsoft 支持诊断工具 (MSDT) 中的远程代码执行漏洞。攻击者可以利用此漏洞，通过诱骗用户打开包含恶意代码的文档（通常是 Word 文档），从而在受害者系统上执行任意代码。

**利用方式：**

1.  攻击者创建一个包含恶意链接或嵌入恶意 HTML 的文档 (例如, Word 文档)。该恶意 HTML 利用 `ms-msdt:` 协议处理程序调用 MSDT。
2.  当用户打开该文档时，MSDT 会被调用，并执行攻击者指定的代码。该代码可以下载并执行任意程序。
3.  提供的漏洞利用代码 (AmzWord) 自动化了此过程，集成了 CVE-2022-30190 漏洞利用、163 邮箱后门和图像隐写术。
4.  AmzWord 使用 `follina.py` 脚本生成恶意 Word 文件，并在本地启动 HTTP 服务器，用于提供恶意载荷。
5.  该漏洞利用代码还使用了 `gdog` 项目，这是一个基于邮件的远程控制工具，允许攻击者通过发送特定的命令邮件来控制受害者机器。

**有效性：**

根据漏洞库信息和搜索结果，CVE-2022-30190 是一个真实且已被积极利用的漏洞。提供的 POC 代码 (`AmzWord`) 旨在利用该漏洞，因此可以判断 POC 代码是有效的，前提是目标系统存在漏洞且未采取缓解措施。

**投毒风险：**

评估 POC 代码的投毒风险需要仔细审查代码，检查是否存在隐藏的、非预期的恶意行为。从描述来看,`AmzWord` 项目集成了多个组件，包括 `follina.py`（CVE-2022-30190 漏洞利用）和 `gdog`（基于邮件的远程控制工具）。 潜在的投毒风险可能存在于以下几个方面：

*   `gdog` 组件： `gdog` 项目本身可能包含后门或恶意功能，允许作者或其他人远程访问受感染的系统。由于该项目已经存在一段时间，并且经过修改以适应当前的攻击链，因此存在引入未经审查的恶意代码的风险。
*   配置信息泄露： POC需要用户填写邮箱的用户名和密码，存在泄露邮箱信息的风险
*   依赖关系： 该POC依赖多个第三方库，这些库可能存在安全漏洞或被篡改，从而导致意外行为。

综合来看，由于集成的复杂性和对外部组件的依赖，存在一定的投毒风险。`gdog` 组件尤其值得关注。 但从整个项目的设计来看，目标是实现一个完整的攻击链演示，作者隐藏恶意代码以达到其他目的的可能性较低，所以投毒的可能性相对较低。评估投毒风险的概率约为 10%。

**项目地址:** [Jump-Wang-111/AmzWord](https://github.com/Jump-Wang-111/AmzWord)

**漏洞详情:** [CVE-2022-30190](https://nvd.nist.gov/vuln/detail/CVE-2022-30190)