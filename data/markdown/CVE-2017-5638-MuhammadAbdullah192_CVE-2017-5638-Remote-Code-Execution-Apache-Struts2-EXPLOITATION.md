## CVE-2017-5638-Apache Struts2 远程代码执行

**漏洞编号:** CVE-2017-5638

**漏洞类型:** 远程代码执行

**影响应用:** Apache Struts2

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** 2.3.x before 2.3.32, 2.5.x before 2.5.10.1

**利用条件:** 目标系统运行存在漏洞版本的Apache Struts2，并且对外开放HTTP端口。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2017-5638 是 Apache Struts 2 Jakarta Multipart parser 中的一个远程代码执行漏洞。该漏洞是由于在文件上传过程中，对Content-Type、Content-Disposition或Content-Length HTTP header处理不当造成的，攻击者可以通过构造恶意的HTTP头部，利用OGNL表达式注入执行任意命令。

**有效性：** 根据提供的漏洞信息、搜索引擎结果以及漏洞利用代码，可以判断该POC代码是有效的。搜索引擎结果中包含多个关于CVE-2017-5638的PoC和分析，说明该漏洞已经被广泛研究和利用。POC代码通过构造包含恶意OGNL表达式的Content-Type头部，发送POST请求到存在漏洞的Apache Struts2应用，从而执行任意命令。

**投毒风险：**  分析提供的`exploit.py.txt`和`README.md`文件。`README.md`文件只是漏洞利用说明，不包含任何代码。`exploit.py.txt` 文件中的Python代码用于利用 CVE-2017-5638 漏洞。代码首先定义了目标URL和包含恶意 OGNL 表达式的 payload。Payload 构造了一个命令执行的 OGNL 表达式，并在目标系统上执行 `ls /` 命令，将输出返回到响应中。然后，它使用 `requests` 库发送一个包含恶意 header 的 POST 请求到目标 URL。代码没有发现任何隐藏的或恶意的后门或投毒代码。payload 的目的是执行命令，而不是植入长期存在的恶意代码。因此，投毒风险为0%。

**利用方式：**

1.  **构造恶意HTTP头部：** 攻击者构造包含恶意OGNL表达式的Content-Type、Content-Disposition或Content-Length HTTP头部。在该POC中，恶意代码位于Content-Type头中。
2.  **发送请求：** 攻击者将构造好的HTTP请求发送到存在漏洞的Apache Struts2应用。
3.  **命令执行：** Struts2应用在处理请求时，由于错误的异常处理和错误消息生成，会将恶意OGNL表达式解析并执行，从而导致远程代码执行。在该POC中，执行了`ls /`命令。
4.  **获取结果：** 攻击者从HTTP响应中获取命令执行的结果。

**项目地址:** [MuhammadAbdullah192/CVE-2017-5638-Remote-Code-Execution-Apache-Struts2-EXPLOITATION](https://github.com/MuhammadAbdullah192/CVE-2017-5638-Remote-Code-Execution-Apache-Struts2-EXPLOITATION)

**漏洞详情:** [CVE-2017-5638](https://nvd.nist.gov/vuln/detail/CVE-2017-5638)