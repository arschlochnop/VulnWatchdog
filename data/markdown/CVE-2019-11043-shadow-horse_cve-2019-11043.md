## CVE-2019-11043 PHP-FPM远程代码执行漏洞

**漏洞编号:** CVE-2019-11043

**漏洞类型:** 远程代码执行

**影响应用:** PHP-FPM

**危害等级:** 高危，允许攻击者执行任意代码

**影响版本:** PHP 7.1.x (< 7.1.33), 7.2.x (< 7.2.24), 7.3.x (< 7.3.11)

**利用条件:** Nginx + PHP-FPM配置，存在fastcgi_split_path_info指令，缺少文件存在性检查

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-11043 是一个 PHP-FPM 的远程代码执行漏洞。当 Nginx 配置不当时，攻击者可以通过发送特制的请求，利用 PHP-FPM 中的缓冲区溢出漏洞，执行任意代码。

**漏洞原理：**

该漏洞的核心在于 `fastcgi_split_path_info` 指令在处理包含换行符（`%0a`）的请求时，会导致 `PATH_INFO` 变量为空。而 PHP-FPM 在处理 `PATH_INFO` 为空的情况时存在缺陷，导致可以覆盖 FCGI 协议数据，从而实现远程代码执行。

**漏洞利用方式：**

1.  攻击者构造包含换行符的恶意 URL，例如 `index.php%0a`。
2.  Nginx 将该请求传递给 PHP-FPM。
3.  PHP-FPM 处理该请求时，由于 `PATH_INFO` 为空，触发漏洞。
4.  攻击者通过精心构造的请求数据，覆盖 FCGI 协议数据，执行任意代码。

**有效性：**

根据漏洞库信息和搜索结果，该漏洞的 POC 代码是有效的。该漏洞已经被公开利用，并且在某些特定配置下很容易被触发。

**投毒风险：**

该 POC 的主要功能是利用漏洞执行命令，本身不包含恶意代码。但考虑到代码的复杂性，以及攻击者可能修改代码以达到恶意目的，存在一定的投毒风险。初步评估投毒风险为10%。

**利用方式总结：**

该漏洞的利用方式是构造包含换行符的恶意 URL，触发 PHP-FPM 中的缓冲区溢出漏洞，覆盖 FCGI 协议数据，从而执行任意代码。利用条件是 Nginx + PHP-FPM 配置，存在 `fastcgi_split_path_info` 指令，并且缺少文件存在性检查，例如缺少 `try_files` 指令。


**项目地址:** [shadow-horse/cve-2019-11043](https://github.com/shadow-horse/cve-2019-11043)

**漏洞详情:** [CVE-2019-11043](https://nvd.nist.gov/vuln/detail/CVE-2019-11043)