## CVE-2022-46169-Cacti-命令注入

**漏洞编号:** CVE-2022-46169

**漏洞类型:** 命令注入

**影响应用:** Cacti

**危害等级:** 高危，未经身份验证的远程命令执行

**影响版本:** <= 1.2.22

**利用条件:** 需要Cacti服务器可访问，且存在action类型为POLLER_ACTION_SCRIPT_PHP（2）的poller_item配置

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-46169 存在于 Cacti 1.2.22 及更早版本中，是一个未经身份验证的远程命令注入漏洞。攻击者可以通过伪造HTTP头绕过身份验证，然后通过操纵`poller_id`参数在`remote_agent.php`文件中执行任意命令。PoC代码通过Python脚本实现，利用此漏洞获取反向shell。该仓库的主要功能是提供漏洞利用代码，但由于开源软件的性质，任何人都可能修改并重新发布。**投毒风险较低 (5%)**，主要是因为该项目结构简单、代码量小，且功能单一，主要代码集中在cve_2022_46169/main.py中。需要人工审核确认没有恶意代码被隐藏。尽管存在风险，但考虑到代码的直接性和漏洞利用的明确性，以及利用反向shell的常见性，可以判断该代码的投毒可能性较低。

**利用方式：**
1.  攻击者首先需要确定目标Cacti服务器的版本低于或等于1.2.22。
2.  攻击者发送特制的HTTP请求到`remote_agent.php`，包含伪造的`Forwarded-For`头，绕过身份验证。
3.  攻击者构造包含恶意命令的`poller_id`参数，并将其发送到`remote_agent.php`，触发命令注入。
4.  如果目标服务器存在`POLLER_ACTION_SCRIPT_PHP`类型的`poller_item`配置，攻击者的命令将被执行。
5.  PoC代码利用此漏洞创建一个反向shell，允许攻击者远程控制目标服务器。

**项目地址:** [BKreisel/CVE-2022-46169](https://github.com/BKreisel/CVE-2022-46169)

**漏洞详情:** [CVE-2022-46169](https://nvd.nist.gov/vuln/detail/CVE-2022-46169)