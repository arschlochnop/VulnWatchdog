## CVE-2017-10004

**漏洞编号:** CVE-2017-10004

**漏洞类型:** EL表达式注入/远程代码执行

**影响应用:** Oracle Sun Systems Products Suite (Solaris 组件), PrimeFaces

**危害等级:** 高危，可能导致服务器接管

**影响版本:** Solaris 10, 11; PrimeFaces 5.x

**利用条件:** Solaris: 高权限用户本地登录；PrimeFaces: 需要PrimeFaces 5.x应用存在且可访问

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

根据漏洞库信息，CVE-2017-10004是Oracle Solaris Kernel的一个高危漏洞，允许高权限本地用户通过利用该漏洞控制Solaris系统。根据搜索结果,得知该漏洞影响范围较大.

提供的漏洞利用代码实际上是PrimeFaces 5.x的EL表达式注入漏洞（CVE-2017-1000486）的利用代码，并非直接针对CVE-2017-10004，但间接可以说明，在2017年存在大量远程代码执行漏洞爆发的情况。该PrimeFaces漏洞的利用方式是，通过构造恶意的EL表达式，注入到PrimeFaces的动态内容处理功能中，从而执行任意系统命令。攻击者可以发送包含恶意EL表达式的POST请求到 `/javax.faces.resource/dynamiccontent.properties.xhtml` 类似的URL。

**有效性：** 提供的PrimeFaces漏洞利用代码（CVE-2017-1000486）有效，但它不是直接利用CVE-2017-10004。

**投毒风险：** 代码中主要关注以下几个点：

1.  **加密函数：** `encrypt` 函数使用DES加密，密钥硬编码为 `primefaces`，salt硬编码为 `\xA9\x9B\xC8\x32\x56\x34\xE3\x03`。这使得加密过程可预测，并不构成投毒。
2.  **Payload构造：** `encrypt_js_code` 和 `encrypt_os_command` 函数将用户提供的命令嵌入到EL表达式中，然后加密。如果用户提供恶意命令，则会执行恶意代码，但是这属于漏洞利用本身，而非代码投毒。
3.  **HTTP请求：** `send_request` 函数发送包含加密payload的POST请求。虽然可以设置代理，但这不是投毒，而是为了方便调试或绕过防火墙。
4.  **命令执行方式：** js payload会调用`java.lang.Runtime.getRuntime().exec()`来执行命令，该函数可以用来执行任意系统命令。 
5.  **输出方式：** 可以通过HTTP 响应头来获取执行结果，增加了隐蔽性。

综合分析，该代码的主要风险在于漏洞利用本身，而非代码投毒。作者可能在代码中留有后门，但是可能性较低，主要是因为代码功能相对简单，目标明确。不过，仍然存在一定的投毒风险，例如作者可以在加密函数中加入细微的修改，使得只有作者知道如何构造有效的payload。整体代码投毒概率评估为5%。

**利用方式：**

1.  确定目标系统运行的是受影响的PrimeFaces版本（5.x）。
2.  找到PrimeFaces的动态内容处理接口，通常是类似于 `/javax.faces.resource/dynamiccontent.properties.xhtml` 的URL。
3.  使用`primefaces.py`脚本，提供目标URL和要执行的命令。脚本会将命令嵌入到EL表达式中，加密，然后发送到目标URL。
4.  如果利用成功，命令的执行结果会出现在HTTP响应头中。

需要注意的是，该漏洞需要目标系统存在PrimeFaces应用，并且允许通过HTTP POST请求访问动态内容处理接口。

**项目地址:** [LongWayHomie/CVE-2017-1000486](https://github.com/LongWayHomie/CVE-2017-1000486)

**漏洞详情:** [CVE-2017-10004](https://nvd.nist.gov/vuln/detail/CVE-2017-10004)