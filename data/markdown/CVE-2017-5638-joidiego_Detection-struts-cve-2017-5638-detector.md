## CVE-2017-5638-Apache Struts远程代码执行

**漏洞编号:** CVE-2017-5638

**漏洞类型:** 远程代码执行(RCE)

**影响应用:** Apache Struts

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** 2.3.x before 2.3.32, 2.5.x before 2.5.10.1

**利用条件:** 需要目标系统运行存在漏洞的Apache Struts版本，并可以通过HTTP请求访问。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2017-5638是Apache Struts2 Jakarta Multipart parser中存在的一个远程代码执行漏洞。攻击者可以通过构造恶意的Content-Type、Content-Disposition或Content-Length HTTP头，利用OGNL表达式注入执行任意命令。

**有效性：**
根据漏洞库信息、搜索引擎结果（如NVD、Aon、Trend Micro等）以及Exploit-DB提供的PoC，该漏洞的利用是有效的。在实际环境中，CVE-2017-5638被广泛利用，造成了包括Equifax数据泄露在内的大规模安全事件。

**投毒风险：**
提供的代码库主要侧重于实时异常检测，而非直接的漏洞利用。它通过分析HTTP请求的3-gram特征，并使用Count-Min Sketch和KL散度来检测异常流量。虽然代码本身看起来没有明显的后门，但仍存在一些潜在风险，例如：

*   **依赖风险：** `requirements.txt` 如果包含恶意的第三方库，可能存在投毒风险。但提供的`requirements.txt`文件为空，降低了直接依赖投毒的风险。
*   **数据投毒：** 攻击者可能通过精心构造正常流量，污染Count-Min Sketch，降低检测准确性。由于系统依赖正常流量建立基线，通过大量伪装成正常的恶意请求，可能影响检测。
*   **日志记录：** 系统将检测结果记录到`data/detection.log`，如果日志配置不当，可能导致信息泄露或者日志文件被篡改。

综合评估，投毒风险较低，约为10%。

**利用方式：**
1.  攻击者发送包含恶意OGNL表达式的HTTP请求。
2.  恶意OGNL表达式位于Content-Type、Content-Disposition或Content-Length等HTTP头中。
3.  当Struts处理multipart请求时，解析这些HTTP头。
4.  Struts框架会执行恶意OGNL表达式，从而导致远程代码执行。

**缓解措施：**
*   升级Apache Struts到安全版本（>=2.3.32或>=2.5.10.1）。
*   使用Web应用防火墙（WAF）过滤恶意请求。
*   部署入侵检测系统（IDS）监控异常流量。
*   实施严格的输入验证和输出编码。

**项目地址:** [joidiego/Detection-struts-cve-2017-5638-detector](https://github.com/joidiego/Detection-struts-cve-2017-5638-detector)

**漏洞详情:** [CVE-2017-5638](https://nvd.nist.gov/vuln/detail/CVE-2017-5638)