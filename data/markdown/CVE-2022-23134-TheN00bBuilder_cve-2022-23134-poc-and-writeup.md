## CVE-2022-23134-Zabbix Frontend-身份验证绕过

**漏洞编号:** CVE-2022-23134

**漏洞类型:** 身份验证绕过

**影响应用:** Zabbix Frontend

**危害等级:** 中危，可能导致未经授权的配置更改和潜在的系统损害

**影响版本:** 5.4.0 - 5.4.8

**利用条件:** 需要目标Zabbix实例已完成初始设置，且攻击者能够访问setup.php页面。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2022-23134 允许未经身份验证的用户访问 Zabbix 前端的 setup.php 的某些步骤，即使在初始设置过程完成后也是如此。攻击者可以通过精心构造的请求绕过身份验证检查，并可能更改 Zabbix 前端的配置。

**利用方式：**

1.  攻击者向易受攻击的 Zabbix 前端实例发送一个 POST 请求到 setup.php。
2.  该请求包含一个特制的 `zbx_session` cookie，其中包含使用 URL 安全的 Base64 编码的数据库连接信息。这些信息包括数据库 IP 地址、端口、数据库名称、用户名和密码。
3.  `exploit.py` 脚本使用 `make_cookie` 函数创建此 cookie，该函数将数据库凭据信息格式化为字典，并对其进行 Base64 编码。
4.  该请求还包含一个 `sid` 参数和一个 `form_refresh` 参数，以及 `next[5]` 参数，用于模拟安装过程的下一步。
5.  由于 setup.php 没有正确验证会话或签名，攻击者可以绕过身份验证并访问配置页面。
6.  成功利用后，攻击者可以修改 Zabbix 前端配置，例如，将其指向由攻击者控制的恶意数据库。

**有效性评估：**

根据漏洞库信息、搜索引擎结果和提供的 PoC 代码，此漏洞是可以利用的。PoC 代码 (`exploit.py`) 演示了如何创建包含恶意数据库连接信息的 `zbx_session` cookie，并将其发送到 setup.php。如果请求成功，攻击者可以修改 Zabbix 前端的配置。

**投毒风险评估：**

虽然 PoC 代码本身旨在利用漏洞，但存在代码中隐藏恶意意图的可能性。检查 `exploit.py` 和 `writeup.md`，未发现明显的恶意代码。但是，谨慎起见，需要注意以下几点：

*   **依赖项：** 该脚本使用 `requests` 库。确保该库来自受信任的来源，以避免供应链攻击。
*   **数据库凭据：** 该脚本需要数据库凭据才能连接到目标数据库。确保这些凭据安全地存储，并且仅用于测试目的。
*   **调试输出：** 该脚本包含一个 `--debug` 标志，用于将响应文本写入 `exploit.html`。在生产环境中，应禁用此标志以避免信息泄露。
*   **随机数生成器：** 该脚本使用 `random.getrandbits` 函数生成会话 ID。虽然这对于 PoC 来说可能足够了，但在生产环境中，应使用更强的随机数生成器。
*   **总体分析:** 该POC较为简单,主要用于身份验证绕过.在代码层面未发现高危的恶意代码,但是不排除作者在其他文件中存在恶意代码的可能性,因此给出1%的投毒风险概率。

根据以上分析，该仓库的投毒风险较低，大概为1%。

**项目地址:** [TheN00bBuilder/cve-2022-23134-poc-and-writeup](https://github.com/TheN00bBuilder/cve-2022-23134-poc-and-writeup)

**漏洞详情:** [CVE-2022-23134](https://nvd.nist.gov/vuln/detail/CVE-2022-23134)