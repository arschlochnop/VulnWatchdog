## CVE-2024-2961-glibc-iconv 缓冲区溢出

**漏洞编号:** CVE-2024-2961

**漏洞类型:** 缓冲区溢出

**影响应用:** glibc

**危害等级:** 高危，可能导致应用崩溃或覆盖相邻变量，在特定情况下可能导致远程代码执行

**影响版本:** < 2.40

**利用条件:** 需要存在使用 iconv 函数，并且进行到 ISO-2022-CN-EXT 字符集的转换。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2024-2961 存在于 glibc 的 iconv() 函数中，当将字符串转换为 ISO-2022-CN-EXT 字符集时，可能会导致最多 4 字节的输出缓冲区溢出。该漏洞影响 2.39 及更早版本。从提供的漏洞利用代码来看，该脚本利用 PHP 的 filter chain 和 iconv 函数处理字符编码转换的缺陷，实现任意文件读取。脚本首先创建一个包含一系列 iconv 转换的 PHP 过滤器链 payload，该 payload 用于读取目标服务器上的任意文件。然后，脚本通过模拟图像上传，将 payload 隐藏在 POST 请求中，发送到目标服务器的 admin-ajax.php 端点。服务器处理请求后，脚本下载生成的文件，并提取显示目标文件的内容。

**有效性：**
根据CVE描述和搜索结果以及提供的漏洞利用代码，此漏洞利用的有效性较高。CISA ADP 将其标记为“poc”，且存在利用的技术可行性。

**投毒风险：**
提供的代码主要包含一个 Python 脚本 (lfi.py) 和一个 README.md 文件。Python 脚本的功能是利用 CVE-2024-2961 漏洞读取远程文件。检查脚本发现其主要是构造恶意的字符转换，没有明显的恶意代码或者后门。脚本依赖于特定的目标 URL 和请求头，这些信息需要在实际使用前进行配置。脚本本身较为直接，没有发现隐藏的投毒代码。

**利用方式：**
利用方式是通过构造特定的 PHP 过滤器链，借助 iconv 函数在字符集转换过程中触发缓冲区溢出，从而读取服务器上的任意文件。


**项目地址:** [kyotozx/CVE-2024-2961-Remote-File-Read](https://github.com/kyotozx/CVE-2024-2961-Remote-File-Read)

**漏洞详情:** [CVE-2024-2961](https://nvd.nist.gov/vuln/detail/CVE-2024-2961)