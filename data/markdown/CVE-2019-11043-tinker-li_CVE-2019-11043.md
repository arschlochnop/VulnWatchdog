## CVE-2019-11043-PHP-FPM远程代码执行

**漏洞编号:** CVE-2019-11043

**漏洞类型:** 缓冲区溢出导致的远程代码执行

**影响应用:** PHP-FPM (与 Nginx 配合使用)

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** PHP 7.1.x (< 7.1.33), 7.2.x (< 7.2.24), 7.3.x (< 7.3.11)

**利用条件:** 需要特定的 Nginx + PHP-FPM 配置，即存在 'try_files $uri =404' 或 'if (-f $uri)' 的错误配置。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-11043 漏洞是 PHP-FPM 中的一个缓冲区下溢漏洞，当 PHP-FPM 与 Nginx 配合使用，并且 Nginx 配置不当（例如，未使用 `try_files` 指令正确检查文件是否存在）时，攻击者可以通过构造恶意的请求，导致 PHP-FPM 在写入 FCGI 协议数据时超出分配的缓冲区，从而可能实现远程代码执行。

**有效性：**
根据漏洞库信息和搜索结果，此漏洞影响特定版本的 PHP-FPM。漏洞利用代码 `https://github.com/neex/phuip-fpizdam/` 是公开可用的，证明了漏洞的可利用性。大量搜索结果也验证了此漏洞的存在和危害。

**投毒风险：**
提供的漏洞利用代码仅包含官方更新通告和开源社区介绍的链接，本身不包含任何可疑代码。但是，任何时候使用第三方提供的利用代码都存在潜在风险，例如，攻击者可能在代码中植入后门。因此，存在一定的投毒风险，粗略估计大约为10%。使用前应仔细审查代码。

**利用方式：**
1.  **目标确认：** 确定目标服务器运行着受影响版本的 PHP-FPM，并且使用了存在缺陷的 Nginx 配置。
2.  **构造恶意请求：** 攻击者构造包含特定长度查询字符串的 URL，利用 PHP-FPM 的 `env_path_info` 处理过程中的下溢漏洞。
3.  **缓冲区溢出：**  通过精心设计的请求，覆盖 FCGI 协议数据，控制部分 FPM 进程的内存。
4.  **远程代码执行：**  最终目标是利用内存覆盖，执行任意代码，从而控制服务器。具体方法可能包括覆盖关键函数指针等。
5.  **phuip-fpizdam工具:** `phuip-fpizdam`工具可以自动化构造恶意请求，并尝试利用该漏洞。

**项目地址:** [tinker-li/CVE-2019-11043](https://github.com/tinker-li/CVE-2019-11043)

**漏洞详情:** [CVE-2019-11043](https://nvd.nist.gov/vuln/detail/CVE-2019-11043)