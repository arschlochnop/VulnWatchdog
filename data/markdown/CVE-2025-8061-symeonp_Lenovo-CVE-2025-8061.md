## CVE-2025-8061-Lenovo Dispatcher Driver-权限提升

**漏洞编号:** CVE-2025-8061

**漏洞类型:** 权限提升

**影响应用:** Lenovo Dispatcher 3.0/3.1 Driver

**危害等级:** 高危，允许本地用户以提升的权限执行代码

**影响版本:** < 3.1.0.41

**利用条件:** 需要本地用户权限，目标系统安装了受影响的 Lenovo Dispatcher 驱动程序版本，并且Windows Core Isolation Memory Integrity 功能未启用。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2025-8061 是 Lenovo Dispatcher 3.0 和 3.1 驱动程序中存在的一个权限提升漏洞。该漏洞源于驱动程序对访问控制的不足，允许经过身份验证的本地用户利用该漏洞以提升的权限执行代码。从提供的漏洞利用代码来看，该 POC 针对 LnvMSRIO.sys (3.1.0.36) 驱动程序，利用不足的访问控制实现提权。

**有效性评估:**

提供的 POC 代码似乎是有效的，但需要注意的是，代码中硬编码了特定 Windows 版本的偏移量（Edition build lab: 26100.1.amd64fre.ge_release.240331-1435）。这意味着如果目标系统的 Windows 版本不同，需要修改这些偏移量，否则无法成功利用。

POC 代码包括以下关键步骤：

1.  **禁用 SMEP (Supervisor Mode Execution Prevention):**  攻击者需要禁用 SMEP 以执行 shellcode。这涉及到修改 CR4 寄存器。
2.  **ASLR (Address Space Layout Randomization) 绕过：**  虽然作者提到技术上没有 ASLR 绕过，但他提供了寻找 `KiSystemCall64Shadow` 地址的技术，比如特征扫描和使用已知函数间的偏移。 这对于在内核中找到关键函数的地址至关重要。
3.  **Token Stealing Shellcode:**  该 shellcode 负责窃取系统 token，从而获得系统权限。提供的 shellcode 示例需要根据目标系统的 `nt!_KPCR` 结构进行调整。

**投毒风险评估:**

考虑到以下因素，投毒风险较低：

*   POC 代码相对复杂，需要用户进行修改和调试，增加了代码审查的可能性。
*   POC 的主要逻辑（禁用 SMEP、绕过 ASLR、token stealing）是常见的提权利用技术，代码本身没有明显的恶意行为。
*   作者提到了调试和修改偏移量的必要性，这表明作者预期用户会仔细检查代码。

但是，仍然存在一定程度的风险：

*   如果攻击者修改了 shellcode，例如添加了持久化后门或其他恶意功能，则可能存在投毒行为。
*   不熟悉内核漏洞利用的用户可能会盲目地运行代码，而没有进行充分的安全审查。

综合评估，投毒风险约为 10%。这是因为该仓库中作者编写了使用说明文档,并且文档中说明编译需要修改的参数,以及使用方法,增加的审查可能性,降低的投毒的可能性。

**利用方式总结:**

1.  **前提条件：** 本地用户权限，目标系统安装了受影响的 Lenovo Dispatcher 驱动程序版本，并且 Windows Core Isolation Memory Integrity 功能未启用。
2.  **信息收集：** 确定目标系统的 Windows 版本，找到 `KiSystemCall64` 和其他关键内核数据结构的地址和偏移量。
3.  **配置 POC：** 修改 POC 代码，设置正确的偏移量和参数。
4.  **禁用 SMEP：** 修改 CR4 寄存器，禁用 SMEP。
5.  **执行 POC：** 运行 POC 代码，利用 `LnvMSRIO.sys` 驱动程序的漏洞，执行 token stealing shellcode。
6.  **提权：** 成功执行 shellcode 后，当前进程将获得系统权限，攻击者可以执行任意代码。



**项目地址:** [symeonp/Lenovo-CVE-2025-8061](https://github.com/symeonp/Lenovo-CVE-2025-8061)

**漏洞详情:** [CVE-2025-8061](https://nvd.nist.gov/vuln/detail/CVE-2025-8061)