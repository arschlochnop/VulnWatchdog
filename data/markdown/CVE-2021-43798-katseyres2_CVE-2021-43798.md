## CVE-2021-43798-Grafana-目录遍历

**漏洞编号:** CVE-2021-43798

**漏洞类型:** 目录遍历

**影响应用:** Grafana

**危害等级:** 高危，可能导致敏感信息泄露

**影响版本:** 8.0.0-beta1 to 8.3.0 (except for patched versions)

**利用条件:** 需要能够访问 Grafana 服务，无需身份验证。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

根据漏洞库信息、搜索引擎结果和提供的漏洞利用代码，分析如下：

**1. 有效性：**

提供的Python脚本利用了 CVE-2021-43798 漏洞，该漏洞允许未经身份验证的攻击者通过目录遍历读取 Grafana 服务器上的任意文件。脚本首先检查 Grafana 的版本是否在受影响的范围内，然后构造包含目录遍历序列的 URL，尝试读取 `/etc/passwd`（在 Linux 上）或 `Windows\System32\drivers\etc\hosts`（在 Windows 上）文件。因此，提供的POC代码在目标存在漏洞的情况下，可以有效读取目标文件。

**2. 投毒风险：**

仔细分析提供的Python脚本代码，没有发现任何可疑的后门代码或恶意行为。脚本的功能完全集中在利用目录遍历漏洞读取文件上。所有操作均在预期之内，没有发现任何隐藏的恶意功能。例如，脚本没有尝试修改任何文件、建立反向shell或执行任何其他未经授权的操作。基于此，可以认为该POC代码不存在投毒风险。

**3. 利用方式：**

漏洞的利用方式如下：

1.  **确定目标 Grafana 版本：** 通过访问 `/api/health` 端点获取 Grafana 的版本信息。
2.  **构造恶意 URL：** 使用以下格式构造 URL：`grafana_host_url/public/plugins/<plugin_id>/<path_traversal>`，其中 `<plugin_id>` 可以是任意已安装插件的 ID（例如 `alertlist`），`<path_traversal>` 是包含目录遍历序列（例如 `../../../../`）和目标文件路径的字符串。
3.  **发送 HTTP 请求：** 向构造的恶意 URL 发送 HTTP GET 请求。
4.  **读取文件内容：** Grafana 将返回目标文件的内容。

**总结：**

提供的POC代码是有效的，不存在投毒风险，并且准确地实现了 CVE-2021-43798 漏洞的利用。攻击者可以通过该漏洞读取 Grafana 服务器上的任意文件，从而可能泄露敏感信息，例如数据库凭据、API 密钥和配置文件。

**项目地址:** [katseyres2/CVE-2021-43798](https://github.com/katseyres2/CVE-2021-43798)

**漏洞详情:** [CVE-2021-43798](https://nvd.nist.gov/vuln/detail/CVE-2021-43798)