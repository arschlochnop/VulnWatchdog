## CVE-2023-23397-Microsoft Outlook 权限提升漏洞

**漏洞编号:** CVE-2023-23397

**漏洞类型:** 权限提升

**影响应用:** Microsoft Outlook

**危害等级:** 严重，可能导致Net-NTLM哈希泄露，攻击者可冒充受害者身份。

**影响版本:** 受影响版本包括Microsoft Outlook 2013 SP1, 2016, 2019, Office LTSC 2021和Microsoft 365 Apps for Enterprise的特定版本

**利用条件:** 攻击者需要能够发送电子邮件给受害者，并且受害者需要使用存在漏洞的Outlook客户端打开邮件。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-23397是一个Microsoft Outlook权限提升漏洞。该漏洞的利用方式是攻击者发送一封特制的电子邮件，其中包含指向攻击者控制的SMB服务器的UNC路径，当受害者使用存在漏洞的Outlook客户端打开该邮件时，会自动尝试连接到该SMB服务器，并将受害者的Net-NTLM哈希发送给攻击者。攻击者可以使用该哈希进行NTLM中继攻击，从而冒充受害者的身份。

根据提供的漏洞利用代码，该代码通过Python脚本生成包含恶意音频文件链接的Outlook日历邀请（appointment）。当受害者打开该邀请时，Outlook会尝试访问该链接，从而触发NTLM认证并泄露哈希值。

**有效性：**
根据漏洞库信息和搜索结果，此漏洞已被积极利用，并且存在公开的PoC代码。因此，提供的PoC代码在一定条件下是有效的。

**投毒风险：**
提供的PoC代码中，主要操作是构造恶意的Outlook日历邀请并发送给目标用户。代码包含发送邮件功能，这需要配置SMTP服务器的地址、端口、用户名和密码。潜在的投毒风险在于：
1.  **SMTP服务器配置:** 如果攻击者诱导用户使用其控制的SMTP服务器，则可能拦截或篡改发送的邮件。
2.  **附件路径:**  `full_path = f'\\\{path}\sound.wav'` 这行代码定义了SMB共享的路径。攻击者可能尝试通过精心构造路径，执行其他恶意操作。例如，如果Outlook客户端对UNC路径处理不当，可能导致文件读取或执行。
3.  **依赖库安全:**  虽然代码本身相对简单，但需要依赖Python环境和第三方库，这些依赖库可能存在安全漏洞。检查库的完整性。

代码中存在使用恶意SMB共享的风险，该路径可能会包含恶意payload或引发其他问题。因此判定存在10%的投毒风险，主要集中在引导用户设置攻击者控制的SMB服务器以及SMTP服务器。

**利用方式：**
1.  攻击者设置一个SMB服务器，并放置一个任意的音频文件（例如sound.wav）。
2.  攻击者运行提供的Python脚本，指定SMB服务器的IP地址和一个包含目标邮箱地址的文本文件。
3.  脚本会构造包含指向SMB服务器上音频文件的日历邀请，并将其发送给目标邮箱。
4.  当目标用户使用存在漏洞的Outlook客户端打开该日历邀请时，Outlook会自动尝试连接到SMB服务器以下载音频文件。
5.  由于SMB协议的认证机制，Outlook会将目标用户的Net-NTLM哈希发送给SMB服务器。
6.  攻击者可以在SMB服务器上捕获该哈希，并使用其进行NTLM中继攻击或其他攻击。


**项目地址:** [TheUnknownSoul/CVE-2023-23397-PoW](https://github.com/TheUnknownSoul/CVE-2023-23397-PoW)

**漏洞详情:** [CVE-2023-23397](https://nvd.nist.gov/vuln/detail/CVE-2023-23397)