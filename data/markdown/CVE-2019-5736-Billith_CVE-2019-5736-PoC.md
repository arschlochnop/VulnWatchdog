## CVE-2019-5736-runc容器逃逸

**漏洞编号:** CVE-2019-5736

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可导致宿主机root权限被获取

**影响版本:** <= 1.0-rc6

**利用条件:** 攻击者需要在容器内有执行权限，且宿主机运行着存在漏洞的runc版本

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-5736 漏洞允许攻击者通过利用文件描述符处理不当的问题，覆盖宿主机上的 `runc` 二进制文件，从而获得宿主机的 root 权限。利用方式如下：

1.  **漏洞原理：** 容器启动或执行 `docker exec` 等命令时，`runc` 会被调用。攻击者通过在容器内构造恶意程序，修改 `/proc/self/exe` 指向的 `runc` 二进制文件。
2.  **利用步骤：**
    *   首先，攻击者需要在一个具有写权限的容器内。
    *   攻击者需要将容器内的 `/bin/sh` 或其他会被 `docker exec` 调用的程序替换为 `#!/proc/self/exe`。这样，当管理员执行 `docker exec` 命令时，实际上会执行 `runc` 二进制文件。
    *   攻击者运行提供的 PoC 代码。该 PoC 代码会不断地尝试打开 `/proc/<pid>/exe` (宿主机的runc程序) 并写入恶意代码。其中`<pid>` 是目标runc进程的进程ID
    *   当管理员在宿主机上使用 `docker exec` 命令进入容器时，实际上会调用被篡改的 `runc`，此时PoC会向runc程序写入bash脚本。
    *   下一次 `runc` 被调用时，执行的就是被篡改后的代码，攻击者即可在宿主机上执行任意命令，从而获取 root 权限。

3.  **有效性评估：** 提供的 PoC 代码是有效的，它演示了如何利用该漏洞覆盖宿主机上的 `runc` 二进制文件。
4.  **投毒风险分析：** 提供的 PoC 代码没有明显的投毒代码。PoC 的目的是覆盖 `runc` 文件为一段 bash 脚本。

**总结：** 该漏洞危害巨大，利用条件相对简单，容易被攻击者利用进行容器逃逸，需要及时升级 `runc` 版本或者采用缓解措施。

**项目地址:** [Billith/CVE-2019-5736-PoC](https://github.com/Billith/CVE-2019-5736-PoC)

**漏洞详情:** [CVE-2019-5736](https://nvd.nist.gov/vuln/detail/CVE-2019-5736)