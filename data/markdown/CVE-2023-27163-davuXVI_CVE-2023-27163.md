## CVE-2023-27163-Request-Baskets-SSRF

**漏洞编号:** CVE-2023-27163

**漏洞类型:** SSRF (服务器端请求伪造)

**影响应用:** Request Baskets

**危害等级:** 高危，可能导致内部网络信息泄露、敏感信息访问，甚至远程代码执行。

**影响版本:** <= 1.2.1

**利用条件:** 目标服务器运行Request Baskets，并且攻击者能够发送HTTP请求到目标服务器。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-27163 是 Request Baskets 1.2.1 及更早版本中的一个服务器端请求伪造 (SSRF) 漏洞。该漏洞存在于 `/api/baskets/{name}` 组件中。攻击者可以通过构造恶意的 API 请求，利用 `forward_url` 参数发起对内部或外部资源的请求。

**漏洞利用方式：**

1.  攻击者创建一个新的 basket，并在创建时通过 `forward_url` 指定一个恶意 URL。Request Baskets 将会尝试请求这个 URL。
2.  攻击者可以利用此漏洞读取内部服务的信息，例如元数据 API、数据库等。
3.  结合其他漏洞，例如利用Request Basket的路径遍历，在`rce_end`函数中通过python开启web服务，利用`wget`来执行攻击者服务器上的shell脚本`rev.sh`，从而实现远程代码执行。

**有效性：**

提供的PoC 代码看起来是有效的。该脚本接受目标 IP 地址、转发 IP 地址和攻击者 IP 地址作为参数。它首先创建一个带有 `forward_url` 的 basket，然后通过HTTP服务暴露反弹shell脚本，并通过request basket的路径遍历漏洞和wget命令执行反弹shell，实现RCE。

**投毒风险：**

该脚本的主要目的是利用 SSRF 漏洞实现 RCE，其中`my_script.sh`脚本在`/tmp/5d6d5c10a3b6d097d6e642a3dc9d71b8/my_script_CVE-2023-27163.sh`文件中。

*   **轻微的投毒可能:** 代码中存在使用 Python 启动 HTTP 服务器并执行 shell 命令的部分，如果攻击者的服务器被攻陷，可能会导致受害者下载并执行恶意的 shell 脚本，造成进一步的损害。或者反弹shell的ip地址被替换为恶意地址。
*   **可疑之处:**  脚本将反弹 shell 命令写入 `rev.sh` 文件，然后通过 Python 的 `http.server` 模块提供该文件。虽然这是一个利用漏洞的正常步骤，但也可能被用于传播恶意代码。

由于脚本需要用户提供攻击者的 IP 地址，并且主要目的是为了利用漏洞，因此投毒的概率相对较低，估计在 10% 左右。

**项目地址:** [davuXVI/CVE-2023-27163](https://github.com/davuXVI/CVE-2023-27163)

**漏洞详情:** [CVE-2023-27163](https://nvd.nist.gov/vuln/detail/CVE-2023-27163)