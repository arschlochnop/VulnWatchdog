## CVE-2025-24813 - Apache Tomcat 远程代码执行/信息泄露

**漏洞编号:** CVE-2025-24813

**漏洞类型:** 路径等价/反序列化

**影响应用:** Apache Tomcat

**危害等级:** 高危，可能导致远程代码执行和信息泄露

**影响版本:** Apache Tomcat 9.0.0.M1 - 9.0.98, 10.1.0-M1 - 10.1.34, 11.0.0-M1 - 11.0.2

**利用条件:** 默认Servlet开启写入(默认关闭), 开启Partial PUT (默认开启), 应用使用基于文件的session持久化(默认位置), 应用包含可用于反序列化攻击的库

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2025-24813 是 Apache Tomcat 中的一个漏洞，利用了路径等价性（内部点，例如 `file.Name`）结合启用了写入功能的默认 Servlet 和 Partial PUT 功能。该漏洞可能导致远程代码执行（RCE）、信息泄露或将恶意内容添加到上传的文件中。

**漏洞利用方式:**

1.  **前提条件:** 漏洞利用需要满足以下条件：
    *   默认 Servlet 开启写入 (disabled by default).
    *   支持 Partial PUT (enabled by default).
    *   对于RCE，应用需要使用 Tomcat 基于文件的 session 持久化，并且包含一个可以被反序列化攻击利用的库（例如，存在于classpath中的commons-collections）。
    *   对于信息泄露/文件篡改，需要攻击者了解敏感文件的上传目标 URL 位于公共上传目标 URL 的子目录下，且攻击者需要知道上传的敏感文件名，且敏感文件通过partial PUT上传。
2.  **漏洞利用步骤:**
    *   **获取 Session ID:** 攻击者首先需要获取一个有效的 JSESSIONID，可以通过访问 `/index.jsp` 获取，如果无法获取则使用默认值。
    *   **测试 PUT 方法:** 攻击者发送一个 PUT 请求来确认目标服务器是否允许使用 `Content-Range` 进行部分写入。
    *   **生成 Payload:**  攻击者使用 `ysoserial` 或者 Java 代码生成一个恶意的序列化对象。`ysoserial` 通过指定的 gadget（例如 `CommonsCollections6`）来执行命令。也可以生成一个包含恶意命令执行的Java .jar文件。
    *   **上传 Payload:**  攻击者利用路径遍历将 payload 上传到 Tomcat 的 session 目录。例如，`/uploads/../sessions/{JSESSIONID}.session`。
    *   **触发执行:**  攻击者使用包含恶意 JSESSIONID 的请求来访问应用程序。Tomcat 将会反序列化该 session 文件，从而执行攻击者注入的命令。

**有效性:**

根据漏洞库信息、搜索结果和提供的漏洞利用代码，该漏洞的 POC 代码**有效**。搜索结果中提到了该漏洞已被积极利用。提供的 POC 代码包含利用该漏洞进行 RCE 的 Python 脚本，并提供了详细的利用步骤和参数说明。

**投毒风险:**

评估提供的 POC 代码，投毒风险较低，约为 **10%**。主要考虑因素如下：

*   **代码结构:** 代码结构较为清晰，主要分为获取 Session ID、验证 PUT 方法、生成 Payload 和发送 Payload 等几个模块。
*   **依赖项:**  代码依赖 `ysoserial.jar`，这本身是一个已知的漏洞利用工具，如果攻击者替换了 `ysoserial.jar` 文件，则可能引入恶意代码。此外，java payload方式需要服务器具有java编译环境。
*   **潜在风险:**  `java_payload` 函数中使用 `Runtime.getRuntime().exec(c)` 直接执行命令，如果命令字符串 `cmd` 构造不当，可能会存在命令注入的风险。
*   **作者声明:**  README 文件中包含免责声明，说明该代码仅用于教育目的，这在一定程度上降低了作者进行恶意投毒的可能性。

总的来说，虽然代码本身看起来没有明显的恶意行为，但仍然需要谨慎使用，并确保从可信的来源获取 `ysoserial.jar`，并仔细检查命令字符串，避免引入额外的安全风险。 java payload方式需要服务器具有java编译环境,具有一定局限性。

**项目地址:** [137f/Poc-CVE-2025-24813](https://github.com/137f/Poc-CVE-2025-24813)

**漏洞详情:** [CVE-2025-24813](https://nvd.nist.gov/vuln/detail/CVE-2025-24813)