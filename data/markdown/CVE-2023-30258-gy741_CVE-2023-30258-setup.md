## CVE-2023-30258-MagnusBilling-命令注入

**漏洞编号:** CVE-2023-30258

**漏洞类型:** 命令注入

**影响应用:** MagnusBilling

**危害等级:** 高危，允许未经身份验证的远程攻击者执行任意操作系统命令

**影响版本:** 6.x 和 7.x

**利用条件:** 需要能够通过HTTP请求访问目标MagnusBilling实例

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-30258 是 MagnusBilling 6.x 和 7.x 版本中的一个命令注入漏洞。攻击者可以通过发送恶意的HTTP请求，在未经身份验证的情况下执行任意操作系统命令。 

**漏洞利用有效性：**

从搜索结果和漏洞库信息来看，该漏洞是真实存在的，并且允许未经身份验证的远程命令执行。Metasploit 已经包含了该漏洞的利用模块，进一步证明了其有效性。

**投毒风险分析：**

提供的漏洞利用代码（install.sh）实际上是一个安装脚本，用于安装MagnusBilling。它包含了设置时区、生成数据库密码、配置数据库和Web服务器等操作。该脚本的主要目的是部署和配置 MagnusBilling 系统，而不是直接利用 CVE-2023-30258 漏洞。 脚本本身存在一定的风险，例如：

*   **弱密码生成:** 脚本使用 `genpasswd` 函数生成密码，但可能生成相对较弱的密码，容易被破解。如果密码强度不足，则容易被暴力破解，导致服务器被入侵，但是这属于软件自身的安全性问题，不算恶意投毒。
*   **SELinux配置 (CentOS):** 脚本尝试禁用SELinux，这会降低系统的安全性，增加其他潜在漏洞被利用的风险。虽然有安全风险，但目标是简化安装，不属于恶意投毒行为。
*   **外部源依赖:** 脚本依赖于外部源（例如MariaDB的YUM仓库），如果这些源被篡改，可能会导致安装恶意软件包。尽管如此，这取决于外部源的安全性，不是作者的恶意投毒行为。 
*   **时区设置的交互式shell:** 代码存在交互式shell, 可能会通过交互式shell植入后门,有一定的风险。

总的来说，install.sh 脚本本身是为了方便安装和配置 MagnusBilling，虽然存在一些安全隐患，但没有明显的恶意投毒代码。

**利用方式：**

根据漏洞信息，攻击者通过构造特定的HTTP请求，将恶意命令注入到MagnusBilling的某个参数中。由于程序没有对该参数进行充分的过滤和验证，导致系统直接执行攻击者注入的命令。具体的注入点和利用方式需要分析MagnusBilling的代码才能确定，但从搜索结果中可以推断出该漏洞存在于处理HTTP请求的某个模块。

综上，此仓库中存在作者隐藏的投毒代码的可能性较小，大概在 5% 左右，主要风险在于安装脚本可能降低系统安全性或存在依赖外部源的风险。

**项目地址:** [gy741/CVE-2023-30258-setup](https://github.com/gy741/CVE-2023-30258-setup)

**漏洞详情:** [CVE-2023-30258](https://nvd.nist.gov/vuln/detail/CVE-2023-30258)