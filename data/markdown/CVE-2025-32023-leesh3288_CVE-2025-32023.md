## CVE-2025-32023 Redis HyperLogLog 整数溢出导致OOB写

**漏洞编号:** CVE-2025-32023

**漏洞类型:** 整数溢出, 堆/栈溢出

**影响应用:** Redis

**危害等级:** 高危，可导致远程代码执行

**影响版本:** >= 2.8 且 < 8.0.3, 7.4.5, 7.2.10, 6.2.19

**利用条件:** 需要能与Redis服务器建立连接

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2025-32023是Redis中HyperLogLog数据结构处理不当导致的整数溢出漏洞。当Redis使用稀疏编码存储HyperLogLog时，在`hllMerge`函数中计算run lengths的总和时，如果HLL数据结构被恶意构造，可能导致整数溢出，使得索引`i`变为负数。这会导致对HLL结构体进行负偏移的写入，造成堆/栈溢出，最终导致远程代码执行。

**漏洞利用方式：**

1.  **构造恶意HLL数据：** 攻击者需要构造一个恶意的稀疏编码的HyperLogLog数据，其中包含超长的run lengths，以便在`hllMerge`函数中触发整数溢出。
2.  **触发整数溢出：** 通过`PFCOUNT`命令合并恶意构造的HLL数据，触发`hllMerge`函数中的整数溢出。
3.  **内存破坏：** 整数溢出导致负偏移写入，破坏堆或栈上的数据结构。
4.  **RCE：** 利用内存破坏实现任意代码执行。利用代码中展示了通过篡改SDS对象，进而伪造module对象，最终利用module的卸载触发RCE的经典redis利用方法。

**投毒风险分析：**

代码仓库中主要包含POC和利用代码，用于验证和利用该漏洞。其中`poc.py`用于触发整数溢出，`solver-f0b22e429fa6c984f39a409744ff954d3a45d843edd29428ef3a68085d696a7d.py`包含了更完善的exploit，实现了泄露地址，伪造module对象等步骤。

投毒风险较低（5%）。虽然攻击者可能在利用代码中加入恶意指令，例如在RCE阶段执行恶意shell命令。但是此漏洞的利用需要对redis内部结构有较深入的了解，且exp编写难度较高，因此不太可能出现通用的，隐蔽性强的后门代码。`solver-f0b22e429fa6c984f39a409744ff954d3a45d843edd29428ef3a68085d696a7d.py` 中存在硬编码的偏移量(0xc000, 0x956c)，这可能导致exp在不同版本/环境的redis上运行失败，但不能算是投毒代码。因此判断投毒风险较低。

**项目地址:** [leesh3288/CVE-2025-32023](https://github.com/leesh3288/CVE-2025-32023)

**漏洞详情:** [CVE-2025-32023](https://nvd.nist.gov/vuln/detail/CVE-2025-32023)