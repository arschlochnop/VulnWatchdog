## CVE-2024-36401-GeoServer-RCE

**漏洞编号:** CVE-2024-36401

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** GeoServer

**危害等级:** 高危，未经身份验证的远程代码执行

**影响版本:** < 2.22.6, >= 2.23.0 < 2.23.6, >= 2.24.0 < 2.24.4, >= 2.25.0 < 2.25.2

**利用条件:** 默认GeoServer安装，可通过WFS GetFeature, WFS GetPropertyValue, WMS GetMap, WMS GetFeatureInfo, WMS GetLegendGraphic 和 WPS Execute请求进行利用

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-36401是GeoServer中的一个远程代码执行漏洞，由于GeoTools库不安全地将属性名称作为XPath表达式传递给commons-jxpath库导致的。未经身份验证的攻击者可以利用此漏洞通过构造恶意的OGC请求来执行任意代码。

**有效性：**

根据漏洞库信息和搜索结果，该漏洞已在野外被利用，并且存在公开的POC。提供的漏洞利用代码是一个Woodpecker插件，它支持批量探测和利用该漏洞，包括执行任意命令和注入内存马。该插件使用Java编写，并且提供了详细的使用说明，表明其有效性较高。

**投毒风险：**

该代码主要功能是漏洞利用，内存马注入，但是自定义内存马部分存在风险,如果被替换成恶意代码，可能存在投毒行为，因此风险为10%。

**利用方式：**

1.  **漏洞触发：** 攻击者通过构造恶意的OGC请求（例如WFS GetFeature, WFS GetPropertyValue, WMS GetMap, WMS GetFeatureInfo, WMS GetLegendGraphic 和 WPS Execute请求），将恶意XPath表达式传递给GeoServer。
2.  **XPath注入：** GeoServer使用GeoTools库处理OGC请求中的属性名称。GeoTools库不安全地将这些属性名称传递给commons-jxpath库进行处理。
3.  **代码执行：** commons-jxpath库将恶意XPath表达式作为代码执行，导致远程代码执行。
4.  **内存马注入（可选）：** 攻击者可以使用该漏洞注入内存马，以便在目标服务器上持久化控制。

**总结：** CVE-2024-36401是一个高危的远程代码执行漏洞，易于利用且影响广泛。建议受影响的用户尽快升级到安全版本或采取缓解措施（例如删除`gt-complex-x.y.jar`文件）。提供的POC代码可以有效利用该漏洞，但也应谨慎使用，以避免潜在的恶意代码风险。

**项目地址:** [thestar0/CVE-2024-36401-WoodpeckerPlugin](https://github.com/thestar0/CVE-2024-36401-WoodpeckerPlugin)

**漏洞详情:** [CVE-2024-36401](https://nvd.nist.gov/vuln/detail/CVE-2024-36401)