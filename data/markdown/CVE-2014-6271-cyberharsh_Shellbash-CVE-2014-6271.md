## CVE-2014-6271 Shellshock

**漏洞编号:** CVE-2014-6271

**漏洞类型:** 远程代码执行

**影响应用:** GNU Bash

**危害等级:** 高危，可能导致远程代码执行和系统控制

**影响版本:** through 4.3

**利用条件:** 目标系统使用CGI，OpenSSH等方式，且Bash版本在受影响范围内

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2014-6271，又名Shellshock，是一个存在于GNU Bash中的高危漏洞。该漏洞允许攻击者通过特制的、包含恶意代码的环境变量，在目标系统上执行任意命令。漏洞利用的方式是：通过将包含函数定义的恶意字符串作为环境变量的值传递给Bash，Bash在解析这些环境变量时，会错误地执行函数定义后面的命令。漏洞利用代码分析：提供的Dockerfile构建了一个包含易受攻击的Bash版本（4.3.0）和Apache HTTP Server的Docker镜像。`safe.cgi`和`victim.cgi`脚本被添加到`/var/www/html/`目录下。`victim.cgi`使用易受攻击的Bash版本，而`safe.cgi` 使用修复后的版本（但提供的代码中，两个cgi都一样，都是直接输出helloworld）。攻击者可以通过修改User-Agent头，或者通过其他CGI变量传递恶意代码，从而在服务器上执行命令。根据readme.md的描述，向victim.cgi发送包含payload的User-Agent，可以触发漏洞。例如：

`User-Agent: () { foo; }; echo Content-Type: text/plain; echo; /usr/bin/id`

该漏洞利用的有效性较高，因为漏洞原理简单，且影响范围广泛。**投毒风险评估：**代码仓库中可能存在作者隐藏的恶意代码的风险较低，这里评估为1%。主要原因是：Dockerfile比较简单，只是构建了一个包含特定版本Bash和Apache HTTP Server的镜像，没有发现明显的后门代码。safe.cgi和victim.cgi 脚本本身也比较简单，只是输出“Hello world”，并没有包含任何可疑的逻辑。flagA文件只是一个标记文件，不包含任何可执行代码。虽然不能完全排除作者在镜像构建过程中隐藏恶意代码的可能性，但从目前的代码来看，这种可能性很小。

**利用方式总结：**

1.  **确定目标系统使用的Bash版本在受影响范围内（<=4.3）。**
2.  **找到一个可以设置环境变量的入口点，例如CGI脚本、OpenSSH的ForceCommand等。**
3.  **构造包含恶意代码的环境变量，例如：`() { :; }; /usr/bin/id`。**
4.  **将该环境变量传递给Bash。**
5.  **Bash解析环境变量时，会执行恶意代码。**

利用代码中的`victim.cgi`脚本是一个CGI入口点，攻击者可以通过修改HTTP请求头（例如User-Agent）来设置环境变量，从而触发漏洞。

**项目地址:** [cyberharsh/Shellbash-CVE-2014-6271](https://github.com/cyberharsh/Shellbash-CVE-2014-6271)

**漏洞详情:** [CVE-2014-6271](https://nvd.nist.gov/vuln/detail/CVE-2014-6271)