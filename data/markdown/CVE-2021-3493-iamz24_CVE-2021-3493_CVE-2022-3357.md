## CVE-2021-3493 - Ubuntu OverlayFS 本地提权漏洞

**漏洞编号:** CVE-2021-3493

**漏洞类型:** 本地提权

**影响应用:** Linux Kernel (Ubuntu)

**危害等级:** 高危，可导致本地权限提升至 root

**影响版本:** Ubuntu kernels < 5.8.0-50.56, < 5.4.0-72.80, < 4.15.0-142.146, < 4.4.0-209.241

**利用条件:** 需要目标系统开启 unprivileged user namespaces 和存在 OverlayFS 服务。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-3493 漏洞是 Linux 内核 overlayfs 实现中，在用户命名空间中对底层文件系统中的文件 capabilities 验证不当导致的。由于 Ubuntu 内核中存在允许非特权 overlay 挂载的补丁，攻击者可以利用该漏洞提升权限。

**利用方式：**

1.  **环境准备：** 检查目标系统是否存在 overlayfs 服务，如果没有则加载 overlay 模块。同时，确保开启了 unprivileged user namespaces。
2.  **编译 Payload：** 使用 GCC 编译提供的 `payload.c` 文件。
3.  **运行 Payload：** 运行编译后的可执行文件 `a.out`。
4.  **获取 Root Shell：** Payload 会创建一个新的命名空间，挂载 overlayfs，设置 capability，最终执行一个具有 root 权限的 shell。

**有效性：**

提供的 POC 代码基本有效，能够利用该漏洞在符合条件的 Ubuntu 系统上实现本地提权。

**投毒风险：**

存在较低的投毒风险（10%）。虽然代码的主要功能是实现提权，但仍然需要谨慎对待来源不明的代码，作者可能会在其中隐藏一些恶意行为，比如上传敏感信息等。特别是需要检查 `exploit`函数中的相关文件操作和命令执行是否存在恶意行为。尤其关注`system(buf);`是否会执行恶意的指令。

**总结：**

该漏洞利用较为直接，利用条件相对明确，但需要注意潜在的投毒风险。在实际使用时，应该仔细审查代码，确保没有恶意行为。

**项目地址:** [iamz24/CVE-2021-3493_CVE-2022-3357](https://github.com/iamz24/CVE-2021-3493_CVE-2022-3357)

**漏洞详情:** [CVE-2021-3493](https://nvd.nist.gov/vuln/detail/CVE-2021-3493)