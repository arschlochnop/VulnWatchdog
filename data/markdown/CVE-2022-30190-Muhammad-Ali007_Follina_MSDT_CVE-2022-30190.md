## CVE-2022-30190 Microsoft Windows Support Diagnostic Tool (MSDT) 远程代码执行漏洞

**漏洞编号:** CVE-2022-30190

**漏洞类型:** 远程代码执行

**影响应用:** Microsoft Windows Support Diagnostic Tool (MSDT)

**危害等级:** 高危，允许攻击者在受害者系统上执行任意代码

**影响版本:** 受影响的Windows版本请参考漏洞库信息

**利用条件:** 需要用户打开恶意Word文档或其他Office文档

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-30190，又名Follina，是一个存在于Microsoft Windows Support Diagnostic Tool (MSDT) 中的远程代码执行漏洞。攻击者可以构造恶意的Word文档，利用Word的远程模板功能从远程服务器检索HTML文件，HTML文件中包含的JavaScript代码通过`ms-msdt:` URI scheme调用MSDT，从而执行任意命令。

**有效性：**
提供的POC代码是有效的。它通过修改Word文档的`document.xml.rels`文件，将OLE对象引用指向攻击者控制的HTML文件。该HTML文件利用`ms-msdt:`协议执行PowerShell命令，从而实现远程代码执行。

**投毒风险：**
POC代码本身实现了漏洞利用，但作者可能在其他地方隐藏恶意代码。
*   **Readme.md 分析:**  Readme.md 主要提供漏洞描述和利用步骤，风险较低。
*   **follina.py 分析:**  `follina.py`脚本用于生成恶意文档，该脚本本身可能包含恶意代码，但是已知的该脚本的功能是创建利用payload的word文档，风险可控。评估投毒风险，基于现有信息，判断为10%的可能性，主要集中在提供的脚本是否存在未公开的后门。

**利用方式：**
1.  攻击者创建一个包含恶意OLE对象引用的Word文档（或其他Office文档）。
2.  该OLE对象引用指向攻击者控制的远程HTML文件。
3.  当用户打开该文档时，Word会尝试从远程服务器加载HTML文件。
4.  HTML文件中的JavaScript代码使用`ms-msdt:` URI scheme调用MSDT。
5.  MSDT执行HTML文件中指定的PowerShell命令，从而导致远程代码执行。

漏洞利用的关键在于`ms-msdt:`协议的使用，以及Word文档对远程OLE对象的支持。通过精心构造的HTML文件和Word文档，攻击者可以绕过安全防护措施，在受害者系统上执行任意代码。

**项目地址:** [Muhammad-Ali007/Follina_MSDT_CVE-2022-30190](https://github.com/Muhammad-Ali007/Follina_MSDT_CVE-2022-30190)

**漏洞详情:** [CVE-2022-30190](https://nvd.nist.gov/vuln/detail/CVE-2022-30190)