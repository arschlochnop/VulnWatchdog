## CVE-2021-1675 - Windows Print Spooler Remote Code Execution

**漏洞编号:** CVE-2021-1675

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Windows Print Spooler

**危害等级:** 高危，允许攻击者以SYSTEM权限执行任意代码

**影响版本:** 受影响的Windows版本众多，具体参考漏洞库信息

**利用条件:** 需要网络访问，目标系统开启Print Spooler服务，攻击者需要具备一定的用户权限（普通用户即可）。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-1675 (PrintNightmare) 是一个Windows Print Spooler服务中的远程代码执行漏洞。攻击者可以通过利用`AddPrinterDriverEx`函数，上传恶意驱动程序，从而以SYSTEM权限执行任意代码。搜索结果表明，该漏洞已被广泛利用，并存在公开的PoC代码。漏洞利用代码中的Dockerfile构建了包含impacket库的环境，impacket库提供了利用该漏洞的必要工具。利用方式通常涉及通过RPC调用`AddPrinterDriverEx`函数，将恶意DLL上传到目标系统，并使Print Spooler服务加载执行，从而实现RCE。

**有效性：**
PoC代码的有效性较高，因为搜索结果中存在多个PoC，并且CISA已将此漏洞添加到已知被利用的漏洞目录中。

**投毒风险：**
仓库中存在作者隐藏的投毒代码的可能性评估为10%。

*   **Dockerfile:** Dockerfile 看起来是为了构建一个包含必要依赖（例如 impacket）的攻击环境，本身不包含恶意代码。然而，`wget`命令从GitHub下载impacket，存在GitHub仓库被篡改的风险。另外，Dockerfile里的`smb.conf`和`main.py`以及`my_rprn.py`需要进一步审计，以确保没有隐藏的恶意行为。
*   **README.adoc:**  这是一个分析报告，本身不包含可执行代码，风险较低。

**利用方式：**
1.  攻击者利用具有一定权限的用户账户连接到目标系统的Print Spooler服务。
2.  通过MSRPC调用`AddPrinterDriverEx`函数，并提供指向恶意DLL的路径。
3.  Print Spooler服务尝试加载并执行该DLL。
4.  由于Print Spooler服务以SYSTEM权限运行，恶意DLL也将在SYSTEM上下文中执行，从而导致RCE。

**项目地址:** [hahaleyile/my-CVE-2021-1675](https://github.com/hahaleyile/my-CVE-2021-1675)

**漏洞详情:** [CVE-2021-1675](https://nvd.nist.gov/vuln/detail/CVE-2021-1675)