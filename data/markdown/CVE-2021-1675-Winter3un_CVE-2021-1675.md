## CVE-2021-1675 Windows Print Spooler Remote Code Execution

**漏洞编号:** CVE-2021-1675

**漏洞类型:** 远程代码执行

**影响应用:** Windows Print Spooler

**危害等级:** 高危，可能导致系统完全控制

**影响版本:** 受影响的Windows版本（见漏洞库信息）

**利用条件:** 需要目标系统开启Print Spooler服务，且攻击者能够与目标系统进行网络通信

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-1675（PrintNightmare）是一个Windows Print Spooler服务中的远程代码执行漏洞。攻击者可以通过利用该漏洞在目标系统上以SYSTEM权限执行任意代码。漏洞利用方式主要通过以下步骤：

1.  **上传恶意DLL：** 攻击者需要将恶意的DLL文件上传到目标服务器。
2.  **端口转发：** 利用`netsh interface portproxy add v4tov4 listenport=31337 connectaddress=192.168.84.129 connectport=31337`进行端口转发，以便能够访问远程服务。
3.  **利用漏洞触发执行：** 通过特定的方式触发Print Spooler服务加载并执行该DLL文件，从而实现远程代码执行。
4.  **权限提升：** 由于Print Spooler服务通常以SYSTEM权限运行，因此攻击者可以获得SYSTEM权限，完全控制目标系统。

**有效性评估：**

根据漏洞信息和搜索引擎结果，该漏洞的POC代码是有效的，并且已经被公开利用。多个安全厂商和研究人员都证实了该漏洞的存在和可利用性。CISA已将其添加到已知被利用的漏洞目录（KEV）。

**投毒风险评估：**

代码仓库中存在投毒代码的风险较低，大约为10%。风险主要在于：

*   **依赖性：** 该POC依赖于 `vlib.dll` 和 `PrintNightmareLPE.exe`，如果这些组件被替换为恶意版本，则可能导致投毒。
*   **转发端口被恶意利用:** 攻击者可能使用相同的端口进行其他恶意活动。

尽管如此，考虑到POC的主要功能是利用已知的安全漏洞，因此直接在POC代码中添加恶意代码的概率相对较低。

**利用方式总结：**

1.  攻击者首先需要定位存在漏洞的目标系统。
2.  攻击者需要上传精心构造的恶意DLL到目标机器上。
3.  攻击者通过特定的利用方式触发Print Spooler服务加载该DLL。
4.  恶意DLL在SYSTEM权限下执行，攻击者获得系统控制权。

**缓解措施：**

*   及时安装Microsoft提供的安全补丁。
*   禁用Print Spooler服务，如果不需要使用打印功能。
*   监控Print Spooler服务的异常活动。

**项目地址:** [Winter3un/CVE-2021-1675](https://github.com/Winter3un/CVE-2021-1675)

**漏洞详情:** [CVE-2021-1675](https://nvd.nist.gov/vuln/detail/CVE-2021-1675)