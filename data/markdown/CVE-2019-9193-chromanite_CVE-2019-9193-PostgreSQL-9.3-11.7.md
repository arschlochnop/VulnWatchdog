## CVE-2019-9193 - PostgreSQL 9.3-11.7 认证后的远程代码执行

**漏洞编号:** CVE-2019-9193

**漏洞类型:** 远程代码执行

**影响应用:** PostgreSQL

**危害等级:** 高危，可能导致完全系统控制

**影响版本:** 9.3 - 11.7

**利用条件:** 需要有效的PostgreSQL数据库用户凭据

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2019-9193 漏洞允许具有足够权限的PostgreSQL用户（通常是超级用户或属于 `pg_execute_server_program` 组的用户）通过 `COPY TO/FROM PROGRAM` 命令执行任意操作系统命令。提供的漏洞利用代码 `cve-2019–9193.py` 利用了这一功能。

**有效性：**
根据漏洞库信息和搜索引擎结果，该漏洞是有效的，尤其是在PostgreSQL版本9.3到11.7中。搜索结果中的链接，例如`https://github.com/b4keSn4ke/CVE-2019-9193`，也证实了该漏洞的存在，并提供了可利用的代码。

**投毒风险：**
检查提供的Python代码，投毒风险较低，大约5%。以下是一些原因：
*   **代码结构清晰：** 代码主要由命令行参数解析、数据库连接、版本检查和利用函数组成，功能明确。
*   **数据库操作：** 代码的核心在于执行SQL查询，利用 `COPY FROM PROGRAM` 执行命令，并清理创建的临时表。这些操作与漏洞描述一致。
*   **异常处理：** 代码包含异常处理机制，例如捕获数据库连接错误和命令执行错误，并尝试清理临时表，表明作者关注代码的健壮性。
*   **潜在风险：**
    *   **依赖项风险:** 虽然直接的恶意代码可能性低，但攻击者可能通过修改依赖项或命令行参数处理来引入恶意行为。例如，修改默认数据库名称或注入恶意命令。
    *   **环境依赖：** 脚本需要在目标系统上存在Python环境，且需要安装psycopg2库。攻击者可能会利用这一点，诱导用户安装恶意版本的依赖项。

**利用方式：**
1.  **身份验证：** 首先，攻击者需要有效的PostgreSQL数据库用户名和密码。
2.  **连接数据库：** 使用提供的脚本连接到目标PostgreSQL数据库。
3.  **版本检查：** 脚本会检查PostgreSQL的版本，确认目标是否易受攻击。
4.  **命令执行：** 攻击者可以输入任意操作系统命令，脚本会将其插入到 `COPY FROM PROGRAM` 命令中执行。命令执行结果将返回到攻击者。
5.  **清理：** 脚本在执行后会尝试删除创建的临时表，以清除痕迹。

总而言之，虽然直接的恶意代码可能性较低，但用户在使用此POC时仍应保持警惕，特别是从不受信任的来源获取时。仔细审查代码，确保使用的依赖项安全，并避免执行未知的或不受信任的命令。

**项目地址:** [chromanite/CVE-2019-9193-PostgreSQL-9.3-11.7](https://github.com/chromanite/CVE-2019-9193-PostgreSQL-9.3-11.7)

**漏洞详情:** [CVE-2019-9193](https://nvd.nist.gov/vuln/detail/CVE-2019-9193)