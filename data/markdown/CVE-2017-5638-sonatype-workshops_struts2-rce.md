## CVE-2017-5638-Apache Struts-远程代码执行

**漏洞编号:** CVE-2017-5638

**漏洞类型:** 远程代码执行

**影响应用:** Apache Struts

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** 2.3.x before 2.3.32, 2.5.x before 2.5.10.1

**利用条件:** 目标系统运行存在漏洞的Apache Struts版本，且攻击者能够发送恶意HTTP请求

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2017-5638 是 Apache Struts 2 的一个远程代码执行漏洞，源于 Jakarta Multipart parser 在处理文件上传时的异常处理和错误消息生成不当。攻击者可以通过构造恶意的 Content-Type、Content-Disposition 或 Content-Length HTTP 头部来执行任意命令。漏洞利用代码分析：

*   **Dockerfile:** 该文件用于构建包含存在漏洞的 Struts 2 应用的 Docker 镜像。它基于 tomcat:7 镜像，并将 struts2-rest-showcase.war 部署到 Tomcat 的 webapps 目录下，暴露了8080端口。这本身不是漏洞利用代码，而是漏洞测试环境的准备。
*   **Jenkinsfile:** 该文件定义了 Jenkins 构建流程，包括代码检出、Maven 构建和 Nexus Lifecycle Evaluation。它使用 Maven 打包 Struts 2 应用，但没有直接的漏洞利用代码。其中`nexusPolicyEvaluation` 可能存在风险，通过配置`iqApplication`应用ID，可能可以对应用进行安全分析。
*   **LICENSE.txt:** Apache 2.0 许可协议。

**有效性：**
根据漏洞库信息和搜索结果，该漏洞利用的POC是存在的，并且在野外被广泛利用。提供的Dockerfile 可以搭建一个存在漏洞的环境， Jenkinsfile 是项目的构建文件，二者结合可以认为该漏洞是可以复现和利用的

**投毒风险：**
虽然提供的代码片段主要用于构建和部署存在漏洞的 Struts 2 应用，并没有明显的恶意代码。但是`Jenkinsfile`文件中的`nexusPolicyEvaluation` 可能存在风险， 通过配置恶意`iqApplication`应用ID,对构建的应用投毒，但是概率较低.

**利用方式：**
攻击者通常会发送一个包含恶意构造的 Content-Type 头部（例如，包含 `#cmd=` 字符串）的 HTTP 请求。这个恶意头部会触发 Struts 2 中的 OGNL 表达式注入，从而允许攻击者执行任意命令。具体的利用方式包括：

1.  发送包含恶意 Content-Type 头部的 HTTP 请求。
2.  利用 OGNL 表达式执行系统命令。
3.  获取服务器的控制权。

**项目地址:** [sonatype-workshops/struts2-rce](https://github.com/sonatype-workshops/struts2-rce)

**漏洞详情:** [CVE-2017-5638](https://nvd.nist.gov/vuln/detail/CVE-2017-5638)