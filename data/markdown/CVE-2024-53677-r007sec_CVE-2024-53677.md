## CVE-2024-53677: Apache Struts 文件上传路径遍历导致RCE

**漏洞编号:** CVE-2024-53677

**漏洞类型:** 文件上传/路径遍历/远程代码执行

**影响应用:** Apache Struts

**危害等级:** 高危，可导致服务器被完全控制

**影响版本:** 2.0.0 到 6.4.0 之前

**利用条件:** Apache Struts应用使用了基于FileuploadInterceptor的旧文件上传机制，且攻击者可以访问上传功能

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于Apache Struts的旧文件上传逻辑中。攻击者可以通过操纵文件上传参数，进行路径遍历，从而将恶意文件上传到任意位置，例如Web容器的webapp目录，进而执行恶意代码。

**有效性：**
根据漏洞库信息、搜索引擎结果以及提供的PoC代码，可以判断该漏洞利用是有效的。多个来源均指出 CVE-2024-53677 是一个严重的文件上传漏洞，攻击者可以利用它进行路径遍历和远程代码执行。提供的PoC代码包含一个可以上传WAR包的exploit，以及手动利用的multipart/form-data请求示例，证实了该漏洞的可利用性。

**投毒风险：**
PoC代码存在一定程度的投毒风险。虽然PoC的主要功能是利用漏洞，但其中可能隐藏一些不易察觉的恶意代码，例如：
1.  **WAR包内容：** exploit.py 脚本创建的WAR文件(webshell.war)本身可能包含后门代码。在没有仔细检查的情况下部署这个WAR包可能导致服务器被植入恶意程序。
2.  **上传逻辑修改：** 攻击者可能修改上传逻辑，例如在上传过程中记录服务器信息，或者尝试执行其他未授权操作。
3.  **依赖风险：** requirements.txt 中列出的依赖包可能包含恶意代码或安全漏洞。使用受污染的依赖包可能导致安全风险。
4.  **GIF89a头注入:**  虽然是为了绕过上传检查，但可能存在利用GIF解析漏洞的风险。虽然可能性较低，但是仍然需要考虑。
总体而言，考虑到WAR包本身是用来执行命令的，因此很难完全排除投毒的可能。如果用户盲目执行，并且没有对生成的WAR包进行检查，则存在风险。因此，投毒风险评估为10%。

**利用方式：**
1.  **路径遍历：** 攻击者通过修改上传的文件名参数，使其包含`../`这样的路径遍历字符，从而能够将文件上传到服务器上的任意目录。
2.  **上传恶意文件：** 攻击者通常上传包含恶意代码的文件，例如JSP webshell或者WAR包，这些文件一旦被Web服务器解析，就可以执行任意命令。
3.  **远程代码执行：** 通过上传的恶意文件，攻击者可以在服务器上执行任意命令，从而完全控制服务器。

**总结：**
CVE-2024-53677是一个高危漏洞，利用简单，危害巨大。用户应该尽快升级到安全版本，或者采取其他缓解措施，例如禁用旧的文件上传功能。

**项目地址:** [r007sec/CVE-2024-53677](https://github.com/r007sec/CVE-2024-53677)

**漏洞详情:** [CVE-2024-53677](https://nvd.nist.gov/vuln/detail/CVE-2024-53677)