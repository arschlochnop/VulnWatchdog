## CVE-2025-59287-Windows Server Update Service (WSUS) 远程代码执行漏洞

**漏洞编号:** CVE-2025-59287

**漏洞类型:** 反序列化漏洞

**影响应用:** Windows Server Update Service (WSUS)

**危害等级:** 严重，可能导致远程代码执行并获取SYSTEM权限

**影响版本:** Windows Server 2019 (版本介于 10.0.17763.0 和 10.0.17763.7919 之间，不包括 10.0.17763.7919), Windows Server 2022 (版本介于 10.0.20348.0 和 10.0.20348.4294 之间，不包括 10.0.20348.4294), Windows Server 2025 (版本介于 10.0.26100.0 和 10.0.26100.6899 之间，不包括 10.0.26100.6899), Windows Server 23H2 (版本介于 10.0.25398.0 和 10.0.25398.1913 之间，不包括 10.0.25398.1913), Windows Server 2016 (版本介于 10.0.14393.0 和 10.0.14393.8519 之间，不包括 10.0.14393.8519), Windows Server 2012 (版本介于 6.2.9200.0 和 6.2.9200.25722 之间，不包括 6.2.9200.25722), Windows Server 2012 R2 (版本介于 6.3.9600.0 和 6.3.9600.22824 之间，不包括 6.3.9600.22824)

**利用条件:** 需要能够访问WSUS服务器的网络，并且目标服务器运行受影响的Windows Server版本。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2025-59287 是 Microsoft Windows Server Update Services (WSUS) 中的一个反序列化漏洞。该漏洞源于对发送到 `GetCookie()` 端点的 `AuthorizationCookie` 对象的不安全反序列化。加密的cookie数据使用 AES-128-CBC 解密，然后通过 `BinaryFormatter` 进行反序列化，而没有适当的类型验证。这使得未经授权的攻击者可以通过网络执行任意代码，利用该漏洞可以 SYSTEM 权限在服务器上执行代码。

**利用方式：**

1.  **获取认证Cookie：** 攻击者首先需要获取一个有效的认证Cookie。`cve-2025-59287-exp.py` 脚本中的 `get_auth_cookie()` 函数负责完成此步骤。它通过向 `SimpleAuthWebService/SimpleAuth.asmx` 发送 SOAP 请求来获取 CookieData。
2.  **获取报表服务 Cookie：** 获得认证 Cookie 后，攻击者使用 `get_reporting_cookie()` 函数，通过将带有认证 Cookie 的 SOAP 请求发送到 `ClientWebService/Client.asmx` 的 `GetCookie` 方法来获取报表服务 Cookie。
3.  **构造恶意序列化对象：** 利用 `BinaryFormatter` 的不安全反序列化，攻击者可以构造一个恶意的 .NET 对象，该对象在反序列化时执行任意代码。这部分代码在提供的代码段中缺失，但通常涉及创建包含恶意命令的序列化对象，这些命令将在目标服务器上执行。
4.  **发送恶意请求：** 攻击者将包含恶意序列化对象的报表服务 Cookie 发送给 WSUS 服务器。当 WSUS 服务器反序列化该对象时，将执行攻击者指定的代码。

**投毒风险评估：**
代码中存在投毒风险的可能性较低，估计为10%。风险主要在于以下几个方面：

*   脚本依赖于 `requests` 和 `xml.etree.ElementTree` 库。 虽然这些库本身被植入恶意代码的风险较低，但仍需注意。
*   脚本自动生成 Server ID。如果生成的Server ID 在特定情况下被恶意利用，可能存在潜在的风险。但是，这些都属于比较常见的操作，风险较低。
*   虽然脚本的主要目的是利用已知的反序列化漏洞，但仔细检查代码以确保没有其他隐藏的恶意行为仍然很重要。
*   缺少构建恶意序列化对象的代码。这个是漏洞利用的关键部分,目前无法确定序列化对象构造过程中是否存在恶意逻辑。

**总结：**

提供的 PoC 代码似乎是漏洞利用的初步阶段，用于获取必要的 Cookie。关键在于如何构造恶意的序列化对象，并将其嵌入到报表服务 Cookie 中。由于没有这部分代码，目前还不能完全评估其有效性和全部的潜在风险。投毒风险较低，但需要进一步审查构造恶意序列化对象的代码。


**项目地址:** [jiansiting/CVE-2025-59287](https://github.com/jiansiting/CVE-2025-59287)

**漏洞详情:** [CVE-2025-59287](https://nvd.nist.gov/vuln/detail/CVE-2025-59287)