## CVE-2025-37899 - Linux Kernel ksmbd Use-After-Free

**漏洞编号:** CVE-2025-37899

**漏洞类型:** Use-After-Free

**影响应用:** Linux Kernel ksmbd

**危害等级:** 中危/高危，取决于能否实现代码执行。可能导致系统崩溃、信息泄露或代码执行。

**影响版本:** 5.15 <= Kernel Version < 6.12.28, 5.15 <= Kernel Version < 6.14.6, 5.15 <= Kernel Version < 6.15-rc5

**利用条件:** 需要启用并运行 ksmbd 服务，并且攻击者需要能够建立 SMB 连接。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2025-37899 是 Linux 内核 ksmbd 模块中的一个 use-after-free 漏洞。该漏洞发生在会话注销期间，由于在释放 `sess->user` 对象时缺乏适当的同步，导致其他线程可能在释放后访问该对象。这可能导致内存损坏、系统崩溃或潜在的远程代码执行。根据搜索引擎结果，该漏洞由 OpenAI 的 o3 模型发现，并被认为是一个零日漏洞。提供的 PoC 代码描述了漏洞的根本原因，即在 `smb2_session_logoff` 函数中释放 `sess->user` 之前，没有进行适当的锁定。修复方案包括使用 spinlock 保护对 `sess->user` 的访问。利用方式是攻击者通过发送特制的 SMB2/3 命令，创建竞争条件，使一个线程在 `sess->user` 被释放后仍然访问它。投毒风险评估：代码主要描述了漏洞原理和修复方案，给出的修复方案本身不存在恶意代码。但存在一种低概率风险，即攻击者可能修改该 PoC，在利用漏洞的同时植入后门代码。因此，投毒风险评定为 10%。

**项目地址:** [vett3x/SMB-LINUX-CVE-2025-37899](https://github.com/vett3x/SMB-LINUX-CVE-2025-37899)

**漏洞详情:** [CVE-2025-37899](https://nvd.nist.gov/vuln/detail/CVE-2025-37899)