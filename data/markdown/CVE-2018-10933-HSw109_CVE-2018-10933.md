## CVE-2018-10933 - libssh Authentication Bypass

**漏洞编号:** CVE-2018-10933

**漏洞类型:** Authentication Bypass

**影响应用:** libssh

**危害等级:** 高危，可能导致未授权访问和远程代码执行

**影响版本:** 0.6 <= version < 0.7.6 和 0.8.0 <= version < 0.8.4

**利用条件:** 目标服务器运行受影响版本的libssh，且允许网络访问SSH端口

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2018-10933 存在于 libssh 的服务端状态机中，允许未经身份验证的远程攻击者绕过身份验证。攻击者可以通过在服务器期望 SSH2_MSG_USERAUTH_REQUEST 消息时，发送 SSH2_MSG_USERAUTH_SUCCESS 消息来欺骗服务器，使其认为客户端已成功通过身份验证，从而创建未经授权的通道。

**有效性分析：**

根据漏洞库信息、搜索引擎结果和提供的漏洞利用代码，该漏洞利用是有效的。漏洞库信息明确指出 libssh 的 0.7.6 和 0.8.4 之前的版本存在此漏洞。搜索引擎结果中，多个链接 (如 fluidattacks.com, rapid7.com, cybrary.it) 确认了该漏洞的存在，并描述了利用方式。提供的 POC 代码 `paramikoBypass.py` 使用 `paramiko` 库发送 `SSH2_MSG_USERAUTH_SUCCESS` 消息，模拟未经身份验证的成功认证，从而获取 shell。

**投毒风险分析：**

分析提供的 POC 代码和相关文件，存在一定的投毒风险。具体分析如下：

*   `README.md` 中提到需要将 `CVE-2018-10933-PoC/libssh-0.8.3/src/*` 复制到 `/usr/local/lib`。这会将 POC 中包含的 `libssh` 源码（很可能被修改过）覆盖系统中的 `libssh` 库，如果poc作者在这些代码中包含后门或者恶意代码，那么就可能存在投毒的风险。
*   `patch/cve-2018-10933.patch` 文件用于修改 `src/auth.c` 文件，注入 `SSH2_MSG_USERAUTH_SUCCESS` 数据包，这个行为本身就是为了绕过认证而修改源代码，虽然这是为了测试，但是如果作者在代码中加入恶意代码，则存在风险。虽然目的是为了重现漏洞，但更改系统库始终存在风险。

虽然以上行为主要目的是为了重现漏洞，但是总体而言，存在一定的风险。将风险评估为 10%。

**利用方式分析：**

1.  **环境准备：** 安装 `paramiko` 库 (`pip install paramiko==2.10.1`)。
2.  **运行易受攻击的服务器：**配置并运行存在漏洞的 `libssh` 服务器版本(0.6 <= version < 0.7.6 和 0.8.0 <= version < 0.8.4)，或根据`README.md`文件描述的方式，使用 patch 文件夹中修改后的代码运行ssh服务端。
3.  **漏洞利用：** 运行 `paramikoBypass.py` 脚本，指定目标服务器的 IP 地址和端口号。脚本会尝试发送 `SSH2_MSG_USERAUTH_SUCCESS` 消息来绕过身份验证，并获取 shell。
4.  **交互：** 成功利用漏洞后，可以通过脚本提供的 shell 与目标服务器进行交互，执行任意命令。

**项目地址:** [HSw109/CVE-2018-10933](https://github.com/HSw109/CVE-2018-10933)

**漏洞详情:** [CVE-2018-10933](https://nvd.nist.gov/vuln/detail/CVE-2018-10933)