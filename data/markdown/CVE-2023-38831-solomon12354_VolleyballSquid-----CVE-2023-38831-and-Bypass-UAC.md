## CVE-2023-38831-WinRAR-代码执行

**漏洞编号:** CVE-2023-38831

**漏洞类型:** 代码执行

**影响应用:** WinRAR

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** < 6.23

**利用条件:** 用户需要解压恶意的ZIP/RAR压缩文件

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-38831 存在于 WinRAR 6.23 之前版本中。攻击者可以构造一个包含良性文件和同名文件夹的 ZIP 压缩包，当用户尝试访问良性文件时，WinRAR 会错误地执行同名文件夹中的恶意代码。提供的 `exploit.py` 脚本可以用于生成包含漏洞利用的RAR压缩文件。脚本首先要求输入良性文件（`bait_file`）、恶意脚本文件（`script_file`）和输出RAR文件名称。然后，它创建一个临时目录，将恶意脚本复制到与良性文件同名的目录中，并将良性文件复制到临时目录中。最后，使用 `shutil.make_archive` 函数将临时目录压缩成 ZIP 文件，并修改 ZIP 文件的内容，将目录名中的 'A' 和 'B' 替换为空格，从而绕过 WinRAR 的安全检查。最终，将修改后的 ZIP 文件重命名为 RAR 文件。

`squid.bat` 用于下载并执行 `volleysquid.exe`。`volleyballsquid.py` 尝试利用 BypassUAC 来提升权限并将程序设置为开机自启。

**有效性:** 根据漏洞信息和利用代码分析，提供的 POC 代码有效，可以利用此漏洞在受害者机器上执行任意代码。

**投毒风险:** 仓库中存在一定的投毒风险，虽然主要功能是利用CVE-2023-38831漏洞，但是 `volleyballsquid.py`和`squid.bat`文件中的行为具有恶意性，特别是`volleyballsquid.py`中尝试使用`BypassUAC`绕过用户账户控制并持久化安装，这可能被用于安装后门或恶意软件。虽然主要目的是展示漏洞，但客观上存在后门功能，因此投毒风险占比为10%。

**利用方式:** 攻击者首先利用 `exploit.py` 脚本生成包含恶意代码的RAR压缩文件。然后，诱骗用户下载并使用 WinRAR 解压此文件。当用户尝试打开压缩包中的“良性”文件时，实际上会执行隐藏在同名目录中的恶意脚本 (例如 `squid.bat`)，下载并执行恶意程序。

根据搜索结果，CVE-2023-38831 漏洞已被广泛利用，并且已被政府背景的攻击者使用，这进一步验证了漏洞的严重性和 POC 代码的有效性。

**项目地址:** [solomon12354/VolleyballSquid-----CVE-2023-38831-and-Bypass-UAC](https://github.com/solomon12354/VolleyballSquid-----CVE-2023-38831-and-Bypass-UAC)

**漏洞详情:** [CVE-2023-38831](https://nvd.nist.gov/vuln/detail/CVE-2023-38831)