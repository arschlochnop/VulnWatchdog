## CVE-2016-5180-c-ares 堆缓冲区溢出

**漏洞编号:** CVE-2016-5180

**漏洞类型:** 堆缓冲区溢出

**影响应用:** c-ares (通过 Node.js 间接调用)

**危害等级:** 高危，可能导致拒绝服务或远程代码执行

**影响版本:** c-ares 1.x before 1.12.0

**利用条件:** 应用程序使用受影响的 c-ares 版本，且允许用户控制主机名解析

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2016-5180 是 c-ares 库中 ares_create_query 函数的堆缓冲区溢出漏洞。该漏洞允许远程攻击者通过包含转义尾随点的恶意主机名来造成拒绝服务（越界写入）或执行任意代码。

**有效性：**
提供的 Node.js 代码是一个易受攻击的应用程序示例，它接受用户提供的回调 URL 并使用 `dns.resolve` 函数解析主机名。如果 `dns.resolve` 函数使用的 c-ares 库的版本早于 1.12.0 且存在漏洞，则可以通过提供包含恶意转义尾随点的主机名来触发缓冲区溢出。

**利用方式：**
1.  攻击者向 `/register` 路由发送 POST 请求，其中 `callback` 参数包含一个格式为 `hostname\.` 的恶意主机名，`hostname` 长度要足够长才能触发缓冲区溢出。
2.  `dns.resolve` 函数调用 c-ares 库解析主机名。
3.  `ares_create_query` 函数在处理带有转义尾随点的主机名时计算大小不正确，导致堆缓冲区溢出。
4.  攻击者可以通过精心构造主机名来实现拒绝服务或执行任意代码。

**投毒风险：**
查看提供的代码，其中两个文件package.json和server.js，没有发现恶意或者后门代码，代码逻辑清晰，主要功能就是接收用户输入的回调 URL 并使用 Node.js 的 `dns` 模块解析主机名。因此，代码中存在投毒代码的可能性很低，几乎可以忽略不计。

总之，利用方式有效，投毒可能性为0。

**项目地址:** [pouriam23/final-CVE-2016-5180](https://github.com/pouriam23/final-CVE-2016-5180)

**漏洞详情:** [CVE-2016-5180](https://nvd.nist.gov/vuln/detail/CVE-2016-5180)