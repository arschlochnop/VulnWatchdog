## CVE-2024-23334-aiohttp目录遍历

**漏洞编号:** CVE-2024-23334

**漏洞类型:** 目录遍历

**影响应用:** aiohttp

**危害等级:** 中危，可能导致敏感信息泄露

**影响版本:** < 3.9.2

**利用条件:** 服务器配置了静态文件服务，并且启用了 follow_symlinks=True 选项。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-23334 是 aiohttp 框架中的一个目录遍历漏洞。当 aiohttp 被用作 Web 服务器并配置静态路由时，如果 `follow_symlinks` 设置为 `True`，则可能允许攻击者通过构造包含 `../` 的恶意 URL 访问服务器上的任意文件。 

**有效性：** 提供的 POC 代码是有效的。它包含了一个简单的 aiohttp 服务器，该服务器提供了静态文件服务，并且启用了 `follow_symlinks=True`。利用脚本 `exploit.py` 和 `exploit.sh` 通过构造带有目录遍历的 URL 来尝试读取 `/etc/passwd` 文件。如果服务器存在漏洞，并且 `follow_symlinks` 启用，则攻击者可以成功读取该文件。

**投毒风险：** 代码仓库主要包含漏洞利用的演示代码，投毒风险较低。`requirements.txt` 文件指定了使用存在漏洞的 aiohttp 版本 `3.9.1`，这本身不是投毒，而是为了复现漏洞。主要风险点来自 `exploit.py`和`exploit.sh`。虽然它们本身是漏洞利用代码，但如果被恶意修改，可能会执行一些恶意操作，例如在成功读取 `/etc/passwd` 后，进一步上传恶意文件或者执行命令。虽然存在这种可能性，但从代码结构看，作者的意图是演示漏洞，恶意投毒的可能性较低。server.py中没有发现恶意代码。

**利用方式：** 攻击者可以通过发送包含恶意路径的 HTTP 请求来利用此漏洞。恶意路径包含 `../` 序列，用于尝试跳出静态文件服务的根目录。例如，攻击者可以构造类似 `/static/../../../../etc/passwd` 的 URL 来尝试读取 `/etc/passwd` 文件。服务器端如果启用了 `follow_symlinks=True` 并且没有进行适当的路径验证，则会将请求转发到文件系统，从而允许攻击者访问根目录之外的文件。

**总结：** 此漏洞是一个典型的目录遍历漏洞，利用条件较为苛刻，需要服务器启用 `follow_symlinks` 选项。POC 代码有效，可以用于演示漏洞。代码仓库的投毒风险相对较低，但仍需谨慎，因为攻击者可能修改利用脚本以执行恶意操作。

**项目地址:** [Betan423/CVE-2024-23334-PoC](https://github.com/Betan423/CVE-2024-23334-PoC)

**漏洞详情:** [CVE-2024-23334](https://nvd.nist.gov/vuln/detail/CVE-2024-23334)