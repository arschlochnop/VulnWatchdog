## CVE-2025-32432-CraftCMS-RCE

**漏洞编号:** CVE-2025-32432

**漏洞类型:** 远程代码执行

**影响应用:** Craft CMS

**危害等级:** 高危，未经身份验证的远程代码执行

**影响版本:** 3.0.0-RC1 < 3.9.15, 4.0.0-RC1 < 4.14.15, 5.0.0-RC1 < 5.6.17

**利用条件:** 需要目标Craft CMS实例在受影响的版本范围内，并且网络可达。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2025-32432 是 Craft CMS 中的一个远程代码执行 (RCE) 漏洞。根据漏洞库信息、搜索引擎结果，此漏洞影响 Craft CMS 的多个版本（3.x、4.x 和 5.x）。漏洞利用代码（POC）显示攻击者可以通过 `asset transforms` 功能注入恶意代码。

**有效性：**

根据 Rapid7 的 Metasploit 模块记录，此漏洞存在可利用的 POC 代码，经验证有效。搜索结果也显示此漏洞已被积极利用。

**利用方式：**

1.  **会话注入：** 该漏洞利用代码首先尝试通过多个注入方法（例如，通过 'returnUrl' 参数在管理仪表板或登录页面）将 PHP 代码注入到会话中，从而设置CraftSessionId。 这通常涉及使用GET或POST请求将恶意PHP代码作为参数传递给Craft CMS，并监控响应中是否成功设置了CraftSessionId cookie。
2.  **CSRF Token获取:** 在成功建立会话之后，脚本会尝试从响应中提取CSRF token。这通常通过正则表达式搜索响应的HTML或JSON内容来完成，查找诸如`<input type="hidden" name="CRAFT_CSRF_TOKEN" value="..."`或`"CRAFT_CSRF_TOKEN": "..."`等模式。
3.  **Asset ID 发现：** 攻击者需要找到一个有效的 Asset ID。漏洞利用代码通过遍历一个 Asset ID 范围（1 到 50），并尝试使用这些 ID 生成资源转换来实现。
4.  **资源转换触发：**  一旦找到有效的 Asset ID，攻击者会利用 `actions/assets/generate-transform` 操作，将恶意代码作为资源转换参数传递，触发漏洞并执行任意代码。攻击者通过精心构造请求，利用不安全的反序列化或其他代码注入点执行恶意 PHP 代码。

**投毒风险：**

该脚本包含以下可疑部分需要注意：
1. `custom_make_request`函数：这个函数目的是绕过某些安全限制，但潜在的可能会被用于篡改请求。
2. 多个`injection_methods`：虽然提供了不同的注入方法是为了提高漏洞利用的成功率，但过多的尝试也增加了被安全设备检测到的风险。但是整体代码相对简单，目的明确，大规模投毒可能性较低。

评估后认为代码中存在投毒风险的概率较低，大约为1%。 主要原因是POC代码的目的是证明漏洞的存在以及简化利用过程。该代码主要关注漏洞利用本身，而非隐藏的恶意行为。

**项目地址:** [bambooqj/CVE-2025-32432](https://github.com/bambooqj/CVE-2025-32432)

**漏洞详情:** [CVE-2025-32432](https://nvd.nist.gov/vuln/detail/CVE-2025-32432)