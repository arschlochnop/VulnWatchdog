## CVE-2022-33679 Windows Kerberos 权限提升漏洞

**漏洞编号:** CVE-2022-33679

**漏洞类型:** 权限提升

**影响应用:** Windows Kerberos

**危害等级:** 高危，可能导致域权限提升

**影响版本:** 受影响的Windows Server版本（详见漏洞库信息）

**利用条件:** 目标系统存在配置不当的Kerberos服务，攻击者需要位于网络中，部分利用可能需要禁用预身份验证的用户账号。

**POC 可用性:** 是

**投毒风险:** 20%

## 详情

CVE-2022-33679 是一个 Windows Kerberos 权限提升漏洞。根据漏洞库信息，该漏洞影响多个版本的 Windows Server。搜索引擎结果表明，该漏洞由 Google Project Zero 的 James Forshaw 发现，并且存在公开可用的利用代码（如 Rubeus）。漏洞分析文章指出，该漏洞允许攻击者在某些情况下提升权限。提供的 POC 代码片段显示了构建 AS_REQ 请求，且包含利用密钥流进行加密操作的可疑函数，可能涉及到修改时间戳，利用ks加密和控制请求，绕过身份验证。虽然代码看起来像是漏洞利用的一部分，但其中`tsGen`函数中的一些操作例如`encodedTimeStamp = b'\x00' * 0x18 + encodedTimeStamp`和`encriptedTimeStamp = b''.join((i1 ^ i2).to_bytes(1, 'big') for i1, i2 in zip(encodedTimeStamp, key_stream))`存在一定的风险。虽然密钥流的获取方式未知，但是其可能被用于替换或者篡改请求中的关键参数。因此，存在一定的投毒风险，但相对较低。漏洞利用方式：攻击者通过构造恶意的 Kerberos 请求，欺骗身份验证系统，从而获得更高的权限。具体利用方式可能包括：1)  修改时间戳或其他关键数据绕过认证；2)  利用未启用预身份验证的用户账号；3)  强制 Kerberos 降级加密方式。

**总结：**

*   **有效性：** 提供的POC代码片段很可能有效，因为它与其他搜索结果中提到的信息（如Google Project Zero的发现和Rubeus工具的存在）相符。
*   **投毒风险：** 代码存在一定风险，`tsGen`函数可能用于替换或者篡改请求中的关键参数，风险评估为20%。
*   **利用方式：** 该漏洞允许攻击者通过构造恶意 Kerberos 请求，利用 Kerberos 协议的弱点，在目标系统上提升权限。

**项目地址:** [Blyth0He/CVE-2022-33679](https://github.com/Blyth0He/CVE-2022-33679)

**漏洞详情:** [CVE-2022-33679](https://nvd.nist.gov/vuln/detail/CVE-2022-33679)