## CVE-2024-10220-Kubernetes-Kubelet任意命令执行

**漏洞编号:** CVE-2024-10220

**漏洞类型:** 任意命令执行

**影响应用:** Kubernetes Kubelet

**危害等级:** 高危，可能导致节点被完全控制

**影响版本:** <= 1.28.11, 1.29.0 <= version <= 1.29.6, 1.30.0 <= version <= 1.30.2

**利用条件:** 攻击者需要有创建Pod和关联gitRepo volume的权限

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-10220 允许攻击者通过特制的 gitRepo 卷执行任意命令。漏洞存在于 Kubelet 组件中，利用方式是创建一个包含恶意配置的 Git 仓库，并在 Pod 中声明使用该仓库作为 gitRepo 卷。当 Kubelet 拉取该仓库时，会执行恶意配置中定义的命令。该漏洞的利用方式依赖于 Git 的钩子（hooks）机制，攻击者可以在仓库的 hooks 目录下放置恶意脚本，这些脚本会在 Git 操作（例如 checkout）期间被执行，从而绕过容器隔离，在宿主机上执行任意命令。

**有效性：**
根据提供的漏洞信息和漏洞利用代码，该漏洞是有效的。漏洞利用代码展示了一个包含 `post-checkout` 钩子的 Git 仓库，该钩子脚本会将 `/etc/passwd` 的内容复制到 `/poc` 文件中。当 Kubelet 拉取这个仓库并执行 checkout 操作时，这个钩子脚本会被执行，从而在宿主机上执行了读取 `/etc/passwd` 的命令。结合搜索结果，多个来源表明该漏洞已经存在可用的利用方法。

**投毒风险：**
分析 POC 代码，`post-checkout` 脚本的作用是将 `/etc/passwd` 的内容写入 `/poc` 文件。此行为本身是漏洞验证的一部分，旨在证明可以在容器外部执行代码。代码本身不包含任何恶意或隐藏的后门，可以判定投毒风险为0%。

**利用方式：**
1.  攻击者创建一个包含恶意 Git 仓库，仓库的 `hooks/post-checkout` 目录下包含恶意脚本。
2.  攻击者创建一个 Pod，并在 Pod 的 volume 中声明使用 gitRepo 卷，指向上述恶意 Git 仓库。
3.  Kubelet 会拉取恶意 Git 仓库。
4.  在拉取仓库的过程中，Git 会执行 `post-checkout` 钩子脚本。
5.  `post-checkout` 脚本在宿主机上执行任意命令，从而实现任意命令执行。

通过这种方式，攻击者可以绕过容器隔离，在宿主机上执行任意命令，从而完全控制节点。

**项目地址:** [any2sec/cve-2024-10220](https://github.com/any2sec/cve-2024-10220)

**漏洞详情:** [CVE-2024-10220](https://nvd.nist.gov/vuln/detail/CVE-2024-10220)