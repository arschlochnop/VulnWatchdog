## CVE-2024-10629 - GPX Viewer <= 2.2.8 - 任意文件创建

**漏洞编号:** CVE-2024-10629

**漏洞类型:** 任意文件创建

**影响应用:** GPX Viewer WordPress插件

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** <= 2.2.8

**利用条件:** 需要WordPress网站存在GPX Viewer插件，且攻击者拥有Subscriber或更高级别的权限。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2024-10629 存在于 GPX Viewer WordPress 插件中，版本小于等于 2.2.8。由于`gpxv_file_upload()` 函数中缺少权限检查和文件类型验证，经过身份验证的攻击者（具有 Subscriber 或更高级别的访问权限）可以在受影响的站点服务器上创建任意文件，从而可能导致远程代码执行。

**有效性：**
提供的 POC 代码看起来是有效的。它包含以下步骤：

1.  **参数解析：** 从命令行获取目标 URL、用户名和密码。
2.  **创建会话：** 创建一个带有用户代理的 HTTP 会话。
3.  **版本检测：**尝试通过访问`readme.txt`文件获取插件版本，并判断是否为漏洞版本。
4.  **登录：** 使用提供的凭据登录到 WordPress 站点。
5.  **上传 Payload：** 构造一个包含 PHP Webshell 的恶意文件上传请求，并发送到 `admin-ajax.php` 端点。
6.  **检查 Webshell：** 尝试访问上传的 Webshell 文件，以验证是否已成功上传。
7.  **命令执行：** 如果 Webshell 存在，则允许执行任意命令。

**投毒风险：**
代码中植入恶意代码的风险较低（约为 1%），主要考虑以下几点：

*   该代码是一个针对特定漏洞的利用程序，目的是为了验证和利用漏洞，而不是进行大范围攻击。
*   代码结构清晰，功能明确，没有发现明显的恶意行为，例如收集用户信息、传播恶意软件等。
*   虽然上传了PHP Webshell，但这属于漏洞利用的正常步骤，webshell本身就是为了执行任意命令。如果webshell的代码本身再包含恶意行为，则可以判定为投毒。
*   该POC代码的作者在Github有开源项目，有一定信誉。

因此，该代码的投毒风险较低。

**利用方式：**

1.  **身份验证：** 攻击者需要拥有 WordPress 站点的有效账户，权限至少为 Subscriber。
2.  **构造恶意请求：** 攻击者构造一个 multipart/form-data 请求，其中包含以下参数：
    *   `action`: 设置为 `gpxv_file_upload`。
    *   `category`: 设置为 `uncategorized`。
    *   `filename`: 设置为 Webshell 的文件名，例如 `nxploit_exploit.php`。
    *   `gpx`: 设置为 Webshell 的内容，例如 `<?php system($_GET['cmd']); ?>`。
3.  **发送请求：** 攻击者将构造的请求发送到 `wp-admin/admin-ajax.php` 端点。
4.  **远程代码执行：** 如果上传成功，攻击者可以通过访问上传的 Webshell 文件，并附加 `cmd` 参数来执行任意命令。例如，访问 `http://example.com/wp-content/uploads/gpx/uncategorized/nxploit_exploit.php?cmd=ls` 将执行 `ls` 命令。

**项目地址:** [Nxploited/CVE-2024-10629](https://github.com/Nxploited/CVE-2024-10629)

**漏洞详情:** [CVE-2024-10629](https://nvd.nist.gov/vuln/detail/CVE-2024-10629)