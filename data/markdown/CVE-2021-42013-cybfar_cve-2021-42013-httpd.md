## CVE-2021-42013 - Apache HTTP Server Path Traversal and Remote Code Execution

**漏洞编号:** CVE-2021-42013

**漏洞类型:** 路径遍历和远程代码执行

**影响应用:** Apache HTTP Server

**危害等级:** 高危，可能导致敏感信息泄露和远程代码执行

**影响版本:** 2.4.49, 2.4.50

**利用条件:** 目标服务器运行Apache HTTP Server 2.4.49或2.4.50，且存在Alias-like指令配置，CGI脚本已启用，且相关目录没有'require all denied'保护。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-42013是Apache HTTP Server 2.4.49和2.4.50中存在的一个路径遍历漏洞，是对CVE-2021-41773的不完整修复。攻击者可以利用该漏洞，通过构造包含特殊字符（如`.%%32e`）的URL，绕过Alias-like指令的限制，访问服务器上未受保护的文件。如果CGI脚本也已启用，则攻击者可能利用此漏洞执行任意代码。

**有效性评估：**
提供的Dockerfile和README.md描述了如何搭建一个存在漏洞的Apache HTTP Server环境。README.md中提供的`curl`命令

```bash
curl -v --path-as-is localhost:8000/icons/.%%32e/.%%32e/.%%32e/.%%32e/etc/passwd
```

可以用来验证漏洞的存在，如果返回`/etc/passwd`文件的内容，则表明目标存在路径遍历漏洞。

**投毒风险评估：**
查看Dockerfile，该文件从`debian:latest`镜像构建，安装必要的依赖项，下载并编译Apache HTTP Server 2.4.50。`httpd.conf`文件被添加到`/conf/httpd.conf`，并启动Apache服务。并没有发现明显的恶意代码或后门。

但是，以下因素可能导致一定的投毒风险：

1.  **httpd.conf替换：**Dockerfile使用 ADD 指令替换了默认的httpd.conf文件,可能通过修改配置来引入安全风险,如启用不安全的模块或配置项。
2.  **基础镜像安全：** 虽然Dockerfile使用了`debian:latest`，但基础镜像本身可能存在未知的漏洞。
3.  **第三方组件：** 构建过程中使用`apt-get`安装了一些依赖，这些组件也可能包含潜在的安全风险。

总体来说，该项目存在一定的投毒风险，但主要集中在配置不当和依赖项漏洞方面，作者主动植入恶意代码的可能性较低。因此，投毒风险评定为10%。

**漏洞利用方式：**

1.  **路径遍历：** 攻击者通过构造包含`.%%32e`的URL，尝试访问服务器上的任意文件。`%%32e`是`.`的URL编码，可以绕过一些路径过滤机制。
2.  **远程代码执行 (如果CGI启用):** 如果服务器配置允许执行CGI脚本，攻击者可以通过路径遍历漏洞找到CGI脚本的路径，并执行任意代码。这通常需要结合其他漏洞利用技术，例如上传恶意CGI脚本。

**总结：**
该漏洞利用的有效性较高，但需要满足一定的条件才能实现远程代码执行。投毒风险较低，主要集中在配置和依赖项安全方面。建议在使用该POC时，仔细检查`httpd.conf`文件，并确保基础镜像和依赖项的安全性。

**项目地址:** [cybfar/cve-2021-42013-httpd](https://github.com/cybfar/cve-2021-42013-httpd)

**漏洞详情:** [CVE-2021-42013](https://nvd.nist.gov/vuln/detail/CVE-2021-42013)