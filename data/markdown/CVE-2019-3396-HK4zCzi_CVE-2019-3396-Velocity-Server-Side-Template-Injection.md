## CVE-2019-3396-Confluence Widget Connector Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** Server-Side Template Injection (SSTI)

**影响应用:** Atlassian Confluence Server and Data Center

**危害等级:** 高危，允许远程攻击者在Confluence服务器或数据中心实例上实现路径遍历和远程代码执行。

**影响版本:** 受影响版本：Confluence Server 6.6.12之前，6.7.0至6.12.3之前，6.13.0至6.13.3之前，6.14.0至6.14.2之前

**利用条件:** 需要Confluence服务器存在Widget Connector宏，且服务器版本在受影响范围内。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396是一个影响Atlassian Confluence Server和Data Center的服务器端模板注入漏洞。该漏洞存在于Widget Connector宏中，允许未经身份验证的远程攻击者通过构造恶意的请求，执行任意代码。 

**有效性：**
根据漏洞库信息和搜索引擎结果，该漏洞是一个已知的、已被积极利用的漏洞，存在公开的PoC（Proof of Concept）代码。多个安全厂商（如Rapid7、Trend Micro等）都发布了关于该漏洞的分析和利用的报告。提供的PoC代码 `README.md` 文件表明该漏洞可以通过Velocity模板注入实现。虽然只提供了一个简单的 `README.md` 文件，但根据搜索结果，存在多个可用的PoC利用代码。

**投毒风险：**
提供的漏洞利用代码仅包含一个 `README.md` 文件，描述了漏洞名称。从现有文件本身来看，不存在明显的恶意代码。 但是，如果从其他源获取利用代码，则存在潜在的投毒风险。攻击者可能会在PoC中添加恶意功能，例如安装后门、窃取凭据或进行其他未经授权的活动。因此，在使用任何第三方提供的PoC代码之前，务必进行彻底的安全审查。 投毒风险估计为10%，主要是考虑到从不可信来源获取PoC的潜在风险。

**利用方式：**
漏洞的利用方式是通过在Confluence页面的Widget Connector宏中注入恶意的Velocity模板代码。当Confluence服务器渲染包含恶意代码的页面时，会执行该代码，从而允许攻击者执行任意命令。

1.  **找到存在Widget Connector宏的Confluence页面。**
2.  **构造包含恶意Velocity模板代码的请求。**
3.  **将请求发送到Confluence服务器。**
4.  **服务器执行恶意代码，实现远程代码执行。**

攻击者可以利用此漏洞执行任意系统命令，读取或修改敏感数据，或完全控制Confluence服务器。 搜索结果显示，该漏洞已被用于传播加密货币挖矿恶意软件和Gandcrab勒索软件。

**项目地址:** [HK4zCzi/CVE-2019-3396-Velocity-Server-Side-Template-Injection](https://github.com/HK4zCzi/CVE-2019-3396-Velocity-Server-Side-Template-Injection)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)