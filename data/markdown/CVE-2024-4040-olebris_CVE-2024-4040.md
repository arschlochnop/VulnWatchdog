## CVE-2024-4040-CrushFTP-SSTI

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** CrushFTP

**危害等级:** 高危，可能导致任意文件读取、身份验证绕过和远程代码执行

**影响版本:** < 10.7.1 和 < 11.1.0

**利用条件:** 需要网络访问目标CrushFTP服务器

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-4040 是 CrushFTP 中存在的一个服务器端模板注入漏洞。未经身份验证的远程攻击者可以利用此漏洞读取文件系统中的任意文件（绕过 VFS 沙箱），绕过身份验证以获得管理员访问权限，并在服务器上执行远程代码。

**利用方式：**

1.  **漏洞点：** `/WebInterface/login.html` 接口的 `command` 参数存在SSTI。
2.  **利用过程：** 攻击者可以通过构造恶意的模板注入payload，例如使用 `exists` 命令读取任意文件，或执行其他恶意操作。
3.  **POC分析：** 提供的Python POC脚本尝试利用此漏洞。
    *   脚本首先禁用 SSL 警告（`requests.packages.urllib3.disable_warnings(...)`），这通常是为了方便测试，但也意味着它不验证服务器证书。
    *   设置User-Agent头。
    *   `get_files` 函数模拟登录过程，获取cookies。
    *   构造包含恶意 `command` 和 `paths` 的POST请求，发送到 `/WebInterface/login.html`。
    *   检查响应中是否包含 `<commandResult>`，如果包含，则认为目标存在漏洞。

**有效性评估：**
根据漏洞描述和POC代码，此POC是有效的，可以用于检测和利用 CVE-2024-4040。

**投毒风险评估：**
此POC代码的投毒风险较低，约为5%。
*   **原因：** 代码主要功能是发送HTTP请求并检测响应。虽然禁用SSL证书验证可能存在中间人攻击的风险,但这并非恶意投毒,而是为了测试方便.
*   **潜在风险：** 该脚本依赖于 `requests` 和 `colorama` 库。如果这些库被恶意替换，可能导致代码执行过程被篡改。
*   该脚本接受用户提供的目标和文件参数。如果用户提供的文件参数包含恶意命令，可能会对服务器造成损害，但这不是脚本作者的投毒行为。

**缓解措施：**
*   升级到 CrushFTP 10.7.1 或 11.1.0 及更高版本。
*   实施网络访问控制，限制对 CrushFTP 服务器的访问。
*   监控 CrushFTP 服务器日志，检测可疑活动。

**项目地址:** [olebris/CVE-2024-4040](https://github.com/olebris/CVE-2024-4040)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)