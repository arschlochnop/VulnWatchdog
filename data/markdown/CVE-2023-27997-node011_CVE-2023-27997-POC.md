## CVE-2023-27997-FortiOS/FortiProxy SSL-VPN 堆缓冲区溢出

**漏洞编号:** CVE-2023-27997

**漏洞类型:** 堆缓冲区溢出

**影响应用:** FortiOS/FortiProxy SSL-VPN

**危害等级:** 高危，可导致远程代码执行

**影响版本:** FortiOS: <= 7.2.4, <= 7.0.11, <= 6.4.12, <= 6.0.16; FortiProxy: <= 7.2.3, <= 7.0.9, <= 2.0.12, <= 1.2.13, <= 1.1.6

**利用条件:** 需要网络访问受影响的FortiOS/FortiProxy SSL-VPN服务

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-27997 是 FortiOS 和 FortiProxy SSL-VPN 中的一个堆缓冲区溢出漏洞。未经身份验证的远程攻击者可以通过发送特制的请求利用此漏洞在受影响的系统上执行任意代码或命令。

**有效性:**
根据搜索结果和漏洞库信息，该漏洞已被积极利用，并且存在公开可用的PoC代码。Bishop Fox 等安全公司已经发布了关于如何构建漏洞利用程序的文章。Rapid7也对此漏洞进行了跟踪。

**投毒风险:**
提供的代码包含三个文件：`README.md`、`calc_hashes.py` 和 `exp.py`。`README.md` 只是一个简单的使用说明。`calc_hashes.py` 用于预先计算一些哈希值，这有助于加快漏洞利用的速度。`exp.py` 包含实际的漏洞利用代码。查看`exp.py`，其中alloc_ssl函数创建socket对象，在reverse shell的上下文中可能是投毒代码。综上，这个仓库中存在作者隐藏投毒代码的风险较低，约为10%。

**利用方式:**
1.  **漏洞触发:** 攻击者发送特制的请求到存在漏洞的FortiOS/FortiProxy SSL-VPN服务。
2.  **堆溢出:**  该请求导致堆缓冲区溢出。
3.  **代码执行:**  攻击者利用堆溢出覆盖内存中的关键数据，从而控制程序流程并执行任意代码。
4.  **反弹shell (可能的利用方式):**提供的exp.py包含反弹shell的代码，该代码利用了shellcode.py，其中包含反向连接shellcode，允许攻击者在目标系统上执行命令。

从提供的POC代码看，利用过程涉及：

*   建立SSL连接。
*   进行堆喷射，以便在堆中布置特定的数据结构。
*   计算必要的哈希值以绕过安全检查。
*   生成包含恶意代码的payload，利用堆溢出覆盖相关内存区域，达到RCE的目的。

**缓解措施:**
*   升级到不受影响的FortiOS和FortiProxy版本。
*   如果无法立即升级，可以考虑禁用SSL-VPN服务。

**项目地址:** [node011/CVE-2023-27997-POC](https://github.com/node011/CVE-2023-27997-POC)

**漏洞详情:** [CVE-2023-27997](https://nvd.nist.gov/vuln/detail/CVE-2023-27997)