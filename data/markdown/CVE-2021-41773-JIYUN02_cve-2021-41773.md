## CVE-2021-41773-Apache HTTP Server-路径遍历/RCE

**漏洞编号:** CVE-2021-41773

**漏洞类型:** 路径遍历/远程代码执行

**影响应用:** Apache HTTP Server

**危害等级:** 高危，可能导致文件泄露和远程代码执行

**影响版本:** 2.4.49

**利用条件:** 需要目标服务器运行Apache HTTP Server 2.4.49，并开启了CGI脚本执行。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-41773是Apache HTTP Server 2.4.49中存在的一个路径遍历漏洞。攻击者可以利用该漏洞，通过构造特殊的URL，绕过Alias-like指令配置的目录限制，访问到服务器上的任意文件。如果服务器同时开启了CGI脚本执行，攻击者还可以利用该漏洞执行任意代码。

**有效性：**
提供的POC代码构建了一个包含漏洞的Apache HTTP Server 2.4.49环境。Dockerfile使用官方httpd:2.4.49镜像，并将自定义的html文件复制到/usr/local/apache2/htdocs/目录。然后，它安装了bash，并为/usr/local/apache2/htdocs/cgi-bin/test.sh添加了可执行权限。这个Dockerfile本身没有问题，但关键在于test.sh脚本的内容。如果test.sh包含恶意代码，则攻击者可以通过路径遍历漏洞执行它。

**投毒风险：**
Dockerfile只安装了bash,添加了test.sh的执行权限。如果`/tmp/4903a38a210c3406acebc545808a1928/html/cgi-bin/test.sh`脚本内容包含恶意代码，则存在投毒风险。但从dockerfile的内容来看，投毒的概率取决于test.sh,风险较低，大约在10%左右。

**利用方式：**
1.  **路径遍历：** 攻击者可以使用包含`..`序列的URL来遍历文件系统，例如：`http://target:8080/../../../../etc/passwd`，尝试读取服务器上的`/etc/passwd`文件。
2.  **远程代码执行：** 如果目标服务器启用了CGI，攻击者可以使用路径遍历来访问和执行CGI脚本，例如：`http://target:8080/cgi-bin/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fbin/bash -c 'id'`。

**总结：**
漏洞利用的核心在于构造包含特殊字符的URL，绕过服务器的访问控制。如果CGI可用，则可以直接执行代码。利用的成功与否取决于服务器的具体配置和文件权限。

**项目地址:** [JIYUN02/cve-2021-41773](https://github.com/JIYUN02/cve-2021-41773)

**漏洞详情:** [CVE-2021-41773](https://nvd.nist.gov/vuln/detail/CVE-2021-41773)