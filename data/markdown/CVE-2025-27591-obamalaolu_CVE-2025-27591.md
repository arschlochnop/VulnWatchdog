## CVE-2025-27591-below-权限提升

**漏洞编号:** CVE-2025-27591

**漏洞类型:** 权限提升

**影响应用:** below

**危害等级:** 高危，本地用户可以提升到root权限

**影响版本:** < 0.9.0

**利用条件:** 需要本地用户权限，且系统安装了below服务，并允许通过sudo执行/usr/bin/below。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2025-27591是一个权限提升漏洞，存在于below服务0.9.0之前的版本中。该漏洞是由于below服务创建了一个全局可写的目录/var/log/below，权限为0777。未经授权的本地用户可以通过符号链接攻击利用这个漏洞提升到root权限，具体利用方式如下：

1.  **漏洞原理：**
    *   below服务创建/var/log/below目录，并且赋予了777权限，这意味着任何用户都可以在该目录下创建、修改和删除文件。
    *   攻击者可以利用这一点，创建一个指向敏感文件（例如/etc/passwd）的符号链接。
    *   当below服务向/var/log/below/error_root.log（该文件是通过符号链接指向/etc/passwd）写入日志时，实际上是修改了/etc/passwd文件。

2.  **利用方式：**
    *   首先，检查当前用户是否可以通过sudo执行below命令 (`sudo -l | grep -q '/usr/bin/below'`)。
    *   备份/etc/passwd文件。
    *   生成一个包含恶意用户的/etc/passwd行，例如添加一个名为haxor的用户，并设置密码为hacked123。
    *   创建一个符号链接`/var/log/below/error_root.log`，指向`/etc/passwd`文件。`ln -sf "$TARGET" "$LINK_PATH"`
    *   利用`sudo /usr/bin/below replay --time "invalid" >/dev/null 2>&1`触发below服务向`/var/log/below/error_root.log`写入日志，强制其重建日志文件。
    *   将包含恶意用户的/etc/passwd行覆盖到`/var/log/below/error_root.log`（实际上是/etc/passwd）。`cat "$TMP_PAYLOAD" > "$LINK_PATH"`
    *   现在，攻击者可以使用新添加的用户（haxor）登录系统，从而获得root权限。`su haxor`

3.  **有效性：**
    提供的POC代码似乎有效，因为它实现了上述步骤，并且直接针对`/etc/passwd`文件进行了修改，从而添加了新的用户。

4.  **投毒风险：**
    代码分析表明，没有明显的投毒代码。虽然脚本会修改`/etc/passwd`，但这是漏洞利用的必要步骤，目的是提升权限。因此，投毒风险为0%。

5.  **缓解措施：**
    *   升级到below 0.9.0或更高版本。
    *   确保/var/log/below目录的权限正确设置，避免全局可写。

**项目地址:** [obamalaolu/CVE-2025-27591](https://github.com/obamalaolu/CVE-2025-27591)

**漏洞详情:** [CVE-2025-27591](https://nvd.nist.gov/vuln/detail/CVE-2025-27591)