## CVE-2021-22986-F5 BIG-IP/BIG-IQ-iControl REST RCE

**漏洞编号:** CVE-2021-22986

**漏洞类型:** 远程命令执行

**影响应用:** F5 BIG-IP/BIG-IQ

**危害等级:** 高危，可完全控制系统

**影响版本:** BIG-IP 16.0.x before 16.0.1.1, 15.1.x before 15.1.2.1, 14.1.x before 14.1.4, 13.1.x before 13.1.3.6, 12.1.x before 12.1.5.3; BIG-IQ 7.1.0.x before 7.1.0.3, 7.0.0.x before 7.0.0.2

**利用条件:** 目标存在未授权访问的iControl REST接口

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-22986 是 F5 BIG-IP 和 BIG-IQ 中 iControl REST 接口的一个未授权远程命令执行漏洞。根据漏洞库信息和搜索结果，该漏洞允许未经身份验证的攻击者通过向 iControl REST API 发送特制的请求来执行任意系统命令。POC代码通过两个阶段进行利用。第一阶段尝试利用`/mgmt/shared/authn/login`接口泄露一个token，如果失败，则尝试使用固定的Basic认证头绕过认证。获取token后，使用`/mgmt/tm/util/bash`接口执行命令。由于代码逻辑稍显复杂, 存在一小部分投毒的可能性, 主要风险在于代码的容错部分，即第一阶段尝试利用失败后，可能由于环境差异，导致硬编码的header认证失效，从而利用失败。

**有效性：**
根据公开信息，该漏洞被广泛利用，POC代码有效。

**投毒风险：**
该POC代码主要利用漏洞实现远程命令执行，并未发现明显的恶意代码。但其中包含连接目标URL的操作，存在一定风险。如果攻击者控制了代码托管平台或参与了代码的修改，理论上可以植入恶意代码，例如收集目标信息、传播恶意软件等。但是从代码本身来看，直接投毒的概率较低，因此评估为10%。

**利用方式：**
1.  **利用 iControl REST 接口：** 漏洞存在于 iControl REST 接口，攻击者需要能够访问该接口。
2.  **绕过身份验证：**  攻击者通过构造特殊的请求绕过身份验证。
3.  **执行命令：**  攻击者在绕过身份验证后，可以通过 `/mgmt/tm/util/bash` 接口执行任意系统命令。

**排序优先级依据：**
1.  **搜索引擎结果：** 提供了漏洞被实际利用的信息，表明漏洞具有现实危害。
2.  **漏洞利用代码：**  POC 代码展示了漏洞的利用方法，验证了漏洞的可行性。
3.  **漏洞库信息：**  提供了漏洞的基本信息和受影响的版本范围。

**项目地址:** [kiri-48/CVE-2021-22986](https://github.com/kiri-48/CVE-2021-22986)

**漏洞详情:** [CVE-2021-22986](https://nvd.nist.gov/vuln/detail/CVE-2021-22986)