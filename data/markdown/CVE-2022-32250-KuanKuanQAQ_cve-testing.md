## CVE-2022-32250-Linux Kernel Netfilter UAF 提权

**漏洞编号:** CVE-2022-32250

**漏洞类型:** Use-After-Free (UAF)

**影响应用:** Linux Kernel Netfilter

**危害等级:** 高危，本地用户可提升至root权限

**影响版本:** <= 5.18.1

**利用条件:** 需要创建 user/net namespaces 的权限

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-32250 是 Linux kernel 中 netfilter 子系统 net/netfilter/nf_tables_api.c 文件中的一个 use-after-free 漏洞。通过不正确的 NFT_STATEFUL_EXPR 检查，本地用户（能够创建 user/net 命名空间）可以将权限提升到 root。 

**有效性评估:**
根据漏洞库信息和搜索结果(特别是theori.io的博客和github链接)，已经存在公开的漏洞利用代码，并且已经成功利用该漏洞在 Ubuntu 22.04 上实现 root 权限提升。因此，提供的漏洞利用代码很可能是有效的。

**投毒风险评估:**
提供的代码片段是 COPYING 和 CREDITS 文件，不包含任何实际的漏洞利用代码。因此，无法直接评估漏洞利用代码本身的投毒风险。但是，考虑到漏洞利用代码通常需要 root 权限才能运行，恶意修改或添加后门的可能性较低。评估该压缩包其他代码，COPYING 和 CREDITS 文件不太可能包含恶意代码，因此投毒风险较低，预估投毒概率为5%。

**利用方式分析:**
根据漏洞库信息和搜索结果，利用方式的关键点如下：

1.  **触发条件：** 攻击者需要有创建 user/net namespaces 的权限。这通常意味着攻击需要在非容器化的环境中进行，或者在容器中具有 CAP_SYS_ADMIN 权限。
2.  **漏洞点：** 漏洞存在于 `net/netfilter/nf_tables_api.c` 文件中，由于 `NFT_STATEFUL_EXPR` 检查不正确导致 UAF。
3.  **利用步骤：** 攻击者需要构造特定的 netfilter 规则，触发 UAF 漏洞。通常涉及创建和删除 nf_tables set，利用 UAF 覆盖内核内存中的敏感数据，例如进程的凭据信息，从而实现权限提升。
4.  **缓解措施：** 更新 Linux 内核到受影响版本之后，或者禁用 user/net namespace 创建，可以缓解此漏洞。 Red Hat提到非容器化部署的 RHEL 8 受影响。

**项目地址:** [KuanKuanQAQ/cve-testing](https://github.com/KuanKuanQAQ/cve-testing)

**漏洞详情:** [CVE-2022-32250](https://nvd.nist.gov/vuln/detail/CVE-2022-32250)