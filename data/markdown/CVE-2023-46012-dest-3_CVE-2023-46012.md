## CVE-2023-46012 - Linksys EA7500 远程代码执行

**漏洞编号:** CVE-2023-46012

**漏洞类型:** 栈缓冲区溢出

**影响应用:** Linksys EA7500 路由器

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 所有版本，包括 3.0.1.207964 以及其他使用相同 IGD 二进制文件的型号和固件版本

**利用条件:** 需要网络可达，目标设备运行 IGD UPnP 服务（默认端口 49152）

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-46012 漏洞存在于 Linksys EA7500 路由器固件的 IGD UPnP 服务中。攻击者可以通过发送特制的 HTTP 请求到 IGD UPnP 服务，利用 `SetDefaultConnectionService` 功能中的栈缓冲区溢出漏洞执行任意代码。漏洞原因是程序在处理用户提供的 `NewConnectionType` 变量时，未对输入长度进行充分验证，导致 `strncpy` 函数将过长的数据复制到固定大小的栈缓冲区中。根据提供的 `README.md` 文件，利用方式如下：

1.  向目标设备的 49152 端口发送包含恶意 `NewConnectionType` 变量的 SOAP UPnP Action Request。
2.  `NewConnectionType` 变量的长度超过 184 字节，即可触发栈缓冲区溢出。
3.  覆盖栈上的返回地址，将其重定向到攻击者控制的地址，从而实现任意代码执行。

**有效性：**

根据漏洞描述和提供的 `README.md` 文件，该漏洞利用代码（`poc.py`，未提供，但可以推断其功能）应该能够有效利用该漏洞实现远程代码执行。

**投毒风险：**

仅分析了提供的 `README.md` 文件，未分析实际的 `poc.py` 代码。`README.md` 文件本身看起来没有明显的投毒代码。但是，如果实际的 `poc.py` 代码存在以下情况，则存在投毒风险：

*   包含后门程序，例如植入恶意 shellcode。
*   收集受害者信息并发送给攻击者。
*   修改路由器配置，例如更改 DNS 设置。
*   安装恶意软件。

由于只分析了 `README.md` 文件，且该文件只是漏洞的描述文档，因此判断投毒的概率较低，约为10%（假设 `poc.py` 可能包含恶意行为，但可能性不大）。

**利用方式：**

1.  攻击者构造包含恶意 `NewConnectionType` 变量的 SOAP UPnP Action Request。
2.  攻击者将该请求发送到目标 Linksys EA7500 路由器的 49152 端口。
3.  目标设备上的 IGD UPnP 服务处理该请求时，由于未对 `NewConnectionType` 变量的长度进行验证，导致 `strncpy` 函数将过长的数据复制到栈缓冲区中，触发栈缓冲区溢出。
4.  攻击者通过覆盖栈上的返回地址，将其重定向到攻击者控制的地址，从而执行任意代码，最终获取路由器的控制权。

**项目地址:** [dest-3/CVE-2023-46012](https://github.com/dest-3/CVE-2023-46012)

**漏洞详情:** [CVE-2023-46012](https://nvd.nist.gov/vuln/detail/CVE-2023-46012)