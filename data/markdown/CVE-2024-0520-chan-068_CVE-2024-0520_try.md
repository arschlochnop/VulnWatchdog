## CVE-2024-0520 - mlflow远程代码执行

**漏洞编号:** CVE-2024-0520

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** mlflow/mlflow

**危害等级:** 高危，可能导致数据泄露、服务器控制和拒绝服务

**影响版本:** < 2.9.0

**利用条件:** 需要能够向 mlflow 服务发送恶意构造的 HTTP 请求

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-0520 是 mlflow/mlflow 版本小于 2.9.0 中存在的一个远程代码执行漏洞。该漏洞源于 `mlflow.data.http_dataset_source.py` 模块在处理 HTTP 数据集来源时，没有对从 `Content-Disposition` 头部或 URL 路径中提取的文件名进行充分的安全过滤。攻击者可以通过构造包含路径遍历或绝对路径的文件名（例如 `'../../tmp/poc.txt'` 或 `'/tmp/poc.txt'`）的恶意 HTTP 响应，从而控制最终的文件写入路径，实现任意文件写入。虽然提供的 POC 代码 `/tmp/063456873d36b0f1f3e3efeacefdc092/malicious.csv` 看似无害，但它只是一个示例 CSV 文件。攻击者可以通过控制文件名，将该文件写入到恶意的位置，或者写入包含可执行代码的文件（例如，写入到 web server 的可访问目录并执行其中的代码，或者覆写系统配置文件）。因此，漏洞的利用关键在于控制 HTTP 响应的 `Content-Disposition` 头部或 URL，使得 mlflow 将恶意内容写入到攻击者指定的位置。 由于提供的 CSV 文件本身不包含任何恶意代码或后门，因此可以判断投毒风险为 0%。利用方式如下：

1.  攻击者搭建一个恶意 HTTP 服务器，该服务器返回一个包含恶意文件名的 `Content-Disposition` 头部的响应，或者使用包含恶意文件名的 URL。
2.  攻击者诱导 mlflow 服务从该恶意 HTTP 服务器加载数据集。
3.  mlflow 服务在处理该响应时，由于缺少适当的过滤，会使用攻击者控制的文件名来生成最终的文件路径。
4.  mlflow 服务将数据集内容写入到攻击者指定的位置，从而实现任意文件写入。
5.  如果攻击者写入的文件包含可执行代码，或者覆盖了关键系统文件，就可以实现远程代码执行。

**项目地址:** [chan-068/CVE-2024-0520_try](https://github.com/chan-068/CVE-2024-0520_try)

**漏洞详情:** [CVE-2024-0520](https://nvd.nist.gov/vuln/detail/CVE-2024-0520)