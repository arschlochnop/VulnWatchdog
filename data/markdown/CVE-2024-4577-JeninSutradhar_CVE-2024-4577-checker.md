## CVE-2024-4577-PHP-CGI参数注入

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 参数注入

**影响应用:** PHP

**危害等级:** 高危，可能导致远程代码执行、源码泄露

**影响版本:** 8.1.* < 8.1.29, 8.2.* < 8.2.20, 8.3.* < 8.3.8

**利用条件:** Windows系统，PHP以CGI模式运行，开启了使用"Best Fit"策略的代码页。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2024-4577是一个影响Windows上PHP-CGI的远程代码执行漏洞。当PHP以CGI模式运行时，如果系统配置了使用"Best-Fit"策略的代码页，Windows可能会使用此策略替换传递给Win32 API函数的命令行中的字符。 PHP CGI模块可能会将这些字符错误地解释为PHP选项，从而允许恶意用户将选项传递给正在运行的PHP二进制文件，这可能导致泄露脚本源码、在服务器上运行任意PHP代码等。

**漏洞利用方式：**

1.  **攻击向量：** 通过构造特定的URL或POST请求，向PHP-CGI传递恶意参数。
2.  **参数注入：** 攻击者可以使用"Best-Fit"转换后的字符来注入PHP配置选项，例如`allow_url_include`和`auto_prepend_file`。
3.  **远程代码执行：** 利用`allow_url_include=1`和`auto_prepend_file=php://input`，攻击者可以将任意PHP代码作为请求体发送到服务器执行。

**POC有效性：**

提供的POC代码（`cve_2024_4577_checker.sh`）是一个漏洞检测脚本，用于扫描目标是否存在CVE-2024-4577漏洞。它通过发送包含恶意参数的HTTP请求来判断目标是否容易受到攻击。根据漏洞库信息和搜索结果,此漏洞已存在公开可用的exp. 

**投毒风险：**

该漏洞利用代码主要包含了一个检测脚本,用于检测目标是否存在漏洞, 漏洞利用代码本身主要用于检测,未发现明显的恶意行为。 但是为了保证绝对安全,仍需要人工review代码,  投毒风险较低，约为 1%.

**项目地址:** [JeninSutradhar/CVE-2024-4577-checker](https://github.com/JeninSutradhar/CVE-2024-4577-checker)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)