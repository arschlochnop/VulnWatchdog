## CVE-2022-21661-WordPress-SQL注入

**漏洞编号:** CVE-2022-21661

**漏洞类型:** SQL注入

**影响应用:** WordPress

**危害等级:** 高危，可能导致数据泄露和远程代码执行

**影响版本:** < 5.8.3

**利用条件:** 需要高权限用户（例如管理员）访问 `wp-admin/admin-ajax.php`，且WordPress版本低于5.8.3

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2022-21661 是 WordPress 5.8.3 之前版本中 `WP_Query` 类中由于不正确的输入清理而导致的一个SQL注入漏洞。攻击者可以利用此漏洞执行任意SQL查询。根据漏洞信息和搜索结果，POC代码是有效的。利用方式是通过构造恶意的 `tax_query` 参数，向 `wp-admin/admin-ajax.php` 发送 POST 请求，绕过 `WP_Query` 的 sanitization 从而执行 SQL 注入。具体来说，POC 使用 `extractvalue` 函数来提取数据库版本信息。

**有效性：**
提供的POC代码有效，可以通过POST请求触发SQL注入，并利用 `extractvalue` 函数提取数据库版本信息。

**投毒风险：**
该仓库主要包含：
*   `LICENSE`: MIT许可，允许自由使用和修改代码。
*   `README.md`: 漏洞说明和POC的使用方法。
*   `docker-compose.yml`: 用于快速搭建存在漏洞的WordPress环境。
*   `functions.php`: 替换WordPress镜像中原本的functions.php文件，该文件包含了修改后的functions.php.

`docker-compose.yml` 中挂载了 `functions.php` 文件，替换了 WordPress 镜像中原本的文件。攻击者可能在 `functions.php` 文件中添加后门代码，从而实现更深层次的攻击。由于`functions.php`并非官方文件，存在潜在的风险，但目前的代码来看，主要是为了配合POC演示，没有明显的恶意行为。因此，投毒风险较低，大约1%。

**利用方式：**
1.  搭建存在漏洞的 WordPress 环境（版本低于 5.8.3）。
2.  确保拥有具有访问 `wp-admin/admin-ajax.php` 权限的用户账户（通常是管理员账户）。
3.  使用提供的 POST 请求，修改请求中的 `your-ip:8080` 为目标 WordPress 站点的地址。
4.  发送 POST 请求到 `/wp-admin/admin-ajax.php`，其中包含恶意的 `tax_query` 参数。
5.  成功利用漏洞后，可以执行任意 SQL 查询，例如获取数据库版本信息，甚至可以读取或修改数据库中的数据。

**项目地址:** [w0r1i0g1ht/CVE-2022-21661](https://github.com/w0r1i0g1ht/CVE-2022-21661)

**漏洞详情:** [CVE-2022-21661](https://nvd.nist.gov/vuln/detail/CVE-2022-21661)