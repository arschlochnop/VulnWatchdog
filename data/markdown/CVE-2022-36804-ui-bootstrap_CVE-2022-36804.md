## CVE-2022-36804-Bitbucket-命令注入

**漏洞编号:** CVE-2022-36804

**漏洞类型:** 命令注入

**影响应用:** Atlassian Bitbucket Server and Data Center

**危害等级:** 高危，允许远程攻击者执行任意代码

**影响版本:** 7.0.0 before 7.6.17, 7.7.0 before 7.17.10, 7.18.0 before 7.21.4, 8.0.0 before 8.0.3, 8.1.0 before 8.1.3, 8.2.0 before 8.2.2, and 8.3.0 before 8.3.1

**利用条件:** 需要对公共仓库具有访问权限或对私有仓库具有读取权限

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-36804 是 Atlassian Bitbucket Server 和 Data Center 中多个 API 接口存在的一个命令注入漏洞。攻击者利用此漏洞，可以通过发送恶意 HTTP 请求，在目标系统上执行任意代码。根据漏洞描述，攻击者只需具备对公共仓库的访问权限或对私有仓库的读取权限即可。

**漏洞利用方式：**

1.  **确定目标：** 攻击者需要确定存在漏洞的 Bitbucket Server 或 Data Center 实例。
2.  **获取项目信息：** 利用`/repos?visibility=public`接口获取可访问的公共项目和仓库信息。
3.  **构造恶意请求：**  构造包含恶意命令的 HTTP 请求，利用`--exec`参数进行命令注入。Payload 位于URL中, 使用`%60`进行转义。
4.  **发送请求：** 将构造的恶意请求发送到目标 Bitbucket 服务器。
5.  **执行代码：**  如果漏洞存在，服务器将执行攻击者注入的命令。

**有效性分析：**

提供的POC代码尝试自动化上述步骤。它从文件中读取目标URL，然后尝试利用漏洞。POC代码首先尝试从公共仓库读取信息，以确定项目和仓库的名称，并构建利用URL。然后，它向目标发送带有注入命令的请求，并打印响应。

**投毒风险分析：**

在所提供的POC代码中，虽然作者试图通过执行任意命令来实现RCE，但是并没有明显的投毒代码。例如，代码没有尝试修改系统文件、安装恶意软件，或者未经授权访问其他资源。代码的主要功能是利用漏洞并显示命令执行的结果，虽然存在一定风险，但可以将投毒风险定义为较低的概率，定义为5%。

**项目地址:** [ui-bootstrap/CVE-2022-36804](https://github.com/ui-bootstrap/CVE-2022-36804)

**漏洞详情:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)