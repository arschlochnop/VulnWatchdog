## CVE-2023-38831-WinRAR-RCE

**漏洞编号:** CVE-2023-38831

**漏洞类型:** 远程代码执行

**影响应用:** WinRAR

**危害等级:** 高危，可能导致远程代码执行，系统完全控制

**影响版本:** < 6.23

**利用条件:** 用户需要使用WinRAR打开恶意的ZIP/RAR压缩文件

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于WinRAR处理ZIP压缩文件时，由于对文件名和文件夹名处理不当导致。攻击者可以构造一个包含恶意脚本的ZIP压缩文件，该压缩文件包含一个正常的诱饵文件（如PDF、PNG或JPG）和一个同名的文件夹，当用户尝试打开诱饵文件时，WinRAR会错误地执行该文件夹中的恶意脚本。

**有效性：**
根据漏洞信息、搜索引擎结果和漏洞利用代码，该POC代码有效。漏洞库信息表明该漏洞已被野外利用。搜索引擎结果中也包含了大量关于此漏洞的分析和利用报告，证实了该漏洞的有效性。POC代码的描述和实现也符合漏洞的利用方式，通过生成包含恶意脚本和诱饵文件的RAR压缩包来触发漏洞。

**投毒风险：**
代码本身看起来比较直接，主要是生成利用漏洞的压缩包。`script.bat` 这个文件需要额外注意。当前提供的 `script.bat` 只是打开了计算器 `calc.exe` 和 Web_Security.pdf,相对来说是安全的，但用户在使用该漏洞时，完全可以修改此文件，添加更加恶意的payload，具有一定的风险。作者在代码中没有明显投毒行为，主要风险在于用户如何使用该工具生成payload。
投毒风险评估：10% (主要是用户修改 `script.bat` 的风险)

**利用方式：**
1.  **构造恶意ZIP/RAR压缩文件：** 利用提供的Python脚本（cve-2023-38831-exp-gen.py）生成恶意的ZIP/RAR压缩文件。此脚本需要一个诱饵文件（如PDF、PNG、JPG）和一个恶意脚本文件（如BAT、CMD、或可执行文件）。该脚本会创建一个包含诱饵文件和一个同名文件夹的压缩包，并将恶意脚本放置在该文件夹中。
2.  **诱骗用户打开压缩文件：**  将生成的恶意ZIP/RAR压缩文件发送给目标用户。
3.  **执行恶意代码：** 当用户使用受影响的WinRAR版本打开压缩文件并尝试查看诱饵文件时，WinRAR会错误地执行同名文件夹中的恶意脚本，从而实现远程代码执行。

 总体来说，该漏洞利用方式较为简单，攻击成本较低，风险较高。

**项目地址:** [s4m98/winrar-cve-2023-38831-poc-gen](https://github.com/s4m98/winrar-cve-2023-38831-poc-gen)

**漏洞详情:** [CVE-2023-38831](https://nvd.nist.gov/vuln/detail/CVE-2023-38831)