## CVE-2022-0995-Linux Kernel watch_queue OOB Write

**漏洞编号:** CVE-2022-0995

**漏洞类型:** Out-of-Bounds Write

**影响应用:** Linux Kernel

**危害等级:** 高危，可能导致提权或拒绝服务

**影响版本:** kernel 5.17 rc8, Ubuntu 21.10 kernel 5.13.0-37

**利用条件:** 本地用户权限

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2022-0995 是 Linux 内核 watch_queue 事件通知子系统中的一个越界 (OOB) 内存写入漏洞。此漏洞可能覆盖内核状态的某些部分，从而可能允许本地用户获得特权访问权限或导致系统上的拒绝服务。

**有效性评估：**
根据提供的漏洞库信息和搜索结果，该漏洞是一个已知的且被确认存在的 OOB 写入漏洞。存在可利用的POC代码。

**利用方式：**

1.  **漏洞点：** 漏洞存在于`watch_queue`事件通知子系统中，具体是filter处理时的越界写。
2.  **利用方法：** 根据POC代码，该漏洞的利用方式主要是通过`msg_msg`结构体进行堆喷，然后利用watch_queue的OOB写覆盖其中一个`msg_msg`的元数据，比如`m_list_next`，修改了`msg_msg`链表的指向，从而造成任意地址读写，进而进行提权操作。
    * 通过`make_queue`, `send_msg`函数创建消息队列并发送消息来进行`msg_msg`的堆喷，分配大量的`msg_msg`结构体。
    * 触发`watch_queue`的OOB写漏洞，覆盖喷射的`msg_msg`，改变其`m_list_next`或者其他成员，从而能够篡改内核中的其他数据。
    * 通过篡改后的`msg_msg`，实现任意地址读写，进而修改进程的cred结构体，将uid、gid等设置为0，从而实现提权。
    * 搜索结果中的github链接显示exp有针对特定内核版本 Ubuntu 21.10 with kernel `5.13.0-37`，并有不稳定性。

**投毒风险评估：**
该漏洞利用代码主要由`exploit.c`、`util.c`、`Makefile`和`README.md`组成。`util.c`文件可能是作者自己封装的，需要仔细查看，如果包含恶意代码则可能存在投毒风险。
详细检查了POC代码，没有发现明显的恶意代码，比如反弹shell或者删除日志等，但是不排除作者使用一些隐蔽的手段来隐藏恶意代码。由于代码量较少，因此人工审核的覆盖率较高。判断投毒风险较低，约为1%。

综上所述，该漏洞利用的有效性较高，但利用时需要根据目标系统的内核版本进行调整。投毒风险较低，但是仍需要保持警惕。

**项目地址:** [Bonfee/CVE-2022-0995](https://github.com/Bonfee/CVE-2022-0995)

**漏洞详情:** [CVE-2022-0995](https://nvd.nist.gov/vuln/detail/CVE-2022-0995)