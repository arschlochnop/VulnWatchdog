## CVE-2017-7921-Hikvision摄像机-不当身份验证

**漏洞编号:** CVE-2017-7921

**漏洞类型:** 不当身份验证

**影响应用:** Hikvision Cameras

**危害等级:** 高危，可能导致权限提升和敏感信息泄露

**影响版本:** DS-2CD2xx2F-I Series V5.2.0 build 140721 to V5.4.0 build 160530, DS-2CD2xx0F-I Series V5.2.0 build 140721 to V5.4.0 Build 160401, DS-2CD2xx2FWD Series V5.3.1 build 150410 to V5.4.4 Build 161125, DS-2CD4x2xFWD Series V5.2.0 build 140721 to V5.4.0 Build 160414, DS-2CD4xx5 Series V5.2.0 build 140721 to V5.4.0 Build 160421, DS-2DFx Series V5.2.0 build 140805 to V5.4.5 Build 160928, and DS-2CD63xx Series V5.0.9 build 140305 to V5.3.5 Build 160106

**利用条件:** 目标设备开放HTTP端口(通常是80端口)

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2017-7921是一个Hikvision摄像机中发现的不当身份验证漏洞。该漏洞允许未经身份验证的攻击者通过构造特定的URL来访问敏感信息或执行特权操作。根据提供的POC代码，利用方式如下：

1.  **漏洞利用方式：**
    *   通过发送包含`auth=YWRtaW46MTEK`的特殊构造的HTTP请求到特定的URL，例如`/Security/users`、`/onvif-http/snapshot`或`/System/configurationFile`，可以绕过身份验证。
    *   `/Security/users` URL用于获取摄像机的用户列表。
    *   `/onvif-http/snapshot` URL用于获取摄像头的快照。
    *   `/System/configurationFile` URL用于下载摄像机的配置文件。

2.  **有效性：**
    *   提供的POC代码似乎是有效的。它使用`requests`库发送HTTP请求，并检查响应状态代码以确定漏洞是否存在。如果状态代码为200，则认为漏洞存在，然后根据设定的level参数，执行后续操作，如获取用户名，下载配置文件，抓取快照等。
    * 搜索引擎结果中也明确说明了该漏洞的存在性以及未授权访问的可能性。

3.  **投毒风险：**
    *   代码中存在轻微的投毒风险。主要体现在对异常的处理上不够严谨，虽然存在`try...except`块，但只是简单的打印错误信息，没有进行更详细的错误处理或日志记录。此外，`decrypt_configurationFile.py`模块是否安全未知，如果此模块本身被篡改，则可能存在投毒行为。代码会把目标和端口写入fail.txt或succeed.txt。恶意攻击者可能会用这些文件来进行下一步的攻击。
    *   从整体上看，该脚本主要功能是漏洞利用，不太可能包含恶意投毒代码。初步评估投毒风险较低，约为5%。

**项目地址:** [201646613/CVE-2017-7921](https://github.com/201646613/CVE-2017-7921)

**漏洞详情:** [CVE-2017-7921](https://nvd.nist.gov/vuln/detail/CVE-2017-7921)