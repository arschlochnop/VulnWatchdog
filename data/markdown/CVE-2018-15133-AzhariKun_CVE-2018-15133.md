## CVE-2018-15133-Laravel-反序列化RCE

**漏洞编号:** CVE-2018-15133

**漏洞类型:** 反序列化RCE

**影响应用:** Laravel Framework

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** <= 5.5.40, 5.6.x <= 5.6.29

**利用条件:** 需要知道APP_KEY，并且目标存在未升级的Laravel框架漏洞版本。

**POC 可用性:** 是

**投毒风险:** 20%

## 详情

CVE-2018-15133是Laravel框架中的一个反序列化漏洞，攻击者通过在X-XSRF-TOKEN中注入恶意序列化数据，并利用`Illuminate/Encryption/Encrypter.php`中的`decrypt`方法进行解密时触发反序列化操作，从而执行任意代码。

**有效性：**
根据漏洞描述和搜索结果，提供的POC代码利用了该漏洞，通过上传包含恶意payload的XSRF-TOKEN，理论上是有效的。该代码首先尝试从`.env`文件中获取`APP_KEY`，然后将目标站点和`APP_KEY`发送到 `http://exploit.anons79.com/`，进行后续处理。GitHub上也有公开的利用代码，可以辅助验证漏洞。

**投毒风险：**
POC 代码存在一定的投毒风险。

1.  **依赖外部网站**：POC 代码向 `http://exploit.anons79.com/` 发送数据。如果这个网站被攻陷或者被作者控制，可能被植入恶意代码。所以具有一定的风险。
2.  **未知的恶意行为**：`http://exploit.anons79.com/` 站点的行为是不透明的。虽然POC声称是自动上传shell,但实际实现可能包含未知的恶意行为，例如：收集目标信息，植入更深层次的后门。
3.  **`.env` 文件泄露**:  直接尝试从 `.env` 文件中读取 `APP_KEY` 存在风险，可能导致敏感信息泄露。

综合来看，投毒风险大概在20%左右。

**利用方式：**
1.  **获取APP_KEY：** 攻击者首先需要获取Laravel应用的APP_KEY。这可以通过多种方式实现，例如：
    *   直接读取.env文件（如果配置不当允许访问）。
    *   通过其他漏洞（如文件包含、SQL注入等）获取。
    *   猜测或者暴力破解（难度较高）。
2.  **构造恶意payload：** 攻击者使用phpggc等工具，根据已知的gadget chain构造恶意的序列化payload。
3.  **加密payload：** 使用APP_KEY和Laravel的加密算法对payload进行加密。
4.  **发送请求：** 将加密后的payload作为X-XSRF-TOKEN的值，发送到目标Laravel应用。
5.  **触发反序列化：** 当Laravel应用处理请求时，会解密X-XSRF-TOKEN，从而触发反序列化操作，最终执行payload中的恶意代码，实现远程代码执行。

**项目地址:** [AzhariKun/CVE-2018-15133](https://github.com/AzhariKun/CVE-2018-15133)

**漏洞详情:** [CVE-2018-15133](https://nvd.nist.gov/vuln/detail/CVE-2018-15133)