## CVE-2023-32784 - KeePass 主密码明文泄露

**漏洞编号:** CVE-2023-32784

**漏洞类型:** 内存泄露

**影响应用:** KeePass

**危害等级:** 高危，可能导致数据库中所有密码泄露

**影响版本:** < 2.54

**利用条件:** 需要能够访问目标系统内存dump，如KeePass进程dump、交换文件、休眠文件或RAM dump

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-32784 漏洞允许攻击者从 KeePass 2.x (低于 2.54 版本) 的内存 dump 中恢复明文主密码。即使工作区已锁定或不再运行，该漏洞仍然有效。提供的POC代码通过以下步骤利用该漏洞：

1.  **提取文件：** 从指定目录提取 .kdbx 和 .DMP 文件（内存dump）。
2.  **文件映射：** 将 .DMP 文件映射到对应的 .kdbx 文件。
3.  **提取部分主密码：** 使用修改后的 `keepass-dump-masterkey` 版本，从 .DMP 文件中提取部分主密码（缺少前两个字符）。
4.  **提取哈希：** 使用 `keepass2john` 工具从 .kdbx 文件中提取哈希。
5.  **关联信息：** 根据文件映射，将部分主密码与 .kdbx 文件关联起来。
6.  **Mask攻击：** 使用 Hashcat 执行 Mask 攻击，通过穷举前两个字符的所有可能组合，来重建完整的主密码。
7.  **保存结果：** 将破解的密码保存到 Hashcat 目录下的 `cracked_passwords.potfile` 中。

**有效性：** 根据漏洞描述和POC代码说明，该POC代码能够利用该漏洞，重建 KeePass 的主密码。

**投毒风险：**  代码存在少量投毒风险，因为该工具集成了多种第三方库，作者如果对其进行修改，可能会存在后门，如：hashcat等。并且原作者提供了一个修改版的`keepass-dump-masterkey`，这个修改版可能被作者植入后门，但是可能性较低，这里评估为10%。

**利用方式总结：**

1.  获取 KeePass 进程的内存 dump 文件（.DMP）。
2.  使用提供的 Python 脚本 (`exploit_keepass.py`)，结合 `keepass2john` 和 `hashcat` 工具，从内存 dump 中提取部分主密码，并使用 Mask 攻击补全密码。
3.  成功破解主密码后，即可解密 KeePass 数据库文件 (.kdbx)，从而访问所有存储的密码。

**项目地址:** [SarahZimmermann-Schmutzler/exploit_keepass](https://github.com/SarahZimmermann-Schmutzler/exploit_keepass)

**漏洞详情:** [CVE-2023-32784](https://nvd.nist.gov/vuln/detail/CVE-2023-32784)