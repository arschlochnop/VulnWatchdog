## CVE-2021-31166 - HTTP Protocol Stack Remote Code Execution Vulnerability

**漏洞编号:** CVE-2021-31166

**漏洞类型:** Use-After-Free

**影响应用:** HTTP.sys

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Windows 10 Version 2004, Windows Server version 2004, Windows 10 Version 20H2, Windows Server version 20H2 (版本号小于 10.0.19041.982 或 10.0.19042.982)

**利用条件:** 目标系统开启HTTP服务且未安装相应补丁

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-31166 是一个HTTP协议栈远程代码执行漏洞，存在于http.sys中，是一个典型的Use-After-Free漏洞。根据漏洞库信息，该漏洞影响多个Windows版本。CISA已知被积极利用。提供的POC代码通过发送特制的HTTP请求头，包含'Accept-Encoding': 'doar-e, ftw, imo, ,'，来触发漏洞。

**有效性：**
提供的POC代码看起来有效，至少能够触发程序崩溃，具体是否能直接执行任意代码取决于目标系统的缓解措施和攻击者的利用技巧。根据README.md文件，该PoC主要用于触发崩溃。

**投毒风险：**
检查提供的python脚本和readme文件，未发现明显的恶意代码。该POC仅仅是发送特定的请求，引发UAF漏洞。投毒风险较低，可以认为不存在投毒代码。

**利用方式：**
利用方式是通过发送特制的HTTP请求，其中`Accept-Encoding`头包含特定的值，触发HTTP.sys中的Use-After-Free漏洞。攻击者通过精心构造的HTTP请求，导致服务器在释放内存后再次使用该内存，从而可能执行任意代码。该POC主要用于触发崩溃，若要实现RCE，则需要更深入的研究和利用。

**项目地址:** [zha0gongz1/CVE-2021-31166](https://github.com/zha0gongz1/CVE-2021-31166)

**漏洞详情:** [CVE-2021-31166](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)