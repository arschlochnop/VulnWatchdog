## CVE-2023-33246-Apache RocketMQ-远程代码执行

**漏洞编号:** CVE-2023-33246

**漏洞类型:** 远程代码执行

**影响应用:** Apache RocketMQ

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** <= 5.1.0

**利用条件:** RocketMQ的NameServer, Broker, 和 Controller 组件暴露在公网，且缺少权限验证

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-33246 是 Apache RocketMQ 中的一个远程代码执行漏洞。根据漏洞信息，如果 RocketMQ 的某些组件（如 NameServer、Broker 和 Controller）暴露在公网上，并且缺乏权限验证，攻击者可以通过更新配置功能或伪造 RocketMQ 协议内容来执行任意命令，从而完全控制服务器。

**有效性：**

根据CISA KEV收录信息, 此漏洞在野外被积极利用，证明其有效性。
提供的漏洞利用代码 `check.py` 是一个版本检测脚本，它通过连接目标端口并发送特定请求来判断 RocketMQ 的版本。虽然这个脚本本身并不能直接执行远程命令，但它可以用来确认目标是否为易受攻击的版本。

**投毒风险：**

查看 `check.py` 代码，主要是进行版本检测，虽然代码量比较大，但是没有发现明显的恶意代码或后门。代码中包含了大量 RocketMQ 的版本字符串，用于进行版本比对。 线程池用于并发扫描IP，网络请求部分使用了标准库，没有发现可疑的操作。因此，投毒风险较低，估计在 10% 左右。

**利用方式：**

1.  **版本检测：** 使用 `check.py` 脚本或其他方法检测目标 RocketMQ 实例的版本是否在受影响范围内（<= 5.1.0）。
2.  **漏洞利用：** 如果目标版本易受攻击，攻击者可以利用以下两种方式执行远程命令：
    *   **更新配置功能：** 攻击者可以利用未授权的访问权限，通过更新 RocketMQ 的配置来插入恶意命令。
    *   **伪造 RocketMQ 协议内容：** 攻击者可以构造恶意的 RocketMQ 协议数据包，发送给目标服务器，从而触发远程命令执行。

**修复建议：**

*   升级到 RocketMQ 5.1.1 或更高版本（如果使用 RocketMQ 5.x）。
*   升级到 RocketMQ 4.9.6 或更高版本（如果使用 RocketMQ 4.x）。
*   对暴露在公网的 RocketMQ 组件进行严格的权限控制和访问验证。

**项目地址:** [0xKayala/CVE-2023-33246](https://github.com/0xKayala/CVE-2023-33246)

**漏洞详情:** [CVE-2023-33246](https://nvd.nist.gov/vuln/detail/CVE-2023-33246)