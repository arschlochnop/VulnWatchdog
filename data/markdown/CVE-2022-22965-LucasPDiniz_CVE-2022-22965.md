## CVE-2022-22965 Spring4Shell RCE

**漏洞编号:** CVE-2022-22965

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Spring Framework

**危害等级:** 高危，可导致服务器完全控制

**影响版本:** Spring Framework versions 5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+ and all old and unsupported versions, running on JDK 9+ with Tomcat as a WAR deployment.

**利用条件:** 需要目标应用满足特定条件：Spring MVC或Spring WebFlux应用，运行在JDK 9+，部署为WAR包在Tomcat上，并且使用了受影响的Spring Framework版本。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-22965 (Spring4Shell) 是一个 Spring Framework 远程代码执行漏洞。攻击者可以通过操纵类加载器，修改 Tomcat 的 AccessLogValve 组件配置，从而写入恶意 JSP webshell 到服务器，最终执行任意代码。

**有效性评估：**
提供的 POC 代码 `poc.py` 旨在利用该漏洞。它通过构造包含恶意参数的 HTTP POST 请求，修改 Tomcat 的 AccessLogValve 配置。这些参数用于设置 webshell 的文件名、后缀、目录和内容（shell 代码）。一旦 webshell 被写入，攻击者就可以通过访问该 webshell 来执行任意命令。

**投毒风险评估：**
查看poc.py的内容，该脚本的目的是写入 webshell，通过请求参数`cmd`的值执行命令。没有发现作者植入其他恶意或隐藏的代码。因此投毒风险为0%.

**利用方式：**
1.  **目标环境确认：** 确认目标应用是否满足漏洞利用条件 (Spring MVC/WebFlux, JDK 9+, WAR部署, Tomcat)。
2.  **构造恶意请求：** 使用 `poc.py` 脚本，指定目标 URL、webshell 文件名、密码和存放目录。脚本会发送一个精心构造的 HTTP POST 请求到目标服务器。
3.  **写入 Webshell：** 如果漏洞存在，服务器会将包含恶意代码的 JSP 文件写入指定的目录。
4.  **远程代码执行：** 攻击者可以通过访问写入的 webshell (例如 `http://target/filename.jsp?pwd=password&cmd=whoami`) 来执行任意命令。

**项目地址:** [LucasPDiniz/CVE-2022-22965](https://github.com/LucasPDiniz/CVE-2022-22965)

**漏洞详情:** [CVE-2022-22965](https://nvd.nist.gov/vuln/detail/CVE-2022-22965)