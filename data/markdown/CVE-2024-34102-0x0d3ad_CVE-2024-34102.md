## CVE-2024-34102-Adobe Commerce-XXE

**漏洞编号:** CVE-2024-34102

**漏洞类型:** XXE

**影响应用:** Adobe Commerce/Magento

**危害等级:** 高危，可能导致任意代码执行，敏感信息泄露

**影响版本:** <=2.4.7, <=2.4.6-p5, <=2.4.5-p7, <=2.4.4-p8

**利用条件:** 无需用户交互，需要网络访问

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-34102是Adobe Commerce/Magento的一个XML外部实体注入（XXE）漏洞。攻击者可以通过发送特制的XML文档，该文档引用外部实体来利用此漏洞。利用成功后，可能导致任意代码执行和敏感信息泄露，例如读取服务器上的文件。根据漏洞库信息和搜索引擎结果，该漏洞危害极大，CVSS评分为9.8，且已被CISA列入已知被利用的漏洞。提供的PoC代码通过构造一个包含恶意XML的请求，尝试读取服务器上的文件（例如crypt key）。

**有效性:**

根据漏洞信息和提供的PoC代码，可以判断该PoC代码是有效的。漏洞库信息和搜索引擎结果都表明这是一个关键的XXE漏洞，无需身份验证即可利用。PoC代码模拟了攻击者发送恶意XML请求的行为，通过定义外部实体来读取服务器上的文件。

**投毒风险:**

PoC代码本身主要用于验证漏洞的存在和影响，但仍存在很小的投毒风险：

*   **Payload定制化风险:**  攻击者可能修改PoC中读取的文件路径，从而尝试窃取其他敏感信息，或者执行更具破坏性的操作。
*   **依赖风险:**  PoC依赖于目标系统存在特定的文件和配置，如果目标系统环境与预期不符，PoC可能无法成功执行，导致使用者产生误判。
*   **网络请求风险:**  PoC会发起网络请求到攻击者控制的服务器，存在被恶意利用的风险，例如窃取使用者IP地址等。

总的来说，该PoC代码的投毒风险较低，大约为5%。因为其主要目的是利用XXE漏洞读取文件，而不是执行恶意代码。然而，使用者仍然需要注意潜在的风险，并在安全的环境中测试和使用该PoC代码。

**利用方式:**

1.  **搭建恶意服务器:**  攻击者需要搭建一个HTTP服务器，用于接收来自受害服务器的请求。PoC代码中使用了`http.server`模块来启动一个简单的HTTP服务器。
2.  **构造恶意XML:**  攻击者构造一个包含恶意XML的请求。XML中定义了外部实体，指向攻击者控制的HTTP服务器。当受害服务器解析该XML时，会尝试从攻击者的服务器获取外部实体。
3.  **发送恶意请求:**  攻击者将包含恶意XML的请求发送到受害服务器的`/rest/all/V1/guest-carts/test-assetnote/estimate-shipping-methods`端点。请求的`Content-Type`为`application/json`。
4.  **读取文件:**  受害服务器解析XML时，会尝试从攻击者的服务器读取外部实体。攻击者的服务器接收到请求后，会将请求中的文件内容进行base64编码，并通过URL返回给受害服务器。
5.  **解码文件:**  攻击者的服务器接收到受害服务器返回的base64编码的文件内容后，进行解码，即可获得受害服务器上的文件内容。

利用此漏洞，攻击者可以读取受害服务器上的敏感文件，例如配置文件、数据库连接信息等，甚至可以执行任意代码，从而完全控制受害服务器。

**项目地址:** [0x0d3ad/CVE-2024-34102](https://github.com/0x0d3ad/CVE-2024-34102)

**漏洞详情:** [CVE-2024-34102](https://nvd.nist.gov/vuln/detail/CVE-2024-34102)