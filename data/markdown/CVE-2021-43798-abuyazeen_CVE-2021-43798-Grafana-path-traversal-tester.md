## CVE-2021-43798 - Grafana 目录遍历

**漏洞编号:** CVE-2021-43798

**漏洞类型:** 目录遍历

**影响应用:** Grafana

**危害等级:** 高危，可能导致敏感信息泄露

**影响版本:** 8.0.0-beta1 到 8.3.0 (除已修复版本)

**利用条件:** 需要网络访问，并且 Grafana 实例存在漏洞。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

该漏洞是 Grafana 8.0.0-beta1 到 8.3.0 版本中的一个目录遍历漏洞(CVE-2021-43798)。攻击者可以利用该漏洞读取服务器上的任意文件。漏洞位于`/public/plugins/<plugin ID>/`路径下，通过构造恶意的 URL，可以绕过权限校验，读取到本不该访问的文件。

**利用方式：**

1.  确定目标 Grafana 实例的版本是否在受影响范围内。
2.  找到一个可利用的插件ID。所有插件均可利用，例如 alertGroups, alertlist等。
3.  构造包含目录遍历的 URL，例如：`https://<grafana_host_url>/public/plugins/alertGroups/../../../../../../../../../../etc/passwd`，用于读取 `/etc/passwd` 文件。
4.  使用 HTTP 请求发送构造好的 URL。
5.  如果请求成功，响应体将包含被读取的文件内容。

**有效性：**

提供的 POC 代码通过读取 `paths.txt` 文件中的路径，批量测试 Grafana 实例是否存在该目录遍历漏洞。它通过 `curl` 命令发送 HTTP 请求，并使用 `--path-as-is` 参数来避免 URL 规范化。如果 HTTP 状态码为 200，则将响应体保存到文件中。该 POC 代码是有效的，可以用于检测目标 Grafana 实例是否存在该漏洞。

**投毒风险：**

分析提供的 POC 代码，脚本本身的功能是自动化检测目录遍历漏洞，没有发现任何明显的投毒代码。`paths.txt` 包含一些常见的文件路径，如 `/etc/passwd` 和 Windows 上的 `win.ini`，用于验证漏洞是否存在。因此，投毒风险评估为0%。

**项目地址:** [abuyazeen/CVE-2021-43798-Grafana-path-traversal-tester](https://github.com/abuyazeen/CVE-2021-43798-Grafana-path-traversal-tester)

**漏洞详情:** [CVE-2021-43798](https://nvd.nist.gov/vuln/detail/CVE-2021-43798)