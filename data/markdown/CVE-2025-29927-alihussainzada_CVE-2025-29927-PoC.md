## CVE-2025-29927-Next.js中间件绕过

**漏洞编号:** CVE-2025-29927

**漏洞类型:** 授权绕过

**影响应用:** Next.js

**危害等级:** 高危，可能导致未经授权的访问和数据泄露

**影响版本:** 13.x < 13.5.9, 14.x < 14.2.25, 15.x < 15.2.3

**利用条件:** 受影响版本的Next.js应用，并且使用了NextAuth中间件进行权限验证

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2025-29927 漏洞是 Next.js 中间件授权绕过漏洞。该漏洞源于对 `x-middleware-subrequest` HTTP header 处理不当，攻击者可以通过操纵该header绕过中间件的授权检查，访问受保护的资源。 

**漏洞利用方式：**
1. 攻击者向目标 Next.js 应用发送特制的 HTTP 请求，其中包含精心构造的 `x-middleware-subrequest` header。
2. Next.js 应用的中间件在处理请求时，由于header的欺骗性内容，错误地认为请求来自内部子请求。
3. 中间件跳过正常的身份验证和授权检查。
4. 攻击者成功访问原本需要授权才能访问的资源。

**投毒风险分析：**
查看提供的POC代码，主要包含 Dockerfile、README.md、middleware.js、package.json、globals.css、_app.js 和 dashboard.js 等文件。这些文件构成了一个基于 Next.js 和 NextAuth 的简单身份验证示例，用于演示 CVE-2025-29927 漏洞的利用。

Dockerfile 用于构建 Docker 镜像，方便部署和测试。
README.md 提供了漏洞描述、影响版本、复现步骤和参考链接。
middleware.js 是核心，实现了带授权的中间件逻辑。利用方式即通过伪造`X-Middleware-Subrequest`请求头，绕过其中的`authorized`鉴权函数。该鉴权函数判断token是否存在，token不存在则redirect到登录页面。
package.json 定义了项目依赖，包括 next、react、react-dom、next-auth 和 bcryptjs。
globals.css 定义了全局样式。
_app.js 使用 SessionProvider 包裹了整个应用，以便在组件中使用 session。
dashboard.js 是一个受保护的页面，需要登录才能访问。如果未登录，则会被重定向到登录页面。

总体而言，提供的代码主要是用于演示漏洞，本身没有明显的恶意代码。代码中 bcryptjs 用于密码加密哈希存储，是常规操作。潜在的风险可能来自于依赖项，但需要进一步分析这些依赖项是否存在已知漏洞。此外，不排除作者可能在其他分支或 commit 中引入恶意代码，但根据目前提供的文件，**投毒风险较低，预估为10%**。主要是因为代码比较清晰，核心漏洞利用方式也比较明确。如果作者想投毒，可能需要在更隐蔽的地方，如依赖项或构建脚本中动手脚。

**POC有效性：** 提供的 PoC 代码利用了 `x-middleware-subrequest` header 来绕过 NextAuth 中间件的授权检查。该PoC重现了 CVE-2025-29927 漏洞，具有较高的有效性，可以证明该漏洞确实存在并可以被利用。

**项目地址:** [alihussainzada/CVE-2025-29927-PoC](https://github.com/alihussainzada/CVE-2025-29927-PoC)

**漏洞详情:** [CVE-2025-29927](https://nvd.nist.gov/vuln/detail/CVE-2025-29927)