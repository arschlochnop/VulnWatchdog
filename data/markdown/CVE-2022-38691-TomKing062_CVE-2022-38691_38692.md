## CVE-2022-38691/38692 Unisoc ROM 漏洞利用

**漏洞编号:** CVE-2022-38691

**漏洞类型:** 固件漏洞利用/引导链篡改

**影响应用:** Unisoc 设备

**危害等级:** 高危，可能导致设备完全控制和持久性后门

**影响版本:** 受影响的 Unisoc 设备型号未知，需具体分析

**利用条件:** 需要能够连接到设备的USB接口，并进入特定模式（如FDL1）

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

根据搜索结果和提供的代码，该漏洞与 Unisoc 芯片的 ROM 引导过程相关。CVE-2022-38691/38692 允许在没有签名验证的情况下启动 FDL1/SPL。 NCC Group 的研究表明，FDL1 存在缓冲区溢出漏洞（CVE-2022-38693），可用于在 USB 恢复模式下传输数据时执行任意代码。

提供的 C 代码是一个补丁工具，它读取配置文件，然后可能修改或创建镜像文件。它包含 SHA256 哈希计算功能，以及用于解析和处理配置文件的函数。Makefile 用于编译该工具。

**有效性：**
该 POC 代码本身是一个辅助工具，需要配合其他步骤才能实现完整的漏洞利用。代码实现了镜像文件的哈希计算，以及从配置文件中读取地址信息的功能。其目标是修改固件镜像，以便绕过安全启动的签名校验。

**投毒风险：**
代码本身存在潜在投毒风险。例如：
1.  在`_get_cfg`函数中，虽然有限制`LIST_MAX`的数量，但是如果`strtoull`函数解析恶意构造的数字，可能导致整数溢出或其他未定义行为。
2.  如果链接的`mincrypt`库存在漏洞，或者使用了修改过的`mincrypt`库，可能会引入新的安全问题。
3.  配置文件 `cfg` 可能包含恶意地址，指向可执行代码区域，导致执行恶意代码。

综合来看，虽然没有明显的恶意代码，但存在一定的风险，评定为10%。

**利用方式：**
1.  **利用 FDL1 漏洞（如 CVE-2022-38693）获取初始代码执行权限：** 通过 USB 连接，向 FDL1 发送特制的恶意数据，触发缓冲区溢出，从而控制程序计数器。
2.  **修改 Bootloader 或其他关键组件：** 使用初始代码执行权限，读取、修改设备的 Bootloader 或其他固件镜像。提供的 `patcher` 工具可能用于生成修改后的镜像。
3.  **绕过安全启动：** 通过修改 Bootloader，禁用签名校验或其他安全机制，使得设备能够加载并执行未经授权的代码。
4.  **植入后门：** 在固件中植入恶意代码，实现持久化控制，例如远程 shell 或数据窃取功能。

**总结：** 漏洞利用涉及多个步骤，包括利用 FDL1 漏洞、修改固件镜像、绕过安全启动和植入后门。提供的 POC 代码是该过程中的一个组成部分，用于辅助生成修改后的固件镜像。


**项目地址:** [TomKing062/CVE-2022-38691_38692](https://github.com/TomKing062/CVE-2022-38691_38692)

**漏洞详情:** [CVE-2022-38691](https://nvd.nist.gov/vuln/detail/CVE-2022-38691)