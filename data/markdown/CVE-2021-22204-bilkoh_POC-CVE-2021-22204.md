## CVE-2021-22204-ExifTool-DjVu-ANT-Perl注入

**漏洞编号:** CVE-2021-22204

**漏洞类型:** 代码注入

**影响应用:** ExifTool

**危害等级:** 中危，可能导致敏感信息泄露或执行恶意代码

**影响版本:** >=7.44, <12.24

**利用条件:** 需要用户处理恶意DjVu文件

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-22204 是 ExifTool 中 DjVu 文件处理模块的一个代码注入漏洞。该漏洞源于 ExifTool 在处理 DjVu 文件时，未正确地过滤用户提供的数据，导致攻击者可以在 DjVu 文件的元数据中嵌入恶意代码。当 ExifTool 解析包含恶意代码的 DjVu 文件时，嵌入的 Perl 代码会被执行，从而导致任意代码执行。  

**有效性:** 提供的 POC 代码是有效的。它利用 `djvumake` 工具创建包含恶意元数据的 DjVu 图像文件。具体来说，POC 脚本 `build_image.pl` 将用户提供的命令注入到 DjVu 文件的 ANTa (annotation) 区域。当易受攻击的 ExifTool 版本处理此文件时，ANTa 区域中的 Perl 代码会被执行。

**投毒风险:**  该 POC 代码的目的是为了利用漏洞，而非进行投毒。该脚本只是创建恶意 DjVu 文件，其行为符合漏洞描述。没有发现作者隐藏的、超出漏洞利用范围的恶意代码。投毒风险评估为0%。

**利用方式:**

1.  攻击者创建一个恶意的 DjVu 文件，其中包含精心构造的元数据，该元数据包含了要执行的恶意代码。
2.  攻击者诱使用户使用易受攻击版本的 ExifTool 处理这个恶意 DjVu 文件，例如通过电子邮件、网站上传等方式。
3.  当 ExifTool 解析 DjVu 文件时，它会提取元数据。
4.  由于漏洞，ExifTool 会执行恶意元数据中包含的 Perl 代码，从而导致任意代码执行。
5.  攻击者可以利用此漏洞在受害者的系统上执行任意命令，例如下载和执行恶意软件、窃取敏感信息等。

简单来说,就是通过构造恶意的DjVu文件,利用Exiftool解析DjVu文件时执行了文件内的恶意的Perl代码,从而导致命令执行

**项目地址:** [bilkoh/POC-CVE-2021-22204](https://github.com/bilkoh/POC-CVE-2021-22204)

**漏洞详情:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)