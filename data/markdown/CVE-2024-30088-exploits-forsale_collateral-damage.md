## CVE-2024-30088 Windows Kernel 权限提升漏洞

**漏洞编号:** CVE-2024-30088

**漏洞类型:** TOCTOU 竞争条件

**影响应用:** Windows Kernel

**危害等级:** 高危，可能导致权限提升至 SYSTEM

**影响版本:** 受影响版本包括Windows 10, Windows 11, Windows Server 2016, Windows Server 2019, Windows Server 2022等，详见CVE描述中的版本范围。

**利用条件:** 需要本地访问权限和运行Game Script UWP应用，或者使用键盘模拟器。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-30088 是一个 Windows Kernel 的权限提升漏洞，类型为 Time-of-check Time-of-use (TOCTOU) 竞争条件。攻击者可以利用此漏洞将权限提升至 SYSTEM。

**有效性评估：**

根据搜索引擎结果，此漏洞已被APT34等组织利用，且CISA KEV目录中也包含了此漏洞，表明该漏洞在野外已被积极利用。提供的PoC代码专门针对Xbox SystemOS，但是也表明漏洞本身是真实存在且可以被利用的。

**投毒风险分析：**

查看提供的 PoC 代码，主要文件包括 LICENSE, README.md, 和一些二进制文件，例如 `stage2.bin`和`run.exe`, 以及游戏脚本。`gamescript_autosave_network.txt`等

*   LICENSE：MIT 许可证，没有投毒风险。
*   README.md：描述了漏洞利用方法和注意事项，没有投毒风险。
*   `gamescript_autosave_network.txt`：包含用于在 Game Script 应用中执行的代码，需要修改 IP 地址。如果IP地址被篡改，可能导致反弹shell连接到错误的地址，存在一定风险。
*   `stage2.bin`和 `run.exe`：二进制文件，需要进一步分析才能确定是否包含恶意代码，但在未分析之前，认为存在一定风险。

总体来看，仓库中直接包含恶意代码的可能性较低，但存在一些潜在的风险点，例如被篡改的 IP 地址和未经分析的二进制文件。
综合评估，投毒风险为10%。

**利用方式：**

1.  利用 Game Script UWP 应用作为初始入口点。
2.  通过 Game Script 应用加载和执行恶意代码。
3.  利用 TOCTOU 竞争条件漏洞提升权限至 Kernel。
4.  在 SYSTEM 权限下执行 payload，例如反弹 shell。
5.  具体步骤包括：修改`gamescript_autosave_network.txt` 中的IP地址，将`stage2.bin` 和`run.exe` 部署到目标设备，然后运行 Game Script 应用执行攻击。

该PoC主要是用于Xbox环境,因此存在一定的局限性,但是利用方式可以借鉴.

**项目地址:** [exploits-forsale/collateral-damage](https://github.com/exploits-forsale/collateral-damage)

**漏洞详情:** [CVE-2024-30088](https://nvd.nist.gov/vuln/detail/CVE-2024-30088)