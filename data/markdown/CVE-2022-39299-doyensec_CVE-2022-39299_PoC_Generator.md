## CVE-2022-39299 - Passport-SAML 签名绕过

**漏洞编号:** CVE-2022-39299

**漏洞类型:** 签名绕过

**影响应用:** passport-saml

**危害等级:** 高危，可能导致身份验证绕过和未授权访问

**影响版本:** < 3.2.2

**利用条件:** 目标应用使用passport-saml进行SAML SSO集成，并且租户管理员可以配置自定义IdP。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-39299漏洞存在于passport-saml 3.2.2之前的版本中。攻击者可以利用多根XML元素绕过签名验证，从而伪造SAML响应，欺骗应用进行身份验证。攻击者需要拥有任意IDP签名的XML元素，或者能够触发生成签名消息。该漏洞的利用方式是构造包含多个根元素的SAML响应，其中一个根元素包含有效的签名（例如，错误消息），另一个根元素包含伪造的身份验证和授权信息。由于passport-saml只验证第一个根元素的签名，而XPath可以遍历多个根元素，因此可以绕过签名验证，篡改身份验证信息。

POC代码通过payloadGenerator.py生成包含恶意负载的SAML响应。根据代码，投毒风险较低，主要是因为POC依赖于用户自定义`payload_appendix.xml`来插入恶意认证/授权信息，且`openssl`证书生成也由用户控制。潜在的投毒点可能存在于`payloadGenerator.py`，但代码相对简单，人工审计和复现可以验证其安全性。README文件和相关链接指向了漏洞的详细信息和修复补丁，方便用户了解和修复漏洞。因此，投毒风险评估为较低。

**项目地址:** [doyensec/CVE-2022-39299_PoC_Generator](https://github.com/doyensec/CVE-2022-39299_PoC_Generator)

**漏洞详情:** [CVE-2022-39299](https://nvd.nist.gov/vuln/detail/CVE-2022-39299)