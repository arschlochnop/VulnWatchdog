## CVE-2021-21974-VMware ESXi OpenSLP 堆溢出

**漏洞编号:** CVE-2021-21974

**漏洞类型:** 堆溢出

**影响应用:** VMware ESXi

**危害等级:** 高危，可导致远程代码执行

**影响版本:** ESXi 7.0 before ESXi70U1c-17325551, 6.7 before ESXi670-202102401-SG, 6.5 before ESXi650-202102101-SG; VMware Cloud Foundation 4.x before 4.2 and 3.x

**利用条件:** 攻击者需与 ESXi 处于同一网络段，并能访问 427 端口

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-21974 存在于 VMware ESXi 的 OpenSLP 服务中，是一个堆溢出漏洞。攻击者通过发送特制的 SLP 数据包到 ESXi 服务器的 427 端口，可以触发 OpenSLP 服务的堆溢出，从而实现远程代码执行。 

**有效性评估：**
提供的POC代码是一个漏洞检测工具，而非直接的利用代码。它通过发送不同长度的 URL 和 Scope 字段到目标机器的427端口，并检测响应时间来判断目标是否存在漏洞。通过发送`DAAdvert`类型的SLP包，改变`url_len`和`scope_len`测试边界条件，这种方式相对安全，不会直接触发溢出，只是通过分析响应时间来判断。

**投毒风险评估：**
提供的代码主要用于检测漏洞是否存在，而不是利用漏洞。它没有包含任何恶意代码，用于在目标系统上执行恶意操作。因此，投毒风险评估为 0%。

**利用方式分析：**
1.  **漏洞触发：** 攻击者向 ESXi 服务器的 427 端口发送恶意的 SLP DAAdvert 请求。该请求中包含精心构造的 URL 和 Scope 字段，其长度超出 OpenSLP 服务预期的缓冲区大小。
2.  **堆溢出：** 当 OpenSLP 服务处理该请求时，由于长度验证不足或错误，导致数据写入超出缓冲区边界，覆盖相邻的内存区域，从而造成堆溢出。
3.  **代码执行：** 攻击者可以通过控制溢出内容，覆盖函数指针或其他关键数据，当程序执行到被覆盖的函数指针时，将跳转到攻击者预先布置的恶意代码，从而实现远程代码执行。

**项目地址:** [abirasecurity/CVE-2021-21974_vuln_dectection](https://github.com/abirasecurity/CVE-2021-21974_vuln_dectection)

**漏洞详情:** [CVE-2021-21974](https://nvd.nist.gov/vuln/detail/CVE-2021-21974)