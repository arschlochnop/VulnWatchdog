## CVE-2019-11043 PHP-FPM 远程代码执行

**漏洞编号:** CVE-2019-11043

**漏洞类型:** 缓冲区下溢

**影响应用:** PHP-FPM

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 7.1.x (< 7.1.33), 7.2.x (< 7.2.24), 7.3.x (< 7.3.11)

**利用条件:** 需要特定的 Nginx + PHP-FPM 配置，特别是 `fastcgi_split_path_info` 和 `PATH_INFO` 的使用

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

根据漏洞库信息、搜索引擎结果和提供的 Dockerfile 等文件，该漏洞 (CVE-2019-11043) 是 PHP-FPM 中的一个缓冲区下溢漏洞，可能导致远程代码执行。该漏洞影响特定版本的 PHP-FPM，并且需要 Nginx 的配合，特别是涉及到 `fastcgi_split_path_info` 和 `PATH_INFO` 的配置。漏洞的根源在于 PHP-FPM 在处理 `PATH_INFO` 时，可能计算错误，导致缓冲区下溢。 

**有效性：**
提供的 Dockerfile 和相关配置文件旨在搭建一个易于调试的漏洞环境。`docker-compose.yml` 允许通过端口 8080 访问 Nginx，通过 55555 端口使用 GDB 调试 PHP-FPM。 `entrypoint.sh` 启动 Nginx 和 PHP-FPM，并使用 GDB 附加到 PHP-FPM 进程，便于进行调试和漏洞利用验证。整体上是为了复现漏洞，利用的有效性很高。

**投毒风险：**
分析提供的文件，并未发现明显的恶意代码。`script.php` 只是简单地输出 `$_SERVER` 变量，用于调试和验证配置。`nginx.server.conf` 是标准的 Nginx 配置文件，用于将 PHP 请求转发到 PHP-FPM。 `php-fpm.conf` 是 PHP-FPM 的配置文件，配置了错误日志和进程管理。`README.md`只是一个简单的描述文件,`share/blank`是一个空文件,没有实际作用.Dockerfile 只是构建漏洞环境。因此，投毒的可能性较低，但是仍需谨慎，因为在构建复杂环境时，可能会引入不易察觉的恶意代码，所以投毒风险评估为10%。

**利用方式：**
利用方式主要围绕控制`PATH_INFO`变量。攻击者通过构造特殊的 URL，可以触发 PHP-FPM 中的缓冲区下溢，覆盖 FCGI 协议数据。进一步地，攻击者可以利用此覆盖来执行任意代码。 具体利用涉及对 Nginx 配置和 PHP-FPM 内部机制的深入理解。 通常，利用需要精心构造的 URL，利用 `fastcgi_split_path_info` 指令分割 URL，并控制 `PATH_INFO` 的值，以触发缓冲区下溢。参考[https://github.com/neex/phuip-fpizdam](https://github.com/neex/phuip-fpizdam), 该项目提供了具体的利用代码。


**项目地址:** [moniik/CVE-2019-11043_env](https://github.com/moniik/CVE-2019-11043_env)

**漏洞详情:** [CVE-2019-11043](https://nvd.nist.gov/vuln/detail/CVE-2019-11043)