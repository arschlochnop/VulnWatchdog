## CVE-2021-21300-Git-远程代码执行

**漏洞编号:** CVE-2021-21300

**漏洞类型:** 远程代码执行

**影响应用:** Git

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** >= 2.14.2, < 2.17.6
>= 2.18.0, < 2.18.5
>= 2.19.0, < 2.19.6
>= 2.20.0, < 2.20.5
>= 2.21.0, < 2.21.4
>= 2.22.0, < 2.22.5
>= 2.23.0, < 2.23.4
>= 2.24.0, < 2.24.4
>= 2.25.0, < 2.25.5
>= 2.26.0, < 2.26.3
>= 2.27.0, < 2.27.1
>= 2.28.0, < 2.28.1
>= 2.29.0, < 2.29.3
>= 2.30.0, < 2.30.1

**利用条件:** 需要受害者克隆恶意仓库，文件系统需要是大小写不敏感（如NTFS, HFS+, APFS），开启了符号链接支持，并且配置了clean/smudge filter (例如 Git LFS)

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-21300是Git中的一个远程代码执行漏洞，影响版本包括2.14.2到2.30.1之间的多个版本。漏洞源于当Git客户端在大小写不敏感的文件系统上，并且配置了clean/smudge filter和符号链接支持的情况下，恶意仓库可以利用符号链接和精心构造的文件，在克隆过程中执行任意代码。

**有效性：**

根据提供的POC代码，可以判断漏洞利用是有效的。该POC包含一个`.git/hooks/post-checkout`脚本，该脚本会在`git checkout`操作之后被执行。当受害者克隆包含该脚本的恶意仓库，并执行`git checkout`操作时，该脚本就会被执行，从而实现远程代码执行。 `echo PWNED >&2` 这段代码会将“PWNED”输出到标准错误流，表明漏洞利用成功。

**投毒风险：**

提供的POC代码本身并没有明显的投毒代码。它仅仅是为了演示漏洞而存在，其目的是在受害者机器上执行任意代码，而不是在代码仓库中植入后门，影响其他开发者或者构建系统。因此，仓库中存在作者隐藏的投毒代码的可能性较低。投毒风险评估为0%。

**利用方式：**

1.  攻击者创建一个包含恶意`.git/hooks/post-checkout`脚本以及其他相关文件的Git仓库。
2.  仓库中包含符号链接和使用了clean/smudge filter的文件，这些文件被设计为利用文件系统的大小写不敏感特性。
3.  攻击者诱导受害者克隆该恶意仓库。
4.  当受害者执行`git checkout`或其他触发`post-checkout` hook的操作时，恶意脚本会被执行，从而导致远程代码执行。

**项目地址:** [1uanWu/CVE-2021-21300](https://github.com/1uanWu/CVE-2021-21300)

**漏洞详情:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)