## CVE-2007-4559-Python tarfile 目录遍历漏洞

**漏洞编号:** CVE-2007-4559

**漏洞类型:** 目录遍历

**影响应用:** Python tarfile module

**危害等级:** 高危，可能导致任意文件写入

**影响版本:** 受影响版本未知，但漏洞在2007年被发现，长期存在

**利用条件:** 用户需要解压恶意构造的TAR文件

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2007-4559 存在于 Python 的 tarfile 模块中。`extract` 和 `extractall` 函数存在目录遍历漏洞，允许攻击者通过在 TAR 文件中包含带有 '..' 序列的文件名，覆盖目标系统上的任意文件。漏洞利用方式：

1.  **构造恶意的 TAR 文件：** 攻击者创建一个 TAR 文件，其中包含带有目录遍历序列（例如 `../../../../etc/passwd`）的文件名。
2.  **诱导用户解压：** 攻击者诱导用户使用 Python 的 `tarfile.extract` 或 `tarfile.extractall` 函数解压该 TAR 文件。
3.  **覆盖任意文件：** 当 `tarfile` 模块解压文件时，目录遍历序列会被解析，导致文件被写入到目标系统的任意位置，覆盖已有文件。

根据提供的代码片段，`creosote.py` 是一个静态分析工具，用于检测 Python 代码中是否存在使用 `tarfile.extractall` 函数且未进行安全检查的情况，它本身不是PoC，但有助于定位存在漏洞的代码。

**有效性：** 根据漏洞库信息和搜索结果，此漏洞是有效的。即使是很早期的漏洞，通过搜索结果可知，影响了大量的开源项目。

**投毒风险：** 给定的 `creosote.py` 代码是一个静态分析工具，目的是查找潜在的漏洞代码，而不是漏洞利用代码。`LICENSE.txt`和`README.md` 也没有投毒的可能。因此，该仓库本身不包含恶意代码，投毒风险为0%。

**利用方式：**
利用此漏洞通常需要以下步骤：

1.  创建一个包含恶意路径的tar文件，例如包含文件名为`../../../tmp/evil.txt`的文件。
2.  诱使用户使用存在漏洞的Python程序解压这个tar文件。
3.  如果程序没有进行适当的路径检查，`evil.txt` 就会被解压到 `/tmp/` 目录，从而实现目录遍历。

修复此漏洞的关键在于在解压前对文件名进行安全检查，确保不包含任何目录遍历序列。

**项目地址:** [advanced-threat-research/Creosote](https://github.com/advanced-threat-research/Creosote)

**漏洞详情:** [CVE-2007-4559](https://nvd.nist.gov/vuln/detail/CVE-2007-4559)