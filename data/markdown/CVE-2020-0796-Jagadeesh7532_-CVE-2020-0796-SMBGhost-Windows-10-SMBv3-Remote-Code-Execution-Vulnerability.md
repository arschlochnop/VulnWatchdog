## CVE-2020-0796 SMBGhost 远程代码执行漏洞

**漏洞编号:** CVE-2020-0796

**漏洞类型:** 远程代码执行

**影响应用:** Microsoft Windows SMBv3

**危害等级:** 高危，可能导致远程代码执行和系统控制

**影响版本:** Windows 10 Version 1903/1909 和 Windows Server, version 1903/1909

**利用条件:** 目标系统开启SMB服务，且未安装相应的安全补丁

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-0796（SMBGhost）是Microsoft SMBv3协议中的一个远程代码执行漏洞。漏洞源于SMBv3在处理压缩数据包时存在整数溢出，导致缓冲区溢出。攻击者可以通过构造恶意的SMBv3数据包，利用该漏洞在目标系统上执行任意代码。

**有效性：**
提供的POC代码是一个Python脚本，旨在检测目标系统是否存在CVE-2020-0796漏洞。该POC通过发送特制的SMBv3协商请求和压缩数据包来触发漏洞。根据漏洞库信息、搜索引擎结果以及POC代码本身，可以判断该POC在未经修复的Windows 10 1903/1909和Windows Server 1903/1909上是有效的。多个packetstormsecurity链接也提供了利用该漏洞的exp代码。

**投毒风险：**
代码中可能存在的投毒风险较低，约10%。主要是因为：
1.  该脚本相对简单，主要功能是发送SMB请求，触发漏洞进行检测。
2.  没有发现恶意代码片段，例如下载和执行外部程序等。
3.  该脚本主要利用溢出造成拒绝服务，真正的利用需要配合shellcode。当前代码功能有限。
但是，也不能完全排除隐蔽的投毒可能。例如，作者可能通过修改压缩算法、标志位或者偏移量来改变漏洞触发条件，从而影响目标系统的稳定性，或者收集一些系统信息。

**利用方式：**
1.  **SMB协议协商：** POC首先创建一个socket连接到目标主机的445端口（SMB服务端口）。然后发送一个SMB协商请求（`Smb2NegotiateRequest`），用于协商SMB协议版本和功能。
2.  **压缩数据包发送：** 核心在于发送一个恶意的压缩数据包(`Smb2CompressedTransformHeader`)。`offset = "\xff\xff\xff\xff"` 这一行是关键，它设置了一个非法的偏移量，导致在解压时发生缓冲区溢出。
3.  **触发漏洞：** 当目标系统尝试解压这个恶意的压缩数据包时，由于偏移量错误，导致内存写入越界，从而可能触发拒绝服务（DoS）或者远程代码执行（RCE）。
4.  **漏洞利用结果：** POC的主要目的是验证漏洞的存在，通常会导致目标系统崩溃或响应缓慢。如果成功实现了远程代码执行，攻击者可以利用该漏洞控制目标系统。

**项目地址:** [Jagadeesh7532/-CVE-2020-0796-SMBGhost-Windows-10-SMBv3-Remote-Code-Execution-Vulnerability](https://github.com/Jagadeesh7532/-CVE-2020-0796-SMBGhost-Windows-10-SMBv3-Remote-Code-Execution-Vulnerability)

**漏洞详情:** [CVE-2020-0796](https://nvd.nist.gov/vuln/detail/CVE-2020-0796)