## CVE-2024-6387-OpenSSH-RegreSSHion-RCE/DoS

**漏洞编号:** CVE-2024-6387

**漏洞类型:** 远程代码执行/拒绝服务

**影响应用:** OpenSSH

**危害等级:** 高危，可能导致远程代码执行并获取 root 权限或造成拒绝服务

**影响版本:** <= 9.7p1 (受影响版本 8.5p1 至 9.7p1)

**利用条件:** 需要目标服务器运行受影响版本的OpenSSH，且存在时间窗口内的未认证连接尝试。高危利用场景依赖glibc环境。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-6387，也被称为“regreSSHion”，是 OpenSSH 服务器 (sshd) 中发现的一个安全回归漏洞（CVE-2006-5051）。该漏洞源于信号处理中的竞争条件，可能导致 `sshd` 以不安全的方式处理某些信号。

**有效性：**
根据漏洞库信息和搜索结果，该漏洞的POC已经存在，并且能够实现远程代码执行和拒绝服务攻击。很多安全厂商和研究人员都发布了相关的分析报告和PoC代码。

**投毒风险：**
提供的漏洞利用代码（/tmp/270e32ae67508359811c0f9899155269/README.md 和 LICENSE）仅仅是声明了存在POC，根据现有信息，该仓库本身存在恶意代码的风险较低。但是，由于POC的执行具有高危性，在实际使用中，仍需要进行安全审查。

**利用方式：**
1.  **竞争条件：** 攻击者通过在短时间内发起大量未认证的连接尝试，触发 `sshd` 中的竞争条件。
2.  **信号处理：** 在特定的时间窗口内，`sshd` 可能会以不安全的方式处理信号，导致内存损坏或其他异常行为。
3.  **远程代码执行/拒绝服务：**  利用内存损坏或其他异常行为，攻击者可以执行任意代码（RCE），或导致 `sshd` 崩溃，造成拒绝服务（DoS）。部分利用依赖特定的glibc环境。
4.  **ProxyCommand注入:** 根据github仓库的README.md描述，该POC利用了 `ProxyCommand` 配置不当或滥用的情况，攻击者可以注入恶意命令到 `ProxyCommand` 中，从而获得命令执行或者横向渗透的能力。

**缓解措施：**
*   升级到 OpenSSH 9.8 或更高版本。
*   设置 `LoginGraceTime 0` 以禁用在指定超时时间内未完成身份验证时服务器断开连接的功能（Red Hat 建议的临时缓解措施，但会使服务器更容易受到 DoS 攻击）。
*   使用 `fail2ban` 等工具，配合防火墙来监控日志文件并适当管理连接。

**项目地址:** [Lost-Ryder/CVE-2024-6387-OpenSSH-ProxyCommand-RC](https://github.com/Lost-Ryder/CVE-2024-6387-OpenSSH-ProxyCommand-RC)

**漏洞详情:** [CVE-2024-6387](https://nvd.nist.gov/vuln/detail/CVE-2024-6387)