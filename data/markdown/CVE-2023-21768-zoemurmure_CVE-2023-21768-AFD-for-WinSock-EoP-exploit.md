## CVE-2023-21768-Windows Ancillary Function Driver for WinSock Elevation of Privilege Vulnerability

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 权限提升

**影响应用:** Windows Ancillary Function Driver for WinSock (afd.sys)

**危害等级:** 高危，攻击者可以利用此漏洞以提升的权限执行任意代码

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 需要本地访问权限

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-21768是一个Windows WinSock辅助功能驱动程序中的权限提升漏洞。攻击者可以通过此漏洞，在已受影响的系统上以提升的权限执行任意代码。根据提供的漏洞利用代码，该POC基于先前公开的分析，并添加了提权后的清理代码。根据github仓库显示的信息，该POC在Windows 11 22H2 (例如22621.963) 上测试成功。漏洞利用代码仓库中包含Visual Studio解决方案文件，表明这是一个用C++编写的本地提权漏洞利用程序。\n\n**有效性:**  提供的POC代码看起来是有效的，因为README中包含了成功提权的截图，并且说明了测试平台。\n\n**投毒风险:**  根据提供的代码片段，投毒风险较低。风险主要来自于编译后的二进制文件，源代码本身看起来是常规的漏洞利用代码。风险点在于作者的cleanup代码是否会进行恶意操作，但是该cleanup代码也是提权利用过程的一部分。综上所述，投毒风险估计在5%左右。\n\n**利用方式:**  利用方式涉及以下步骤：\n1.  编译提供的Visual Studio解决方案文件，生成可执行文件。\n2.  在受影响的Windows系统上，以低权限用户身份运行生成的可执行文件。\n3.  该漏洞利用程序会利用AFD驱动程序中的漏洞，通过未受信指针解引用，将权限提升至SYSTEM级别。\n4.  提权成功后，执行恶意代码。

**项目地址:** [zoemurmure/CVE-2023-21768-AFD-for-WinSock-EoP-exploit](https://github.com/zoemurmure/CVE-2023-21768-AFD-for-WinSock-EoP-exploit)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)