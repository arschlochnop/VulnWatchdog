## CVE-2025-29927-Next.js中间件授权绕过

**漏洞编号:** CVE-2025-29927

**漏洞类型:** 授权绕过

**影响应用:** Next.js

**危害等级:** 高危，可能导致未授权访问

**影响版本:** >= 11.1.4, <= 13.5.6; > 14.0.0, < 14.2.25; > 15.0.0, < 15.2.3

**利用条件:** 需要目标应用使用了Next.js中间件，且存在基于 x-middleware-subrequest 头的授权逻辑。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2025-29927 是 Next.js 中间件存在的一个授权绕过漏洞。攻击者可以通过在请求中设置 `x-middleware-subrequest` 头来绕过中间件的身份验证检查，从而访问受保护的路由。根据漏洞库信息和搜索结果，该漏洞影响多个 Next.js 版本。提供的 POC 代码演示了如何通过 `curl -H "x-middleware-subrequest: middleware" http://localhost:3000/admin` 命令绕过中间件保护访问 `/admin` 页面。漏洞利用代码中的 `middleware.ts` 文件展示了存在漏洞的中间件逻辑，该逻辑检查请求头 `x-middleware-subrequest` 是否存在，如果存在则绕过认证。该漏洞的利用方式简单，风险较高，需要及时升级 Next.js 版本进行修复。经过对poc代码分析，该仓库中基本不存在作者隐藏的投毒代码的可能性。

**有效性：**

提供的 POC 代码有效，可以成功绕过 Next.js 中间件的身份验证，访问受保护的路由。

**投毒风险：**

代码中没有明显的恶意代码，投毒风险较低，大约为1%。主要原因是该项目功能比较简单，代码量少，且目的性明确。

**利用方式：**

攻击者通过发送包含 `x-middleware-subrequest` 头的 HTTP 请求，欺骗 Next.js 中间件，使其认为该请求是内部子请求，从而绕过身份验证和授权检查。具体步骤如下：

1.  确定目标 Next.js 应用使用了中间件进行路由保护。
2.  构造 HTTP 请求，并在请求头中添加 `x-middleware-subrequest: middleware`。
3.  发送构造好的请求到受保护的路由。
4.  成功绕过身份验证，访问受保护的资源。

**项目地址:** [sn1p3rt3s7/NextJS_CVE-2025-29927](https://github.com/sn1p3rt3s7/NextJS_CVE-2025-29927)

**漏洞详情:** [CVE-2025-29927](https://nvd.nist.gov/vuln/detail/CVE-2025-29927)