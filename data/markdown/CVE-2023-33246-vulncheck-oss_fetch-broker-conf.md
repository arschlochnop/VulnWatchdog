## CVE-2023-33246-Apache RocketMQ-远程代码执行

**漏洞编号:** CVE-2023-33246

**漏洞类型:** 远程代码执行

**影响应用:** Apache RocketMQ

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** <= 5.1.0

**利用条件:** RocketMQ的NameServer, Broker, 和Controller组件暴露在公网上，且缺乏权限验证

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-33246 是 Apache RocketMQ 中的一个远程代码执行漏洞。受影响的版本是5.1.0及以下。攻击者可以通过以下两种方式利用此漏洞：

1.  **利用更新配置功能执行命令：** 由于RocketMQ的某些组件（如NameServer、Broker和Controller）暴露在公网上，并且缺乏适当的权限验证，攻击者可以利用更新配置的功能，注入恶意配置，从而以运行RocketMQ的系统用户身份执行任意命令。
2.  **伪造RocketMQ协议内容：** 攻击者也可以通过构造恶意的RocketMQ协议内容来达到相同的效果。

**有效性：**

根据漏洞库信息和搜索引擎结果，此漏洞被广泛认为是可以被利用的。CISA的已知被利用漏洞目录（KEV）中也包含了此漏洞，表明该漏洞已被积极利用。
提供的 Dockerfile 文件，显示这是一个使用Go语言编写的漏洞利用程序。它编译代码并将其作为容器的入口点执行。存在两个公开可用的exp库(https://github.com/Malayke/CVE-2023-33246_RocketMQ_RCE_EXPLOIT, https://github.com/jakabakos/CVE-2023-33246_Apache_RocketMQ_RCE )证明了漏洞的可利用性

**投毒风险：**

提供的代码片段主要是Dockerfile和License。Dockerfile描述了如何构建和运行exploit程序，但是没有直接体现exploit的具体行为。因此，需要分析exploit代码的具体逻辑才能判断是否存在投毒代码。考虑到只是构建过程，本身没有明显的投毒迹象。但是，由于最终的exploit二进制文件来自于构建过程，如果构建过程中存在恶意篡改，则可能存在投毒风险。所以投毒的风险为低。例如，可能存在在编译过程中下载其他恶意库并链接，或者直接修改编译后的二进制文件。

**利用方式：**

1.  **找到暴露在公网上的RocketMQ组件：** 首先，攻击者需要确定目标RocketMQ集群的NameServer、Broker或Controller组件是否暴露在公网上。
2.  **利用更新配置功能或伪造协议：** 攻击者可以构造恶意的请求，利用更新配置功能或者伪造RocketMQ协议内容，将恶意命令注入到目标系统中。
3.  **执行任意命令：** 成功利用漏洞后，攻击者可以以运行RocketMQ的系统用户身份执行任意命令，从而控制整个系统。

**项目地址:** [vulncheck-oss/fetch-broker-conf](https://github.com/vulncheck-oss/fetch-broker-conf)

**漏洞详情:** [CVE-2023-33246](https://nvd.nist.gov/vuln/detail/CVE-2023-33246)