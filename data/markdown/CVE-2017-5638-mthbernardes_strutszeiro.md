## CVE-2017-5638 Apache Struts2 远程代码执行

**漏洞编号:** CVE-2017-5638

**漏洞类型:** 远程代码执行

**影响应用:** Apache Struts2

**危害等级:** 高危，可导致服务器完全控制

**影响版本:** 2.3.x before 2.3.32, 2.5.x before 2.5.10.1

**利用条件:** 目标系统运行存在漏洞版本的Apache Struts2，且允许HTTP请求

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2017-5638是Apache Struts2 Jakarta Multipart parser中的一个远程代码执行漏洞。攻击者可以通过在Content-Type、Content-Disposition或Content-Length HTTP头中构造恶意OGNL表达式来执行任意命令。

**有效性分析：**
漏洞库信息、搜索引擎结果以及提供的漏洞利用代码都表明这是一个真实且高危的漏洞。搜索引擎结果中包含了漏洞的详细描述、利用方式以及受影响的版本。提供的漏洞利用代码是一个Telegram Bot，用于管理利用该漏洞创建的僵尸网络。该Bot通过Telegram命令来添加受害者服务器、执行命令等，进一步验证了漏洞的可利用性。

**投毒风险分析：**
该漏洞利用代码（strutszeiro.py及其相关文件）的投毒风险较低，约为10%。 主要风险点如下：

*   **配置文件：** `conf/token.conf` 和 `conf/group.conf` 存储了Telegram Bot的API Token和群组ID。如果攻击者控制了这些配置文件，他们可以窃取bot控制权，监控所有受害者服务器。
*   **actions.py:**botnet 方法中 cmd 的命令未校验，存在一定风险。
*  **strutszeiro.py:** 判断 chat_type 是否为 'group' ，存在一定风险，如果攻击者知道了bot token，私聊也能控制该bot。

代码本身的主要功能是利用Struts2漏洞进行远程命令执行，没有发现明显的后门或恶意代码。但是，用户需要谨慎配置Telegram Bot，并保护好API Token，防止泄露。

**利用方式：**

1.  **漏洞触发：** 攻击者发送包含恶意OGNL表达式的HTTP请求到存在漏洞的Struts2服务器。通常，这个表达式位于Content-Type头部，利用Jakarta Multipart parser的解析过程。
2.  **命令执行：** Struts2服务器在解析请求头时，会执行OGNL表达式，导致任意命令执行。
3.  **僵尸网络控制：** 提供的漏洞利用代码构建了一个Telegram Bot，攻击者可以通过该Bot远程控制受影响的服务器。
4.  **Telegram Bot命令：** 攻击者可以通过Telegram命令添加新的受害者服务器（`/add url`），在特定服务器上执行命令（`/exploit url *cmd`），在所有受害者服务器上执行命令（`/botnet cmd`），以及列出所有受害者服务器（`/list`）。

**项目地址:** [mthbernardes/strutszeiro](https://github.com/mthbernardes/strutszeiro)

**漏洞详情:** [CVE-2017-5638](https://nvd.nist.gov/vuln/detail/CVE-2017-5638)