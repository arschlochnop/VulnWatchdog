## CVE-2023-4226-Chamilo LMS-远程代码执行

**漏洞编号:** CVE-2023-4226

**漏洞类型:** 文件上传

**影响应用:** Chamilo LMS

**危害等级:** 高危，可导致远程代码执行

**影响版本:** <= 1.11.24

**利用条件:** 需要经过身份验证的learner角色

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-4226是Chamilo LMS <= v1.11.24中的一个文件上传漏洞。攻击者通过身份验证并拥有learner角色后，可以通过`/main/inc/ajax/work.ajax.php`上传恶意PHP文件，从而执行任意代码。从提供的搜索引擎结果和漏洞库信息来看，该漏洞允许通过上传webshell获取RCE。提供的POC代码尝试利用`/main/inc/lib/javascript/bigupload/inc/bigUpload.php`，这与漏洞描述的`/main/inc/ajax/work.ajax.php`不同。但是，github搜索结果显示存在一个名为`krishnan-tech/CVE-2023-4226-POC`的项目，该项目可能包含更合适的PoC。提供的代码可以上传恶意文件，但上传路径可能存在问题。

**有效性：** 根据漏洞描述，需要经过身份验证的learner角色，但POC中似乎没有处理身份验证的部分。因此，直接使用该POC可能无法成功利用该漏洞。POC利用的是`bigUpload.php`,而cve描述是`work.ajax.php`。

**投毒风险：** 提供的PoC代码主要功能是上传文件和执行命令或者反弹shell。代码本身没有明显的投毒行为，但是存在潜在风险。
*   **文件覆盖/删除:** 如果攻击者能够控制上传文件的内容和位置，他们可能会覆盖或删除系统中的重要文件，导致服务中断或数据丢失。
*   **资源耗尽:** 上传大量恶意文件可能会耗尽服务器的存储空间或带宽资源，导致拒绝服务。
*   **代码执行:** 虽然PoC主要关注上传文件，但如果服务器对上传的文件类型和内容没有进行充分的验证，攻击者可能会上传包含恶意代码的文件，并在服务器上执行。
因此，代码本身投毒风险较低，判断投毒概率为10%。

**利用方式：**

1.  **身份验证：** 首先，攻击者需要获得Chamilo LMS的账号，并具有learner角色。
2.  **上传恶意文件：** 利用`/main/inc/ajax/work.ajax.php`或者`/main/inc/lib/javascript/bigupload/inc/bigUpload.php`上传包含恶意PHP代码的文件（例如webshell）。
3.  **执行恶意代码：** 访问上传的PHP文件，触发恶意代码的执行，从而控制服务器。
提供的PoC尝试使用`/main/inc/lib/javascript/bigupload/inc/bigUpload.php`，通过`bigUploadFile`参数上传PHP文件，并尝试访问`/main/inc/lib/javascript/bigupload/files/{rev_shell_filename}`来执行上传的文件。


**项目地址:** [krishnan-tech/CVE-2023-4226-POC](https://github.com/krishnan-tech/CVE-2023-4226-POC)

**漏洞详情:** [CVE-2023-4226](https://nvd.nist.gov/vuln/detail/CVE-2023-4226)