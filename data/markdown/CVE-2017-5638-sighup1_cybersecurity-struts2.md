## CVE-2017-5638 - Apache Struts2 远程代码执行

**漏洞编号:** CVE-2017-5638

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Struts2

**危害等级:** 高危，可导致服务器完全控制

**影响版本:** 2.3.x before 2.3.32, 2.5.x before 2.5.10.1

**利用条件:** 目标系统运行存在漏洞版本的Apache Struts2，且攻击者能够发送HTTP请求。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2017-5638 是一个 Apache Struts 2 框架中的远程代码执行漏洞。该漏洞源于 Jakarta Multipart parser 在处理文件上传时的异常处理和错误信息生成不当。攻击者可以通过构造恶意的 Content-Type, Content-Disposition 或 Content-Length HTTP 头，特别是 Content-Type 头，其中包含 '#cmd=' 字符串，来执行任意命令。

**有效性：**
提供的 PoC 代码利用了 OGNL 表达式注入，通过修改 Content-Type 头来执行系统命令。根据漏洞库信息、搜索结果和 PoC 代码描述，该漏洞的利用方式是有效的。

**投毒风险：**
该仓库存在一定的投毒风险，评估约为10%。理由如下：
*   **免责声明：**仓库包含免责声明，这可能是为了规避潜在的法律责任，但并不能完全排除恶意目的。仓库作者声明“This is meant for educational, and research purposes only. I do not authorize or endorse any illegal or unethical use of this projects contents or information”，可能存在诱导使用者进行非法用途。
*   **不透明性：** 仓库作者在payload中调用了自定义的edu.uvu.ms.cybersecurity.Command类。如果没有对edu.uvu.ms.cybersecurity.Command类进行仔细的代码审计，可能存在恶意代码。如果 Command 类做了超出描述之外的事情（例如，记录命令、尝试提权、扫描网络等），那就存在风险。代码示例中， (#p.print('hello from MSCybersecurity'))这部分可能被替换为更具危害性的操作。
*   **依赖性：** PoC 需要 Send.jar。如果 Send.jar 来源不明或者被篡改，则可能存在安全风险。
*   **复杂性：** OGNL 表达式本身就非常复杂，容易隐藏恶意代码。 即使 payload 中的大部分逻辑看起来是良性的（例如，设置 Content-Type、清理 excludedPackageNames 等）， 仍然可能存在隐藏的、难以察觉的恶意代码片段。
*   **利用普及程度：**由于该漏洞影响广泛，并且利用代码已经公开，攻击者可以修改或者添加恶意代码，伪装成正常的 PoC，传播恶意软件或后门。

**利用方式：**
1.  攻击者发送一个特制的 HTTP 请求，该请求的 Content-Type 头包含恶意的 OGNL 表达式。
2.  Struts2 框架的 Jakarta Multipart parser 在处理该请求时，由于异常处理不当，会将 OGNL 表达式传递给 OGNL 引擎。
3.  OGNL 引擎执行该表达式，导致任意代码执行。
4.  PoC 代码展示了如何通过 OGNL 表达式来实例化 Java 类、调用方法和执行系统命令。
5.  攻击者利用该漏洞可以在服务器上执行任意命令，从而获取敏感信息、篡改数据或完全控制服务器。

**项目地址:** [sighup1/cybersecurity-struts2](https://github.com/sighup1/cybersecurity-struts2)

**漏洞详情:** [CVE-2017-5638](https://nvd.nist.gov/vuln/detail/CVE-2017-5638)