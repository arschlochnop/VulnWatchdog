## CVE-2021-3156-Sudo-Heap溢出

**漏洞编号:** CVE-2021-3156

**漏洞类型:** Heap-based 缓冲区溢出

**影响应用:** Sudo

**危害等级:** 高危，允许本地用户提升权限至root

**影响版本:** Sudo < 1.9.5p2

**利用条件:** 本地用户可执行sudo命令

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-3156，又名 Baron Samedit，是一个存在于 Sudo 1.9.5p2 之前版本中的堆缓冲区溢出漏洞。该漏洞源于 sudo 在解析命令行参数时存在的 off-by-one 错误。利用方式是构造以单个反斜杠结尾的特定命令行参数，当 sudoedit 以 -s 参数运行时会触发漏洞，造成堆溢出，最终允许本地用户提升权限至 root。

**有效性：**
根据漏洞库信息、搜索结果和提供的 POC 代码，此漏洞的POC有效。多个来源证实了该漏洞的存在和利用方式，POC代码也针对版本进行了判断。

**投毒风险：**
`programa.sh` 脚本本身的主要功能是检查 Sudo 版本是否易受攻击。它通过 `sudo --version` 命令获取版本信息，然后使用 `tr`、`cut` 和 `awk` 命令提取版本号。最后，它将提取的版本号与阈值（1828）进行比较，以确定 Sudo 版本是否易受攻击，并根据结果显示不同的消息。脚本核心逻辑是检查版本，没有明显的恶意行为。虽然该脚本本身目的在于检查漏洞是否存在，降低了直接利用的风险，**但是如果攻击者修改了检查逻辑，例如通过替换版本检查的命令结果，或者故意报告存在漏洞的版本实际上是安全的，则可能诱导用户错误地认为系统存在漏洞，然后执行其他恶意操作。**

因此，代码本身不包含明显的后门或恶意功能，但**如果被人篡改**，就可能存在投毒风险。基于这些因素，我判断存在 **10%** 的投毒风险。

**利用方式：**

1.  **触发条件:**  本地用户需要能够执行 sudo 命令。漏洞通过`sudoedit -s`触发，同时需要精心构造的、以反斜杠结尾的命令行参数。
2.  **漏洞原理:**  sudo 在解析命令行参数时存在 off-by-one 错误，导致堆缓冲区溢出。
3.  **利用过程:**  攻击者通过构造特殊的命令行参数，利用溢出覆盖堆内存中的关键数据，最终实现权限提升。
4.  **结果:**  成功利用该漏洞可以使本地用户获得 root 权限。

**项目地址:** [RodricBr/CVE-2021-3156](https://github.com/RodricBr/CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)