## CVE-2024-23334-aiohttp-目录遍历

**漏洞编号:** CVE-2024-23334

**漏洞类型:** 目录遍历

**影响应用:** aiohttp

**危害等级:** 中危，可能导致敏感信息泄露

**影响版本:** < 3.9.2

**利用条件:** 服务器启用了静态文件服务，并且设置了`follow_symlinks=True`

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-23334是aiohttp框架中的一个目录遍历漏洞。当`aiohttp.web.static`函数设置`follow_symlinks=True`时，会允许攻击者通过构造包含`../`的URL来访问静态文件根目录以外的文件。漏洞利用方式如下：

1.  **漏洞描述：** aiohttp在处理静态文件请求时，如果启用了`follow_symlinks`选项，则会跟随符号链接。但是，它没有正确验证符号链接是否指向静态文件根目录之外的位置，从而导致目录遍历漏洞。
2.  **利用方式：** 攻击者可以通过构造特殊的URL，例如`http://example.com/static/../../../../etc/passwd`，来访问`/etc/passwd`文件。其中，`/static`是静态文件根目录，`../../../../`用于向上遍历目录结构，最终到达根目录，然后访问`/etc/passwd`文件。
3.  **POC有效性：** 提供的POC代码通过HTTP请求发送构造好的payload，尝试读取目标文件。根据漏洞描述，如果服务器启用了静态文件服务并且设置了`follow_symlinks=True`，则POC代码可以成功读取文件内容，证明了该漏洞利用代码的有效性。
4.  **投毒风险分析：** 检查了提供的POC代码(`/tmp/1d893f94fb3ef20a17986f4c4260f619/exploit.py`)和README.md。该代码逻辑清晰，主要功能是构造包含`../`的payload进行目录遍历。没有发现任何可疑的代码或后门。因此，可以认为该仓库中不存在作者隐藏的投毒代码。代码仅实现了目录遍历，用于读取文件，没有发现任何其他恶意行为。
5.  **缓解措施：** 升级到aiohttp 3.9.2或更高版本，或禁用`follow_symlinks`选项，并使用反向代理。

**项目地址:** [wizarddos/CVE-2024-23334](https://github.com/wizarddos/CVE-2024-23334)

**漏洞详情:** [CVE-2024-23334](https://nvd.nist.gov/vuln/detail/CVE-2024-23334)