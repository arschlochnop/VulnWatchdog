## CVE-2025-29927-Next.js-中间件鉴权绕过

**漏洞编号:** CVE-2025-29927

**漏洞类型:** 鉴权绕过

**影响应用:** Next.js

**危害等级:** 高危，可能导致未授权访问

**影响版本:** >= 11.1.4, <= 13.5.6, > 14.0.0, < 14.2.25, > 15.0.0, < 15.2.3

**利用条件:** 需要目标应用存在Next.js中间件，且中间件的鉴权逻辑存在漏洞

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2025-29927 是一个 Next.js 中间件鉴权绕过漏洞。根据漏洞信息和搜索引擎结果，该漏洞是由于 Next.js 在处理 `x-middleware-subrequest` header 时存在缺陷，导致可以绕过中间件中的鉴权检查，从而访问受保护的资源。

**有效性：**
根据漏洞信息和搜索引擎结果，提供的 POC 代码基本有效。它通过设置 `x-middleware-subrequest` header 模拟内部子请求，从而尝试绕过中间件的鉴权。

**投毒风险：**
提供的代码仓库中，`nextjsmiddlewareexploit.py` 脚本的主要功能是发送带有特定 header 的 HTTP 请求。 `user-agents.txt` 文件包含常见的 User-Agent 字符串，用于模拟不同的浏览器和操作系统。没有发现明显的恶意代码或后门，因此投毒的风险较低,可以判断为0%。但是代码中的URL是示例网站，如果要对目标网站进行攻击，需要修改URL。

**利用方式：**
1.  攻击者构造包含 `x-middleware-subrequest` header 的恶意请求。
2.  Next.js 应用在处理该请求时，由于对 `x-middleware-subrequest` header 的处理不当，导致中间件的鉴权逻辑被绕过。
3.  攻击者从而可以访问原本需要鉴权才能访问的资源。

该漏洞的关键在于利用 `x-middleware-subrequest` header 欺骗 Next.js 应用，使其认为请求来自内部，从而跳过鉴权检查。

**修复建议：**
1.  升级 Next.js 到安全版本（>= 14.2.25 或 >= 15.2.3）。
2.  在中间件中，验证 `x-middleware-subrequest` header 的来源，确保它确实来自内部可信的来源。
3.  如果无法升级，可以阻止包含 `x-middleware-subrequest` header 的外部用户请求到达 Next.js 应用。

**项目地址:** [EarthAngel666/x-middleware-exploit](https://github.com/EarthAngel666/x-middleware-exploit)

**漏洞详情:** [CVE-2025-29927](https://nvd.nist.gov/vuln/detail/CVE-2025-29927)