## CVE-2018-19422-Subrion CMS-RCE

**漏洞编号:** CVE-2018-19422

**漏洞类型:** 远程代码执行

**影响应用:** Subrion CMS

**危害等级:** 高危，可完全控制服务器

**影响版本:** 4.2.1

**利用条件:** 需要Subrion CMS 4.2.1 实例，后台用户认证

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2018-19422 是 Subrion CMS 4.2.1 中的一个远程代码执行漏洞。该漏洞源于 `/panel/uploads` 目录未对上传的文件类型进行严格限制，导致攻击者可以通过上传包含恶意 PHP 代码的 `.pht` 或 `.phar` 文件来执行任意代码。

**有效性分析：**

根据漏洞库信息和搜索引擎结果，该漏洞是真实存在的，并且存在公开的漏洞利用代码。提供的 exploit.py 文件是一个 Python 脚本，它首先尝试登录到 Subrion CMS 后台，然后利用文件上传漏洞上传恶意 PHP 代码，最后通过访问上传的文件来执行代码。该脚本还包含对目标 URL 的检查，以确保 URL 以斜杠结尾，这表明作者修复了一个在使用该漏洞时的常见问题。所以POC代码是有效的。

**投毒风险分析：**

查看提供的漏洞利用代码，该代码的主要功能是利用漏洞实现远程代码执行，没有发现明显的恶意投毒代码。代码中包含登录尝试、CSRF token 获取、webshell 上传等功能，这些都是漏洞利用的正常步骤。在 `README.md` 文件中，作者也只是说明修复了一个URL的问题。虽然没有发现明显投毒代码，但仍需注意以下几点：

1.  该脚本需要提供用户名和密码才能登录后台，如果使用弱密码，可能会被攻击者利用。
2.  该脚本上传的 webshell 具有执行任意代码的能力，如果 webshell 被其他人访问，可能会导致服务器被完全控制。
3.  代码修改过的URL校验, 增加了该POC的成功率,但也可能被恶意修改后用于传播恶意软件。

综合来看，该仓库中存在作者隐藏的投毒代码的可能性较低，投毒风险估计在 5% 左右。

**利用方式分析：**

1.  使用提供的 `exploit.py` 脚本，指定目标 Subrion CMS 实例的 URL、用户名和密码。
2.  脚本首先尝试登录到 Subrion CMS 后台。
3.  如果登录成功，脚本会生成一个随机的 webshell 文件名，并上传包含恶意 PHP 代码的文件。
4.  上传成功后，脚本会输出 webshell 的访问 URL。
5.  攻击者可以通过访问该 URL 来执行任意 PHP 代码，从而控制服务器。

**项目地址:** [Swammers8/SubrionCMS-4.2.1-File-upload-RCE-auth-](https://github.com/Swammers8/SubrionCMS-4.2.1-File-upload-RCE-auth-)

**漏洞详情:** [CVE-2018-19422](https://nvd.nist.gov/vuln/detail/CVE-2018-19422)