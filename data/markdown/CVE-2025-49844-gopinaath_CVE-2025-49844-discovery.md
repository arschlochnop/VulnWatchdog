## CVE-2025-49844-Redis-Lua Use-After-Free

**漏洞编号:** CVE-2025-49844

**漏洞类型:** Use-After-Free

**影响应用:** Redis

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** < 8.2.2

**利用条件:** 需要Redis开启Lua脚本支持，且攻击者拥有执行Lua脚本的权限（如eval, evalsha命令）

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2025-49844是Redis中Lua脚本引擎的一个use-after-free漏洞。攻击者可以利用特制的Lua脚本操纵垃圾回收器，触发use-after-free，最终导致远程代码执行。该漏洞影响所有开启Lua脚本功能的Redis版本，直到8.2.2版本被修复。漏洞利用的关键在于构造特定的Lua脚本，利用Redis的Lua脚本执行环境的缺陷，触发内存错误。 

**有效性评估：**
根据漏洞库信息和搜索结果，该漏洞影响Redis 8.2.2之前的版本，并且存在远程代码执行的风险。Wiz的研究表明该漏洞CVSS评分为10，属于高危漏洞。该漏洞利用需要在Redis中执行恶意的Lua脚本，因此必须Redis服务器开启Lua脚本支持功能，并拥有执行lua脚本的权限。漏洞利用代码提供了用于查找AWS ElastiCache集群的脚本，该脚本的目的是为了发现存在漏洞的Redis实例。 

**投毒风险评估：**
提供的两个脚本 (`list-elasticache-clusters.sh` 和 `list-elasticache-clusters.txt`) 是用于枚举AWS ElastiCache集群的bash脚本。它们使用AWS CLI和`jq`命令来获取Redis和Valkey引擎的集群信息。这些脚本的目的是信息收集，而不是直接利用Redis的漏洞。这些脚本本身不包含任何恶意代码或后门。投毒风险为0%。

**利用方式分析：**
1.  **漏洞发现：** 利用`list-elasticache-clusters.sh`脚本（或者手动方法）发现目标Redis实例（版本低于8.2.2，且开启Lua脚本支持）。
2.  **权限验证：** 确认拥有执行Lua脚本的权限（例如，通过`AUTH`命令进行身份验证）。
3.  **脚本执行：** 使用`EVAL`或`EVALSHA`命令将精心构造的Lua脚本发送到Redis服务器执行。该Lua脚本的目的在于触发use-after-free漏洞，从而实现远程代码执行。构造Lua脚本是漏洞利用的关键步骤，具体脚本可能需要根据目标Redis服务器的具体环境进行调整。

**项目地址:** [gopinaath/CVE-2025-49844-discovery](https://github.com/gopinaath/CVE-2025-49844-discovery)

**漏洞详情:** [CVE-2025-49844](https://nvd.nist.gov/vuln/detail/CVE-2025-49844)