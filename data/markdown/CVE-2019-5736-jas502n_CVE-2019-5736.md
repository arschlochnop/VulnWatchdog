## CVE-2019-5736-runc容器逃逸

**漏洞编号:** CVE-2019-5736

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可导致容器逃逸，获取宿主机root权限

**影响版本:** <= 1.0-rc6 (Docker < 18.09.2)

**利用条件:** 需要能够以root身份在容器内执行命令（可以是新容器，或者已有的具有写权限的容器），并在宿主机上执行docker exec等操作

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-5736漏洞允许攻击者通过操控容器内的文件描述符，覆写宿主机上的runc二进制文件，当宿主机执行`docker exec`等操作时，会执行被覆写的恶意runc二进制文件，从而获得宿主机root权限。

**漏洞利用有效性分析：**

根据漏洞库信息、搜索引擎结果以及提供的漏洞利用代码，可以判断此漏洞的POC代码是有效的。漏洞描述明确指出攻击者可以通过特定的方法覆盖宿主机的runc二进制文件，从而获得宿主机的root访问权限。提供的代码包括了`exploit.c`、`payload.c`和`pwn.sh`，分别用于利用漏洞和执行恶意操作。漏洞利用脚本 `pwn.sh` 会不断扫描 `/proc/*/exe` 寻找 runc 进程，并利用 `exploit` 程序尝试覆盖 `/usr/bin/docker-runc`。

**投毒风险分析：**

分析提供的代码，发现以下潜在的风险点：

*   `payload.c`: 这是一个反向shell的payload，默认连接 `127.0.0.1:4455`。**如果攻击者修改了此IP地址，可能会连接到攻击者控制的服务器，构成潜在的后门。** 尽管当前代码连接的是本地地址，但在实际利用中，攻击者完全可以修改。
*   `exploit.c`:  该程序负责打开目标文件 `/proc/${pid}/exe` 并且进行覆盖，本身功能较为直接，投毒可能性较低。
*   `pwn.sh`:  该脚本主要负责查找目标进程并执行漏洞利用，投毒可能性较低。
*   `README.md`: 提到该exploit具有破坏性，会覆盖 `/usr/bin/docker-runc`。这是漏洞利用的正常行为，但可能被误解为投毒，实际这是漏洞利用方式。

**综合分析，投毒的风险主要集中在 `payload.c` 中潜在的后门连接，以及利用本身的破坏性。** 尽管大部分代码功能明确，但是依然存在被修改后植入恶意代码的可能性。因此，投毒风险评估为10%。

**漏洞利用方式总结：**

1.  **准备阶段：** 在容器内部，需要准备好编译环境（例如gcc）和相关依赖。修改`payload.c`中的`HOST`，指向攻击者控制的服务器，并编译`exploit.c`和`payload.c`。
2.  **寻找目标：** 运行`pwn.sh`脚本，该脚本会循环扫描`/proc/*/exe`，寻找包含`runc`的进程。
3.  **文件覆盖：**  找到目标进程后，`exploit`程序会尝试以`O_WRONLY | O_TRUNC`模式打开`/proc/${pid}/exe`（即宿主机的runc二进制文件），并将编译好的`payload`写入该文件。
4.  **触发漏洞：**  当宿主机执行`docker exec`等命令时，会调用被覆盖的runc二进制文件，从而执行`payload`，建立反向shell连接，攻击者获得宿主机root权限。

**项目地址:** [jas502n/CVE-2019-5736](https://github.com/jas502n/CVE-2019-5736)

**漏洞详情:** [CVE-2019-5736](https://nvd.nist.gov/vuln/detail/CVE-2019-5736)