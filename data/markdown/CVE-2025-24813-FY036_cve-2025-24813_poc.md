## CVE-2025-24813-Apache Tomcat-路径等价/反序列化

**漏洞编号:** CVE-2025-24813

**漏洞类型:** 路径等价/反序列化

**影响应用:** Apache Tomcat

**危害等级:** 高危，可能导致远程代码执行和信息泄露

**影响版本:** 9.0.0.M1 <= Tomcat <= 9.0.98, 10.1.0-M1 <= Tomcat <= 10.1.34, 11.0.0-M1 <= Tomcat <= 11.0.2

**利用条件:** 需要启用Default Servlet的写入权限, 支持Partial PUT, 且目标URL为公共上传URL的子目录, 攻击者需要知道敏感文件名, 安全敏感文件也通过partial PUT上传。或者，需要启用Default Servlet的写入权限, 支持Partial PUT, 应用使用Tomcat基于文件的session持久化，应用包含可用于反序列化攻击的库。

**POC 可用性:** 是

**投毒风险:** 95%

## 详情

CVE-2025-24813是Apache Tomcat中的一个漏洞，涉及路径等价问题，可能导致远程代码执行（RCE）和信息泄露。根据漏洞库信息和搜索引擎结果，该漏洞的利用涉及以下几个关键点：

1.  **路径等价 ('file.Name' (Internal Dot))**：攻击者可以通过操纵文件路径，绕过安全限制，访问或修改受保护的文件。
2.  **Default Servlet写入权限**：需要启用Default Servlet的写入权限（默认禁用）。
3.  **Partial PUT支持**：需要启用Partial PUT支持（默认启用）。攻击者可以通过分块上传恶意文件，从而绕过某些安全检查。
4.  **特定场景下的RCE**：
    *   如果应用程序使用Tomcat的基于文件的会话持久性，并且包含一个可以被用于反序列化攻击的库，攻击者可以通过上传包含恶意序列化数据的会话文件，执行任意代码。
    *   如果目标URL为公共上传URL的子目录, 攻击者需要知道敏感文件名, 安全敏感文件也通过partial PUT上传，可能导致信息泄露。

**漏洞利用方式：**

1.  **利用路径等价绕过**：攻击者可能利用`file.Name`中的内部点（Internal Dot）来访问或修改受保护的文件。
2.  **Partial PUT攻击**：攻击者通过分块上传恶意文件，例如包含恶意序列化数据的会话文件，到Tomcat服务器上。
3.  **反序列化漏洞利用**：如果应用程序包含可以被用于反序列化攻击的库，攻击者可以使用精心构造的序列化数据，在服务器上执行任意代码。

**POC代码分析：**

提供的POC代码 `CVE-2025-24813-poc.py` 尝试利用该漏洞。它执行以下步骤：

1.  **发送反序列化数据**：使用 `send_request` 函数发送一个base64编码的反序列化数据到Tomcat服务器。该请求使用 `Content-Range` 头，模拟Partial PUT请求。
2.  **触发反序列化**：使用 `send_request_two` 函数，通过设置 `JSESSIONID` cookie，尝试触发反序列化过程。
3.  **验证漏洞**：检查服务器的响应状态码。如果状态码为409（冲突）且`send_request_two`返回1（状态码500），则认为漏洞存在。

**有效性评估：**

该POC代码尝试利用了基于反序列化的RCE漏洞。但是，该POC并没有提供完整的利用链，只是验证了漏洞的存在。因此，该POC代码的有效性取决于目标应用程序是否满足漏洞利用的全部条件，包括：

*   启用了Default Servlet的写入权限。
*   支持Partial PUT。
*   应用程序使用Tomcat基于文件的会话持久性。
*   应用程序包含可用于反序列化攻击的库。

**投毒风险评估：**

该POC代码存在较高的投毒风险。原因如下：

*   **未知的反序列化利用链**：POC代码中使用的反序列化数据 `rO0ABXNyAAtFeHBsb2l0VGVzdAAAAAAAAAABAwAAeHB4` 只是一个占位符，并没有包含实际的恶意代码。攻击者需要自行寻找并插入合适的利用链，才能实现RCE。
*   **可能包含恶意代码**：由于利用链需要攻击者自行构造，攻击者可能会在POC代码中插入恶意代码，例如后门或恶意脚本，从而感染其他用户。
*   **依赖外部资源**：POC代码可能会依赖外部资源，例如远程服务器或恶意网站。攻击者可以通过篡改这些外部资源，实现投毒攻击。

由于存在上述风险，建议用户在使用该POC代码时保持警惕，并仔细审查代码，确保其不包含任何恶意成分。

**综上所述，该POC代码的有效性取决于目标环境的配置和应用程序的依赖。同时，由于反序列化利用的复杂性和潜在的恶意代码注入风险，该POC代码存在较高的投毒风险。**

**项目地址:** [FY036/cve-2025-24813_poc](https://github.com/FY036/cve-2025-24813_poc)

**漏洞详情:** [CVE-2025-24813](https://nvd.nist.gov/vuln/detail/CVE-2025-24813)