## CVE-2017-5638-Apache Struts2-远程代码执行

**漏洞编号:** CVE-2017-5638

**漏洞类型:** 远程代码执行

**影响应用:** Apache Struts2

**危害等级:** 高危，可能导致远程代码执行和服务器完全控制

**影响版本:** 2.3.x (before 2.3.32) 和 2.5.x (before 2.5.10.1)

**利用条件:** 目标系统运行存在漏洞的Apache Struts2版本，并且可以通过HTTP访问

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2017-5638是Apache Struts2框架中的一个远程代码执行漏洞，源于Jakarta Multipart parser在处理文件上传时的异常处理和错误消息生成不当。攻击者可以通过构造恶意的Content-Type、Content-Disposition或Content-Length HTTP头部来执行任意命令。

**有效性分析：**

根据漏洞信息、搜索结果以及提供的POC代码，可以判断此漏洞的POC代码是有效的。漏洞库信息明确指出该漏洞允许远程攻击者通过特制的HTTP头部执行任意命令，而搜索结果中也提供了大量的分析和利用案例。POC代码通过构造含有OGNL表达式的Content-Type头部，尝试在目标服务器上写入JSP后门，验证漏洞的存在。

**投毒风险分析：**

经过对提供的POC代码进行分析，未发现明显的投毒代码。该脚本的主要功能是利用漏洞在目标服务器上创建一个JSP文件（k22mn7.jsp），实现webshell的功能，从而验证漏洞的存在和进行进一步的利用。代码本身逻辑比较清晰，没有发现隐藏的恶意行为。 投毒风险评估为0%。

**利用方式分析：**

利用方式主要包括以下步骤：

1.  **构造恶意HTTP请求：** 攻击者需要构造一个包含恶意OGNL表达式的HTTP请求，特别是Content-Type头部。该表达式会被Struts2框架解析执行。
2.  **利用OGNL执行代码：** 恶意OGNL表达式用于在目标服务器上执行任意代码。常见的利用方式是在服务器上写入一个webshell，或者直接执行系统命令。
3.  **访问webshell：** 如果成功写入webshell，攻击者可以通过访问webshell来控制目标服务器。 

POC代码中的OGNL表达式尝试在服务器的`/k22mn7.jsp`处写入一个JSP后门，以便进一步控制。该POC首先尝试清除ognlUtil的排除列表，然后从输入流拷贝内容到`/k22mn7.jsp`，最后输出`upload_ok`。

漏洞利用的关键在于构造能够绕过Struts2安全机制的恶意OGNL表达式，并将其插入到HTTP头部中。

**项目地址:** [ludy-dev/XworkStruts-RCE](https://github.com/ludy-dev/XworkStruts-RCE)

**漏洞详情:** [CVE-2017-5638](https://nvd.nist.gov/vuln/detail/CVE-2017-5638)