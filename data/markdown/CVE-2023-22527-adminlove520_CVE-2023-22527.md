## CVE-2023-22527-Confluence-远程代码执行

**漏洞编号:** CVE-2023-22527

**漏洞类型:** 远程代码执行

**影响应用:** Atlassian Confluence

**危害等级:** 高危，允许未经身份验证的攻击者执行任意代码

**影响版本:** 8.0.0 <= version <= 8.5.3

**利用条件:** Confluence Server或Data Center实例运行在受影响版本上，并且可以通过网络访问

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2023-22527是一个Atlassian Confluence Server和Data Center中的模板注入漏洞。该漏洞允许未经身份验证的攻击者通过构造特定的请求，利用OGNL表达式注入执行任意代码。根据提供的漏洞利用代码，攻击者通过向`/template/aui/text-inline.vm`端点发送POST请求，并在请求体中构造包含恶意OGNL表达式的`label`参数。该OGNL表达式利用`freemarker.template.utility.Execute`类执行指定的命令，并将命令执行结果通过`X-Cmd-Response` HTTP头部返回。漏洞利用代码中的`exploit`函数展示了如何构造并发送此请求，`main`函数则提供了命令行参数解析功能，方便用户指定目标地址和待执行的命令。根据漏洞库信息和搜索引擎结果，此漏洞已被积极利用，存在被恶意利用进行cryptojacking和勒索软件攻击的案例。

**有效性：** 提供的POC代码有效，可用于在受影响的Confluence实例上执行任意命令。

**投毒风险：** 提供的代码较为简洁，直接实现了漏洞利用的功能。没有发现作者隐藏的恶意代码。风险判断为0%

**利用方式：**

1.  攻击者构造包含恶意OGNL表达式的POST请求，目标为`/template/aui/text-inline.vm`。
2.  恶意OGNL表达式利用`freemarker.template.utility.Execute`类执行指定的命令。
3.  命令执行结果通过`X-Cmd-Response` HTTP头部返回。
4.  攻击者从响应头部获取命令执行结果，从而实现远程代码执行。

**项目地址:** [adminlove520/CVE-2023-22527](https://github.com/adminlove520/CVE-2023-22527)

**漏洞详情:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)