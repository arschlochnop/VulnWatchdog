## CVE-2015-1328 - Ubuntu Overlayfs 本地提权漏洞

**漏洞编号:** CVE-2015-1328

**漏洞类型:** 本地提权

**影响应用:** Linux Kernel (Overlayfs)

**危害等级:** 高危，允许本地用户获取root权限

**影响版本:** Ubuntu Linux kernel package before 3.19.0-21.21, Ubuntu 12.04, 14.04, 14.10, 15.04

**利用条件:** 需要本地用户权限，overlayfs被允许在任意mount namespace中挂载

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2015-1328 漏洞存在于 Linux kernel 的 overlayfs 实现中，由于其在创建 upper filesystem 目录时没有正确检查权限，导致本地用户可以利用该漏洞获得 root 权限。漏洞利用方式是利用 overlayfs 挂载功能绕过权限检查，通过精心构造的文件系统操作，劫持 /etc/ld.so.preload，加载恶意动态链接库，从而执行任意代码并获取 root 权限。

**利用方式：**

1.  创建 user namespace。
2.  创建必要的目录结构 (work, upper, o)。
3.  使用 overlayfs 挂载 `/proc/sys/kernel` 或 `/sys/kernel/security/apparmor`到 `/tmp/ns_sploit/o` ，并利用权限绕过创建 `ld.so.preload` 文件。
4.  使用 overlayfs 挂载 `/etc` 到 `/tmp/ns_sploit/o`，将恶意的`ld.so.preload`文件写入 overlayfs 的 upper 层。
5.  创建一个恶意的动态链接库 `/tmp/ofs-lib.so`，其中包含在程序启动时执行恶意代码的 `getuid()` 函数。
6.  当具有 setuid 权限的程序（例如 `/bin/su`）运行时，恶意动态链接库会被加载，从而执行恶意代码并获取 root 权限。

**有效性：**

根据漏洞库信息、搜索引擎结果以及提供的漏洞利用代码，该漏洞利用代码是有效的。搜索引擎结果中存在多个指向 Exploit-DB 的链接，其中包含了该漏洞的利用代码。提供的代码也包含了完整的利用流程，包括创建 namespace、挂载 overlayfs、创建恶意动态链接库等。

**投毒风险：**

该仓库存在一定的投毒风险，尽管主要的代码看起来是漏洞利用相关的，但是以下几点需要注意：

1.  **依赖下载：** `exploit.sh`脚本中需要从攻击者服务器下载`exploit`可执行文件,如果这个下载链接被篡改，可能会引入恶意的可执行文件。
2.  **自动化脚本：**  `exploit.sh` 自动化了漏洞利用过程，如果脚本中存在隐藏的恶意命令，可能会在目标系统上执行。
3.  **动态链接库劫持：**  利用过程中需要创建和修改 `/etc/ld.so.preload` 文件，这本身就是一个潜在的后门植入点。尽管这个操作是漏洞利用的一部分，但如果被滥用，可能会导致持久性的安全风险。

虽然利用代码本身主要是为了提权，但也存在潜在的投毒风险，特别是通过 `exploit.sh` 脚本引入恶意代码的可能性。

**项目地址:** [elit3pwner/CVE-2015-1328-GoldenEye](https://github.com/elit3pwner/CVE-2015-1328-GoldenEye)

**漏洞详情:** [CVE-2015-1328](https://nvd.nist.gov/vuln/detail/CVE-2015-1328)