## CVE-2019-11043-PHP-FPM远程代码执行

**漏洞编号:** CVE-2019-11043

**漏洞类型:** 远程代码执行

**影响应用:** PHP-FPM

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** 7.1.x (< 7.1.33), 7.2.x (< 7.2.24), 7.3.x (< 7.3.11)

**利用条件:** PHP-FPM 使用不正确的 Nginx 配置 (如 `fastcgi_split_path_info`)

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-11043 是一个存在于 PHP-FPM 中的漏洞，当 PHP-FPM 运行在 Nginx 服务器上并且配置不正确时，可能导致远程代码执行。该漏洞源于 `env_path_info` 的一个下溢错误。攻击者可以通过构造特殊的 URL，利用该漏洞覆盖 FPM 进程中的内存，从而执行任意代码。

**有效性：**
根据提供的漏洞库信息、搜索结果和 POC 代码，该漏洞的 POC 代码有效。许多安全研究人员和厂商都确认了该漏洞的存在，并且已经发布了相应的补丁和修复方案。

**投毒风险：**
虽然提供的 POC 代码看起来是用于漏洞利用，但仍存在一定的投毒风险。风险点在于，攻击者可能修改 POC 代码，在成功利用漏洞后植入恶意后门或执行其他恶意行为。例如，在利用成功后，修改服务器配置文件、安装恶意软件等。POC 代码中存在多处调用 `requests.get()` 方法，攻击者可以在这些地方加入恶意请求或执行恶意代码。此外，利用成功后`print('Example: {}?a=%0asleep+5%0a'.format(target))`提示可以执行任意代码,如果攻击者修改这段代码植入恶意脚本,会造成投毒行为.综上，判定存在10%的投毒风险。

**利用方式：**
1.  **环境准备：** 目标系统需要运行存在漏洞的 PHP-FPM 版本，并且 Nginx 配置存在缺陷（使用了 `fastcgi_split_path_info` 等配置）。
2.  **漏洞检测：** 使用提供的 POC 脚本，通过发送特制的 HTTP 请求来判断目标系统是否存在漏洞。POC 脚本会尝试覆盖 `session.auto_start` 的值，如果请求返回包含 `Set-Cookie` 头部，则说明目标系统可能存在漏洞。
3.  **参数爆破：** 爆破 query 长度和 Header 头字段长度。
4.  **内存覆盖：**  通过精心构造的 HTTP 请求，利用下溢漏洞覆盖 FPM 进程中的内存，从而修改 PHP 的配置选项（例如 `error_log`、`include_path` 等）。
5.  **代码执行：**  通过修改 PHP 配置选项，将恶意代码写入到日志文件中，并通过 `auto_prepend_file` 或其他方式包含该日志文件，从而执行任意代码。
6.  **反弹shell/执行命令:**  通过`$_GET[a]` 参数,执行代码反弹shell或者执行特定命令.

**总结：**
CVE-2019-11043 是一个高危漏洞，攻击者可以利用该漏洞远程控制服务器。为了避免该漏洞带来的风险，建议及时升级 PHP 版本，并检查 Nginx 配置，避免使用不安全的配置选项。

**项目地址:** [MRdoulestar/CVE-2019-11043](https://github.com/MRdoulestar/CVE-2019-11043)

**漏洞详情:** [CVE-2019-11043](https://nvd.nist.gov/vuln/detail/CVE-2019-11043)