## CVE-2024-9474 PAN-OS Web Management Interface Privilege Escalation

**漏洞编号:** CVE-2024-9474

**漏洞类型:** 权限提升/OS命令注入

**影响应用:** PAN-OS

**危害等级:** 高危，允许经过身份验证的管理员以root权限执行操作。

**影响版本:** PAN-OS 10.1.0 to < 10.1.14-h6, 10.2.0 to < 10.2.12-h2, 11.0.0 to < 11.0.6-h1, 11.1.0 to < 11.1.5-h1, 11.2.0 to < 11.2.4-h1

**利用条件:** 需要管理员权限访问PAN-OS管理Web界面，且管理界面暴露在互联网或不受信任的网络中。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-9474是一个Palo Alto Networks PAN-OS软件中的权限提升漏洞。该漏洞允许具有管理Web界面访问权限的PAN-OS管理员使用root权限在防火墙上执行操作。

**有效性分析：**

提供的Python POC代码尝试利用此漏洞。它首先读取包含目标URL的文件，然后构造一个POST请求到 `/php/utils/createRemoteAppwebSession.php/watchTowr.js.map`，在`user`字段中注入OS命令。该命令会将`id`命令的输出写入`/var/appweb/htdocs/unauth/{random_str}.php`。然后，代码尝试通过生成的PHPSESSID访问该文件。如果文件中包含`gid=`，则认为该漏洞存在。

**投毒风险分析：**

此仓库的投毒风险较低，约为10%。虽然POC的功能是创建一个webshell, 但它是漏洞验证的一部分， 并非隐藏的恶意代码。

潜在的投毒风险点在于：

1.  代码中使用了 `http://127.0.0.1:7897` 作为代理，攻击者可能会将代理指向恶意服务器，截获或篡改受害者的请求。但是，这是一种常见的调试或测试技巧，并不一定是投毒行为。

**利用方式：**

1.  **漏洞点：** `/php/utils/createRemoteAppwebSession.php/watchTowr.js.map` 中的 `user` 参数存在命令注入。
2.  **攻击步骤：**
    a.  攻击者需要具有PAN-OS管理Web界面的管理员权限。
    b.  攻击者构造包含恶意命令的POST请求发送到上述URL，利用命令注入在服务器上创建webshell文件。
    c.  攻击者利用生成的session访问 webshell，执行任意OS命令，从而获得root权限。
3.  **缓解措施：**
    a.  升级到已修复的PAN-OS版本。
    b.  限制对管理Web界面的访问，仅允许来自受信任内部IP地址的访问。

**结论：** 该漏洞的利用方式较为直接，POC代码有效，但需要一定的条件（管理员权限和管理界面暴露）。投毒风险较低，但需要注意POC代码中使用的代理配置。

**项目地址:** [coskper-papa/PAN-OS_CVE-2024-9474](https://github.com/coskper-papa/PAN-OS_CVE-2024-9474)

**漏洞详情:** [CVE-2024-9474](https://nvd.nist.gov/vuln/detail/CVE-2024-9474)