## CVE-2025-61984 - OpenSSH 用户名控制字符注入导致代码执行

**漏洞编号:** CVE-2025-61984

**漏洞类型:** 代码注入

**影响应用:** OpenSSH

**危害等级:** 中危，可能导致远程代码执行，影响系统完整性

**影响版本:** < 10.1

**利用条件:** 需要配置ProxyCommand，并且用户名字段来源于不可信源（命令行或配置文件%-sequence扩展）

**POC 可用性:** 是

**投毒风险:** 20%

## 详情

根据CVE-2025-61984的描述，OpenSSH 10.1之前的版本允许用户名中包含控制字符，如果这些用户名来源于不可信源（命令行或配置文件中的%-sequence扩展），并且配置了`ProxyCommand`，则可能导致代码执行。

**有效性评估：**
提供的PoC代码利用换行符来混淆OpenSSH的`ProxyCommand`。通过在用户名中注入换行符，可以将攻击者指定的命令注入到`ProxyCommand`的执行上下文中。

**投毒风险评估：**
PoC代码包含两个文件：`README.md` 和 `poc.sh`。
*   `README.md`：包含漏洞描述、利用方法说明和GitHub仓库地址。没有发现恶意代码。
*   `poc.sh`：包含简单的命令`xcalc&` 和 `open -a Calculator&`，用于验证漏洞是否成功利用。这些命令本身无害，只是用于演示目的，验证成功弹出一个计算器，不能算作投毒代码。

但是, 仓库地址为`https://github.com/dgl/cve-2025-61984-poc`，克隆仓库时，如果用户不小心执行了 `git clone --recursive` 命令，则会递归克隆子模块(如果存在)。尽管当前提供的 `poc.sh` 无害，但攻击者可以在将来修改该仓库，添加恶意的子模块或更新 `poc.sh`，诱导用户执行恶意代码。 风险主要来源于不谨慎的 `git clone --recursive` 操作以及对第三方仓库的不信任。由于poc.sh代码的验证逻辑，以及github仓库的后续修改可能，投毒的风险为20%。

**利用方式：**
1.  配置`.ssh/config`文件，其中包含带有未引用的`%r`的`ProxyCommand`，例如：
    ```
    Host *.example.com
      ProxyCommand some-command %r@%h:%p
    ```
2.  使用包含控制字符（如换行符）的用户名尝试通过SSH连接到目标主机。例如，可以使用以下命令：
    ```
    ssh "user\nexploit_command"@host.example.com
    ```
3.  OpenSSH在执行`ProxyCommand`时，会错误地解析用户名，导致注入的命令被执行。

总而言之，该漏洞的利用需要特定的配置，并且攻击依赖于用户提供的输入。PoC代码本身主要用于验证漏洞，而非恶意利用。

**项目地址:** [dgl/cve-2025-61984-poc](https://github.com/dgl/cve-2025-61984-poc)

**漏洞详情:** [CVE-2025-61984](https://nvd.nist.gov/vuln/detail/CVE-2025-61984)