## CVE-2021-1675 PrintNightmare LPE

**漏洞编号:** CVE-2021-1675

**漏洞类型:** 本地提权（LPE）/远程代码执行（RCE）

**影响应用:** Windows Print Spooler

**危害等级:** 高危，可提升至SYSTEM权限并可能导致远程代码执行

**影响版本:** 受影响的Windows版本包括但不限于Windows 7, 8.1, 10, Server 2008, Server 2012, Server 2016, Server 2019, Server 2020H2, Server 21H1 等，具体版本号参考漏洞库信息

**利用条件:** 需要目标系统存在Print Spooler服务，攻击者需要能够上传DLL文件或通过网络触发漏洞（取决于利用方式）

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-1675（PrintNightmare）是一个Windows Print Spooler服务中的本地提权（LPE）/远程代码执行（RCE）漏洞。攻击者可以利用此漏洞在受影响的系统上以SYSTEM权限执行任意代码。

**有效性评估：**
根据漏洞库信息、搜索引擎结果和提供的PoC代码，该漏洞的PoC代码是有效的。搜索引擎结果中多个链接表明该漏洞存在公开可用的利用代码，且已被积极利用。CISA的已知被利用漏洞目录中也包含此漏洞，进一步验证了其有效性。

**投毒风险评估：**
分析提供的PoC代码（`/tmp/7e6baedcdfd18df6aba4daaa14ca5786/PrintNightMareLpe.cna`和`/tmp/7e6baedcdfd18df6aba4daaa14ca5786/README.md`）：

*   代码主要功能是利用 Cobalt Strike 框架，通过反射DLL注入的方式执行恶意代码以实现本地提权。
*   `PrintNightMareLpe.cna`脚本包含上传DLL到目标系统临时目录，然后通过`bdllspawn`函数加载DLL并执行的代码。
*   `README.md`文件描述了如何使用该插件，包括加载插件、使用`print_night_mare_lpe`命令或`elevate`模块。
*   代码中存在对目标系统架构（x86或x64）的判断，并加载相应的DLL文件。
*   **潜在的投毒风险点：**
    *   提供的PoC代码依赖于外部DLL文件（`LPE_Reflect_Elevate.x64.dll`, `CVE-2021-1675.x64.dll`, `CVE-2021-1675.x86.dll`）。如果这些DLL文件被恶意修改，则可能包含恶意代码，导致被攻击者执行非预期的操作。用户需要自行确保这些DLL文件的来源可信，且没有被篡改。虽然这个是PoC正常需要使用的组件，但是风险依然存在.
    *    PoC通过上传DLL执行恶意代码本身就是恶意行为，无法区分作者的恶意投毒行为。

综上所述，**投毒风险评估为10%**。风险主要在于外部DLL文件可能被篡改，以及使用PoC本身就是一种攻击行为。

**利用方式分析：**

1.  **环境准备：** 攻击者需要拥有一个 Cobalt Strike 环境，并获取目标系统的Beacon。
2.  **上传Payload DLL：** 攻击者使用PoC代码将包含恶意代码的DLL文件上传到目标系统的临时目录（例如：`c:\Windows\Temp\`）。
3.  **触发漏洞：** 攻击者通过`bdllspawn`函数触发Print Spooler漏洞，加载并执行上传的DLL文件。
4.  **权限提升：** 利用Print Spooler服务以SYSTEM权限执行DLL中的恶意代码，从而实现本地提权。

**搜索引擎结果补充：**

*   搜索引擎结果表明，该漏洞在野外被广泛利用，且存在针对Active Directory域控制器的利用代码。
*   修复建议包括安装Microsoft发布的补丁，以及禁用Print Spooler服务（如果不需要）。


**项目地址:** [mstxq17/CVE-2021-1675_RDL_LPE](https://github.com/mstxq17/CVE-2021-1675_RDL_LPE)

**漏洞详情:** [CVE-2021-1675](https://nvd.nist.gov/vuln/detail/CVE-2021-1675)