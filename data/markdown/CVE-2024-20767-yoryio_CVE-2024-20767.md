## CVE-2024-20767-Adobe ColdFusion Improper Access Control

**漏洞编号:** CVE-2024-20767

**漏洞类型:** Improper Access Control/Arbitrary File Read

**影响应用:** Adobe ColdFusion

**危害等级:** 高危，可能导致敏感信息泄露

**影响版本:** <= 2023.6, <= 2021.12

**利用条件:** Admin panel需要暴露在互联网上；需要目标存在易受攻击的ColdFusion版本

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-20767是一个Adobe ColdFusion中的不当访问控制漏洞，允许未经身份验证的攻击者读取服务器上的任意文件。攻击者首先需要通过`/CFIDE/adminapi/_servermanager/servermanager.cfc?method=getHeartBeat`获取UUID，然后利用`/pms`端点和构造的`file_name`参数（包含目录遍历），读取目标文件。 

**有效性评估:**
根据提供的漏洞信息和漏洞利用代码，该漏洞利用的POC代码是有效的。漏洞库信息和搜索引擎结果都表明该漏洞的存在，并且已被积极利用(CISA KEV)。

**投毒风险评估:**
查看提供的python脚本，脚本逻辑清晰，主要分为两个步骤：
1.  获取UUID：脚本首先尝试连接到ColdFusion服务器，通过访问`/CFIDE/adminapi/_servermanager/servermanager.cfc?method=getHeartBeat`这个端点，并使用正则表达式从响应中提取UUID。这部分代码的目的是为了获取后续利用所需的UUID。
2.  利用漏洞读取文件：脚本构造一个包含目录遍历的URL，并使用先前获取的UUID作为header发送请求到`/pms`端点，尝试读取指定的文件。脚本会检查响应状态码和内容长度，以判断文件是否成功读取，并将文件内容打印到控制台。

虽然代码本身实现了漏洞利用的功能，但是仍然存在潜在的风险。

*   **依赖风险:**该脚本依赖于`requests`和`urllib3`库。如果用户从不可信的源安装这些库，可能会引入恶意代码。
*   **文件读取的潜在风险:**该脚本允许读取任意文件，攻击者可以利用这一点来读取包含敏感信息的配置文件、日志文件等。这些信息可能会被用于进一步的攻击。脚本也具有一定的风险性，攻击者可能利用该脚本读取服务器上的敏感文件，例如配置文件，密钥等，从而进一步入侵系统。尽管POC本身是文件读取，但文件读取的内容本身可能含有后门或者配置不当的地方。

因此，我给出的投毒风险为10%。

**利用方式:**
1.  **获取UUID:**  通过访问`/CFIDE/adminapi/_servermanager/servermanager.cfc?method=getHeartBeat`端点，利用正则表达式提取UUID。
2.  **构造恶意请求:**  构造包含目录遍历的URL，例如`/pms?module=logging&file_name=../../../../../../../[目标文件路径]&number_of_lines=100`，并将UUID作为header发送到目标服务器。
3.  **读取文件:**  如果服务器返回状态码200且响应内容长度大于2，则表示文件读取成功，将文件内容输出。

**项目地址:** [yoryio/CVE-2024-20767](https://github.com/yoryio/CVE-2024-20767)

**漏洞详情:** [CVE-2024-20767](https://nvd.nist.gov/vuln/detail/CVE-2024-20767)