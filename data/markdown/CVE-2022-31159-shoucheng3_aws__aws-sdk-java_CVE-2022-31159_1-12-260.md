## CVE-2022-31159 - AWS SDK for Java S3 TransferManager 路径遍历

**漏洞编号:** CVE-2022-31159

**漏洞类型:** 路径遍历

**影响应用:** aws-sdk-java

**危害等级:** 高危，可能导致敏感文件泄露和未经授权的访问

**影响版本:** <= 1.12.260

**利用条件:** 需要应用程序使用受影响的AWS SDK for Java版本，并且使用TransferManager的downloadDirectory方法下载S3存储桶中的文件，攻击者需要能够控制S3对象键

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2022-31159是AWS SDK for Java中S3 TransferManager组件的一个路径遍历漏洞。攻击者可以利用此漏洞，通过在S3对象键中包含`..`来绕过路径验证，将文件写入到目标目录之外的位置。 

**有效性：**
根据漏洞描述，如果应用程序使用了受影响的AWS SDK for Java版本(<= 1.12.260)并且使用了`TransferManager.downloadDirectory`方法，此漏洞就可能被利用。搜索结果中多个链接确认了该漏洞的存在及其影响。

**利用方式：**
1.  攻击者上传包含恶意路径的文件到S3 bucket，例如 `foo/../../bar/baz.txt`，其中 `foo` 为目标下载目录的前缀。
2.  应用程序使用`TransferManager.downloadDirectory`方法从S3 bucket下载文件到指定的`destinationDirectory`，例如 `/tmp/foo`。
3.  由于漏洞存在，包含`..`的路径没有被正确处理，文件`baz.txt`会被写入到 `/tmp/bar/baz.txt`，而不是预期的`/tmp/foo/baz.txt`。

**投毒风险：**
提供的漏洞利用代码看起来是aws-sdk-java的更新日志,属于SDK的正常版本迭代，是开发人员为了让使用者更清晰的了解每次的更新内容。 从代码本身来看，**没有发现任何恶意代码或后门**。 但不能完全排除代码仓库其他文件存在投毒的可能性，但根据现有信息判断，**投毒风险极低，约为1%**。

**总结：**
CVE-2022-31159是一个严重的安全漏洞，可能导致未经授权的文件访问和系统安全风险。建议受影响的用户尽快升级到AWS SDK for Java 1.12.261或更高版本，或者采用漏洞描述中提供的临时解决方案（使用KeyFilter过滤包含`..`的S3对象键）。


**项目地址:** [shoucheng3/aws__aws-sdk-java_CVE-2022-31159_1-12-260](https://github.com/shoucheng3/aws__aws-sdk-java_CVE-2022-31159_1-12-260)

**漏洞详情:** [CVE-2022-31159](https://nvd.nist.gov/vuln/detail/CVE-2022-31159)