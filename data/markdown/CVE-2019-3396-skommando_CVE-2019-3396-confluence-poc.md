## CVE-2019-3396-Confluence-Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** Server-Side Template Injection (SSTI)

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，可导致远程代码执行

**影响版本:** before 6.6.12, 6.7.0 before 6.12.3, 6.13.0 before 6.13.3, 6.14.0 before 6.14.2

**利用条件:** 需要Confluence服务器开启Widget Connector宏功能，并且攻击者能够访问该宏。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396是Atlassian Confluence服务器中的一个服务器端模板注入漏洞，存在于Widget Connector宏中。攻击者可以通过构造恶意的Velocity模板代码，利用此漏洞在Confluence服务器上执行任意代码。

**有效性:**
从漏洞库信息和搜索结果来看，此漏洞已被广泛证实存在，并且有公开的PoC（概念验证）代码。
提供的POC代码包含以下文件：
* `README.md`: 说明文件，描述漏洞和PoC的使用方法。
* `_template_test_info.txt`: 用于验证模板是否加载成功的简单文本文件。
* `rce.vm`: 包含Velocity模板代码，用于执行远程命令。
`rce.vm`中使用了Java反射来获取Runtime类，并执行指定的命令。这个PoC代码是有效的，可以用来验证漏洞是否存在。

**投毒风险:**
提供的PoC代码仅包含漏洞验证和利用的必要代码，没有发现任何隐藏的恶意代码或后门。因此，投毒风险为0%。

**利用方式:**
1.  攻击者需要找到一个Confluence页面，该页面使用了Widget Connector宏。
2.  攻击者在Widget Connector宏的配置中插入恶意的Velocity模板代码，例如`rce.vm`中的代码。
3.  当Confluence服务器渲染该页面时，会执行攻击者插入的Velocity模板代码，从而实现远程代码执行。
4.  攻击者可以利用此漏洞在服务器上执行任意命令，例如安装恶意软件、窃取敏感数据等。

**参考信息:**
*   NVD: [https://nvd.nist.gov/vuln/detail/cve-2019-3396](https://nvd.nist.gov/vuln/detail/cve-2019-3396)
*   Rapid7: [https://www.rapid7.com/blog/post/2019/04/12/confluence-unauthorized-rce-vulnerability-cve-2019-3396-what-you-need-to-know/](https://www.rapid7.com/blog/post/2019/04/12/confluence-unauthorized-rce-vulnerability-cve-2019-3396-what-you-need-to-know/)
*   Exploit-DB: [https://www.exploit-db.com/exploits/46731/](https://www.exploit-db.com/exploits/46731/)
*   CISA KEV: [https://www.cisa.gov/known-exploited-vulnerabilities-catalog?field_cve=CVE-2019-3396](https://www.cisa.gov/known-exploited-vulnerabilities-catalog?field_cve=CVE-2019-3396)

**项目地址:** [skommando/CVE-2019-3396-confluence-poc](https://github.com/skommando/CVE-2019-3396-confluence-poc)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)