## CVE-2021-21974 - VMware ESXi OpenSLP 堆溢出

**漏洞编号:** CVE-2021-21974

**漏洞类型:** 堆溢出

**影响应用:** VMware ESXi

**危害等级:** 高危，可导致远程代码执行

**影响版本:** ESXi 7.0 before ESXi70U1c-17325551, 6.7 before ESXi670-202102401-SG, 6.5 before ESXi650-202102101-SG, VMware Cloud Foundation 4.x before 4.2 and 3.x

**利用条件:** 与 ESXi 位于同一网络段，且能够访问 427 端口

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-21974 存在于 VMware ESXi 的 OpenSLP 服务中，是一个堆溢出漏洞。攻击者如果与目标 ESXi 服务器位于同一网络分段，并且能够访问其 427 端口，就可以利用此漏洞在 OpenSLP 服务中触发堆溢出，最终实现远程代码执行。

**有效性：**
根据搜索结果可知，该漏洞已被广泛利用，甚至被用于 ESXiArgs 勒索软件攻击。提供的 Nmap 脚本 `vmware-svrloc-vulns.nse` 用于检测目标 ESXi 服务器是否存在该漏洞，通过版本和构建号判断是否已修补，证明POC的有效性。

**投毒风险：**
提供的 Nmap 脚本主要功能是版本检测和漏洞验证。脚本通过发送 SLP 请求，然后根据返回的版本号和构建号判断是否存在漏洞。代码本身没有发现任何恶意行为，例如执行系统命令、上传文件或建立后门连接等。所以投毒风险较低。因此，投毒风险评估为0%。

**利用方式：**
1.  攻击者需要与目标 ESXi 服务器位于同一网络分段。
2.  攻击者需要能够访问目标 ESXi 服务器的 427 端口（OpenSLP 服务端口）。
3.  攻击者构造恶意的 SLP 请求，利用 OpenSLP 服务的堆溢出漏洞。
4.  通过精心设计的溢出数据，攻击者可以在目标系统上执行任意代码，从而完全控制 ESXi 服务器。

**项目地址:** [hateme021202/cve-2021-21974](https://github.com/hateme021202/cve-2021-21974)

**漏洞详情:** [CVE-2021-21974](https://nvd.nist.gov/vuln/detail/CVE-2021-21974)