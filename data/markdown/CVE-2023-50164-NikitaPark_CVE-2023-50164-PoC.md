## CVE-2023-50164-Apache Struts-文件上传路径遍历RCE

**漏洞编号:** CVE-2023-50164

**漏洞类型:** 文件上传路径遍历RCE

**影响应用:** Apache Struts

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 2.0.0 <= version <= 2.5.32 或 6.0.0 <= version <= 6.3.0.1

**利用条件:** 需要目标系统存在Apache Struts框架且存在文件上传功能。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-50164是Apache Struts框架中的一个文件上传路径遍历漏洞。攻击者可以操纵文件上传参数，实现路径遍历，从而上传恶意文件（如webshell），最终导致远程代码执行。

**有效性分析：**
根据漏洞库信息、搜索结果和提供的PoC代码，可以判断该漏洞利用是有效的。

*   漏洞库信息表明该漏洞允许攻击者操纵文件上传参数进行路径遍历，并最终实现RCE。
*   搜索引擎结果显示该漏洞已被广泛讨论，并且存在公开的PoC。
*   提供的PoC代码（exploit.py）展示了如何通过修改文件上传参数，将恶意文件上传到指定位置。

**投毒风险分析：**
PoC代码`/tmp/f2d27f0fde14a46b9c906fdccc67469a/exploit.py`主要功能是构造恶意请求，利用路径遍历漏洞上传文件。`/tmp/f2d27f0fde14a46b9c906fdccc67469a/Dockerfile`用于构建一个包含漏洞的Struts环境。`/tmp/f2d27f0fde14a46b9c906fdccc67469a/README.md`是使用说明，没有可疑代码。

`docker-compose.yml`文件内容不完整，理论上可能存在一定风险，但考虑到PoC的主要逻辑集中在`exploit.py`中，且该脚本主要执行文件上传操作，因此投毒风险较低，估计约为10%。可能的投毒方式包括修改上传文件的内容，或者在构建的Docker镜像中添加后门。

**利用方式：**

1.  **构建包含漏洞的Struts环境：** 使用提供的Dockerfile构建一个包含漏洞的Apache Struts应用程序环境（可选，如果目标环境已存在，则可跳过此步骤）。
2.  **构造恶意请求：** 通过修改HTTP请求中的文件上传参数，利用路径遍历漏洞指定文件上传的路径。
3.  **上传恶意文件：** 将包含恶意代码的文件（如webshell.jsp）上传到目标服务器的可执行目录下，例如webapps/ROOT。
4.  **执行恶意代码：** 通过访问上传的恶意文件，执行其中的恶意代码，从而实现远程代码执行。

总体来说,该漏洞利用比较直接，主要是通过构造畸形的文件上传请求实现路径遍历和任意文件上传。 虽然存在投毒风险，但主要集中在Dockerfile和docker-compose.yml， exploit.py 的投毒风险较低。

**项目地址:** [NikitaPark/CVE-2023-50164-PoC](https://github.com/NikitaPark/CVE-2023-50164-PoC)

**漏洞详情:** [CVE-2023-50164](https://nvd.nist.gov/vuln/detail/CVE-2023-50164)