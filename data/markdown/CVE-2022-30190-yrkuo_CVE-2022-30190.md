## CVE-2022-30190 Microsoft Windows Support Diagnostic Tool (MSDT) 远程代码执行漏洞

**漏洞编号:** CVE-2022-30190

**漏洞类型:** 远程代码执行

**影响应用:** Microsoft Windows Support Diagnostic Tool (MSDT)

**危害等级:** 高危，允许攻击者以调用应用程序的权限执行任意代码，可能导致系统完全控制

**影响版本:** 受影响的Windows版本众多，详见漏洞库信息

**利用条件:** 需要用户打开恶意构造的文档（例如Word文档）

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-30190，又名Follina，是一个存在于Microsoft Support Diagnostic Tool (MSDT)中的远程代码执行漏洞。攻击者可以通过构造恶意的Word文档，利用Word的远程模板功能从远程服务器检索HTML文件。该HTML文件包含恶意JavaScript代码，通过ms-msdt协议调用MSDT，从而执行任意命令。

**有效性：**
提供的POC代码是有效的，它展示了如何构造一个包含恶意OLE对象的Word文档，该对象指向一个包含恶意HTML payload的远程服务器。John Hammond的follina.py脚本可以用来生成payload，该payload利用ms-msdt协议执行calc.exe作为概念验证。

**投毒风险：**
仓库本身投毒的概率较低，约为10%。风险主要来自于以下几个方面：
*   **远程Payload：** HTML payload从攻击者控制的服务器提供，因此存在被篡改或替换的风险。攻击者可以更改payload，以执行恶意活动。
*   **follina.py脚本：** follina.py脚本本身可能包含隐藏的恶意代码，虽然John Hammond的脚本相对可信，但仍存在一定的风险。
*   **依赖性：** 该利用方法依赖于特定的软件版本和配置，未来可能会因补丁或更新而失效。

**利用方式：**
1.  攻击者创建一个恶意的Word文档（.docx）。
2.  该文档包含一个指向攻击者控制的远程服务器的OLE对象。
3.  当用户打开该文档时，Word会尝试从远程服务器检索HTML文件。
4.  该HTML文件包含恶意JavaScript代码，使用ms-msdt协议调用MSDT。
5.  MSDT执行攻击者指定的命令，从而导致远程代码执行。

**缓解措施：**
*   安装Microsoft提供的安全更新。
*   禁用MSDT协议（虽然可能影响系统功能）。
*   谨慎打开来自未知来源的文档。

**项目地址:** [yrkuo/CVE-2022-30190](https://github.com/yrkuo/CVE-2022-30190)

**漏洞详情:** [CVE-2022-30190](https://nvd.nist.gov/vuln/detail/CVE-2022-30190)