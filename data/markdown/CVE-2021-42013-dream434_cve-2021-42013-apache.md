## CVE-2021-42013 - Apache HTTP Server Path Traversal 和 RCE

**漏洞编号:** CVE-2021-42013

**漏洞类型:** 路径遍历和远程代码执行

**影响应用:** Apache HTTP Server

**危害等级:** 高危，可能导致信息泄露和远程代码执行

**影响版本:** 2.4.49 和 2.4.50

**利用条件:** 目标服务器运行受影响的 Apache HTTP Server 版本，并且开启了 CGI 脚本执行。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

**有效性评估：**

根据漏洞库信息、搜索引擎结果和提供的漏洞利用代码，可以判断此漏洞利用是有效的。
*   **漏洞描述：** CVE-2021-42013 是 Apache HTTP Server 2.4.49 和 2.4.50 中的一个路径遍历漏洞，是 CVE-2021-41773 的不完整修复。
*   **利用方式：** 攻击者可以通过构造包含`/.%%32%65`的恶意URL，绕过 Alias 指令的限制，访问到服务器上的任意文件。如果目标服务器配置允许 CGI 脚本执行，攻击者可以利用此漏洞执行任意代码。
*   **搜索引擎结果：** 大量文章和漏洞库条目确认了该漏洞的存在和严重性，并提供了利用此漏洞的PoC或思路。
*   **PoC代码分析：**提供的 `exploit.py` 脚本尝试通过构造包含路径遍历字符串的URL来执行命令。脚本使用 POST 请求向目标服务器的 CGI 目录发送请求，并在请求体中包含要执行的命令。该脚本的核心在于利用`/.%%32%65`绕过路径检查，配合 CGI 脚本执行命令。代码逻辑比较清晰，且与漏洞描述相符，故有效性较高。

**投毒风险评估：**

*   **代码分析：**
    *   `requirements.txt` 只包含 `colorama` 库，这是一个用于在终端显示彩色的库，本身没有安全风险。
    *   `exploit.py` 脚本的主要功能是利用 CVE-2021-42013 漏洞进行攻击。代码中没有发现明显的恶意代码，例如反弹shell、下载执行恶意文件等。但是，脚本本身可以被用于恶意目的，即远程代码执行。
    *   `README.md` 文件是项目说明文档，没有可疑内容。
*   **投毒可能性：**
    *   该脚本的主要目的是利用已知的漏洞，而不是植入后门或进行其他恶意活动。因此，直接在脚本中添加恶意代码的可能性较低。
    *   由于脚本需要用户提供目标 URL 和要执行的命令，攻击者可以通过控制命令内容来达到恶意目的。但这不属于代码投毒的范畴。
*   **风险评估：**
脚本本身存在被恶意利用的风险，如果代码仓库的维护者在后续版本中添加恶意代码，则可能存在投毒风险。代码投毒的可能性较低，只有 `5%`

**利用方式：**

1.  **目标确认：** 确定目标 Apache HTTP Server 运行的版本为 2.4.49 或 2.4.50。
2.  **CGI 目录定位：** 找到目标服务器上配置的 CGI 目录，例如 `/cgi-bin/`。
3.  **构造恶意URL：** 构造包含路径遍历字符串的 URL，例如 `http://example.com/cgi-bin/.%%32%65/.%%32%65/.%%32%65/.%%32%65/bin/sh`。
4.  **发送请求：** 使用 POST 请求向构造的 URL 发送请求，并在请求体中包含要执行的命令。
5.  **获取结果：** 解析响应结果，获取命令执行的结果。

例如，使用提供的 `exploit.py` 脚本执行 `id` 命令：

```bash
python3 exploit.py http://example.com id
```

**注意事项：**

*   利用此漏洞需要在目标服务器上启用 CGI 脚本执行，并且相关目录没有进行严格的权限控制。
*   使用此漏洞进行攻击可能导致严重的后果，请务必在获得授权的情况下进行测试。

**项目地址:** [dream434/cve-2021-42013-apache](https://github.com/dream434/cve-2021-42013-apache)

**漏洞详情:** [CVE-2021-42013](https://nvd.nist.gov/vuln/detail/CVE-2021-42013)