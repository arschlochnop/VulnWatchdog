## CVE-2021-26855 Microsoft Exchange Server ProxyLogon RCE

**漏洞编号:** CVE-2021-26855

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Microsoft Exchange Server

**危害等级:** 高危，允许未经身份验证的远程攻击者执行任意代码

**影响版本:** 受影响版本包括 Exchange Server 2013、2016 和 2019 的多个累积更新版本

**利用条件:** 目标Exchange服务器未安装相关安全更新，且攻击者能够访问Exchange服务器的443端口。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-26855 是一个存在于 Microsoft Exchange Server 中的服务器端请求伪造 (SSRF) 漏洞，属于 ProxyLogon 漏洞链的一部分。攻击者可以利用此漏洞绕过身份验证，并发送任意 HTTP 请求，最终通过与其他漏洞（如 CVE-2021-27065）结合，实现远程代码执行。

**利用方式：**

1.  **SSRF (CVE-2021-26855)：** 利用 Autodiscover 协议的缺陷，发送特制的 HTTP 请求到 Exchange 服务器。由于服务器信任来自自身的请求，攻击者可以伪造请求，绕过身份验证。
2.  **获取 LegacyDN：** 通过 SSRF 漏洞，攻击者可以获取目标用户的 LegacyDN。 LegacyDN 是 Exchange 服务器中用户的唯一标识符。
3.  **伪造 MAPI 请求：**  使用获取的 LegacyDN，攻击者可以构造恶意的 MAPI (Messaging Application Programming Interface) 请求，并将其发送到 Exchange 服务器。
4.  **写入 Web Shell (CVE-2021-27065):** 攻击者利用后端组件的漏洞将webshell写入服务器，从而实现远程代码执行。
5.  **远程代码执行：** 成功写入webshell后，即可通过webshell执行任意代码，控制Exchange服务器。

**漏洞利用有效性：**

根据漏洞库信息和搜索结果，CVE-2021-26855 是一个经过广泛利用的漏洞，且存在公开的 PoC 代码。提供的 PoC 代码尝试模拟 ProxyLogon 漏洞链的利用过程，包括 SSRF、获取 LegacyDN、伪造 MAPI 请求和写入 Web Shell。根据PoC代码和搜索结果的描述，此POC代码可以实现远程代码执行，有效性较高，但是需要和其它漏洞配合利用，才能达成RCE。

**投毒风险分析：**

PoC 代码本身主要功能是进行漏洞验证和利用，直接植入恶意代码的概率较低。 但仍然存在一定的风险，例如：

*   **恶意代码混淆：** 攻击者可能将恶意代码隐藏在看似无害的字符串或函数中。
*   **依赖项投毒：** PoC 代码可能依赖于外部库或模块，如果这些依赖项被篡改，则可能引入恶意代码。

基于提供的代码，经过分析，判断投毒风险较低，但是仍然不能排除。该代码尝试利用漏洞，但是执行命令的部分是通过写入webshell实现的，增加webshell写入位置的随机性有可能被用于逃避检测，因此有一定的概率(10%)被用于投毒。

**项目地址:** [r0xdeadbeef/CVE-2021-26855](https://github.com/r0xdeadbeef/CVE-2021-26855)

**漏洞详情:** [CVE-2021-26855](https://nvd.nist.gov/vuln/detail/CVE-2021-26855)