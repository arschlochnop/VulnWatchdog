## CVE-2025-24016-Wazuh-RCE

**漏洞编号:** CVE-2025-24016

**漏洞类型:** 反序列化漏洞导致远程代码执行

**影响应用:** Wazuh

**危害等级:** 高危，可导致远程代码执行，完全控制系统

**影响版本:** >= 4.4.0, < 4.9.1

**利用条件:** 需要API访问权限 (可能通过被攻陷的dashboard, 集群中的Wazuh服务器, 或者特定配置下被攻陷的agent)

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2025-24016是Wazuh服务器中的一个反序列化漏洞，允许远程攻击者执行任意代码。漏洞位于`DistributedAPI`组件中，该组件使用JSON序列化和`as_wazuh_object`反序列化DAPI请求参数。如果攻击者能够注入恶意构造的字典到DAPI请求中，他们可以构造一个未处理的异常(`__unhandled_exc__`)来执行任意Python代码。此漏洞CVSS评分为9.9，影响Wazuh 4.4.0到4.9.0版本。

**有效性:** 提供的PoC代码有效。它利用了`run_as`端点，允许攻击者通过控制`auth_context`参数来注入恶意payload。Payload中包含`__unhandled_exc__`，导致服务器执行任意Python代码。

**投毒风险:** PoC代码本身旨在演示漏洞，但存在一定的投毒风险。攻击者可能修改PoC代码，例如替换`exit()`为更具破坏性的命令，比如删除文件或执行恶意脚本。但从目前分析结果看，该仓库结构简单，代码量少，没有发现明显的恶意代码隐藏。因此，PoC存储库本身直接包含恶意代码的可能性较低，投毒风险约为10%，主要风险在于使用者是否会对POC进行修改。

**利用方式:**
1.  攻击者需要获得Wazuh API的访问权限。这可以通过以下方式实现：
    *   攻陷Wazuh dashboard。
    *   控制Wazuh集群中的一个服务器。
    *   在某些配置中，攻陷一个Wazuh agent。
2.  攻击者构造一个包含恶意payload的HTTP POST请求，发送到`/security/user/authenticate/run_as`端点。Payload中包含`__unhandled_exc__`，`__class__`设置为需要执行的函数(例如`exit`或`os.system`)，`__args__`设置为函数的参数。
3.  Wazuh服务器反序列化payload，并执行其中包含的Python代码，从而导致RCE。

**项目地址:** [MuhammadWaseem29/CVE-2025-24016](https://github.com/MuhammadWaseem29/CVE-2025-24016)

**漏洞详情:** [CVE-2025-24016](https://nvd.nist.gov/vuln/detail/CVE-2025-24016)