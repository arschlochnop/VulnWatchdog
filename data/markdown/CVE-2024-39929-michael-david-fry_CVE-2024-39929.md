## CVE-2024-39929 - Exim 邮件服务器文件扩展名绕过

**漏洞编号:** CVE-2024-39929

**漏洞类型:** 文件扩展名绕过

**影响应用:** Exim

**危害等级:** 中危，可能允许恶意附件传递

**影响版本:** <= 4.97.1

**利用条件:** 需要目标 Exim 服务器运行在受影响的版本，且接受外部邮件。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-39929 漏洞存在于 Exim 邮件服务器中，由于其对多行 RFC 2231 头部文件名解析不正确，攻击者可以通过构造特殊的邮件头，绕过 $mime_filename 扩展名阻止机制，从而发送具有恶意扩展名的附件到最终用户的邮箱。 

**有效性:**
根据提供的漏洞库信息、搜索引擎结果和漏洞利用代码，该POC代码是有效的。搜索引擎结果中已经存在针对该漏洞的利用代码的github仓库链接。

**投毒风险:**
查看提供的POC代码，发现代码的功能较为简单，主要用于发送带有特定构造的附件的邮件。主要操作包括：

1.  构造包含恶意附件的邮件，其中附件的文件名通过`filename*0`, `filename*1`, `filename*2` 等参数进行分段定义，以绕过扩展名检查。
2.  连接到指定的SMTP服务器，并发送邮件。

代码本身没有发现明显的恶意行为，如执行系统命令、修改文件、或向外部服务器发送数据等。但仍存在微小的投毒风险，例如：

*   **依赖风险:** 代码依赖于 `smtplib` 和 `email` 模块，虽然是Python的标准库，但如果用户从其他来源安装了这些库的恶意版本，则可能存在风险。
*   **服务器文件替换：**如果攻击者能够控制服务器上的文件，例如通过其他漏洞或配置错误，他们可能会替换 `servers.txt` 文件，使其包含恶意的 SMTP 服务器列表。这可能导致受害者将漏洞利用邮件发送到攻击者控制的服务器，从而使攻击者能够捕获敏感信息或执行其他恶意活动。

综合考虑，投毒风险较低，估计在10%左右。主要是因为代码功能相对简单，且依赖的库是标准库，被篡改的可能性较低。

**利用方式:**
1.  攻击者需要找到运行着存在漏洞的 Exim 邮件服务器，可以通过扫描网络或查找公开的信息来发现目标。
2.  准备一个包含恶意代码的附件，例如一个`.exe`文件。
3.  编写或使用现有的POC脚本，例如提供的Python脚本，构造包含恶意附件的邮件。邮件头中的文件名需要按照RFC 2231的格式进行分段编码，以绕过Exim服务器的扩展名检查。
4.  配置POC脚本，指定发件人、收件人以及目标 Exim 服务器的地址。
5.  运行POC脚本，发送包含恶意附件的邮件。
6.  如果攻击成功，收件人可能会打开恶意附件，从而导致恶意代码在收件人的计算机上执行。

**项目地址:** [michael-david-fry/CVE-2024-39929](https://github.com/michael-david-fry/CVE-2024-39929)

**漏洞详情:** [CVE-2024-39929](https://nvd.nist.gov/vuln/detail/CVE-2024-39929)