## CVE-2021-3493-Ubuntu OverlayFS 本地提权

**漏洞编号:** CVE-2021-3493

**漏洞类型:** 权限提升

**影响应用:** Linux Kernel (OverlayFS)

**危害等级:** 高危，攻击者可以利用此漏洞从普通用户提升到root权限

**影响版本:** Ubuntu kernels < 5.8.0-50.56, < 5.4.0-72.80, < 4.15.0-142.146, < 4.4.0-209.241

**利用条件:** 需要目标系统运行存在漏洞的Ubuntu内核版本，并启用非特权用户命名空间以及允许非特权用户挂载overlayfs文件系统

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2021-3493 漏洞存在于 Linux Kernel 的 OverlayFS 实现中。在Ubuntu内核中，由于允许非特权用户挂载 overlayfs ，攻击者可以利用不正确的权限验证机制，结合非特权用户命名空间，在底层文件系统上设置文件 capabilities，从而获得提升的权限。提供的POC代码创建必要的目录结构，并尝试挂载overlayfs文件系统，然后创建恶意文件，并设置suid权限，达到权限提升的目的。

**有效性评估：**
根据漏洞库信息和POC代码，此漏洞利用在特定Ubuntu内核版本上是有效的，因为这些版本同时启用了非特权用户命名空间和非特权overlayfs挂载。

**投毒风险评估：**
POC代码主要是创建目录，挂载文件系统，以及设置一些文件权限，总体来说代码量不大，逻辑比较清晰，没有明显的投毒行为。可能存在的风险在于编译后的二进制文件可能会被用于其他恶意目的，但这不是代码本身的投毒。风险评估为5%主要是考虑到任何代码都可能被滥用，而非代码本身存在恶意逻辑。

**利用方式：**
1.  **环境准备:** 创建 lower, upper, work, overlay 目录。
2.  **文件系统挂载:** 使用 OverlayFS 将 lower 和 upper 目录挂载到 overlay 目录。
3.  **权限设置:** 在 overlay 目录中创建恶意文件并设置 suid 权限，因为overlayfs 没有正确校验文件capabilities ，因此可以将权限赋予文件。
4.  **权限提升:** 执行恶意文件，由于 suid 权限，可以提升到文件拥有者的权限（通常是root）。

**项目地址:** [spideyctf/UbuntuTouchSecurityVAPTReport](https://github.com/spideyctf/UbuntuTouchSecurityVAPTReport)

**漏洞详情:** [CVE-2021-3493](https://nvd.nist.gov/vuln/detail/CVE-2021-3493)