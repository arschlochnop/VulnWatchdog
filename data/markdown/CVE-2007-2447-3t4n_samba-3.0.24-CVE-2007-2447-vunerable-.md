## CVE-2007-2447-Samba-远程命令执行

**漏洞编号:** CVE-2007-2447

**漏洞类型:** 远程命令执行

**影响应用:** Samba

**危害等级:** 高危，可能导致远程代码执行和系统控制

**影响版本:** 3.0.0 through 3.0.25rc3

**利用条件:** 需要目标系统开启Samba服务，并且启用了 "username map script" smb.conf 选项（针对SamrChangePassword函数利用）或者可以利用远程打印和文件共享管理。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2007-2447 漏洞存在于 Samba 3.0.0 到 3.0.25rc3 版本的 smbd 服务中。攻击者可以通过 MS-RPC 功能中的 shell 元字符注入来执行任意命令。存在三种主要的利用方式：

1.  **SamrChangePassword 函数利用：** 当 smb.conf 文件中启用了 "username map script" 选项时，未经身份验证的攻击者可以通过向 SamrChangePassword 函数发送包含恶意 shell 元字符的请求来执行命令。
2.  **远程打印管理利用：** 远程身份验证用户可以通过操作远程打印管理相关的 MS-RPC 函数，注入 shell 元字符执行命令。
3.  **文件共享管理利用：** 远程身份验证用户可以通过操作文件共享管理相关的 MS-RPC 函数，注入 shell 元字符执行命令。

提供的漏洞利用代码仅包含 GNU GPL 许可证，并没有实际的漏洞利用代码。因此，代码本身不包含投毒代码。 但是，在实际利用此漏洞时，攻击者可以注入任意命令，从而植入后门或执行恶意操作。 因此，该漏洞在使用上存在一定的投毒风险,取决于攻击者使用的payload。根据经验和代码内容判断，投毒风险比例估计为10%（主要指利用漏洞部署后门的可能性）。

利用方式总结：攻击者通过构造包含 shell 元字符的恶意请求，利用 Samba 的 MS-RPC 功能中的漏洞，使 smbd 服务执行攻击者指定的任意命令。

**项目地址:** [3t4n/samba-3.0.24-CVE-2007-2447-vunerable-](https://github.com/3t4n/samba-3.0.24-CVE-2007-2447-vunerable-)

**漏洞详情:** [CVE-2007-2447](https://nvd.nist.gov/vuln/detail/CVE-2007-2447)