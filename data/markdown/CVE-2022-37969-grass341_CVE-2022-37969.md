## CVE-2022-37969 Windows CLFS 驱动提权漏洞

**漏洞编号:** CVE-2022-37969

**漏洞类型:** 权限提升

**影响应用:** Windows Common Log File System Driver

**危害等级:** 高危，本地权限提升至SYSTEM

**影响版本:** 受影响的Windows版本在漏洞库信息中已列出

**利用条件:** 需要本地访问权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

根据漏洞库信息和搜索结果，CVE-2022-37969是Windows Common Log File System (CLFS) 驱动中的一个权限提升漏洞。该漏洞是由于CLFS驱动程序在处理日志文件时，未正确进行边界检查，导致可以进行内存越界写入, 从而实现本地权限提升。Zscaler博客和CoreSecurity的文章都提供了漏洞分析和PoC构建的信息。提供的POC代码片段 `CreateLogFile.cpp`, `CreateLogFile.h`, `Prepare_BigPool.cpp` 主要功能是创建特定的日志文件，以及探测和操作内核空间的BigPool。`Prepare_BigPool.cpp`的代码尝试通过 `NtQuerySystemInformation` 获取 `SystemBigPoolInformation`，然后查找包含 `CLFS_TAG` 的内存块的地址。`findNewClfsAddress` 函数用于查找新创建的CLFS日志文件在内核空间中的地址。`GetOffsetBetweenPools` 函数重复创建和查找CLFS文件，这可能是为了在内存中构造特定的布局，以便后续的利用。由于POC代码的功能复杂，且需要精确的内存地址操作，存在一定程度的投毒风险，比如，通过修改内存地址偏移量来造成拒绝服务，或者植入其他恶意代码。该漏洞利用方式通常涉及：1. 创建恶意的CLFS日志文件，触发驱动程序的漏洞。2. 覆盖内核内存中的关键数据结构。3. 将当前进程的权限提升到SYSTEM。该POC代码的目的是为了完成第一步和部分第二步的操作, 为后续的提权做准备. 投毒风险评估为10%，因为代码逻辑相对清晰，主要集中在地址查找和日志文件创建上，但仍然存在利用内存操作进行破坏的可能性。

**项目地址:** [grass341/CVE-2022-37969](https://github.com/grass341/CVE-2022-37969)

**漏洞详情:** [CVE-2022-37969](https://nvd.nist.gov/vuln/detail/CVE-2022-37969)