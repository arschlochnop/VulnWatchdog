## CVE-2023-22515-Confluence-Broken Access Control

**漏洞编号:** CVE-2023-22515

**漏洞类型:** Broken Access Control/RCE

**影响应用:** Atlassian Confluence Data Center and Server

**危害等级:** 高危，可导致未授权访问和远程代码执行

**影响版本:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**利用条件:** Confluence 实例可以公开访问

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-22515 是 Atlassian Confluence Data Center 和 Server 中的一个严重漏洞，允许未经身份验证的远程攻击者创建未经授权的 Confluence 管理员帐户，最终实现远程代码执行。该漏洞是由于不正确的访问控制导致的。

**有效性：**
根据漏洞库信息、搜索结果（尤其是 github 链接）以及提供的漏洞利用代码，可以判断该漏洞的 POC 代码是有效的。许多安全厂商和研究人员都发布了关于该漏洞的报告和利用方法，并且 CISA 将其列入已知被利用的漏洞目录中，确认该漏洞在野外已被利用。

**投毒风险：**
提供的 POC 代码包含一个 Maven 项目，用于构建一个恶意的 Confluence 插件（JAR 文件）。该插件包含三个 Servlet：`cmServlet`（CMDshell）、`gzServlet` (哥斯拉 webshell) 和 `bxServlet`。这些 Servlet 允许攻击者在 Confluence 服务器上执行任意命令。投毒风险较低，因为：
*   代码相对简单，易于审查。
*   明显的功能是创建 webshell，这本身就是恶意行为。
*   没有发现隐藏的、不相关的或者难以理解的代码。
但是，仍然存在一定的投毒风险，因为攻击者可能会在 `CommandExecutor.java` 或其他地方添加难以察觉的后门代码。因此，将投毒风险评估为 10%。

**利用方式：**
1.  攻击者首先利用 CVE-2023-22515 漏洞创建一个 Confluence 管理员帐户，无需任何身份验证。
2.  使用创建的管理员帐户登录 Confluence 管理控制台。
3.  上传并安装恶意插件（JAR 文件），这个恶意插件包含了 webshell。
4.  通过访问恶意插件提供的 webshell，攻击者可以在 Confluence 服务器上执行任意命令。

具体来说，`README.md` 文件中描述了两种 webshell 的连接方式：
*   **CMDshell:** 访问 `http://confluence.local/plugins/servlet/testbin/cmServlet` 可以直接执行命令。
*   **哥斯拉 webshell:** 访问 `http://confluence.local/plugins/servlet/testbin/gzServlet`，使用 `Referer: https://www.baidu.com/` 作为 header，密码为 `p@ssw0rd`，key 为 `key`，即可连接哥斯拉 webshell。

**项目地址:** [aaaademo/Confluence-EvilJar](https://github.com/aaaademo/Confluence-EvilJar)

**漏洞详情:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)