## CVE-2017-10003-Solaris-权限提升/DoS

**漏洞编号:** CVE-2017-10003

**漏洞类型:** 权限提升/DoS

**影响应用:** Solaris Operating System (Network Services Library)

**危害等级:** 中危，可导致敏感数据读取、修改以及部分拒绝服务

**影响版本:** 10

**利用条件:** 需要本地低权限用户登录

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

根据漏洞信息，CVE-2017-10003影响Solaris 10操作系统中的网络服务库。该漏洞利用的难点在于需要本地低权限用户登录，并且难以利用。成功利用后，攻击者可以进行未授权的数据更新、插入、删除，以及读取部分敏感数据，并造成部分拒绝服务。

分析提供的漏洞利用代码 (sudopwn.c):

*   **利用方式：** 该PoC利用了`/dev/shm`目录下的共享内存特性和一个竞争条件。它首先创建`/dev/shm/_tmp`目录，并在其中创建指向`/dev/pts/57`和`/usr/bin/sudo`的符号链接（`/dev/shm/_tmp/_tty`和`/dev/shm/_tmp/     34873 `，注意sudo的符号链接文件名包含空格）。然后，它使用inotify监控`/dev/shm/_tmp`目录的`IN_OPEN`和`IN_CLOSE_NOWRITE`事件。

    子进程（通过`fork()`创建）执行`sudo -r unconfined_r /usr/bin/sum $'--\nHELLO\nWORLD\n'`。  父进程通过inotify监听子进程打开和关闭`/dev/shm/_tmp`目录下的文件的事件。当子进程打开`/dev/shm/_tmp/_tty`时，父进程使用`openpty`打开一个新的pts设备，并将其路径存储在`pts_path`中，直到其值为`/dev/pts/57`。

    当子进程关闭`/dev/shm/_tmp/_tty`时，父进程删除`/dev/shm/_tmp/_tty`，并创建一个指向`/etc/PWN`的新符号链接。 竞争条件在于，如果`sudo`在父进程替换符号链接之前打开了`/dev/shm/_tmp/_tty`，那么它会使用真正的tty。如果父进程足够快，那么`sudo`会打开指向`/etc/PWN`的符号链接。

*   **有效性：** 代码尝试劫持`sudo`命令对`/dev/shm/_tmp/_tty`的访问，通过竞争条件将`/dev/shm/_tmp/_tty`指向`/etc/PWN`，`/etc/PWN`的内容会被当成`sudo`执行命令的输入，如果`/etc/PWN`内容恶意构造，是有可能提权的。这个PoC有一定概率成功，但依赖于竞争条件，所以成功率可能不高。

*   **投毒风险：** 该PoC代码存在投毒风险的可能性较低。PoC主要逻辑是利用竞争条件进行符号链接替换，本身不包含明显的后门代码。`/etc/PWN`文件内容需要进一步分析,如果没有相关的恶意代码，则投毒风险较低。但是，不能排除作者在其他地方隐藏了恶意代码的可能性。 例如将`/etc/PWN`的内容设置成恶意代码，但是PoC本身的功能是利用漏洞，所以判断投毒的可能性较低。考虑到可能存在的隐蔽风险，评估结果为5%。

**项目地址:** [letsr00t/CVE-2017-1000367](https://github.com/letsr00t/CVE-2017-1000367)

**漏洞详情:** [CVE-2017-10003](https://nvd.nist.gov/vuln/detail/CVE-2017-10003)