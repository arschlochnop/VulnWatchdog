## CVE-2022-30190-Follina-MSDT远程代码执行漏洞

**漏洞编号:** CVE-2022-30190

**漏洞类型:** 远程代码执行

**影响应用:** Microsoft Windows Support Diagnostic Tool (MSDT)

**危害等级:** 高危，可导致远程代码执行，控制受害者系统

**影响版本:** 受影响的Windows版本包括但不限于：Windows 7 SP1, Windows 8.1, Windows 10 (多个版本), Windows 11 21H2, Windows Server (多个版本)

**利用条件:** 用户需要打开恶意构造的Word文档或其他调用MSDT的应用程序

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-30190（又名Follina）是一个Microsoft Office中的远程代码执行漏洞。当MSDT通过URL协议被调用时，例如从Word等应用程序调用，就会存在此漏洞。攻击者可以利用Word的远程模板功能，从远程Web服务器检索HTML文件。该HTML文件包含恶意代码，可以绕过某些安全机制并执行任意命令。 

**漏洞利用方式：**

1.  **攻击者制作恶意Word文档：** 该文档包含指向远程服务器的链接，该服务器托管一个恶意的HTML文件。
2.  **用户打开恶意文档：** 当用户打开该文档时，Word会尝试从远程服务器加载HTML文件。
3.  **MSDT被调用并执行恶意代码：** HTML文件利用`ms-msdt:`协议触发MSDT执行，从而执行攻击者指定的命令。

**POC代码分析：**

提供的POC代码包含以下文件：

*   `README.md`: 描述了漏洞和攻击的简要信息。
*   `config.py`: 包含配置参数，例如要执行的命令 (`EXECUTED_COMMAND`)，输出文件名 (`OUTPUT_FILE`)，网络接口 (`NETWORK_INTERFACE`)，端口 (`PORT`)，以及是否使用反向shell (`REVERSE_PORT`)。
*   `manip_args.py`: 解析命令行参数，并准备利用所需的文件。此脚本负责创建临时目录，复制必要的文件，修改文档关系文件，并启动一个HTTP服务器来托管恶意HTML文件。
*   `requirements.txt`: 列出了POC所需的Python依赖项。
*   `utils.py`: 包含实用函数，例如启动HTTP服务器，检查IP和端口的可用性，以及准备恶意Word文档的函数。

**有效性：**

根据漏洞信息和POC代码，该漏洞利用是有效的。POC代码允许攻击者指定要执行的命令，并生成一个恶意的Word文档，该文档在打开时会触发漏洞并执行命令。

**投毒风险：**

该存储库的投毒风险较低，约10%。`config.py` 文件允许定义要执行的 `EXECUTED_COMMAND`，而 `manip_args.py` 会动态修改利用代码，这些地方可能存在潜在的恶意代码注入点。但是，总体来看，代码结构较为简单，功能明确，不易隐藏恶意代码。需要注意的是，使用任何漏洞利用代码都存在风险，需要仔细审查代码后再使用。此处的10%更多指的是一种不确定性风险的评估，需要人工代码审计来进行确认。

**项目地址:** [Imeneallouche/Follina-attack-CVE-2022-30190-](https://github.com/Imeneallouche/Follina-attack-CVE-2022-30190-)

**漏洞详情:** [CVE-2022-30190](https://nvd.nist.gov/vuln/detail/CVE-2022-30190)