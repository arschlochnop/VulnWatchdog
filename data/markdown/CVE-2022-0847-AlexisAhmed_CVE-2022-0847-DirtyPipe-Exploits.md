## CVE-2022-0847 Dirty Pipe 本地提权漏洞

**漏洞编号:** CVE-2022-0847

**漏洞类型:** 本地权限提升

**影响应用:** Linux Kernel

**危害等级:** 高危，可导致权限提升和任意文件覆盖

**影响版本:** Linux kernel versions newer than 5.8 and before 5.16.11, 5.15.25, 5.10.102

**利用条件:** 需要本地用户权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-0847，又名Dirty Pipe，是一个Linux内核中的本地权限提升漏洞。漏洞原因是由于pipe buffer结构中的"flags"成员没有正确初始化，导致其可能包含陈旧的值。未授权的本地用户可以利用此漏洞写入由只读文件支持的页面缓存中的页面，从而提升系统上的权限。

**有效性评估：**

提供的POC代码（exploit-1.c和exploit-2.c）是有效的。搜索结果中多个链接表明该漏洞的利用是可靠的，并且已存在公开可用的利用代码。

**投毒风险评估：**

查看提供的代码，`compile.sh` 只是编译了 `exploit-1.c` 和 `exploit-2.c` 两个文件，没有额外的恶意行为。
`exploit-1.c` 的主要功能是覆盖只读文件，示例中通过修改 `/etc/passwd` 文件的root密码来提权。虽然这是漏洞利用的常见方式，但如果攻击者将目标文件替换为关键系统文件或在利用代码中加入其他恶意操作，则可能构成投毒。
`exploit-2.c` 的作用是劫持 SUID 二进制文件。如果攻击者替换了 SUID 程序，或者覆盖了程序的关键部分，可能导致程序崩溃或者运行恶意代码，也存在一定的风险。
总体来说，该仓库中作者隐藏的投毒代码的可能性较低，但是使用时应该仔细审查代码，特别是目标文件和覆盖的内容，以避免潜在的风险。因此，投毒风险评估为 10%。

**利用方式：**

1.  **漏洞原理：** `copy_page_to_iter_pipe` 和 `push_pipe` 函数中新的管道缓冲区结构的“flags”成员缺乏适当的初始化，可能包含陈旧的值。
2.  **利用步骤：**
    *   **创建管道：** 创建一个管道，填充管道，并排空管道，使得管道缓冲区具有`PIPE_BUF_FLAG_CAN_MERGE`标志。
    *   **打开目标文件：** 以只读方式打开目标文件，该文件将被覆盖。
    *   **喷射管道：** 将数据写入管道，覆盖目标文件中的内容。
    *   **提权：** 通过修改/etc/passwd文件root用户的密码或者劫持SUID程序提升权限。
3.  **利用条件：** 需要本地用户权限，目标文件必须存在且可读，利用程序需要在受影响的Linux内核版本上运行。

**项目地址:** [AlexisAhmed/CVE-2022-0847-DirtyPipe-Exploits](https://github.com/AlexisAhmed/CVE-2022-0847-DirtyPipe-Exploits)

**漏洞详情:** [CVE-2022-0847](https://nvd.nist.gov/vuln/detail/CVE-2022-0847)