## CVE-2022-46169-Cacti-命令注入

**漏洞编号:** CVE-2022-46169

**漏洞类型:** 命令注入

**影响应用:** Cacti

**危害等级:** 高危，允许未经身份验证的攻击者执行任意命令

**影响版本:** < 1.2.23

**利用条件:** 需要Cacti实例运行，并且存在具有POLLER_ACTION_SCRIPT_PHP action的poller_item。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-46169 存在于 Cacti 1.2.23 之前的版本中。这是一个未经身份验证的命令注入漏洞，允许攻击者在服务器上执行任意代码。攻击者通过伪造 HTTP Header `X-Forwarded-For` 绕过身份验证，然后向 `remote_agent.php` 发送包含恶意 `poller_id` 的 POST 请求，该 `poller_id` 包含要执行的命令。 漏洞利用的关键在于 `remote_agent.php` 中对 `poller_id` 参数的不安全处理，以及对客户端 IP 地址验证的绕过。

提供的 PoC 代码通过 Go 语言实现，利用了该漏洞。它允许指定目标 Cacti 实例的 URL，以及要执行的命令。PoC 代码首先尝试绕过身份验证，然后构造包含恶意命令的 POST 请求。如果成功，服务器将执行该命令，并将结果返回给攻击者。

该PoC未发现明显的投毒代码。主要功能是构造HTTP请求，发送到目标服务器，然后解析返回结果。代码中没有发现任何尝试连接恶意服务器，执行恶意操作或者写入恶意文件的行为。 风险分析基于对提供的PoC代码本身的分析，并不能完全排除其他潜在的风险（例如，如果从不可信的源下载该PoC，则可能存在其他风险）。 因此，为了安全起见，最好人工审核代码，或者从可信的来源获取代码。

**利用方式：**
1.  **身份验证绕过：** 攻击者通过设置 `X-Forwarded-For` HTTP Header 为 Cacti 服务器的 IP 地址来绕过身份验证。
2.  **命令注入：** 攻击者构造一个包含恶意命令的 `poller_id` 参数，并通过 POST 请求将其发送到 `remote_agent.php`。
3.  **命令执行：** Cacti 服务器执行 `poller_id` 中包含的命令。

**漏洞利用有效性：**
根据漏洞描述、搜索结果和提供的PoC代码，此漏洞利用是有效的。PoC代码演示了如何利用此漏洞在目标系统上执行任意命令。



**项目地址:** [devAL3X/CVE-2022-46169_poc](https://github.com/devAL3X/CVE-2022-46169_poc)

**漏洞详情:** [CVE-2022-46169](https://nvd.nist.gov/vuln/detail/CVE-2022-46169)