## CVE-2018-6574-go get 远程命令执行

**漏洞编号:** CVE-2018-6574

**漏洞类型:** 远程命令执行

**影响应用:** Go

**危害等级:** 高危，可能导致系统被完全控制

**影响版本:** < 1.8.7, 1.9.x < 1.9.4, 1.10 pre-releases < 1.10rc2

**利用条件:** 目标系统使用受影响的Go版本，且执行了`go get`命令来获取恶意代码仓库。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2018-6574允许攻击者利用`go get`命令执行任意代码。漏洞原理是由于受影响的Go版本在构建过程中没有正确过滤`-fplugin`和`-plugin`参数，攻击者可以在代码仓库中包含恶意的gcc/clang插件，当用户使用`go get`下载并构建该仓库时，恶意插件会被执行，从而实现远程命令执行。

**有效性分析：**
提供的POC代码是有效的，它演示了如何利用`-fplugin`选项执行代码。`attack.c`文件包含一个`malicious()`函数，该函数使用`system()`调用执行命令`/usr/local/bin/score cacd042c-6b75-4c9b-b52d-3ebb2f52932e`。`attack.go`文件使用`#cgo CFLAGS: -fplugin=./attack.so`指令告诉go编译器在构建过程中包含该恶意插件。

**投毒风险分析：**
代码本身没有明显的投毒迹象。`attack.c`中执行的命令`/usr/local/bin/score cacd042c-6b75-4c9b-b52d-3ebb2f52932e`看起来像是一个示例或者测试命令，用于验证漏洞是否成功利用。虽然这个命令本身可能是无害的，但攻击者可以修改`attack.c`来执行任何他们想要的恶意命令，这才是真正的风险所在。所以说，从提供的代码来看，投毒的概率为0%，但是不代表攻击者不能进行投毒。

**利用方式分析：**
1.  攻击者创建一个包含恶意代码的Go项目，其中包括`attack.c`和`attack.go`文件，以及`go.mod`文件。
2.  攻击者将该项目托管在一个公开的代码仓库中（如GitHub）。
3.  攻击者诱骗目标用户使用`go get`命令下载并构建该项目。
4.  当目标用户执行`go get`命令时，Go编译器会读取`attack.go`文件中的`#cgo CFLAGS: -fplugin=./attack.so`指令，并将`attack.so`插件加载到构建过程中。
5.  `attack.so`插件中的`malicious()`函数会被执行，从而执行攻击者预先设定的恶意命令。

**项目地址:** [lisu60/cve-2018-6574](https://github.com/lisu60/cve-2018-6574)

**漏洞详情:** [CVE-2018-6574](https://nvd.nist.gov/vuln/detail/CVE-2018-6574)