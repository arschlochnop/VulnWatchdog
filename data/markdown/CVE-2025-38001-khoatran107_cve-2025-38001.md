## CVE-2025-38001-Linux Kernel-HFSC Use-After-Free

**漏洞编号:** CVE-2025-38001

**漏洞类型:** Use-After-Free

**影响应用:** Linux Kernel

**危害等级:** 高危，可能导致内核崩溃、权限提升甚至远程代码执行

**影响版本:** 5.0 <= Linux Kernel < 5.4.294, 5.0 <= Linux Kernel < 5.10.238, 5.0 <= Linux Kernel < 5.15.185, 5.0 <= Linux Kernel < 6.1.141, 5.0 <= Linux Kernel < 6.6.93, 5.0 <= Linux Kernel < 6.12.32, 5.0 <= Linux Kernel < 6.14.10, 5.0 <= Linux Kernel < 6.15.1, 5.0 <= Linux Kernel < 6.16-rc1

**利用条件:** 需要配置特定的网络流量控制规则（HFSC、NETEM、TBF）

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2025-38001 存在于 Linux 内核的 net_sched HFSC (Hierarchical Fair Service Curve) 调度器组件中。该漏洞允许攻击者通过重新进入队列操作，将类两次添加到 eltree，从而导致 use-after-free (UAF) 漏洞。具体来说，该漏洞是由于补丁 141d34391abbb315d68556b7c67ad97885407547 只检查 `cl->cl_nactive` 字段来确定是否是第一次插入，但该字段只被 `init_vf` 递增。通过使用 HFSC_RSC (使用 init_ed)，可以绕过检查并将类两次插入到 eltree 中。为了触发 UAF，还需要结合 TBF 调度器以防止数据包被立即出队。根据搜索结果，存在公开可用的exploit (链接4: https://github.com/0xdevil/CVE-2025-38001)，并且该漏洞在kernelCTF实例和Debian 12上可以成功利用。提供的漏洞利用代码包含编译脚本、flag文件、gdb脚本和qemu运行脚本，看起来是针对kernelCTF环境的。compile.sh负责编译exploit目录下的exploit程序，并将其移动到shared目录下。kasan.gdb和script.gdb应该是用于调试的gdb脚本。local_runner_userns.sh和qemu_v3_userns.sh用于在qemu虚拟机中运行漏洞利用程序。仓库中可能存在的投毒风险为10%，风险点主要在exploit程序本身，作者可能在其中隐藏恶意代码，例如反弹shell等。但根据文件结构判断，该POC主要目的是为了漏洞验证和利用，加入恶意代码的可能性较低。

**项目地址:** [khoatran107/cve-2025-38001](https://github.com/khoatran107/cve-2025-38001)

**漏洞详情:** [CVE-2025-38001](https://nvd.nist.gov/vuln/detail/CVE-2025-38001)