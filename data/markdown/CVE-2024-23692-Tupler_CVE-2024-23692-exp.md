## CVE-2024-23692-Rejetto HFS-模板注入RCE

**漏洞编号:** CVE-2024-23692

**漏洞类型:** 模板注入RCE

**影响应用:** Rejetto HTTP File Server

**危害等级:** 严重，远程代码执行

**影响版本:** <= 2.3m (实际影响到2.4 RC7)

**利用条件:** 目标服务器运行存在漏洞的 Rejetto HFS 服务，攻击者能够通过网络访问该服务

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-23692 是 Rejetto HTTP File Server (HFS) 2.3m 及更早版本（实际影响到 2.4 RC7）中的一个模板注入漏洞。此漏洞允许未经身份验证的远程攻击者通过发送特制的 HTTP 请求在受影响的系统上执行任意命令。

**有效性:**
提供的 Python POC 代码 `CVE-2024-23692.py` 看起来有效。代码首先建立与目标服务器的 TCP 连接。 然后它接收用户输入的命令,将其进行 URL 编码，并将其嵌入到一个精心构造的 HTTP GET 请求中。 该请求利用模板注入漏洞在服务器端执行命令。服务器的响应被解析，提取命令执行的结果并打印给用户。代码通过对返回内容进行正则匹配提取执行结果，并避免直接输出所有返回内容来降低风险。

**投毒风险:**
对提供的 POC 代码 `CVE-2024-23692.py` 和 `README.md` 进行分析后，未发现明显的恶意代码或投毒迹象。 代码的功能符合漏洞利用的预期行为，没有发现尝试执行与漏洞利用无关的恶意操作的代码。

**利用方式:**
1.  **目标确认:** 确定目标服务器上运行着易受攻击的 Rejetto HFS 版本 (<= 2.3m, 实际影响到 2.4 RC7).
2.  **构造Payload:** 构造包含恶意命令的 HTTP GET 请求。 POC代码中cmd参数即是需要执行的命令,该命令会被进行URL编码后插入请求中。
3.  **发送请求:** 将构造的 HTTP 请求发送到目标服务器。
4.  **执行命令:** HFS 处理请求时，会执行注入的命令。 `{.exec|{.?cmd.}|timeout=15|out=abc.}{.?n.}{.?n.}RESULT:{.?n.}{.^abc.}===={.?n.}`这部分是payload的关键。 {.exec}调用执行外部命令, {.?cmd.}是用户可控的命令，timeout=15限制超时时间，out=abc.将输出重定向到文件abc.，RESULT和====用于标记输出结果，方便提取。
5.  **获取结果:**  从服务器的响应中提取命令执行的结果。POC代码中对返回内容进行正则匹配，提取RESULT和====之间的内容。

**结论:**
该漏洞利用是有效的，并且能够实现远程代码执行。提供的代码中未发现投毒风险。 通过构造特定的请求，攻击者可以在目标系统上执行任意命令，导致严重的安全风险。 根据CISA的已知被利用漏洞目录，该漏洞已被积极利用。

**项目地址:** [Tupler/CVE-2024-23692-exp](https://github.com/Tupler/CVE-2024-23692-exp)

**漏洞详情:** [CVE-2024-23692](https://nvd.nist.gov/vuln/detail/CVE-2024-23692)