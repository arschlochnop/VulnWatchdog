## CVE-2023-4220-Chamilo-Unauthenticated-RCE

**漏洞编号:** CVE-2023-4220

**漏洞类型:** RCE

**影响应用:** Chamilo LMS

**危害等级:** 高危，未经身份验证的攻击者可以通过上传webshell获得远程代码执行权限

**影响版本:** <= 1.11.24

**利用条件:** 需要目标Chamilo LMS实例存在，且版本小于等于1.11.24，并可网络访问

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-4220是Chamilo LMS中的一个未经验证的文件上传漏洞，位于`/main/inc/lib/javascript/bigupload/inc/bigUpload.php`。未经身份验证的攻击者可以利用此漏洞上传恶意文件（webshell），从而执行任意代码。漏洞利用方式如下：

1.  **漏洞验证:** 通过访问`/main/inc/lib/javascript/bigupload/files/` 确认目录存在，验证目标是否存在漏洞。
2.  **webshell上传:** 使用POST请求向`/main/inc/lib/javascript/bigupload/inc/bigUpload.php?action=post-unsupported` 上传包含PHP代码的恶意文件，文件名为`bigUploadFile`，文件内容为webshell。
3.  **代码执行:** 通过访问`{self.check_url}{filename}?cmd={command}` 执行webshell中的指令

根据提供的POC代码，漏洞利用代码有效。`exploit.py`文件包含`ChamiloBigUploadExploit`类，其中包含了验证漏洞、上传webshell和执行反向shell的方法。

投毒风险评估：

代码中存在动态构建和执行命令的部分，例如在`send_and_execute_revshell`函数中，存在编码绕过，创建bash反弹shell脚本并通过GET参数`cmd`执行。理论上，攻击者可以在`webshell_content`变量中注入恶意代码，或者在`send_and_execute_revshell`函数构建恶意命令。

查看仓库的`README.md`文件,作者要求使用 `pip install -r requirements.txt` 安装依赖包,需要检查`requirements.txt`内容。

在当前提供的代码片段中，没有发现明显的恶意代码。判断仓库中存在的投毒代码可能性为5%，需要进一步对依赖包进行检查。

利用方式总结：

1.  扫描目标以确认漏洞是否存在。
2.  上传webshell。
3.  （可选）上传和执行反向shell，或者直接使用webshell执行任意命令。

**项目地址:** [charchit-subedi/chamilo-lms-unauthenticated-rce-poc](https://github.com/charchit-subedi/chamilo-lms-unauthenticated-rce-poc)

**漏洞详情:** [CVE-2023-4220](https://nvd.nist.gov/vuln/detail/CVE-2023-4220)