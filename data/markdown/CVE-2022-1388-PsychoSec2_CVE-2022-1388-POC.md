## CVE-2022-1388 - F5 BIG-IP iControl REST 认证绕过远程代码执行

**漏洞编号:** CVE-2022-1388

**漏洞类型:** 认证绕过/远程代码执行

**影响应用:** F5 BIG-IP

**危害等级:** 高危，未授权远程代码执行

**影响版本:** BIG-IP 16.1.x (< 16.1.2.2), 15.1.x (< 15.1.5.1), 14.1.x (< 14.1.4.6), 13.1.x (< 13.1.5), 12.1.x (<= 12.1.6), 11.6.x (<= 11.6.5)

**利用条件:** 目标系统存在漏洞版本，并且可以通过网络访问其iControl REST接口

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-1388 允许未经身份验证的攻击者绕过 F5 BIG-IP iControl REST 的身份验证，从而执行任意命令。 

**有效性分析：**

根据漏洞库信息、搜索引擎结果和提供的漏洞利用代码，此漏洞利用的**有效性很高**。漏洞库信息将其评级为“严重”，CVSS v3.1 评分为 9.8，并且CISA的已知被利用漏洞目录中包含此漏洞，表明该漏洞已被广泛利用。

提供的 Python 漏洞利用代码 `CVE-2022-1388.py` 针对此漏洞。 该代码通过发送特制的 HTTP 请求绕过身份验证，然后执行任意命令。搜索引擎结果也确认了该漏洞的存在和利用。

**投毒风险分析：**

代码本身看起来是一个直接的漏洞利用程序，根据快速审查，直接植入后门的可能性较小。 然而，重要的是要注意到以下几点：

*   **依赖关系：** 代码依赖于 `requests` 库。 虽然 `requests` 本身是安全的，但是需要检查是否存在对 `requirements.txt` 或者类似文件的恶意修改，以从恶意源安装了篡改过的 `requests` 版本。 在提供的代码中，没有发现requirements.txt文件
*   **远程服务器通信：** 代码会与目标 F5 BIG-IP 设备进行通信。 如果目标系统受到攻击，代码可能会被修改以将信息发送到攻击者控制的服务器。 但此风险不在本存储库中。
*   **作者信誉：** 漏洞利用作者的信誉未知。 虽然代码可能看起来无害，但始终存在作者在代码中包含隐藏的恶意功能的可能性。

综合考虑这些因素，**投毒风险较低，约 5%**。 但是，用户应始终谨慎并仔细审查来自不受信任来源的代码。

**漏洞利用方式：**

1.  **未经身份验证的访问：** 漏洞利用的关键在于绕过 iControl REST API 的身份验证。 这可以通过设置特定的HTTP头部来实现，例如 `Host: 127.0.0.1`，`X-F5-Auth-Token: asdf` 以及 `Connection: X-F5-Auth-Token`，以及一个带有任意密码的认证头 `Authorization: Basic YWRtaW46aG9yaXpvbjM=`。 这些头部的组合会导致身份验证机制失效，从而允许未经身份验证的请求。
2.  **命令执行：** 绕过身份验证后，漏洞利用代码使用 `/mgmt/tm/util/bash` 端点执行任意 bash 命令。  它构造一个包含要执行的命令的 JSON payload，并将其发送到此端点。
3.  **交互式 Shell：** 提供的漏洞利用代码包含一个交互式 shell 选项 (`-s`)，允许攻击者在目标系统上执行连续的命令。  这使得攻击者能够完全控制受影响的 F5 BIG-IP 设备。

**项目地址:** [PsychoSec2/CVE-2022-1388-POC](https://github.com/PsychoSec2/CVE-2022-1388-POC)

**漏洞详情:** [CVE-2022-1388](https://nvd.nist.gov/vuln/detail/CVE-2022-1388)