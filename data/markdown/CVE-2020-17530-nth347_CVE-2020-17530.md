## CVE-2020-17530 - Apache Struts OGNL 远程代码执行

**漏洞编号:** CVE-2020-17530

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Struts

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** Struts 2.0.0 - Struts 2.5.25

**利用条件:** Struts应用配置允许OGNL表达式在标签属性中进行二次解析

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-17530是Apache Struts框架中的一个远程代码执行漏洞，源于OGNL表达式的二次解析。当Struts配置允许在标签属性中使用用户提供的未经验证的输入，且该输入包含OGNL表达式时，Struts会对该表达式进行二次解析，从而允许攻击者执行任意代码。

**有效性：**
根据漏洞库信息和搜索结果，该漏洞的POC是有效的，并且已经被广泛利用。
提供的POC代码看起来能够重现该漏洞。pom.xml 文件指定了受影响的Struts版本 (2.5.25)，并且s2061.jsp文件中的 `<s:a id="%{id}">Simple test</s:a>`  显示了 OGNL 表达式在 `id` 属性中的使用，这是触发漏洞的关键点。Main.java文件设置了一个内嵌的Tomcat服务器，用于运行Struts应用，方便漏洞验证。

**投毒风险：**
分析POC代码，投毒风险较低，大约为10%。
虽然POC代码的目的是为了重现漏洞，但其中可能存在一些潜在的风险。主要集中在以下几个方面：
*   **依赖项风险：** pom.xml 文件中引用的第三方库（尤其是commons-collections 3.2.2）可能本身就存在安全漏洞。如果commons-collections库存在漏洞，攻击者可能会利用这些漏洞进行进一步的攻击。
*   **编译和运行环境风险：** 如果编译或运行POC代码的环境不安全，例如被恶意软件感染，那么恶意软件可能会篡改POC代码，从而引入恶意功能。

**利用方式：**
利用方式主要包括以下步骤：
1.  **确定目标Struts应用版本：** 确认目标应用使用了受影响的Struts版本（2.0.0 - 2.5.25）。
2.  **构造恶意OGNL表达式：** 构造包含恶意代码的OGNL表达式。例如，可以使用`%{Runtime.getRuntime().exec('command')}`来执行系统命令。
3.  **将恶意表达式注入到可控的标签属性中：** 将构造的OGNL表达式注入到Struts标签的属性中，例如 `<s:a id="%{OGNL_EXPRESSION}">`，并且确保该属性会被二次解析。
4.  **发送包含恶意表达式的请求：**  向目标应用发送包含恶意表达式的HTTP请求。
5.  **执行任意代码：** Struts框架会对收到的OGNL表达式进行二次解析，从而执行攻击者注入的任意代码。

**项目地址:** [nth347/CVE-2020-17530](https://github.com/nth347/CVE-2020-17530)

**漏洞详情:** [CVE-2020-17530](https://nvd.nist.gov/vuln/detail/CVE-2020-17530)