## CVE-2025-30065-Apache Parquet-反序列化RCE

**漏洞编号:** CVE-2025-30065

**漏洞类型:** 反序列化RCE

**影响应用:** Apache Parquet Java (parquet-avro module)

**危害等级:** 高危，可导致远程代码执行

**影响版本:** <= 1.15.0

**利用条件:** 目标系统使用受影响版本的Apache Parquet，且接受并解析来自不可信来源的Parquet文件。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2025-30065存在于Apache Parquet Java库的parquet-avro模块中，由于不安全的Avro模式解析导致的反序列化漏洞。攻击者可以构造包含恶意序列化Java对象的Parquet文件，当受害者使用受影响的库解析该文件时，恶意代码将被执行，从而实现远程代码执行（RCE）。

**漏洞利用有效性评估：**

根据漏洞库信息、搜索结果和提供的POC代码，可以判定此漏洞利用是有效的。漏洞库信息明确指出该漏洞允许执行任意代码，搜索结果中多个来源都确认了这是一个高危RCE漏洞，并且POC代码也提供了可行的利用方式。

**投毒风险评估：**

分析提供的POC代码，没有发现明显的投毒代码。`MaliciousPayload.java` 类的目的是执行 `whoami` 命令，用于验证代码执行。`ParquetPayloadWriter.java` 用于生成包含序列化 `MaliciousPayload` 对象的 Parquet 文件。 `ParquetPayloadReader.java`用于读取`Parquet`文件，触发恶意代码。`docker-compose.yaml` 和 `pom.xml` 文件用于构建和运行 POC 环境。虽然理论上作者可以在生成payload时植入其他恶意代码，但当前提供的代码片段没有直接证据表明存在恶意代码植入行为，因此，评估投毒风险极低，给出1%的概率主要原因是存在作者在生成payload阶段可能动手脚的情况。

**漏洞利用方式：**

1.  **构造恶意Parquet文件：** 攻击者创建一个特制的Parquet文件，该文件包含嵌入的序列化Java对象 (`MaliciousPayload`)。`ParquetPayloadWriter.java`用于生成恶意payload。
2.  **诱骗目标解析恶意Parquet文件：** 攻击者通过某种方式（例如，上传、邮件、网络共享等）将恶意Parquet文件发送给受害者。
3.  **触发反序列化：** 当目标应用程序使用受影响版本的Apache Parquet库解析该恶意Parquet文件时，`AvroParquetReader` 会尝试反序列化嵌入的Java对象。`ParquetPayloadReader.java` 用于模拟读取恶意payload。
4.  **执行恶意代码：** 由于不安全的反序列化，`MaliciousPayload` 中的静态代码块将被执行，从而实现远程代码执行。`MaliciousPayload.java`中的静态代码块会执行`whoami`命令作为演示。

总结：漏洞利用过程依赖于反序列化漏洞，攻击者需要构造特殊的Parquet文件并诱使用户加载解析。

**项目地址:** [bjornhels/CVE-2025-30065](https://github.com/bjornhels/CVE-2025-30065)

**漏洞详情:** [CVE-2025-30065](https://nvd.nist.gov/vuln/detail/CVE-2025-30065)