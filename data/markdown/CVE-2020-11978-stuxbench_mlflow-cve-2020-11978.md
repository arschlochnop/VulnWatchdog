## CVE-2020-11978-Apache Airflow-远程代码执行

**漏洞编号:** CVE-2020-11978

**漏洞类型:** 远程代码执行

**影响应用:** Apache Airflow

**危害等级:** 高危，允许认证用户以Airflow worker/scheduler的身份执行任意命令

**影响版本:** <= 1.10.10

**利用条件:** Airflow启用了示例DAGs，且攻击者拥有Airflow的认证用户权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于Apache Airflow的示例DAGs中。当`load_examples=True`时，Airflow会加载包含漏洞的示例DAGs。攻击者利用此漏洞，构造恶意的参数，即可在运行Airflow worker/scheduler的服务器上执行任意命令。

**有效性：**
根据提供的漏洞库信息，CVE-2020-11978是一个经过验证的远程代码执行漏洞，并且已被添加到CISA的已知被利用漏洞目录中。提供的Dockerfile和相关脚本尝试创建一个可复现漏洞的环境，这表明该POC代码是有效的。

**投毒风险：**
提供的代码看起来像是创建了一个用于测试和演示CVE-2020-11978漏洞的环境。它从GitHub仓库克隆了一个专门标记为`cve-2020-11978-vuln`的分支，旨在重现漏洞，而不是引入恶意代码。但是，仍然存在微小的投毒风险，例如:
*   **依赖风险:** `pyproject.toml` 和 `requirements/test-requirements.txt`可能包含恶意依赖包，虽然可能性很小。由于依赖包的数量较多，难以人工完全验证。
*   **GitHub仓库被篡改的风险:** 虽然克隆了指定分支，但GitHub仓库本身可能已经被攻击者控制并篡改，从而引入恶意代码。这是一种供应链攻击。
*   **`hud-python`风险:** `pyproject.toml` 中依赖的`hud-python` 来自 `https://github.com/hud-evals/hud-python.git`，增加了代码被投毒的风险，需要谨慎验证其安全性。
总体来看，投毒风险较低，主要集中在依赖项和第三方代码库。需要进一步审查依赖项和相关脚本，才能更准确地评估风险。

**利用方式：**
1.  **环境准备:** 设置一个运行易受攻击的Apache Airflow版本(<= 1.10.10)的环境，并确保`load_examples=True`。
2.  **身份认证:** 获取Airflow的有效用户凭据。
3.  **漏洞触发:** 找到存在漏洞的示例DAG，构造包含恶意命令的参数并触发DAG运行。攻击者可以通过Airflow的Web界面或者API来触发DAG。
4.  **代码执行:** 恶意命令将在Airflow worker或scheduler上执行，攻击者可以利用此漏洞进行权限提升、数据窃取或进一步的横向渗透。

**项目地址:** [stuxbench/mlflow-cve-2020-11978](https://github.com/stuxbench/mlflow-cve-2020-11978)

**漏洞详情:** [CVE-2020-11978](https://nvd.nist.gov/vuln/detail/CVE-2020-11978)