## CVE-2023-26136-tough-cookie-Prototype污染

**漏洞编号:** CVE-2023-26136

**漏洞类型:** Prototype Pollution

**影响应用:** tough-cookie

**危害等级:** 中危，可能导致拒绝服务或篡改应用行为

**影响版本:** < 4.1.3

**利用条件:** 需要使用CookieJar，并且rejectPublicSuffixes设置为false

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-26136是tough-cookie包在4.1.3版本之前存在的一个原型污染漏洞。当使用CookieJar且rejectPublicSuffixes=false时，由于对Cookie处理不当，可能导致原型污染。

**有效性评估：**
根据漏洞库信息、搜索结果和提供的漏洞利用代码，该漏洞是有效的。多个来源确认了此漏洞的存在，并提供了修复方案。

**利用方式：**
攻击者可以通过构造恶意的cookie，特别是当cookie的domain设置为`__proto__`时，利用`tough-cookie`库在处理cookie时，向Object.prototype注入恶意属性。由于JavaScript中所有对象都继承自Object.prototype，这会影响应用程序的全局状态，可能导致：

*   **拒绝服务 (DoS):** 通过注入导致异常或无限循环的属性。
*   **篡改应用行为:** 通过注入改变应用程序逻辑的关键属性，影响其行为。

提供的代码尝试通过设置特定的cookie来触发原型污染。`index.js` 脚本的逻辑是创建一个cookie jar，然后尝试设置一个具有特定属性的cookie。`vulnerable`变量控制是否禁用`rejectPublicSuffixes`。如果设置为true，则模拟易受攻击的情况。

**投毒风险评估：**
提供的代码主要包含以下文件：
*   `README.md`: 漏洞描述、修复方案和项目说明。
*   `index.js`: 包含原型污染漏洞的验证代码
    * `test-unit.js`: 测试用例，用于验证修复方案。
    * `testVerifyVulnerable.js`: 测试脚本，用于验证漏洞修复后的行为。

综合评估来看，投毒风险较低。风险点在于 `index.js` 是否存在后门代码，但分析内容可知，该文件主要是漏洞验证代码，不存在恶意行为。

**分析：** 该漏洞利用了JavaScript原型链的特性。通过原型污染，攻击者可以影响所有JavaScript对象的行为。修复此漏洞的关键在于防止在处理cookie时直接操作`Object.prototype`。snyk提供的链接指向的修复方案表明，该漏洞是通过不安全的对象递归合并以及通过路径定义属性造成的。该代码提供了一个简单的原型污染验证，在实际利用中，攻击者可能需要更精细地构造cookie，以便产生更大的影响。

**项目地址:** [ronmadar/Open-Source-Seal-Security](https://github.com/ronmadar/Open-Source-Seal-Security)

**漏洞详情:** [CVE-2023-26136](https://nvd.nist.gov/vuln/detail/CVE-2023-26136)