## CVE-2022-42889 Text4Shell RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** 1.5 <= version <= 1.9

**利用条件:** 应用程序使用受影响版本的 Apache Commons Text，并且允许用户可控的输入传递给执行插值的函数。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-42889 (Text4Shell) 是一个 Apache Commons Text 库中的远程代码执行漏洞。该漏洞源于库中存在变量插值功能，允许动态评估和扩展属性。在 1.5 到 1.9 版本中，默认的 Lookup 实例包含一些插值器，例如 "script", "dns", 和 "url"，这些插值器可能导致任意代码执行或与远程服务器通信。如果应用程序使用这些默认插值器并且允许用户可控的输入进行插值，那么攻击者可以通过构造包含恶意表达式的输入，例如`${script:javascript:java.lang.Runtime.getRuntime().exec('command')}`，来执行任意代码。提供的漏洞利用代码 `main.go` 尝试构造一个包含恶意payload的URL，该URL包含一个 `${script:javascript:java.lang.Runtime.getRuntime().exec('command')}` 形式的payload, 并通过HTTP GET请求发送到目标服务器。`possiblepoc.go` 文件似乎尝试创建一个反向shell。 根据代码分析,未发现作者隐藏的恶意投毒代码。利用方式：1. 确定目标应用程序正在使用受影响版本的 Apache Commons Text 并且暴露了允许用户输入进行插值的接口。2. 构造包含恶意表达式的输入，例如`${script:javascript:java.lang.Runtime.getRuntime().exec('command')}`。3. 将构造的输入发送到目标应用程序，触发漏洞并执行任意代码。

**项目地址:** [34006133/CVE-2022-42889](https://github.com/34006133/CVE-2022-42889)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)