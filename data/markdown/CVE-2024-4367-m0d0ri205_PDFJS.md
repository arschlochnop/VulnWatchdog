## CVE-2024-4367-Firefox-PDF.js-Arbitrary-JavaScript-Execution

**漏洞编号:** CVE-2024-4367

**漏洞类型:** 任意JavaScript执行

**影响应用:** Firefox, Firefox ESR, Thunderbird (通过 PDF.js)

**危害等级:** 高危，可能导致跨站脚本攻击 (XSS) 和敏感信息泄露

**影响版本:** < Firefox 126, < Firefox ESR 115.11, < Thunderbird 115.11

**利用条件:** 用户需要打开恶意PDF文件

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4367 是一个存在于 Mozilla Firefox, Firefox ESR 和 Thunderbird 中的高危漏洞。该漏洞源于 PDF.js 在处理字体时缺少类型检查，使得攻击者可以通过构造恶意的 PDF 文件，在 PDF.js 上下文中执行任意 JavaScript 代码。当用户使用受影响的浏览器版本打开包含恶意 JavaScript 的 PDF 文件时，这段 JavaScript 代码将被执行，可能导致跨站脚本攻击 (XSS), 获取敏感信息等风险。

**有效性评估：**

根据漏洞描述和搜索结果，漏洞利用代码的目的是搭建一个易受攻击的环境来测试 CVE-2024-4367 。 docker-compose.yml 和 Dockerfile 用于构建一个包含 express，multer 和 pdfjs-dist 的 node 应用。 app.js 接收上传的 PDF 文件，并通过 pdfjs-dist 在浏览器中渲染。如果 PDF 文件包含恶意的 JavaScript 代码，那么它将在用户的浏览器中执行。因此，POC 代码本身不是漏洞利用，而是搭建易受攻击环境，然后需要攻击者构造特殊的PDF文件利用此漏洞。

**投毒风险评估：**

分析了提供的POC代码，发现其中 `/deploy/app.js` 中存在获取 `/flag` 接口的逻辑，但只有当请求来自 `127.0.0.1` 时才会返回 `SF{FAKE_FLAG}`。而 `/deploy/flag.txt` 文件中包含真正的 flag `flag{pdf_js_pdf}`，这个flag可能意味着真实的利用。如果作者的本意是迷惑使用者使用假的flag，且使用者不仔细分析代码，可能会被误导。代码中存在一定的迷惑性，但主要目的是测试，投毒的风险较低，估计为10%。

**利用方式分析：**

1.  攻击者需要创建一个恶意的 PDF 文件，该文件利用 PDF.js 在处理字体时缺少类型检查的漏洞，嵌入恶意的 JavaScript 代码。
2.  攻击者将此恶意 PDF 文件发送给目标用户。
3.  目标用户使用受影响的 Firefox, Firefox ESR 或 Thunderbird 版本打开此 PDF 文件。
4.  由于漏洞的存在，恶意 JavaScript 代码将在用户的浏览器中执行。这个 JavaScript 代码可以执行各种恶意操作，例如窃取 Cookie、重定向用户到恶意网站、甚至执行其他攻击。

利用该漏洞的关键在于构造一个能够绕过 PDF.js 类型检查的恶意 PDF 文件，并嵌入能够执行攻击者所需操作的 JavaScript 代码。


**项目地址:** [m0d0ri205/PDFJS](https://github.com/m0d0ri205/PDFJS)

**漏洞详情:** [CVE-2024-4367](https://nvd.nist.gov/vuln/detail/CVE-2024-4367)