## CVE-2022-41082 - Microsoft Exchange Server Remote Code Execution

**漏洞编号:** CVE-2022-41082

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Microsoft Exchange Server

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** Exchange 2013, 2016, 2019 在2022年11月8日补丁之前的版本，具体版本参见CVE信息

**利用条件:** 需要有效的Exchange用户凭据以及OWA(Outlook Web Access)访问权限，通常与CVE-2022-41040 (SSRF) 配合使用, 搜索引擎结果显示需要Exchange PowerShell是可访问的。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-41082 是 Microsoft Exchange Server 中的一个远程代码执行漏洞，也称为 ProxyNotShell。它与 CVE-2022-41040 (SSRF) 漏洞结合使用，形成一个攻击链。攻击者首先利用 CVE-2022-41040 的 SSRF 漏洞，然后利用 CVE-2022-41082 执行任意代码。

**利用方式：**

1.  **身份验证：** 攻击者需要一个有效的 Exchange 用户凭据。这可能是通过泄露、暴力破解或其他方式获得的。
2.  **SSRF (CVE-2022-41040)：** 攻击者利用 CVE-2022-41040 的 SSRF 漏洞，向 Exchange 服务器发送精心构造的请求。 
3.  **OWASSRF + RCE (CVE-2022-41082)：**  攻击者通过构造特定的请求，利用 Outlook Web Access (OWA) 绕过 URL 重写缓解措施，从而触发远程代码执行。
4.  **代码执行：** 成功利用漏洞后，攻击者可以在 Exchange 服务器上执行任意代码，获得服务器的完全控制权。
5.  **TabShell (CVE-2022-41076):** PoC 中包含 TabShell.ps1，这是一种权限提升漏洞，用于突破受限的 PowerShell 沙箱，进一步提升攻击者的权限。

**关于投毒风险分析：**

查看提供的代码，`poc.py` 脚本主要功能是利用`requests`库，通过发送精心构造的HTTP请求到Exchange服务器上的OWA接口实现漏洞利用。`TabShell.ps1` 则是一个 PowerShell 脚本，用于在利用漏洞获得一定权限后，尝试提权并执行命令。

风险点可能在于`cmd_file`文件的内容。如果该文件由攻击者控制，则可以包含恶意命令。此外，`TabShell.ps1` 脚本中存在执行任意 PowerShell 命令的能力，存在潜在的恶意利用风险。

由于脚本主要依赖于合法的 Exchange 功能和协议，因此直接的“投毒”可能性较低，更多的是通过命令执行来植入后门或进行其他恶意活动。风险主要来自 `cmd_file` 的内容以及 `TabShell.ps1` 中可执行任意命令的功能. `poc.py`中的 HTTP Proxy设置可能被用于流量劫持，但属于利用方使用的手段，这里不判定为投毒。

因此，评估投毒风险为 10%。 风险主要存在于利用该 PoC 进行攻击的人员。如果利用此PoC进行未授权渗透，存在后门植入等恶意行为。作者本身的投毒风险较低。

**项目地址:** [balki97/OWASSRF-CVE-2022-41082-POC](https://github.com/balki97/OWASSRF-CVE-2022-41082-POC)

**漏洞详情:** [CVE-2022-41082](https://nvd.nist.gov/vuln/detail/CVE-2022-41082)