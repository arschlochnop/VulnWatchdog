## CVE-2015-1328-Overlayfs本地提权

**漏洞编号:** CVE-2015-1328

**漏洞类型:** 本地提权

**影响应用:** Linux Kernel (Overlayfs)

**危害等级:** 高危，允许本地用户获取root权限

**影响版本:** Ubuntu through 15.04, Linux kernel before 3.19.0-21.21

**利用条件:** 需要overlayfs支持和用户命名空间启用 (kernel.unprivileged_userns_clone=1)

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

该漏洞存在于Linux内核的overlayfs实现中，由于不正确的权限检查，允许本地用户在overlayfs挂载点利用漏洞获取root权限。

**利用方式：**

1.  **命名空间创建：** 利用`unshare(CLONE_NEWUSER)`创建一个新的用户命名空间。
2.  **挂载命名空间：** 创建一个新的挂载命名空间（`CLONE_NEWNS`）。
3.  **Overlayfs挂载：** 挂载overlayfs文件系统，利用overlayfs操纵系统目录。
4.  **文件操纵：** 使用overlayfs重命名文件并写入`/etc/ld.so.preload`。
5.  **库注入：** 将恶意的共享库写入`/tmp/ofs-lib.so`。
6.  **权限提升：** 执行`/bin/su`，它会触发预加载的库。
7.  **Root Shell：** 该库劫持`getuid()`并生成一个root shell。

**代码分析：**

提供的Makefile和源代码表明这是一个利用LD_PRELOAD机制的本地提权漏洞。攻击者通过overlayfs挂载，修改/etc/ld.so.preload，将恶意的动态链接库加载到进程中，劫持`getuid`函数，从而获得root权限。

**投毒风险评估：**

虽然该POC旨在利用漏洞，但存在潜在的投毒风险。例如，`ofs-lib.c` 可以被修改，在提权的同时，执行其他恶意操作，如安装后门，上传敏感数据等。评估的投毒风险较低(5%)，因为该漏洞利用的重点在于提权，而非隐藏恶意行为，且提供的代码较为直接和清晰。但是如果用于实际的渗透测试，需要对`ofs-lib.c`进行更仔细的分析，以确定是否存在隐藏的恶意代码。

**项目地址:** [0xf1d0/CVE-2015-1328](https://github.com/0xf1d0/CVE-2015-1328)

**漏洞详情:** [CVE-2015-1328](https://nvd.nist.gov/vuln/detail/CVE-2015-1328)