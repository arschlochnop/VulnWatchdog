## CVE-2024-0012 PAN-OS 身份验证绕过

**漏洞编号:** CVE-2024-0012

**漏洞类型:** 身份验证绕过

**影响应用:** Palo Alto Networks PAN-OS

**危害等级:** 高危，允许未经身份验证的攻击者获得管理员权限

**影响版本:** PAN-OS 10.2, 11.0, 11.1, 和 11.2 (受影响版本详见漏洞库信息)

**利用条件:** 目标设备的管理 Web 界面需要能通过网络访问。如果管理界面仅允许受信任的内部 IP 地址访问，风险将大大降低。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-0012 是 Palo Alto Networks PAN-OS 软件中的一个身份验证绕过漏洞。未经身份验证的攻击者通过网络访问管理 Web 界面，可以利用此漏洞获得 PAN-OS 管理员权限，从而执行管理操作、篡改配置或利用其他已通过身份验证的权限提升漏洞（如 CVE-2024-9474）。

**漏洞利用方式：**

1.  攻击者发送特制的 HTTP 请求到目标 PAN-OS 设备的管理 Web 界面。
2.  该请求利用身份验证绕过漏洞，使攻击者无需有效凭据即可获得管理员权限。
3.  获得管理员权限后，攻击者可以执行任意命令，读取敏感信息，修改设备配置，甚至可能通过其他漏洞进一步入侵系统。

根据提供的漏洞利用代码 `exploit.py`，该 PoC 包含两种模式：扫描模式和利用模式。

*   **扫描模式：** 用于批量扫描目标 URL，检测是否存在 CVE-2024-0012 漏洞。它向 `/php/ztp_gate.php/.js.map` 发送 GET 请求，如果状态码为 200 且响应中包含 "Zero Touch Provisioning"，则判定存在漏洞。
*   **利用模式：** 允许攻击者在目标系统上执行任意命令。它通过向 `/php/utils/createRemoteAppwebSession.php/peppa.js.map` 发送 POST 请求，并在 `user` 参数中注入命令。然后，它尝试提取 `PHPSESSID`，并利用此会话 ID 访问受保护的页面。命令输出会被写入`/var/appweb/htdocs/unauth/{output_name}`，然后通过 GET 请求 `/unauth/{output_name}` 检索。

**有效性：**

根据搜索引擎结果，该漏洞已被积极利用，并且存在公开可用的 PoC，所以该 POC 代码具有有效性。

**投毒风险：**

该PoC代码中存在一定的投毒风险，主要体现在以下几个方面：

*   **命令注入：** 利用模式允许执行任意命令，这意味着如果攻击者使用该 PoC 对目标系统进行攻击，他们可以安装后门、植入恶意软件，或进行其他恶意活动。
*   **未经验证的 PoC：** README.md 文件明确指出 “Untested POC”，这意味着代码可能存在未知的错误或缺陷，可能导致目标系统不稳定或崩溃。
*   **随机文件名：**PoC代码使用随机文件名存储命令输出，虽然在一定程度上防止了文件名冲突，但也可能被攻击者滥用，例如，通过生成大量随机文件来耗尽磁盘空间。

综合考虑，该 PoC 存在一定的投毒风险，大约占比 10%。用户应谨慎使用，并充分了解其潜在风险。

**修复建议：**

*   升级到 PAN-OS 10.2.12-h2, PAN-OS 11.0.6-h1, PAN-OS 11.1.5-h1, PAN-OS 11.2.4-h1 或更高版本。
*   限制对管理 Web 界面的访问，仅允许受信任的内部 IP 地址访问。
*   如果启用了威胁防御订阅，请启用并配置相关的威胁 ID (95746, 95747, 95752, 95753, 95759, 和 95763) 以阻止利用此漏洞的攻击。

**项目地址:** [VegetableLasagne/CVE-2024-0012](https://github.com/VegetableLasagne/CVE-2024-0012)

**漏洞详情:** [CVE-2024-0012](https://nvd.nist.gov/vuln/detail/CVE-2024-0012)