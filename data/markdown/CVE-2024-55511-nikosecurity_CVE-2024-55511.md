## CVE-2024-55511-Macrium Reflect-空指针解引用

**漏洞编号:** CVE-2024-55511

**漏洞类型:** 空指针解引用

**影响应用:** Macrium Reflect

**危害等级:** 高危，可能导致系统崩溃或权限提升

**影响版本:** < 8.1.8017

**利用条件:** 本地权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-55511 是 Macrium Reflect 8.1.8017 之前的版本中存在的空指针解引用漏洞。攻击者可以通过执行特制的恶意可执行文件来触发该漏洞，导致系统崩溃或潜在的权限提升。

**利用方式：**

1.  **漏洞原理：** 该漏洞发生在驱动程序处理 IRP_MJ_CLOSE 请求时。当关闭设备句柄时，驱动程序中的代码尝试解引用一个空指针，导致系统崩溃或权限提升。
2.  **POC 代码分析：**
    *   **`NtAllocateVirtualMemory` 调用：** POC 代码首先使用 `NtAllocateVirtualMemory` 系统调用在地址 `(void*)1` 处分配一个 NULL 页。这样做是为了确保稍后尝试解引用 NULL 指针时，可以控制该地址的内容。
    *   **Payload 注入：**  将shellcode 注入到申请的内存中, 并且填充NULL页，保证NULL指针解引用后能执行shellcode.
    *   **获取设备句柄：** 使用 `CreateFileA` 函数打开 `\\.\GLOBALROOT\Device\MRCBT` 设备，获得 Macrium Reflect 驱动程序的句柄。
    *   **触发漏洞：** 通过 `CloseHandle` 函数关闭驱动程序句柄，触发 IRP_MJ_CLOSE 请求，从而导致驱动程序中出现空指针解引用。
    *   **提权操作:** Shellcode启动一个高权限cmd.exe

**有效性：**

提供的 POC 代码似乎有效，因为它利用了空指针解引用漏洞，并且根据 CVE 描述和搜索引擎结果，可以导致系统崩溃或权限提升。漏洞库信息和搜索结果都指向了该漏洞的存在和影响。

**投毒风险：**

POC 代码主要功能是利用漏洞，提升权限打开一个cmd窗口。 代码中，虽然涉及内存操作和 shellcode 执行，但未发现明显的恶意代码或后门。代码本身是为了演示漏洞利用，不是病毒或者后门。但是依旧存在一定的风险，主要体现在以下几个方面：

*   **依赖性：** 该利用程序依赖于特定的 Windows 版本和 Macrium Reflect 驱动程序的版本。如果目标系统不满足这些条件，则该利用程序可能无法正常工作，或者可能导致意外的副作用。
*   **滥用风险：** 该漏洞利用代码可以被恶意行为者使用来攻击易受攻击的系统。因此，重要的是负责任地使用该代码，并且仅用于测试和研究目的。
*   **Payload 修改风险：** 代码中的 `g_pPayload`  可以被替换为更具恶意的 payload，例如植入后门或执行其他恶意操作。

综合考虑，判定该仓库存在作者隐藏的投毒代码的风险较低，约为 10%。主要风险在于代码本身可能被滥用或修改。


**项目地址:** [nikosecurity/CVE-2024-55511](https://github.com/nikosecurity/CVE-2024-55511)

**漏洞详情:** [CVE-2024-55511](https://nvd.nist.gov/vuln/detail/CVE-2024-55511)