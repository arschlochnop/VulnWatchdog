## CVE-2024-32830-BuddyForms-路径遍历和SSRF

**漏洞编号:** CVE-2024-32830

**漏洞类型:** 路径遍历和SSRF

**影响应用:** BuddyForms

**危害等级:** 高危，可能导致敏感文件读取和服务器端请求伪造

**影响版本:** <= 2.8.8

**利用条件:** 需要安装并启用BuddyForms插件，并允许未经验证的用户访问。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-32830是ThemeKraft BuddyForms插件中的一个路径遍历漏洞，该漏洞允许攻击者读取服务器上的任意文件，并执行服务器端请求伪造(SSRF)攻击。

**有效性:**

根据提供的漏洞信息、搜索结果和漏洞利用代码，POC代码是有效的。POC代码利用了`php://filter`流的特性，结合`convert.base64-encode`和`convert.iconv.utf-16be.utf-32be`过滤器来绕过`getimagesize`函数的检查，从而读取任意文件。该利用方式符合漏洞描述中的路径遍历特征。

**投毒风险:**

评估POC代码是否存在投毒风险：

*   `LICENSE`文件：标准的MIT许可证，没有恶意代码。
*   `README.md`文件：包含漏洞描述和绕过`getimagesize`的说明，没有恶意代码。
*   `poc.py`文件：Python脚本，用于利用该漏洞，没有发现明显的投毒代码。

对poc.py进行分析: 

1.  该脚本的主要功能是利用BuddyForms插件中的文件读取漏洞。
2.  它构造了一个包含`php://filter`的URL，该URL用于绕过文件类型检查并读取指定文件。
3.  脚本通过POST请求将该URL发送到WordPress的`admin-ajax.php`端点。
4.  脚本接收响应，解码读取的文件内容，并将其打印到控制台或保存到文件中。

该脚本没有发现明显的恶意行为。因此，投毒风险较低，为10%（主要考虑作者是否会在目标服务器上写入恶意文件，执行反弹shell等）。

**利用方式:**

1.  攻击者构造一个包含`php://filter`流的URL，该URL指向要读取的目标文件。
2.  攻击者将构造的URL作为`url`参数发送到BuddyForms插件的`upload_image_from_url`动作。
3.  BuddyForms插件处理该请求时，会尝试从指定的URL下载图像。
4.  由于使用了`php://filter`流，实际读取的是目标文件的内容，而不是图像。
5.  BuddyForms插件返回读取的文件内容，攻击者可以从响应中获取敏感信息。

利用代码中的关键部分包括：

*   `php://filter/convert.base64-encode/convert.iconv.utf-16be.utf-32be/resource=<file here>`：该字符串构造了用于绕过文件类型检查的`php://filter`流。
*   `upload_image_from_url`：BuddyForms插件中处理图像上传的动作。
*   `admin-ajax.php`：WordPress的AJAX处理程序，用于处理插件的AJAX请求。

**项目地址:** [ptrstr/CVE-2024-32830-poc](https://github.com/ptrstr/CVE-2024-32830-poc)

**漏洞详情:** [CVE-2024-32830](https://nvd.nist.gov/vuln/detail/CVE-2024-32830)