## CVE-2023-4911-Glibc-本地权限提升

**漏洞编号:** CVE-2023-4911

**漏洞类型:** 缓冲区溢出

**影响应用:** Glibc

**危害等级:** 高危，可导致本地权限提升

**影响版本:** 2.34 到 2.39 之间 (受影响版本)

**利用条件:** 本地用户，需要目标系统运行受影响的 Glibc 版本，且存在 SUID/SGID 程序。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-4911 是 Glibc 动态链接器 ld.so 中的一个缓冲区溢出漏洞，由处理 GLIBC_TUNABLES 环境变量时发生。攻击者可以通过设置恶意的 GLIBC_TUNABLES 环境变量，在运行具有 SUID/SGID 权限的程序时执行任意代码，从而提升权限。

**漏洞利用分析：**

1.  **漏洞触发：** 漏洞发生在 `ld.so` 加载动态链接库时，解析 `GLIBC_TUNABLES` 环境变量的过程中。当 `GLIBC_TUNABLES` 变量包含过长的配置字符串时，会导致缓冲区溢出。
2.  **利用方式：** PoC 代码通过精心构造 `GLIBC_TUNABLES` 环境变量，覆盖 `ld.so` 内存中的关键数据结构，例如 `link_map` 结构，进而控制程序的执行流程。
3.  **提权原理：** 利用 SUID/SGID 程序以特权身份运行的特性。通过覆盖 `link_map` 结构，攻击者可以修改动态链接器的行为，例如劫持函数调用、修改程序加载路径等，最终执行恶意代码，从而获得与 SUID/SGID 程序相同的权限。
4. **PoC 关键代码分析:**
    * `create-libc.py`: 这个脚本创建了一个修改过的libc.so.6, 在`__libc_start_main`处植入shellcode，这个shellcode的功能是设置gid和uid为0，然后执行shell。
    * `xpl.c`: 这是一个C程序，负责设置环境变量`GLIBC_TUNABLES`，然后执行`/usr/bin/su --help`。
    * `Makefile`: 用于编译exploit，包含debug和test选项。test选项禁用了ASLR，方便调试。

**投毒风险评估：**

  * `create-libc.py`脚本本身存在植入后门的风险，通过修改libc文件达到攻击目的，这种方式会影响其他程序的运行,具有一定的破坏性。但就此仓库而言，修改libc文件是漏洞利用的必要步骤，不能简单地将其判定为恶意投毒。风险比例为5%，主要考虑到攻击者可能会加入额外的恶意行为。

**总结：**

此漏洞利用方式较为直接，通过环境变量触发缓冲区溢出，并覆盖关键数据结构，最终实现权限提升。PoC代码有效，但存在修改系统库文件的行为，具有一定的风险。利用成功需要目标系统存在受影响版本的 Glibc 和 SUID/SGID 程序，并且攻击者需要对动态链接器的内部机制有一定的了解。

**项目地址:** [Diego-AltF4/CVE-2023-4911](https://github.com/Diego-AltF4/CVE-2023-4911)

**漏洞详情:** [CVE-2023-4911](https://nvd.nist.gov/vuln/detail/CVE-2023-4911)