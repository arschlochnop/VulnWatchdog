## CVE-2021-42362-WordPress Popular Posts-任意文件上传

**漏洞编号:** CVE-2021-42362

**漏洞类型:** 任意文件上传

**影响应用:** WordPress Popular Posts

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** <= 5.3.2

**利用条件:** 需要Contributor或以上权限的WordPress用户账户，目标WordPress站点安装了WordPress Popular Posts插件且版本低于等于5.3.2，目标服务器允许HTTPS连接。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

该漏洞存在于WordPress Popular Posts插件的图片上传功能中，由于~/src/Image.php文件对上传文件类型验证不足，具有Contributor或以上权限的攻击者可以上传恶意文件（如包含PHP代码的GIF文件），从而获得远程代码执行的能力。

**利用方式：**
1.  **身份验证：** 首先，攻击者需要拥有一个具有Contributor或更高权限的WordPress帐户。POC代码通过`wp-login.php`端点使用提供的用户名和密码进行身份验证，并保存session。
2.  **获取`wpp-admin-token` 和 `wpp_nonce`:** 插件设置页面包含一个隐藏的`wpp-admin-token`，此token用于后续的请求。同时尝试获取`wpp_nonce`，用于进行ajax验证，如果无法获取，将使用wp_nonce。
3.  **上传恶意文件：** PoC代码首先尝试使用filebin.net服务上传包含PHP Webshell代码的GIF文件。如果成功，则获取上传文件的URL。
4.  **漏洞利用:**  PoC代码**未提供**利用上传文件漏洞的具体利用步骤，代码到获取`wpp_nonce`就结束了。可以推测，需要找到插件中调用该上传图片文件的函数，执行恶意代码。

**有效性评估：**
提供的POC代码能够完成身份验证和`wpp-admin-token` 和 `wpp_nonce`的获取，但缺少最终利用文件上传漏洞的步骤，无法直接实现RCE，但为进一步利用打下了基础。因此，该POC是**部分有效**的，需要补充文件上传后的利用步骤才能实现完整的攻击流程。

**投毒风险评估：**
检查了POC代码，没有发现明显的投毒行为。脚本的主要功能是利用漏洞，而非在目标系统上植入其他恶意代码或修改系统配置。

**结论：**
此漏洞的利用需要攻击者首先通过身份验证，然后利用文件上传漏洞执行恶意代码。提供的PoC代码简化了身份验证和`wpp-admin-token`获取的过程，提高了漏洞利用的效率。  虽然PoC并不完整，但它指出了漏洞利用的关键步骤，有助于安全研究人员理解和修复该漏洞。

**项目地址:** [samiba6/CVE-2021-42362](https://github.com/samiba6/CVE-2021-42362)

**漏洞详情:** [CVE-2021-42362](https://nvd.nist.gov/vuln/detail/CVE-2021-42362)