## CVE-2022-0944-SQLPad-模板注入导致RCE

**漏洞编号:** CVE-2022-0944

**漏洞类型:** 模板注入导致RCE

**影响应用:** SQLPad

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** < 6.10.1

**利用条件:** 需要高权限用户才能利用

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-0944是SQLPad版本低于6.10.1中存在的一个模板注入漏洞。该漏洞位于connection test endpoint。攻击者可以利用该漏洞在服务器上执行任意代码。根据漏洞描述和提供的POC代码，利用方式如下：

1.  **漏洞原理：** SQLPad在测试数据库连接时，没有充分过滤用户提供的数据库配置信息，导致攻击者可以在数据库配置（例如数据库名称）中使用模板引擎的语法。
2.  **攻击步骤：**
    *   攻击者需要具有高权限才能访问connection test endpoint。
    *   攻击者构造包含恶意代码的payload。该payload利用`process.mainModule.require('child_process').exec()`来执行系统命令。POC中使用反向shell作为例子。
    *   攻击者将构造好的payload插入到数据库连接配置的`database`字段中，并发送到`/api/test-connection`接口。
    *   服务器在测试连接时，会解析payload中的模板代码，从而执行攻击者指定的系统命令，实现远程代码执行。
3.  **POC有效性：** 提供的POC代码利用python脚本自动化了上述攻击过程，通过发送精心构造的POST请求，可以触发漏洞并获得反向shell。根据代码逻辑和漏洞描述，该POC代码是有效的。
4.  **投毒风险：** 代码的`README.md`中声明仅用于教育目的，并免责。代码本身主要功能是发送包含恶意payload的HTTP请求，并在本地监听端口接收反向shell。虽然代码主要功能是漏洞利用，但仍然存在一些潜在的投毒风险：
    *   **Netcat依赖：** POC依赖于系统安装`netcat`，如果目标系统没有`netcat`，漏洞利用会失败。但是，如果攻击者修改了脚本，将反向shell的方式修改为使用python或其他目标系统更可能存在的工具，可能会增加攻击成功率。
    *   **隐蔽后门：** 理论上，脚本可以被修改为在受害者机器上安装持久性后门，例如添加计划任务或者修改启动脚本，但当前的脚本未发现此类行为。
    *   **依赖风险：** 脚本依赖于`requests`库。如果攻击者修改了`requirements.txt`文件，添加恶意的依赖包，可能导致用户安装恶意库。
    *   **安全声明免责：**虽然声明了免责条款，但是仍要小心使用，务必在授权的渗透测试场景中使用。
    *   综合评估，由于POC的主要功能是RCE利用，且代码相对简单，隐藏恶意代码的难度较高。因此投毒风险较低，估计在5%左右。

**项目地址:** [Robocopsita/CVE-2022-0944_RCE_POC](https://github.com/Robocopsita/CVE-2022-0944_RCE_POC)

**漏洞详情:** [CVE-2022-0944](https://nvd.nist.gov/vuln/detail/CVE-2022-0944)