## CVE-2024-28752-Apache CXF-SSRF

**漏洞编号:** CVE-2024-28752

**漏洞类型:** SSRF

**影响应用:** Apache CXF

**危害等级:** 高危，可能导致敏感信息泄露，内网扫描，甚至在某些情况下可以进行远程代码执行（取决于内网环境和可访问的资源）。

**影响版本:** Apache CXF < 4.0.4, 3.6.3, 3.5.8 (使用Aegis DataBinding)

**利用条件:** 目标Web Service使用Apache CXF且使用Aegis DataBinding，且存在至少一个参数的webservice接口。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-28752是Apache CXF中Aegis DataBinding组件的一个SSRF漏洞。攻击者可以通过构造恶意的SOAP消息，利用`xop:Include`标签，指定`href`属性为恶意URL（例如`file:///etc/hosts`或内网地址）来发起SSRF攻击。

**漏洞利用方式：**

1.  攻击者发送包含恶意`xop:Include`标签的SOAP请求到存在漏洞的Web Service接口。
2.  Apache CXF解析SOAP消息，使用Aegis DataBinding处理请求。
3.  `MTOMDecorator`类解析`xop:Include`标签，从`href`属性获取URL。
4.  `JAXBAttachmentUnmarshaller`处理URL，创建`URLDataSource`，发起HTTP请求或读取本地文件。
5.  服务器将请求结果返回给攻击者，从而实现SSRF。

**有效性：**

根据提供的漏洞信息和POC代码，该漏洞利用是有效的。POC代码提供了一个可行的利用方法，并通过BurpSuite演示了如何利用该漏洞读取本地文件 `/etc/hosts`。

**投毒风险：**

该POC代码主要目的是验证SSRF漏洞，并读取`/etc/hosts`文件。代码本身相对简单，主要依赖于构造恶意的SOAP请求。分析`ServerStarter.java`文件，只是为了启动一个webservice服务，方便进行本地漏洞调试。`asserts/burp.png`只是一个截图。

潜在的投毒风险在于：

*   虽然POC代码本身没有明显的恶意代码，但攻击者可能修改POC代码，添加额外的功能，例如反弹shell或执行其他恶意操作。但从目前提供的代码来看，这种风险较低。
*   在实际环境中部署和运行webservice时，如果没有进行充分的安全审查，可能会引入其他安全漏洞，导致更严重的后果。

总的来说，该POC的投毒风险较低，大约为5%。风险主要来自于对POC代码的潜在修改和不安全的部署配置。

**修复建议：**

*   升级Apache CXF到4.0.4, 3.6.3或3.5.8之后的版本。
*   如果无法升级，可以考虑禁用Aegis DataBinding，使用其他DataBinding方式。

**项目地址:** [ReaJason/CVE-2024-28752](https://github.com/ReaJason/CVE-2024-28752)

**漏洞详情:** [CVE-2024-28752](https://nvd.nist.gov/vuln/detail/CVE-2024-28752)