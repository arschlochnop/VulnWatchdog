## CVE-2023-46818-ISPConfig-PHP代码注入

**漏洞编号:** CVE-2023-46818

**漏洞类型:** PHP代码注入

**影响应用:** ISPConfig

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** <= 3.2.11

**利用条件:** 需要admin_allow_langedit开启，需要管理员权限

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-46818是ISPConfig 3.2.11版本及之前版本中存在的一个PHP代码注入漏洞。该漏洞允许具有管理员权限的用户，在admin_allow_langedit选项启用的情况下，通过语言文件编辑器注入恶意的PHP代码，从而导致远程代码执行。

**有效性:**
根据提供的漏洞信息、搜索结果以及漏洞利用代码，可以判断该POC代码是有效的。搜索结果中存在多个关于此漏洞的讨论和利用代码，漏洞利用代码的README也表明了该漏洞利用的成功性。POC代码通过模拟管理员登录，利用`language_edit.php`的`records[]`字段注入PHP代码，最终写入一个webshell，证明漏洞可以被成功利用。

**投毒风险:**
通过分析POC代码，投毒风险较低。代码主要功能是自动化利用漏洞，注入webshell，方便后续的远程命令执行。主要的风险点在于：

*   **Webshell：** 注入的 webshell (`sh.php`) 允许攻击者执行任意系统命令。这本身就是一种后门，但并非作者有意植入的“投毒”代码，而是漏洞利用的必然结果。
*  **依赖:** POC代码依赖requests库,如果requests库被替换成恶意版本,可能存在投毒风险, 但这个不是POC代码本身的问题.

代码中并没有发现明显的恶意行为，例如上传额外文件、修改系统配置等。因此，投毒风险主要集中在webshell本身，以及程序依赖的外部库，而不是POC代码作者有意添加的恶意代码。
综合评估，投毒风险约为5%。

**利用方式:**
1.  **身份验证:** 首先，攻击者需要拥有ISPConfig的管理员账户的有效凭据。
2.  **登录:** 使用提供的用户名和密码登录到ISPConfig管理面板。
3.  **CSRF绕过:** 获取并利用CSRF token，绕过CSRF保护。
4.  **语言文件编辑:** 访问`language_edit.php`页面，该页面允许管理员编辑语言文件。
5.  **代码注入:** 利用`records[]`参数，注入包含PHP代码的恶意payload。该payload会在服务器上创建一个webshell文件 (`sh.php`)。
6.  **webshell访问:** 攻击者可以通过访问webshell文件，执行任意系统命令。`sh.php` 接收 `C` header，对其进行base64解码后执行。
7.  **命令执行:** 通过修改header的`C`值，从而发送执行任意命令到目标服务器。命令的输出会被封装在`____`标签之间方便解析。
8.  **权限要求:** 利用此漏洞需要admin_allow_langedit开启,普通权限用户无法进行利用.

**项目地址:** [blindma1den/CVE-2023-46818-Exploit](https://github.com/blindma1den/CVE-2023-46818-Exploit)

**漏洞详情:** [CVE-2023-46818](https://nvd.nist.gov/vuln/detail/CVE-2023-46818)