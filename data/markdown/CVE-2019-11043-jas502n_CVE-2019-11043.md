## CVE-2019-11043 PHP-FPM 远程代码执行

**漏洞编号:** CVE-2019-11043

**漏洞类型:** 缓冲区溢出导致远程代码执行

**影响应用:** PHP-FPM (搭配 Nginx)

**危害等级:** 高危，可导致远程代码执行，控制服务器

**影响版本:** PHP 7.1.x (< 7.1.33), 7.2.x (< 7.2.24), 7.3.x (< 7.3.11)

**利用条件:** Nginx 作为前端，将请求传递给 PHP-FPM 处理；Nginx 配置不当，未对请求的文件进行有效性检查（如`try_files $uri =404`）；目标使用了受影响的 PHP 版本。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-11043 存在于 PHP-FPM 中，当与 Nginx 配合使用时，不正确的配置会导致缓冲区下溢，从而允许远程代码执行。攻击者可以构造特定的请求，利用 env_path_info 的处理缺陷，导致 FPM 模块将数据写入为 FCGI 协议数据保留的空间之外，造成内存破坏，最终执行任意代码。

**有效性评估：**
提供的 POC 代码（`phuip-fpizdam`）是一个已知的、公开可用的漏洞利用工具，专门用于攻击 CVE-2019-11043。从 README.md 可以看出，该工具使用 Go 语言编写，可以直接编译使用，或者使用 Docker 部署测试环境。文档中展示了工具的安装、使用方法和效果，可以验证漏洞的存在，因此 POC 代码有效。

**投毒风险分析：**
该仓库主要包含以下内容：
1.  `phuip-fpizdam` 工具的安装和使用说明。
2.  使用 Docker 搭建漏洞环境的示例。
3.  一个简单的 PHP 脚本（index.php）用于测试。
4.  一个 `php-rce-check.py` 脚本，用于检测目标是否易受攻击。

虽然该仓库本身是为了复现和利用漏洞，但不能完全排除投毒的风险。其中`php-rce-check.py`脚本通过构造特殊请求，检测服务器是否存在漏洞，存在一定风险，可能服务器信息泄露。虽然整体投毒概率较低，但仍应保持警惕，尤其是在生产环境中使用这些代码时。考虑到该漏洞的利用已经有较为成熟的工具，因此恶意作者在其中隐藏恶意代码的可能性相对较小。风险评估占比为10%。

**利用方式：**
1.  **环境准备：**搭建存在漏洞的 PHP-FPM 和 Nginx 环境。
2.  **检测：** 使用 `php-rce-check.py` 脚本或 `phuip-fpizdam` 工具的 `--only-qsl` 选项检测目标是否易受攻击。
3.  **利用：** 如果目标存在漏洞，使用 `phuip-fpizdam` 工具发送特制的 HTTP 请求，利用缓冲区溢出执行任意代码。
4.  **反弹 Shell：** 在成功执行代码后，通常会反弹一个 shell，从而控制服务器。

整个漏洞利用的关键在于构造特殊的请求，触发 PHP-FPM 的缓冲区溢出。

**项目地址:** [jas502n/CVE-2019-11043](https://github.com/jas502n/CVE-2019-11043)

**漏洞详情:** [CVE-2019-11043](https://nvd.nist.gov/vuln/detail/CVE-2019-11043)