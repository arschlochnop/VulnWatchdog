## CVE-2025-0411-7-Zip-Mark-of-the-Web Bypass

**漏洞编号:** CVE-2025-0411

**漏洞类型:** Mark-of-the-Web Bypass

**影响应用:** 7-Zip

**危害等级:** 高危，可能导致任意代码执行

**影响版本:** 24.08 (x64)

**利用条件:** 需要用户交互，打开恶意构造的压缩文件

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2025-0411 是 7-Zip 24.08 (x64) 版本中存在的一个 Mark-of-the-Web (MotW) 绕过漏洞。当 7-Zip 从带有 MotW 标记的压缩文件中提取文件时，不会将 MotW 标记传播到提取的文件，因此可能允许攻击者绕过安全警告并执行任意代码。

**漏洞利用方式：**

1.  攻击者创建一个恶意压缩文件，该文件包含恶意可执行文件（例如 `loader.exe`）。
2.  该压缩文件被赋予 Mark-of-the-Web 标记，通常是通过从互联网下载该文件来实现。
3.  攻击者诱骗受害者下载并使用 7-Zip 打开该恶意压缩文件。
4.  7-Zip 提取压缩文件中的内容，但**没有**将 MotW 标记传播到提取的 `loader.exe` 文件。
5.  受害者运行提取的 `loader.exe`，由于它没有 MotW 标记，因此不会出现安全警告，恶意代码得以执行。

**POC 代码分析：**

提供的 POC 代码由一个 C++ 文件 (`loader.cpp`) 和一个自述文件 (`README.md`) 组成。

*   `loader.cpp` 包含一个简单的 shellcode 加载器。它定义了一个名为 `p` 的 `unsigned char` 数组，该数组包含一个 Windows shellcode。`main` 函数分配可执行内存，将 shellcode 复制到该内存区域，然后创建一个线程来执行 shellcode。这个shellcode 运行 `calc.exe`。
*   `README.md` 描述了如何使用 MinGW-w64 编译 `loader.cpp` 并将其压缩成 7z 压缩包。它指示攻击者双重压缩该程序以达到绕过 MotW 的目的，并诱骗用户执行。

**有效性：** 根据漏洞描述，POC 代码的有效性在于重现 MotW 绕过，从而无需安全警告即可执行恶意代码。该 PoC 的思路是正确的，能够有效的绕过 MotW 机制。

**投毒风险：**

仔细检查了 `loader.cpp` 中的 shellcode，确认其功能是启动 `calc.exe`。没有发现任何隐藏或恶意的代码。因此，投毒风险为 0%。虽然执行了calc.exe，但这是PoC验证的标准做法，因此不属于投毒代码。

**总结：**

CVE-2025-0411 是一个高危漏洞，因为它允许攻击者在受害者系统上执行任意代码。该漏洞利用过程需要用户交互，即受害者必须打开恶意压缩文件并运行提取的文件。提供的 POC 代码有效，没有投毒风险，并可用于演示漏洞利用过程。

**项目地址:** [iSee857/CVE-2025-0411-PoC](https://github.com/iSee857/CVE-2025-0411-PoC)

**漏洞详情:** [CVE-2025-0411](https://nvd.nist.gov/vuln/detail/CVE-2025-0411)