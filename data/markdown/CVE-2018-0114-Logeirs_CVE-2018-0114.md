## CVE-2018-0114-Node-jose-JWT签名伪造

**漏洞编号:** CVE-2018-0114

**漏洞类型:** JWT签名伪造

**影响应用:** Node-jose Library

**危害等级:** 高危，允许未授权的远程攻击者使用嵌入在token中的密钥重新签名token，从而伪造JWT。

**影响版本:** < 0.11.0

**利用条件:** 需要目标应用使用存在漏洞的node-jose库，且JWT验证逻辑信任header中的jwk。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2018-0114 允许攻击者通过在JWT的header中嵌入包含攻击者公钥的JWK (JSON Web Key)，然后使用与该公钥匹配的私钥对篡改后的JWT进行签名，从而绕过JWT的签名验证。

**有效性评估:**

提供的POC代码 `CVE-2018-0114.py` 的确实现了上述攻击过程。它生成RSA密钥对，将公钥嵌入到JWT的header中，然后使用私钥对token进行签名。如果目标应用使用存在漏洞的node-jose库并且信任header中的`jwk`字段，那么攻击者就可以利用这个POC生成有效的伪造JWT。

搜索结果也表明该漏洞确实存在，并且有公开的利用代码和练习。

**投毒风险评估:**

在提供的POC代码中，存在一定的投毒风险的可能性，但可能性较小。代码中与投毒相关的主要风险点在于:

*   **密钥生成:** 代码可以生成新的RSA密钥对，或者从本地文件读取现有密钥对。如果攻击者提供恶意的`pubkey.pem`或`privkey.pem`文件，就可能引入后门。但是如果使用新生成的密钥，则问题不大。
*   **依赖库:** 依赖 `rsa` 等库，如果这些库被篡改，可能存在投毒风险，但这不是此仓库本身的风险，而是外部依赖风险。
*   **`pack_bigint`函数:** 该函数将大整数打包成字节数组。虽然功能上没有直接问题，但如果被恶意修改，可能会导致生成的公钥不正确，从而使攻击无效或者引入其他安全问题。这个风险较低。

综合来看，代码本身没有明显的恶意行为。投毒风险主要存在于外部提供的密钥文件和潜在的第三方库篡改。 因此, 投毒风险评估为 10%.

**利用方式:**

1.  **准备攻击环境:** 准备好存在漏洞版本的node-jose库环境，以及Python环境。
2.  **生成RSA密钥对 (可选):**  如果`pubkey.pem`和`privkey.pem`不存在，POC脚本会自动生成一个新的RSA密钥对。
3.  **构造Payload:** 根据目标应用的需求，构造需要伪造的JWT payload，例如修改用户名或权限。
4.  **运行POC:** 运行POC脚本，将构造的payload作为参数传递给脚本。
5.  **获取伪造的JWT:** POC脚本会生成一个伪造的JWT，其中header包含攻击者的公钥，并且使用攻击者的私钥进行了签名。
6.  **利用伪造的JWT:** 将伪造的JWT发送给目标应用。如果目标应用信任header中的`jwk`，并且使用攻击者的公钥验证签名，那么攻击者就可以成功绕过身份验证。


**项目地址:** [Logeirs/CVE-2018-0114](https://github.com/Logeirs/CVE-2018-0114)

**漏洞详情:** [CVE-2018-0114](https://nvd.nist.gov/vuln/detail/CVE-2018-0114)