## CVE-2023-32233-Linux Kernel Netfilter nf_tables Use-After-Free

**漏洞编号:** CVE-2023-32233

**漏洞类型:** Use-After-Free

**影响应用:** Linux Kernel Netfilter nf_tables

**危害等级:** 高危，可导致权限提升至root

**影响版本:** <= 6.3.1

**利用条件:** 本地用户权限

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2023-32233是一个Linux内核Netfilter nf_tables子系统中的使用后释放漏洞。该漏洞发生在处理批量请求更新nf_tables配置时。未经授权的本地用户可以利用此漏洞获取root权限。

**有效性：**
根据漏洞库信息、搜索引擎结果和提供的PoC代码，该漏洞的PoC已经公开，并且多个来源（如NVD, RedHat, Tarlogic等）确认该漏洞存在且允许本地权限提升。因此，提供的PoC代码**有效**。

**投毒风险：**
提供的代码片段是漏洞原理的描述，以及利用方法。 仓库中的`ORIGIN.md`文件只描述了漏洞的触发原理和利用思路。PoC本身旨在展示漏洞的可利用性，而非恶意行为。但任何漏洞利用代码都存在被恶意修改和利用的可能性。鉴于代码片段的分析结果，可以初步认为投毒的可能性很低，估计为**1%**。需要检查完整的PoC代码以完全排除投毒风险。 此处假定提供的 ORIGIN.md 就是完整代码， 实际情况需要查看完整代码。

**利用方式：**
利用方式如下：
1.  漏洞存在于Netfilter nf_tables处理批量请求时，当删除规则（`NFT_MSG_DELRULE`）隐式删除匿名集合（`nft_set`）后，又尝试删除该集合中的元素（`NFT_MSG_DELSETELEM`），导致使用后释放。
2.  攻击者首先创建一个包含lookup表达式和匿名集合的nft_rule。
3.  然后，攻击者发送一个包含两个操作的批量请求：删除nft_rule（这将隐式删除匿名集合），然后删除该集合中的一个元素。
4.  由于nf_tables在删除规则后没有正确处理对集合元素的访问，这会导致使用已释放的内存。
5.  为了提高利用的可靠性，攻击者会尝试通过创建大量集合并删除它们来引入延迟，从而增加在释放内存后重新分配内存的机会，以便控制内存内容。 此外，利用多个CPU核心来竞争，增加漏洞触发的概率。
6. 通过内存布局控制和精心构造的payload，可以利用这个use-after-free漏洞在内核中实现任意读写，从而提升权限。

**项目地址:** [void0red/CVE-2023-32233](https://github.com/void0red/CVE-2023-32233)

**漏洞详情:** [CVE-2023-32233](https://nvd.nist.gov/vuln/detail/CVE-2023-32233)