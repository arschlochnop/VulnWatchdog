## CVE-2024-34102-Adobe Commerce-XXE

**漏洞编号:** CVE-2024-34102

**漏洞类型:** XML 外部实体注入 (XXE)

**影响应用:** Adobe Commerce (Magento)

**危害等级:** 高危，可导致任意文件读取和潜在的远程代码执行

**影响版本:** <= 2.4.4-p8, 2.4.5-p7, 2.4.6-p5, 2.4.7

**利用条件:** 需要网络访问目标Magento实例，且实例存在未修复的XXE漏洞

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-34102 是一个存在于 Adobe Commerce (Magento) 中的 XXE 漏洞。根据漏洞信息，攻击者可以通过发送特制的 XML 文档，引用外部实体来利用此漏洞。此漏洞不需要用户交互。

**有效性：**
提供的PoC代码利用了Magento的`/rest/all/V1/guest-carts/test-assetnote/estimate-shipping-methods` 接口，通过构造包含恶意XML的JSON payload来实现XXE。Payload中定义了外部实体，尝试从目标服务器读取指定文件，并通过HTTP请求将文件内容发送到攻击者控制的`exfil_url`。根据漏洞库信息和搜索结果，确认此漏洞利用方式是可行的，PoC代码是有效的。

**投毒风险：**
代码本身的主要功能是利用XXE漏洞进行文件读取。代码中唯一的网络请求是将读取的文件内容发送到`exfil_url`，这个URL由用户提供。README.md中包含的政治性声明与漏洞利用本身无关，但可能暗示了作者的某种倾向。检查代码后，并未发现明显的恶意代码或后门。但始终需要注意，任何来自外部来源的代码都存在一定的风险，所以投毒风险评估为5%。虽然主要功能是文件读取，但XXE也可能被用于DoS或RCE，具体取决于目标系统的配置。

**利用方式：**
1.  攻击者构造包含恶意XML的JSON payload。
2.  该payload被发送到Magento的`/rest/all/V1/guest-carts/test-assetnote/estimate-shipping-methods`接口。
3.  Magento服务器解析XML时，会尝试解析payload中定义的外部实体。
4.  外部实体指向目标服务器上的文件，Magento服务器会尝试读取该文件。
5.  读取的文件内容通过HTTP请求发送到攻击者指定的`exfil_url`。
6.  攻击者在`exfil_url`上接收并解码文件内容，从而获取目标服务器上的敏感信息，例如`app/etc/env.php`文件，该文件包含Magento的加密密钥，可能导致完全控制。

**项目地址:** [mksundaram69/CVE-2024-34102](https://github.com/mksundaram69/CVE-2024-34102)

**漏洞详情:** [CVE-2024-34102](https://nvd.nist.gov/vuln/detail/CVE-2024-34102)