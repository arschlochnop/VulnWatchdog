## CVE-2018-11776-Apache Struts 远程代码执行

**漏洞编号:** CVE-2018-11776

**漏洞类型:** 远程代码执行

**影响应用:** Apache Struts

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** 2.3 to 2.3.34, 2.5 to 2.5.16

**利用条件:** alwaysSelectFullNamespace 为 true，且存在特定的命名空间配置。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2018-11776 是一个 Apache Struts 2 的远程代码执行漏洞。该漏洞是由于 Struts 框架在处理某些配置时，未对用户提供的命名空间进行充分验证，导致攻击者可以通过构造恶意的 URL，执行任意代码。

**有效性：**

根据漏洞库信息和搜索引擎结果，以及提供的PoC代码，可以确认该漏洞是真实存在的，并且存在可用的PoC。PoC代码通过构造包含 OGNL 表达式的恶意 URL，利用 Struts 框架的漏洞执行任意命令。

**投毒风险：**

PoC 代码本身的主要功能是利用 CVE-2018-11776 漏洞进行远程代码执行。然而，需要注意的是，该 PoC 利用了 Shodan API 进行大规模扫描和漏洞利用，这本身就可能被滥用。虽然作者声明该工具仅供研究用途，并省略了 Shodan 搜索参数以防止恶意使用，但仍然存在以下潜在的投毒风险：

*   **依赖项风险：** 该 PoC 依赖于 `requests` 和 `shodan` 库。如果这些依赖项被恶意篡改，例如通过 PyPI 投毒，可能会引入额外的安全风险。
*   **API 密钥泄露：** 该 PoC 将 Shodan API 密钥存储在 `api.txt` 文件中。如果该文件被意外泄露，攻击者可以使用该密钥进行恶意活动。
*   **大规模扫描风险：** 即使省略了 Shodan 搜索参数，攻击者仍然可以通过修改 PoC 代码来指定目标 IP 地址或 IP 范围，从而进行有针对性的大规模扫描和攻击。
*   **命令执行风险：** PoC 允许执行任意命令，攻击者可以利用该漏洞植入恶意代码、窃取敏感信息或进行其他恶意活动。

因此，该 PoC 存在一定的投毒风险，需要谨慎使用，并确保从可信的来源获取依赖项，并妥善保管 Shodan API 密钥。

综合考虑，该代码存在一定的风险，但是由于代码相对简单,大部分代码为漏洞利用,小部分为API调用,API调用不影响漏洞利用的恶意性,所以投毒风险评分为10%。

**利用方式：**

1.  **漏洞触发：** 当 `alwaysSelectFullNamespace` 设置为 `true`，并且应用程序的命名空间配置不正确时，攻击者可以构造包含 OGNL 表达式的恶意 URL。
2.  **OGNL 表达式注入：** 恶意 URL 中的 OGNL 表达式会被 Struts 框架解析和执行。
3.  **远程代码执行：** 通过 OGNL 表达式，攻击者可以执行任意系统命令，从而控制服务器。

**项目地址:** [649/Apache-Struts-Shodan-Exploit](https://github.com/649/Apache-Struts-Shodan-Exploit)

**漏洞详情:** [CVE-2018-11776](https://nvd.nist.gov/vuln/detail/CVE-2018-11776)