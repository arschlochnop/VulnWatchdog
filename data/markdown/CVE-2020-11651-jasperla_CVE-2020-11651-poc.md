## CVE-2020-11651 - SaltStack 认证绕过漏洞

**漏洞编号:** CVE-2020-11651

**漏洞类型:** 认证绕过

**影响应用:** SaltStack Salt

**危害等级:** 高危，可导致远程代码执行和敏感信息泄露

**影响版本:** 2019.2.4之前，3000.2之前

**利用条件:** 目标Salt Master服务可访问，且未进行漏洞修复

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2020-11651 漏洞是 SaltStack Salt 在 2019.2.4 和 3000.2 之前的版本中发现的认证绕过漏洞。Salt-master 进程中的 ClearFuncs 类没有正确验证方法调用，导致未经身份验证的远程用户可以访问某些方法，进而检索 salt master 的用户令牌和/或在 salt minions 上执行任意命令。

**有效性评估：**

根据漏洞库信息、搜索结果和提供的漏洞利用代码，可以确认该漏洞的POC代码有效。搜索结果中多个链接指向了漏洞的详细描述和利用方式，甚至有专门的POC代码仓库。

**投毒风险评估：**

分析提供的漏洞利用代码，主要功能是:
1.  获取 Salt Master 的 root key。
2.  在 Salt Master 上执行任意命令。
3.  在所有连接的 Minions 上执行任意命令。
4.  读取任意文件。
5.  上传文件。

代码结构清晰，功能与描述一致，未发现明显的恶意代码。虽然代码本身具有高危操作（例如远程代码执行），但这是漏洞利用本身固有的风险，而非作者植入的后门或恶意代码。

**利用方式：**

1.  **利用未授权访问：** 攻击者利用 ClearFuncs 类中未进行充分验证的方法调用，绕过身份验证。
2.  **获取 Root Key：** 获取 Salt Master 的 root key，为后续操作铺平道路。
3.  **远程代码执行：** 在 Salt Master 或连接的 Minions 上执行任意命令。这可以用于植入后门、收集敏感信息或进行其他恶意活动。
4.  **文件读取：** 读取 Salt Master 上的任意文件，可能泄露敏感配置信息、用户密码等。
5.  **文件上传：** 上传恶意文件到 Salt Master，例如修改 crontab 文件，实现持久化控制。

综上所述，该 POC 代码的投毒风险极低，约为1%，主要风险在于漏洞利用本身带来的危害。

**项目地址:** [jasperla/CVE-2020-11651-poc](https://github.com/jasperla/CVE-2020-11651-poc)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)