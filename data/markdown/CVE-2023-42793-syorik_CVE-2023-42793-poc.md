## CVE-2023-42793-JetBrains TeamCity-RCE

**漏洞编号:** CVE-2023-42793

**漏洞类型:** 远程代码执行

**影响应用:** JetBrains TeamCity

**危害等级:** 严重，未授权远程代码执行

**影响版本:** < 2023.05.4

**利用条件:** TeamCity服务器可网络访问

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

该漏洞是JetBrains TeamCity中的一个身份验证绕过漏洞，攻击者可以在未经身份验证的情况下，通过利用REST API创建一个新的RPC令牌，然后使用该令牌启用调试模式，最终执行任意命令。根据提供的POC代码，利用过程如下：

1.  **身份验证绕过:**  POC代码首先尝试使用 `Authenticate` 函数通过 `userLocator` (例如 `id:1`) 创建一个名为 `RPC2` 的新的认证token。由于漏洞的存在，这步无需认证即可完成。
2.  **启用Debug模式:**  利用获得的认证token，POC代码尝试启用TeamCity服务器的Debug模式。通过POST请求修改`internal.properties`文件，设置`rest.debug.processes.enable=true`，从而允许执行任意进程。
3.  **命令执行:**  在启用Debug模式后，POC代码可以使用获得的认证token，调用`/app/rest/debug/processes`接口执行任意命令，并通过参数`exePath`指定要执行的命令和`params`参数传递命令参数。例如，POC中执行了 `ls -al` 命令。

**有效性评估：**
根据漏洞描述和POC代码，该漏洞利用链有效。POC 代码实现了利用该漏洞的完整流程。

**投毒风险评估：**
仔细检查提供的POC代码，没有发现任何作者隐藏的恶意代码或后门。该POC代码完全是为了利用CVE-2023-42793漏洞而设计的。它依赖于TeamCity服务器自身的漏洞来执行代码。

**利用方式总结：**
该漏洞利用方式是未授权的远程代码执行。利用REST API接口的身份验证绕过，允许未经身份验证的攻击者在TeamCity服务器上执行任意代码。攻击者首先绕过身份验证获取一个临时的token，然后通过这个token开启debug模式，最后通过debug模式的接口执行任意命令。

**项目地址:** [syorik/CVE-2023-42793-poc](https://github.com/syorik/CVE-2023-42793-poc)

**漏洞详情:** [CVE-2023-42793](https://nvd.nist.gov/vuln/detail/CVE-2023-42793)