## CVE-2022-26049 - Goomph Zip Slip 漏洞

**漏洞编号:** CVE-2022-26049

**漏洞类型:** Zip Slip (任意文件写入)

**影响应用:** com.diffplug.gradle:goomph

**危害等级:** 中危，可能导致任意文件写入，覆盖文件，最终可能导致远程代码执行。

**影响版本:** < 3.37.2

**利用条件:** 需要能够提供恶意构造的ZIP文件，并使目标系统使用受影响版本的Goomph处理该ZIP文件。

**POC 可用性:** 是 (理论上可行，需要构造恶意ZIP文件)

**投毒风险:** 10%

## 详情

CVE-2022-26049 存在于 com.diffplug.gradle:goomph 组件的 3.37.2 之前的版本中。该漏洞是典型的 Zip Slip 漏洞，攻击者可以构造恶意的 ZIP 压缩包，其中包含的文件路径包含 `../` 这样的目录穿越符。当 Goomph 使用存在漏洞的版本解压此压缩包时，恶意文件会被写入到预期目录之外的任意位置，覆盖系统文件。如果攻击者覆盖了关键的系统文件或者可执行文件，可能导致远程代码执行。

**漏洞利用方式：**

1.  攻击者构造一个恶意的 ZIP 文件，其中包含的文件名包含目录穿越符（例如 `../../../tmp/evil.sh`）。
2.  攻击者诱导或者强迫目标系统使用存在漏洞的 Goomph 版本来解压这个 ZIP 文件。
3.  Goomph 在解压时，由于没有正确校验文件名，会将 `evil.sh` 写入到 `/tmp/` 目录下，而不是预期的解压目录下。
4.  如果攻击者覆盖了系统中的某个关键文件，或者写入了一个可执行脚本并设法执行它，则可能实现远程代码执行。

**投毒风险分析：**

提供的“漏洞利用代码”实际上是 Goomph 的变更日志，用于记录不同版本之间的改动，**不包含可执行代码**。因此，直接从这个代码片段无法判断是否存在投毒代码。但从github commit 记录判断风险较低。

**投毒风险存在，分析如下：**

1.  **依赖库投毒：** Goomph 本身依赖于其他的库。攻击者可能通过供应链攻击，向 Goomph 依赖的库中注入恶意代码，从而间接影响 Goomph。检查 Goomph 的依赖项以及这些依赖项的安全性是必要的。
2.  **恶意开发者：** 如果 Goomph 的开发者账号被盗，或者有内部恶意开发者，则可能直接在 Goomph 的代码中添加恶意代码。这通常很难检测。
3.  **构建过程投毒：** 如果 Goomph 的构建环境被入侵，则可能在构建过程中向最终的 Goomph 软件包中添加恶意代码。这需要确保构建环境的安全性。

由于无法直接分析实际的可执行代码，因此只能给出投毒风险的预估比例，这里保守估计为 10%。主要是考虑到开源项目的透明性以及潜在的供应链攻击风险。

**项目地址:** [shoucheng3/diffplug__goomph_CVE-2022-26049_3-37-1](https://github.com/shoucheng3/diffplug__goomph_CVE-2022-26049_3-37-1)

**漏洞详情:** [CVE-2022-26049](https://nvd.nist.gov/vuln/detail/CVE-2022-26049)