## CVE-2018-6789 Exim base64d 缓冲区溢出漏洞

**漏洞编号:** CVE-2018-6789

**漏洞类型:** 缓冲区溢出

**影响应用:** Exim

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Exim 4.90.1之前

**利用条件:** 需要目标Exim服务器开启SMTP监听，且版本低于4.90.1

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

该漏洞存在于Exim的base64d函数中。攻击者可以通过发送特制的base64编码消息，导致缓冲区溢出，从而实现远程代码执行。

**有效性：**
根据漏洞库信息和搜索结果，该漏洞确实存在，并且有公开的PoC。提供的PoC代码包含 connect_target(), write_line(), read_line(), off_by_one()函数，用于连接目标，发送特制的base64编码消息，触发漏洞。
从Makefile和README.md文件可以看出这是一个PoC资料，用于验证CVE-2018-6789。

**投毒风险：**
通过对PoC代码进行分析，没有发现明显的投毒代码。
代码中定义了一个shellcode，该shellcode通过`${run{...}}`语法执行反向连接，但这是漏洞利用的一部分，而非恶意投毒。代码逻辑较为清晰，主要是构造溢出和执行payload，未发现隐藏的恶意行为。因此，投毒风险评估为0%。

**利用方式：**
1.  **连接目标Exim服务器：** PoC代码首先通过`connect_target()`函数连接到目标Exim服务器的SMTP端口。
2.  **发送SMTP命令：**  利用`write_line()`和`read_line()`函数与服务器进行SMTP协议交互。
3.  **触发缓冲区溢出：**  关键在于`off_by_one()`函数。该函数构造一个特定的base64编码字符串，利用Exim的base64解码函数中的一个字节溢出漏洞。通过精心计算的偏移量和目标字节，覆盖内存中的重要数据，例如`acl_pointer`。
4.  **远程代码执行：**  通过覆盖`acl_pointer`，攻击者可以控制Exim的访问控制列表处理流程，执行预定义的shellcode。这个shellcode通常用于反向连接到攻击者的服务器，从而获得一个shell。

**总结：**
该漏洞利用的有效性较高，因为有公开的PoC，并且EXP也是较为成熟的，可以直接进行复现。 投毒风险较低，因为PoC代码相对简单，易于审查。漏洞利用方式涉及精心构造的base64编码消息，需要对Exim的内存管理和访问控制机制有一定的了解。

**项目地址:** [synacktiv/Exim-CVE-2018-6789](https://github.com/synacktiv/Exim-CVE-2018-6789)

**漏洞详情:** [CVE-2018-6789](https://nvd.nist.gov/vuln/detail/CVE-2018-6789)