## CVE-2021-43798-Grafana目录遍历

**漏洞编号:** CVE-2021-43798

**漏洞类型:** 目录遍历

**影响应用:** Grafana

**危害等级:** 高危，可能导致敏感信息泄露

**影响版本:** 8.0.0-beta1 到 8.3.0（除已修补版本外）

**利用条件:** 需要网络访问，Grafana实例运行在受影响版本范围内。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-43798 是 Grafana 中的一个目录遍历漏洞，允许未经身份验证的攻击者读取服务器上的任意文件。漏洞存在于处理插件路径的逻辑中。攻击者可以通过构造包含目录遍历序列（例如 `../`）的 URL，访问 `/public/plugins/<plugin_id>/` 之外的文件。

**有效性分析：**

提供的 Python 脚本 `GrafanaDirectoryScanner.py` 旨在利用此漏洞。它通过尝试一系列包含目录遍历序列的 URL 来扫描目标 Grafana 实例，以查找指定的文件（默认为 `/etc/passwd`）。如果脚本成功地从目标服务器检索到文件，它将打印响应的状态、标头和内容。根据漏洞描述和提供的代码，此PoC应该是有效的。

**投毒风险分析：**

查看提供的 `GrafanaDirectoryScanner.py` 脚本和 `README.md` 文件，没有发现任何可疑或恶意代码。脚本仅发送 HTTP 请求并打印响应。`README.md` 文件仅包含漏洞描述和脚本的使用说明。因此，投毒风险评估为 0%。

**漏洞利用方式：**

1.  确定目标 Grafana 实例的版本是否在受影响范围内（8.0.0-beta1 到 8.3.0，不包括已修补版本）。
2.  找到目标 Grafana 实例上已安装的插件 ID。任何插件 ID 都适用，因为漏洞不在于特定插件，而在于通用的路径处理逻辑。
3.  构造包含目录遍历序列和目标文件路径的 URL，例如：`http://<grafana_host_url>/public/plugins/<plugin_id>/../../../../../../etc/passwd`。
4.  发送构造的 URL 到目标 Grafana 实例。
5.  如果漏洞存在且利用成功，服务器将返回目标文件的内容。

**POC利用:**
1. 运行脚本 `python GrafanaDirectoryScanner.py -d <grafana_host_ip> -p <grafana_host_port> -f /etc/passwd` 
2. 替换 `<grafana_host_ip>` 和 `<grafana_host_port>`为目标 grafana 实例的ip和端口

**项目地址:** [FAOG99/GrafanaDirectoryScanner](https://github.com/FAOG99/GrafanaDirectoryScanner)

**漏洞详情:** [CVE-2021-43798](https://nvd.nist.gov/vuln/detail/CVE-2021-43798)