## CVE-2022-21661-WordPress-SQL注入

**漏洞编号:** CVE-2022-21661

**漏洞类型:** SQL注入

**影响应用:** WordPress

**危害等级:** 高危，可能导致数据泄露和远程代码执行

**影响版本:** < 5.8.3

**利用条件:** 需要目标WordPress站点开启`wp-admin/admin-ajax.php`接口，且攻击者能构造包含恶意SQL的请求。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-21661是WordPress 5.8.3之前的版本中存在的一个SQL注入漏洞。该漏洞源于`WP_Query`类中对用户输入的不当清理，导致攻击者可以通过构造恶意的`tax_query`参数，向`wp-admin/admin-ajax.php`发送包含恶意SQL语句的POST请求，从而执行任意SQL查询。

**有效性分析：**
根据漏洞库信息和搜索引擎结果，该漏洞是真实存在的，并且有公开的POC代码可用。POC代码中提供的示例请求显示了如何构造包含恶意SQL语句的POST请求，通过`query_vars`参数中的`tax_query`子参数，可以注入SQL语句。

**投毒风险分析：**
查看提供的POC代码文件，主要包含以下内容：
*   `README.md`: 包含POC视频的链接和漏洞描述
*   `/POC/Video/APTIRAN`: 包含APT IRAN Research Center的联系方式
*   `/Exploit/50663.txt`: 包含漏洞的详细信息、利用方法和示例请求

经过分析，这些文件主要提供漏洞信息和利用方法，未发现明显的恶意代码或后门。风险点在于，该POC由APTIRAN发布，可能存在作者植入隐蔽后门的风险，例如在视频链接或联系方式中隐藏恶意链接或脚本。结合github上投毒事件频发，对第三方来源的工具，特别是来自安全研究团队的工具，应保持谨慎。因此，我判断此仓库中存在作者隐藏的投毒代码的风险较低，约为5%。

**利用方式分析：**
1.  攻击者需要找到一个未升级到5.8.3或更高版本的WordPress站点。
2.  攻击者构造一个POST请求，发送到`wp-admin/admin-ajax.php`。
3.  在POST请求的`query_vars`参数中，使用`tax_query`子参数，并注入恶意的SQL语句。
4.  服务器接收到请求后，由于`WP_Query`类对输入没有进行充分的清理，导致恶意的SQL语句被执行。
5.  攻击者可以通过SQL注入漏洞，获取数据库中的敏感信息，甚至可以执行任意SQL命令，导致服务器被完全控制。


**项目地址:** [safe3s/CVE-2022-21661](https://github.com/safe3s/CVE-2022-21661)

**漏洞详情:** [CVE-2022-21661](https://nvd.nist.gov/vuln/detail/CVE-2022-21661)