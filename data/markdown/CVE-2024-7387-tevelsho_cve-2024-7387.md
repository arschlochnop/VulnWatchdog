## CVE-2024-7387-Openshift/builder-命令注入

**漏洞编号:** CVE-2024-7387

**漏洞类型:** 命令注入

**影响应用:** Openshift/builder

**危害等级:** 高危，可能导致权限提升和节点接管

**影响版本:** 受影响版本见漏洞描述

**利用条件:** 需要具有高权限用户权限，并且使用Docker构建策略

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-7387 存在于 Openshift/builder 中。该漏洞允许通过路径遍历进行命令注入。当使用“Docker”策略时，恶意用户可以利用`BuildConfig`定义的`spec.source.secrets.secret.destinationDir`属性覆盖特权构建容器内的可执行文件，从而在运行 builder 容器的 OpenShift 节点上执行任意命令。攻击者需要具有足够的权限来修改 BuildConfig，并利用此漏洞将恶意代码注入到构建过程中，最终导致权限提升，控制整个节点。

**漏洞利用方式：**

1.  攻击者需要具有修改 `BuildConfig` 的权限。
2.  攻击者在 `BuildConfig` 中，利用 `spec.source.secrets.secret.destinationDir` 属性指定一个包含恶意代码的 Secret，并将该 Secret 的内容解压到构建容器内的敏感目录，覆盖原有的可执行文件。
3.  当构建容器执行被覆盖的可执行文件时，恶意代码将被执行，从而实现命令注入。

**POC有效性：**
提供的Dockerfile本身无法直接利用此漏洞。漏洞利用需要结合恶意构造的BuildConfig。该Dockerfile只是简单的文件拷贝和目录查看，本身不具备利用漏洞的能力。但是，如果Dockerfile中包含恶意的指令或者依赖，则可能被利用。

**投毒风险评估：**

当前Dockerfile的投毒风险较低，约为10%。 主要风险点在于：

*   Dockerfile可能会被添加到更大的攻击链中。攻击者可能会将此Dockerfile与其他恶意资源结合起来，以实现更复杂的攻击。例如，攻击者可以使用此Dockerfile来构建一个包含恶意软件的镜像，然后再利用其他漏洞来部署和执行该镜像。

**缓解措施：**

*   禁用或限制“Docker”构建策略的使用。
*   严格控制修改 `BuildConfig` 的权限。
*   使用安全扫描工具检测构建容器中的恶意代码。

**项目地址:** [tevelsho/cve-2024-7387](https://github.com/tevelsho/cve-2024-7387)

**漏洞详情:** [CVE-2024-7387](https://nvd.nist.gov/vuln/detail/CVE-2024-7387)