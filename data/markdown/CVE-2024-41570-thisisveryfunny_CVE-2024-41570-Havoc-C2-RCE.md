## CVE-2024-41570-Havoc-C2-SSRF

**漏洞编号:** CVE-2024-41570

**漏洞类型:** 服务器端请求伪造 (SSRF)

**影响应用:** Havoc C2

**危害等级:** 高危，可能导致敏感信息泄露、内网探测、远程代码执行

**影响版本:** 0.7

**利用条件:** 无需认证，可直接从公网触发

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-41570 是 Havoc 2 0.7 版本中 Demon 回调处理中存在的一个未经身份验证的服务器端请求伪造 (SSRF) 漏洞。攻击者可以利用此漏洞从 Teamserver 发送任意网络流量。根据搜索结果，已经有公开的PoC代码可用，可以通过伪造 Demon 代理注册和check-in来利用该漏洞，在 Teamserver 上打开 TCP socket，并从其中读取/写入数据，从而泄露 Teamserver 的源 IP 等敏感信息，甚至可以进一步利用 SSRF 漏洞传递经过身份验证的命令注入 payload 实现RCE。

**漏洞利用方式:**

1.  攻击者发送恶意请求到 Havoc C2 Teamserver 的 Demon 回调处理接口。
2.  该请求伪造 Demon 代理注册和check-in，诱使 Teamserver 与攻击者控制的服务器建立连接。
3.  攻击者通过该连接读取 Teamserver 内部网络的信息，或向内部服务发送请求。
4.  攻击者可以利用此 SSRF 漏洞，结合 Havoc 本身存在的其他漏洞（如默认配置导致的弱口令问题和命令注入漏洞），实现更高级别的攻击，例如远程代码执行。

**投毒风险分析:**

代码中存在变量IP,USER,PASSWORD,Payload.sh这些变量容易引导使用者修改，并可能指向恶意地址。存在一定的投毒风险。因为需要使用者自己去搭建一个http server提供payload下载,这个过程也容易被投毒。总体投毒风险较低。

**有效性评估:**

根据CVE描述和github上的poc代码分析，可以利用该漏洞进行SSRF攻击。PoC代码提供了注册代理、打开Socket、写入Socket等函数，模拟了完整的攻击流程。因此，提供的 PoC 代码是有效的。


**项目地址:** [thisisveryfunny/CVE-2024-41570-Havoc-C2-RCE](https://github.com/thisisveryfunny/CVE-2024-41570-Havoc-C2-RCE)

**漏洞详情:** [CVE-2024-41570](https://nvd.nist.gov/vuln/detail/CVE-2024-41570)