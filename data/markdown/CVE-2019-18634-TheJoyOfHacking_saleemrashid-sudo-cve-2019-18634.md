## CVE-2019-18634-Sudo-Stack-based Buffer Overflow

**漏洞编号:** CVE-2019-18634

**漏洞类型:** Stack-based Buffer Overflow

**影响应用:** Sudo

**危害等级:** 高危，可能导致权限提升

**影响版本:** < 1.8.26

**利用条件:** pwfeedback 必须在 /etc/sudoers 中启用。攻击者需要能够向 getln() 函数的 stdin 发送长字符串。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2019-18634 是 Sudo 1.8.26 之前版本中的一个栈缓冲区溢出漏洞。如果 /etc/sudoers 中启用了 pwfeedback，未经授权的用户可以利用此漏洞在特权 sudo 进程中触发栈缓冲区溢出，从而可能提升权限。

**有效性：**
提供的 PoC 代码旨在利用 CVE-2019-18634 漏洞。根据代码和搜索结果，该 PoC 在特定条件下有效。

**投毒风险：**
检查提供的 PoC 代码 `/tmp/6d1d5772a9491e9f9f0cc192fb98b3f1/exploit.c`，没有发现明显的恶意代码或后门。
*   代码结构清晰，主要功能是利用缓冲区溢出漏洞。
*   利用方式相对直接，通过发送超长字符串到 `stdin` 触发溢出。
*   包含license，Makefile，以及readme，相对规范。
但是，任何代码都存在潜在风险，特别是当它以提升权限为目标时。虽然目前没有直接证据表明存在投毒代码，但是，代码的复杂性和潜在的利用方式，我们仍然无法完全排除作者隐藏的、不明显的恶意行为的可能性。
因此，投毒风险评估为 1%。

**利用方式：**
1.  **前提条件：** pwfeedback 必须在 `/etc/sudoers` 文件中启用。该设置默认情况下通常是禁用的，但在 Linux Mint 和 elementary OS 中是默认启用的，或由管理员手动启用。
2.  **获取利用代码：** 下载并编译提供的 exploit.c 代码。
3.  **伪终端分配：** PoC 首先分配一个伪终端 (pty) 作为标准输入，这是为了确保 `sudo_term_kill` 不为 0，从而允许利用缓冲区溢出。
4.  **禁用终端预处理：**  禁用终端的预处理功能 (`cfmakeraw`)，避免 payload 被终端驱动修改。
5.  **修改 VEOF 字符：** 将 VEOF 字符修改为 0xAA，避免与 TGP_ASKPASS 冲突。
6.  **构造 Payload：**  程序构造一个超长字符串，通过标准输入传递给 `sudo` 命令。这个字符串会覆盖栈上的缓冲区，以及其他关键数据。
7.  **触发溢出：**  当 `sudo` 请求密码时，PoC 将构造的 payload 发送到 `stdin`。
8.  **权限提升：** 如果溢出成功，攻击者可以执行任意代码，从而获得提升的权限（通常是 root 权限）。
9.  **执行 Shell：** 成功利用漏洞后，代码会尝试执行一个 shell (`/bin/sh`)，允许攻击者以 root 身份运行命令。

**总结：**
该漏洞的利用依赖于特定配置（pwfeedback 启用），并且需要攻击者能够执行该利用程序。 成功的利用可能导致完全的系统控制。在目标系统上部署该 PoC 之前，应该谨慎评估风险，并在安全环境中进行测试。强烈建议更新到 Sudo 的修复版本。

**项目地址:** [TheJoyOfHacking/saleemrashid-sudo-cve-2019-18634](https://github.com/TheJoyOfHacking/saleemrashid-sudo-cve-2019-18634)

**漏洞详情:** [CVE-2019-18634](https://nvd.nist.gov/vuln/detail/CVE-2019-18634)