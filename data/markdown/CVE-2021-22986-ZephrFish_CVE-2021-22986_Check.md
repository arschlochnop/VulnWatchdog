## CVE-2021-22986-F5 BIG-IP/BIG-IQ-iControl REST API-远程命令执行

**漏洞编号:** CVE-2021-22986

**漏洞类型:** 远程命令执行

**影响应用:** F5 BIG-IP/BIG-IQ

**危害等级:** 高危，未经身份验证的远程命令执行

**影响版本:** BIG-IP 16.0.x before 16.0.1.1, 15.1.x before 15.1.2.1, 14.1.x before 14.1.4, 13.1.x before 13.1.3.6, 12.1.x before 12.1.5.3; BIG-IQ 7.1.0.x before 7.1.0.3, 7.0.0.x before 7.0.0.2

**利用条件:** 目标系统运行受影响的F5 BIG-IP或BIG-IQ版本，且iControl REST API接口对外开放

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-22986 存在于 F5 BIG-IP 和 BIG-IQ 设备的 iControl REST 接口中，允许未经身份验证的远程命令执行。根据漏洞库信息和搜索结果，该漏洞影响多个版本的BIG-IP和BIG-IQ。漏洞利用代码（Checker.py）通过构造包含恶意命令的JSON数据，并将其以POST请求发送到`/mgmt/tm/util/bash`端点来利用此漏洞。请求头包含`Content-Type: application/json`，并且尝试使用`X-F5-Auth-Token`（尽管为空）以及一个Base64编码的`Authorization`头（`admin:ASasasM`）。

有效性分析：提供的POC代码通过发送精心构造的POST请求到目标设备的iControl REST API来执行命令。如果目标设备存在漏洞且未打补丁，则可以成功执行命令。代码通过检查响应状态码是否为200以及响应文本中是否存在"commandResult"来判断是否成功利用漏洞。

投毒风险分析：查看提供的文件列表，包含`CODEOWNERS`、`Checker.py`、`README.md`。`CODEOWNERS`只包含一个github用户，没有发现可疑之处。`README.md`仅仅是描述如何使用脚本。`Checker.py`中，请求的URL和请求方式都是根据漏洞信息构造的，用于验证漏洞是否存在，并没有发现可以投毒的地方。`Authorization`头虽然存在，但其用户名和密码应该是用于某些情况下的身份验证，不属于恶意代码或后门。所以，此仓库中不存在明显的投毒代码。因此，投毒风险评估为0%。

利用方式：攻击者构造恶意的JSON数据，其中包含要在目标系统上执行的命令。然后，通过HTTP POST请求将此数据发送到目标设备的iControl REST API的特定端点（`/mgmt/tm/util/bash`）。由于漏洞存在于身份验证绕过，因此无需提供有效的身份验证信息即可执行命令。成功利用漏洞后，攻击者可以在目标系统上执行任意命令。

**项目地址:** [ZephrFish/CVE-2021-22986_Check](https://github.com/ZephrFish/CVE-2021-22986_Check)

**漏洞详情:** [CVE-2021-22986](https://nvd.nist.gov/vuln/detail/CVE-2021-22986)