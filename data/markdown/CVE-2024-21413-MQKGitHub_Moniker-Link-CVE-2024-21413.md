## CVE-2024-21413 - Microsoft Outlook Remote Code Execution Vulnerability

**漏洞编号:** CVE-2024-21413

**漏洞类型:** 远程代码执行 (RCE) / NTLM Hash Leak

**影响应用:** Microsoft Outlook

**危害等级:** 高危，可能导致远程代码执行、NTLM凭据泄露、横向移动和权限提升

**影响版本:** 受影响版本包括 Microsoft Office 2016 (版本低于 16.0.5435.1001), Microsoft Office 2019, Microsoft 365 Apps for Enterprise, Microsoft Office LTSC 2021

**利用条件:** 用户需要点击恶意链接，攻击者可以通过构造恶意链接在电子邮件或其他Office文档中触发漏洞。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-21413 是 Microsoft Outlook 中的一个关键安全漏洞，被称为“MonikerLink”。该漏洞允许攻击者绕过 Outlook 的内置保护机制，例如受保护视图，并利用 Moniker Link 泄露 NTLM 凭据，甚至可能执行远程代码。根据漏洞信息和搜索结果，该漏洞涉及对特定超链接处理不当的问题。攻击者可以通过在文件中构造恶意链接来利用此漏洞。

**利用方式：**

1.  **构造恶意链接：** 攻击者创建一个包含恶意 Moniker Link 的电子邮件或其他 Office 文档。该链接旨在利用 `MkParseDisplayName()` API 的行为。
2.  **绕过保护：** 通过在 `file://` URL 中使用 `!exploit` 等技巧绕过 Outlook 的 Protected View。
3.  **触发 SMB 身份验证：** 恶意链接指向攻击者控制的 SMB 服务器，从而触发受害者的 Outlook 尝试进行 SMB 身份验证。
4.  **捕获 NTLM 哈希：** 攻击者使用 Responder 等工具监听 SMB 身份验证请求，并捕获受害者的 NTLMv2 哈希。
5.  **潜在的 RCE：** 虽然目前没有公开可用的 RCE PoC，但该漏洞具有远程代码执行的潜力。

**有效性评估：**
提供的漏洞利用代码是一个关于如何利用 CVE-2024-21413 漏洞的说明文档和示例。它展示了使用 Python (smtplib) 发送包含恶意 Moniker Link 的电子邮件，并使用 Responder 捕获 NTLM 哈希的过程。根据 TryHackMe 挑战的完成状态，提供的 PoC 是有效的，可以成功利用该漏洞泄露 NTLM 哈希。

**投毒风险评估：**
该仓库主要是一个漏洞利用教程和概念验证，并没有明显的恶意代码。但仍然存在一定的投毒风险，主要体现在以下几个方面：

*   **潜在的细微修改：** 攻击者可能会在示例脚本中引入细微的修改，例如更改 SMB 服务器的 IP 地址或添加额外的恶意功能。尽管可能性不高，但仍然需要保持警惕。
*   **依赖的工具：** 该漏洞利用依赖于 Responder 等工具。如果攻击者修改了这些工具，可能会导致意外的行为或安全问题。

因此，综合评估投毒风险较低，但不能完全排除，可能性大约为10%。


**项目地址:** [MQKGitHub/Moniker-Link-CVE-2024-21413](https://github.com/MQKGitHub/Moniker-Link-CVE-2024-21413)

**漏洞详情:** [CVE-2024-21413](https://nvd.nist.gov/vuln/detail/CVE-2024-21413)