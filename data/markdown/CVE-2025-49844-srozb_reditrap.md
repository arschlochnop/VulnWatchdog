## CVE-2025-49844 Redis Lua Use-After-Free 漏洞

**漏洞编号:** CVE-2025-49844

**漏洞类型:** 使用后释放漏洞 (Use-After-Free)

**影响应用:** Redis

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** < 8.2.2

**利用条件:** 需要能够连接到Redis服务器，且Redis未禁用Lua脚本执行

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2025-49844 是一个 Redis 中的使用后释放漏洞，存在于 Lua 脚本引擎中。未经授权的攻击者可以通过发送特制的 Lua 脚本到 Redis 服务器，触发垃圾回收机制中的漏洞，导致在 C 代码仍然使用指向 Lua 数据的指针时，该指针指向的内存被释放。攻击者利用该漏洞可以执行任意代码。

**利用方式：**

1.  攻击者需要能够连接到 Redis 服务器。
2.  攻击者需要发送包含恶意代码的 Lua 脚本到 Redis 服务器，可通过`EVAL`、`EVALSHA` 或 `SCRIPT LOAD` 命令发送脚本。
3.  恶意 Lua 脚本会利用 Redis Lua 引擎的漏洞，触发 Use-After-Free 漏洞，最终导致远程代码执行。

**POC 分析：**

提供的代码实际上是一个 Redis 蜜罐（RediTrap Honeypot），用于检测 CVE-2025-49844 漏洞的攻击尝试。它模拟了一个存在漏洞的 Redis 服务器，记录所有命令，并标记可疑的 Lua 脚本活动。这个蜜罐是为了捕获利用 CVE-2025-49844 的行为，而非真正利用漏洞。

**投毒风险评估：**

提供的代码是一个蜜罐，目的是为了检测攻击，所以不存在投毒代码，投毒风险为0%。虽然代码本身不会主动进行恶意行为，但是应该仔细审查所使用的基础镜像和依赖项，确保没有潜在的供应链风险。Dockerfile 和其他文件看起来是安全的，没有明显的恶意行为。它仅仅是记录尝试攻击 Redis 的流量和 Lua 脚本，并不会执行任何危险的操作。

**项目地址:** [srozb/reditrap](https://github.com/srozb/reditrap)

**漏洞详情:** [CVE-2025-49844](https://nvd.nist.gov/vuln/detail/CVE-2025-49844)