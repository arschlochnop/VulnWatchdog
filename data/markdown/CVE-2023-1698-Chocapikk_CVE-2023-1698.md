## CVE-2023-1698 WAGO Remote Code Execution

**漏洞编号:** CVE-2023-1698

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** WAGO Compact Controller CC100, Edge Controller, PFC100, PFC200, Touch Panel 600系列

**危害等级:** 高危，未经身份验证的远程攻击者可以创建新用户、更改设备配置，导致拒绝服务和完全系统入侵

**影响版本:** FW20 <= 版本 <= FW22, FW23

**利用条件:** 目标设备需开启Web管理界面，攻击者需要能够通过网络访问目标设备

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2023-1698 是 WAGO 产品中的一个命令注入漏洞，未经身份验证的远程攻击者可利用此漏洞执行任意命令。根据漏洞库信息，受影响的产品包括 Compact Controller CC100, Edge Controller, PFC100, PFC200 以及 Touch Panel 600 系列，受影响的固件版本主要是FW20到FW22，以及FW23。

**有效性：**
根据搜索结果和漏洞利用代码，该漏洞的POC是有效的。GitHub上存在公开的漏洞利用脚本，并且有安全厂商发布了相关的漏洞分析报告，证明了该漏洞的可利用性。

**投毒风险：**
该 POC 脚本主要通过构造恶意的 HTTP POST 请求，向 `/wbm/plugins/wbm-legal-information/platform/pfcXXX/licenses.php` 发送包含恶意 payload 的 `package` 参数，其中 `XXX` 表示具体的产品型号（PFC100, PFC200等）。Payload 中使用 `echo -n [S]` 和 `echo -n [E]` 来标记命令执行结果的开始和结束，以便提取执行结果。脚本中没有明显的投毒代码，只是一个简单的命令执行利用工具。

因此，投毒风险较低，约为1%。主要是因为该代码的功能明确，没有发现任何隐藏的、与漏洞利用无关的恶意行为。极小概率的风险可能来自于代码中潜在的、未知的bug，但从目前的分析来看，这种可能性很小。

**利用方式：**
1.  **漏洞定位：**  该漏洞位于 WAGO 设备的 Web 管理界面中的 "Legal Information" 插件。
2.  **攻击向量：**  通过向特定的 URL（`/wbm/plugins/wbm-legal-information/platform/pfcXXX/licenses.php`）发送特制的 HTTP POST 请求。
3.  **Payload 构造：**  在 POST 请求的 `package` 参数中包含恶意命令，利用命令注入漏洞执行任意系统命令。
4.  **命令执行：**  WAGO 设备在处理该请求时，由于未对 `package` 参数进行充分的验证和过滤，导致系统执行了攻击者注入的命令。
5.  **结果提取：**  利用 `echo` 命令标记命令执行结果的开始和结束，从而方便从响应中提取命令执行的结果。
6.  **权限提升/控制：** 攻击者可以通过该漏洞创建新用户，修改设备配置，甚至完全控制受影响的 WAGO 设备，造成拒绝服务或系统完全入侵。

**项目地址:** [Chocapikk/CVE-2023-1698](https://github.com/Chocapikk/CVE-2023-1698)

**漏洞详情:** [CVE-2023-1698](https://nvd.nist.gov/vuln/detail/CVE-2023-1698)