## CVE-2019-5736-Runc容器逃逸

**漏洞编号:** CVE-2019-5736

**漏洞类型:** 容器逃逸

**影响应用:** Runc

**危害等级:** 高危，可获取主机Root权限

**影响版本:** <= 1.0-rc6 (Docker < 18.09.2)

**利用条件:** 需要能够以Root权限在受影响的容器中执行命令，或控制容器镜像

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-5736 允许攻击者通过以下方式覆写主机上的 `runc` 二进制文件，从而获得主机 Root 权限：

1.  **利用方式：**
    *   **新的容器，攻击者控制的镜像：** 攻击者创建一个包含恶意代码的容器镜像。当容器启动时，恶意代码会尝试覆写主机上的 `runc` 二进制文件。
    *   **已存在的容器，攻击者有写入权限：** 攻击者获得对现有容器的写入权限后，可以将恶意代码写入容器的文件系统。然后，当容器执行新进程（例如使用 `docker exec`）时，恶意代码会被执行，并尝试覆写主机上的 `runc` 二进制文件。

    该漏洞的根本原因是文件描述符处理不当，与 `/proc/self/exe` 有关。通过覆写 `runc` 二进制文件，攻击者可以在下次容器启动或执行命令时执行任意代码，从而获得主机 Root 权限。

2.  **POC有效性：**
    提供的POC代码包含两种利用方式：
    *   `exec_POC`:  创建一个简单的程序，覆写runc，并打印字符串。
    *   `malicious_image_POC`: 创建一个反向shell，连接到localhost:2345，同样通过覆写runc实现。
    根据漏洞描述和搜索结果，这些POC代码可以有效利用该漏洞。

3.  **投毒风险：**
    `malicious_image_POC/new_runc` 脚本包含反向Shell连接，此为漏洞利用目的，非投毒代码。其他的Dockerfile指令，诸如apt-get等，均为构建镜像准备，非投毒行为。
 overwrite_runc.c 的作用是覆盖runC，其覆盖内容来自 /root/new_runc。因此投毒点可能存在于：
     *   `new_runc`：如果该脚本包含恶意命令，则可能构成投毒。当前脚本是反向shell,不算投毒。
     *   `overwrite_runc.c`：虽然代码功能简单是覆盖runC文件，但如果作者在编译过程中，使用不安全的编译选项，或修改代码，植入后门，则构成投毒，鉴于代码量较少，审查难度不大，且有一定必要性，该处的投毒风险较低。
     综合来看，此仓库的投毒风险较低，约为10%。主要基于假设作者在`overwrite_runc.c`的编译过程或替换的`new_runc`中植入后门。

**项目地址:** [BBRathnayaka/POC-CVE-2019-5736](https://github.com/BBRathnayaka/POC-CVE-2019-5736)

**漏洞详情:** [CVE-2019-5736](https://nvd.nist.gov/vuln/detail/CVE-2019-5736)