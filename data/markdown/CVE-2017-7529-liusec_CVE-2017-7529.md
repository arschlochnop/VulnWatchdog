## CVE-2017-7529 - Nginx Range Filter Integer Overflow

**漏洞编号:** CVE-2017-7529

**漏洞类型:** 整数溢出导致的信息泄露

**影响应用:** Nginx

**危害等级:** 中危，可能导致敏感信息泄露

**影响版本:** 0.5.6 - 1.13.2

**利用条件:** Nginx 开启 proxy_cache 模块

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2017-7529 是 Nginx range filter 模块中的整数溢出漏洞。当 Nginx 作为反向代理并开启缓存功能时，攻击者可以通过发送包含特制 Range 头的 HTTP 请求，触发整数溢出，从而泄露缓存文件的头部信息，这些头部信息可能包含后端服务器的 IP 地址或其他敏感数据。

**漏洞利用方式：**

1.  **确定目标是否存在漏洞：** 检查 Nginx 版本是否在受影响范围内 (0.5.6 - 1.13.2)，并确认是否开启了 `proxy_cache` 指令。
2.  **获取 Content-Length：**  使用 `curl -I` 命令获取目标资源的 Content-Length。
3.  **构造恶意 Range 头：**  构造包含两个 Range 值的请求头。第一个 Range 值为负数，其绝对值略大于 Content-Length。第二个 Range 值为一个非常大的数，导致整数溢出。
4.  **发送恶意请求：**  使用 `curl` 或其他 HTTP 客户端发送包含恶意 Range 头的请求。
5.  **分析响应：**  如果漏洞存在，响应状态码为 206 Partial Content，且响应体中包含缓存文件的头部信息。

**POC 代码分析：**

提供的 `poc.py` 脚本自动化了上述步骤。它首先获取目标 URL 的 Content-Length，然后构造包含恶意 Range 头的请求，最后检查响应状态码和响应体，以确定目标是否存在漏洞。

**投毒风险分析：**

`Dockerfile` 主要用于构建包含漏洞版本的 Nginx 环境，方便漏洞复现和测试。
`poc.py`  脚本本身的功能是检测漏洞，没有发现直接的恶意代码。
`README.md` 提供了漏洞描述、影响、环境搭建、利用方式和参考链接。
`src/nginx.conf`，`src/default.conf`， `src/000-default.conf`，`src/ports.conf`，`src/start.sh`，`src/index.html`，`src/demo.png` 是nginx环境搭建文件，主要目的是为了搭建一个存在漏洞的环境，方便漏洞复现。仔细检查这些文件，没有发现明显的恶意代码。
但是，由于攻击者可以篡改这些文件并重新发布，因此存在极小的（1%）投毒的可能性。潜在的风险是，如果攻击者修改了 `nginx.conf`， `default.conf`文件，可能在反向代理配置中加入恶意代码，例如将流量转发到恶意服务器，或在响应中注入恶意脚本。

**项目地址:** [liusec/CVE-2017-7529](https://github.com/liusec/CVE-2017-7529)

**漏洞详情:** [CVE-2017-7529](https://nvd.nist.gov/vuln/detail/CVE-2017-7529)