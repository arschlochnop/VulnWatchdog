## CVE-2017-12617 - Apache Tomcat JSP上传RCE

**漏洞编号:** CVE-2017-12617

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Tomcat

**危害等级:** 高危，允许攻击者在服务器上执行任意代码

**影响版本:** 9.0.0.M1 to 9.0.0, 8.5.0 to 8.5.22, 8.0.0.RC1 to 8.0.46, 7.0.0 to 7.0.81

**利用条件:** 需要Tomcat运行在受影响版本，启用HTTP PUT方法 (readonly 初始化参数设置为 false)

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2017-12617 漏洞允许未经授权的用户通过构造恶意请求上传JSP文件到存在漏洞的Tomcat服务器上，从而导致远程代码执行。该漏洞的利用需要满足两个条件：

1.  Tomcat的版本在受影响范围内 (9.0.0.M1 to 9.0.0, 8.5.0 to 8.5.22, 8.0.0.RC1 to 8.0.46, 7.0.0 to 7.0.81)。
2.  `readonly` 初始化参数在 Default Servlet 中被设置为 `false`， 允许 HTTP PUT 请求。这意味着服务器允许上传文件。

**利用方式：**

1.  攻击者使用HTTP PUT请求上传包含恶意代码的JSP文件到服务器。上传的JSP文件名可以包含特殊字符以绕过某些安全检查。
2.  上传成功后，攻击者通过Web浏览器访问上传的JSP文件。 Tomcat服务器将执行JSP文件中的恶意代码，从而导致远程代码执行。

**POC有效性：**

提供的POC代码是有效的，它利用了HTTP PUT方法上传JSP webshell到目标服务器，并提供了一个交互式shell。

**投毒风险分析：**

虽然POC的主要功能是利用漏洞，但是仔细检查代码后发现，作者在脚本中包含了一个用于接收电子邮件的地址(satanclause666999@gmail.com)，用于反馈bug，这个行为可能会被滥用，比如搜集攻击目标信息，或者散布带有特定攻击目标的恶意利用。 因此，存在一定的投毒风险，但是风险较低。

**项目地址:** [tyranteye666/tomcat-cve-2017-12617](https://github.com/tyranteye666/tomcat-cve-2017-12617)

**漏洞详情:** [CVE-2017-12617](https://nvd.nist.gov/vuln/detail/CVE-2017-12617)