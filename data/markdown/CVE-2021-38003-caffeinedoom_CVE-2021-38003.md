## CVE-2021-38003 - Chrome V8 堆损坏

**漏洞编号:** CVE-2021-38003

**漏洞类型:** 堆损坏

**影响应用:** Google Chrome (V8)

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** < 95.0.4638.69

**利用条件:** 需要用户访问特制的HTML页面

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-38003 是 Google Chrome 浏览器 V8 引擎中的一个堆损坏漏洞。攻击者可以利用此漏洞通过精心设计的 HTML 页面进行攻击，从而可能导致远程代码执行（RCE）。

**有效性：**
提供的 PoC 代码 (`poc.js` 和 `exploit_attempt1.js`) 尝试在 V8 引擎中重现该漏洞，通过操纵 JavaScript `Map` 对象并利用 `%TheHole()` 值，尝试触发 `OrderedHashMap` 的损坏。PoC代码已验证在受影响的版本中会导致崩溃。

**投毒风险：**
该存储库主要包含漏洞分析、调试和 PoC 代码。虽然有可能作者添加了试图利用此漏洞的其他更隐蔽的片段，但现有信息表明风险较低。由于`exploit_attempt1.js`尝试在堆上布置特定的`ArrayBuffer`对象，这有可能包含恶意代码。因此，投毒风险评估为 10%。这个风险较低，因为主要目的是演示漏洞，而不是植入恶意代码。

**利用方式：**
1.  **漏洞根源：** 漏洞位于 V8 引擎的 `Map` 对象处理中，具体是在处理 `%TheHole()` 值时。当一个 `Map` 包含 `TheHole` 并被删除多次，同时进行垃圾回收和调整大小时，会导致 `OrderedHashMap` 的状态不一致，产生堆损坏。
2.  **PoC 步骤：**
    *   创建一个 JavaScript `Map` 对象。
    *   使用 `%TheHole()` 插入一个“hole”值。
    *   多次删除该“hole”值和临近的键值对。
    *   进行多次迭代（例如 `0x3000` 次）以增加堆压力。
    *   调用垃圾回收 `gc()`。
    *   触发 `Map` 对象的调整大小 (resizing)。
3.  **堆损坏：** PoC 导致 `OrderedHashMap` 中已删除元素数量和实际 hole 索引之间的不匹配，从而触发断言失败或堆损坏。在 release 版本中，这可能允许攻击者进行内存读写操作，最终实现 RCE。
4.  **RCE 尝试：** `exploit_attempt1.js` 尝试通过堆喷射（Heap Spraying）的方式，在堆上布置特定的 `ArrayBuffer` 对象，并利用损坏的 `OrderedHashMap` 修改这些对象的内容，从而控制程序执行流程。

**项目地址:** [caffeinedoom/CVE-2021-38003](https://github.com/caffeinedoom/CVE-2021-38003)

**漏洞详情:** [CVE-2021-38003](https://nvd.nist.gov/vuln/detail/CVE-2021-38003)