## CVE-2017-10271-WebLogic-WLS-WSAT远程命令执行

**漏洞编号:** CVE-2017-10271

**漏洞类型:** 远程命令执行

**影响应用:** Oracle WebLogic Server

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** 10.3.6.0.0, 12.1.3.0.0, 12.2.1.1.0, 12.2.1.2.0

**利用条件:** 需要目标WebLogic服务器开放T3协议端口（通常为7001）且未打补丁。

**POC 可用性:** 是

**投毒风险:** 20%

## 详情

CVE-2017-10271 是一个 Oracle WebLogic Server WLS Security 组件中的远程命令执行漏洞。攻击者可以利用此漏洞，通过发送恶意的 SOAP 请求到未打补丁的 WebLogic 服务器，在服务器上执行任意命令，从而完全控制服务器。

**有效性评估：**

根据漏洞库信息和提供的漏洞利用代码（`weblogic_wls_wsat_exp.py`），此漏洞的PoC代码是可用的，并且漏洞利用的有效性较高。漏洞库信息显示，该漏洞容易被利用，且成功利用可能导致服务器被接管。PoC代码中明确说明了支持的受影响版本，并提供了命令执行和上传shell的功能。

**投毒风险评估：**

提供的PoC代码中包含一个`exec.jsp`文件，用于执行任意命令。`weblogic_wls_wsat_exp.py`脚本允许上传此JSP文件或执行命令。主要风险点在于：

1.  **恶意JSP后门：**`exec.jsp`本身就是一个后门，允许攻击者在成功利用漏洞后，通过发送HTTP请求执行任意命令。虽然这个JSP是为了验证漏洞而存在，但它本身具有恶意性，需要用户自行评估并承担风险。
2.  **命令执行的风险：** 使用该脚本执行命令可能导致系统被进一步入侵。例如，攻击者可能使用该脚本下载和执行恶意软件。

因此，认为该仓库存在一定的投毒风险，风险评估为20%。

**利用方式：**

1.  **T3协议利用:** 漏洞利用通过构造特制的 SOAP 请求，利用WebLogic的WLS Security组件中的XML反序列化漏洞。攻击者通过T3协议将恶意XML数据发送到存在漏洞的WebLogic服务器。
2.  **JNDI注入:** 恶意XML数据中包含JNDI注入payload，该payload会尝试从攻击者控制的远程服务器加载并执行恶意类，从而在WebLogic服务器上执行任意命令。
3.  **命令执行/Shell上传:** PoC代码提供了两种利用方式：
    *   **命令执行:** 攻击者可以使用 `-c` 参数指定要执行的命令，并在 `-o` 参数指定的文件中接收命令执行的结果。
    *   **Shell上传:** 攻击者可以使用 `-s` 参数指定要上传的JSP文件（例如`exec.jsp`），并使用 `-o` 参数指定JSP文件的上传路径。上传成功后，攻击者可以通过访问该JSP文件来执行任意命令。

**漏洞利用步骤：**

1.  使用 `weblogic_wls_wsat_exp.py` 脚本，指定目标WebLogic服务器的IP地址和端口。
2.  选择执行命令或上传shell的方式。
3.  如果选择执行命令，则指定要执行的命令，并指定输出文件名。
4.  如果选择上传shell，则指定要上传的JSP文件，并指定上传路径。
5.  运行脚本，等待利用完成。
6.  如果上传了shell，则通过浏览器访问上传的JSP文件，并传递 `c` 参数来执行命令。

**示例：**

*   执行 `id` 命令并将结果保存到 `output.txt` 文件：
    ```bash
    python weblogic_wls_wsat_exp.py -t 172.16.80.131:7001 -c id -o output.txt
    ```
*   上传 `exec.jsp` 文件到 `/bea/user_projects/domains/mydomain/servers/AdminServer/tmp/_WL_Static/consoleapp/xxxxx/shell.jsp`：
    ```bash
    python weblogic_wls_wsat_exp.py -t 172.16.80.131:7001 -s exec.jsp -o shell.jsp
    ```
    然后，通过访问 `http://172.16.80.131:7001/console/shell.jsp?c=id` 来执行 `id` 命令。

**项目地址:** [cjjduck/weblogic_wls_wsat_rce](https://github.com/cjjduck/weblogic_wls_wsat_rce)

**漏洞详情:** [CVE-2017-10271](https://nvd.nist.gov/vuln/detail/CVE-2017-10271)