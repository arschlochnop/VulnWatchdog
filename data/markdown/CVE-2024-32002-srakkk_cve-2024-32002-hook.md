## CVE-2024-32002 - Git Recursive Clone Remote Code Execution

**漏洞编号:** CVE-2024-32002

**漏洞类型:** 远程代码执行

**影响应用:** Git

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** 受影响版本包括 2.45.0, 2.44.0, 2.43.0 < 2.43.4, 2.42.0 < 2.42.2, 2.41.0, 2.40.0 < 2.40.2, < 2.39.4

**利用条件:** 需要目标系统启用 `core.symlinks` (默认启用) 且使用受影响的 Git 版本进行递归克隆包含恶意 submodule 的仓库

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-32002 漏洞允许攻击者通过构造包含恶意 submodule 的 Git 仓库，在受害者克隆该仓库时执行任意代码。漏洞原理在于 Git 在递归克隆子模块时，可能被诱导将文件写入 `.git/` 目录而非子模块的工作目录，从而覆盖或创建 hook 文件（如 `post-checkout`），在克隆操作完成前执行恶意代码。提供的 POC 代码包含一个 `post-checkout` hook 脚本，该脚本会在克隆后被执行，用于验证漏洞并创建一个包含执行结果的 proof 文件。POC 代码未发现明显的投毒行为，其作用仅为验证漏洞存在并执行简单的系统命令。漏洞利用依赖于受害者克隆包含恶意子模块的仓库，并在支持符号链接的文件系统上使用受影响的 Git 版本。如果禁用符号链接支持 (`git config --global core.symlinks false`)，则此漏洞将无法利用。

**漏洞利用方式：**

1.  **创建恶意仓库：** 攻击者创建一个包含恶意 submodule 的 Git 仓库。
2.  **构造恶意 submodule：** 在 submodule 中放置恶意的 `.git/hooks/post-checkout` 文件，其中包含要执行的恶意代码。
3.  **诱导受害者克隆：** 攻击者诱导受害者使用 `git clone --recurse-submodules <恶意仓库>` 命令克隆该仓库。
4.  **触发漏洞：** 当 Git 克隆子模块时，恶意 hook 文件会被写入 `.git/` 目录，并在 `git checkout` 操作后自动执行，从而实现远程代码执行。

**项目地址:** [srakkk/cve-2024-32002-hook](https://github.com/srakkk/cve-2024-32002-hook)

**漏洞详情:** [CVE-2024-32002](https://nvd.nist.gov/vuln/detail/CVE-2024-32002)