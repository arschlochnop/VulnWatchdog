## CVE-2019-19781-Citrix ADC/Gateway-目录遍历与远程代码执行

**漏洞编号:** CVE-2019-19781

**漏洞类型:** 目录遍历/远程代码执行

**影响应用:** Citrix Application Delivery Controller (ADC) and Gateway

**危害等级:** 高危，可能导致敏感信息泄露和远程代码执行

**影响版本:** 10.5, 11.1, 12.0, 12.1, and 13.0

**利用条件:** 需要目标系统运行受影响版本的Citrix ADC或Gateway，并允许通过HTTP(S)访问/vpn路径

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-19781是一个存在于Citrix ADC和Gateway中的目录遍历漏洞，攻击者可以通过构造特殊的URL来读取或写入服务器上的任意文件。结合漏洞利用代码分析，攻击者可以通过`POST /vpn/../vpns/portal/scripts/newbm.pl` 接口，利用目录遍历漏洞将恶意代码注入到`/netscaler/portal/templates/RAPIDSAFEGUARD`模板文件中。

`NSC_USER: ../../../netscaler/portal/templates/RAPIDSAFEGUARD`指定了要修改的模板文件。

`desc=[% template.new('BLOCK' = 'print `** Give Command **`') %]` 将webshell写入到`/netscaler/portal/templates/RAPIDSAFEGUARD`。

**Give Command**的位置可以替换成需要执行的系统命令。由于该漏洞可以执行任意代码，因此攻击者可能利用此漏洞植入后门，获取系统权限，或进行其他恶意活动。

**有效性：** 根据漏洞信息和搜索结果，该漏洞在野外已被积极利用，POC代码能够成功执行命令，因此判定该漏洞是有效的。

**投毒风险：** POC本身展示了如何利用漏洞执行任意命令，本身不算是投毒代码。但任何共享的POC都存在被修改并加入恶意代码的风险。该仓库只包含一个README文件和一个POC利用文件，代码量少，投毒风险较低，预估为10%，主要风险在于使用者未经验证直接使用。

**利用方式：**

1.  发送特制的HTTP POST请求到`/vpn/../vpns/portal/scripts/newbm.pl`。
2.  在POST请求中，`NSC_USER`参数用于指定要写入或修改的模板文件，使用目录遍历绕过路径限制。
3.  `desc`参数包含要注入的恶意代码，利用Citrix模板引擎执行任意系统命令。
4.  成功利用后，攻击者可以执行任意系统命令，实现远程代码执行。

**项目地址:** [Vulnmachines/Ctirix_RCE-CVE-2019-19781](https://github.com/Vulnmachines/Ctirix_RCE-CVE-2019-19781)

**漏洞详情:** [CVE-2019-19781](https://nvd.nist.gov/vuln/detail/CVE-2019-19781)