## CVE-2021-22986-F5 BIG-IP/BIG-IQ-iControl REST未授权远程命令执行

**漏洞编号:** CVE-2021-22986

**漏洞类型:** 远程命令执行

**影响应用:** F5 BIG-IP/BIG-IQ

**危害等级:** 高危，可能导致完全控制系统

**影响版本:** BIG-IP 16.0.x before 16.0.1.1, 15.1.x before 15.1.2.1, 14.1.x before 14.1.4, 13.1.x before 13.1.3.6, 12.1.x before 12.1.5.3; BIG-IQ 7.1.0.x before 7.1.0.3, 7.0.0.x before 7.0.0.2

**利用条件:** 目标系统存在漏洞版本，且iControl REST接口对外开放

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-22986 漏洞是 F5 BIG-IP 和 BIG-IQ 设备中 iControl REST 接口存在的一个未授权远程命令执行漏洞。攻击者可以通过发送特制的请求到 iControl REST 接口，从而在目标系统上执行任意命令。根据提供的POC代码，利用方式主要分两步：

1.  **获取Token（方法一）:**
    *   首先，向`/mgmt/shared/authn/login`接口发送POST请求，尝试获取一个身份验证Token。这个请求中包含一个默认的用户名（admin）以及一些特定的参数。
    *   如果成功获取到Token，POC代码会提取该Token，并将其用于后续的命令执行。

2.  **执行命令:**
    *   利用获取到的Token，向`/mgmt/tm/util/bash`接口发送POST请求，并在请求体中包含要执行的命令。命令的结果会从响应中提取并显示。

**方法二（备选方案）：**
    *   如果获取Token失败，POC代码会尝试使用一个硬编码的Basic Auth头（`Authorization: Basic YWRtaW46QVNhc1M=`，对应admin:ASasS）。
    *   同样，通过向`/mgmt/tm/util/bash`接口发送POST请求来执行命令。

**有效性：**
根据提供的漏洞信息和POC代码，此漏洞利用代码是有效的，因为
*   漏洞库信息明确指出存在未授权的远程命令执行漏洞
*   搜索引擎结果表明该漏洞已被积极利用
*   POC代码尝试通过REST API执行系统命令

**投毒风险：**
存在较低的投毒风险（10%），主要基于以下几点考虑：
*   **代理配置：** POC代码包含使用代理的配置`proxy_url = "http://127.0.0.1:8080"`，如果用户没有意识到这一点，可能会将流量通过攻击者控制的代理服务器，从而泄露敏感信息或被中间人攻击。
*   **硬编码凭据：** 虽然提供了默认的用户名（admin）和密码`Authorization: Basic YWRtaW46QVNhc1M=`，但这只是为了方便POC的执行，并非恶意的后门植入。
*   **异常处理：** 在连接失败时，代码会尝试绕过代理。这看起来像是为了保证POC的可用性，但如果目标环境必须通过代理才能访问，这可能导致信息泄露。
总而言之，POC的主要目的是演示漏洞的利用，但使用代理和硬编码凭据可能会带来一定的安全风险，因此存在一定投毒风险, 建议用户在使用时仔细检查和修改代理设置，并避免在生产环境中使用默认凭据。

**项目地址:** [huydung26/CVE-2021-22986](https://github.com/huydung26/CVE-2021-22986)

**漏洞详情:** [CVE-2021-22986](https://nvd.nist.gov/vuln/detail/CVE-2021-22986)