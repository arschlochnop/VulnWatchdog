## CVE-2021-31630 - OpenPLC Webserver v3 远程命令执行

**漏洞编号:** CVE-2021-31630

**漏洞类型:** 命令注入

**影响应用:** OpenPLC Webserver

**危害等级:** 高危，允许远程攻击者执行任意代码

**影响版本:** v3

**利用条件:** 需要网络访问OpenPLC Webserver的`/hardware`页面，默认用户名密码openplc/openplc

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2021-31630 是 OpenPLC Webserver v3 中的一个命令注入漏洞。远程攻击者可以通过 `/hardware` 页面的 "Hardware Layer Code Box" 组件利用此漏洞执行任意代码。

**有效性分析：**

从提供的漏洞信息、搜索引擎结果以及漏洞利用代码来看，该漏洞是真实存在的，并且存在公开的PoC利用代码。搜索引擎结果中多个链接指向了漏洞的详细信息，包括NVD、Red Hat、Mitre等权威机构的描述。提供的PoC代码是一个Python脚本，它自动化了利用该漏洞的过程，包括登录OpenPLC、构造包含反弹shell的恶意payload、上传payload以及触发漏洞，从而实现远程代码执行。

**投毒风险分析：**

对PoC代码进行分析后，虽然脚本本身是为了演示漏洞利用，但在以下几个方面存在潜在的投毒风险：

1.  **payload定制：** 脚本允许用户自定义反弹shell的IP地址和端口。虽然这本身是正常功能，但如果攻击者恶意修改脚本，例如硬编码一个恶意IP地址，然后传播该修改后的脚本，则可能导致其他用户在不知情的情况下将shell反弹到攻击者的服务器。
2.  **依赖项风险：** 脚本依赖于`requests`库。如果攻击者篡改了`requests`库，或者诱骗用户安装恶意版本，则可能在用户运行脚本时执行恶意代码。
3.  **脚本行为的混淆：** 通过仔细阅读脚本，可以理解其行为。但是，如果攻击者对脚本进行混淆或修改，使其行为更难以理解，则可能诱骗用户在不知情的情况下运行恶意代码。

尽管存在这些风险，但脚本的主要功能是实现漏洞利用，没有发现明显的恶意代码。因此，可以认为投毒风险较低，大约为1%。

**漏洞利用方式：**

1.  **身份验证：**  利用PoC提供的用户名和密码或者爆破用户名和密码，访问OpenPLC Webserver的`/hardware`页面。
2.  **构造Payload：**  构造包含恶意命令的Payload，该命令通常用于执行反弹shell，建立与攻击者控制的服务器的连接。
3.  **上传Payload：**  将构造的Payload上传到 `/hardware` 页面的 "Hardware Layer Code Box" 组件中。
4.  **触发漏洞：**  通过尝试编译上传的恶意代码，触发命令注入漏洞。这将导致服务器执行Payload中的恶意命令，从而建立反弹shell，允许攻击者远程控制OpenPLC Webserver所在的系统。

**项目地址:** [behindsecurity/htb-wifinetictwo-exploit](https://github.com/behindsecurity/htb-wifinetictwo-exploit)

**漏洞详情:** [CVE-2021-31630](https://nvd.nist.gov/vuln/detail/CVE-2021-31630)