## CVE-2024-21762 FortiOS SSL VPN 远程代码执行

**漏洞编号:** CVE-2024-21762

**漏洞类型:** 远程代码执行

**影响应用:** FortiOS/FortiProxy

**危害等级:** 高危，远程未授权攻击者可以执行任意代码或命令

**影响版本:** FortiOS：7.4.0-7.4.2, 7.2.0-7.2.6, 7.0.0-7.0.13, 6.4.0-6.4.14, 6.2.0-6.2.15, 6.0.0-6.0.17; FortiProxy：7.4.0-7.4.2, 7.2.0-7.2.8, 7.0.0-7.0.14, 2.0.0-2.0.13, 1.2.0-1.2.13, 1.1.0-1.1.6, 1.0.0-1.0.7

**利用条件:** 目标系统存在漏洞版本，且可从外部网络访问 FortiOS 或 FortiProxy 设备的 SSL VPN 功能。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-21762 是 Fortinet FortiOS 和 FortiProxy 中的一个越界写入漏洞，存在于 SSL VPN 的 `sslvpnd` 守护进程中。攻击者可以通过构造特制的请求，利用 `/remote/hostcheck_validate` 接口中的漏洞，实现远程代码执行。漏洞利用通过向目标服务器的 `/remote/hostcheck_validate` 端点发送包含恶意代码的 POST 请求，该代码作为 `host` 参数的值进行注入。`User-Agent` 和 `Cookie` 头部用于绕过简单的请求过滤。

**漏洞利用有效性分析：**
提供的 PoC 代码旨在扫描并利用 CVE-2024-21762。它通过向 `/remote/hostcheck_validate` 端点注入反向 shell payload 来实现远程代码执行，通过模拟 `User-Agent` 和 `Cookie` 头部来绕过简单的请求过滤。根据搜索结果，该漏洞已经被积极利用，存在公开的漏洞利用代码和扫描器。

**投毒风险分析：**
提供的 PoC 包含 `LICENSE`、`README.md`、`exploit.py` 和 `http_c2_server.py` 文件。

*   `exploit.py`: 实现了漏洞利用的核心逻辑，用于发送包含反向 shell payload 的恶意请求。
*   `http_c2_server.py`: 这是一个简单的 HTTP 服务器，用于接收反向 shell 连接。其默认命令为 "id"，可能被修改。
    
代码本身是漏洞的PoC，`http_c2_server.py` 文件可以通过修改`COMMAND`变量来执行其他命令，具有一定的风险。PoC 的作者信息中包含了“PoC automation nerd”，暗示了自动化和脚本化的能力，使得大规模利用成为可能。整体来看，该 PoC 的投毒风险较低，主要风险在于被滥用执行恶意命令。

**漏洞利用方式总结：**
1.  攻击者构造包含恶意 payload 的 HTTP POST 请求，目标端点为 `/remote/hostcheck_validate`。
2.  Payload 通常是反向 shell 命令，用于在目标系统上执行任意代码。
3.  攻击者监听指定的 IP 地址和端口，等待反向 shell 连接。
4.  如果漏洞利用成功，攻击者可以在目标系统上执行命令。

**项目地址:** [abrewer251/CVE-2024-21762_FortiNet_PoC](https://github.com/abrewer251/CVE-2024-21762_FortiNet_PoC)

**漏洞详情:** [CVE-2024-21762](https://nvd.nist.gov/vuln/detail/CVE-2024-21762)