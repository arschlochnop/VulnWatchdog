## CVE-2024-31497-PuTTY-ECDSA私钥泄露

**漏洞编号:** CVE-2024-31497

**漏洞类型:** 私钥泄露

**影响应用:** PuTTY, FileZilla, WinSCP, TortoiseGit, TortoiseSVN

**危害等级:** 高危，可能导致身份伪造和供应链攻击

**影响版本:** PuTTY 0.68 to 0.80 (不含0.81), FileZilla < 3.67.0, WinSCP < 6.3.3, TortoiseGit < 2.15.0.1, TortoiseSVN <= 1.14.6

**利用条件:** 需要收集至少60个由易受攻击的PuTTY版本生成的ECDSA签名，或控制受害者连接的SSH服务器

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-31497 漏洞源于 PuTTY 0.68 到 0.80 版本中 ECDSA 签名过程中 nonce 生成的偏差。具体来说，nonce的生成方式导致其高位部分始终为零，这使得攻击者可以通过收集一定数量的签名（大约60个）来恢复用户的 NIST P-521 私钥。

**利用方式：**

1.  **签名收集：** 攻击者需要收集由易受攻击的 PuTTY 版本签名的消息。这些签名可能来自公开的 Git 仓库（如果使用 SSH 密钥进行 commit 签名），或者通过控制受害者连接的恶意 SSH 服务器获得。
2.  **私钥恢复：** 收集到足够的签名后，攻击者使用漏洞利用代码（如提供的 Python 脚本）来恢复私钥。该脚本利用数论和格理论中的技术（特别是 Hidden Number Problem）来解决由偏差 nonce 引起的方程。

**有效性：**

提供的 POC 代码似乎是有效的，因为它实现了利用该漏洞所需的数学和密码学算法。`README.md` 文件描述了漏洞的原理和利用所需的步骤，而 `main.py` 脚本实现了私钥恢复逻辑。测试脚本 `test.py` 也验证了私钥恢复的正确性。

**投毒风险：**

虽然无法完全排除投毒风险，但该存储库中的代码看起来相对清晰。`requirements.txt` 中列出的依赖项是标准密码学和数学库，没有发现可疑的组件。
查看代码，尤其是 `attack/ecdsa_hnp.py`，可以看到存在网络操作，例如：

```python
import socket
```
但是，并没有直接使用网络套接字发送任何数据. 

尽管如此，仍然存在一定程度的风险（估计为10%），因为攻击代码非常复杂，并且恶意代码可能隐藏在细微之处。需要对所有依赖项和代码进行彻底审计才能完全消除风险。

**总结：**

此漏洞是一个严重的安全问题，因为它允许攻击者恢复用户的私钥，从而可能导致身份盗用和供应链攻击。应尽快更新到受影响软件的修复版本。

**项目地址:** [HugoBond/CVE-2024-31497-POC](https://github.com/HugoBond/CVE-2024-31497-POC)

**漏洞详情:** [CVE-2024-31497](https://nvd.nist.gov/vuln/detail/CVE-2024-31497)