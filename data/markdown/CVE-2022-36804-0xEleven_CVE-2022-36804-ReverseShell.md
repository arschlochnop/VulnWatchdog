## CVE-2022-36804-Bitbucket-命令注入

**漏洞编号:** CVE-2022-36804

**漏洞类型:** 命令注入

**影响应用:** Atlassian Bitbucket Server/Data Center

**危害等级:** 高危，可导致远程代码执行

**影响版本:** < 8.3.1

**利用条件:** 需要对公共仓库具有读取权限或对私有仓库具有有效的`BITBUCKETSESSIONID` cookie

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-36804 是 Atlassian Bitbucket Server 和 Data Center 中的一个命令注入漏洞。具有公共仓库访问权限或对私有 Bitbucket 仓库具有读取权限的攻击者，可以通过发送恶意的 HTTP 请求来执行任意代码。 

**有效性:**
根据漏洞信息、搜索结果和提供的POC代码，该漏洞利用的有效性很高。漏洞库信息表明该漏洞已被公开披露且存在相应的修复版本。搜索结果也确认了该漏洞的存在，并提供了相关的分析和PoC。提供的PoC代码（`CVE-2022-36804-ReverseShell`）描述为一个“somewhat reliable PoC exploit”，表明它在某些情况下可能不稳定，但这通常与环境相关，不影响漏洞的整体有效性。PoC也说明支持公有仓库，并且对私有仓库可以使用session cookie，增加了其可用性。

**投毒风险:**
PoC代码中存在一定投毒风险，但可能性较低（估计为10%）。原因如下：
*   代码来源：该仓库基于 [https://github.com/BenHays142/CVE-2022-36804-PoC-Exploit](https://github.com/BenHays142/CVE-2022-36804-PoC-Exploit) 进行修改，由Chocapikk进行mass exploit和reverse shell功能的添加。这意味着存在引入恶意代码的可能性。
*   批量利用：PoC 包含批量扫描和利用的功能，攻击者可能会修改代码以大规模传播恶意软件。
*   命令执行： PoC 允许执行任意命令。虽然这是漏洞利用的一部分，但也为植入后门或恶意代码提供了途径。
需要仔细审查 `main.py` 文件，特别关注以下方面：
    *   是否有额外的网络请求，尝试下载或执行其他脚本。
    *   reverse shell是否被篡改，是否连接未知的地址和端口。
    *   参数解析部分，是否有隐藏的参数可以被恶意利用。
    *   批量扫描和利用功能，是否存在将结果发送到外部服务器的逻辑。

**利用方式:**
1.  **自动/手动 查找 Repository:** PoC 提供了自动查找可利用 Repository 的功能。如果自动查找失败，也可以手动指定 Repository。
2.  **发送恶意请求:**  利用脚本构造包含恶意参数的 HTTP 请求，目标 Bitbucket 服务器在处理这些参数时，会由于参数注入漏洞执行攻击者指定的命令。
3.  **执行命令:** 成功利用漏洞后，攻击者可以在目标服务器上执行任意命令。
4.  **反弹shell:** 可以使用 `--lhost` 和 `--lport` 参数建立反向 shell，从而完全控制目标服务器。
5. **会话维持:** 对于私有仓库，可以使用 `--session` 参数，提供有效的 `BITBUCKETSESSIONID` cookie。


**项目地址:** [0xEleven/CVE-2022-36804-ReverseShell](https://github.com/0xEleven/CVE-2022-36804-ReverseShell)

**漏洞详情:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)