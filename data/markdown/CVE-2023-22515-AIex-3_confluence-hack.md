## CVE-2023-22515-Atlassian Confluence Broken Access Control

**漏洞编号:** CVE-2023-22515

**漏洞类型:** Broken Access Control

**影响应用:** Atlassian Confluence Data Center and Server

**危害等级:** 高危，允许未经身份验证的攻击者创建管理员账户并完全控制 Confluence 实例

**影响版本:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**利用条件:** Confluence 实例需要公开访问，且处于未修复的版本范围内

**POC 可用性:** 是

**投毒风险:** 20%

## 详情

CVE-2023-22515 是 Atlassian Confluence Data Center 和 Server 中的一个严重漏洞，属于未授权访问控制漏洞。未经身份验证的远程攻击者可以通过利用此漏洞创建未经授权的 Confluence 管理员帐户，从而完全控制 Confluence 实例。

**有效性：**
提供的 `exploit.py` 脚本旨在利用 CVE-2023-22515 漏洞，通过发送特制的 HTTP 请求来创建一个新的管理员用户。脚本首先检查目标 Confluence 实例是否处于“Setup Successful”模式，这是漏洞利用的前提条件。如果满足条件，脚本会向 `/setup/setupadministrator.action` 端点发送 POST 请求，其中包含新管理员的用户名、密码和电子邮件地址等信息。成功创建管理员帐户后，脚本会尝试使用新创建的凭据验证登录，以确认漏洞利用成功。

根据提供的 `README.md` 文件，此漏洞已在 Confluence Server 8.5.1 上成功测试。

**投毒风险：**
虽然主要的 `exploit.py` 脚本看起来是直接实现了漏洞利用，但需要关注 `plugin_shellplug.jar` 和 `ShellServlet.java` 文件。`plugin_shellplug.jar` 是一个 Confluence 插件，提供了一个基于 Web 的 shell 接口，允许在服务器上执行命令行命令。`ShellServlet.java` 是该插件的反编译代码。如果攻击者成功利用 CVE-2023-22515 创建了管理员帐户，他们可以使用 Confluence 的 Web 管理 GUI 安装此恶意插件。插件安装后，攻击者可以通过 Web 界面执行任意命令，从而实现远程代码执行。

投毒风险评估：
*   `exploit.py`：虽然此脚本本身是漏洞利用工具，但并非恶意代码。0%
*   `plugin_shellplug.jar` 和 `ShellServlet.java`：这些文件包含一个 Web shell 插件，允许远程代码执行。这部分代码存在潜在的投毒风险。100%。此代码虽然是后门,但是否是作者本人添加存在争议,所以评估为投毒风险.

综合考虑，仓库整体的投毒风险评估为20%。虽然 `exploit.py` 本身没有投毒风险，但其中包含的 `plugin_shellplug.jar` 及其反编译的 `ShellServlet.java` 文件引入了远程代码执行的后门，如果使用者不加分析直接使用，可能会导致更大的安全风险。

**利用方式：**
1.  **检查目标 Confluence 实例是否易受攻击：** 通过访问 `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false` 检查 Confluence 是否处于未完成设置的状态。
2.  **创建管理员帐户：** 如果 Confluence 处于未完成设置的状态，则使用 `exploit.py` 脚本通过向 `/setup/setupadministrator.action` 发送 POST 请求来创建一个新的管理员帐户。
3.  **登录 Confluence：** 使用新创建的管理员帐户登录 Confluence。
4.  **安装恶意插件：** 在 Confluence 的 Web 管理 GUI 中安装 `plugin_shellplug.jar` 插件。
5.  **执行任意命令：** 通过插件提供的 Web shell 界面执行任意命令，从而实现远程代码执行。

**项目地址:** [AIex-3/confluence-hack](https://github.com/AIex-3/confluence-hack)

**漏洞详情:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)