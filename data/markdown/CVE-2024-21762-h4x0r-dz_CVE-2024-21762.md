## CVE-2024-21762 FortiOS/FortiProxy 远程代码执行

**漏洞编号:** CVE-2024-21762

**漏洞类型:** 越界写入 (Out-of-Bounds Write)

**影响应用:** FortiOS/FortiProxy

**危害等级:** 高危，可导致远程代码执行

**影响版本:** FortiOS: 7.4.0-7.4.2, 7.2.0-7.2.6, 7.0.0-7.0.13, 6.4.0-6.4.14, 6.2.0-6.2.15, 6.0.0-6.0.17; FortiProxy: 7.4.0-7.4.2, 7.2.0-7.2.8, 7.0.0-7.0.14, 2.0.0-2.0.13, 1.2.0-1.2.13, 1.1.0-1.1.6, 1.0.0-1.0.7

**利用条件:** 需要网络访问，目标设备开启SSL VPN功能

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-21762 是 FortiOS 和 FortiProxy 中 SSL VPN 组件中的一个越界写入漏洞。未经身份验证的远程攻击者可以通过精心设计的请求利用此漏洞执行任意代码或命令。

**漏洞利用方式：**

1.  **触发漏洞：** 攻击者发送特制的 HTTP POST 请求到 `/remote/hostcheck_validate` 路径，利用chunked编码处理中的缺陷触发越界写入。
2.  **内存破坏：** 通过构造包含特定 ROP 链和 shellcode 的请求体，攻击者覆盖内存中的关键数据，控制程序执行流程。
3.  **代码执行：** ROP 链用于禁用地址空间布局随机化 (ASLR) 并执行 shellcode，从而获得系统权限并执行恶意代码。
4.  **反弹shell:**  通过执行`/bin/node`命令来执行一段 JavaScript payload，该payload尝试连接到攻击者控制的IP地址和端口 (192.168.1.197:4242)，从而建立反弹shell。

**有效性：**

根据搜索引擎结果和漏洞利用代码，此漏洞已被积极利用。多个安全厂商（如Tenable、Rapid7、Bishop Fox、Assetnote）都发布了关于此漏洞的分析报告和利用工具，证明了POC代码的有效性。

**投毒风险：**

代码中存在与远程主机建立连接的反弹 shell 代码，但这是漏洞验证的一部分，用于证明远程代码执行。将此代码判定为投毒代码不合理。
综合评估，该代码库存在一定投毒的可能性，可能性为5%。主要考虑到以下因素：
    * 漏洞验证使用反弹shell, 具有一定的隐蔽性。
    * 其他未知的恶意行为。

**修复建议：**

尽快升级到 FortiOS 和 FortiProxy 的修复版本，如 FortiOS 7.6.0 或更高版本，或者 FortiOS 7.4.3 或更高版本。


**项目地址:** [h4x0r-dz/CVE-2024-21762](https://github.com/h4x0r-dz/CVE-2024-21762)

**漏洞详情:** [CVE-2024-21762](https://nvd.nist.gov/vuln/detail/CVE-2024-21762)