## CVE-2023-40931-Nagios XI-SQL注入

**漏洞编号:** CVE-2023-40931

**漏洞类型:** SQL注入

**影响应用:** Nagios XI

**危害等级:** 高危，可能导致数据泄露和远程代码执行

**影响版本:** 5.11.0 <= version <= 5.11.1

**利用条件:** 需要有效的Nagios XI用户身份验证

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2023-40931 是 Nagios XI 5.11.0 到 5.11.1 版本中存在的一个 SQL 注入漏洞。经验证，该漏洞的POC代码是有效的。攻击者需要首先通过身份验证，然后利用 `/nagiosxi/admin/banner_message-ajaxhelper.php` 接口中的 `id` 参数，通过 POST 请求发送恶意构造的 SQL 语句。该漏洞允许经过身份验证的攻击者执行任意 SQL 命令，可能导致未经授权的数据访问、修改或删除，甚至可能通过数据库执行操作系统命令（如果数据库配置允许）。

**利用方式分析：**

1.  **身份验证：** 利用代码首先使用提供的用户名和密码向 `/api/v1/authenticate` 端点进行身份验证，以获取身份验证令牌。
2.  **获取会话Cookie：** 使用获取到的token请求`/index.php?token={auth_token}`,这样nagiosxi可以设置正确的会话cookie。
3.  **SQL 注入：** 获取身份验证令牌后，将使用该令牌向 `/admin/banner_message-ajaxhelper.php` 端点发送包含恶意 SQL 负载的 POST 请求。`id` 参数被用于注入 SQL 代码。
4.  **数据提取：** 该漏洞利用代码使用 `sqlmap` 工具来自动执行 SQL 注入，并转储整个数据库内容。 `sqlmap` 通过构造的cookie，并指定可注入的参数`id`，从而dump数据库。

**投毒风险分析：**

对提供的POC代码进行分析，未发现明显的恶意或后门代码。该代码主要用于利用 SQL 注入漏洞并提取数据。它使用标准的 `requests` 库进行 HTTP 请求，并使用 `subprocess` 模块调用 `sqlmap` 工具。没有发现任何隐藏的恶意行为或未经授权的数据传输。代码虽然会输出数据库内容，但这属于利用漏洞的预期行为，而不是投毒行为。


**项目地址:** [datboi6942/Nagios-XI-s-CVE-2023-40931-Exploit](https://github.com/datboi6942/Nagios-XI-s-CVE-2023-40931-Exploit)

**漏洞详情:** [CVE-2023-40931](https://nvd.nist.gov/vuln/detail/CVE-2023-40931)