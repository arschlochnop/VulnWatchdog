## CVE-2023-22527-Atlassian Confluence-RCE

**漏洞编号:** CVE-2023-22527

**漏洞类型:** 模板注入/RCE

**影响应用:** Atlassian Confluence Server/Data Center

**危害等级:** 高危，允许未授权的远程代码执行

**影响版本:** 8.0.0 <= version < 8.5.4

**利用条件:** 目标Confluence实例版本在受影响范围内，并且网络可达。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-22527 是 Atlassian Confluence Server 和 Data Center 中存在的模板注入漏洞。未经身份验证的攻击者可以利用此漏洞通过注入恶意代码执行任意代码。

**有效性：**
根据漏洞描述信息和搜索结果，该漏洞已被积极利用。多个搜索结果(webpage 1, 3, 5, 6, 7, 9)表明该漏洞可以实现远程代码执行（RCE），且漏洞利用的细节和方法已经被公开。
提供的代码片段似乎是Confluence的 Velocity 模板文件，并非直接的漏洞利用代码。但是，模板注入漏洞的利用通常涉及到修改或上传恶意模板，从而在服务器端执行恶意代码。这些模板本身并无恶意，是Confluence正常使用的模板。攻击者会构造特定的OGNL表达式作为输入，触发模板引擎执行恶意代码。

**投毒风险：**
提供的代码是Confluence的Velocity模板文件，例如404.vm、405.vm等，它们本身不包含明显的恶意代码。判断投毒风险需要考虑作者是否在其他地方隐藏了恶意Payload，例如通过编码、混淆等方式嵌入到这些文件中。由于仅仅是模板文件，并没有发现直接执行命令的代码， 因此判断投毒风险较低，约为5%。攻击者可能会使用这些正常的模板文件作为跳板，构建恶意请求，最终触发远程代码执行。

**利用方式：**
该漏洞的利用方式是OGNL表达式注入。攻击者通过构造恶意的OGNL表达式作为输入，利用Confluence的模板引擎执行任意Java代码，从而实现远程代码执行。由于该漏洞无需身份验证，攻击者可以直接发送恶意请求到目标Confluence服务器，执行任意命令。利用方式通常涉及到以下步骤：
1.  确定目标Confluence服务器的URL。
2.  构造包含恶意OGNL表达式的HTTP请求。
3.  发送请求到目标服务器。
4.  服务器解析请求中的OGNL表达式，执行攻击者注入的恶意代码。

**项目地址:** [Sudistark/patch-diff-CVE-2023-22527](https://github.com/Sudistark/patch-diff-CVE-2023-22527)

**漏洞详情:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)