## CVE-2024-36401 - GeoServer 远程代码执行

**漏洞编号:** CVE-2024-36401

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** GeoServer

**危害等级:** 高危，可能导致完全系统控制

**影响版本:** 受影响版本：< 2.22.6, >= 2.23.0 < 2.23.6, >= 2.24.0 < 2.24.4, >= 2.25.0 < 2.25.2

**利用条件:** 目标GeoServer实例运行在受影响的版本上，且允许网络访问。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-36401 是 GeoServer 中的一个远程代码执行 (RCE) 漏洞。该漏洞源于 GeoTools 库 API 不安全地将属性名称作为 XPath 表达式传递给 commons-jxpath 库进行评估，从而允许未经身份验证的用户通过特制的OGC请求执行任意代码。 

**有效性：**
根据漏洞库信息、搜索引擎结果（多个安全厂商已确认该漏洞被利用）和提供的漏洞利用代码，可以判定此漏洞是有效的，并且已经被积极利用。

**投毒风险：**
漏洞利用代码 `exploit.py` 主要是实现漏洞利用的功能，从代码结构和功能来看，投毒风险较低。主要功能是发送恶意请求，监听反弹shell。代码中也定义了一些参数，比如远程IP、远程端口、代理等等。代码比较清晰，逻辑简单。但是依然不能排除作者在某些不明显的代码中加入恶意代码的可能性，特别是代码涉及到网络请求和系统命令执行。因此，评估投毒风险为 10%。

**利用方式：**
1.  **漏洞触发：** 攻击者通过构造恶意的OGC请求（例如 WFS GetFeature, WFS GetPropertyValue, WMS GetMap, WMS GetFeatureInfo, WMS GetLegendGraphic 和 WPS Execute 请求），其中包含特制的XPath表达式。这些请求会被GeoServer处理，并将属性名称传递给 commons-jxpath 库。
2.  **代码执行：** commons-jxpath 库在评估这些XPath表达式时，会执行攻击者注入的恶意代码。
3.  **反弹 Shell (POC中方式)：** 漏洞利用代码会启动一个监听器，然后在目标系统上执行命令以反弹 shell 到攻击者的机器上。  `exploit.py` 脚本允许攻击者指定目标 URL、攻击者 IP 地址和端口。通过命令行参数 `--url`, `--remote-ip`, 和 `--remote-port` 设置。
4.  **批量扫描:** 漏洞利用代码还支持批量扫描，通过 `--check <file_with_urls>` 指定包含URL列表的文件， `--threads <number_of_threads>`  指定线程数， `--output <output_file>` 指定输出文件。

**项目地址:** [Chocapikk/CVE-2024-36401](https://github.com/Chocapikk/CVE-2024-36401)

**漏洞详情:** [CVE-2024-36401](https://nvd.nist.gov/vuln/detail/CVE-2024-36401)