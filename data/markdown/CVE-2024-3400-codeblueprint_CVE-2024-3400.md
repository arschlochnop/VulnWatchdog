## CVE-2024-3400 PAN-OS GlobalProtect 命令注入

**漏洞编号:** CVE-2024-3400

**漏洞类型:** 命令注入

**影响应用:** PAN-OS GlobalProtect

**危害等级:** 严重，未授权的攻击者可以root权限执行任意代码

**影响版本:** PAN-OS 10.2 (< 10.2.9-h1), 11.0 (< 11.0.4-h1), 11.1 (< 11.1.2-h3)

**利用条件:** 需要目标设备配置了GlobalProtect网关或GlobalProtect Portal，并且漏洞版本在影响范围内

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-3400 是 Palo Alto Networks PAN-OS 软件 GlobalProtect 功能中的一个命令注入漏洞。由于任意文件创建漏洞，未经身份验证的攻击者可以在具有 root 权限的防火墙上执行任意代码。

**有效性评估：**

提供的 Python POC 代码 `/tmp/0de44055d5df69da649501894bfd0c34/CVE-2024-3400_upload_check.py` 尝试通过在 `/var/appweb/sslvpndocs/global-protect/portal/images/` 目录下上传一个随机命名的 `.txt` 文件来验证漏洞的存在。该脚本首先检查目标是否存在，然后尝试上传文件，并通过检查文件是否存在来验证上传是否成功。搜索引擎结果和漏洞库信息表明该漏洞确实存在，并且有公开可用的 PoC。

**投毒风险评估：**

分析提供的代码后，投毒风险较低。该脚本主要用于验证目标是否存在漏洞，而不是执行恶意操作。唯一可能需要注意的是，该脚本会在目标文件系统上创建一个测试文件，但脚本本身提供了删除该文件的说明。

*   代码逻辑较为简单，主要功能是上传和检查文件，没有发现明显的恶意行为。
*   脚本需要用户手动输入目标 URL，降低了大规模自动化攻击的风险。
*   脚本的目的是验证漏洞存在，而不是利用漏洞执行恶意操作。
*  存在非常低的风险：脚本在成功上传后，提示用户手动删除上传的文件。如果攻击者利用此脚本，但没有清除测试文件，可能会留下痕迹，但这不是恶意投毒，而是利用不当的副作用。

综合考虑，该 POC 代码的投毒风险约为 5%。

**利用方式：**

1.  **漏洞原理：** 该漏洞是由于 PAN-OS GlobalProtect 在处理特定请求时，允许攻击者创建任意文件，进而导致命令注入。具体来说，攻击者可以通过构造包含恶意代码的文件名，并利用 GlobalProtect 的文件处理逻辑来执行系统命令。
2.  **利用步骤：**
    *   攻击者首先需要确定目标 PAN-OS 设备是否配置了 GlobalProtect 并且版本在受影响范围内。
    *   攻击者构造一个包含恶意代码的文件名，例如 `test.txt; <command>`，其中 `<command>` 是要执行的系统命令。
    *   攻击者通过构造特定的 HTTP 请求，将包含恶意代码的文件名传递给 GlobalProtect。
    *   GlobalProtect 在处理该请求时，会尝试创建该文件，由于文件名包含恶意代码，导致系统命令被执行。
3.  **影响：** 成功利用该漏洞后，攻击者可以获得目标设备的 root 权限，从而可以执行任意操作，例如窃取敏感数据、安装后门、篡改系统配置等。

根据漏洞库信息，缓解措施包括升级到修复后的 PAN-OS 版本，或使用威胁防御签名来阻止攻击。

**项目地址:** [codeblueprint/CVE-2024-3400](https://github.com/codeblueprint/CVE-2024-3400)

**漏洞详情:** [CVE-2024-3400](https://nvd.nist.gov/vuln/detail/CVE-2024-3400)