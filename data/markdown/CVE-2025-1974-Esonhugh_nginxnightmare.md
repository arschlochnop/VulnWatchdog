## CVE-2025-1974-ingress-nginx-RCE

**漏洞编号:** CVE-2025-1974

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** ingress-nginx

**危害等级:** 严重，未经身份验证的攻击者可以访问 Pod 网络，并在 ingress-nginx 控制器的上下文中执行任意代码，可能导致集群范围内的 Secrets 泄露。

**影响版本:** <=1.11.4, 1.12.0

**利用条件:** 需要访问 Pod 网络。默认安装下，控制器可以访问所有集群范围内的 Secret。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2025-1974 是 Kubernetes ingress-nginx 中的一个严重漏洞，允许未经身份验证的攻击者在一定条件下通过 Pod 网络实现远程代码执行。该漏洞存在于 Validating Admission Controller 中，允许攻击者注入任意 Nginx 指令。 

**有效性：**

根据漏洞库信息、搜索引擎结果和提供的漏洞利用代码，可以判断该 POC 代码有效。搜索结果中提到存在公开可用的 RCE 漏洞利用，且POC代码直接关联了 `ingressnightmare`，对应了Wiz的研究成果，并针对反向shell、绑定shell以及命令执行提供了不同的模式。POC 代码针对 `ingress-nginx` 进行了漏洞利用。

**投毒风险：**

分析提供的 POC 代码，`/tmp/a8e962fb8838320afa4e94d5cf0cc187/cmd.go` 文件是主程序入口，定义了各种攻击模式（反向 shell，绑定 shell，命令执行），并根据用户选择的模式生成相应的 Nginx 配置，然后利用漏洞执行。代码中未发现明显的恶意代码或后门。`go.mod` 文件声明了项目依赖，属于正常。虽然不能100%保证没有隐藏的投毒代码（例如，对依赖包的供应链攻击），但从目前的代码来看，投毒可能性较低，大约 1%。这个可能性很低，主要是基于对直接提供的代码的分析，无法确定是否存在深层次的、隐藏的依赖关系投毒。

**利用方式：**

1.  **漏洞触发点：** 漏洞的核心在于 Ingress Nginx 的 Admission Controller 对 Nginx 配置的验证不严格，允许注入恶意的 Nginx 配置指令。
2.  **攻击步骤：**
    *   攻击者需要能够访问 Pod 网络。
    *   利用工具(POC)构造包含恶意 Nginx 指令的 Ingress 资源。
    *   将构造的 Ingress 资源提交给 Kubernetes API Server。
    *   Admission Controller 接收到 Ingress 资源后，没有正确验证恶意指令，导致其被写入 Nginx 配置文件。
    *   Nginx 重新加载配置，执行恶意指令，实现 RCE。
3.  **利用方式：**
    *   **反向 Shell：** 攻击者可以利用该漏洞在 Ingress Nginx 容器内执行系统命令，反弹一个 shell 到攻击者控制的机器上，从而完全控制 Ingress Nginx。
    *   **绑定 Shell：** 攻击者在目标机器上绑定一个端口，通过连接该端口，可以获得 shell。
    *   **命令执行：** 攻击者可以执行任意命令，例如读取敏感文件（Secrets），修改系统配置等。

**项目地址:** [Esonhugh/nginxnightmare](https://github.com/Esonhugh/nginxnightmare)

**漏洞详情:** [CVE-2025-1974](https://nvd.nist.gov/vuln/detail/CVE-2025-1974)