## CVE-2013-3900 WinVerifyTrust Signature Validation Vulnerability

**漏洞编号:** CVE-2013-3900

**漏洞类型:** 签名验证绕过

**影响应用:** Microsoft Windows

**危害等级:** 中危，可能导致恶意代码执行

**影响版本:** 受影响的Windows版本众多，包括Windows 10和Windows 11等。具体版本请参考漏洞库信息。

**利用条件:** 需要用户运行或安装被修改的、带有恶意填充的签名PE文件。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2013-3900 漏洞存在于 WinVerifyTrust 函数处理 Windows Authenticode 签名验证的方式中。攻击者可以通过修改已签名的可执行文件，在不破坏签名的情况下，添加恶意代码。 

**有效性：**
提供的PoC代码(`CVE-2013-3900-PoC-padding-injection.ps1`) 旨在通过在签名PE文件的证书表中注入填充数据来利用此漏洞。脚本首先读取输入文件，解析PE结构，定位证书表，然后添加指定数量的填充字节。最后，脚本更新证书表的大小和文件长度，并将修改后的文件写入输出。脚本还会检查原始文件和修改后文件的 Authenticode 签名状态，并使用 `WinVerifyTrust` 函数进行验证。

**投毒风险：**
PoC代码本身的主要目的是演示漏洞利用，但仍存在潜在的投毒风险，例如：
*   **Payload携带：** 脚本可以被修改以在填充数据中嵌入恶意payload，从而在目标系统上执行恶意代码。
*   **后门植入：** 攻击者可能在脚本中添加后门代码，以便在目标系统上建立持久访问。

考虑到脚本的目的是演示签名绕过，且主要功能是填充数据，因此投毒风险较低，但不可忽视。这里评估投毒风险为10%。

**利用方式：**
1.  **选择目标PE文件：** 选择一个已签名（embedded-signed）的PE文件作为目标。
2.  **运行PoC脚本：** 使用提供的 PowerShell 脚本 (`CVE-2013-3900-PoC-padding-injection.ps1`)，指定输入文件、输出文件和填充字节数。
3.  **脚本执行过程：**
    *   脚本会读取目标PE文件。
    *   解析PE文件头，定位到证书表。
    *   在证书表中插入指定数量的填充字节。
    *   更新证书表的大小和文件长度。
    *   将修改后的文件写入输出文件。
4.  **签名验证绕过：** 修改后的PE文件，虽然被添加了填充数据，但签名仍然有效，可以通过 WinVerifyTrust 函数的验证，从而绕过签名验证机制。
5.  **执行恶意代码：** 如果填充数据中包含恶意代码，则在执行修改后的PE文件时，恶意代码也会被执行。

**项目地址:** [Kramcov/CVE-2013-3900-PowerShell-PoC](https://github.com/Kramcov/CVE-2013-3900-PowerShell-PoC)

**漏洞详情:** [CVE-2013-3900](https://nvd.nist.gov/vuln/detail/CVE-2013-3900)