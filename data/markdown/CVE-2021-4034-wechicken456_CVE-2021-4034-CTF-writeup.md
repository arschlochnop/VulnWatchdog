## CVE-2021-4034 PwnKit 本地权限提升

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地权限提升

**影响应用:** Polkit pkexec

**危害等级:** 高危，允许低权限用户获得 root 权限

**影响版本:** 所有版本（在修复之前）

**利用条件:** 目标系统必须安装了存在漏洞的 polkit pkexec 组件。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-4034 漏洞，又名 PwnKit，存在于 polkit 的 pkexec 工具中。Pkexec 是一个 setuid 工具，旨在允许非特权用户根据预定义的策略以特权用户身份运行命令。该漏洞是由于 pkexec 没有正确处理调用参数计数，导致尝试将环境变量作为命令执行。攻击者可以通过精心构造环境变量来诱使 pkexec 执行任意代码，从而获得 root 权限。

**有效性评估：**

漏洞库信息、搜索引擎结果和提供的漏洞利用代码（CTF 挑战）都表明该漏洞是真实存在的，并且有可用的利用代码。搜索引擎结果中来自 Qualys、Red Hat 和其他安全机构的报告证实了该漏洞的严重性和影响。

**投毒风险评估：**

提供的代码仓库是一个 CTF 挑战，旨在让参与者利用 CVE-2021-4034 漏洞。虽然代码本身是为了演示和学习目的而编写的，但存在一些潜在的投毒风险。

1.  **依赖项风险：** Dockerfile不完整，依赖玩家手动安装存在漏洞的内核和软件包。如果玩家从不可信的源下载或安装这些依赖项，可能会引入恶意软件。

2.  **CTF 设计陷阱：** CTF 挑战的目的是测试参与者的技能，但也可能包含隐藏的陷阱或后门，这些陷阱或后门可能与漏洞本身无关。这些陷阱可能会误导参与者，或者在不知情的情况下执行恶意代码。

3.  **`shelly.so`潜在风险：** `shelly.so` 被描述为 helper binary，但没有进行详细分析。虽然 CTF 挑战可能需要使用此二进制文件来完成，但始终存在二进制文件中包含恶意代码的可能性。

考虑到以上几点，保守估计投毒风险为 10%。这种风险主要是由不完整的构建环境、CTF 设计陷阱的可能性以及二进制文件的潜在风险造成的。

**利用方式分析：**

1.  **环境准备：** 搭建存在漏洞的 polkit pkexec 环境，包括安装指定版本的 `libpolkit-gobject-1-0`、`libpolkit-agent-1-0` 和 `policykit-1`。
2.  **利用代码：** 利用已知的 PoC 代码（例如，通过构造特殊的环境变量）触发 pkexec 中的漏洞。
3.  **权限提升：** 成功利用漏洞后，攻击者可以执行任意代码，从而获得 root 权限。

**项目地址:** [wechicken456/CVE-2021-4034-CTF-writeup](https://github.com/wechicken456/CVE-2021-4034-CTF-writeup)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)