## CVE-2025-32463-Sudo-本地权限提升

**漏洞编号:** CVE-2025-32463

**漏洞类型:** 本地权限提升

**影响应用:** Sudo

**危害等级:** 高危，本地用户可获取root权限

**影响版本:** 1.9.14 <= version < 1.9.17p1

**利用条件:** 需要本地sudo权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2025-32463是Sudo中的一个本地权限提升漏洞。该漏洞源于在使用`--chroot`选项时，Sudo允许从用户控制的目录中使用`/etc/nsswitch.conf`。攻击者可以创建一个包含恶意`nsswitch.conf`文件的目录，并使用`sudo -R`命令更改根目录到该恶意目录。Sudo将在chroot环境加载攻击者控制的NSS模块，由于加载NSS模块在权限降低之前，因此攻击者可以在root权限下执行任意代码。

**有效性：**

根据漏洞描述和提供的PoC代码，该漏洞利用是有效的。PoC通过创建一个包含恶意`nsswitch.conf`的chroot环境，并使用`sudo -R`来加载恶意NSS模块，从而实现权限提升，成功创建一个setuid root shell。

**投毒风险：**

PoC代码中存在一定的投毒风险，风险概率评估为10%。`sudoinject.sh`脚本的主要功能是创建包含恶意`nsswitch.conf`和`libnss_*`的chroot环境，并使用`sudo -R`命令触发漏洞。`sudo2root.c`文件是关键的恶意NSS模块，它包含一个构造函数`exploit_constructor`，该构造函数在模块加载时执行，将当前进程的uid和gid设置为0（root），然后创建一个setuid root shell。潜在的投毒风险存在于以下几个方面：

1.  **Setuid Shell行为更改：** 攻击者可能修改创建的setuid shell的行为，例如，在创建shell时添加额外的后门功能，如反向shell或其他恶意代码，尽管PoC中看起来相对干净，但是用户不注意的情况下可能存在风险。
2.  **依赖的第三方组件或库：** 脚本依赖gcc编译，若gcc被篡改，可能存在风险
3.  **环境变量的利用：**  恶意行为者可能会尝试操纵环境变量以改变脚本的执行流程，或是在不知情的状况下执行。


**利用方式：**

1.  **准备恶意Chroot环境：** 创建一个目录，包含恶意的`etc/nsswitch.conf`文件和一个定制的NSS模块（`libnss_*.so`）。`nsswitch.conf`文件配置为使用该定制的NSS模块解析用户和组信息。
2.  **编译恶意NSS模块：**  编译一个共享对象（`.so`文件），其中包含一个在加载时执行的构造函数。这个构造函数会修改进程的用户和组ID为root，然后创建一个setuid root shell。
3.  **使用`sudo -R`触发漏洞：**  使用`sudo -R <chroot_dir> <command>`命令，将根目录更改为包含恶意`nsswitch.conf`文件的目录。当Sudo尝试加载NSS模块时，会加载攻击者提供的恶意模块。
4.  **权限提升：**  由于NSS模块在root权限下加载，恶意模块中的构造函数会执行，创建一个setuid root shell，攻击者可以使用该shell执行任意命令。

**项目地址:** [Mikivirus0/sudoinjection](https://github.com/Mikivirus0/sudoinjection)

**漏洞详情:** [CVE-2025-32463](https://nvd.nist.gov/vuln/detail/CVE-2025-32463)