## CVE-2021-43798-Grafana-目录遍历

**漏洞编号:** CVE-2021-43798

**漏洞类型:** 目录遍历

**影响应用:** Grafana

**危害等级:** 高危，可能导致敏感信息泄露

**影响版本:** 8.0.0-beta1 to 8.3.0 (除了已修复的版本)

**利用条件:** 需要能够访问 Grafana 实例的网络连接

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2021-43798 存在于 Grafana 的目录遍历漏洞，允许未经身份验证的攻击者通过 `public/plugins/<plugin_id>` 路径读取服务器上的任意文件。PoC 代码通过构造包含目录遍历序列（如 `../../..`）的 URL，尝试读取敏感文件，如 `/etc/passwd` 或 `win.ini`。利用方式是：

1.  **确定目标 Grafana 版本**：攻击者需要确定目标 Grafana 实例的版本，判断其是否属于受影响的范围（8.0.0-beta1 到 8.3.0）。
2.  **选择插件 ID**：攻击者需要选择一个已安装的插件 ID。 PoC 代码中提供了一个插件 ID 列表。
3.  **构造恶意 URL**：攻击者构造包含目录遍历序列的恶意 URL，指向目标文件。URL 格式为 `<grafana_host_url>/public/plugins/<plugin_id>/../../../../../../../../../../../../../../../../../../../<目标文件>`。
4.  **发送 HTTP 请求**：攻击者向构造的恶意 URL 发送 HTTP GET 请求。
5.  **读取文件内容**：如果漏洞存在且利用成功，服务器将返回目标文件的内容。

PoC代码中存在以下可能导致误报或利用失败的情况：

*   **插件ID不存在:** 如果提供的`plugin_ids` 列表中的任何ID 在目标服务器上不存在，利用将会失败。
*   **文件权限限制:**  即使成功绕过目录遍历，如果 Grafana 进程没有读取目标文件的权限，也无法成功读取文件内容。
*   **目标文件不存在:**  尝试读取不存在的文件会返回错误信息，导致利用失败。

代码中投毒风险较低。虽然没有明显的恶意代码，但仍然存在一些潜在的风险：

*   **信息收集:** PoC 代码会发送 HTTP 请求到目标服务器，服务器可能会记录攻击者的 IP 地址等信息。
*   **拒绝服务:** 大量并发的 PoC 请求可能会导致目标服务器的拒绝服务。

**项目地址:** [K3ysTr0K3R/CVE-2021-43798-EXPLOIT](https://github.com/K3ysTr0K3R/CVE-2021-43798-EXPLOIT)

**漏洞详情:** [CVE-2021-43798](https://nvd.nist.gov/vuln/detail/CVE-2021-43798)