## CVE-2021-25646-ApacheDruid远程命令执行

**漏洞编号:** CVE-2021-25646

**漏洞类型:** 远程代码执行

**影响应用:** Apache Druid

**危害等级:** 高危，可完全控制服务器

**影响版本:** <= 0.20.0

**利用条件:** 需要目标Druid实例版本小于等于0.20.0，且攻击者需要能够发送HTTP请求到Druid的indexer服务

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-25646 允许经过身份验证的用户通过构造恶意请求，绕过服务器配置执行任意JavaScript代码，从而导致远程代码执行。该漏洞利用方式主要是发送POST请求到/druid/indexer/v1/sampler接口，请求体包含精心构造的JSON数据，该数据中嵌入了恶意JavaScript代码。POC有效性分析：提供的POC代码使用Wker脚本编写，通过定义dir变量指定漏洞接口，post变量定义了包含恶意JavaScript的JSON数据。脚本首先获取DNSLog域名，替换post中的占位符，然后发送POST请求，并通过检查DNSLog记录来验证漏洞是否存在。利用方式：

1.  目标系统运行着Apache Druid 0.20.0或更早版本。
2.  攻击者能够通过网络访问Druid的indexer服务。
3.  攻击者运行提供的Wker脚本，输入目标Druid实例的URL。
4.  脚本发送包含恶意JavaScript代码的POST请求到/druid/indexer/v1/sampler。
5.  如果漏洞存在，Druid服务器将执行恶意JavaScript代码，并向DNSLog服务器发送DNS查询。
6.  脚本通过检查DNSLog记录来确认漏洞是否存在。
投毒风险分析：查看了仓库中的所有文件，包括主脚本和dns.wker。dns.wker主要功能是获取dnslog的域名和cookie，并查询dnslog的结果。主脚本将dnslog域名插入到payload中，发送到目标服务器，检测是否存在漏洞，根据dnslog的结果判断是否执行成功。并没有发现恶意代码，因此投毒风险为0%。

**项目地址:** [givemefivw/CVE-2021-25646](https://github.com/givemefivw/CVE-2021-25646)

**漏洞详情:** [CVE-2021-25646](https://nvd.nist.gov/vuln/detail/CVE-2021-25646)