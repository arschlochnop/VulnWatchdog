## CVE-2025-38001-Linux Kernel HFSC Eltree Use-After-Free

**漏洞编号:** CVE-2025-38001

**漏洞类型:** Use-After-Free

**影响应用:** Linux Kernel

**危害等级:** 高危，可能导致权限提升和代码执行

**影响版本:** Linux kernel versions 5.0 to versions before fixes in 5.4.294, 5.10.238, 5.15.185, 6.1.141, 6.6.93, 6.12.32, 6.14.10, 6.15.1, and 6.16-rc1

**利用条件:** 需要CAP_NET_ADMIN权限或者能够触发网络流量控制的操作

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2025-38001 漏洞是 Linux 内核中 HFSC (Hierarchical Fair Service Curve) 调度器中的一个 Use-After-Free 漏洞。该漏洞允许攻击者通过重入enqueue操作，将类（class）重复添加到eltree中，导致在hfsc_dequeue函数中出现UAF。漏洞利用涉及配置HFSC调度器，使用NETEM，并结合TBF来阻止数据包出队，从而触发eltree中的UAF。

**有效性评估：**
从提供的漏洞信息和漏洞利用代码来看，POC 代码是有效的。`README.md` 描述了该 POC 在 kernelCTF 和 Debian 12 上的成功利用，并说明了漏洞修复的 commit ID。POC 利用了 RBTree 转换来进行 page-level data-only attack。`exploit.c` 包含了利用该漏洞所需的必要代码，例如网络命名空间设置、流量控制配置和 UAF 触发逻辑。搜索结果也确认了该漏洞的存在和影响。

**投毒风险评估：**
分析`exploit.c`代码后，未发现明显的恶意或投毒代码。代码结构清晰，主要功能集中在设置网络环境、配置流量控制以及触发漏洞。虽然代码本身旨在利用漏洞，但没有证据表明存在与漏洞利用无关的恶意行为，如安装后门或收集用户信息。可能的投毒风险主要在于依赖的 `netlink_utils.h` 文件，但由于没有该文件的内容，只能假设其功能是辅助 Netlink 通信，风险较低。 总体投毒风险估计为10%，因为代码逻辑主要围绕漏洞利用展开，但仍需进一步审查依赖项以排除任何隐藏的恶意行为。

**利用方式：**
1.  **环境准备：** 设置网络命名空间，以便隔离网络配置。
2.  **创建虚拟网络接口：** 创建虚拟网络接口（veth pair），用于发送和接收数据包。
3.  **配置流量控制 (TC)：** 使用 `tc` 命令配置 HFSC 调度器，并将其与 NETEM 和 TBF 结合使用。
4.  **触发漏洞：** 通过特定的数据包流量模式和TC配置，触发重入enqueue操作，将类（class）重复添加到eltree中，最终导致 Use-After-Free。
5.  **利用UAF：** UAF 发生后，攻击者可以通过精心构造的堆布局来控制被释放的内存，实现代码执行或者其他恶意目的。
6.  **提权：** 通过控制内核内存，可能覆盖内核对象，最终实现权限提升。

**项目地址:** [0xdevil/CVE-2025-38001](https://github.com/0xdevil/CVE-2025-38001)

**漏洞详情:** [CVE-2025-38001](https://nvd.nist.gov/vuln/detail/CVE-2025-38001)