## CVE-2025-1974-ingress-nginx-RCE

**漏洞编号:** CVE-2025-1974

**漏洞类型:** 远程代码执行

**影响应用:** ingress-nginx

**危害等级:** 高危，可能导致集群范围内secrets泄露和远程代码执行

**影响版本:** <= 1.11.4, 1.12.0

**利用条件:** 需要访问Pod网络的权限

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2025-1974 是 Kubernetes ingress-nginx 中的一个高危漏洞，允许未经身份验证的攻击者通过 pod 网络访问 ingress-nginx 控制器并执行任意代码。利用方式是通过向 Admission Controller 发送特制的 AdmissionReview 请求，注入恶意的 Nginx 配置，特别是利用 `nginx.ingress.kubernetes.io/auth-url` 注释，将 `ssl_engine` 指令指向一个可控的共享对象文件（.so）。

**利用方式：**
1.  **编译恶意共享对象（.so 文件）：** 该文件包含要执行的恶意代码，例如，反向 shell 或创建文件的指令。
2.  **构造恶意的 AdmissionReview 请求：**  `poc.py` 脚本用于生成包含恶意配置的 AdmissionReview 请求。关键在于 `nginx.ingress.kubernetes.io/auth-url` 注释，它会被注入恶意的 `ssl_engine` 指令，该指令指向一个位于 ingress-nginx 容器文件系统中的共享对象文件。
3.  **发送请求到 Admission Controller：**  将构造的 AdmissionReview 请求发送到 Admission Controller 的 admission 端点 (https://localhost:30443/networking/v1/ingresses)。因为 Admission Controller 没有进行充分的验证，恶意配置会被接受。
4.  **触发恶意代码执行：**  当 ingress-nginx 加载包含恶意代码的共享对象文件时，恶意代码会被执行。

**投毒风险分析：**

虽然主要代码展示了漏洞利用过程，但仍然存在小的投毒风险的可能性：

*   **依赖项风险：**`poc.py` 脚本依赖 `requests` 和 `urllib3` 库。如果这些库被恶意替换，可能会引入投毒代码。由于这些都是常见的库，这种可能性相对较低。
*   **`.so` 文件编译风险：** 编译 `.so` 文件的过程本身存在风险。如果攻击者控制了编译环境，他们可以在编译过程中植入恶意代码。但是，提供的 README 中明确指示了如何编译，降低了直接使用预编译文件的可能性。
*   **URL篡改风险：** `poc.py`代码中的URL地址存在被篡改的风险，可能导致用户连接到恶意的服务器上。

综合考虑，该仓库中作者直接隐藏的投毒代码风险较低，估计在 5% 左右。主要风险来自于对脚本依赖项和编译环境的潜在控制。


**项目地址:** [chhhd/CVE-2025-1974](https://github.com/chhhd/CVE-2025-1974)

**漏洞详情:** [CVE-2025-1974](https://nvd.nist.gov/vuln/detail/CVE-2025-1974)