## CVE-2024-32002-Git-RCE

**漏洞编号:** CVE-2024-32002

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Git

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 受影响版本包括 2.45.0, 2.44.0, >= 2.43.0 且 < 2.43.4, >= 2.42.0 且 < 2.42.2, 2.41.0, >= 2.40.0 且 < 2.40.2, 以及 < 2.39.4

**利用条件:** 目标系统需使用受影响的Git版本，且文件系统为大小写不敏感（如Windows或macOS），并允许符号链接。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-32002 是 Git 中一个允许远程代码执行的漏洞，它与子模块有关。恶意仓库可以精心构造，利用大小写不敏感文件系统上的符号链接处理缺陷，将文件写入 `.git/` 目录，进而执行恶意 hooks。

**有效性：**

根据漏洞描述和PoC代码，此PoC代码有效。多个搜索结果（如webpage 6和 webpage 7）表明存在针对此漏洞的利用，并且提供了利用成功的案例。PoC代码的 `README.md` 文件也提供了在Windows和Mac上的成功执行截图。 PoC 明确指出只能在 Windows 或 Mac 系统上工作, 这与漏洞描述中依赖大小写不敏感的文件系统相符。

**投毒风险：**

PoC代码主要由以下几个部分组成：

1.  `create_poc.sh`：用于创建利用此漏洞的恶意Git仓库。
2.  `hook/y/hooks/post-checkout` 和 `post-checkout`：这些文件包含了实际的恶意代码，也就是将在目标机器上执行的代码。这段代码会创建一个文件 `/tmp/pwnd`，并尝试运行 `calc.exe` （Windows）或 `open -a Calculator.app` （Mac）。
3.  `README.md`：提供漏洞描述和利用方法。

分析 `create_poc.sh` 脚本，其中包含一些git配置，创建一个恶意hook，并添加到git仓库中。该脚本的主要目的是自动化生成一个可被利用的恶意仓库，其本身并不包含任何隐藏的、与PoC目的无关的代码。

恶意代码部分，也就是`hook/y/hooks/post-checkout` 和 `post-checkout`脚本，其功能是创建文件和打开计算器程序。 虽然这些操作本身是无害的，但是攻击者可以替换成任何其他恶意代码，例如植入后门程序、窃取敏感数据等。

因此，判断此仓库中存在作者隐藏的投毒代码的风险较低。PoC本身包含的恶意代码是为了验证漏洞，并非隐藏的恶意功能。风险主要在于用户如果直接使用此PoC，没有意识到其潜在的危害，则可能导致安全问题。由于是公开的 PoC，其目的是演示漏洞利用，因此作者故意隐藏恶意代码的可能性较低，风险评估为5%。

**利用方式：**

1.  攻击者创建一个恶意 Git 仓库，其中包含一个包含特殊构造路径的子模块。
2.  子模块路径使用大小写变体，以利用大小写不敏感的文件系统。
3.  子模块包含一个指向其 `.git/` 目录的符号链接，该目录包含一个恶意 hook（例如 `post-checkout`）。
4.  当用户克隆恶意仓库时，`git clone --recursive` 命令会递归初始化和更新子模块。
5.  在大小写不敏感的文件系统上，Git 会跟随符号链接，并将恶意 hook 写入 `.git/` 目录。
6.  当执行 `git checkout` 等操作时，恶意 hook 会被执行，从而导致远程代码执行。

利用成功的关键点在于大小写不敏感的文件系统和符号链接的使用，以及 Git 在处理子模块时的缺陷。


**项目地址:** [ashutosh0408/CVE-2024-32002](https://github.com/ashutosh0408/CVE-2024-32002)

**漏洞详情:** [CVE-2024-32002](https://nvd.nist.gov/vuln/detail/CVE-2024-32002)