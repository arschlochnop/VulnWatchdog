## CVE-2004-0789-DNS Response Flooding Denial of Service

**漏洞编号:** CVE-2004-0789

**漏洞类型:** 拒绝服务 (DoS)

**影响应用:** Multiple Vendor DNS Implementations (Poslib, Axis Network products, Men & Mice Suite)

**危害等级:** 高危，导致CPU和网络带宽耗尽，使DNS服务器无法响应合法请求。

**影响版本:** Poslib <= 1.0.2-1, Axis Network products < firmware 3.13, Men & Mice Suite 2.2x < 2.2.3, 3.5.x < 3.5.2

**利用条件:** 需要能够向目标DNS服务器发送伪造源地址的数据包。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2004-0789 漏洞源于多个DNS协议实现中的缺陷，攻击者可以通过以下两种方式触发通信循环，导致目标服务器拒绝服务：

1.  **伪造源地址为localhost的DNS查询包：** 攻击者发送源地址伪造成127.0.0.1 (localhost) 的DNS查询数据包。易受攻击的DNS服务器在处理这类数据包时，可能进入查询和响应的循环，消耗大量的CPU和网络带宽。

2.  **触发响应包的响应包：** 攻击者发送精心构造的DNS响应数据包，该数据包会导致目标服务器生成另一个响应数据包，从而引发无限循环。

**漏洞利用方式：**

根据提供的漏洞利用代码 `exploit.py`，攻击者需要提供目标DNS服务器的IP地址以及要发送的请求数量。脚本使用 Scapy 库构造并发送DNS查询数据包。该脚本通过随机生成域名（`s1 + "." + domain + top_level`）并向目标DNS服务器发送查询请求，虽然代码本身没有直接伪造localhost地址，但是可以通过修改`exploit.py`脚本中的IP层源地址为127.0.0.1，从而实现利用。

**有效性：**

提供的PoC代码通过大量发送随机域名的DNS查询请求，对目标DNS服务器进行压力测试，可能导致服务器资源耗尽。结合漏洞描述，修改PoC代码，可以使漏洞更容易被触发。因此，提供的POC代码具有一定的有效性。

**投毒风险：**

该漏洞利用代码相对简单，主要功能是构造和发送DNS查询数据包。未发现明显的恶意代码或后门。代码只是实现了正常的漏洞利用功能，没有发现作者隐藏的投毒代码。因此，投毒风险较低，评估为0%。

**项目地址:** [HimmeL-Byte/CVE-2004-0789-DDOS](https://github.com/HimmeL-Byte/CVE-2004-0789-DDOS)

**漏洞详情:** [CVE-2004-0789](https://nvd.nist.gov/vuln/detail/CVE-2004-0789)