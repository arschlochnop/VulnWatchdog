## CVE-2022-22963-Spring Cloud Function-远程代码执行

**漏洞编号:** CVE-2022-22963

**漏洞类型:** 远程代码执行

**影响应用:** Spring Cloud Function

**危害等级:** 高危，可导致服务器完全控制

**影响版本:** <=3.1.6 (for 3.1.x) and <=3.2.2 (for 3.2.x)

**利用条件:** Spring Cloud Function 启用了路由功能，且攻击者可以发送恶意SpEL表达式。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2022-22963是Spring Cloud Function框架中的一个远程代码执行漏洞。当启用了路由功能时，攻击者可以通过构造恶意的SpEL（Spring Expression Language）表达式，通过`spring.cloud.function.routing-expression`请求头注入，从而在服务器上执行任意代码。漏洞利用代码显示，该PoC通过以下步骤利用漏洞：

1.  在本地创建一个包含反向shell命令的shell脚本（shell.sh）。
2.  启动一个简单的HTTP服务器，用于向目标服务器提供shell脚本。
3.  利用漏洞，通过SpEL表达式在目标服务器上执行wget命令，将shell脚本下载到/dev/shm/目录。
4.  利用漏洞，通过SpEL表达式执行chmod命令，为shell脚本赋予执行权限。
5.  利用漏洞，通过SpEL表达式执行shell脚本，从而建立反向shell连接。
6.  停止HTTP服务器。

**有效性：** 提供的PoC代码是有效的，能够实现远程代码执行，搜索结果也表明该漏洞的严重性以及存在可利用性。

**投毒风险：** 该仓库的投毒风险极低，接近于0%。主要原因是：

*   代码逻辑清晰： PoC代码的逻辑很明确，功能是利用漏洞执行反向shell，没有隐藏的恶意代码。
*   反向 Shell：虽然反向shell本身具有一定的攻击性，但它的目的明确，是为漏洞验证提供的。
*    小概率投毒风险：作者可能使用非标准的Bash语法或者在shell.sh脚本中添加不易察觉的命令来收集受害者信息，概率估计为1%。

**利用方式：**

1.  **确定目标：** 确认目标系统运行着受影响版本的Spring Cloud Function，且启用了路由功能。
2.  **构造恶意请求：** 构造包含恶意SpEL表达式的HTTP请求，通常通过`spring.cloud.function.routing-expression`请求头。
3.  **执行命令：** SpEL表达式会被解析并执行，从而在目标服务器上执行攻击者指定的命令，实现远程代码执行。

**项目地址:** [randallbanner/Spring-Cloud-Function-Vulnerability-CVE-2022-22963-RCE](https://github.com/randallbanner/Spring-Cloud-Function-Vulnerability-CVE-2022-22963-RCE)

**漏洞详情:** [CVE-2022-22963](https://nvd.nist.gov/vuln/detail/CVE-2022-22963)