## CVE-2023-7028-GitLab-账户接管

**漏洞编号:** CVE-2023-7028

**漏洞类型:** 弱口令重置机制

**影响应用:** GitLab

**危害等级:** 高危，可能导致账户接管

**影响版本:** 16.1 prior to 16.1.6, 16.2 prior to 16.2.9, 16.3 prior to 16.3.7, 16.4 prior to 16.4.5, 16.5 prior to 16.5.6, 16.6 prior to 16.6.4, and 16.7 prior to 16.7.2

**利用条件:** 目标GitLab实例存在漏洞且可网络访问

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-7028是GitLab中一个严重的安全漏洞，允许攻击者通过向未经验证的电子邮件地址发送用户帐户密码重置电子邮件来潜在地接管帐户。该漏洞影响GitLab CE/EE的多个版本。提供的PoC代码通过以下步骤利用此漏洞：

1.  **获取CSRF Token:** 脚本首先从密码重置页面获取CSRF token，用于后续的密码重置请求。
2.  **构造恶意请求:**  脚本构造一个包含目标用户邮箱和攻击者邮箱的password reset请求。通过将两个邮箱地址都放入`user[email][]`参数中，利用了GitLab的漏洞，使得重置邮件会同时发送到这两个邮箱。
3.  **发送请求:**  脚本使用POST请求将构造的数据发送到 `/users/password` 端点。
4.  **账户接管:** 如果请求成功，攻击者就可以通过攻击者邮箱收到的密码重置链接来重置目标用户的密码，从而接管其账户。

**有效性评估:** PoC代码的逻辑清晰，利用了漏洞描述中提到的邮箱注入漏洞，应能有效利用此漏洞接管目标账户。

**投毒风险评估:**  PoC代码中没有明显的恶意代码。所有的操作都是为了利用这个password reset漏洞，代码整体思路也是围绕这个漏洞来展开，但是不排除作者在其他位置添加隐藏代码，考虑到只是一个简单的POC脚本，隐藏恶意代码的可能性较低，因此，投毒风险评估为5%。

**利用方式总结:** 此漏洞的利用方式是攻击者首先获取CSRF token，然后构造一个包含目标用户邮箱和攻击者邮箱的恶意请求，利用GitLab的缺陷，使得密码重置链接同时发送到两个邮箱，从而攻击者可以通过收到的链接重置密码并接管目标账户。

**项目地址:** [KameliaZaman/Exploiting-GitLab-CVE-2023-7028](https://github.com/KameliaZaman/Exploiting-GitLab-CVE-2023-7028)

**漏洞详情:** [CVE-2023-7028](https://nvd.nist.gov/vuln/detail/CVE-2023-7028)