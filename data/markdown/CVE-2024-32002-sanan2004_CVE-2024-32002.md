## CVE-2024-32002 Git Submodule RCE

**漏洞编号:** CVE-2024-32002

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Git

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 受影响版本：< 2.39.4, >= 2.40.0, < 2.40.2, = 2.41.0, >= 2.42.0, < 2.42.2, >= 2.43.0, < 2.43.4, = 2.44.0, = 2.45.0

**利用条件:** 需要目标系统开启 symlinks 支持 (core.symlinks = true)，且攻击者能够控制一个包含恶意配置的 Git 仓库。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-32002 漏洞允许攻击者通过精心构造的包含恶意子模块的 Git 仓库，在克隆仓库的用户的系统上执行任意代码。漏洞的根源在于 Git 在处理子模块时，可能将文件写入 `.git/` 目录而非子模块的工作目录。这使得攻击者可以放置一个 Git hook (例如 `post-checkout`) 在克隆操作期间执行。PoC 的利用方式是：

1.  **准备恶意仓库 (hulk.git):** 该仓库包含一个 `post-checkout` hook，hook 的内容是恶意payload（示例中是打开计算器）。这个hook会被放置在 `.git/hooks/` 目录下。
2.  **准备包含恶意子模块的仓库 (submod.git):** 该仓库将恶意仓库 (`hulk.git`) 添加为子模块，并创建一个指向 `.git` 目录的符号链接。关键的一步是使用`git update-index`命令来创建一个指向 `.git` 目录的符号链接。
3.  **准备最终的触发仓库 (smash.git):** 用户克隆该仓库时，由于递归克隆子模块，符号链接会被错误地解析，导致 `post-checkout` hook 被复制到 `.git/hooks/` 目录下，并在克隆过程的某个阶段执行，从而实现 RCE。

**有效性：** 提供的 PoC 代码是有效的，如果满足先决条件（易受攻击的 Git 版本和启用的符号链接），则可以成功触发 RCE。

**投毒风险：** PoC 本身的主要功能是演示漏洞，但由于代码的复杂性，存在细微的投毒风险。例如，`poc.sh` 脚本中可以被加入额外命令，在执行漏洞利用的同时，进行其他恶意操作，例如收集用户信息、安装后门程序等。此外，`hulk.git`仓库中可以存在除计算器之外的其他恶意payload。因此,投毒风险评估为10%。

**利用方式：** 攻击者需要控制一个 Git 仓库，并诱导受害者递归克隆该仓库。一旦受害者执行了 `git clone --recursive <恶意仓库>` 命令，恶意代码就会在其系统上执行。

**缓解措施：**

*   升级 Git 到已修复的版本。
*   禁用符号链接支持 (`git config --global core.symlinks false`)。
*   避免克隆来自不受信任来源的仓库。

**项目地址:** [sanan2004/CVE-2024-32002](https://github.com/sanan2004/CVE-2024-32002)

**漏洞详情:** [CVE-2024-32002](https://nvd.nist.gov/vuln/detail/CVE-2024-32002)