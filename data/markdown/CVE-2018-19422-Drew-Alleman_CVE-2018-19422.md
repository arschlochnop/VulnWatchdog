## CVE-2018-19422-SubrionCMS-RCE

**漏洞编号:** CVE-2018-19422

**漏洞类型:** 远程代码执行

**影响应用:** Subrion CMS

**危害等级:** 高危，允许未授权的远程攻击者执行任意PHP代码。

**影响版本:** 4.2.1

**利用条件:** 需要Subrion CMS 4.2.1 部署实例，以及可访问的/panel/uploads目录。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2018-19422 漏洞存在于 Subrion CMS 4.2.1 的 `/panel/uploads` 目录中。由于 `.htaccess` 文件中缺少对 `.pht` 和 `.phar` 文件的阻止规则，远程攻击者可以通过上传包含恶意 PHP 代码的 `.pht` 或 `.phar` 文件来执行任意代码。 

**有效性：**
根据漏洞库信息、搜索引擎结果和提供的 PoC 代码，该漏洞的利用是有效的。搜索引擎结果中 Exploit-DB 和 GitHub 链接都指向了针对此漏洞的利用代码。

**投毒风险：**
PoC 代码的主要功能是：
1.  登录到 Subrion CMS 管理后台。
2.  上传包含 PHP 代码的 `.phar` 文件到 `/panel/uploads` 目录。
3.  通过访问上传的文件来执行其中的 PHP 代码。

代码中存在文件扩展名替换的逻辑，将 `.php` 扩展名替换为 `.phar`，这是为了绕过服务器对 `.php` 文件的限制。虽然代码本身并没有明显的恶意行为，但任何允许上传和执行代码的 PoC 都存在被滥用的风险。投毒风险较低，约为5%，主要考虑是代码相对清晰，功能集中在利用漏洞上，但任何代码都存在被修改的可能。

**利用方式：**
1.  **身份验证：** 首先，攻击者需要使用有效的管理员用户名和密码登录到 Subrion CMS 的管理后台。
2.  **CSRF Token 获取：** 从登录页面获取CSRF token，用于绕过CSRF保护。
3.  **文件上传：** 登录后，攻击者使用修改后的文件名（例如，将 shell.php 修改为 shell.phar）将包含恶意 PHP 代码的文件上传到 `/panel/uploads` 目录。
4.  **远程代码执行：** 成功上传文件后，攻击者可以通过访问上传的文件（例如，`http://example.com/uploads/shell.phar`）来执行其中的 PHP 代码。这允许攻击者在服务器上执行任意命令。

**项目地址:** [Drew-Alleman/CVE-2018-19422](https://github.com/Drew-Alleman/CVE-2018-19422)

**漏洞详情:** [CVE-2018-19422](https://nvd.nist.gov/vuln/detail/CVE-2018-19422)