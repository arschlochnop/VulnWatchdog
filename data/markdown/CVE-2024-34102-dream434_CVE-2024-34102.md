## CVE-2024-34102-Adobe Commerce XXE

**漏洞编号:** CVE-2024-34102

**漏洞类型:** XML 外部实体注入 (XXE)

**影响应用:** Adobe Commerce (Magento)

**危害等级:** 严重，可能导致任意代码执行，敏感信息泄露

**影响版本:** <= 2.4.7, 2.4.6-p5, 2.4.5-p7, 2.4.4-p8 及更早版本

**利用条件:** 目标系统存在漏洞，攻击者需要能够发送 HTTP 请求

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-34102 是 Adobe Commerce（Magento）中的一个 XML 外部实体注入（XXE）漏洞。攻击者可以通过发送特制的 XML 文档，其中包含对外部实体的引用，来利用此漏洞。漏洞无需用户交互，攻击复杂度低，允许未授权的远程攻击者读取服务器上的任意文件或执行任意代码。

**漏洞利用方式：**

1.  **构造恶意的XML请求：** 攻击者构造包含外部实体引用的恶意XML数据，该实体指向攻击者控制的外部资源或服务器上的本地文件。
2.  **发送请求到易受攻击的端点：** 将构造的XML数据通过HTTP请求发送到Adobe Commerce中存在XXE漏洞的`/rest/V1/guest-carts/1/estimate-shipping-methods`端点。
3.  **利用外部实体读取文件：**  服务器解析XML时，会尝试解析外部实体，从而导致读取攻击者指定的文件或执行指定的命令。
4.  **数据泄露或代码执行：**  如果外部实体指向服务器上的敏感文件（如`/etc/passwd`），则文件内容将被泄露。更严重的，攻击者可以通过XXE执行任意代码。

**POC分析：**

POC代码首先生成一个包含外部实体定义的DTD文件，该文件会尝试读取`/etc/passwd`并将其base64编码后发送到攻击者的服务器（sabatnth.c5.rs）。然后，POC构造一个包含对该DTD文件引用的XML请求，并将其发送到`/rest/V1/guest-carts/1/estimate-shipping-methods`端点。如果目标服务器存在漏洞，它将执行DTD文件中的操作，并将`/etc/passwd`的内容发送到攻击者的服务器。

**投毒风险分析：**

代码中存在将`/etc/passwd`的内容发送到`sabatnth.c5.rs` 的行为，这在实际攻击中用于将敏感信息发送到攻击者控制的服务器。由于POC的设计目的是证明漏洞的存在，因此将`/etc/passwd`发送到外部服务器是正常的漏洞验证行为，不是恶意投毒行为。基于对代码的分析，没有发现隐藏的恶意代码或后门，因此，投毒风险为0%。

**有效性评估：**

根据漏洞信息和POC代码，该漏洞利用方式是有效的，因为该POC能够读取服务器上的`/etc/passwd`文件内容。

**项目地址:** [dream434/CVE-2024-34102](https://github.com/dream434/CVE-2024-34102)

**漏洞详情:** [CVE-2024-34102](https://nvd.nist.gov/vuln/detail/CVE-2024-34102)