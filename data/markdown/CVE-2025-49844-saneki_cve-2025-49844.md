## CVE-2025-49844-Redis-Lua Use-After-Free

**漏洞编号:** CVE-2025-49844

**漏洞类型:** Use-After-Free

**影响应用:** Redis

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** < 8.2.2

**利用条件:** 需要Redis实例开启Lua脚本功能，且攻击者具有执行Lua脚本的权限（通常是已认证用户）。默认配置下所有用户都可以执行Lua脚本。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2025-49844是Redis中Lua脚本引擎中的一个Use-After-Free漏洞。低权限认证用户可以通过构造特殊的Lua脚本，操纵Redis的垃圾回收器，触发UAF，最终导致远程代码执行。利用方式如下：

1.  **漏洞原理：** 漏洞发生在Redis处理Lua脚本的chunkname时。攻击者通过控制`luaX_setinput`的chunkname参数，让其处于可回收的状态。
2.  **利用步骤：**
    *   通过自定义的`myloader`函数，第一次返回`nil`，让`luaZ_lookahead`重新populate ZIO buffer，保持chunkname处于可回收状态。
    *   第二次调用`myloader`函数时，执行`collectgarbage("collect")`触发垃圾回收，此时chunkname被释放。
    *   后续代码尝试使用释放后的chunkname，导致UAF。
3.  **PoC分析：** 提供的Dockerfile文件使用redis:8.2.1，满足漏洞版本要求。`demonstration.py` 实现了触发UAF的关键逻辑。`main.py` 使用 `demonstration.py` 生成exp代码，并将其发送到redis服务器执行,最终实现远程代码执行。docker-compose.yaml 文件配置了SYS_PTRACE权限,方便调试和利用。
4.  **投毒风险评估：**  代码仓库中包含了一个Dockerfile，看起来是为了方便漏洞调试和利用，安装了一些额外的工具，例如binutils，curl，gdb，file，procps，python3 等。这些工具本身没有直接的危害。`main.py` 中包含反向shell的利用代码。LICENSE文件为标准的MIT许可，没有隐藏的恶意代码。README.md提及了Wiz Research对该漏洞的研究，表明此漏洞存在公开的利用方法，作者的POC是个人研究成果。存在一定投毒的可能性, 但总体来看，投毒的可能性较低。


**项目地址:** [saneki/cve-2025-49844](https://github.com/saneki/cve-2025-49844)

**漏洞详情:** [CVE-2025-49844](https://nvd.nist.gov/vuln/detail/CVE-2025-49844)