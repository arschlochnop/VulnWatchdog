## CVE-2021-21300

**漏洞编号:** CVE-2021-21300

**漏洞类型:** 远程代码执行

**影响应用:** Git

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** >= 2.14.2, < 2.30.1 (特定版本)

**利用条件:** 需要目标系统使用 case-insensitive 文件系统 (例如 NTFS, HFS+, APFS)，受影响的 Git 版本，配置了 clean/smudge 过滤器 (如 Git LFS)，用户克隆恶意仓库。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-21300 是一个 Git 漏洞，允许恶意仓库在克隆时执行远程代码。漏洞利用依赖于以下条件：

1.  **Case-Insensitive 文件系统：** 目标系统必须使用 case-insensitive 文件系统，例如 Windows 上的 NTFS 或 macOS 上的 HFS+ 或 APFS。
2.  **受影响的 Git 版本：** Git 版本必须在 2.14.2 和 2.30.1 之间，但已被修复的版本除外。具体受影响的版本范围请参考漏洞库信息。
3.  **Clean/Smudge 过滤器：** 必须配置 clean/smudge 过滤器，例如 Git LFS。Git for Windows 默认配置 Git LFS，因此容易受到攻击。
4.  **用户交互：** 用户必须克隆来自不受信任来源的恶意仓库。

**利用方式：**

攻击者创建一个包含以下内容的恶意仓库：

*   符号链接
*   使用 clean/smudge 过滤器的文件

当用户克隆仓库时，Git 会尝试签出文件。由于 case-insensitive 文件系统和 clean/smudge 过滤器的存在，符号链接可能指向仓库之外的文件，或者 clean/smudge 过滤器可能执行恶意代码。

**有效性：**
提供的 POC 代码 `/tmp/4e0c8c882a848b1149c19287dda0025b/README.md` 仅仅是一个 README 文件，本身并不包含任何漏洞利用代码。但是，正如漏洞描述中提到的，攻击的关键在于精心构造的仓库内容，包括符号链接和带有恶意配置的 `.gitattributes` 文件等，因此，仅凭这个 README 文件无法判断漏洞是否能够成功利用。需要分析整个仓库的内容才能确定其有效性。

**投毒风险：**

给定的 `README.md` 文件内容非常简单，只包含 CVE 编号。投毒风险较低，估计为 10%。但是，不能仅凭单个文件就完全排除投毒风险。整个仓库都可能包含隐藏的恶意代码，例如在 `.gitattributes` 中配置的 clean/smudge 过滤器中。更复杂的投毒手段可能会涉及更隐蔽的代码注入，例如在看似无害的文件中嵌入 Payload 或利用其他漏洞来执行恶意代码。因此，彻底分析整个仓库的内容才能更准确地评估投毒风险。

**搜索引擎结果分析：**

搜索结果表明 CVE-2021-21300 影响 Git 客户端在 case-insensitive 文件系统上的操作，并可能导致远程代码执行。Git for Windows 默认配置 Git LFS，因此更容易受到攻击。此外，要成功利用该漏洞，攻击者必须能够托管恶意仓库并诱使用户克隆该仓库。相关链接提供更多漏洞信息、修复方案和讨论。

**项目地址:** [danshuizhangyu/CVE-2021-21300](https://github.com/danshuizhangyu/CVE-2021-21300)

**漏洞详情:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)