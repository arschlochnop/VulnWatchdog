## CVE-2021-4104-Apache Log4j 1.2 JMSAppender反序列化漏洞

**漏洞编号:** CVE-2021-4104

**漏洞类型:** 反序列化

**影响应用:** Apache Log4j 1.2

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Apache Log4j 1.2.x

**利用条件:** 需要目标系统配置为使用JMSAppender，且攻击者有Log4j配置文件的写入权限。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-4104是Apache Log4j 1.2中的一个反序列化漏洞。当Log4j 1.2被配置为使用JMSAppender时，攻击者如果具有对Log4j配置文件的写入权限，就可以通过修改配置文件，设置恶意的TopicBindingName和TopicConnectionFactoryBindingName，导致JMSAppender发起JNDI请求。这些JNDI请求可以指向恶意的JNDI服务器，从而导致远程代码执行，类似于CVE-2021-44228。

**有效性：**
从搜索结果和漏洞描述来看，该漏洞是真实存在的，并且已经被广泛讨论和研究。利用代码的有效性依赖于目标环境是否满足利用条件，即使用了JMSAppender并且攻击者可以修改配置文件。

**投毒风险：**
提供的漏洞利用代码仅为Apache License 2.0许可文件，不包含任何可执行的代码或配置文件。因此，从这段代码本身来看，不存在投毒风险。投毒风险应该关注于实际使用的PoC代码的来源，需要分析其行为是否包含恶意操作。

**利用方式：**
1.  **前提条件：** 目标系统使用Log4j 1.2，且配置使用了JMSAppender。
2.  **配置修改：** 攻击者需要获得Log4j配置文件的写入权限，修改`log4j.xml`或`log4j.properties`文件。
3.  **JMSAppender配置：** 在配置文件中，设置`TopicBindingName`和`TopicConnectionFactoryBindingName`指向恶意的JNDI服务器。
4.  **JNDI注入：** 当Log4j尝试通过JMSAppender连接JNDI服务器时，恶意的JNDI服务器返回一个包含恶意代码的序列化对象。
5.  **反序列化执行：** Log4j反序列化该对象，导致恶意代码在目标系统上执行，从而实现远程代码执行。

总而言之，利用的关键在于控制Log4j的配置文件，并诱使其连接到恶意的JNDI服务器。

**项目地址:** [open-AIMS/log4j](https://github.com/open-AIMS/log4j)

**漏洞详情:** [CVE-2021-4104](https://nvd.nist.gov/vuln/detail/CVE-2021-4104)