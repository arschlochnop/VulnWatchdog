## CVE-2021-26855 - Microsoft Exchange Server Remote Code Execution

**漏洞编号:** CVE-2021-26855

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Microsoft Exchange Server

**危害等级:** 高危，允许未经身份验证的远程攻击者在受影响的 Exchange 服务器上执行任意代码。

**影响版本:** Microsoft Exchange Server 2013 Cumulative Update 21/22/23, 2016 Cumulative Update 8/9/10/11/12/13/14/15/16/17/18/19, 2019 Cumulative Update 1/2/3/4/5/6/7/8

**利用条件:** 目标Exchange服务器存在漏洞且网络可达。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-26855 是 Microsoft Exchange Server 中的一个服务器端请求伪造 (SSRF) 漏洞，属于 ProxyLogon 攻击链的一部分。未经身份验证的攻击者可以利用此漏洞发送任意 HTTP 请求并伪装成管理员进行身份验证，然后结合其他漏洞（例如 CVE-2021-27065）来写入任意文件，最终实现远程代码执行。

**漏洞利用方式：**

1.  **SSRF (CVE-2021-26855):** 攻击者利用 SSRF 漏洞，通过构造特殊的 URL 和请求头，绕过身份验证，获取 Exchange 服务器的访问权限。
2.  **获取 LegacyDN：** 利用 Autodiscover 服务获取目标用户的 LegacyDN。
3.  **MAPI 连接：** 使用获取的 LegacyDN 建立 MAPI 连接。
4.  **ProxyLogon:** 通过构造 ProxyLogon 请求，伪装成管理员身份。
5.  **写入 Webshell (CVE-2021-27065，虽然POC未直接体现，但通常会结合使用):** 在成功通过身份验证后，利用漏洞在 Exchange 服务器的 OWA 目录下写入恶意的 Webshell 文件，该文件包含可以执行任意代码的 JScript 代码。
6.  **远程代码执行：** 攻击者通过访问 Webshell 文件，执行任意代码。

**有效性：**

根据提供的漏洞信息、搜索引擎结果和漏洞利用代码，该漏洞利用代码是有效的，因为它再现了 ProxyLogon 攻击链的关键步骤，包括 SSRF、权限提升和 webshell 写入 (webshell 内容在代码中已经存在)。搜索引擎结果中也表明 CVE-2021-26855 被积极利用。

**投毒风险：**

分析提供的 POC 代码，未发现明显的投毒代码。代码逻辑主要集中在利用 SSRF 漏洞进行身份验证绕过，并最终部署 webshell。虽然 webshell 本身是一种恶意代码，但这是漏洞利用的必要步骤，而非作者有意添加的恶意功能。因此，判定投毒风险为0%。

**项目地址:** [ZephrFish/Exch-CVE-2021-26855_Priv](https://github.com/ZephrFish/Exch-CVE-2021-26855_Priv)

**漏洞详情:** [CVE-2021-26855](https://nvd.nist.gov/vuln/detail/CVE-2021-26855)