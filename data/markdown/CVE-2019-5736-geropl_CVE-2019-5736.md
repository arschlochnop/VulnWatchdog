## CVE-2019-5736-runc-容器逃逸

**漏洞编号:** CVE-2019-5736

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可导致主机Root权限泄露

**影响版本:** 1.0-rc6之前版本

**利用条件:** 需要攻击者控制的容器镜像或对现有容器的写权限，并通过docker exec等方式附加到容器

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-5736 漏洞允许攻击者通过利用 runc 中的文件描述符处理不当问题，覆盖主机上的 runc 二进制文件，从而获得主机 root 权限。攻击者需要在受影响的 Docker 或其他容器环境中拥有一定权限：

1.  **有效性：** 根据漏洞描述、搜索引擎结果和提供的PoC代码，该漏洞利用是有效的。 搜索引擎结果中很多文章都提到了该漏洞可以导致容器逃逸并获取主机root权限。PoC代码中也包含了expolit.c文件，用于修改run二进制文件。
2.  **投毒风险：** PoC 代码中存在一定投毒风险。主要体现在以下几个方面：
    *   **README.md的警告：**  明确指出该漏洞利用具有破坏性，会覆盖主机上的 `/usr/bin/docker-runc` 二进制文件，还会覆盖容器内的 `/bin/sh`。虽然这是漏洞利用的正常结果，但如果攻击者恶意修改 `payload.c`，可能会对主机造成更大的损害。
    *   **payload.c 的可修改性：**  `payload.c` 包含反向 shell 代码，允许攻击者连接到容器并执行命令。攻击者可能会修改此文件，植入恶意代码，从而在受害者主机上执行任意操作。虽然提供的代码是简单的反向shell，但是如果利用人员修改payload，可能会造成更大的损失
    *   **pwn.sh的潜在恶意行为：** `pwn.sh` 脚本循环扫描 `/proc/*/exe`，寻找 `runc` 进程并尝试利用。攻击者可能修改此脚本，使其在找到目标进程后执行其他恶意操作，例如安装后门或窃取敏感数据。

    因此，虽然漏洞利用本身是公开的，但攻击者可以通过修改 PoC 代码中的 `payload.c` 或 `pwn.sh` 来植入恶意代码，增加投毒风险。概率估计为10%。

3.  **利用方式：** 漏洞利用方式如下：
    1.  **准备阶段：** 攻击者需要构建包含漏洞利用代码的恶意镜像，或者获得对现有容器的写入权限。
    2.  **部署 Payload：** 攻击者将编译好的 `exploit` 和 `payload` 放入容器中。
    3.  **执行漏洞利用：** 运行 `pwn.sh` 脚本，该脚本会循环扫描 `/proc/*/exe`，找到 `runc` 进程对应的 `/proc/<pid>/exe` 文件。
    4.  **覆盖 runc 二进制文件：** `exploit.c` 代码会打开 `/proc/<pid>/exe` 文件，并使用 `payload.c` 编译后的二进制内容覆盖它。  `payload.c` 包含反向 shell 代码，用于连接到攻击者的服务器。
    5.  **触发漏洞：** 当主机执行 `docker exec` 等命令时，会重新调用被覆盖的 runc 二进制文件，此时实际上执行的是 `payload.c` 中的恶意代码，从而建立反向 shell 连接，攻击者获得主机 root 权限。

简单来说，攻击者通过文件描述符覆盖了宿主机的runc程序，当宿主机调用runc时，相当于执行攻击者的代码。


**项目地址:** [geropl/CVE-2019-5736](https://github.com/geropl/CVE-2019-5736)

**漏洞详情:** [CVE-2019-5736](https://nvd.nist.gov/vuln/detail/CVE-2019-5736)