## CVE-2024-36991 Splunk Enterprise on Windows Path Traversal

**漏洞编号:** CVE-2024-36991

**漏洞类型:** 路径遍历

**影响应用:** Splunk Enterprise

**危害等级:** 高危，可能导致敏感信息泄露

**影响版本:** Windows版本低于 9.2.2, 9.1.5, 和 9.0.10

**利用条件:** 需要目标系统为Windows操作系统，且运行着存在漏洞的Splunk Enterprise版本，并可通过网络访问/modules/messaging/端点。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-36991是一个影响Splunk Enterprise在Windows上的路径遍历漏洞。根据漏洞库信息和搜索结果，攻击者可以利用该漏洞读取服务器上的任意文件。漏洞存在于/modules/messaging/端点，通过构造包含路径遍历字符（如`../`）的恶意请求，攻击者可以绕过目录限制，访问受保护的文件。

**有效性评估：**

根据提供的POC代码和搜索结果（特别是github上的链接），该漏洞利用代码是有效的。它通过发送特制的curl请求到易受攻击的Splunk实例，能够检索敏感文件并将它们保存到本地进行进一步分析。多个安全厂商和研究人员也证实了该漏洞的存在和可利用性。

**投毒风险评估：**

POC代码本身的功能描述为从目标主机拉取文件，并无发现直接的后门代码，但是仍然存在一定的投毒风险，例如：

1.  **恶意文件目标：**  POC的第4/5 section 可以设置专门拉取splunk系统上的二进制文件,如果攻击者伪造splunk 二进制文件或splunk相关组件,会导致splunk系统被替换恶意组件,导致后门。
2.  **依赖包投毒：** 虽然目前POC没有发现依赖包，但后续使用者可能引入恶意的依赖包。
3.  **Payload修改：**  攻击者在分发POC时，可能会修改请求的payload，例如增加执行系统命令的功能（虽然目前代码不具备，但可以轻易添加）。

基于以上，我评估该仓库存在10%的投毒风险。

**利用方式分析：**

1.  **目标确定：** 攻击者首先需要确定目标Splunk Enterprise实例的版本是否在受影响范围内（Windows版本低于 9.2.2, 9.1.5, 和 9.0.10）。
2.  **构造恶意请求：** 攻击者使用POC脚本，构造包含路径遍历字符的HTTP GET请求，发送到/modules/messaging/端点。例如：
    `https://vulnerable-splunk.com/modules/messaging/../../../../windows/win.ini`
3.  **文件读取：**  如果漏洞存在，Splunk Enterprise将返回目标文件的内容。
4.  **敏感信息提取：** 攻击者可以利用该漏洞读取敏感配置文件，如web.conf（可能包含管理员凭据），splunk.secret（用于加密splunk内部数据），以及其他可能包含密钥或密码的文件。
5.  **权限提升/横向移动：** 获取的凭据或密钥可用于进一步提升权限或在内网进行横向移动。

**项目地址:** [TcchSquad/CVE-2024-36991-Tool](https://github.com/TcchSquad/CVE-2024-36991-Tool)

**漏洞详情:** [CVE-2024-36991](https://nvd.nist.gov/vuln/detail/CVE-2024-36991)