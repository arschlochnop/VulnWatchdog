## CVE-2022-0847 Dirty Pipe 本地提权

**漏洞编号:** CVE-2022-0847

**漏洞类型:** 本地提权

**影响应用:** Linux Kernel

**危害等级:** 高危，可能导致本地普通用户提升至root权限

**影响版本:** Linux Kernel 5.8 - 5.16.10, 5.15.0 - 5.15.24, 5.10.0 - 5.10.101

**利用条件:** 需要本地用户权限，目标文件可读

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-0847，又名Dirty Pipe，是一个Linux内核中的本地提权漏洞。该漏洞允许非特权用户覆盖只读文件中的内容，从而可能获得root权限。

**漏洞利用方式：**

1.  创建一个管道（pipe）。
2.  用任意数据填充管道，以便在所有环形缓冲区条目中设置`PIPE_BUF_FLAG_CAN_MERGE`标志。
3.  排空管道（在`struct pipe_inode_info`环上的所有`struct pipe_buffer`实例中留下设置的标志）。
4.  将来自目标文件（以`O_RDONLY`打开）的数据从目标偏移量之前的位置拼接（splice）到管道中。
5.  将任意数据写入管道；此数据将覆盖缓存的文件页面，而不是创建一个新的匿名`struct pipe_buffer`，因为`PIPE_BUF_FLAG_CAN_MERGE`已设置。

**POC代码分析：**

提供的POC代码包含以下文件：

*   `READme.md`：漏洞利用说明，包括环境准备、利用步骤等。
*   `cat_generate.sh`：用于生成带有特定内容的只读文件`cat.txt`。
*   `check_cat.sh`：用于检查`cat.txt`的内容是否被成功修改。
*   `tips.txt`：包含了一些提示信息，例如如何检查内核版本、文件权限等。

根据`READme.md`的描述，该POC旨在覆盖只读文件`cat.txt`的内容。利用过程大致如下：创建只读文件cat.txt，使用Dirty Pipe漏洞覆盖cat.txt内容，然后使用`check_cat.sh`脚本验证是否成功。

**有效性评估：**

根据漏洞信息和POC代码，该漏洞利用方式是有效的。漏洞利用代码提供了一套完整的利用流程。

**投毒风险评估：**

检查了`cat_generate.sh`、`check_cat.sh` 和 `READme.md`，未发现明显的恶意代码。但为了安全起见，对整个代码仓库仍然给予5%的投毒风险评估，存在极小的概率作者在其他地方植入恶意代码。 例如，要求执行`sudo apt install gcc make -y` 可能存在安装恶意软件包的风险，或者在编译exploit代码过程中隐藏恶意行为，因此维持一个较低的风险评估。

**总结：**

该漏洞是高危漏洞，利用方式相对简单，但有明确的条件限制（内核版本、文件权限等）。提供的POC代码可以有效利用该漏洞进行本地提权。总体而言，该漏洞利用的有效性较高，但仍需要仔细审查代码以避免潜在的投毒风险。

**项目地址:** [JustinYe377/CTF-CVE-2022-0847](https://github.com/JustinYe377/CTF-CVE-2022-0847)

**漏洞详情:** [CVE-2022-0847](https://nvd.nist.gov/vuln/detail/CVE-2022-0847)