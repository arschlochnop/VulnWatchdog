## CVE-2025-29927-Next.js中间件绕过

**漏洞编号:** CVE-2025-29927

**漏洞类型:** 授权绕过

**影响应用:** Next.js

**危害等级:** 高危，可能导致未授权访问和数据泄露

**影响版本:** 受影响版本：>= 11.1.4, <= 13.5.6, > 14.0.0, < 14.2.25, > 15.0.0, < 15.2.3

**利用条件:** 目标应用使用受影响版本的Next.js，且权限校验逻辑位于中间件中

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2025-29927是Next.js框架中间件中的一个授权绕过漏洞。攻击者可以通过发送包含`x-middleware-subrequest`头的恶意请求绕过中间件中的权限检查，从而访问受保护的资源。

**有效性：**

根据漏洞库信息和搜索结果，此漏洞是真实存在的，并且存在可利用的PoC。提供的PowerShell脚本旨在检测目标应用是否存在此漏洞。该脚本通过检查`x-powered-by`头来确定是否使用了Next.js，然后尝试从静态资源中提取Next.js版本，并发送包含`x-middleware-subrequest`头的请求来验证漏洞是否存在。

**投毒风险：**

提供的PoC代码主要用于检测漏洞是否存在。它发送一个特定的HTTP头 (`x-middleware-subrequest`)，并根据响应判断是否存在漏洞。尽管代码本身看起来是为了安全测试目的而编写的，但仍存在一些潜在的投毒风险，虽然较低：

*   **依赖风险：** 如果该脚本依赖于外部模块或服务，这些外部依赖可能被恶意篡改。
*   **误报/漏报：** 脚本可能存在误报或漏报，导致用户对系统的安全状态产生错误的判断。攻击者可能利用这些信息发起攻击。
*   **滥用：** 攻击者可以利用该脚本扫描大量Next.js应用，寻找存在漏洞的目标。
*   **代码混淆：** 尽管当前代码清晰易懂，未来的版本可能会加入混淆或恶意代码，增加投毒风险。

综合评估，投毒风险较低，估计为10%。

**利用方式：**

1.  **确定目标应用使用的Next.js版本：** 可以通过HTTP响应头（如`x-powered-by`）或分析静态JavaScript文件来确定。
2.  **发送包含`x-middleware-subrequest`头的恶意请求：**  构造一个HTTP请求，并在请求头中添加`x-middleware-subrequest: anything`。如果中间件的权限检查逻辑存在缺陷，该请求可能会绕过身份验证，访问受保护的资源。
3.  **验证是否成功绕过身份验证：** 检查响应状态码和内容，判断是否成功访问了本应受到保护的资源。

**缓解措施：**

*   升级到已修复漏洞的Next.js版本（>= 14.2.25 或 >= 15.2.3）。
*   在中间件中验证或删除`x-middleware-subrequest`头。
*   增强身份验证机制，避免仅仅依赖中间件进行安全检查。
*   限制中间件的作用范围，仅应用于必要的路径。
*   监控和记录与中间件绕过尝试相关的可疑活动。

**项目地址:** [TheresAFewConors/CVE-2025-29927-Testing](https://github.com/TheresAFewConors/CVE-2025-29927-Testing)

**漏洞详情:** [CVE-2025-29927](https://nvd.nist.gov/vuln/detail/CVE-2025-29927)