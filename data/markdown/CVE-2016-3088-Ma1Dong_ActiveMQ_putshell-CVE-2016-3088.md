## CVE-2016-3088 - Apache ActiveMQ 文件上传与执行漏洞

**漏洞编号:** CVE-2016-3088

**漏洞类型:** 文件上传与执行

**影响应用:** Apache ActiveMQ

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Apache ActiveMQ 5.x before 5.14.0

**利用条件:** 目标系统运行存在漏洞版本的Apache ActiveMQ，且fileserver应用启用。 需要能够通过网络访问 ActiveMQ 的 fileserver 接口。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2016-3088 漏洞允许攻击者通过 HTTP PUT 请求上传任意文件，然后使用 HTTP MOVE 请求将其移动到 Web 目录，从而实现任意代码执行。漏洞利用代码 `ActiveMQ_putshell.py` 的利用方式如下：

1.  **漏洞检测:** 脚本首先尝试使用PUT方法上传一个文件到经过路径穿越处理后的URL `/fileserver/a../../%08/..%08/.%08/%08`，目的是探测 ActiveMQ 的安装路径。如果返回状态码为500，则从响应头中提取 ActiveMQ 的安装路径。
2.  **上传 Webshell:** 脚本随后使用PUT方法上传一个包含JSP webshell代码的文件 `guo.txt` 到 `/fileserver/guo.txt`。
3.  **移动 Webshell:**  脚本使用MOVE方法，将 `guo.txt` 文件移动到 ActiveMQ Web 应用的 admin 目录下，并重命名为 `guo.jsp`。 Destination 头构造了目标路径，利用了 `file://` 协议和之前获取的 ActiveMQ 安装路径。
4.  **访问 Webshell:** 漏洞利用成功后，攻击者可以通过访问 `url/admin/guo.jsp?pwd=gshell&shell=[command]` 来执行任意命令。

**有效性:** 根据漏洞库信息、搜索引擎结果和提供的漏洞利用代码，该漏洞利用方式是有效的，已经存在公开的POC。

**投毒风险:**  虽然提供的脚本本身实现了漏洞利用的功能，但仍然存在细微的投毒风险，例如：
*   **后门修改：** 作者可能在webshell代码中植入不易察觉的后门，虽然当前webshell相对简单。

总体而言，风险较低，大约 1%。主要是利用代码本身的功能实现漏洞，投毒的可能性较低。

**利用方式总结:**

1.  发送 PUT 请求上传任意文件到 `/fileserver/` 目录（或其他可写目录）。
2.  发送 MOVE 请求将上传的文件移动到 Web 应用的可执行目录，例如 `admin` 目录。
3.  访问移动后的文件（例如 JSP 文件），执行恶意代码。

该漏洞利用方式简单直接，易于实现，但依赖于目标系统存在漏洞版本且 fileserver 应用启用。

**项目地址:** [Ma1Dong/ActiveMQ_putshell-CVE-2016-3088](https://github.com/Ma1Dong/ActiveMQ_putshell-CVE-2016-3088)

**漏洞详情:** [CVE-2016-3088](https://nvd.nist.gov/vuln/detail/CVE-2016-3088)