## CVE-2023-45612-Ktor-XXE

**漏洞编号:** CVE-2023-45612

**漏洞类型:** XXE

**影响应用:** Ktor

**危害等级:** 高危，可能导致敏感信息泄露

**影响版本:** < 2.3.5

**利用条件:** 需要Ktor应用程序启用ContentNegotiation并使用XML格式，目标服务器可以访问外部资源

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2023-45612是JetBrains Ktor 2.3.5之前的版本中存在的一个XXE（XML外部实体注入）漏洞。当Ktor应用程序使用ContentNegotiation feature处理XML格式数据时，如果默认配置未进行安全加固，攻击者可以通过在XML payload中插入恶意实体引用来读取服务器上的任意文件或进行服务器端请求伪造（SSRF）。

**有效性：**

根据提供的漏洞库信息和漏洞利用代码，该漏洞的POC代码是有效的。漏洞库明确指出Ktor 2.3.5之前的版本存在XXE漏洞，并给出了受影响的版本范围。POC代码提供了重现该漏洞所需的必要组件，包括一个基于Ktor的简单服务器和一个用于发送恶意XML payload的Python脚本。

**投毒风险：**

查看POC代码，包括`README.md`, `build.gradle.kts`, `gradle.properties`, `gradlew`和`test.py`，没有发现任何恶意代码或后门。所有代码都用于设置Ktor服务器并利用XXE漏洞。虽然不能完全排除所有可能性，但根据目前的信息，投毒风险较低，可以认为是0%。`gradlew`只是一个gradle的wrapper脚本，用于在没有全局安装gradle的情况下运行gradle命令。

**利用方式：**

1.  **配置易受攻击的Ktor应用:** 确保目标Ktor应用的版本低于2.3.5，并启用了ContentNegotiation feature，且支持XML格式的处理。
2.  **构造恶意XML Payload:** 攻击者需要构造一个包含外部实体声明的XML payload。例如，payload可能包含一个指向服务器本地文件的实体引用，或者一个指向外部服务器的URL。
3.  **发送Payload到服务器:** 攻击者将构造好的XML payload通过HTTP请求发送到Ktor服务器的某个接受XML数据的端点。
4.  **利用XXE读取文件/SSRF:**  服务器解析XML时，会尝试解析外部实体。如果外部实体指向本地文件，则服务器会将文件内容返回给攻击者（文件读取）。如果外部实体指向外部URL，则服务器会向该URL发起请求（SSRF）。

**漏洞缓解措施：**

*   升级Ktor版本到2.3.5或更高版本。
*   禁用或严格配置XML解析器的外部实体解析功能。在Ktor中，可以通过配置`XML`序列化器来禁用外部实体解析。

**项目地址:** [aecelen/ktor-xxe-poc](https://github.com/aecelen/ktor-xxe-poc)

**漏洞详情:** [CVE-2023-45612](https://nvd.nist.gov/vuln/detail/CVE-2023-45612)