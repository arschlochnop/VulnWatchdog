## CVE-2019-2215 Android Binder Use-After-Free

**漏洞编号:** CVE-2019-2215

**漏洞类型:** Use-After-Free

**影响应用:** Android Kernel

**危害等级:** 高危，可导致权限提升至内核级别

**影响版本:** Kernel

**利用条件:** 需要本地安装恶意应用或利用网络应用中的其他漏洞

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-2215 是 Android Binder 中的一个 use-after-free 漏洞，存在于 `binder.c` 文件中。攻击者可以利用此漏洞将权限从应用提升到 Linux 内核级别。根据漏洞信息和搜索结果，该漏洞已经被野外利用，并且存在公开可用的漏洞利用代码。

**有效性：**
提供的 POC 代码似乎有效，因为它包含利用该漏洞所需的必要组件，例如 Makefile、README 和 exp.cc 文件。`exp.cc` 文件包含利用 use-after-free 漏洞所需的特定结构和偏移量。Makefile 用于交叉编译漏洞利用程序，README 文件提供有关漏洞和利用的信息。

**投毒风险：**
虽然提供的代码看起来像一个有效的漏洞利用程序，但是投毒风险仍然存在。具体分析如下：

*   `Makefile`:  看似标准，用于构建 exploit，没有明显的恶意代码。
*   `README.md`: 只是提供漏洞信息和免责声明，没有恶意代码。
*   `exp.cc`:  这是最有可能存在投毒代码的地方。快速浏览发现，大量的偏移量和结构体定义是利用漏洞的关键，但同时也可能被篡改以达到恶意目的。漏洞利用代码包含很多硬编码的地址偏移量。如果这些偏移量不正确，可能会导致程序崩溃，或者更糟糕的情况，可能会被利用来执行恶意代码。例如，某个变量被替换成其他函数指针等。
    此外，作者可以在条件编译中隐藏恶意代码，例如通过检测特定设备或环境来激活后门。代码中存在 `debug` 函数，该函数会暂停执行并等待用户输入，这在生产环境中是不寻常的，可能被滥用。总体来说，虽然表面上代码是合法的漏洞利用，但存在一定风险。根据分析，投毒风险约为 10%。

**利用方式：**
利用方式主要涉及以下步骤：

1.  **漏洞触发：** 利用Binder机制中的UAF漏洞。这可能涉及到创建特定的Binder事务，并以一种导致内核释放Binder对象，然后在后续操作中再次访问它的方式进行操作。
2.  **内存布局控制：** 攻击者可能需要操纵内存布局，以便在释放的Binder对象之后分配特定的数据结构。这样，当内核尝试访问释放的Binder对象时，它实际上会访问攻击者控制的数据结构。
3.  **权限提升：** 通过控制内存中的数据，攻击者可以覆盖当前进程的凭据（credentials），将其UID和GID设置为0，从而获得root权限。

**总结：**
该漏洞的成功利用可能导致设备完全受损。尽管漏洞利用代码已公开，但在实际使用前仍需要仔细审查，以确保其安全性和可靠性。鉴于该漏洞已经被恶意行为者利用，及时修补程序至关重要。

**项目地址:** [elbiazo/CVE-2019-2215](https://github.com/elbiazo/CVE-2019-2215)

**漏洞详情:** [CVE-2019-2215](https://nvd.nist.gov/vuln/detail/CVE-2019-2215)