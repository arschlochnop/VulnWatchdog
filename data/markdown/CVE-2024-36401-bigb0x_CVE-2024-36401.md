## CVE-2024-36401 - GeoServer 远程代码执行

**漏洞编号:** CVE-2024-36401

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** GeoServer

**危害等级:** 高危，允许未经身份验证的攻击者执行任意代码

**影响版本:** < 2.22.6, >= 2.23.0 and < 2.23.6, >= 2.24.0 and < 2.24.4, >= 2.25.0 and < 2.25.2

**利用条件:** 需要目标GeoServer实例存在漏洞，并且可以通过网络访问

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-36401是GeoServer中的一个远程代码执行漏洞，源于GeoTools库API不安全地将属性名作为XPath表达式传递给commons-jxpath库。攻击者可以通过构造恶意的OGC请求（例如WFS GetFeature、WFS GetPropertyValue、WMS GetMap、WMS GetFeatureInfo和WPS Execute）利用此漏洞，执行任意代码。

**有效性：**
根据提供的漏洞信息、搜索结果和漏洞利用代码，可以确认该POC代码是有效的。搜索结果中多个来源（如Fortinet、Keysight、SonicWall、Rapid7等）都表明该漏洞已被实际利用。

**投毒风险：**
分析提供的POC代码后，发现存在一定的投毒风险。虽然代码的主要功能是利用漏洞执行反向shell，但在以下几个方面存在潜在的投毒可能性：

1.  **对 nc 命令的依赖：**  POC 依赖目标系统存在 `nc` (netcat) 命令。如果目标系统没有 `nc`，利用会失败。攻击者可能会修改 POC，尝试使用其他命令（如 `wget` 或 `curl`）下载并执行恶意脚本，从而实现更隐蔽或更复杂的攻击。
2.  **反向 Shell 的隐蔽性：**  反向 shell 连接通常会被防火墙或入侵检测系统拦截。攻击者可能会尝试使用加密或其他混淆技术来绕过这些安全措施。
3.  **日志记录和错误处理：**  POC 具有基本的日志记录功能，但可能不足以记录所有关键操作。攻击者可以修改代码，删除或篡改日志，以隐藏其活动。

总的来说，由于POC的目的是快速验证漏洞，相对比较简单，因此投毒的可能性相对较低，但仍然需要警惕。

**利用方式：**
该漏洞的利用方式主要通过以下步骤：

1.  **构建恶意OGC请求：** 攻击者构造包含恶意XPath表达式的OGC请求，例如WFS GetFeature请求。
2.  **发送恶意请求：** 攻击者将构造的恶意请求发送到目标GeoServer实例。
3.  **执行任意代码：** GeoServer在处理请求时，会将恶意XPath表达式传递给commons-jxpath库进行评估，从而导致任意代码执行。
4.  **反向Shell (POC使用):** POC 尝试建立反向 shell 连接，允许攻击者远程控制受感染的服务器。POC 发送一个POST请求，在请求中使用的payload来执行反向shell，连接到攻击者的机器。

**项目地址:** [bigb0x/CVE-2024-36401](https://github.com/bigb0x/CVE-2024-36401)

**漏洞详情:** [CVE-2024-36401](https://nvd.nist.gov/vuln/detail/CVE-2024-36401)