## CVE-2024-51793 - WordPress Computer Repair Shop Plugin Arbitrary File Upload

**漏洞编号:** CVE-2024-51793

**漏洞类型:** 任意文件上传

**影响应用:** WordPress Computer Repair Shop Plugin

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** <= 3.8115

**利用条件:** 需要目标网站安装并启用受影响的Computer Repair Shop插件，且攻击者可以无需授权访问。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-51793是一个存在于WordPress Computer Repair Shop插件中的任意文件上传漏洞。攻击者可以利用此漏洞上传恶意文件，例如webshell，到服务器上，从而获得远程代码执行的能力。

**有效性：**
根据漏洞信息和搜索结果，该漏洞是一个未经授权的任意文件上传漏洞，允许攻击者上传webshell。提供的POC代码旨在利用此漏洞。代码首先检查目标站点是否易受攻击，方法是检查readme.txt文件中插件的版本。如果版本易受攻击（<= 3.8115），则继续利用该漏洞。该脚本构造一个带有webshell的multipart/form-data请求，然后将其发送到`wp-admin/admin-ajax.php`端点，这个端点处理插件的文件上传功能。成功上传后，脚本会尝试从响应中提取上传的shell的URL。利用的有效性取决于目标站点是否满足漏洞利用的先决条件，比如安装了有漏洞的插件版本。

**投毒风险：**
该POC代码本身具有较低的投毒风险（估计为5%）。原因如下：
*   代码相对简单且易于理解，功能明确，旨在利用已知的任意文件上传漏洞。
*   代码中包含明确的作者声明，降低了作者故意隐藏恶意代码的可能性。
*   默认的webshell代码是`<?php system($_GET["cmd"]); ?>`，这是一个常见的用于测试的webshell，不包含任何恶意行为。虽然webshell本身具有危险性，但这不属于“投毒”，而是漏洞利用的一部分。
*   风险在于攻击者可能修改 `shell_code` 参数，上传更具破坏性的webshell，但这不是代码本身的投毒。

**利用方式：**
1.  **版本检查：** POC脚本首先检查目标网站上安装的Computer Repair Shop插件版本。这是通过发送请求到`wp-content/plugins/computer-repair-shop/readme.txt`并检查`Stable tag`是否小于或等于3.8115来完成的。
2.  **构造恶意请求：** 如果插件版本易受攻击，该脚本会构造一个包含恶意PHP代码（webshell）的HTTP POST请求。此请求使用`multipart/form-data` Content-Type，模拟文件上传。
3.  **上传Shell：** 构造的请求被发送到WordPress的`admin-ajax.php`端点，该端点用于处理各种AJAX操作，包括文件上传。请求中的`action`参数设置为`wc_upload_file_ajax`，表示要触发插件的文件上传功能。
4.  **提取Shell URL：** 成功上传webshell后，脚本会尝试从服务器的响应中提取上传的文件的URL。这是通过使用正则表达式在响应文本中搜索`.php`文件的URL来完成的。
5.  **远程代码执行：** 攻击者可以使用提取的URL来访问上传的webshell，并通过`cmd`参数执行任意系统命令。

**项目地址:** [Nxploited/CVE-2024-51793](https://github.com/Nxploited/CVE-2024-51793)

**漏洞详情:** [CVE-2024-51793](https://nvd.nist.gov/vuln/detail/CVE-2024-51793)