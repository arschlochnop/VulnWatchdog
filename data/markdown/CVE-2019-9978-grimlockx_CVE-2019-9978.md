## CVE-2019-9978-Social Warfare-存储型XSS和RCE

**漏洞编号:** CVE-2019-9978

**漏洞类型:** 存储型XSS / RCE

**影响应用:** WordPress Social Warfare Plugin

**危害等级:** 高危，可能导致远程代码执行和权限提升

**影响版本:** < 3.5.3

**利用条件:** 需要目标网站安装了存在漏洞的 Social Warfare 插件，并且攻击者可以访问 WordPress 后台（至少具备能够触发 admin-post.php 的权限，未授权RCE除外）。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2019-9978 漏洞存在于 WordPress Social Warfare 插件的 3.5.3 之前版本中。漏洞利用方式是利用 wp-admin/admin-post.php 接口中的 swp_debug=load_options&swp_url 参数，该参数存在存储型XSS漏洞，允许攻击者注入恶意 JavaScript 代码。根据搜索结果，该漏洞还存在远程代码执行（RCE）的可能性，攻击者可以通过构造特定的payload来实现 RCE。 

**有效性：**
提供的 POC 代码利用了 swp_url 参数中的存储型 XSS 漏洞，通过创建一个包含 PHP 代码的 payload.txt 文件，然后通过 HTTP 服务器提供该文件，并使用 `requests.get()` 方法触发漏洞。POC 代码能够创建 payload，启动 HTTP 服务器，并发送包含恶意 URL 的请求，表明该 POC 代码基本有效。

**投毒风险：**
代码中没有明显的恶意投毒行为。代码功能清晰，主要用于启动一个 HTTP 服务器，创建包含命令的 payload 文件，并利用漏洞发送请求。`os._exit(0)` 并非投毒行为，而是脚本正常结束的方式。但并不代表此仓库绝对安全，只能说明POC本身逻辑不存在投毒风险，但依旧存在风险,占比1%。

**利用方式：**
1.  攻击者需要找到一个安装了 Social Warfare 插件的 WordPress 网站，且插件版本低于 3.5.3。
2.  攻击者运行提供的 Python 脚本，指定目标 URL、本地 HTTP 服务器 IP 地址和端口，以及要执行的命令。
3.  脚本创建一个包含 PHP 代码的 payload.txt 文件，该文件包含要执行的命令 (例如，`<pre>system('COMMAND')</pre>`)。
4.  脚本启动一个本地 HTTP 服务器，用于提供 payload.txt 文件。
5.  脚本向目标网站的 wp-admin/admin-post.php 接口发送一个 GET 请求，其中 swp_debug 参数设置为 load_options，swp_url 参数设置为本地 HTTP 服务器上 payload.txt 文件的 URL。
6.  目标网站加载 payload.txt 文件中的 PHP 代码，并执行其中的命令。
7.  命令执行的结果会显示在响应中。

**项目地址:** [grimlockx/CVE-2019-9978](https://github.com/grimlockx/CVE-2019-9978)

**漏洞详情:** [CVE-2019-9978](https://nvd.nist.gov/vuln/detail/CVE-2019-9978)