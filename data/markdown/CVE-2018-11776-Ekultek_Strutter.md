## CVE-2018-11776-Apache Struts远程代码执行

**漏洞编号:** CVE-2018-11776

**漏洞类型:** 远程代码执行

**影响应用:** Apache Struts

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 2.3 to 2.3.34, 2.5 to 2.5.16

**利用条件:** alwaysSelectFullNamespace 为 true，且存在特定命名空间配置

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2018-11776是Apache Struts 2的一个远程代码执行漏洞。根据漏洞库信息，当`alwaysSelectFullNamespace`配置为true时，并且当结果没有命名空间且其上层包没有或具有通配符命名空间时，或者在使用没有值和操作设置的url标签且其上层包没有或具有通配符命名空间时，可能导致远程代码执行。

**有效性评估：**
提供的PoC代码 (`strutter.py`) 旨在利用此漏洞。它构造一个包含OGNL表达式的恶意URL，该表达式允许执行任意命令。PoC包括使用Shodan搜索潜在目标的选项。根据搜索结果，已经存在公开可用的漏洞利用代码，因此PoC代码的有效性很高。

**投毒风险分析：**
PoC代码本身专注于利用，但存在一些潜在的投毒风险。PoC 中选择payload的`pwn()` 函数未完成，存在后续添加恶意payload的可能, 并且 `strutter.py` 脚本具有从外部获取命令(`-C` 参数)并执行的能力，如果使用者不小心使用了不可信的命令，可能会导致恶意代码在目标系统上执行。但总体来说，代码主要目的在于漏洞利用，投毒的可能性相对较低，约为10%。需要注意的是,通过Shodan搜索目标并利用，可能会无意中攻击到蜜罐或其他安全设备。

**利用方式：**
1.  **配置检查：** 漏洞利用的前提是目标Struts应用的`alwaysSelectFullNamespace`配置为true，这通常需要了解目标应用的配置。
2.  **构造恶意URL：** 通过构造包含恶意OGNL表达式的URL来触发漏洞。这个表达式允许执行任意命令。
3.  **发送请求：** 将构造的URL发送到目标Struts应用。
4.  **命令执行：** 如果目标存在漏洞，服务器将执行OGNL表达式中的命令。
5.  **结果获取：**  PoC代码中尝试读取命令执行的结果，并通过ServletActionContext获取response的writer返回。

总体来说，该漏洞利用有效，但需要特定的配置条件才能触发。PoC代码本身存在一定的投毒风险，主要来自使用者不小心执行恶意命令的可能性。

**项目地址:** [Ekultek/Strutter](https://github.com/Ekultek/Strutter)

**漏洞详情:** [CVE-2018-11776](https://nvd.nist.gov/vuln/detail/CVE-2018-11776)