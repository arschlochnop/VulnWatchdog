## CVE-2025-24813-Apache Tomcat-路径遍历/反序列化RCE

**漏洞编号:** CVE-2025-24813

**漏洞类型:** 路径遍历/反序列化RCE

**影响应用:** Apache Tomcat

**危害等级:** 高危，可能导致远程代码执行和信息泄露

**影响版本:** 9.0.0.M1 <= 9.0.98, 10.1.0-M1 <= 10.1.34, 11.0.0-M1 <= 11.0.2

**利用条件:** 需要启用Default Servlet的写入功能 (readonly=false), 支持partial PUT (默认启用), 应用程序使用Tomcat基于文件的session持久化存储，应用包含可用于反序列化攻击的库

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2025-24813 是 Apache Tomcat 中的一个路径等价漏洞，允许未经身份验证的远程攻击者利用该漏洞查看文件系统内容，并添加恶意内容，最终可能导致远程代码执行。

**漏洞利用方式：**

1.  **Default Servlet 写入启用：** 默认情况下，Tomcat 的 Default Servlet 的写入功能是禁用的。攻击者需要目标服务器启用了此功能。 这需要在`conf/web.xml`文件中将`readonly`参数设置为`false`。
2.  **Partial PUT 支持：** Tomcat 默认支持 partial PUT 请求，攻击者可以利用这个特性分块上传恶意文件。
3.  **路径等价：** 漏洞的核心在于 Tomcat 处理文件路径时，对包含内部点（例如 `file.Name`）的文件名的处理不当，导致可以绕过某些安全检查，写入到任意目录。
4.  **RCE 的先决条件：**
    *   需要应用程序使用 Tomcat 的基于文件的 session 持久化机制，且使用默认存储位置（/opt/tomcat/webapps/ROOT/sessions/ 从 context.xml 文件中得知）。
    *   应用程序还需要包含一个可用于反序列化攻击的库（如 Commons Collections）。
5.  **利用步骤：**
    *   攻击者首先通过 partial PUT 上传一个包含恶意序列化数据的 session 文件到 Tomcat 的 session 存储目录。
    *   Tomcat 反序列化该 session 文件，触发 RCE。

**漏洞利用代码分析：**

提供的 Dockerfile 描述了如何搭建一个存在 CVE-2025-24813 漏洞的 Tomcat 环境：

*   **Dockerfile:**
    *   使用 Ubuntu 22.04 作为基础镜像。
    *   安装 JDK 11 和其他必要的工具（curl, unzip, nano, wget, netcat）。
    *   下载并解压 Apache Tomcat 9.0.98。
    *   将 `CATALINA_HOME` 设置为 `/opt/tomcat`，并将 Tomcat 的 bin 目录添加到 `PATH` 中。
    *   下载 Commons Collections 3.2.2、Commons BeanUtils 1.9.4 和 Commons Logging 1.2 的 JAR 包到 `$CATALINA_HOME/lib` 目录。这是为了满足反序列化 RCE 的依赖。
    *   复制 `context.xml` 到 `$CATALINA_HOME/conf/context.xml`，配置Session持久化到`/opt/tomcat/webapps/ROOT/sessions/`。
    *   使用 `sed` 命令修改 `$CATALINA_HOME/conf/web.xml` 文件，将 Default Servlet 的 `readonly` 参数设置为 `false`，开启 Default Servlet 的写入功能。
    *   开放 8080 端口。
    *   使用 `catalina.sh run` 命令启动 Tomcat。
*   **context.xml:**  用于配置session持久化。
*   **web.xml:**  修改 Default Servlet 的 `readonly` 参数设置为 `false`

**有效性：**  提供的 POC 代码是有效的，可以成功搭建一个存在 CVE-2025-24813 漏洞的 Tomcat 环境，并配置反序列化 RCE 所需的条件。

**投毒风险：**

投毒风险主要来自以下几个方面：

1.  **额外的恶意代码：** Dockerfile 中可能包含下载并执行恶意代码的命令，例如通过 `wget` 下载并执行一个 shell 脚本。
2.  **替换的 JAR 包：** Dockerfile 中下载的 Commons Collections、Commons BeanUtils 或 Commons Logging JAR 包可能被替换为包含恶意代码的 JAR 包。
3.  **修改的配置文件：**  `context.xml` 或 `web.xml` 文件可能被修改为包含恶意配置，例如添加恶意的 Servlet 或 Filter。

在分析提供的代码后，发现以下潜在的投毒点：

*   **`context.xml`配置的session存储位置:** 修改成了`/opt/tomcat/webapps/ROOT/sessions/` 这个路径是否合理需要进一步判断，正常情况下会配置到应用相关的目录，如果配置不当可能导致其他应用也能访问这个session存储位置。

综合考虑，该 POC 存在一定的投毒风险，但主要是配置层面的风险，代码植入层面的风险较小。因此，投毒风险评估为 **10%**。

**项目地址:** [GongWook/CVE-2025-24813](https://github.com/GongWook/CVE-2025-24813)

**漏洞详情:** [CVE-2025-24813](https://nvd.nist.gov/vuln/detail/CVE-2025-24813)