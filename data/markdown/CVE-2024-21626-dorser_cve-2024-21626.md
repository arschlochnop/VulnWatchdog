## CVE-2024-21626-runc容器逃逸

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可导致容器逃逸，控制宿主机

**影响版本:** < 1.1.12

**利用条件:** 需要受影响版本的runc，可能是恶意镜像或runc exec

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-21626 漏洞是 runc 中的一个文件描述符泄露漏洞。攻击者可以利用此漏洞使新生成的容器进程（来自 runc exec）在主机文件系统命名空间中拥有一个工作目录，从而允许通过访问主机文件系统来逃逸容器（攻击 2）。恶意镜像也可以使用相同的攻击，允许容器进程通过 runc run 获得对主机文件系统的访问权限（攻击 1）。攻击 1 和 2 的变体也可用于覆盖半任意主机二进制文件，从而实现完全容器逃逸（攻击 3a 和攻击 3b）。

**利用方式：**

1.  **恶意镜像（攻击 1）：** 恶意镜像在容器启动时利用文件描述符泄露，将容器进程的工作目录设置为宿主机上的目录，从而获得对宿主机文件系统的访问权限。
2.  **runc exec（攻击 2）：**  攻击者在使用 `runc exec` 进入容器时，利用该漏洞，使得新进程的工作目录位于宿主机文件系统，从而逃逸容器。
3.  **覆盖宿主机二进制文件（攻击 3a 和 3b）：**  利用文件描述符泄露获得对宿主机文件系统的写入权限后，攻击者可以覆盖宿主机上的二进制文件，从而获得更高的权限或执行恶意代码。

**漏洞利用有效性：**

根据漏洞库信息和搜索结果，该漏洞存在PoC，且利用较为简单，通过github上的[webpage 8 begin] [title] NitroCao/CVE-2024-21626的描述，可以确定只需要运行一个带有-w参数的容器即可利用，无需构建自定义镜像。

**投毒风险：**

提供的漏洞利用代码仅包含GNU通用公共许可证，没有发现任何可疑的或恶意的代码。因此，该代码仓库中存在作者隐藏的投毒代码的风险较低，接近0%。

**总结：**

CVE-2024-21626 是一个严重的安全漏洞，允许攻击者逃逸容器并控制宿主机。由于存在公开的 PoC 且利用方式较为简单，建议受影响的用户尽快升级到 runc 1.1.12 或更高版本。

**项目地址:** [dorser/cve-2024-21626](https://github.com/dorser/cve-2024-21626)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)