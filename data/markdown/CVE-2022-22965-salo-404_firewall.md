## CVE-2022-22965 Spring4Shell RCE

**漏洞编号:** CVE-2022-22965

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Spring Framework

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** Spring Framework versions 5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+ 和所有旧的、不受支持的版本

**利用条件:** 需要运行在JDK 9+的Spring MVC或Spring WebFlux应用，并且部署在Tomcat上作为WAR包。另外，服务器需存在可写目录。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22965，又名Spring4Shell，是一个存在于Spring Framework中的远程代码执行漏洞。该漏洞利用了数据绑定功能，允许攻击者通过修改classLoader来写入恶意web shell,从而导致RCE。 

**有效性：**
根据漏洞信息和搜索结果，此漏洞是真实且可被利用的。提供的漏洞利用代码模拟了一个防火墙，用于防御Spring4Shell攻击，本身不包含攻击载荷，但是能够检测利用尝试，这间接证明了此漏洞的可利用性。

**投毒风险：**
提供的代码仓库主要包含一个模拟防火墙的Python脚本（firewall_server.py）。该脚本的目的是检测并阻止Spring4Shell漏洞的利用。审查该脚本后，发现它主要通过检查HTTP POST数据中的恶意键、header、有效载荷特征来工作。没有发现任何迹象表明作者试图在代码中隐藏任何恶意功能或后门。因此，投毒风险较低，约为10%。风险主要来自于对于拦截规则的绕过和未来潜在的恶意修改。

**利用方式：**
1.  **漏洞原理：** 该漏洞源于Spring框架的数据绑定功能，它允许将HTTP请求参数自动绑定到Java对象的属性上。攻击者可以利用这一点，通过构造恶意的请求参数，修改`classLoader`等关键对象，从而实现远程代码执行。
2.  **利用条件：**
    *   运行在JDK 9+的Spring MVC或Spring WebFlux应用。
    *   部署在Tomcat上作为WAR包（Spring Boot可执行jar默认部署方式不受影响）。
    *   目标应用存在可写目录
3.  **攻击步骤：**
    *   攻击者发送包含恶意参数的HTTP POST请求到存在漏洞的端点。
    *   恶意参数会修改Tomcat的日志目录、URI编码等配置。
    *   攻击者上传包含恶意代码的JSP文件到修改后的日志目录，从而创建一个webshell。
    *   攻击者通过访问该webshell执行任意代码。

**项目地址:** [salo-404/firewall](https://github.com/salo-404/firewall)

**漏洞详情:** [CVE-2022-22965](https://nvd.nist.gov/vuln/detail/CVE-2022-22965)