## CVE-2021-23017-Nginx Resolver Memory Overwrite

**漏洞编号:** CVE-2021-23017

**漏洞类型:** 内存覆盖

**影响应用:** Nginx

**危害等级:** 高危，可能导致worker进程崩溃或潜在的其他影响

**影响版本:** Nginx Web Server versions 0.6.18 thru 1.20.0 before 1.20.1, Nginx plus versions R13 thru R23 before R23 P1. Nginx plus version R24 before R24 P1

**利用条件:** 需要能够伪造来自DNS服务器的UDP数据包

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

根据漏洞库信息和搜索引擎结果，CVE-2021-23017是Nginx resolver中的一个安全问题，允许攻击者通过伪造来自DNS服务器的UDP数据包，导致1字节的内存覆盖。这种覆盖可能导致worker进程崩溃或者产生其他潜在影响。

分析提供的漏洞利用代码（Makefile、README.md、rc.yaml）：

*   **有效性：** 提供的代码是一个用于构建Nginx镜像的Dockerfile和相关配置，而不是直接利用CVE-2021-23017的PoC。虽然它构建了一个Nginx镜像，但它本身并没有包含任何能够触发或验证该漏洞的代码。提供的github链接（https://github.com/M507/CVE-2021-23017-PoC）包含专门针对该漏洞的POC，可以更准确地验证漏洞利用。

*   **投毒风险：**  该代码的主要目的是构建一个自定义的Nginx镜像。虽然直接利用CVE-2021-23017的代码没有包含在此仓库中，但是此`Makefile`文件可以执行任意命令，以及`Dockerfile`如果被篡改，有可能引入恶意代码。`rc.yaml`文件用于在Kubernetes中部署Nginx，如果被篡改也可能导致恶意行为。总体而言，该仓库存在一定的投毒风险，但风险较低。估计为10%。

*   **利用方式：**  利用方式需要攻击者能够伪造来自DNS服务器的UDP数据包。攻击者需要找到一个使用Nginx resolver的配置，并构造恶意的UDP数据包来触发内存覆盖。由于只有1字节的覆盖，精确控制覆盖内容比较困难，可能需要多次尝试才能达到利用效果。通常利用该漏洞会导致DoS（拒绝服务），但也可能在特定情况下实现更高级的攻击。

总之，提供的代码本身不包含漏洞利用代码，而是一个构建Nginx镜像的配置。真正的漏洞利用需要伪造DNS响应包，并且精准控制覆盖的内存地址。

**项目地址:** [niandy/nginx-patch](https://github.com/niandy/nginx-patch)

**漏洞详情:** [CVE-2021-23017](https://nvd.nist.gov/vuln/detail/CVE-2021-23017)