## CVE-2025-53770 - Microsoft SharePoint Server 远程代码执行漏洞

**漏洞编号:** CVE-2025-53770

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Microsoft SharePoint Server

**危害等级:** 高危，允许未经授权的攻击者通过网络执行代码

**影响版本:** SharePoint Server 2016, SharePoint Server 2019, SharePoint Server Subscription Edition (版本 < 16.0.18526.20508)

**利用条件:** 需要目标系统运行受影响版本的SharePoint Server，并且能够通过网络访问。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2025-53770 是一个 Microsoft SharePoint Server 远程代码执行漏洞，源于对不可信数据的反序列化。该漏洞允许未经授权的攻击者通过网络执行任意代码。根据漏洞信息，该漏洞已被积极利用，并且 CISA 已将其添加到已知被利用的漏洞目录中。提供的POC代码利用了 `ToolPane.aspx` 页面，通过构造恶意的序列化数据，触发反序列化漏洞，从而执行攻击者预先准备的 PowerShell 脚本。

**利用方式：**

1.  **准备 Payload：**  攻击者首先需要准备一个恶意的 ASPX payload (`pwn.aspx`)，该文件包含将执行的恶意代码，例如，执行系统命令、部署 webshell等。在此示例中，`pwn.aspx` 包含C#代码，用于执行任意操作。
2.  **Payload 编码：**  POC 代码首先对 ASPX payload 进行 Base64 编码，然后将其嵌入到 PowerShell 脚本中。PowerShell 脚本的作用是将解码后的 ASPX payload 写入到 SharePoint 的 Layouts 目录下，命名为 `spinstall0.aspx`。 
3.  **构造反序列化 Payload：**  接下来，POC 代码将包含 Base64 编码的 PowerShell 命令的 payload 嵌入到一个 XML 结构中，该结构使用 `LosFormatter` 类来触发反序列化漏洞。 XML 数据随后被进行 Base64 编码并使用 Gzip 压缩。然后，此Gzip压缩的数据再次进行Base64 编码。
4.  **构建 HTTP 请求：**  POC 代码构造一个 POST 请求，目标是 SharePoint 的 `/_layouts/15/ToolPane.aspx` 页面。请求体中包含 `MSOTlPn_Uri` 和 `MSOTlPn_DWP` 参数。`MSOTlPn_DWP` 参数的值是经过 URL 编码的最终 payload。
5.  **发送请求：**  攻击者将构造好的 HTTP 请求发送到目标 SharePoint Server。当 SharePoint Server 处理该请求时，会触发反序列化漏洞，从而执行嵌入在 XML payload 中的 PowerShell 脚本，并将恶意 ASPX 文件写入到文件系统。
6.  **执行恶意代码：**  攻击者可以通过访问写入的 `spinstall0.aspx` 文件来执行恶意代码。

**投毒风险评估：**

虽然 POC 代码本身实现了漏洞利用流程，但仍然存在作者植入恶意代码的可能性。分析 `pwn.aspx` 文件后发现，该文件中只是包含允许执行任意C# 代码的框架，但是具体的操作是允许用户自己定义的，所以不存在显式的后门代码。但是，恶意的使用者可以修改 `pwn.aspx`的内容部署后门程序。考虑到代码的复杂性以及潜在的隐蔽后门，投毒风险评估为10%。大部分风险来自 `pwn.aspx`的内容可以被修改这一事实。

**总结：**

提供的 POC 代码能够有效地利用 CVE-2025-53770 漏洞，实现在 SharePoint Server 上执行远程代码。攻击者通过构造恶意的反序列化 payload，将恶意 ASPX 文件写入到服务器，并最终执行该文件中的代码。务必及时应用 Microsoft 提供的安全更新，以修复此漏洞。

**项目地址:** [BirdsAreFlyingCameras/CVE-2025-53770_Raw-HTTP-Request-Generator](https://github.com/BirdsAreFlyingCameras/CVE-2025-53770_Raw-HTTP-Request-Generator)

**漏洞详情:** [CVE-2025-53770](https://nvd.nist.gov/vuln/detail/CVE-2025-53770)