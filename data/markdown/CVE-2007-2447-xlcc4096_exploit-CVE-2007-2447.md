## CVE-2007-2447-Samba-远程命令执行

**漏洞编号:** CVE-2007-2447

**漏洞类型:** 远程命令执行

**影响应用:** Samba

**危害等级:** 高危，可能导致系统完全控制

**影响版本:** 3.0.0 through 3.0.25rc3

**利用条件:** 目标Samba服务器启用了 "username map script" 选项，或存在可利用的MS-RPC函数调用。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2007-2447 漏洞是 Samba 3.0.0 到 3.0.25rc3 版本中 smbd 守护进程的 MS-RPC 功能中存在的远程命令执行漏洞。该漏洞允许远程攻击者通过 shell 元字符执行任意命令。

**有效性分析：**
根据漏洞描述和搜索结果，此漏洞允许攻击者通过在特定的 MS-RPC 函数调用（如 SamrChangePassword 或其他远程打印和文件共享管理函数）中注入 shell 元字符来执行任意命令。当启用了 "username map script" 配置时，漏洞更容易被利用。提供的 Python 脚本 `exploit-CVE-2007-2447.py` 利用了这一点，它通过构造一个包含反向 shell 命令的用户名字段，连接到目标 SMB 服务器并触发漏洞。

**投毒风险分析：**
查看提供的poc代码，`exploit-CVE-2007-2447.py` 脚本包含一个 msfvenom 生成的 payload，该 payload 旨在建立一个反向 shell 连接。脚本本身没有明显的投毒代码。`README.md` 文件和 `requirements.txt` 文件不包含任何可疑内容。因此，该仓库中存在作者隐藏的投毒代码的可能性较低,评估为0%。

**利用方式分析：**
1.  **漏洞触发：** 漏洞的触发依赖于Samba服务器处理包含恶意 shell 元字符的 MS-RPC 请求。
2.  **攻击步骤：**
    *   攻击者需要确定目标 Samba 服务器的版本是否在受影响的范围内（3.0.0 到 3.0.25rc3）。
    *   攻击者检查目标服务器是否启用了 "username map script" 选项，或者是否暴露了其他易受攻击的 MS-RPC 函数。
    *   攻击者可以使用 `exploit-CVE-2007-2447.py` 脚本，通过 SMB 协议连接到目标服务器，并传递包含恶意命令的用户名字段。
    *   当 Samba 服务器处理包含恶意元字符的请求时，它将执行注入的命令，从而允许攻击者执行任意代码。
3.  **Payload：** 提供的 PoC 使用 `msfvenom` 生成一个反向 netcat shell，当漏洞触发时，目标服务器会尝试连接到攻击者的机器上，从而让攻击者获得一个shell。

**项目地址:** [xlcc4096/exploit-CVE-2007-2447](https://github.com/xlcc4096/exploit-CVE-2007-2447)

**漏洞详情:** [CVE-2007-2447](https://nvd.nist.gov/vuln/detail/CVE-2007-2447)