## CVE-2025-6019-libblockdev-本地提权

**漏洞编号:** CVE-2025-6019

**漏洞类型:** 本地提权

**影响应用:** libblockdev/udisks2

**危害等级:** 高危，攻击者可以从低权限用户提升至root权限

**影响版本:** Red Hat Enterprise Linux 7/8/9/10

**利用条件:** 需要本地访问，并且用户拥有Polkit中"allow_active"权限

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2025-6019是libblockdev中的一个本地权限提升漏洞。利用方式是攻击者可以创建一个特制的XFS镜像，该镜像包含一个SUID-root的shell。然后，通过udisks2的DBus接口调用Resize方法来调整该镜像的大小。由于udisks2在挂载用户提供的文件系统镜像时，通常会设置nosuid和nodev等安全标志以防止权限提升，但是该漏洞允许攻击者绕过这些安全措施。攻击者通过利用文件系统调整大小过程中的竞争条件，使得udisks2以root权限挂载恶意镜像，从而允许攻击者执行SUID-root shell并获得完整的系统控制权。

利用步骤如下：
1.  **创建恶意镜像:** 攻击者使用`dd`创建一个XFS镜像，然后使用`mkfs.xfs`格式化该镜像。接着，将该镜像挂载到本地目录，并将`/bin/bash`复制到该挂载点，然后设置SUID权限。最后卸载该镜像。
2.  **利用漏洞:**
    *   杀死可能干扰的`gvfs-udisks2-volume-monitor`进程。
    *   使用`udisksctl loop-setup`命令设置loop设备指向恶意镜像。
    *   启动一个后台进程，不断检查`/tmp/blockdev*/bash`是否存在，一旦存在则退出（利用竞争条件）。
    *   使用`gdbus call`调用`org.freedesktop.UDisks2.Filesystem.Resize`方法，触发漏洞。
    *   等待一段时间后，找到`/tmp/blockdev*`目录，如果其中存在SUID-root的bash，则执行它以获取root权限。

**关于投毒风险的分析：**
*   **代码分析：** POC代码主要由两部分组成：创建恶意镜像的函数`create_suid_image()`和执行漏洞利用的函数`exploit_system()`。代码本身相对简洁，没有明显的恶意代码。
*   **潜在风险：** 主要的风险在于创建镜像的过程中，虽然代码复制了`/bin/bash`，并设置了SUID权限。但恶意攻击者可以在创建镜像的过程中，复制其他具有后门的程序，并设置SUID权限。
*   **判断：**  代码中没有明显的恶意行为，但存在替换`/bin/bash`为包含后门的程序的风险。考虑到这个风险，我将其判定为存在一定的投毒风险（5%）。这个风险来自于使用者可能没有仔细审查创建镜像的步骤，从而引入了额外的安全问题。

**有效性分析：**根据漏洞信息，搜索结果，以及POC代码，可以判断，POC代码有效，可以进行本地提权。

**排序优先级：**搜索引擎结果 > 漏洞利用代码 > 漏洞库信息

**项目地址:** [And-oss/CVE-2025-6019-exploit](https://github.com/And-oss/CVE-2025-6019-exploit)

**漏洞详情:** [CVE-2025-6019](https://nvd.nist.gov/vuln/detail/CVE-2025-6019)