## CVE-2022-0944-SQLPad-模板注入导致RCE

**漏洞编号:** CVE-2022-0944

**漏洞类型:** 模板注入

**影响应用:** SQLPad

**危害等级:** 高危，可导致远程代码执行

**影响版本:** <= 6.10.0

**利用条件:** 需要高权限用户凭证

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

该漏洞存在于SQLPad的connection test接口，由于使用了模板引擎且未对用户输入进行充分的过滤，导致攻击者可以通过构造恶意模板代码，在服务器端执行任意命令。根据提供的POC代码，利用方式如下：

1.  **身份验证：** 如果需要，首先使用提供的用户名和密码登录SQLPad应用，获取Cookie。
2.  **构造恶意JSON数据：**  构造包含恶意模板代码的JSON数据，其中`database`字段包含利用`process.mainModule.require('child_process').exec()`执行命令的payload。Payload形如：`{{ process.mainModule.require('child_process').exec('命令') }}`
3.  **发送POST请求：** 将构造的JSON数据通过POST请求发送到`/api/test-connection`接口。如果需要，在请求头中包含Cookie。
4.  **执行命令：**  服务器端收到请求后，模板引擎解析`database`字段中的恶意代码，从而执行攻击者指定的命令。
5. **有效性:** 根据漏洞信息和POC，此漏洞的POC代码有效，可以实现远程代码执行。
6.  **投毒风险分析：**  查看了`exploit.py`脚本，该脚本的功能是发送带有恶意payload的请求到目标SQLPad实例的`/api/test-connection`接口，从而触发RCE。没有发现任何其他隐藏的恶意代码，例如上传后门、修改文件等。因此，可以认为该POC代码不存在投毒风险，投毒风险概率为0%。

**项目地址:** [FlojBoj/CVE-2022-0944](https://github.com/FlojBoj/CVE-2022-0944)

**漏洞详情:** [CVE-2022-0944](https://nvd.nist.gov/vuln/detail/CVE-2022-0944)