## CVE-2022-22978: Spring Security Authorization Bypass

**漏洞编号:** CVE-2022-22978

**漏洞类型:** 授权绕过

**影响应用:** Spring Security

**危害等级:** 高危，可能导致未授权访问和数据泄露

**影响版本:** Spring security versions 5.4.x prior to 5.4.11+, 5.5.x prior to 5.5.7+, 5.6.x prior to 5.6.4+ and all earlier unsupported versions

**利用条件:** 应用程序使用了RegexRequestMatcher，且正则表达式中包含`.`

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22978是Spring Security中的一个授权绕过漏洞。当使用`RegexRequestMatcher`进行请求匹配时，如果正则表达式中包含`.`，并且Servlet容器对URL中的换行符处理不当，攻击者可以通过在URL中插入编码后的换行符（例如`%0a`或`%0d`）来绕过授权检查。

**有效性:** 提供的POC代码有效，它演示了如何通过在URL中插入`%0a`来绕过对`/admin`页面的访问限制。

**投毒风险:**  代码仓库本身主要是漏洞验证的演示代码，但存在一定的风险，因为攻击者可能会复制该仓库，并在此基础上添加恶意代码，然后传播出去。因此，不能完全排除投毒的可能性。代码仓库中展示的利用方式本身并不属于投毒，但是由于该仓库可能被二次修改，存在一定的投毒风险。例如，在docker-compose文件中修改镜像来源指向恶意镜像，或者在启动脚本中添加恶意行为。

**利用方式:**
1.  应用程序使用Spring Security，并且使用了`RegexRequestMatcher`进行权限控制。
2.  `RegexRequestMatcher`的正则表达式中包含`.`，这使得换行符可以被匹配。
3.  攻击者构造包含`%0a`或`%0d`等编码后换行符的恶意URL，例如`/admin/%0atest`。
4.  Servlet容器未正确处理URL中的换行符，导致`RegexRequestMatcher`的匹配结果被绕过。
5.  攻击者未经授权访问受保护的资源，例如管理页面。

**项目地址:** [he-ewo/CVE-2022-22978](https://github.com/he-ewo/CVE-2022-22978)

**漏洞详情:** [CVE-2022-22978](https://nvd.nist.gov/vuln/detail/CVE-2022-22978)