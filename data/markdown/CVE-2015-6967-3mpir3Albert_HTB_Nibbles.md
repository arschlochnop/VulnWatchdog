## CVE-2015-6967 - Nibbleblog My Image Plugin 文件上传漏洞

**漏洞编号:** CVE-2015-6967

**漏洞类型:** 文件上传

**影响应用:** Nibbleblog

**危害等级:** 高危，远程代码执行

**影响版本:** 4.0.5之前版本

**利用条件:** 需要管理员权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于Nibbleblog的My Image插件中，版本低于4.0.5。 具有管理员权限的攻击者可以通过上传带有可执行扩展名的文件来执行任意代码。上传的文件存储在 `content/private/plugins/my_image/image.php` 目录下, 并通过直接请求该目录下的文件来触发执行。

**有效性分析：**

*   根据漏洞库信息、搜索引擎结果和提供的漏洞利用代码，该漏洞利用的有效性较高。多个来源都确认了该漏洞的存在，并提供了利用的细节。
*   `pwned.py`脚本通过模拟管理员登录，然后利用My Image插件的文件上传功能，上传包含恶意代码的PHP文件。
*   `autopwn.py`脚本在`pwned.py`基础上，增加了权限提升的功能，尝试利用已上传的webshell进行进一步的攻击。

**投毒风险分析：**

*   该仓库中存在一定的投毒风险，估计为10%。
*   风险主要在于`autopwn.py`脚本中硬编码了一些提权操作，例如直接修改`/bin/bash`的权限，以及执行一些预设的命令。如果目标环境与脚本预期的环境不符，这些操作可能会导致系统不稳定或其他问题。
*  同时脚本中需要用户自己创建包含恶意代码的PHP文件，如果用户不小心创建了包含恶意代码的文件，可能会导致本地环境受到影响。
*   虽然存在风险，但考虑到脚本的目的是为了自动化利用，这些操作也在一定程度上是可以理解的，需要用户仔细审核脚本内容并谨慎使用。

**利用方式：**

1.  **登录后台：** 使用提供的用户名和密码，利用`requests`库模拟登录Nibbleblog的后台管理页面（`/admin.php`）。
2.  **上传恶意文件：** 构造POST请求，利用`My Image`插件的文件上传功能，上传包含webshell的PHP文件。 上传的路径是`content/private/plugins/my_image/file1.php`。
3.  **执行代码：** 通过直接访问上传的PHP文件（`/content/private/plugins/my_image/file1.php`），触发webshell执行，从而实现远程代码执行。
4.  **权限提升（autopwn.py）：** 在成功执行代码后，`autopwn.py`脚本会尝试进一步提升权限，例如修改`/bin/bash`的权限，然后利用`bash -p`获取root权限。

**项目地址:** [3mpir3Albert/HTB_Nibbles](https://github.com/3mpir3Albert/HTB_Nibbles)

**漏洞详情:** [CVE-2015-6967](https://nvd.nist.gov/vuln/detail/CVE-2015-6967)