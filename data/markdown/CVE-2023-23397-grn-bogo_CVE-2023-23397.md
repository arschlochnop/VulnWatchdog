## CVE-2023-23397 Microsoft Outlook 权限提升漏洞

**漏洞编号:** CVE-2023-23397

**漏洞类型:** 权限提升

**影响应用:** Microsoft Outlook

**危害等级:** 高危，可能导致NTLM Relay攻击，窃取用户凭据

**影响版本:** 受影响版本包括Microsoft Outlook 2013 SP1, 2016, 2019, Office LTSC 2021, 和 Microsoft 365 Apps for Enterprise的特定版本

**利用条件:** 攻击者需要向受害者发送包含恶意属性的电子邮件、日历邀请或任务请求

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2023-23397是一个存在于Microsoft Outlook中的权限提升漏洞。攻击者可以通过发送特制的电子邮件，日历邀请或任务请求利用此漏洞。漏洞原理是Outlook在处理这些消息时，会错误地使用UNC路径作为`reminder_sound_file`属性的值，如果UNC路径指向攻击者控制的服务器，Outlook客户端将尝试通过NTLM身份验证连接到该服务器，从而泄漏用户的NTLM哈希。攻击者可以利用窃取的NTLM哈希进行NTLM中继攻击，冒充受害者。

根据提供的漏洞利用代码，该脚本会创建一个恶意的Outlook消息（.msg文件），该消息设置了`reminder_sound_file`属性为指向攻击者控制的SMB服务器的UNC路径（`\\10.21.22.3\testfile`）。当受害者打开此消息时，Outlook客户端会尝试访问该UNC路径，从而触发NTLM身份验证并泄露NTLM哈希。

**漏洞利用有效性：**
提供的POC代码有效，它展示了如何创建包含恶意`reminder_sound_file`属性的消息，从而触发NTLM哈希泄漏。

**投毒风险：**
此代码段本身没有明显的投毒行为。它只是一个PoC，用于演示漏洞利用过程。作者隐藏恶意代码的可能性较低。分析结果表明投毒风险为0%。

**利用方式：**
1.  攻击者构造包含恶意`reminder_sound_file`属性的Outlook消息（.msg文件）。
2.  攻击者将此消息发送给受害者。
3.  受害者使用Outlook打开该消息。
4.  Outlook客户端尝试访问`reminder_sound_file`指定的UNC路径。
5.  受害者的NTLM哈希通过SMB协议发送到攻击者控制的服务器。
6.  攻击者使用窃取的NTLM哈希进行NTLM中继攻击，冒充受害者。

**项目地址:** [grn-bogo/CVE-2023-23397](https://github.com/grn-bogo/CVE-2023-23397)

**漏洞详情:** [CVE-2023-23397](https://nvd.nist.gov/vuln/detail/CVE-2023-23397)