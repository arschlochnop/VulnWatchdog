## CVE-2013-3900 WinVerifyTrust Signature Validation Vulnerability

**漏洞编号:** CVE-2013-3900

**漏洞类型:** 签名验证绕过

**影响应用:** Microsoft Windows

**危害等级:** 中危/高危 (取决于上下文和CVSS评分)

**影响版本:** 受影响的Windows版本众多，详见漏洞库信息

**利用条件:** 用户或应用程序需要运行或安装被篡改的、已签名的PE文件。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2013-3900 涉及 WinVerifyTrust 函数在处理 Windows Authenticode 签名验证时存在的问题，攻击者可以通过修改已签名的PE文件，在不破坏签名的情况下添加恶意代码，从而绕过签名验证。 

**有效性：**
提供的 PowerShell 脚本 `Checking_Diplaying.ps1` 并非漏洞利用代码，而是用于检测目标系统是否已配置相应的注册表项以缓解此漏洞。脚本检查 `EnableCertPaddingCheck` 注册表项在以下路径中是否存在，以及是否被设置为 `1`：
  * `HKLM:\Software\Microsoft\Cryptography\Wintrust\Config` (64位系统)
  * `HKLM:\Software\Wow6432Node\Microsoft\Cryptography\Wintrust\Config` (32位应用程序在64位系统上运行)
如果注册表项不存在或未正确设置，脚本会提示相应的修复措施。

虽然此脚本本身不能直接利用漏洞，但可以帮助确定系统是否存在潜在的风险。

真正的漏洞利用需要构造一个恶意的PE文件，利用 WinVerifyTrust 函数的缺陷来执行未经验证的代码。 由于微软已经发布了补丁，成功的利用取决于系统是否打了补丁以及注册表项是否正确设置。

**投毒风险：**
此 PowerShell 脚本的主要功能是读取注册表值并显示状态，以及提供修复建议。仔细审查脚本代码后，发现**没有明显的恶意代码或后门**，但存在极低的投毒风险。以下是分析过程：

*   **代码功能单一：** 脚本主要执行注册表读取和状态显示，逻辑相对简单，没有进行网络连接或文件写入等可疑操作。
*   **公开可见：** 脚本代码完全公开，易于审查。隐藏恶意代码的难度较高。
*   **潜在风险：** 极低的风险在于，攻击者可能会篡改脚本的显示信息，误导用户认为系统已安全，而实际上漏洞仍然存在。或者通过修改脚本的修复建议，引导用户进行错误配置，反而引入安全风险。

因此，此脚本的投毒风险较低，估计在**5%** 左右，主要来自于篡改显示信息或修复建议的可能性，而非直接执行恶意代码。

**利用方式：**
1.  **漏洞存在：** 首先，目标系统必须存在 CVE-2013-3900 漏洞，即未安装相应的安全补丁，并且 `EnableCertPaddingCheck` 注册表项未设置为 `1`。
2.  **恶意PE文件：** 攻击者需要准备一个经过特殊构造的 PE 文件，该文件利用 WinVerifyTrust 函数的签名验证缺陷，在签名有效的情况下包含恶意代码。
3.  **诱骗执行：** 攻击者需要诱骗用户运行或安装此恶意 PE 文件，例如通过社交工程、钓鱼邮件、恶意网站等方式。由于需要用户交互，漏洞利用的成功率取决于用户的警惕性。
4.  **代码执行：** 一旦用户运行恶意 PE 文件，WinVerifyTrust 函数会错误地验证签名，导致恶意代码得以执行，攻击者从而获得对系统的控制权。

**项目地址:** [Sabecomoeh/CVE-2013-3900](https://github.com/Sabecomoeh/CVE-2013-3900)

**漏洞详情:** [CVE-2013-3900](https://nvd.nist.gov/vuln/detail/CVE-2013-3900)