## CVE-2024-4947 - Google Chrome V8 类型混淆漏洞

**漏洞编号:** CVE-2024-4947

**漏洞类型:** 类型混淆

**影响应用:** Google Chrome

**危害等级:** 高危，允许远程攻击者在沙箱内执行任意代码

**影响版本:** < 125.0.6422.60

**利用条件:** 用户需要访问恶意构造的HTML页面

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2024-4947 是 Google Chrome V8 引擎中的一个类型混淆漏洞。该漏洞允许远程攻击者通过构造恶意 HTML 页面，在沙箱内部执行任意代码。漏洞利用的根本原因是 V8 引擎在处理 JavaScript 模块命名空间对象时，访问信息不正确，导致 Maglev 优化器出现类型混淆。

**有效性：**
根据漏洞库信息和搜索引擎结果，该漏洞已经被积极利用。提供的 PoC 代码旨在通过*对象哈希重新分配*技术来利用此漏洞。该 PoC 通过修改模块的属性类型，从 `PropertyArray` 切换到 `NameDictionary`，从而改变哈希值的存储位置。然后，通过垃圾回收和 FinalizationRegistry 机制来触发类型混淆，最终实现任意代码执行的目的。分析代码可知, POC 本身比较复杂，涉及多个 V8 内部机制，但是逻辑是合理的，因此，PoC代码应该是有效的。

**投毒风险：**
分析提供的 PoC 代码，主要关注以下几个方面：

1.  **代码目的：** PoC 的目的是演示如何利用类型混淆漏洞，通过*对象哈希重新分配*在 V8 引擎中执行任意代码。
2.  **代码行为：** PoC 代码涉及到创建对象、修改对象属性、触发垃圾回收、以及使用 FinalizationRegistry 等操作，这些操作都是为了触发漏洞而设计的。
3.  **潜在风险：** 虽然 PoC 代码本身旨在演示漏洞，但如果直接在生产环境中使用，可能会导致浏览器崩溃或被恶意利用。

综上所述，该 PoC 代码主要是为了演示漏洞，而不是恶意代码。代码中并没有明显的后门或恶意行为。但是，利用该漏洞本身就具有极高的风险，可能导致任意代码执行。
由于漏洞利用的复杂性，并且需要特定的 V8 引擎版本，因此恶意攻击者很难在 PoC 代码中隐藏恶意代码，并且能够成功利用。但是，不排除攻击者在 PoC 的基础上进行修改，添加恶意代码的可能性。
根据分析，仓库中存在作者隐藏的投毒代码的风险较低，大约在1%左右。

**利用方式：**
1.  **类型混淆：** 漏洞的核心在于 V8 引擎在处理 JavaScript 模块命名空间对象时，由于访问信息不正确，导致 Maglev 优化器出现类型混淆。
2.  **对象哈希重新分配：** 攻击者通过修改模块的属性类型，从 `PropertyArray` 切换到 `NameDictionary`，从而改变哈希值的存储位置。
3.  **垃圾回收和 FinalizationRegistry：** 利用垃圾回收和 FinalizationRegistry 机制来触发类型混淆。
4.  **任意代码执行：** 最终，攻击者可以利用类型混淆漏洞，在沙箱内部执行任意代码。

**项目地址:** [bjrjk/CVE-2024-4947](https://github.com/bjrjk/CVE-2024-4947)

**漏洞详情:** [CVE-2024-4947](https://nvd.nist.gov/vuln/detail/CVE-2024-4947)