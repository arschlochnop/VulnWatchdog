## CVE-2023-7028-GitLab-账户接管

**漏洞编号:** CVE-2023-7028

**漏洞类型:** 弱口令重置机制

**影响应用:** GitLab

**危害等级:** 高危，允许攻击者接管任何用户账户，包括管理员账户

**影响版本:** 16.1 prior to 16.1.6, 16.2 prior to 16.2.9, 16.3 prior to 16.3.7, 16.4 prior to 16.4.5, 16.5 prior to 16.5.6, 16.6 prior to 16.6.4, and 16.7 prior to 16.7.2

**利用条件:** 目标GitLab实例存在漏洞，并且攻击者能够访问网络。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-7028 存在于 GitLab 的密码重置功能中。攻击者可以通过提供两个邮箱地址（目标用户的邮箱地址和攻击者控制的邮箱地址）来触发漏洞。当用户请求密码重置时，系统会将重置链接同时发送到这两个邮箱地址。攻击者利用此漏洞可以获取重置链接，从而重置目标用户的密码，实现账户接管。

**有效性：**
根据漏洞信息和搜索结果，提供的PoC代码是有效的。多个来源表明该漏洞允许未经身份验证的攻击者执行账户接管，且CISA已将该漏洞添加到已知被利用的漏洞目录 (KEV)。PoC 代码 `attack.py` 实现了利用该漏洞的逻辑：

1.  **获取 CSRF Token：** 从密码重置页面获取 CSRF token，用于绕过 CSRF 保护。
2.  **发送重置请求：** 构造包含两个邮箱地址 (`target` 和 `evil`) 的 POST 请求到 `/users/password` 接口。`user[email][]` 参数允许传入多个邮箱地址。
3.  **账户接管：**  gitlab会给target和evil邮箱都发送重置邮件。攻击者利用发送到`evil`邮箱的重置链接来重置目标账户。

**投毒风险：**
代码中存在一定的投毒风险，但风险较低。主要风险点在于：

*   **硬编码 Flag 值：** 代码中有一行 `print(f'Flag value: {bytes.fromhex("6163636f756e745f6861636b2364").decode()}')`，这可能是作者故意添加的，用于在成功利用漏洞后显示一个“flag”，误导使用者。虽然它本身不是恶意代码，但可能被滥用，造成误导。

综合评估，投毒风险约为 5%。主要因为PoC的主要功能是实现漏洞利用，而潜在的恶意代码（硬编码flag）相对独立。

**利用方式：**
1.  确定目标GitLab实例存在漏洞。
2.  运行 PoC 脚本，指定目标用户的邮箱地址和攻击者控制的邮箱地址。
3.  检查攻击者控制的邮箱，获取密码重置链接。
4.  使用重置链接重置目标用户的密码，实现账户接管。

**命令示例：**
`python3 attack.py -u http://Target_IP:8000 -t victim@mail.gitlab.thm -e attacker@mail.gitlab.thm`


**项目地址:** [Sornphut/CVE-2023-7028-GitLab](https://github.com/Sornphut/CVE-2023-7028-GitLab)

**漏洞详情:** [CVE-2023-7028](https://nvd.nist.gov/vuln/detail/CVE-2023-7028)