## CVE-2022-46169-Cacti-命令注入

**漏洞编号:** CVE-2022-46169

**漏洞类型:** 命令注入

**影响应用:** Cacti

**危害等级:** 高危，允许未经身份验证的攻击者执行任意命令

**影响版本:** < 1.2.23

**利用条件:** 目标系统运行受影响的Cacti版本，并且存在action类型为POLLER_ACTION_SCRIPT_PHP的poller_item。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-46169是Cacti中存在的一个未经身份验证的命令注入漏洞。漏洞位于`remote_agent.php`文件中。由于`get_client_addr`函数对客户端IP地址的验证不充分，攻击者可以通过设置`HTTP_`开头的`$_SERVER`变量来伪造IP地址，绕过身份验证。绕过身份验证后，攻击者可以通过`polldata`操作，利用`poller_id`参数中的命令注入漏洞，执行任意系统命令。

**漏洞利用方式：**
1.  攻击者发送包含`Forwarded-For`头部的HTTP请求到`remote_agent.php`，伪造客户端IP地址，绕过身份验证。
2.  攻击者构造包含恶意命令的`poller_id`参数，并将其作为`polldata`操作的一部分发送到`remote_agent.php`。
3.  服务器执行攻击者提供的恶意命令。

**有效性：**
提供的POC代码`CVE-2022-46169.py`是一个简单的漏洞检测脚本，它通过发送包含特定参数的HTTP GET请求到`remote_agent.php`来判断目标系统是否存在漏洞。该脚本并非完整的漏洞利用代码，但它可以用来验证目标系统是否容易受到攻击。

**投毒风险：**
分析了提供的POC代码和相关文件，没有发现明显的恶意代码或后门。`requirements.txt`中列出的依赖项`optparse`, `httpx`, `termcolor` 都是常见的Python库，没有已知的安全问题。作者隐藏的投毒代码可能性较低，风险评估为0%。

**项目地址:** [doosec101/CVE-2022-46169](https://github.com/doosec101/CVE-2022-46169)

**漏洞详情:** [CVE-2022-46169](https://nvd.nist.gov/vuln/detail/CVE-2022-46169)