## CVE-2017-5638 Apache Struts 远程代码执行

**漏洞编号:** CVE-2017-5638

**漏洞类型:** 远程代码执行

**影响应用:** Apache Struts

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** 2.3.5-2.3.31, 2.5-2.5.10

**利用条件:** 目标系统运行存在漏洞的Apache Struts版本，并且可以通过HTTP访问。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2017-5638是Apache Struts框架中的一个远程代码执行漏洞。该漏洞源于Jakarta Multipart parser在处理文件上传请求时，由于Content-Type头信息解析错误，导致OGNL表达式注入。攻击者可以通过构造恶意的Content-Type、Content-Disposition或Content-Length HTTP头信息，在服务器上执行任意命令。

**有效性：**
根据漏洞库信息、搜索结果以及提供的漏洞利用代码，该漏洞是有效的。搜索结果中提到该漏洞被广泛利用，并导致了严重的安全事件，例如Equifax数据泄露事件。提供的Python代码是一个POC，可以用于验证和利用该漏洞。

**投毒风险：**
虽然代码看起来是直接的漏洞利用程序，但是仍然存在一定的投毒风险。以下是风险评估和分析：
*   **网络请求依赖:** 代码依赖 `urllib2`，需要能够访问互联网。攻击者可能会修改代码，使其在特定条件下向恶意服务器发送敏感信息，或者从恶意服务器下载payload执行。这个风险较低，因为基本功能是命令执行。
*   **命令执行：** POC代码允许执行任意命令。如果该代码被修改并分发，攻击者可以将恶意命令硬编码到POC中，从而感染所有使用修改后POC的用户。
*   **Blind Injection 的依赖:** 代码中的blind injection依赖于外部IP并且需要apache可以读取log文件。此过程可能存在后门代码，但是需要进一步分析，才能判断。

 总体来说，该仓库中存在作者隐藏投毒代码的风险较低，大概在10%左右。 主要风险在于使用者不清楚代码逻辑，直接修改其中的cmd参数。

**利用方式：**
1.  攻击者构造包含恶意OGNL表达式的HTTP请求，特别是Content-Type头。
2.  当Struts应用解析该请求时，恶意OGNL表达式会被执行。
3.  攻击者可以利用OGNL表达式执行任意系统命令，例如反弹shell，上传恶意文件等。
4.  提供的POC代码利用了这一漏洞，通过修改Content-Type头，在目标服务器上执行指定的命令。


**项目地址:** [tahmed11/strutsy](https://github.com/tahmed11/strutsy)

**漏洞详情:** [CVE-2017-5638](https://nvd.nist.gov/vuln/detail/CVE-2017-5638)