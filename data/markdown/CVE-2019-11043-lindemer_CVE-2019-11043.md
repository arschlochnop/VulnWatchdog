## CVE-2019-11043 - PHP-FPM 远程代码执行

**漏洞编号:** CVE-2019-11043

**漏洞类型:** 缓冲区下溢

**影响应用:** PHP-FPM

**危害等级:** 高危，可导致远程代码执行

**影响版本:** PHP 7.1.x (< 7.1.33), 7.2.x (< 7.2.24), 7.3.x (< 7.3.11)

**利用条件:** Nginx 作为前端，配置不当，将请求传递给 PHP-FPM 处理

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-11043 漏洞是 PHP-FPM 中的一个缓冲区下溢漏洞。当 Nginx 配置不正确时，恶意请求可以通过 FastCGI 协议发送给 PHP-FPM。漏洞的根本原因是 PHP-FPM 在处理包含换行符的 URI 时，`path_info` 长度计算错误，导致缓冲区下溢。攻击者可以通过精心构造的 URI，覆盖 FastCGI 内部的数据结构，例如环境变量。通过覆盖环境变量，攻击者可以插入任意 PHP 变量，最终实现远程代码执行。

**利用方式：**

1.  利用 Nginx 配置不当，允许恶意请求传递给 PHP-FPM。
2.  构造包含换行符（`%0a`）的 URI，触发 `path_info` 长度计算错误。
3.  通过控制 URI 的长度，精确地覆盖 FastCGI 内部的数据结构，例如 `SCRIPT_FILENAME`。
4.  覆盖 `SCRIPT_FILENAME` 为恶意 PHP 代码，或使用其他方法执行任意代码。
5.  发送请求，触发恶意代码执行。

**有效性：**

提供的漏洞利用代码是有效的，它复现了该漏洞，并允许远程代码执行。

**投毒风险：**

该仓库中存在一定投毒风险，但概率较低。风险点在于 exploit.py 可能被修改,加入恶意代码. 通过review README.md,发现漏洞原理分析比较清晰,且给出了其他学习资料链接,具有参考价值. 综合评估,投毒风险为 10%。

**项目地址:** [lindemer/CVE-2019-11043](https://github.com/lindemer/CVE-2019-11043)

**漏洞详情:** [CVE-2019-11043](https://nvd.nist.gov/vuln/detail/CVE-2019-11043)