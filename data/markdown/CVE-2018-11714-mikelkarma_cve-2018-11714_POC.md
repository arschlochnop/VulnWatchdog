## CVE-2018-11714 - TP-Link TL-WR840N/TL-WR841N 身份验证绕过

**漏洞编号:** CVE-2018-11714

**漏洞类型:** 身份验证绕过

**影响应用:** TP-Link TL-WR840N/TL-WR841N

**危害等级:** 高危，可能导致完全控制路由器

**影响版本:** TL-WR840N v5 00000005 0.9.1 3.16 v0001.0 Build 170608 Rel.58696n 和 TL-WR841N v13 00000013 0.9.1 4.16 v0001.0 Build 170622 Rel.64334n

**利用条件:** 需要与目标路由器在同一网络

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2018-11714 存在于 TP-Link TL-WR840N 和 TL-WR841N 路由器中，由于 `/cgi/` 目录或 `/cgi` 文件中不正确的会话处理导致。攻击者通过发送 `Referer: http://192.168.0.1/mainFrame.htm` 头部，即可绕过身份验证，执行任意操作。

**有效性评估：**
提供的PoC代码 `poc.py` 尝试利用此漏洞。它通过设置 `Referer` 头部，尝试访问 `/cgi/conf.bin` 文件（路由器配置）。如果成功，会将配置文件保存到本地 `conf.bin` 文件中，然后解密该文件。

**投毒风险分析：**
PoC代码本身看起来很简单，主要用于下载和解密配置文件。投毒风险较低，约为5%。可能的投毒方式包括：

1.  **恶意修改配置文件：** 虽然PoC代码只是下载配置文件，但如果将其修改为上传修改后的配置文件，就可能植入恶意配置，例如修改DNS服务器、添加后门用户等。
2.  **进一步的利用脚本：** 该PoC只下载了配置文件，攻击者可以将下载的文件，写入恶意代码或者其他攻击行为。

**漏洞利用方式：**
1.  **发送包含特定Referer头的HTTP请求：** 攻击者向目标路由器发送HTTP请求，并在请求头中设置 `Referer: http://192.168.0.1/mainFrame.htm`。  由于路由器对该头部验证不充分，导致身份验证绕过。
2.  **访问敏感的CGI接口：** 成功绕过身份验证后，攻击者可以访问路由器上受保护的CGI接口，例如获取配置信息、修改设置等。
3.  **下载配置文件：** 攻击者下载路由器的配置文件，其中可能包含敏感信息，如管理员密码、WPA/WPA2密钥等。
4.  **解密配置文件：**  PoC代码中包含了解密配置文件的步骤，使用了DES-ECB加密算法和密钥`478DA50BF9E3D2CF`，解密后可以获取路由器的完整配置。

**项目地址:** [mikelkarma/cve-2018-11714_POC](https://github.com/mikelkarma/cve-2018-11714_POC)

**漏洞详情:** [CVE-2018-11714](https://nvd.nist.gov/vuln/detail/CVE-2018-11714)