## CVE-2019-20372-Nginx HTTP Request Smuggling

**漏洞编号:** CVE-2019-20372

**漏洞类型:** HTTP Request Smuggling

**影响应用:** Nginx

**危害等级:** 中危，可能导致未授权访问

**影响版本:** < 1.17.7

**利用条件:** 需要Nginx服务器以负载均衡方式部署，并且存在特定的error_page配置。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-20372 是一个 Nginx 的 HTTP 请求走私漏洞。此漏洞存在于 Nginx 1.17.7 之前的版本中，当 Nginx 使用特定的 error_page 配置时，允许攻击者通过构造恶意 HTTP 请求，走私请求到后端服务器，从而读取未授权的页面。

**漏洞利用方式：**
1.  攻击者发送一个精心构造的 HTTP 请求，该请求会被 Nginx 部分解析。
2.  由于 error_page 配置不当，Nginx 在处理错误页面时，会将后续的请求数据错误地附加到当前的请求中。
3.  负载均衡器将这个包含“走私”请求的请求转发到后端服务器。
4.  后端服务器会按照 Nginx 错误处理后的数据解析请求，导致“走私”的请求被当做下一个请求的一部分处理，从而可能访问到其他用户的请求或执行其他恶意操作。

**POC有效性：**
提供的 POC 代码尝试利用 PUT 方法上传一个 PHP 文件到目标服务器。如果服务器存在漏洞，并且 PUT 方法被允许，那么恶意 PHP 文件可能会被成功上传并执行。

**投毒风险：**
分析提供的Python脚本，脚本的主要功能是检测Nginx的版本并尝试上传一个包含`<?php system('id'); ?>`的PHP文件，该PHP文件的目的是执行`id`命令来验证漏洞是否成功利用。这个脚本本身并没有发现恶意或隐藏的代码，它只是一个简单的漏洞验证工具，因此判定不存在投毒代码。

**项目地址:** [moften/CVE-2019-20372](https://github.com/moften/CVE-2019-20372)

**漏洞详情:** [CVE-2019-20372](https://nvd.nist.gov/vuln/detail/CVE-2019-20372)