## CVE-2025-49844-Redis-Lua Use-After-Free

**漏洞编号:** CVE-2025-49844

**漏洞类型:** Use-After-Free

**影响应用:** Redis

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** < 8.2.2

**利用条件:** 需要Redis服务器开启Lua脚本功能，并且攻击者拥有执行 EVAL 和 EVALSHA 命令的权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于Redis的Lua脚本执行环境中，允许经过身份验证的用户通过精心构造的Lua脚本操纵垃圾回收器，触发use-after-free漏洞，从而可能导致远程代码执行。漏洞利用方式是发送特制的Lua脚本到Redis服务器，利用Lua的垃圾回收机制，触发UAF漏洞。提供的Python脚本`redis_checker.py`是一个漏洞检测工具，而非直接的漏洞利用代码。它连接到Redis服务器，检查Redis版本是否在受影响的范围内，并测试Lua脚本是否启用。其中`test_uaf_pattern`函数尝试模拟触发UAF的场景，但本身并不执行任意代码。投毒风险较低，主要集中在依赖库和脚本执行环境的安全上，因为攻击者可以通过篡改依赖库或脚本来植入恶意代码。该工具的作者声明仅用于授权的渗透测试。需要注意的是，即使脚本本身没有后门，运行脚本的环境也可能存在风险。

**有效性评估：**
根据漏洞库信息，该漏洞是真实存在的，且CVSS评分为10分，属于严重漏洞。提供的Python脚本是一个漏洞检测工具，可以验证Redis服务器是否存在该漏洞。通过检查版本和Lua脚本是否启用，可以初步判断Redis服务器是否容易受到攻击。

**漏洞利用方式：**
攻击者需要先通过身份验证（如果Redis服务器配置了密码），然后发送一个精心构造的Lua脚本到Redis服务器。这个Lua脚本需要能够触发Lua垃圾回收器的use-after-free漏洞。成功利用该漏洞后，攻击者可以在Redis服务器上执行任意代码。

**投毒风险分析：**
代码中的投毒风险较低，但仍然存在。风险点主要包括：

1.  **依赖库风险：**`redis`和`packaging`库如果被恶意替换，可能导致任意代码执行。可以使用哈希校验等方式验证这些库的完整性。
2.  **脚本执行环境风险：** 运行脚本的机器如果已经被攻陷，攻击者可以修改脚本或者在脚本执行过程中注入恶意代码。

尽管存在潜在的投毒风险，但鉴于该脚本的主要功能是检测漏洞，并没有明显的后门或恶意代码，因此，评估投毒风险为10%。

**项目地址:** [Mufti22/CVE-2025-49844-RediShell-Vulnerability-Scanner](https://github.com/Mufti22/CVE-2025-49844-RediShell-Vulnerability-Scanner)

**漏洞详情:** [CVE-2025-49844](https://nvd.nist.gov/vuln/detail/CVE-2025-49844)