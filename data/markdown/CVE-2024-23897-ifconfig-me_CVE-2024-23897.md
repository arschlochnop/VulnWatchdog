## CVE-2024-23897 Jenkins 任意文件读取漏洞

**漏洞编号:** CVE-2024-23897

**漏洞类型:** 任意文件读取

**影响应用:** Jenkins

**危害等级:** 高危，可能导致敏感信息泄露

**影响版本:** Jenkins 2.441 及更早版本，LTS 2.426.2 及更早版本

**利用条件:** 目标Jenkins实例需要开启CLI接口且版本受漏洞影响。无需身份验证。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-23897 漏洞是 Jenkins CLI 命令解析器中的一个缺陷，该缺陷允许未经身份验证的攻击者读取 Jenkins 控制器文件系统上的任意文件。漏洞原因是 Jenkins 没有禁用其 CLI 命令解析器的一个特性，该特性会将参数中以'@'字符开头的后跟文件路径的内容替换为该文件的内容。

**有效性：**
根据漏洞信息和搜索引擎结果，该漏洞已经确认存在，并且有公开的PoC代码可用。PoC代码利用了 Jenkins CLI 的参数解析特性，通过构造包含 `@/path/to/file` 的payload，可以读取服务器上的文件。

**投毒风险：**
PoC代码本身主要功能是读取文件，但存在轻微的潜在风险。

*   **Payload生成函数：**  `gen_payload` 函数构造payload时，如果攻击者控制了`path`变量，可以尝试读取任意文件。
*   **外部URL列表：** PoC从外部文件读取目标URL列表。如果该文件被篡改，可能导致PoC攻击错误的目标，或被用于扫描不应扫描的系统。
*   **subprocess.run：** PoC代码使用 `subprocess.run` 命令执行外部的 `jenkins-cli.jar`， 这存在一定的风险。如果 `jenkins-cli.jar` 文件被替换为恶意文件，可能导致远程代码执行。但是，该PoC使用 `stderr=subprocess.DEVNULL` 来丢弃错误信息，这会使排查问题变得更加困难。PoC验证的后门代码判定为正常代码。
*   **忽略SSL警告:** PoC代码忽略SSL证书警告，如果中间人存在，存在被中间人攻击的风险。

综合来看，直接的投毒代码可能性较低（约10%），但使用者需要注意外部URL列表和 `jenkins-cli.jar` 的来源安全性，以及忽略SSL警告带来的潜在风险。

**利用方式：**
1.  攻击者构造恶意的CLI命令，其中包含 `@/path/to/file` 形式的参数。
2.  攻击者通过HTTP/WebSocket/SSH等方式将命令发送到Jenkins CLI接口。
3.  Jenkins CLI解析命令时，会将`@/path/to/file`替换为指定文件的内容。
4.  攻击者即可获取文件内容，实现任意文件读取。

**项目地址:** [ifconfig-me/CVE-2024-23897](https://github.com/ifconfig-me/CVE-2024-23897)

**漏洞详情:** [CVE-2024-23897](https://nvd.nist.gov/vuln/detail/CVE-2024-23897)