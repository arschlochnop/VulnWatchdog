## CVE-2007-4559-Python tarfile 目录遍历漏洞

**漏洞编号:** CVE-2007-4559

**漏洞类型:** 目录遍历

**影响应用:** Python tarfile module

**危害等级:** 高危，可能导致任意文件覆盖和远程代码执行

**影响版本:** 受影响版本未知，但漏洞存在时间长，修复不及时

**利用条件:** 用户需要解压恶意构造的TAR文件

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2007-4559 存在于 Python 的 tarfile 模块中。当使用 `extract()` 或 `extractall()` 函数解压 TAR 文件时，如果 TAR 文件中包含带有 `..` 序列的文件名（例如 `../../../../etc/passwd`），则可能导致目录遍历漏洞。这使得攻击者可以将文件写入到目标系统上的任意位置，从而覆盖敏感文件、执行恶意代码等。

**有效性：**
提供的 PoC 代码 `CVE-2007-4559-PoC.py` 旨在演示此漏洞。它创建了一个包含恶意路径的 TAR 文件，并尝试将其解压到 `/tmp/passwd.etc`。代码会检查文件是否成功解压，从而确认漏洞的存在。根据代码逻辑和漏洞描述，该 PoC 代码是有效的。

**投毒风险：**
虽然 PoC 代码本身用于演示漏洞，但仍然需要评估该代码是否存在投毒风险。风险评估如下:

*   **Payload 功能明确:** PoC 脚本目的在于利用目录遍历漏洞，将特定内容写入`/tmp/passwd.etc`。
*   **行为可控:** 脚本的行为相对明确和可控，即创建恶意tar包，解压到指定位置，并检查结果。
*   **代码量少:** 代码量相对较少，容易审核。

虽然PoC本身的目的不是投毒，但是如果有人利用此代码传播恶意软件，那么以下几个方面可能存在潜在风险：
1. 修改目标文件路径：攻击者可以修改`danger_file`变量，将恶意文件写入更关键的系统文件，例如修改`/etc/rc.local`实现开机自启动，或者覆盖web服务器的配置文件等，从而实现更高级的攻击。
2. 植入恶意代码：攻击者可以在写入的文件内容中植入恶意代码，例如webshell、反弹shell脚本等，进一步控制受害者系统。
3. 捆绑其他恶意脚本：将PoC脚本与其他恶意脚本捆绑在一起，形成更复杂的攻击链。

考虑到以上潜在风险，以及代码创建tar包并解压的特性，存在一定的被修改后用于恶意用途的风险。因此，将投毒风险评估为10%。

**利用方式：**
1.  **构造恶意 TAR 文件：** 攻击者创建一个包含带有 `..` 序列的文件名的 TAR 文件。
2.  **诱骗用户解压：** 攻击者通过某种方式（例如，通过电子邮件、网站等）将恶意 TAR 文件发送给用户，并诱骗用户使用存在漏洞的 `tarfile.extract()` 或 `extractall()` 函数进行解压。用户可能被欺骗是因为他们信任来源或不了解潜在风险。
3.  **利用目录遍历：** 当用户解压恶意 TAR 文件时，`tarfile` 模块会尝试将文件提取到 TAR 文件中指定的路径。由于存在 `..` 序列，`tarfile` 模块可能会将文件提取到目标系统上的任意位置。
4.  **覆盖或创建恶意文件：** 攻击者利用目录遍历漏洞，将恶意文件写入到目标系统上的敏感位置，例如覆盖系统配置文件、Web 服务器文件等。或者创建一个可以执行的恶意文件。
5.  **控制系统：** 通过覆盖敏感文件或创建恶意文件，攻击者最终可以控制目标系统。

**项目地址:** [depers-rus/CVE-2007-4559](https://github.com/depers-rus/CVE-2007-4559)

**漏洞详情:** [CVE-2007-4559](https://nvd.nist.gov/vuln/detail/CVE-2007-4559)