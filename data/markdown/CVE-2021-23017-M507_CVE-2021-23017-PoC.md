## CVE-2021-23017-Nginx Resolver 内存覆盖漏洞

**漏洞编号:** CVE-2021-23017

**漏洞类型:** 内存覆盖

**影响应用:** Nginx

**危害等级:** 高危，可能导致worker进程崩溃或潜在其他影响

**影响版本:** Nginx Web Server versions 0.6.18 thru 1.20.0 before 1.20.1, Nginx plus versions R13 thru R23 before R23 P1. Nginx plus version R24 before R24 P1

**利用条件:** 目标启用了DNS解析器，且攻击者可以伪造来自DNS服务器的UDP数据包。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-23017是Nginx解析器中的一个安全问题，允许攻击者通过伪造来自DNS服务器的UDP数据包，造成1字节的内存覆盖，导致worker进程崩溃或潜在的其他影响。

**漏洞利用分析：**

1.  **漏洞原理：** 该漏洞是由于Nginx解析器在处理DNS响应时，没有充分验证响应的长度，导致可以写入超出缓冲区边界的数据。
2.  **利用方式：**
    *   攻击者首先需要能够拦截或伪造目标服务器的DNS查询请求的响应。
    *   攻击者构造一个恶意的DNS响应，该响应包含的数据长度超过了Nginx解析器分配的缓冲区大小。
    *   当Nginx解析器处理这个恶意的DNS响应时，会发生1字节的内存覆盖。
    *   内存覆盖可能导致worker进程崩溃，或者如果覆盖了关键的数据结构，可能会导致更严重的后果。
3.  **POC 分析:**
    *   POC代码使用Scapy库来构建和发送恶意UDP数据包。
    *   代码首先设置网络接口，启用IP转发，并阻止正常的DNS流量(iptables -A FORWARD -p UDP --dport 53 -j DROP)。
    *   然后，它通过ARP欺骗来劫持目标和DNS服务器之间的流量。
    *   当目标发起DNS查询时，PoC会拦截该请求并构建一个包含恶意payload的DNS响应。
    *   恶意的DNS响应被发送给目标，从而触发漏洞。

**投毒风险评估：**

尽管POC本身的功能是演示漏洞利用，但存在一定的投毒风险。风险点在于:

*   代码包含`os.system`调用，可以执行任意系统命令。虽然目前用于设置网络环境（例如开启IP转发，阻断正常的DNS查询），但理论上可以修改为执行其他恶意操作。
*   ARP欺骗本身是一种中间人攻击手段，可能被滥用以进行流量嗅探或数据篡改。
*   虽然代码声明仅用于学术研究和防御目的，但实际使用取决于使用者，存在被恶意利用的可能。
*  PoC存在一定的依赖性，依赖`requirements.txt` 中的第三方库。

**有效性评估：**

根据漏洞信息和POC代码，可以判断该漏洞利用的有效性较高，前提是满足利用条件（目标启用了DNS解析器，攻击者可以伪造DNS响应）。 提供的POC代码具有一定的可行性，根据github上开源信息具有一定的有效性。


**项目地址:** [M507/CVE-2021-23017-PoC](https://github.com/M507/CVE-2021-23017-PoC)

**漏洞详情:** [CVE-2021-23017](https://nvd.nist.gov/vuln/detail/CVE-2021-23017)