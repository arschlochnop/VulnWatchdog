## ThingsBoard Stored XSS 导致权限提升

**漏洞编号:** CVE-2024-55466

**漏洞类型:** 存储型跨站脚本 (Stored XSS)

**影响应用:** ThingsBoard

**危害等级:** 高危，通过盗取身份验证令牌可导致权限提升

**影响版本:** 所有 ThingsBoard 版本（包括 Community, Cloud, 和 Professional 版本）

**利用条件:** 需要低权限用户账户，管理员用户访问恶意链接

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

该漏洞存在于 ThingsBoard 的 Image Gallery 功能中。攻击者可以上传包含恶意 JavaScript 代码的 SVG 文件。当其他用户（包括管理员）访问该 SVG 文件时，恶意 JavaScript 代码会在其浏览器中执行，从而导致身份验证令牌被盗取，攻击者可以利用盗取的令牌提升自己的权限。POC 代码展示了如何上传包含 XSS Payload 的 SVG 文件，以及如何触发该漏洞。由于 POC 代码清晰地展示了漏洞利用的步骤，并且没有发现任何隐藏的恶意代码，因此投毒风险较低，评估为0%。

**利用方式:**

1.  **低权限用户上传恶意 SVG 文件:** 利用 Image Gallery 功能上传包含 JavaScript payload 的 SVG 文件。
2.  **获取文件 publicLink:**  上传成功后，获取该文件的访问链接 (publicLink)。
3.  **诱导高权限用户访问链接:**  诱骗 Tenant 管理员或 Company 管理员等高权限用户访问该 publicLink。
4.  **盗取身份验证令牌:**  高权限用户访问该链接时，SVG 文件中的 JavaScript payload 会执行，盗取其身份验证令牌。
5.  **权限提升:**  利用盗取的身份验证令牌，攻击者可以提升自己的权限。

**项目地址:** [cybsecsid/ThingsBoard-CVE-2024-55466](https://github.com/cybsecsid/ThingsBoard-CVE-2024-55466)

**漏洞详情:** [CVE-2024-55466](https://nvd.nist.gov/vuln/detail/CVE-2024-55466)