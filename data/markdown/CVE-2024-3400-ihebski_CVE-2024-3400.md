## CVE-2024-3400 - Palo Alto Networks PAN-OS GlobalProtect Command Injection

**漏洞编号:** CVE-2024-3400

**漏洞类型:** 命令注入

**影响应用:** Palo Alto Networks PAN-OS (GlobalProtect)

**危害等级:** 高危，未授权的远程代码执行，可获取 root 权限

**影响版本:** PAN-OS 10.2 < 10.2.9-h1, 11.0 < 11.0.4-h1, 11.1 < 11.1.2-h3

**利用条件:** 需要配置 GlobalProtect 网关或门户。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-3400 是 Palo Alto Networks PAN-OS GlobalProtect 功能中的一个命令注入漏洞。未经身份验证的攻击者可以通过精心构造的请求，在受影响的设备上以 root 权限执行任意代码。漏洞利用涉及任意文件创建，进而导致命令注入。根据漏洞库信息，存在野外利用，CISA KEV 也收录了该漏洞。

**有效性：** 根据提供的漏洞利用代码和搜索引擎结果，该 POC 代码是有效的。POC 通过构造包含路径遍历的 Cookie，在指定位置创建文件，验证是否存在漏洞。更进一步的RCE利用需要启用Telemetry。

**投毒风险：** 漏洞利用代码主要由一个 YAML 文件 (NUCLEI 模板) 和 README 文件组成。YAML 文件定义了漏洞验证的 HTTP 请求，README 描述了漏洞和利用方法。license文件是MIT开源协议。风险在于，如果攻击者修改 YAML 文件，例如在 POST 请求中添加额外的恶意载荷，就可能存在投毒风险。该仓库本身相对简单，投毒点在于利用方式的描述和 YAML 文件内容，但整体风险较低，预计约为 10%。由于要依赖于 Telemetry 开启才能进一步的RCE利用，所以投毒的价值不大，

**利用方式：**
1.  发送一个包含特殊构造的 `SESSID` Cookie 的 POST 请求到 `/ssl-vpn/hipreport.esp`。Cookie 中的路径遍历用于指定文件创建的位置。
2.  如果存在漏洞，服务器会根据Cookie中的文件名创建文件.
3. 验证思路：尝试访问创建的文件。如果返回 403 状态码（禁止访问），则表示目标存在漏洞，且文件创建成功(文件创建的权限是root权限)。
4. 进一步的RCE,通过Telemetry日志分析与控制，发送含有命令的Cookie进行RCE攻击

**项目地址:** [ihebski/CVE-2024-3400](https://github.com/ihebski/CVE-2024-3400)

**漏洞详情:** [CVE-2024-3400](https://nvd.nist.gov/vuln/detail/CVE-2024-3400)