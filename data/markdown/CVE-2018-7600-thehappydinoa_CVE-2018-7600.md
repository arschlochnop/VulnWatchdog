## CVE-2018-7600 Drupalgeddon2 RCE

**漏洞编号:** CVE-2018-7600

**漏洞类型:** 远程代码执行

**影响应用:** Drupal

**危害等级:** 高危，允许远程攻击者执行任意代码

**影响版本:** Drupal before 7.58, 8.x before 8.3.9, 8.4.x before 8.4.6, and 8.5.x before 8.5.1

**利用条件:** 目标Drupal站点版本在受影响范围内，且存在默认或常见的模块配置。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2018-7600，又名Drupalgeddon2，是一个Drupal核心的远程代码执行漏洞。该漏洞源于Drupal在处理某些用户输入时存在缺陷，允许未经身份验证的攻击者通过构造特殊的请求来执行任意代码。

**有效性分析：**

*   漏洞库信息和搜索引擎结果均表明该漏洞是一个严重的安全问题，影响多个Drupal版本，并允许远程代码执行。
*   提供的POC代码尝试通过`drupal_ajax`接口注册用户，并利用`exec` markup执行bash命令。POC会执行`id`命令，并将结果写入一个随机名称的文件中，然后尝试通过HTTP访问该文件以验证漏洞利用是否成功。成功后，会尝试删除该文件。
*   多个Exploit-DB链接（如44448, 44449, 44482）表明存在公开可用的漏洞利用代码。

综合来看，提供的POC代码是有效的，可以用来验证目标Drupal站点是否存在CVE-2018-7600漏洞。

**投毒风险分析：**

*   POC代码本身主要功能是执行命令并将结果写入文件，之后验证文件是否可访问，以验证漏洞存在性。这种模式本身存在潜在的投毒风险，攻击者可以将恶意代码注入到被写入的文件中，或者修改POC使其执行更具破坏性的操作。
*   代码中`random_file_name`变量虽然使用了随机文件名，但如果被成功利用，攻击者可以精确控制写入内容和删除操作，因此存在恶意利用的可能性。
*   `download_command` 和 `rm_command` 如果被篡改，可能导致下载恶意文件或删除重要文件，因此也有潜在风险。
*   `tor_proxy`选项的存在意味着该POC可能被用于隐藏攻击者的真实IP地址，这增加了追踪和溯源的难度。
*   综合代码，投毒风险评估为10%。主要是因为POC的主要目的是验证漏洞，而大规模恶意利用需要在代码层面进行显著修改。

**利用方式分析：**

1.  **构造恶意请求：** 攻击者发送包含恶意代码的特殊构造的HTTP请求到Drupal站点。
2.  **利用`drupal_ajax`接口：** POC利用Drupal的`drupal_ajax`接口来触发漏洞。
3.  **远程代码执行：** 恶意代码通过Drupal的输入处理缺陷被执行，导致远程代码执行。
4.  **验证与清理（POC）：** POC验证代码执行成功后，会尝试清理现场（删除创建的文件）。实际攻击中，攻击者可能会执行更具破坏性的操作，例如安装后门、窃取数据或篡改网站内容。

**项目地址:** [thehappydinoa/CVE-2018-7600](https://github.com/thehappydinoa/CVE-2018-7600)

**漏洞详情:** [CVE-2018-7600](https://nvd.nist.gov/vuln/detail/CVE-2018-7600)