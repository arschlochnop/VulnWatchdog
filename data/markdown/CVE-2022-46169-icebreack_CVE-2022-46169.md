## CVE-2022-46169-Cacti-远程命令执行

**漏洞编号:** CVE-2022-46169

**漏洞类型:** 远程命令执行 (RCE)

**影响应用:** Cacti

**危害等级:** 高危，允许未经身份验证的攻击者执行任意命令

**影响版本:** < 1.2.23

**利用条件:** 目标服务器运行受影响版本的Cacti，且存在一个action类型为POLLER_ACTION_SCRIPT_PHP的poller_item

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

该漏洞存在于Cacti的remote_agent.php文件中。由于对客户端IP地址的验证存在缺陷，未经身份验证的攻击者可以通过设置X-Forwarded-For头部绕过身份验证，然后利用polldata动作中的命令注入漏洞执行任意命令。

**有效性：**
根据漏洞信息和提供的PoC代码，该漏洞是有效的。PoC代码利用了X-Forwarded-For头部的欺骗来绕过身份验证，然后通过构造包含恶意命令的poller_id参数来触发命令注入。

**投毒风险：**
PoC代码本身的功能是利用已知的漏洞进行攻击，并没有发现隐藏的恶意代码或后门。代码的功能较为清晰，主要包括发送HTTP请求、构造Payload等。因此，可以认为投毒风险为0%。

**利用方式：**
1.  攻击者发送包含`X-Forwarded-For`头的HTTP请求到`remote_agent.php`，将该头部设置为Cacti服务器的IP地址，绕过身份验证。
2.  攻击者构造一个包含恶意命令的`poller_id`参数，并将其作为GET请求参数发送到`remote_agent.php?action=polldata`。
3.  `remote_agent.php`在处理`polldata`动作时，会将`poller_id`参数插入到`proc_open`函数调用的命令中，导致命令注入。
4.  攻击者可以通过暴力破解`host_id`和`local_data_ids`参数，找到一个`action`类型为`POLLER_ACTION_SCRIPT_PHP`的`poller_item`，从而成功执行恶意命令。

**项目地址:** [icebreack/CVE-2022-46169](https://github.com/icebreack/CVE-2022-46169)

**漏洞详情:** [CVE-2022-46169](https://nvd.nist.gov/vuln/detail/CVE-2022-46169)