## CVE-2024-58239

**漏洞编号:** CVE-2024-58239

**漏洞类型:** TLS处理错误

**影响应用:** Linux Kernel

**危害等级:** 可能导致拒绝服务或信息泄露 (取决于具体利用方式)

**影响版本:** Linux kernel 5.1 到 6.8 之前的版本 (部分版本已修复)

**利用条件:** 需要建立TLS连接并发送特制的非DATA记录

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-58239 漏洞存在于 Linux 内核的 TLS 实现中，具体是 `net/tls/tls_sw.c` 文件。该漏洞源于当接收到非DATA类型的TLS记录时，`recv()` 函数没有正确停止，可能导致后续的同类型记录被合并，进而引发问题。 

**有效性评估：**

根据提供的漏洞利用代码和kernelCTF的验证信息，该漏洞的POC代码是有效的。作者已经成功在kernelCTF环境中利用此漏洞获取了flag，并提供了测试脚本和本地运行方法。

**投毒风险评估：**

分析提供的漏洞利用代码，主要包含以下内容：

*   `README.md`: 说明文档，描述了漏洞和利用方法，以及如何复现。
*   `exploit/mitigation-v4-6.6/`: 包含漏洞利用相关的代码和编译脚本。
    *   `server.c`: 服务器端程序，用于建立TLS连接。
    *   `client.c`: 客户端程序，用于触发漏洞。
    *   `Makefile`: 用于编译客户端和服务器端程序的Makefile。
    *   `test.py`: 用于本地测试的Python脚本，启动服务器和QEMU虚拟机。
    *   `calc_AC_rate.py`: 用于计算漏洞利用成功率的Python脚本。

仔细检查这些文件，没有发现明显的恶意代码或者后门。虽然存在一些网络通信代码，但这些都是为了利用漏洞而设计的。投毒风险较低，但不能完全排除，因为源代码审查不能保证100%的安全。可能存在的风险点在于提供的预编译二进制文件或运行时注入恶意代码。 综合评估，投毒风险大约为10%。

**利用方式分析：**

1.  **建立TLS连接：** 首先，攻击者需要在目标系统上建立一个TLS连接。POC代码中包含 `server.c` 和 `client.c` ，分别用于服务端和客户端，模拟TLS连接的建立。
2.  **发送非DATA记录：** 在TLS连接建立后，攻击者需要发送一个非DATA类型的TLS记录。漏洞触发的关键在于接收到非DATA记录后的处理逻辑错误。
3.  **触发漏洞：** 漏洞存在于 `process_rx_list` 函数中，当接收到非DATA记录时，没有正确停止 `recv()` 函数。 如果后面还有相同类型的record,将会合并它们. 从而达到利用目的.
4.  **利用结果：**  kernelCTF 成功获取了 flag。这表明该漏洞可能允许攻击者执行任意代码或泄露敏感信息（取决于具体的利用方式和目标环境）。

该漏洞利用的成功率可能受到多种因素的影响，例如内核版本、配置和缓解措施等。作者提到存在 `common_interrupt` 导致 double free 检测而使 exploit 失败的情况,成功率不太稳定.

**项目地址:** [khoatran107/cve-2024-58239](https://github.com/khoatran107/cve-2024-58239)

**漏洞详情:** [CVE-2024-58239](https://nvd.nist.gov/vuln/detail/CVE-2024-58239)