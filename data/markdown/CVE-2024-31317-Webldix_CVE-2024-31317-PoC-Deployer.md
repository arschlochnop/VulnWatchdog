## CVE-2024-31317-Android Zygote Deserialization

**漏洞编号:** CVE-2024-31317

**漏洞类型:** 特权提升

**影响应用:** Android

**危害等级:** 高危，可导致任意应用代码执行

**影响版本:** Android 12, 12L, 13, 14

**利用条件:** 需要`WRITE_SECURE_SETTINGS`权限和用户执行权限，无需用户交互

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-31317是Android系统中的一个特权提升漏洞，存在于`ZygoteProcess.java`的多个函数中。由于不安全的反序列化，攻击者可以通过`WRITE_SECURE_SETTINGS`权限在任何应用中执行代码。根据漏洞信息和搜索结果，利用此漏洞无需用户交互，攻击者可以利用反序列化漏洞在Zygote进程中注入恶意代码，进而控制新创建的应用进程。提供的POC代码看起来更像一个反向shell的生成脚本，本身不直接包含漏洞利用代码，但脚本生成的反向shell可以通过漏洞利用payload执行，间接完成漏洞利用过程。 投毒风险评估为5%，主要是因为脚本本身会从外部导入payload，存在payload被替换的风险，且脚本作者声明了免责条款，暗示存在一定风险。

**有效性分析：**

根据搜索结果和漏洞描述，漏洞是由于`ZygoteProcess.java`中存在不安全的反序列化造成的，通过`WRITE_SECURE_SETTINGS`权限，可以执行任意应用的代码。提供的脚本创建了一个反向shell，该反向shell需要被注入到利用链中。

**利用方式：**

1.  **获取`WRITE_SECURE_SETTINGS`权限：** 攻击者需要首先获取`WRITE_SECURE_SETTINGS`权限。这可以通过已有的漏洞、权限提升或者恶意应用来实现。
2.  **构造恶意Payload：**  利用不安全的反序列化漏洞，构造恶意的payload，该payload会执行攻击者指定的代码，例如，启动一个反向shell。
3.  **利用Zygote进程：**  通过某种方式触发Zygote进程执行包含恶意payload的反序列化操作。
4.  **代码执行：**  当Zygote进程反序列化恶意数据时，攻击者的代码将在目标应用进程中执行，从而实现权限提升。
5.  **反向Shell连接:** 攻击者通过预设的IP和端口接收反向shell，从而控制设备

**投毒风险分析：**

提供的脚本主要用于生成反向shell相关的代码，本身看起来没有明显的恶意行为。但需要注意以下几点：

*   **Payload的潜在风险：** 该脚本依赖于外部提供的payload。如果payload被替换为恶意代码，则可能导致更严重的后果。
*   **反向Shell风险：** 反向shell本身具有风险，可能被用于非法目的，例如窃取用户数据、远程控制设备等。
*   **脚本作者的免责声明:** 脚本作者声明了免责条款，暗示存在一定风险。

综合来看，该POC脚本存在一定的投毒风险，但风险较低，主要集中在payload的安全性以及脚本本身可能被滥用上。

**项目地址:** [Webldix/CVE-2024-31317-PoC-Deployer](https://github.com/Webldix/CVE-2024-31317-PoC-Deployer)

**漏洞详情:** [CVE-2024-31317](https://nvd.nist.gov/vuln/detail/CVE-2024-31317)