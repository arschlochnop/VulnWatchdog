## CVE-2025-24813 Apache Tomcat RCE

**漏洞编号:** CVE-2025-24813

**漏洞类型:** 远程代码执行 (RCE) / 信息泄露

**影响应用:** Apache Tomcat

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** 11.0.0-M1 <= version <= 11.0.2, 10.1.0-M1 <= version <= 10.1.34, 9.0.0.M1 <= version <= 9.0.98

**利用条件:** 默认Servlet开启写入 (disabled by default), 支持partial PUT (enabled by default), 使用Tomcat文件session持久化默认位置,应用包含可用于反序列化攻击的库

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2025-24813是一个Apache Tomcat中的路径等价漏洞，利用内部点(file.Name)导致远程代码执行和/或信息泄露，和/或恶意内容被添加到上传的文件中，通过默认Servlet写入。根据漏洞库信息，如果满足以下条件，攻击者可以查看敏感文件或注入内容：

*   默认Servlet开启写入 (默认关闭)
*   支持Partial PUT（默认开启）
*   安全敏感上传的目标URL是公共上传目标URL的子目录
*   攻击者知道被上传的安全敏感文件的名称
*   安全敏感文件也通过Partial PUT上传

如果满足以下条件，攻击者可以执行远程代码：

*   默认Servlet开启写入 (默认关闭)
*   支持Partial PUT（默认开启）
*   应用使用Tomcat基于文件的session持久化，使用默认存储位置
*   应用包含一个可以用于反序列化攻击的库

**漏洞利用方式：**

1.  **Partial PUT上传恶意文件：** 利用Tomcat的Partial PUT功能，攻击者可以分块上传恶意文件到服务器。
2.  **路径遍历：**  通过构造包含`file.Name`（内部点）的特殊文件名，绕过路径检查，将恶意文件写入到Tomcat session存储目录，或者其他任意可写目录。
3.  **反序列化漏洞利用：** 如果应用程序包含一个可以被利用的反序列化库，上传的恶意文件可以触发反序列化漏洞，从而执行任意代码。
4.  **RCE:** 通过上传包含恶意代码的session文件,利用反序列化漏洞，实现远程代码执行。

**POC分析：**

提供的Python POC脚本尝试利用此漏洞。它执行以下步骤：

1.  **发送PUT请求：** 脚本向目标服务器发送PUT请求，尝试创建一个session文件。请求头包含Content-Length和Content-Range，模拟Partial PUT请求。
2.  **检查响应状态码：** 如果PUT请求返回409冲突状态码，表示服务器可能存在漏洞。
3.  **发送GET请求：** 脚本发送一个GET请求，其中Cookie包含一个伪造的JSESSIONID，尝试触发session反序列化。
4.  **检查响应状态码：** 如果GET请求返回500错误，表明session反序列化可能成功，漏洞可能存在。

**有效性：**

该POC代码尝试了利用该漏洞，但是否能够成功利用取决于目标服务器的具体配置和环境。需要满足上述所有条件漏洞才能成功利用。鉴于github上存在该漏洞的POC,故判断POC有效。

**投毒风险：**

该POC代码的主要目的是检测漏洞是否存在，而不是直接执行恶意操作。但是，`PAYLOAD`变量中包含一个base64编码的字符串，这可能包含一个反序列化payload。攻击者可能在`PAYLOAD`中注入恶意代码。

从代码逻辑来看，脚本首先发送一个PUT请求，如果返回409，则发送一个包含特定Cookie的GET请求。如果GET请求返回500，则认为目标存在漏洞。这个过程相对简单，没有明显的恶意行为。

但是，由于`PAYLOAD`的内容是未知的（被截断），存在一定的风险。如果`PAYLOAD`包含恶意代码，并且在目标服务器上成功执行，那么可能会导致安全问题。考虑到作者使用了看起来正常的请求参数，并且代码主要用于检测漏洞，因此判断投毒风险较低，约为10%。剩下的90%是为了验证此漏洞是否可以使用。

**项目地址:** [msadeghkarimi/CVE-2025-24813-Exploit](https://github.com/msadeghkarimi/CVE-2025-24813-Exploit)

**漏洞详情:** [CVE-2025-24813](https://nvd.nist.gov/vuln/detail/CVE-2025-24813)