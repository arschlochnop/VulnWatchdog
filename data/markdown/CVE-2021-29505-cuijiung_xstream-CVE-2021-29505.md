## CVE-2021-29505 - XStream Remote Command Execution

**漏洞编号:** CVE-2021-29505

**漏洞类型:** 远程命令执行 (RCE)

**影响应用:** XStream

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** < 1.4.17

**利用条件:** 需要能够向易受攻击的XStream服务发送恶意XML数据流

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

根据漏洞库信息和搜索结果，CVE-2021-29505 是 XStream < 1.4.17 版本中存在的一个反序列化漏洞，允许远程攻击者通过构造恶意的XML数据流执行任意命令。漏洞的根本原因是 XStream 在反序列化过程中未能充分限制可实例化的类，导致攻击者可以通过精心构造的 XML 数据来触发恶意代码的执行。

**1. 有效性：**

提供的 POC 代码似乎是有效的。它利用 `java.util.PriorityQueue` 和 `com.sun.xml.internal.ws.api.message.Packet` 等类的组合，通过 JNDI 注入来执行任意代码。POC 代码中包含恶意 XML 结构，展示了如何利用此漏洞。

**2. 投毒风险：**

该仓库存在一定的投毒风险，大约为 10%。虽然主要代码看起来是合法的漏洞利用，但不能完全排除作者在 README.md 文件或者其他位置添加恶意链接或者说明的可能性，诱导用户执行恶意操作。即使核心POC没有直接的恶意代码，但如果用户直接使用未经验证的第三方代码，仍存在潜在的安全风险。此外，该POC可能依赖特定的库版本(如commons-collections 3.1)，这些老版本本身可能存在其他安全漏洞。

**3. 利用方式：**

利用方式如下：

   1.  攻击者构造包含恶意代码的 XML 数据。
   2.  攻击者将恶意 XML 数据发送到使用存在漏洞的 XStream 版本的应用程序。
   3.  XStream 反序列化 XML 数据，执行其中的恶意代码，从而导致远程命令执行。

   该POC 使用了 JNDI 注入的方式。恶意 XML 导致应用程序尝试从攻击者控制的 JNDI 服务器检索对象。JNDI 服务器提供一个恶意对象，该对象在实例化时执行任意代码。

**项目地址:** [cuijiung/xstream-CVE-2021-29505](https://github.com/cuijiung/xstream-CVE-2021-29505)

**漏洞详情:** [CVE-2021-29505](https://nvd.nist.gov/vuln/detail/CVE-2021-29505)