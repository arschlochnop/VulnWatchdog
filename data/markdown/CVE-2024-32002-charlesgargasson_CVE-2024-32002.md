## CVE-2024-32002-Git-RCE

**漏洞编号:** CVE-2024-32002

**漏洞类型:** 远程代码执行

**影响应用:** Git

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 2.39.4之前, 2.40.0 ~ 2.40.2, 2.41.0, 2.42.0 ~ 2.42.2, 2.43.0 ~ 2.43.4, 2.44.0, 2.45.0

**利用条件:** 目标Git版本受影响，且启用了submodule和符号链接，在大小写不敏感的文件系统上。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-32002 是 Git 中存在的一个远程代码执行漏洞。该漏洞源于 Git 在处理包含 submodule 的仓库时，允许攻击者通过构造恶意的仓库，将文件写入 `.git/` 目录而不是 submodule 的工作目录中。 这样，攻击者就可以写入一个 hook 脚本，该脚本在克隆操作仍在运行时执行，从而实现远程代码执行。

**利用方式：**

1.  攻击者创建一个恶意 Git 仓库，其中包含一个 submodule，并在该 submodule 中包含一个恶意的 `.gitmodules` 文件和一个 hook 脚本 (例如 `post-checkout`)。
2.  恶意 `.gitmodules` 文件包含指向攻击者控制的另一个仓库的 URL。这个仓库包含恶意的 hook 脚本。
3.  当受害者使用 `git clone --recursive` 命令克隆包含恶意 submodule 的仓库时，Git 会递归地克隆 submodule。
4.  在克隆 submodule 的过程中，由于漏洞，恶意 hook 脚本会被写入到受害者的 `.git/` 目录中，而不是 submodule 的工作目录中。
5.  当 Git 执行 hook 脚本时，攻击者就可以在受害者的系统上执行任意代码。

**有效性：**

根据漏洞描述、搜索结果（特别是vicarius.io的分析文章）和提供的 POC 代码，该漏洞是有效的。POC 代码展示了如何创建恶意仓库，触发漏洞并执行任意命令。

**投毒风险：**

该 POC 代码的目的是演示漏洞利用，但仍然存在一定的投毒风险，约为 10%。这种风险主要来自于以下几个方面：

1.  **反弹shell的IP和端口：** POC 代码中嵌入了反弹 shell 的 IP 地址和端口。攻击者可能会修改这些值，将 shell 反弹到他们控制的服务器上。
2.  **后门代码：** 攻击者可能会在 hook 脚本中添加额外的后门代码，以便在受害者系统上植入持久性的恶意软件。
3.  **依赖库：** 攻击者可能会修改 POC 代码，使其依赖于恶意的第三方库，这些库可能包含恶意代码。

尽管存在这些风险，但该 POC 代码的主要目的是演示漏洞利用，而不是进行恶意攻击。 用户在使用时仍然需要谨慎，确保对代码进行适当的审查和修改，以避免潜在的风险。

**项目地址:** [charlesgargasson/CVE-2024-32002](https://github.com/charlesgargasson/CVE-2024-32002)

**漏洞详情:** [CVE-2024-32002](https://nvd.nist.gov/vuln/detail/CVE-2024-32002)