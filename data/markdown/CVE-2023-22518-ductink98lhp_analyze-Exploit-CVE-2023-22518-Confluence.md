## CVE-2023-22518 - Atlassian Confluence Improper Authorization

**漏洞编号:** CVE-2023-22518

**漏洞类型:** Improper Authorization

**影响应用:** Atlassian Confluence Data Center and Server

**危害等级:** Critical，完全控制 Confluence 实例，导致机密性、完整性和可用性完全丧失。

**影响版本:** All versions of Confluence Data Center and Server before fixes

**利用条件:** Confluence Server or Data Center is running and accessible over the network.

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-22518 是一个未经授权的漏洞，影响所有版本的 Atlassian Confluence Data Center 和 Server。攻击者可以利用此漏洞重置 Confluence 并创建一个 Confluence 实例管理员帐户。利用此帐户，攻击者可以执行 Confluence 实例管理员可用的所有管理操作，从而导致完全丧失机密性、完整性和可用性。

**漏洞利用方式：**

1.  **未授权访问：** 未经身份验证的攻击者可以访问特定的 Confluence 端点。
2.  **重置 Confluence：** 攻击者利用漏洞重置 Confluence，绕过身份验证机制。
3.  **创建管理员账户：** 攻击者创建一个新的 Confluence 实例管理员账户。
4.  **完全控制：** 使用新创建的管理员账户，攻击者获得对 Confluence 实例的完全控制。

**PoC代码分析和有效性：**

提供的 PoC 代码片段侧重于漏洞的调试和环境搭建，展示了如何设置 Confluence 环境（使用特定版本 8.0.4）、配置数据库以及如何通过 diff 两个版本的文件（8.0.4 和 7.19.16）来查找漏洞点。代码片段表明，漏洞存在于身份验证和授权绕过中，与 CVE 描述相符。

通过分析`struts.xml`文件，可以发现/json namespace增强了/admin namespace，导致可以未授权访问。

**投毒风险分析：**
虽然 PoC 代码片段主要用于环境搭建和调试，没有明显的恶意代码，但仍存在一定的投毒风险。原因如下：

*   **依赖第三方资源：** PoC 涉及下载 MySQL 驱动程序，如果驱动程序来源被篡改，可能包含恶意代码。
*   **配置更改：** PoC 建议修改 MySQL 配置文件，如果修改不当，可能导致数据库安全问题。
*   **环境搭建复杂：** 搭建漏洞环境本身比较复杂，如果攻击者提供修改后的环境镜像，可能包含预先植入的后门。

鉴于以上风险，认为此仓库中存在作者隐藏的投毒代码的可能性为10%。

**总结：**

CVE-2023-22518 是一个严重的安全漏洞，允许未经身份验证的攻击者完全控制 Confluence 实例。该漏洞利用相对简单，已经有公开的 PoC，并且已被用于 ransomware 攻击。虽然提供的 PoC 代码片段主要用于调试和环境搭建，没有明显的恶意代码，但仍需警惕潜在的投毒风险。

**项目地址:** [ductink98lhp/analyze-Exploit-CVE-2023-22518-Confluence](https://github.com/ductink98lhp/analyze-Exploit-CVE-2023-22518-Confluence)

**漏洞详情:** [CVE-2023-22518](https://nvd.nist.gov/vuln/detail/CVE-2023-22518)