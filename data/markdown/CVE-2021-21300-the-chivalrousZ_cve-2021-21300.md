## CVE-2021-21300-Git-远程代码执行

**漏洞编号:** CVE-2021-21300

**漏洞类型:** 远程代码执行

**影响应用:** Git

**危害等级:** 高危，可能导致远程代码执行和系统权限获取

**影响版本:** 受影响版本：>= 2.14.2, < 2.17.6，>= 2.18.0, < 2.18.5，>= 2.19.0, < 2.19.6，>= 2.20.0, < 2.20.5，>= 2.21.0, < 2.21.4，>= 2.22.0, < 2.22.5，>= 2.23.0, < 2.23.4，>= 2.24.0, < 2.24.4，>= 2.25.0, < 2.25.5，>= 2.26.0, < 2.26.3，>= 2.27.0, < 2.27.1，>= 2.28.0, < 2.28.1，>= 2.29.0, < 2.29.3，>= 2.30.0, < 2.30.1

**利用条件:** 目标系统需要使用受影响的Git版本，并且克隆包含恶意配置的仓库。需要开启core.symlinks (默认开启), 需要配置clean/smudge filter (如Git LFS)

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-21300是一个Git漏洞，允许恶意仓库在克隆时执行远程代码。该漏洞是由于Git在处理包含符号链接和clean/smudge过滤器（如Git LFS）的仓库时，在不区分大小写的文件系统（如NTFS、HFS+或APFS）上可能导致执行恶意脚本。 

**有效性：** 提供的POC代码有效。`post-checkout` 脚本包含 `echo PWNED >&2`，表明当执行 `git clone` 并检出仓库后，会输出 "PWNED" 到标准错误流，证明代码执行成功。

**投毒风险：**  

虽然POC代码本身只包含简单的代码执行验证，并没有明显的投毒行为。但恶意仓库的创建者完全可以在 `post-checkout` 脚本或者clean/smudge filter中嵌入更复杂的恶意代码，例如窃取用户凭据、安装后门等。因此，存在一定的投毒风险，风险程度为10%.

**利用方式：** 

1.  **创建恶意仓库：** 攻击者创建一个包含恶意配置的Git仓库，仓库中包含：
    *   符号链接
    *   `.gitattributes` 文件，配置 clean/smudge 过滤器（例如 Git LFS，Git for Windows 默认配置）
    *   `post-checkout` 钩子或其他能在克隆/检出过程中执行的脚本。
2.  **诱骗用户克隆仓库：** 攻击者诱骗目标用户克隆该恶意仓库。
3.  **代码执行：** 当用户克隆仓库并检出代码时，恶意 `post-checkout` 脚本被执行，导致远程代码执行。

**项目地址:** [the-chivalrousZ/cve-2021-21300](https://github.com/the-chivalrousZ/cve-2021-21300)

**漏洞详情:** [CVE-2021-21300](https://nvd.nist.gov/vuln/detail/CVE-2021-21300)