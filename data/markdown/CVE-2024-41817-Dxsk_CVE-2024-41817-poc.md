## CVE-2024-41817-ImageMagick-任意代码执行

**漏洞编号:** CVE-2024-41817

**漏洞类型:** 任意代码执行

**影响应用:** ImageMagick AppImage

**危害等级:** 高危，允许攻击者执行任意命令

**影响版本:** <= 7.1.1-35

**利用条件:** 需要目标系统安装了受影响版本的ImageMagick AppImage，且攻击者能够在目标系统上放置恶意文件或通过SSH进行操作

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-41817 漏洞存在于 ImageMagick 的 AppImage 版本中。该漏洞是由于 ImageMagick 在设置 `MAGICK_CONFIGURE_PATH` 和 `LD_LIBRARY_PATH` 环境变量时可能使用空路径，导致程序在执行时，会从当前工作目录加载恶意的配置文件或共享库，从而执行任意代码。 

**利用方式：**

1.  **构建恶意文件：** 攻击者需要构建恶意的 `delegates.xml` 文件或 `libxcb.so` 文件。`delegates.xml` 文件中包含要执行的恶意命令，而 `libxcb.so` 是一个共享库，其构造函数 `init()` 中包含要执行的命令。
2.  **放置恶意文件：** 攻击者需要将构建好的恶意文件放置到目标系统的当前工作目录中。这可以通过多种方式实现，例如，通过网络共享、上传或利用其他漏洞。
3.  **执行 ImageMagick：** 当 ImageMagick 执行时，它会从当前工作目录加载恶意的 `delegates.xml` 或 `libxcb.so` 文件，从而执行攻击者指定的任意命令。

**POC有效性：**

提供的 POC 代码看起来是有效的。它包含以下功能：

*   检测易受攻击的 ImageMagick 版本。
*   生成恶意 `delegates.xml` 文件或 `libxcb.so` 共享库。
*   自动部署和执行利用程序（需要 SSH 访问）。

**投毒风险：**

该 POC 代码的投毒风险较低，约为 10%。虽然代码的功能是利用漏洞执行任意命令，但未发现明显的恶意行为或后门代码。例如, 代码通过 `os.system()` 函数执行命令，这本身就存在风险，如果攻击者控制了命令的内容，可能会造成更大的危害。代码的意图是利用漏洞，但存在被滥用的风险，因此存在一定的投毒可能性。

需要注意的是，该工具的使用应仅限于授权的安全测试，禁止用于非法目的。

**项目地址:** [Dxsk/CVE-2024-41817-poc](https://github.com/Dxsk/CVE-2024-41817-poc)

**漏洞详情:** [CVE-2024-41817](https://nvd.nist.gov/vuln/detail/CVE-2024-41817)