## CVE-2021-42013 - Apache HTTP Server Path Traversal & Remote Code Execution

**漏洞编号:** CVE-2021-42013

**漏洞类型:** 路径遍历和远程代码执行

**影响应用:** Apache HTTP Server

**危害等级:** 高危，可能导致敏感信息泄露和远程代码执行

**影响版本:** 2.4.49, 2.4.50

**利用条件:** 需要目标服务器运行受影响的 Apache HTTP Server 版本，且配置允许 CGI 脚本执行，并存在Alias配置。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2021-42013 是 Apache HTTP Server 2.4.49 和 2.4.50 版本中存在的路径遍历和远程代码执行漏洞，是 CVE-2021-41773 的不完整修复。攻击者可以利用该漏洞，通过构造包含路径遍历的 URL，访问受限目录之外的文件。如果目标服务器配置了 CGI 脚本执行，则可能进一步实现远程代码执行。

**利用方式：**

1.  **路径遍历：** 攻击者通过构造恶意的 URL，利用 `Alias` 指令配置的路径，绕过访问控制，读取任意文件。
2.  **远程代码执行：** 如果服务器允许 CGI 脚本执行，攻击者可以上传恶意脚本，并利用路径遍历漏洞执行该脚本，从而获得服务器的控制权。

**POC分析：**

提供的 Dockerfile 用于搭建存在漏洞的 Apache HTTP Server 环境。`httpd.conf` 文件可能包含特定的 `Alias` 配置，以便漏洞利用。`cve-2021-42013.sh` 脚本模拟攻击过程，发送包含路径遍历的 HTTP 请求。

脚本的核心代码:
```bash
curl -s --path-as-is -d "echo Content-Type: text/plain; echo; $3" "$1/cgi-bin/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/$2"
```
其中, `$1`是目标IP地址, `$2`是要访问的文件路径，`$3`是要执行的命令。
`%%32%65` 是 `%2e` 的双重URL编码，即 `.`（点），用于绕过一些路径过滤机制。`--path-as-is` 参数避免 curl 对路径进行规范化，保持攻击 payload 的原样。
此脚本通过发送POST请求到/cgi-bin目录，利用路径穿越读取任意文件或者执行命令。

**投毒风险评估：**

Dockerfile 中虽然存在从 Apache 官网下载源码的操作，但仍存在一定风险，攻击者可能篡改 Dockerfile，例如，替换下载链接，指向包含恶意代码的 Apache HTTP Server 版本。但从文件内容上判断，直接投毒的可能性较低，更倾向于提供一个可利用的环境。

`cve-2021-42013.sh` 脚本本身相对简单，主要功能是发送 HTTP 请求，利用漏洞。该脚本也可能被修改，例如添加后门，但提供的脚本未发现明显的后门代码。 README.md 文件更多的是漏洞利用的指导说明。

综合评估，投毒风险较低，约为 5%。主要风险在于 Dockerfile 下载源的可靠性以及脚本是否被篡改。

**项目地址:** [asepsaepdin/CVE-2021-42013](https://github.com/asepsaepdin/CVE-2021-42013)

**漏洞详情:** [CVE-2021-42013](https://nvd.nist.gov/vuln/detail/CVE-2021-42013)