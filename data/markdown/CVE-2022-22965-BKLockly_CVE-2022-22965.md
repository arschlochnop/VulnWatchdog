## CVE-2022-22965-Spring4Shell-RCE

**漏洞编号:** CVE-2022-22965

**漏洞类型:** 远程代码执行（RCE）

**影响应用:** Spring Framework

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** Spring Framework versions 5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+ and all old and unsupported versions

**利用条件:** JDK 9+，运行在 Tomcat 作为 WAR 部署的 Spring MVC 或 Spring WebFlux 应用程序

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22965，又名Spring4Shell，是一个存在于Spring Framework中的远程代码执行漏洞。该漏洞允许攻击者通过数据绑定，在满足特定条件下（JDK 9+，Tomcat WAR部署），利用恶意请求执行任意代码。

**漏洞利用方式：**

1.  **目标确认：** 确认目标应用程序使用受影响的Spring Framework版本，并且满足漏洞利用的条件（JDK版本、部署方式）。
2.  **参数操纵：**  通过构造恶意的HTTP请求，操纵`class.module.classLoader.resources.context.parent.pipeline.first.pattern`等参数，修改Tomcat的日志配置，写入恶意Web Shell。
3.  **代码执行：** 访问恶意Web Shell，执行任意命令。

**POC有效性分析：**

提供的POC代码是一个Go程序，它包含了漏洞检测(POC)和利用(Exploit)功能。通过命令行参数，可以指定目标URL、要执行的命令、反弹shell的地址和端口等。从代码结构上看，POC程序会首先检测目标是否存在漏洞，如果存在则尝试进行利用，根据参数决定是否反弹shell。

**投毒风险分析：**

代码本身包含网络请求和命令执行功能，具有一定的风险。以下是一些潜在的投毒风险点：

*   **硬编码的恶意命令：** 虽然POC提供了`-c`参数指定命令，但作者可能在代码中隐藏了特定的恶意命令，在特定条件下执行。
*   **反弹shell的隐蔽后门：**  反弹shell功能本身就具有一定的风险，如果作者在反弹shell的代码中加入额外的逻辑，例如收集目标信息并回传，就构成了一个隐蔽的后门。
*   **依赖包风险：** 虽然`go.mod`和`go.sum`文件看起来正常，但仍然存在依赖包被篡改的风险，从而引入恶意代码。

基于以上分析，认为该POC代码存在**10%**的投毒风险。需要仔细审查代码，特别是网络请求、命令执行和反弹shell相关的部分，确保没有隐藏的恶意逻辑。同时也需要注意依赖包的安全性。

**其他说明:** 该POC代码的README描述了单个IP扫描和批量扫描的使用方法和效果。同时，提到第一次执行exp可能报错，但其实已经上传成功，需要等待一会。这表明该POC有一定的局限性，可能存在利用成功率不高的问题。

**项目地址:** [BKLockly/CVE-2022-22965](https://github.com/BKLockly/CVE-2022-22965)

**漏洞详情:** [CVE-2022-22965](https://nvd.nist.gov/vuln/detail/CVE-2022-22965)