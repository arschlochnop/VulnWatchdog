## CVE-2017-12617-Apache Tomcat-远程代码执行

**漏洞编号:** CVE-2017-12617

**漏洞类型:** 远程代码执行

**影响应用:** Apache Tomcat

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** 9.0.0.M1 to 9.0.0, 8.5.0 to 8.5.22, 8.0.0.RC1 to 8.0.46, 7.0.0 to 7.0.81

**利用条件:** HTTP PUT方法已启用 (readonly初始化参数设置为false)

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2017-12617 漏洞允许攻击者通过构造的HTTP PUT请求上传JSP文件到服务器，然后服务器将执行JSP文件中的任何代码，从而实现远程代码执行。

**有效性评估:**
根据漏洞库信息和搜索结果，该漏洞是真实存在的，并且有公开的PoC。提供的PoC代码利用了该漏洞，上传了一个名为hack.jsp的webshell。利用代码首先尝试建立到目标IP和端口的TCP连接。 成功建立连接后，它会发送一个HTTP PUT请求，将包含恶意Java代码的JSP文件上传到目标服务器。 然后，它尝试通过发送带有`cmd`参数的HTTP GET请求来执行该JSP文件，从而在服务器上执行任意命令。

**投毒风险评估:**
分析提供的PoC代码，主要功能是上传webshell和执行命令。投毒风险评估为10%。以下是原因：
*   该代码的功能相对明确，主要是为了利用CVE-2017-12617漏洞进行远程代码执行。
*   潜在的风险可能存在于webshell的功能上。例如，webshell可能包含后门，允许未经授权的访问。
*   `tchack.exe`是编译后的二进制文件，如果来源于不可信的仓库，存在被篡改的风险。

**利用方式:**
1.  **前提条件:** 目标Tomcat服务器运行在受影响的版本范围内，并且启用了HTTP PUT方法 (Default Servlet 的 `readonly` 参数设置为 `false`)。
2.  **上传JSP Webshell:**  攻击者使用PUT方法上传一个包含恶意代码的JSP文件，例如`hack.jsp`，到目标服务器。这个JSP文件包含可以执行系统命令的代码。
3.  **命令执行:**  攻击者通过构造一个包含命令的HTTP GET请求来访问上传的JSP文件。例如，`GET /hack.jsp?cmd=whoami HTTP/1.1`。Tomcat服务器执行JSP文件中的代码，并将命令的输出返回给攻击者。
4.  **远程控制:**  通过反复执行命令，攻击者可以实现对目标服务器的远程控制。

**项目地址:** [jptr218/tc_hack](https://github.com/jptr218/tc_hack)

**漏洞详情:** [CVE-2017-12617](https://nvd.nist.gov/vuln/detail/CVE-2017-12617)