## CVE-2018-15133-Laravel-反序列化漏洞

**漏洞编号:** CVE-2018-15133

**漏洞类型:** 反序列化漏洞

**影响应用:** Laravel Framework

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** <= 5.5.40, 5.6.x <= 5.6.29

**利用条件:** 需要知道 Laravel 应用的 application key

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2018-15133 是 Laravel 框架中的一个反序列化漏洞，存在于 5.5.40 及之前的版本，以及 5.6.x 系列的 5.6.29 及之前的版本。该漏洞源于对 X-XSRF-TOKEN 值的不可信反序列化调用，攻击者可以通过构造恶意的序列化数据，并将其作为 X-XSRF-TOKEN 的值发送到服务器，从而触发远程代码执行。

**漏洞利用方式：**

1.  攻击者需要获取 Laravel 应用的 application key。这通常是利用此漏洞最困难的部分。攻击者可能通过先前获取的权限或信息泄露来获得此密钥。
2.  攻击者使用 phpggc 等工具，基于 PendingBroadcast gadget chain 生成恶意的序列化 payload。
3.  攻击者使用 application key 对 payload 进行加密，并生成相应的 X-XSRF-TOKEN 值。
4.  攻击者将构造的 X-XSRF-TOKEN 值添加到 HTTP 请求头中，并发送到目标 Laravel 应用。
5.  服务器在处理请求时，会尝试解密并反序列化 X-XSRF-TOKEN 值，从而触发 payload 中的恶意代码，最终实现远程代码执行。

**有效性：**

根据漏洞信息、搜索结果和提供的 POC 代码，可以判断该漏洞利用是有效的。搜索结果中提供了多个关于此漏洞的描述和利用的链接，包括 NVD、CISA 的已知被利用漏洞目录以及 GitHub 上的 POC 代码仓库。

提供的 POC 代码 (main.cpp) 看起来是一个 C++ 编写的漏洞利用程序，它实现了以下功能：

*   接受 URL、命令和 application key 作为参数。
*   生成恶意的 X-XSRF-TOKEN 值。
*   发送带有构造的 X-XSRF-TOKEN 值的 HTTP 请求到目标 URL。

该 POC 代码使用了 OpenSSL 库进行 AES 加密和 HMAC 计算，并且使用了 Base64 编码。  代码逻辑与漏洞描述一致，即利用已知的 application key，构造恶意payload，经过加密、编码后，作为 X-XSRF-TOKEN 发送，从而触发反序列化漏洞。

**投毒风险：**

该 POC 代码主要由 `main.cpp` 和 `build.sh` 构成。`build.sh` 负责编译 `main.cpp`。`main.cpp` 代码量相对较大，人工review 存在疏漏的可能。以下是我对投毒风险的分析：

*   **正面因素：** 代码逻辑主要集中在实现漏洞利用上，包括参数解析、payload 生成、加密、编码、HTTP 请求发送等。没有发现明显的恶意代码或后门。
*   **负面因素：**  代码使用了第三方库 OpenSSL，并且包含一些字符串处理和内存管理操作，这些地方可能存在安全漏洞。例如，如果代码没有正确处理字符串长度，可能会导致缓冲区溢出。
*   **潜在风险：** 攻击者可能通过修改 `build.sh` 添加额外的编译选项，例如链接恶意库，从而植入后门。但是，提供的 `build.sh` 文件比较简单，只包含编译命令，没有发现任何可疑操作。

综合来看，该仓库中存在作者隐藏的投毒代码的可能性较低，大概在5%左右。主要风险在于代码中可能存在的潜在安全漏洞，以及编译过程中可能被利用的风险。

**项目地址:** [NatteeSetobol/CVE-2018-15133-Lavel-Expliot](https://github.com/NatteeSetobol/CVE-2018-15133-Lavel-Expliot)

**漏洞详情:** [CVE-2018-15133](https://nvd.nist.gov/vuln/detail/CVE-2018-15133)