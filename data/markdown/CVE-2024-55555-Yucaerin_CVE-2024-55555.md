## CVE-2024-55555-InvoiceNinja-RCE

**漏洞编号:** CVE-2024-55555

**漏洞类型:** 远程代码执行

**影响应用:** InvoiceNinja

**危害等级:** 高危，可能导致完全控制服务器

**影响版本:** < 5.10.43

**利用条件:** 需要目标服务器运行InvoiceNinja，且攻击者已知APP_KEY或能够通过爆破获取

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-55555 存在于 Invoice Ninja 5.10.43 之前的版本中。当攻击者已知 APP_KEY 时，可以通过预认证路由实现远程代码执行。

**有效性评估：**

*   根据漏洞描述，利用需要知道 APP_KEY。提供的漏洞利用代码尝试通过爆破 Laravel 加密的 cookie 来获取 APP_KEY。如果成功，攻击者可以利用 Laravel 的反序列化漏洞链来执行任意代码。因此，PoC 在特定条件下有效。

**投毒风险评估：**

*   代码主要功能是爆破APP_KEY。风险点主要存在于以下几个方面：
    *   **依赖性风险：** 脚本依赖于 `laravel-crypto-killer` 库，如果该库被篡改，可能引入恶意代码。但脚本本身只是调用该库，风险相对较低。
    *   **网络请求：** 脚本会发送 HTTP 请求到目标站点，可能存在被中间人攻击的风险。
    *   **subprocess调用：** 通过subprocess调用第三方工具，如果攻击者替换laravel_crypto_killer.py文件，存在执行恶意命令的风险
    *   **结果处理：** 结果保存到文件中，如果文件路径被篡改，可能导致信息泄露或文件覆盖。

**利用方式：**

1.  **目标确定：** 攻击者需要确定运行 Invoice Ninja 的目标服务器。
2.  **APP_KEY 获取：**
    *   如果服务器使用默认的 APP_KEY，攻击者可以直接使用。
    *   如果 APP_KEY 不是默认的，攻击者可以使用提供的 PoC 代码，通过爆破 Laravel 加密的 cookie 来尝试获取 APP_KEY。这依赖于 `laravel-crypto-killer` 工具。
3.  **RCE 触发：**
    *   一旦获得 APP_KEY，攻击者可以构造恶意的序列化数据，使用 APP_KEY 对其进行加密，然后将其作为 `{hash}` 参数传递给 `/route/{hash}` 路由。
    *   服务器将解密该数据并对其进行反序列化，从而触发远程代码执行。

**搜索引擎结果分析：**

*   搜索结果证实了漏洞的存在，以及需要 APP_KEY 才能利用该漏洞。
*   某些搜索结果提到了默认 APP_KEY 的风险。
*   `blog.gitguardian.com` 的文章可能提供了关于利用 APP_KEY 泄漏的更多信息。

**项目地址:** [Yucaerin/CVE-2024-55555](https://github.com/Yucaerin/CVE-2024-55555)

**漏洞详情:** [CVE-2024-55555](https://nvd.nist.gov/vuln/detail/CVE-2024-55555)