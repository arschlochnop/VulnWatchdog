## CVE-2021-31630-OpenPLC Webserver v3-命令注入

**漏洞编号:** CVE-2021-31630

**漏洞类型:** 命令注入

**影响应用:** OpenPLC Webserver

**危害等级:** 高危，允许远程攻击者执行任意代码

**影响版本:** v3

**利用条件:** 需要身份验证，且目标服务器上的OpenPLC Webserver v3运行在可访问的网络上

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-31630是OpenPLC Webserver v3中的一个命令注入漏洞。攻击者可以通过 "Hardware Layer Code Box" 组件，在 `/hardware` 页面上，执行任意代码。该漏洞利用方式如下：

1.  **目标探测：**  首先需要确定目标OpenPLC Webserver v3服务器是否可达。
2.  **身份验证：**  使用默认凭据（openplc/openplc）或已知的有效凭据登录到OpenPLC Webserver。
3.  **Payload构建：**  利用代码构建一个包含反向shell的恶意C代码，该代码会被注入到“Hardware Layer Code Box”。反向shell连接到攻击者的机器。
4.  **Payload上传：**  将构建的payload上传到 `/hardware` 页面，覆盖 custom layer code.
5.  **程序编译：**  访问 `/compile-program?file=blank_program.st` 触发程序编译。
6.  **启动PLC：**  访问 `/start_plc` 以启动PLC，这将触发payload的执行，从而建立反向shell。
7.  **清理（可选）：**  为了避免留下痕迹，可以停止PLC并恢复自定义硬件。

**有效性评估：**

根据漏洞库信息、搜索引擎结果和提供的漏洞利用代码，此漏洞利用POC代码的有效性高。漏洞库信息和搜索结果都确认了该漏洞的存在，并指出攻击者可以通过特定的页面和组件执行任意代码。提供的Python POC代码实现了完整的攻击流程，包括身份验证、payload构建、上传、编译和PLC启动，从而获得反向shell。

**投毒风险分析：**

提供的POC代码的主要功能是利用命令注入漏洞，在目标系统上执行任意代码，从而获取反向shell。代码中构建了一个C语言payload，该payload的功能是创建一个反向shell连接到攻击者指定的IP地址和端口。审查代码并没有发现作者隐藏的恶意代码或者后门，例如删除文件、篡改系统配置或者进行其他未经授权的操作。因此，可以认为此仓库中不存在作者隐藏的投毒代码, 风险为0%。

**项目地址:** [machevalia/OpenPLC-CVE-2021-31630-RCE](https://github.com/machevalia/OpenPLC-CVE-2021-31630-RCE)

**漏洞详情:** [CVE-2021-31630](https://nvd.nist.gov/vuln/detail/CVE-2021-31630)