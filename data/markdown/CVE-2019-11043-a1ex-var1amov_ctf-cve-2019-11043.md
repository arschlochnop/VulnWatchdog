## CVE-2019-11043-PHP-FPM远程代码执行

**漏洞编号:** CVE-2019-11043

**漏洞类型:** 远程代码执行

**影响应用:** PHP-FPM

**危害等级:** 高危，可导致远程代码执行

**影响版本:** PHP 7.1.x (< 7.1.33), 7.2.x (< 7.2.24), 7.3.x (< 7.3.11)

**利用条件:** Nginx + PHP-FPM，fastcgi_split_path_info配置，未做文件存在性检查 (try_files)

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2019-11043 是一个 PHP-FPM 远程代码执行漏洞，影响使用 Nginx 和 PHP-FPM 的特定配置。漏洞源于 PHP-FPM 在处理 PATH_INFO 时的缓冲区下溢，攻击者可以通过特制的 URL 导致 FPM 模块将数据写入超出已分配缓冲区的空间，从而覆盖 FCGI 协议数据，最终导致远程代码执行。

**有效性:**

提供的 Dockerfile 和相关文件构成了一个可复现漏洞的实验环境。Dockerfile 明确配置了 vulnerable 的 Nginx 和 PHP-FPM 环境，包括指定版本的 Ubuntu、PHP 以及必要的配置，例如 `fastcgi_split_path_info`。`nginx.conf` 文件中注释掉的 `try_files` 检查是触发漏洞的关键。因此，提供的 PoC 代码是有效的，可以用于复现和利用该漏洞。

**投毒风险:**

评估投毒风险较低，约为 5%。理由如下：

*   **Dockerfile 内容明确:** Dockerfile 的指令清晰，主要用于构建漏洞环境，没有发现恶意代码或后门。使用了 `old-releases.ubuntu.com` 仅为了保证指定PHP版本安装。
*   **Nginx 配置简单:** `nginx.conf` 文件的配置主要用于暴露漏洞点，没有发现隐藏的恶意配置。
*   **应用代码量少:** 提供的`app/`和`public/`目录中的代码主要是演示用的task management app，代码量少，易于审计，没有发现可疑代码。`auth.php` 甚至是不完整的。
*   **`README.md`:** 提供了漏洞利用的快速上手方式，鼓励用户使用 `phuip-fpizdam` 工具，并未诱导用户执行任何恶意操作。

虽然整体风险较低，但是仍需谨慎。理论上作者可能在`app/`或者`public/`目录下的应用代码中插入后门，但需要进一步审计代码才能确认，从整体代码结构看，这种可能性较小。因此，将投毒风险评估为5%。

**利用方式:**

1.  **环境搭建:** 使用提供的 Dockerfile 构建包含漏洞的 Nginx + PHP-FPM 环境。
2.  **触发漏洞:** 通过构造特殊的 URL（通常包含 `%00` 或其他特殊字符）发送到目标服务器。这个 URL 的目的是触发 PHP-FPM 在处理 `PATH_INFO` 时的缓冲区下溢。
3.  **代码执行:** 如果漏洞成功触发，攻击者可以利用缓冲区溢出覆盖 FCGI 协议数据，从而修改 PHP-FPM 的行为，并最终执行任意代码。
4.  **利用工具:** 可以使用 `phuip-fpizdam` 工具自动化检测和利用该漏洞。该工具可以自动检测目标服务器的配置参数，并生成相应的 Payload，从而简化漏洞利用过程。

**重要提示:**

*   此漏洞利用需要在特定 Nginx + PHP-FPM 配置下才能成功。
*   务必在受控环境中进行测试，切勿在生产环境中进行未授权的漏洞利用。

**项目地址:** [a1ex-var1amov/ctf-cve-2019-11043](https://github.com/a1ex-var1amov/ctf-cve-2019-11043)

**漏洞详情:** [CVE-2019-11043](https://nvd.nist.gov/vuln/detail/CVE-2019-11043)