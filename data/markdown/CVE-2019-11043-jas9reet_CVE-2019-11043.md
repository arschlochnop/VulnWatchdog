## CVE-2019-11043-PHP-FPM远程代码执行

**漏洞编号:** CVE-2019-11043

**漏洞类型:** 远程代码执行

**影响应用:** PHP-FPM

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** 7.1.x < 7.1.33, 7.2.x < 7.2.24, 7.3.x < 7.3.11

**利用条件:** Nginx + PHP-FPM，特定配置。 主要是nginx没有校验文件是否存在就传递给了php-fpm处理。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2019-11043 是一个 PHP-FPM 的远程代码执行漏洞，存在于特定配置下的 Nginx + PHP-FPM 环境中。漏洞原因是 PHP-FPM 在处理 PATH_INFO 时存在缺陷，导致可以覆盖FCGI协议的数据，利用方法如下：

1.  **漏洞原理：** PHP-FPM 在处理 `PATH_INFO` 时，如果 Nginx 配置不当，会将 URL 中多余的部分作为 `PATH_INFO` 传递给 PHP-FPM。攻击者可以构造恶意的 `PATH_INFO`，触发 PHP-FPM 的缓冲区下溢漏洞，覆盖 FCGI 协议的数据，最终导致远程代码执行。

2.  **漏洞影响：**  受影响的版本包括 PHP 7.1.x (低于 7.1.33), 7.2.x (低于 7.2.24), 和 7.3.x (低于 7.3.11)。该漏洞需要特定的 Nginx + PHP-FPM 配置才能触发，即 Nginx 没有对请求的文件进行严格的校验，直接将请求传递给 PHP-FPM 处理。

3.  **漏洞利用：**
    a.  **环境搭建：** 使用 `docker-compose.yml` 文件搭建漏洞环境，其中包括 Nginx 和 PHP-FPM。
    b.  **漏洞验证：** 使用 `CVE-2019-11043-Checker.py` 脚本验证目标是否存在漏洞。该脚本通过发送带有特殊构造的 `PATH_INFO` 的 HTTP 请求，检测服务器是否返回 502 错误。如果返回 502 错误，则可能存在漏洞。
    c.  **漏洞利用：** 实际利用需要进一步构造特定的 payload 以实现远程代码执行，这部分代码未包含在提供的文件中，但可以参考 `https://github.com/neex/phuip-fpizdam`。

4.  **投毒风险分析：**
    a.  `README.md`、`default.conf`、`docker-compose.yml`、`www/index.php` 这些文件主要是环境搭建和简单的页面展示，没有发现恶意代码。
    b.  `exploit/CVE-2019-11043-Checker.py` 脚本的功能是检测漏洞是否存在，没有发现后门或者恶意代码，但是存在被滥用的风险，被攻击者用以探测内网。
    c.  综合来看，该仓库的投毒风险较低，脚本本身只是漏洞检测工具，但是从长远来看，存在被攻击者利用的风险。

5.  **结论：**  提供的 POC 代码可以有效检测漏洞是否存在。投毒风险较低，脚本本身不包含恶意代码，但存在被滥用的可能性。利用方式为构造恶意的 PATH_INFO，触发 PHP-FPM 的缓冲区下溢漏洞，实现远程代码执行。

**项目地址:** [jas9reet/CVE-2019-11043](https://github.com/jas9reet/CVE-2019-11043)

**漏洞详情:** [CVE-2019-11043](https://nvd.nist.gov/vuln/detail/CVE-2019-11043)