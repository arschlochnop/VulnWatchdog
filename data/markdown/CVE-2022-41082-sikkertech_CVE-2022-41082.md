## CVE-2022-41082 - Microsoft Exchange Server 远程代码执行漏洞

**漏洞编号:** CVE-2022-41082

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Microsoft Exchange Server

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** 受影响版本：Exchange Server 2013 Cumulative Update 23, Exchange Server 2016 Cumulative Update 22 & 23, Exchange Server 2019 Cumulative Update 11 & 12。 详见漏洞库信息。

**利用条件:** 需要经过身份验证（但结合CVE-2022-41040可以绕过身份验证）。 需要能够访问Exchange PowerShell。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-41082 是 Microsoft Exchange Server 中的一个远程代码执行漏洞。根据搜索结果和漏洞库信息，该漏洞与 CVE-2022-41040（服务器端请求伪造，SSRF）一起被利用，被称为 'ProxyNotShell'。攻击者首先利用 CVE-2022-41040 绕过身份验证，然后利用 CVE-2022-41082 执行任意代码。漏洞利用代码通过构造特定的 URL，如 `autodiscover/autodiscover.json@Powershell.<random>.com/owa/`，来触发漏洞。该代码尝试访问该路径，并根据服务器的响应（例如，401 Unauthorized 并且包含 X-OWA-Version 头部）来判断目标是否易受攻击。由于代码中并没有发现恶意操作，例如执行恶意命令或上传后门，因此投毒风险较低，评估为0%。

**利用方式：**
1.  **SSRF (CVE-2022-41040)：** 攻击者利用SSRF漏洞绕过身份验证，向Exchange服务器发送伪造的请求。
2.  **RCE (CVE-2022-41082)：** 在绕过身份验证后，攻击者构造特定的请求，触发Exchange PowerShell，从而执行任意代码。这通常涉及在请求中包含恶意的PowerShell命令。

**POC代码有效性评估：**
POC代码尝试通过访问特定URL并检查响应头来确定是否存在漏洞。如果服务器返回401 Unauthorized 并且包含 `X-OWA-Version` 头部，则认为目标易受攻击。这个POC代码的逻辑是合理的，可以作为漏洞检测的一种方法。但是，实际的RCE利用需要更复杂的步骤，例如上传和执行webshell。该POC仅用于检测，不包含完整的RCE利用。

**项目地址:** [sikkertech/CVE-2022-41082](https://github.com/sikkertech/CVE-2022-41082)

**漏洞详情:** [CVE-2022-41082](https://nvd.nist.gov/vuln/detail/CVE-2022-41082)