## CVE-2024-21893 - Ivanti Connect Secure/Policy Secure SSRF

**漏洞编号:** CVE-2024-21893

**漏洞类型:** 服务器端请求伪造 (SSRF)

**影响应用:** Ivanti Connect Secure / Ivanti Policy Secure

**危害等级:** 高危，允许未授权的攻击者访问受限资源，可能导致信息泄露和RCE

**影响版本:** Ivanti Connect Secure (9.x, 22.x) 和 Ivanti Policy Secure (9.x, 22.x)

**利用条件:** 目标系统存在漏洞版本的 Ivanti Connect Secure 或 Ivanti Policy Secure，且网络可达。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-21893 是 Ivanti Connect Secure 和 Policy Secure 产品 SAML 组件中的一个服务器端请求伪造 (SSRF) 漏洞。未经身份验证的攻击者可以利用此漏洞访问受限资源。

**有效性:**

根据漏洞库信息、搜索引擎结果和提供的漏洞利用代码，该漏洞被广泛认为有效，并且已被积极利用。

*   **漏洞库信息：** CVE描述中说明了漏洞的存在，以及受影响的版本。
*   **搜索引擎结果：** 大量安全厂商和研究人员确认了该漏洞的存在，并发布了相关的分析报告和利用案例。CISA已将其添加到已知被利用的漏洞目录中。
*   **漏洞利用代码：** 提供了可用于检测和利用该漏洞的 Nuclei 模板 (YAML 文件) 和 Python 脚本。

**投毒风险:**

分析提供的POC代码，投毒风险较低，但不能完全排除。分析如下：

*   **Nuclei 模板:** 这两个YAML文件（`CVE-2024-21893.yaml` 和 `CVE-2024-21893-CVE-2024-21887.yaml`） 主要用于检测漏洞的存在。它们通过构造包含指向 `interactsh-url` 的 `RetrievalMethod URI` 的 SOAP 请求，来验证目标系统是否存在 SSRF 漏洞。  `interactsh-url` 是一个外部域名，用于验证是否存在 SSRF。正常的利用方式应该是指向攻击者控制的服务器，通过DNS请求验证SSRF的存在。如果作者故意使用一个恶意域名，则可能存在轻微的投毒风险，但这风险较低，因为使用者可以自行修改域名。
*   **README.md：**  README.md 文件描述了如何使用漏洞利用脚本，包括安装依赖和运行脚本的命令。该文件本身没有发现恶意代码。
*   ** exploit.py:** 脚本文件未提供，无法进行分析。

总体而言，提供的Nuclei模板风险较小，主要用于检测。`README.md` 没有风险。由于缺少 `exploit.py` 脚本，无法评估其风险。 建议使用者在使用任何漏洞利用代码之前，进行代码审计，以确保其安全性。

**利用方式:**

该漏洞是一个 SSRF 漏洞，攻击者可以通过构造恶意的 SAML 请求，强制服务器向攻击者控制的外部服务器发起请求。

1.  **构造恶意 SOAP 请求：** 攻击者构造一个包含恶意 `RetrievalMethod URI` 的 SOAP 请求。`RetrievalMethod URI` 指向攻击者控制的服务器。
2.  **发送恶意请求：**  攻击者将构造的 SOAP 请求发送到 `/dana-ws/saml20.ws` 接口。
3.  **SSRF 触发：**  Ivanti Connect Secure/Policy Secure 的 SAML 组件会解析该请求，并尝试从 `RetrievalMethod URI` 指定的地址获取数据，从而触发 SSRF。
4.  **利用 SSRF：**  攻击者可以利用 SSRF 读取内部服务信息、执行命令，或者结合其他漏洞（如 CVE-2024-21887 命令注入漏洞）来实现远程代码执行。

**项目地址:** [Chocapikk/CVE-2024-21893-to-CVE-2024-21887](https://github.com/Chocapikk/CVE-2024-21893-to-CVE-2024-21887)

**漏洞详情:** [CVE-2024-21893](https://nvd.nist.gov/vuln/detail/CVE-2024-21893)