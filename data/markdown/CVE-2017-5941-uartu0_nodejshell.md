## CVE-2017-5941-node-serialize-远程代码执行

**漏洞编号:** CVE-2017-5941

**漏洞类型:** 反序列化漏洞

**影响应用:** node-serialize

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 0.0.4

**利用条件:** 目标应用使用了存在漏洞的node-serialize模块，并且允许用户可控的数据传递给unserialize函数。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2017-5941是node-serialize 0.0.4版本中的一个反序列化漏洞。攻击者可以将包含恶意JavaScript代码（例如，利用立即执行函数表达式（IIFE））的不可信数据传递给`unserialize()`函数，从而实现远程代码执行(RCE)。

**有效性分析：**
提供的Python脚本`nodejshell.py`旨在利用此漏洞。它通过构造包含反向shell payload的序列化数据，并将其作为cookie或POST参数发送到目标服务器。如果目标服务器使用`node-serialize`的`unserialize()`函数处理这些数据，恶意代码将被执行，从而在攻击者控制的机器上建立反向shell。

**投毒风险分析：**
代码检查显示，提供的Python脚本的主要功能是生成和发送恶意payload，目的是利用目标系统上的反序列化漏洞。该脚本本身并没有明显的植入后门、窃取信息或进行恶意传播的行为。脚本中唯一的网络行为是向目标URL发送HTTP请求，这是利用漏洞所必需的。`poison`的概率很低，因为代码的功能比较直接，主要就是利用漏洞进行反向shell连接。`node_shell`变量中的反向shell代码段是漏洞利用的核心，虽然是恶意目的，但属于payload范畴，不应被视为投毒代码。

**漏洞利用方式：**
1.  **构造Payload：** 脚本生成包含反向shell命令的JavaScript代码。该代码被转换为decimal表示，然后嵌入到IIFE中，并使用`node-serialize`进行序列化，然后进行base64编码。
2.  **发送Payload：** 脚本通过HTTP POST请求将payload作为参数发送到目标URL，或者将其设置到cookie中。
3.  **触发反序列化：** 目标服务器接收到请求后，使用`node-serialize`的`unserialize()`函数反序列化数据。
4.  **执行代码：** 由于payload中包含恶意JavaScript代码，反序列化过程会导致代码执行，从而建立从目标服务器到攻击者机器的反向shell连接。
5.  **建立连接:** 攻击者需要监听设定的端口以接受反向shell的连接。

**项目地址:** [uartu0/nodejshell](https://github.com/uartu0/nodejshell)

**漏洞详情:** [CVE-2017-5941](https://nvd.nist.gov/vuln/detail/CVE-2017-5941)