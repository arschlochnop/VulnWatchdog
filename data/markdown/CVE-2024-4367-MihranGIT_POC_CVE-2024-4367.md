## CVE-2024-4367 - Firefox/Thunderbird PDF.js 任意JavaScript执行

**漏洞编号:** CVE-2024-4367

**漏洞类型:** 任意JavaScript执行

**影响应用:** Firefox, Firefox ESR, Thunderbird

**危害等级:** 中危，可能导致跨站脚本攻击(XSS)和敏感信息泄露

**影响版本:** < Firefox 126, < Firefox ESR 115.11, < Thunderbird 115.11

**利用条件:** 用户打开恶意PDF文件，并且PDF.js配置中`isEvalSupported`设置为`true` (默认值)

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-4367 是 Mozilla Firefox、Firefox ESR 和 Thunderbird 中 PDF.js 组件的一个漏洞，它允许攻击者在 PDF.js 上下文中执行任意 JavaScript 代码。该漏洞是由于在处理字体时缺少类型检查导致的。

**有效性：**

提供的 POC 代码看起来有效。它包含一个特制的 PDF 文件，该文件定义了一个自定义字体（对象 5 0 obj），该字体的 `FontMatrix` 属性包含 JavaScript 代码：`/FontMatrix [0.1 0 0 0.1 0 (1\); alert\('document.location'\)]`。当呈现此 PDF 文件时，如果 PDF.js 没有正确执行类型检查，就会执行 `alert('document.location')`。

**投毒风险：**

经过分析，提供的POC代码中**没有**发现明显的投毒代码。`alert('document.location')` 仅仅是一个弹窗，用于验证XSS是否执行. 

投毒风险评估：0%

**利用方式：**

1.  **创建恶意 PDF 文件：** 攻击者会创建一个包含恶意 JavaScript 代码的特制 PDF 文件。在这个例子中，JavaScript 代码嵌入在字体对象的 `FontMatrix` 属性中。
2.  **诱导用户打开 PDF 文件：** 攻击者需要诱导目标用户使用受影响版本的 Firefox、Firefox ESR 或 Thunderbird 打开这个恶意 PDF 文件。这可以通过网络钓鱼攻击、恶意网站或将 PDF 文件嵌入到电子邮件中来实现。
3.  **JavaScript 代码执行：** 当用户打开 PDF 文件时，PDF.js 会尝试解析和呈现 PDF 内容。由于缺少类型检查，字体对象的 `FontMatrix` 属性中的 JavaScript 代码将被执行。如果成功 `alert('document.location')` 会触发。
4.  **潜在影响：** 成功利用此漏洞可能导致以下后果：
    *   **跨站脚本攻击 (XSS)：** 攻击者可以在用户的浏览器中执行恶意 JavaScript 代码，从而窃取敏感信息（如 Cookie、会话令牌）、篡改网页内容或重定向用户到恶意网站。
    *   **信息泄露：** 攻击者可以访问用户的本地文件系统或网络资源，从而泄露敏感信息。

**缓解措施：**

*   **升级到最新版本：** 将 Firefox、Firefox ESR 和 Thunderbird 升级到已修复此漏洞的版本 (>= Firefox 126, >= Firefox ESR 115.11, >= Thunderbird 115.11)。
*   **谨慎打开 PDF 文件：** 避免打开来自不可信来源的 PDF 文件。
*   **配置 PDF.js：** 如果不需要 JavaScript 支持，可以禁用 PDF.js 的 JavaScript 执行功能 (将 `isEvalSupported` 设置为 `false`)。

综上所述，该漏洞的利用方式相对简单，攻击者可以通过构造恶意 PDF 文件并诱导用户打开来执行任意 JavaScript 代码。虽然CVSS评分不高，但由于firefox,thunderbird用户的广泛性，其造成的危害不可忽视

**项目地址:** [MihranGIT/POC_CVE-2024-4367](https://github.com/MihranGIT/POC_CVE-2024-4367)

**漏洞详情:** [CVE-2024-4367](https://nvd.nist.gov/vuln/detail/CVE-2024-4367)