## CVE-2023-38646-Metabase-RCE

**漏洞编号:** CVE-2023-38646

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Metabase

**危害等级:** 高危，允许未经身份验证的攻击者在服务器上执行任意命令

**影响版本:** < 0.46.6.1 (开源版) 和 < 1.46.6.1 (企业版)

**利用条件:** 目标Metabase实例版本低于受影响版本，且可以通过HTTP/HTTPS访问。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-38646是Metabase中的一个远程代码执行漏洞。根据漏洞库信息和搜索引擎结果，未经身份验证的攻击者可以利用此漏洞在服务器上执行任意命令。漏洞利用代码`CVE-2023-38646-POC.py`和`CVE-2023-38646-Reverse-Shell.py`提供了两种利用方式：

1.  **漏洞利用方式：**
    *   **获取Setup Token：** 首先，`CVE-2023-38646-POC.py` 脚本通过访问`/api/session/properties`端点来获取Metabase实例的Setup Token。该Token在初始化设置阶段使用，是后续利用的关键。
    *   **Reverse Shell利用：** `CVE-2023-38646-Reverse-Shell.py` 脚本利用获取的Setup Token，通过向`/api/setup/validate`端点发送POST请求，并构造恶意的H2数据库连接字符串，将Payload注入到数据库配置中。该Payload会执行一个反向Shell命令，连接到攻击者指定的IP地址和端口，从而实现远程代码执行。

2.  **有效性：**
    根据漏洞信息、搜索结果和提供的POC代码，可以判断此POC**有效**。多个来源证实了该漏洞的存在和可利用性，并且提供了可操作的POC。

3.  **投毒风险：**
    代码中发现的潜在投毒风险较低，约为10%。主要分析如下：
    *   `CVE-2023-38646-POC.py` 主要用于获取Setup Token，功能比较简单，没有明显的恶意行为。
    *   `CVE-2023-38646-Reverse-Shell.py` 的主要功能是利用Setup Token执行RCE，但是攻击者可以自定义反向连接的IP和端口，因此代码本身只是提供了一个框架。风险点在于如果攻击者不小心使用了错误的payload，可能导致目标系统崩溃或其他异常。

   总体来说，风险主要集中在payload的构建和执行上，而非代码本身存在恶意注入。但依旧需要对下载的脚本进行全面的代码审计。


**项目地址:** [asepsaepdin/CVE-2023-38646](https://github.com/asepsaepdin/CVE-2023-38646)

**漏洞详情:** [CVE-2023-38646](https://nvd.nist.gov/vuln/detail/CVE-2023-38646)