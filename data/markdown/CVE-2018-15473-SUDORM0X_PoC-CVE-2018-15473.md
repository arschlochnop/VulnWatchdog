## CVE-2018-15473 - OpenSSH 用户枚举

**漏洞编号:** CVE-2018-15473

**漏洞类型:** 用户枚举

**影响应用:** OpenSSH

**危害等级:** 中危，可能为后续攻击提供信息

**影响版本:** <= 7.7

**利用条件:** 需要目标主机开启SSH服务，且漏洞未被修复

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2018-15473 漏洞允许未经授权的远程攻击者通过探测OpenSSH服务器来枚举有效的用户名。此漏洞源于OpenSSH在处理无效用户的身份验证请求时，没有延迟到数据包完全解析完毕才进行处理。攻击者可以发送畸形的公钥身份验证请求。如果用户名无效，服务器会立即返回失败信息；如果用户名有效，服务器在解析畸形数据包时会崩溃或关闭连接，从而通过响应时间的差异或连接状态来区分有效和无效用户。提供的PoC代码 `PoC_CVE-2018-15473.py` 利用了这一漏洞。它通过尝试使用无效的公钥对用户进行身份验证，并根据服务器的响应来判断用户是否存在。该PoC代码支持单个用户名验证和使用用户名列表进行批量验证。 代码中没有发现明显的投毒代码，主要就是连接SSH服务进行用户名爆破，可以初步判定投毒风险为0。

**利用方式：**
1. 运行PoC脚本，指定目标主机、端口（默认为22）和要枚举的用户名或用户名列表。
2. 脚本会尝试使用指定的用户名进行公钥身份验证，但提供的公钥为空字节 `b''`，因此必然失败。
3. 如果服务器返回“Invalid key”的错误信息，则表示该用户名无效。
4. 如果服务器返回“Authentication failed”的错误信息，则表示该用户名有效。
5. 对于用户名列表，脚本会使用多进程并发进行枚举，提高效率。

**项目地址:** [SUDORM0X/PoC-CVE-2018-15473](https://github.com/SUDORM0X/PoC-CVE-2018-15473)

**漏洞详情:** [CVE-2018-15473](https://nvd.nist.gov/vuln/detail/CVE-2018-15473)