## CVE-2023-45878-GibbonEdu-任意文件写入/RCE

**漏洞编号:** CVE-2023-45878

**漏洞类型:** 任意文件写入/远程代码执行

**影响应用:** GibbonEdu

**危害等级:** 高危，可导致服务器被完全控制

**影响版本:** <= 25.0.1

**利用条件:** 需要目标服务器运行存在漏洞的GibbonEdu系统，并能通过HTTP访问

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-45878是GibbonEdu 25.0.1及更早版本中存在的任意文件写入漏洞。该漏洞位于`rubrics_visualise_saveAjax.php`文件中，由于此文件没有进行身份验证，攻击者可以通过构造恶意的HTTP POST请求，利用`img`、`path`和`gibbonPersonID`参数，将任意PHP代码写入服务器。攻击者通过设置`path`参数指定文件保存路径，并将包含恶意代码的base64编码内容放在`img`参数中，服务器会将base64解码后的内容写入指定路径，从而实现任意文件写入。写入的PHP文件允许未经身份验证的远程代码执行。

**漏洞利用方式：**
1.  攻击者发送一个POST请求到`/Gibbon-LMS/modules/Rubrics/rubrics_visualise_saveAjax.php`。
2.  在POST请求中，`img`参数包含base64编码的PHP webshell代码，`path`参数指定webshell的文件名，`gibbonPersonID`参数可以设置为任意值。
3.  服务器接收到请求后，将`img`参数中的base64编码数据解码，然后将其写入到通过`path`参数指定的文件中。
4.  攻击者随后可以通过访问webshell文件，执行任意系统命令，从而控制服务器。

**POC代码分析：**
POC代码`gibbonlms_cmd_shell.py`实现了一个简单的交互式命令行shell。它首先上传一个包含`system($_GET['cmd'])`的PHP webshell，然后允许用户通过输入命令与webshell进行交互。如果webshell被删除，脚本会自动重新上传webshell。

**投毒风险分析：**
该POC代码主要功能是利用漏洞上传webshell并提供交互式界面。潜在的投毒风险较低，但是仍存在一些可能性：

*   **依赖风险：** 代码依赖`requests`库，如果`requests`库本身被投毒，可能影响POC的安全性。
*   **后门风险：** 作者可能在webshell中加入隐蔽的后门代码，例如，记录用户输入的命令或将服务器信息发送到外部服务器，但从当前代码来看，没有明显的后门特征。风险评估为10%。
*   **误用风险：** 该脚本明确声明用于教育目的，但如果被恶意使用者利用，可能造成严重危害。脚本的广泛传播可能增加漏洞被利用的风险。

综合来看，该POC的投毒风险较低，主要风险在于误用和对`requests`库的依赖。

**项目地址:** [ulricvbs/gibbonlms-filewrite_rce](https://github.com/ulricvbs/gibbonlms-filewrite_rce)

**漏洞详情:** [CVE-2023-45878](https://nvd.nist.gov/vuln/detail/CVE-2023-45878)