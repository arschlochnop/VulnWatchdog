## CVE-2018-6574-Go-远程命令执行

**漏洞编号:** CVE-2018-6574

**漏洞类型:** 远程命令执行

**影响应用:** Go

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Go < 1.8.7, Go 1.9.x < 1.9.4, Go 1.10 pre-releases < Go 1.10rc2

**利用条件:** 用户使用受影响的Go版本执行`go get`命令获取恶意代码仓库

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2018-6574 允许攻击者通过控制`go get`获取的代码仓库，利用gcc/clang插件机制注入恶意代码，从而在编译时执行任意命令。 

**漏洞利用方式：**

1.  攻击者创建一个包含恶意代码的Go项目，该项目包含一个C文件 (`attack.c`) 和一个Go文件 (`main.go`)。
2.  `attack.c` 文件包含在编译时执行任意命令的代码。在这个例子中，它执行 `/usr/local/bin/score 9d8dad5f-cda0-45bd-b004-219ca9c1774c`。这个命令可能用于漏洞评分或执行恶意操作。
3.  `main.go` 文件使用 `// #cgo CFLAGS: -fplugin=./attack.so` 注释指示 `go` 编译器使用 `attack.c` 生成的插件。 这会强制 `go` 在构建过程中加载并执行该插件。
4.  当用户使用易受攻击的 Go 版本运行 `go get <attacker_repo>`时，`go` 命令会自动下载并构建恶意项目。
5.  由于 `-fplugin` 标志未被正确过滤，`go` 编译器将加载并执行恶意插件，从而在用户的系统上执行攻击者指定的任意命令。

**有效性评估：**

提供的PoC代码有效，它演示了如何在 `go get` 命令执行期间利用 gcc/clang 插件功能执行任意命令。

**投毒风险评估：**

在此特定仓库中，未发现明显的投毒代码。`attack.c` 中执行的命令 `/usr/local/bin/score 9d8dad5f-cda0-45bd-b004-219ca9c1774c` 本身就是漏洞验证的一部分，旨在证明可以执行任意命令。没有迹象表明作者试图隐藏其他恶意代码或功能。因此，投毒风险评估为 0%。

**总结：**

该漏洞利用了 `go get` 命令在处理 gcc/clang 插件参数时的不当输入验证。攻击者可以通过创建一个包含恶意插件的Go项目来利用此漏洞，当用户使用易受攻击的Go版本获取并构建该项目时，该插件将被加载并执行，从而导致远程命令执行。

**项目地址:** [faqihudin13/CVE-2018-6574](https://github.com/faqihudin13/CVE-2018-6574)

**漏洞详情:** [CVE-2018-6574](https://nvd.nist.gov/vuln/detail/CVE-2018-6574)