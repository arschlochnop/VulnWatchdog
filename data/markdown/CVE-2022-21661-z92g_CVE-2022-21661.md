## CVE-2022-21661-WordPress-SQL注入

**漏洞编号:** CVE-2022-21661

**漏洞类型:** SQL注入

**影响应用:** WordPress

**危害等级:** 高危，可能导致数据泄露、数据篡改和远程代码执行

**影响版本:** < 5.8.3

**利用条件:** 需要目标WordPress站点存在/wp-admin/admin-ajax.php接口，并且未进行必要的安全配置。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-21661 是 WordPress 中 WP_Query 类由于不正确的清理而导致的一个 SQL 注入漏洞。此漏洞允许攻击者通过插件或主题在特定方式下使用 WP_Query 时执行任意 SQL 查询。从搜索引擎的结果和漏洞库信息中可以得知，该漏洞影响 WordPress 5.8.3 之前的版本。提供的 POC 代码（Go 语言编写）通过构造恶意的 `tax_query` 参数，并发送到 `wp-admin/admin-ajax.php` 接口来触发 SQL 注入。代码中包含两种利用方式：一种是利用 `extractvalue` 函数尝试获取数据库信息（基于报错），另一种是利用 `sleep` 函数进行时间盲注。代码首先检查目标是否存在 `wp-admin/admin-ajax.php` 接口，然后尝试利用上述两种 payload 进行攻击。如果成功，则会输出漏洞存在的提示信息，并将结果写入日志文件。批量扫描功能也已实现，可以从文件中读取 IP 地址列表进行扫描。

**有效性：** 根据POC代码中的逻辑，它首先检查/wp-admin/admin-ajax.php是否存在，然后通过两种方法(extractvalue报错注入和sleep时间盲注)验证漏洞，相对有效。

**投毒风险：** 代码主要功能是漏洞扫描，但也存在一定的投毒风险。例如，日志记录功能可能被滥用，在扫描过程中搜集到的信息被记录到日志文件中，如果日志文件被恶意访问，可能导致信息泄露。此外，虽然代码本身未发现明显的恶意后门，但如果编译环境被污染，或者引入了恶意的第三方依赖库，也可能导致安全风险。考虑到代码的功能和潜在的风险，我给出的投毒风险评分为 10%。

**利用方式：**
1.  攻击者需要能够访问目标 WordPress 站点的 `/wp-admin/admin-ajax.php` 接口。
2.  攻击者构造包含恶意 SQL 代码的 `tax_query` 参数，并将其作为 POST 请求的 body 发送到 `/wp-admin/admin-ajax.php`。
3.  服务器端 WP_Query 类在处理 `tax_query` 参数时，由于缺少必要的安全检查，会将恶意 SQL 代码拼接到 SQL 查询语句中。
4.  如果攻击成功，攻击者可以执行任意 SQL 查询，从而获取数据库中的敏感信息，甚至控制整个 WordPress 站点。

**项目地址:** [z92g/CVE-2022-21661](https://github.com/z92g/CVE-2022-21661)

**漏洞详情:** [CVE-2022-21661](https://nvd.nist.gov/vuln/detail/CVE-2022-21661)