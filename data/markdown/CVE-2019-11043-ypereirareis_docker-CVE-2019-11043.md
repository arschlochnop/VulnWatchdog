## CVE-2019-11043 PHP-FPM远程代码执行

**漏洞编号:** CVE-2019-11043

**漏洞类型:** 远程代码执行

**影响应用:** PHP-FPM

**危害等级:** 高危，可导致服务器被完全控制

**影响版本:** 7.1.x < 7.1.33, 7.2.x < 7.2.24, 7.3.x < 7.3.11

**利用条件:** Nginx配置不当，将请求传递给存在漏洞的PHP-FPM实例

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-11043 漏洞存在于 PHP-FPM 中，当 PHP-FPM 与 Nginx 结合使用且 Nginx 配置不正确时，可能导致远程代码执行。

**有效性：**
根据漏洞库信息、搜索结果以及提供的漏洞利用代码（Dockerfile），可以判断该漏洞的POC代码是有效的。漏洞利用代码中的Dockerfile构建了一个包含`phuip-fpizdam`工具的Docker镜像，该工具专门用于检测和利用 CVE-2019-11043 漏洞。

**投毒风险：**
Dockerfile 本身仅仅是用于安装和运行已知的漏洞利用工具，没有发现作者隐藏的恶意代码。
`phuip-fpizdam` 工具的目的是检测目标是否存在漏洞，并尝试利用它来执行命令。该工具本身可能会对目标系统造成损害，但这不属于投毒行为，而是漏洞利用的正常结果。
`tests.sh`文件用于构建和运行 docker 镜像，没有发现额外的恶意行为。
虽然该工具本身可能存在其他未知的安全问题，但就当前提供的代码来看，投毒风险较低, 评估为10%。这个风险评估主要基于以下几点：
1. Dockerfile 包含了从外部仓库下载代码的操作 (`go get github.com/neex/phuip-fpizdam`)，如果该仓库被篡改，可能导致镜像中包含恶意代码。
2. `phuip-fpizdam` 工具本身的代码没有进行详细审查，可能存在未知的漏洞或后门。

**利用方式：**
利用方式主要通过构造畸形的请求，触发 PHP-FPM 中的 env_path_info 下溢漏洞。具体步骤如下：
1.  构造特殊的URL，导致 `env_path_info` 的长度计算错误，从而发生缓冲区下溢。
2.  缓冲区下溢允许攻击者覆盖 FPM 分配的内存，包括 FCGI 协议数据。
3.  通过覆盖 FCGI 协议数据，可以修改请求的处理方式，例如，设置 `php.ini` 中的配置选项，从而允许执行任意代码。
4.  攻击者可以通过在 URL 中附加参数来执行系统命令，例如 `?a=/bin/sh+-c+'whoami'`。工具会自动检测QSL参数并攻击，或者可以通过手动指定参数。

**总结：**
CVE-2019-11043 是一个严重的安全漏洞，攻击者可以在未经授权的情况下远程执行代码。由于漏洞利用的复杂性（需要特定的 Nginx 和 PHP-FPM 配置），攻击难度为高。

**项目地址:** [ypereirareis/docker-CVE-2019-11043](https://github.com/ypereirareis/docker-CVE-2019-11043)

**漏洞详情:** [CVE-2019-11043](https://nvd.nist.gov/vuln/detail/CVE-2019-11043)