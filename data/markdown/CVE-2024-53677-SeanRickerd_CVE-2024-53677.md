## CVE-2024-53677 - Apache Struts 文件上传路径遍历导致远程代码执行

**漏洞编号:** CVE-2024-53677

**漏洞类型:** 文件上传路径遍历/远程代码执行

**影响应用:** Apache Struts

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 2.0.0 < version < 6.4.0

**利用条件:** 需要Struts应用使用存在漏洞的FileuploadInterceptor旧文件上传机制

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-53677是Apache Struts框架中的一个文件上传漏洞。攻击者可以利用此漏洞，通过操纵文件上传参数，实现路径遍历，从而将恶意文件上传到服务器的任意目录。如果上传的文件是可执行脚本（如JSP），攻击者就可以通过访问该脚本来执行任意代码，最终实现远程代码执行。

**漏洞利用方式：**

1.  **路径遍历：** 利用Struts的文件上传功能，通过修改上传参数，构造包含`../`的路径，绕过文件上传的限制，将文件上传到任意目录。
2.  **上传恶意文件：** 上传包含恶意代码的文件，例如JSP脚本。
3.  **远程代码执行：** 通过Web浏览器访问上传的恶意文件，触发恶意代码的执行，从而实现远程代码执行。

**有效性：**

根据漏洞信息、搜索结果和提供的POC代码，该漏洞的POC代码有效。搜索结果中多个链接(如dynatrace, qualys, arcticwolf, sonicwall, nsfocusglobal, censys等)都提到了CVE-2024-53677漏洞，并且描述了通过文件上传路径遍历实现RCE。提供的Dockerfile和S2-067.py脚本，以及README.md文件，都提供了完整的漏洞复现环境和利用方法，证明了该漏洞的可利用性。

**投毒风险：**

虽然该POC提供了一个可用的漏洞利用方法，但存在轻微的投毒风险。原因是:

*   Dockerfile：Dockerfile构建过程相对清晰，构建了一个存在漏洞的Struts应用，并部署了tomcat，本身不包含恶意代码。然而，它从其他位置拷贝了`tomcat-users.xml`和`context.xml`配置文件，这些文件可能会包含恶意配置，例如预置的管理员账号密码或者允许任意IP访问manager接口，从而引入安全风险，但这些风险主要取决于这两个文件的具体内容。
*   S2-067.py：Python脚本用于利用该漏洞，其主要功能是上传文件。脚本本身的功能是路径遍历文件上传，本身不属于后门，但如果destination参数设置不当(如覆盖重要文件)，可能导致服务不可用。
*   README.md: README.md中提到了在Openshift上运行需要添加`oc adm policy add-scc-to-group anyuid system:authenticated`, 这在生产环境中是非常危险的，可能导致权限泄露.

综合评估，该仓库的投毒风险较低（约5%）。大部分代码用于漏洞复现，而非恶意行为。真正的风险在于`tomcat-users.xml`和`context.xml`可能存在的恶意配置，以及在Openshift部署时使用`anyuid`可能带来的权限泄露。因此需要仔细检查这些文件，并谨慎地进行部署。


**项目地址:** [SeanRickerd/CVE-2024-53677](https://github.com/SeanRickerd/CVE-2024-53677)

**漏洞详情:** [CVE-2024-53677](https://nvd.nist.gov/vuln/detail/CVE-2024-53677)