## CVE-2019-20372-NGINX-HTTP请求走私

**漏洞编号:** CVE-2019-20372

**漏洞类型:** HTTP请求走私

**影响应用:** NGINX

**危害等级:** 中危，可能导致未授权访问和信息泄露

**影响版本:** < 1.17.7

**利用条件:** 需要特定 error_page 配置和 NGINX 前端存在负载均衡器

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2019-20372是 NGINX 在 1.17.7 之前的版本中存在的一个 HTTP 请求走私漏洞。当 Nginx 配置了特定的 `error_page` 指令时，可能允许攻击者通过构造恶意的 HTTP 请求来绕过安全策略或访问未授权的页面。漏洞利用依赖于 Nginx 对包含不同长度的请求头的处理不一致，导致请求被错误地分割和路由。

**有效性：**
根据提供的漏洞信息、搜索结果和漏洞利用代码，该漏洞是有效的。多个来源 (如 Red Hat, NVD, Rapid7, Acunetix) 都证实了该漏洞的存在，并提供了相关的描述和修复方案。提供的 POC 代码展示了如何利用该漏洞读取本应隐藏的页面。

**投毒风险：**
分析提供的文件 `default.conf` 和 `readme` 可以发现，`default.conf` 定义了两个 server 块：一个处理 `localhost` 的请求，另一个处理 `notlocalhost` 的请求。`localhost` server 块将所有请求返回 401 错误，并将其重定向到 `http://example.org`。`notlocalhost` server 块包含一个 location 块 `/_hidden/index.html`，返回字符串 "This should be hidden!"。`readme` 文件提供了运行 Nginx 的 Docker 命令和利用漏洞的命令。利用方式是通过发送一个精心构造的 HTTP 请求，其中包含两个 HTTP 请求：第一个请求访问 `/a` 并触发 401 错误，第二个请求访问 `/_hidden/index.html`。由于 Nginx 处理 `Content-Length` 的方式，第二个请求可能会被错误地路由到 `notlocalhost` server 块，从而允许攻击者读取隐藏的页面。 Docker命令是标准的,用于快速搭建漏洞环境。

整体来看，仓库里的代码基本是漏洞复现代码，作者没有动机在nginx配置里面投毒，所以风险极小.

**利用方式：**
1.  **配置 Nginx：** 需要存在特定的 `error_page` 配置。本例中，所有对 `/` 的请求都会返回 401，并重定向。
2.  **负载均衡器：**  漏洞通常发生在 Nginx 前端存在负载均衡器的环境中，但 POC 可以在本地复现。
3.  **构造恶意请求：**  发送包含两个 HTTP 请求的请求。第一个请求触发 `error_page`，第二个请求是被走私的请求。
4.  **读取未授权页面：** 由于请求走私，第二个请求可能被 Nginx 错误地处理，从而允许攻击者访问本不该访问的页面。攻击者能够读取 `/_hidden/index.html` 的内容,达到信息泄露的目的。

**项目地址:** [vuongnv3389-sec/CVE-2019-20372](https://github.com/vuongnv3389-sec/CVE-2019-20372)

**漏洞详情:** [CVE-2019-20372](https://nvd.nist.gov/vuln/detail/CVE-2019-20372)