## CVE-2022-44268-ImageMagick-信息泄露

**漏洞编号:** CVE-2022-44268

**漏洞类型:** 信息泄露

**影响应用:** ImageMagick

**危害等级:** 中危，可能导致敏感信息泄露

**影响版本:** 7.1.0-49

**利用条件:** 需要ImageMagick能够解析恶意PNG图片，且具有读取目标文件的权限。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-44268 是 ImageMagick 中的一个信息泄露漏洞。当 ImageMagick 解析 PNG 图像（例如，为了调整大小）时，如果 ImageMagick 二进制文件具有读取权限，则生成的图像可能会嵌入任意文件的内容。 

**1. 有效性：**
提供的 PoC 代码是有效的。`craft.py` 脚本用于创建一个恶意 PNG 图像，该图像的元数据中包含要读取的文件的路径。`extract.py` 脚本用于从处理后的 PNG 图像中提取文件内容。

**2. 投毒风险：**
分析 PoC 代码，该仓库中存在作者隐藏的投毒代码的可能性较低。 虽然无法完全排除，但代码结构简单，主要功能集中在生成和提取数据上。 
    *   `craft.py` 的功能是创建一个包含文件路径作为元数据的PNG图片，本身不涉及恶意代码。
    *   `extract.py` 的功能是从PNG图片中提取数据，没有可疑操作。
    *   README.md 文件只是说明如何使用脚本。 
    因此，初步判断该仓库投毒的可能性较低， 但是考虑到安全风险，仍然需要保持警惕。 给出5%的投毒风险可能，主要是由于作者可能通过一些不明显的方式添加后门。

**3. 利用方式：**
1.  攻击者使用 `craft.py` 脚本创建一个恶意的 PNG 图像，并将要读取的文件的路径（例如，`/etc/passwd`）作为元数据嵌入到 PNG 图像中。
2.  攻击者将此恶意 PNG 图像发送给目标系统，目标系统使用易受攻击的 ImageMagick 版本处理该图像（例如，调整大小）。
3.  ImageMagick 在处理图像时，会尝试读取 PNG 图像元数据中指定的文件，并将文件内容嵌入到处理后的图像中。
4.  攻击者使用 `extract.py` 脚本从处理后的图像中提取嵌入的文件内容，从而实现任意文件读取。

此漏洞的根本原因在于 ImageMagick 在处理 PNG 图像时，没有对元数据中指定的文件路径进行充分的验证和过滤，导致可以读取任意文件。

**项目地址:** [agathanon/cve-2022-44268](https://github.com/agathanon/cve-2022-44268)

**漏洞详情:** [CVE-2022-44268](https://nvd.nist.gov/vuln/detail/CVE-2022-44268)