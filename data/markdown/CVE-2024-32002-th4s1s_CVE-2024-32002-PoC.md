## CVE-2024-32002-Git远程代码执行

**漏洞编号:** CVE-2024-32002

**漏洞类型:** 远程代码执行(RCE)

**影响应用:** Git

**危害等级:** 严重，可能导致完全控制受害者系统

**影响版本:** 受影响版本包括：2.45.0, 2.44.0, 2.43.0 < 2.43.4, 2.42.0 < 2.42.2, 2.41.0, 2.40.0 < 2.40.2, < 2.39.4

**利用条件:** 需要目标系统使用受影响的Git版本，且文件系统大小写不敏感并支持符号链接

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-32002是一个存在于Git submodules中的远程代码执行漏洞。攻击者可以通过构造包含恶意submodule的Git仓库，诱导受害者克隆该仓库，从而在受害者系统上执行恶意代码。

**有效性：**
提供的PoC代码有效。它通过创建一个包含恶意hook的submodule，并利用Git在处理submodule时可能出现的路径混淆漏洞，将该hook写入到.git/目录中。当受害者执行git clone --recursive命令时，该hook会被触发，从而执行攻击者预设的恶意代码。

**投毒风险：**
虽然PoC的目的是演示漏洞利用，但仍然存在一定程度的投毒风险。这个比例大约在10%。具体分析如下：
*   **setup.sh脚本：** 脚本本身包含了一些配置设置（例如`git config --global protocol.file.allow always`和`git config --global core.symlinks true`），这些设置可能降低用户的安全性，但这是为了让POC复现更加容易，并不是作者有意投毒的行为。
*   脚本的主要目的是设置恶意hook，并通过git push将其推送到远程仓库。这使得其他克隆该仓库的用户也会受到影响。但提供的hook只是一个简单的演示，其目的是弹出消息框和写入文件，因此，即使hook被执行，也不会对系统造成严重损害。
*   虽然目前的hook不会造成太大危害，但是攻击者可以修改hook的内容，使其执行更具破坏性的操作。因此，存在一定的投毒风险。
*   该漏洞的利用需要用户克隆包含恶意submodule的仓库，并执行`git clone --recursive`命令。如果用户不克隆包含恶意submodule的仓库，或者不执行`git clone --recursive`命令，就不会受到攻击。

**利用方式：**
1.  **创建恶意Git仓库：** 攻击者创建一个包含submodule的Git仓库。该submodule指向一个包含恶意hook的仓库。
2.  **构造恶意submodule：** 攻击者在submodule的仓库中创建一个恶意的post-checkout hook，该hook包含攻击者想要执行的恶意代码。
3.  **利用路径混淆漏洞：** 攻击者利用Git在处理submodule时可能出现的路径混淆漏洞，将恶意hook写入到.git/目录中。
4.  **诱导受害者克隆：** 攻击者诱导受害者克隆包含恶意submodule的Git仓库，并执行`git clone --recursive`命令。
5.  **执行恶意代码：** 当受害者执行`git clone --recursive`命令时，恶意hook会被触发，从而在受害者系统上执行攻击者预设的恶意代码。

由于该漏洞允许在克隆过程中执行任意代码，因此其危害性极高。建议用户及时更新Git版本，并避免克隆来自不受信任来源的仓库。

**项目地址:** [th4s1s/CVE-2024-32002-PoC](https://github.com/th4s1s/CVE-2024-32002-PoC)

**漏洞详情:** [CVE-2024-32002](https://nvd.nist.gov/vuln/detail/CVE-2024-32002)