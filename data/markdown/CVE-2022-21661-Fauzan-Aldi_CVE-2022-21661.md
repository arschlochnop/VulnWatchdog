## CVE-2022-21661-WordPress-SQL注入

**漏洞编号:** CVE-2022-21661

**漏洞类型:** SQL注入

**影响应用:** WordPress

**危害等级:** 高危，可能导致数据泄露和远程代码执行

**影响版本:** < 5.8.3

**利用条件:** 需要目标WordPress站点存在漏洞，且攻击者能够通过网络访问该站点的/wp-admin/admin-ajax.php接口

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-21661 是 WordPress 中 WP_Query 类中由于不当的输入清理而导致的 SQL 注入漏洞。该漏洞允许经过身份验证的攻击者 (需要高权限，如管理员)通过构造恶意的 SQL 查询语句来执行任意 SQL 代码。根据漏洞库信息，攻击复杂度高，需要高权限用户，但是搜索引擎结果显示该漏洞影响广泛，可以被利用于未经授权的数据访问，甚至可能远程代码执行。提供的 PoC 代码 (main.py) 使用了两种方式来验证漏洞的存在：

1.  **基于错误的 SQL 注入 (Error-based SQL Injection):** 尝试使用 `extractvalue` 函数和 `concat` 函数来触发 SQL 错误，并将 MD5 哈希值嵌入到错误消息中。如果响应中包含正确的 MD5 哈希值，则表明存在漏洞。
2.  **基于时间的盲注 (Time-based Blind SQL Injection):** 尝试使用 `sleep()` 函数来引入延迟。如果服务器响应时间变长，则表明存在漏洞。

该 PoC 尝试访问 `/wp-admin/admin-ajax.php`，并使用 `action=test` 和包含恶意 SQL 查询的 JSON 数据发送 POST 请求。

**关于有效性：**

根据漏洞库信息和搜索结果，此漏洞是真实存在的，并且存在可用的 PoC。提供的 PoC 代码尝试通过 SQL 注入来验证漏洞的存在，因此在合适的条件下是有效的。

**关于投毒风险：**

PoC 代码本身包含一个随机数生成和 MD5 哈希加密的过程，这部分代码是为了验证 SQL 注入是否成功，而不是后门或恶意代码。但代码中存在以下潜在的投毒风险：

1.  **依赖项风险：** `requirements.txt` 文件中可能会包含恶意或过时的依赖项，这些依赖项可能会引入安全漏洞。
2.  **代码修改：** 下载的 PoC 代码可以被修改，以包含恶意代码。例如，攻击者可以修改 PoC 代码，在成功利用漏洞后，安装后门或执行其他恶意操作。
3.  **随机数的弱点：** `random.randint` 产生的随机数可能不够随机，如果攻击者能够预测随机数，就可以绕过 MD5 验证。
4.  **基于时间的盲注风险：** 基于时间的盲注依赖于服务器的响应时间，如果服务器负载过高或网络延迟不稳定，可能会导致误报。

综合考虑，该仓库存在一定投毒风险，约为10%，主要风险在于使用者在使用脚本时未检查脚本内容，直接运行导致被投毒。

**关于利用方式：**

1.  确定目标 WordPress 站点版本低于 5.8.3。
2.  确保目标站点启用了 `admin-ajax.php` 接口。
3.  运行 PoC 代码，并提供目标站点的 URL。
4.  PoC 代码将尝试通过 SQL 注入来验证漏洞的存在。
5.  如果漏洞存在，攻击者可以构造恶意的 SQL 查询语句来执行任意 SQL 代码，从而获取敏感数据、修改数据库内容，甚至执行远程代码。

**项目地址:** [Fauzan-Aldi/CVE-2022-21661](https://github.com/Fauzan-Aldi/CVE-2022-21661)

**漏洞详情:** [CVE-2022-21661](https://nvd.nist.gov/vuln/detail/CVE-2022-21661)