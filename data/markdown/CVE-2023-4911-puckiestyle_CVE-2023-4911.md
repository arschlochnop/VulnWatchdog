## CVE-2023-4911 - Glibc ld.so 缓冲区溢出本地提权漏洞

**漏洞编号:** CVE-2023-4911

**漏洞类型:** 缓冲区溢出

**影响应用:** glibc (ld.so)

**危害等级:** 高危，本地权限提升至root

**影响版本:** 2.34 < version < 2.39 (受影响的glibc版本)

**利用条件:** 本地用户，目标系统glibc版本在受影响范围内，需要能够设置环境变量

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-4911是一个glibc动态链接器ld.so中的缓冲区溢出漏洞，该漏洞位于处理GLIBC_TUNABLES环境变量的过程中。攻击者可以利用精心构造的GLIBC_TUNABLES环境变量，在使用SUID权限启动二进制文件时执行代码，从而获得提升的权限（root权限）。

**有效性：**
根据漏洞库信息和搜索结果，该漏洞被认为是高危漏洞，并且存在公开可用的PoC。提供的PoC代码包含Makefile、README.md、main.c和suid_lib.c。README描述了PoC的原理和使用方法，以及改进思路。main.c是利用漏洞的主要代码，它通过设置GLIBC_TUNABLES环境变量来触发缓冲区溢出。搜索结果中也提到了该漏洞是一个严重的本地提权漏洞，其利用可能导致严重的安全漏洞。

**投毒风险：**
代码仓库中可能存在投毒的风险，可能性较低。以下是一些需要注意的地方：

*   **依赖项：**  Makefile文件显示依赖于gcc, standard C libaries, 和 coreutils。代码的构建过程没有引入任何外部源或预编译的二进制文件，可以降低供应链投毒的风险。
*   **代码审查：** 代码本身很复杂，需要充分理解glibc内部机制和堆管理， 这对代码审查提出了要求。
*   **行为分析：**  运行`exploit` 会创建文件和目录，如果存在恶意代码，可能会在此时被触发。
*   **编译过程：** 编译过程看起来没有明显的异常。但是，需要确保使用的编译器是可信的。
*   **安全风险：** 总体而言，该存储库的结构看起来很标准，没有明显的投毒迹象。 考虑到作者水平和漏洞利用的复杂性，更可能存在的是漏洞利用代码的缺陷，而不是精心设计的后门。 代码更多地是依赖magic offset. 根据经验，此类项目中的风险主要在于漏洞利用的可靠性，而不是恶意代码。 因此，投毒风险评估为5%。

**利用方式：**
利用方式主要包含以下步骤：

1.  **编译PoC代码：** 使用`make`命令编译`main.c`和`suid_lib.c`，生成`exploit`可执行文件和`suid_lib.so`共享库。
2.  **设置环境：** 确保在可写目录中运行`exploit`，该目录包含`suid_lib.so`。`exploit`将创建一个名为`U`的目录，并将必要的库复制到该目录中。
3.  **运行exploit：** 执行`./exploit`命令。该程序将设置一系列`GLIBC_TUNABLES`环境变量，以便在调用SUID二进制文件时触发堆缓冲区溢出。
4.  **权限提升：** 成功利用后，攻击者将获得root权限。

**总结：**
该漏洞利用的有效性较高，但依赖于特定的glibc版本和系统配置。该漏洞的利用涉及复杂的堆操作和内存覆盖，需要对glibc的内部机制有深入的了解。 代码存在微小投毒风险，但总体是低危。

**项目地址:** [puckiestyle/CVE-2023-4911](https://github.com/puckiestyle/CVE-2023-4911)

**漏洞详情:** [CVE-2023-4911](https://nvd.nist.gov/vuln/detail/CVE-2023-4911)