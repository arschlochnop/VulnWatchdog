## CVE-2024-3721-TBK DVR-4104/DVR-4216-OS Command Injection

**漏洞编号:** CVE-2024-3721

**漏洞类型:** OS Command Injection

**影响应用:** TBK DVR-4104/DVR-4216

**危害等级:** 高危，可能导致设备被完全控制，加入僵尸网络

**影响版本:** <= 20240412

**利用条件:** 需要网络访问和HTTP服务端口开放，可能需要身份验证 (CVE信息中提到需要登录)

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-3721 存在于 TBK DVR-4104 和 DVR-4216 设备中，是一个 OS 命令注入漏洞。攻击者可以通过操纵 `/device.rsp?opt=sys&cmd=___S_O_S_T_R_E_A_MAX___` 接口的 `mdb/mdc` 参数来执行任意系统命令。

**有效性分析：**

提供的 Go 语言 POC 代码似乎有效。它构造了一个包含恶意命令的 HTTP GET 请求，并发送到目标设备的 `/device.rsp` 路径。如果设备存在漏洞，将会执行该命令。从代码分析，`shellCommand` 变量包含要执行的命令，默认为从 `http://141.98.10.30/wget.sh` 下载并执行 `wget.sh` 脚本。

**投毒风险分析：**

POC 代码本身具有一定的投毒风险。默认情况下，它会从 `http://141.98.10.30/wget.sh` 下载脚本并执行。如果攻击者控制了该服务器，他们可以修改 `wget.sh` 脚本以执行恶意操作。例如，安装后门、窃取数据或将设备加入僵尸网络。由于脚本是从外部源下载的，因此存在较高的投毒可能性。但是仓库代码本身的投毒风险较低。因此判定投毒风险为5%。

**利用方式：**

1.  **确定目标：** 找到运行存在漏洞的 TBK DVR-4104 或 DVR-4216 设备的 IP 地址。可能需要进行端口扫描以确定 HTTP 服务端口。
2.  **构造 Payload：** 修改 POC 代码中的 `shellCommand` 变量，以包含要执行的恶意命令。例如，可以执行 `reboot` 命令来使设备瘫痪，或者执行更复杂的命令来下载和执行恶意软件。
3.  **发送请求：** 运行 POC 代码，并将目标 IP 地址和端口作为参数传递。POC 代码将构造并发送包含恶意命令的 HTTP GET 请求。
4.  **执行命令：** 如果设备存在漏洞，它将执行恶意命令。

**搜索引擎结果分析：**

搜索引擎结果表明，CVE-2024-3721 已经被 Mirai 僵尸网络利用，用于感染 TBK DVR 设备。多个安全厂商发布了关于此漏洞的警告和分析报告。这进一步表明了该漏洞的严重性和利用价值。


**项目地址:** [qalvynn/CVE-2024-3721---POC](https://github.com/qalvynn/CVE-2024-3721---POC)

**漏洞详情:** [CVE-2024-3721](https://nvd.nist.gov/vuln/detail/CVE-2024-3721)