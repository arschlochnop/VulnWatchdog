## CVE-2018-1000861 - Jenkins 未授权远程代码执行

**漏洞编号:** CVE-2018-10008

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Jenkins

**危害等级:** 高危，未经身份验证的攻击者可以在受影响的Jenkins服务器上执行任意代码

**影响版本:** 未知，需要目标Jenkins服务器存在`org.jenkinsci.plugins.scriptsecurity.sandbox.groovy.SecureGroovyScript`类且允许未授权访问

**利用条件:** 目标Jenkins服务器可以被网络访问，且`/securityRealm/user/admin/descriptorByName/org.jenkinsci.plugins.scriptsecurity.sandbox.groovy.SecureGroovyScript/checkScript`端点未授权访问

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2018-1000861 漏洞允许未经身份验证的攻击者通过向特定Jenkins URL发送特制的请求，在Jenkins服务器上执行任意代码。 

**漏洞利用方式：**

1.  攻击者构造包含恶意命令的Groovy脚本。该脚本会被`org.jenkinsci.plugins.scriptsecurity.sandbox.groovy.SecureGroovyScript`类处理。
2.  攻击者将构造的Groovy脚本作为`value`参数的值，通过GET请求发送到目标Jenkins服务器的`/securityRealm/user/admin/descriptorByName/org.jenkinsci.plugins.scriptsecurity.sandbox.groovy.SecureGroovyScript/checkScript`端点，同时设置`sandbox=true`。
3.  如果Jenkins服务器存在漏洞且未进行身份验证配置，则Jenkins会执行攻击者提供的Groovy脚本，从而导致远程代码执行。

**有效性：**

提供的POC代码看起来有效，可以利用该漏洞。该脚本允许指定目标Jenkins服务器URL和要执行的命令。它构造包含命令的Groovy脚本，并将其发送到易受攻击的端点。

**投毒风险：**

虽然POC本身实现了漏洞利用，但存在一定的投毒风险。可能性评估为10%。

*   **风险点：** 代码中没有混淆或隐藏恶意行为，但存在以下风险:
    *   该脚本缺少漏洞验证功能。如果目标服务器不存在漏洞或者环境不满足漏洞利用条件，该脚本仍然会尝试执行代码，可能会造成不必要的影响。
    *   虽然脚本作者声明 reverse shell 功能未实现，但未来版本可能会添加该功能，如果恶意攻击者修改代码，加入恶意的reverse shell代码, 就可能造成严重的危害。
    *   脚本的README.md中提到`This tool does not attempt to verify the target is vulnerable. All it does is shove a shell command into a Java class.` 这表明该脚本的设计目的是直接执行命令，而不是进行漏洞检测，这本身就存在一定的风险。
    *   脚本作者建议在执行前验证目标操作系统。如果没有进行验证，可能会在错误的操作系统上执行命令，导致不可预知的后果。


**项目地址:** [smokeintheshell/CVE-2018-1000861](https://github.com/smokeintheshell/CVE-2018-1000861)

**漏洞详情:** [CVE-2018-10008](https://nvd.nist.gov/vuln/detail/CVE-2018-10008)