## CVE-2017-5638 - Apache Struts2 远程代码执行

**漏洞编号:** CVE-2017-5638

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Struts2

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** 2.3.x before 2.3.32, 2.5.x before 2.5.10.1

**利用条件:** 目标系统运行存在漏洞的Apache Struts2版本，且允许通过HTTP header传递参数

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2017-5638 漏洞存在于Apache Struts2框架的Jakarta Multipart parser中，由于其在处理文件上传时的异常处理和错误消息生成存在缺陷，攻击者可以通过构造恶意的Content-Type、Content-Disposition或Content-Length HTTP header来执行任意命令。

**有效性：**
提供的PoC代码是有效的，但它是一个安全的演示版本。它通过在Content-Type header中注入OGNL表达式，尝试设置一个自定义的HTTP响应头（X-Vuln）。如果服务器返回的响应中包含此header，则表示目标服务器可能存在漏洞。此PoC**不会**执行任何实际的恶意命令。

**投毒风险：**
分析了PoC代码和README文件，该仓库的目的是安全地演示该漏洞，而没有包含任何隐藏的或恶意的代码。没有发现任何投毒代码。因此, 投毒风险为 0%。

**利用方式：**
1.  **漏洞原理：** Struts2 使用Jakarta Multipart parser处理multipart请求，Content-Type头信息会被解析。如果Content-Type的值中包含OGNL表达式，并且OGNL表达式解析被启用，攻击者就可以利用OGNL表达式执行任意代码。
2.  **攻击方式：** 攻击者构造包含恶意OGNL表达式的Content-Type header，并发送给存在漏洞的Struts2服务器。
3.  **执行结果：** 服务器解析Content-Type header中的OGNL表达式，执行攻击者预设的恶意代码，最终导致远程代码执行。
4.  **PoC利用：** 提供的PoC利用代码通过发送包含`%{#context['com.opensymphony.xwork2.dispatcher.HttpServletResponse'].addHeader('X-Vuln','Vulnerable')}`的Content-Type头来判断是否存在漏洞，成功则表示可能存在漏洞。

**项目地址:** [iampetru/PoC-CVE-2017-5638](https://github.com/iampetru/PoC-CVE-2017-5638)

**漏洞详情:** [CVE-2017-5638](https://nvd.nist.gov/vuln/detail/CVE-2017-5638)