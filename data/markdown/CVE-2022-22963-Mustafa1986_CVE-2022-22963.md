## CVE-2022-22963-Spring Cloud Function RCE

**漏洞编号:** CVE-2022-22963

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Spring Cloud Function

**危害等级:** 高危，允许未授权的攻击者执行任意代码，完全控制受影响的服务器。

**影响版本:** Spring Cloud Function versions 3.1.6, 3.2.2 and older unsupported versions

**利用条件:** 应用程序使用了Spring Cloud Function，并且启用了路由功能，同时允许用户可控的SpEL表达式作为路由。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22963 是 Spring Cloud Function 中一个严重的远程代码执行漏洞。当使用路由功能时，攻击者可以通过提供精心设计的 SpEL 表达式来执行任意代码。漏洞利用方式如下：

1.  **漏洞描述：** Spring Cloud Function 的路由功能允许开发者根据某些条件将请求路由到不同的函数。如果路由表达式的控制权落在攻击者手中，攻击者就可以注入恶意 SpEL 表达式。

2.  **利用方式：** 攻击者可以通过构造包含恶意 SpEL 表达式的 HTTP 请求，利用 `/functionRouter` endpoint 触发漏洞。该 SpEL 表达式会被 Spring Cloud Function 执行，从而导致远程代码执行。

3.  **POC 代码分析：** 提供的 Python 脚本 `spring_exploit.py` 实现了 CVE-2022-22963 的漏洞利用。该脚本接受目标 URL 作为参数，并发送一个包含恶意 SpEL 表达式的 POST 请求到 `/functionRouter` endpoint。该表达式执行系统命令。脚本首先尝试执行 `touch /tmp/pwned` 来验证漏洞是否存在，如果存在，则允许用户输入攻击者 IP 地址，并尝试获取反向 Shell。

4.  **有效性：** 根据漏洞信息和 POC 代码，该 POC 代码是有效的，可以用于利用 CVE-2022-22963 漏洞。

5. **投毒风险：** POC 代码的主要功能是利用漏洞，没有明显的恶意行为。虽然执行任意命令具有潜在风险，但这是漏洞利用的固有特性。`nc_listener()` 函数只是为了方便接收反向 shell，本身没有投毒行为。

6.  **搜索引擎结果确认：** 搜索结果表明该漏洞是关键漏洞，无需身份验证即可远程利用，允许执行任意代码。这些结果进一步确认了漏洞的严重性和 POC 代码的有效性。

综合分析，该漏洞的利用方式简单，危害巨大。POC 代码能够有效利用该漏洞。虽然POC代码本身是为了利用漏洞进行验证和攻击，但存在被滥用的风险，使用者应遵守法律法规。

**项目地址:** [Mustafa1986/CVE-2022-22963](https://github.com/Mustafa1986/CVE-2022-22963)

**漏洞详情:** [CVE-2022-22963](https://nvd.nist.gov/vuln/detail/CVE-2022-22963)