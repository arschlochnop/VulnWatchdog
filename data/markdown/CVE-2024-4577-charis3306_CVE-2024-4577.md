## CVE-2024-4577 PHP-CGI 参数注入远程代码执行

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** PHP Windows版 8.3.0 <= 影响版本 < 8.3.8
PHP Windows版 8.2.0 <= 影响版本 < 8.2.20
PHP Windows版 8.1.0 <= 影响版本 < 8.1.29
PHP Windows版 影响版本 == 8.0.x
PHP Windows版 影响版本 == 7.x
PHP Windows版 影响版本 == 5.x
XAMPP Windows版 8.2.0 <= 影响版本 <= 8.2.12
XAMPP Windows版 8.1.0 <= 影响版本 <= 8.1.25
XAMPP Windows版 影响版本 == 8.0.x
XAMPP Windows版 影响版本 == 7.x
XAMPP Windows版 影响版本 == 5.x

**利用条件:** Windows 平台，PHP 以 CGI 模式运行，开启了Best-Fit字符转换特性的语系

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-4577 是一个存在于 PHP Windows 版本中的远程代码执行漏洞。当 PHP 以 CGI 模式运行时，Windows 的 Best-Fit 字符转换特性可能导致命令行参数被错误解析。攻击者可以构造包含特定非 ASCII 字符的 URL，这些字符会被转换为连字符，从而绕过安全限制，并注入恶意 PHP 代码。提供的 POC 脚本通过构造包含特殊字符的 URL，向目标服务器发送 POST 请求，其中包含要执行的 PHP 代码。如果服务器成功执行代码并返回包含 MD5 值的特定字符串，则认为漏洞利用成功。

**有效性：**
从漏洞描述和POC代码来看，此POC代码是有效的，可以用于检测和利用 CVE-2024-4577 漏洞。

**投毒风险：**
经过分析，此仓库中没有发现作者隐藏的恶意投毒代码。虽然POC执行了代码， 但这是为了验证漏洞是否成功，并非投毒行为。因此，投毒风险为0%。

**利用方式：**
1.  目标系统必须是 Windows，且 PHP 运行在 CGI 模式下，Apache 作为 Web 服务器。
2.  目标系统使用的语系启用了 Best-Fit 字符转换特性（例如简体中文，繁体中文，日文等）。
3.  攻击者构造包含特殊字符的 URL，这些字符在 Best-Fit 转换后会被解释为连字符，从而修改 PHP 的命令行参数。
4.  攻击者通过 `-d` 参数设置 `allow_url_include=1` 和 `auto_prepend_file=php://input`，允许包含远程文件，并将请求体作为 PHP 代码执行。
5.  攻击者在请求体中包含要执行的 PHP 代码，从而在服务器上执行任意代码。

**项目地址:** [charis3306/CVE-2024-4577](https://github.com/charis3306/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)