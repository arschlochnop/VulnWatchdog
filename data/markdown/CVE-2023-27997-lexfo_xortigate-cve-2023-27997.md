## CVE-2023-27997 - FortiOS SSL-VPN 堆缓冲区溢出

**漏洞编号:** CVE-2023-27997

**漏洞类型:** 堆缓冲区溢出

**影响应用:** FortiOS, FortiProxy

**危害等级:** 高危，远程代码执行

**影响版本:** FortiOS: <= 7.2.4, <= 7.0.11, <= 6.4.12, <= 6.0.16; FortiProxy: <= 7.2.3, <= 7.0.9, <= 2.0.12, <= 1.2.13, <= 1.1.6

**利用条件:** 需要目标系统开启SSL-VPN服务，且攻击者能够发起网络请求。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-27997 是 FortiOS 和 FortiProxy SSL-VPN 中的一个堆缓冲区溢出漏洞。未经身份验证的远程攻击者可以通过构造特制的请求来利用此漏洞，实现在目标系统上执行任意代码或命令。 

**有效性：**
根据漏洞信息和搜索结果，此漏洞已经被广泛研究，并有可用的POC代码。多个安全厂商（如Rapid7, BishopFox）发布了分析报告和利用工具。CISA也将此漏洞加入到已知被利用的漏洞列表中，表明该漏洞在野外已被利用。

提供的POC代码（xortigate-cve-2023-27997）明确指出 "It is not usable \"as-is\" and serves educational purposes."  尽管如此，它为研究人员理解和修改漏洞利用提供了基础。其中利用了MD5哈希碰撞来绕过一些验证，并通过构造特定的数据包来实现堆溢出，最终实现远程代码执行。

**投毒风险：**
代码审计显示该POC代码的功能是演示漏洞，但需要使用者自行修改和适配目标环境。虽然代码作者声明不会进行指纹识别和ROP链验证，降低了直接使用的可能性，但代码中仍然存在潜在的风险，使用者在修改代码时若引入错误或者被作者刻意埋藏后门代码(例如利用glu变量构建恶意负载),可能会导致攻击失败或执行恶意操作。仔细检查代码及依赖项，确保没有引入额外的恶意功能非常重要。从目前的证据来看，作者明确声明了代码用途，并且代码结构比较清晰，未发现明显恶意代码。 假设作者有意投毒的可能性较低，估计为10%。 风险主要在于使用者自行修改和使用过程中引入错误或被攻击。

**利用方式：**
1.  **漏洞触发：**  通过构造恶意SSL-VPN请求触发堆缓冲区溢出。
2.  **内存覆盖：**  利用溢出覆盖堆上的关键数据结构，例如SSL会话结构。
3.  **代码执行：**  通过覆盖SSL会话结构中的函数指针或其他可控变量，实现任意代码执行。 POC中提到了利用MD5进行XOR异或绕过，并构建ROP链。具体利用方式需要根据目标系统的架构和内存布局进行调整。

**总结：**
CVE-2023-27997是一个严重的安全漏洞，利用难度相对较高，但由于在野外已被利用，且存在可用的POC代码，攻击者可以基于POC进行修改和利用。使用者应该尽快修复此漏洞，并对相关系统进行安全检查。

**项目地址:** [lexfo/xortigate-cve-2023-27997](https://github.com/lexfo/xortigate-cve-2023-27997)

**漏洞详情:** [CVE-2023-27997](https://nvd.nist.gov/vuln/detail/CVE-2023-27997)