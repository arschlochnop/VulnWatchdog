## CVE-2024-3400 PAN-OS GlobalProtect 远程命令执行漏洞

**漏洞编号:** CVE-2024-3400

**漏洞类型:** 远程命令执行

**影响应用:** Palo Alto Networks PAN-OS GlobalProtect

**危害等级:** 高危，未经身份验证的攻击者可以利用此漏洞以root权限执行任意代码。

**影响版本:** PAN-OS 10.2 (小于 10.2.9-h1), PAN-OS 11.0 (小于 11.0.4-h1), PAN-OS 11.1 (小于 11.1.2-h3)

**利用条件:** 目标系统需要配置GlobalProtect gateway 或 GlobalProtect portal，且是受影响的PAN-OS版本。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

**漏洞评估：**

CVE-2024-3400 是 Palo Alto Networks PAN-OS GlobalProtect 中的一个远程命令执行漏洞。CVSS 评分为 10 分，表明该漏洞非常严重。利用此漏洞，未经身份验证的攻击者可以在受影响的设备上以 root 权限执行任意代码。

**漏洞有效性：**

根据漏洞库信息和搜索结果，CVE-2024-3400 已经被积极利用。漏洞库信息明确指出 Palo Alto Networks 已经意识到越来越多的攻击利用了这个漏洞，并且已经公开了第三方提供的概念验证代码。多个搜索结果也印证了这一点，并提供了关于检测利用尝试和后渗透活动的更多信息。

提供的代码`panos-scanner.py` 是一个版本检测工具，可以帮助确定远程 PAN-OS 目标的软件版本。这个工具本身并不能直接利用该漏洞，但可以用于识别易受攻击的目标。 因此，提供的POC代码不是直接的漏洞利用代码,而只是一个辅助确定目标版本脚本, 需要配合其他的exp利用。

**投毒风险：**

分析 `panos-scanner.py`，此脚本的主要目的是通过发送 HTTP 请求到目标 PAN-OS 设备，并分析返回的 HTTP 头部来确定其版本。脚本中存在以下潜在的投毒风险：

*   **依赖项风险：** 脚本依赖于 `requests` 和 `urllib3` 库。如果这些库被恶意替换，可能导致代码执行或其他恶意行为。
*   **版本表篡改：** 脚本使用 `version-table.txt` 文件来映射日期和 PAN-OS 版本。如果此文件被篡改，可能导致误报或漏报。
*   **请求劫持：** 虽然脚本使用了 `verify=False` 禁用了 SSL 证书验证，但如果攻击者能够劫持网络流量，可以伪造响应，从而欺骗脚本。
*   **参数注入：** 脚本接受命令行参数，例如目标 URL。如果对这些参数没有进行充分的验证，可能会导致命令注入。

考虑到以上因素，以及脚本的主要功能是版本检测，因此，该仓库中存在作者隐藏的投毒代码的可能性较低，估计为 10%。

**利用方式：**

CVE-2024-3400 是一个命令注入漏洞，允许未经身份验证的攻击者在受影响的 PAN-OS 设备上执行任意代码。利用方式通常涉及以下步骤：

1.  **目标识别：** 使用诸如 `panos-scanner.py` 这样的工具或手动分析来识别运行易受攻击的 PAN-OS 版本的设备，并且GlobalProtect 已配置启用。
2.  **漏洞触发：** 向 GlobalProtect 门户或网关发送特制的 HTTP 请求，其中包含恶意命令。由于这是一个任意文件创建导致的命令注入漏洞，攻击者可以通过构造特定的请求，使得 PAN-OS 在文件创建过程中执行恶意命令。
3.  **代码执行：** 成功利用该漏洞后，攻击者可以以 root 权限在防火墙上执行任意代码，例如安装后门、窃取敏感数据或中断服务。

**总结：**

CVE-2024-3400 是一个严重的安全漏洞，需要立即修复。建议受影响的用户尽快升级到 Palo Alto Networks 提供的修复版本。

**项目地址:** [AdaniKamal/CVE-2024-3400](https://github.com/AdaniKamal/CVE-2024-3400)

**漏洞详情:** [CVE-2024-3400](https://nvd.nist.gov/vuln/detail/CVE-2024-3400)