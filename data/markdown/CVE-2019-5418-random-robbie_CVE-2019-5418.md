## CVE-2019-5418 - Rails 文件内容泄露

**漏洞编号:** CVE-2019-5418

**漏洞类型:** 文件内容泄露

**影响应用:** Rails Action View

**危害等级:** 高危，可泄露敏感信息，可能导致进一步攻击

**影响版本:** <5.2.2.1, <5.1.6.2, <5.0.7.2, <4.2.11.1 and v3

**利用条件:** 目标应用使用存在漏洞的Rails版本，并且接受请求中可以控制Accept Header

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-5418 漏洞存在于 Rails Action View 组件中，允许攻击者通过构造恶意的 `Accept` Header 来读取服务器上的任意文件内容。 

**有效性分析：**

提供的POC代码是一个 Go 语言编写的扫描器，它通过发送包含恶意 `Accept` Header 的 HTTP 请求来探测目标是否存在 CVE-2019-5418 漏洞。具体来说，它设置 `Accept` 头部为 `../../../../../../../../etc/passwd{{`，尝试读取 `/etc/passwd` 文件。

如果响应状态码为 200 OK，并且响应内容包含 `/usr/sbin/nologin` 字符串（通常出现在 `/etc/passwd` 文件中），则判断目标系统存在漏洞，并将URL写入`rails.log`文件中。

根据漏洞描述和代码逻辑，该POC代码**有效**，可以用来检测目标 Rails 应用是否存在 CVE-2019-5418 漏洞。

**投毒风险分析：**

仔细检查了提供的 Go 语言代码，没有发现任何明显的恶意代码或后门。代码的功能主要集中在发送 HTTP 请求、检查响应内容以及将结果写入日志文件。代码中包含的`InsecureSkipVerify: true` 配置会跳过TLS证书验证，可能存在中间人攻击的风险，但并非作者故意植入的投毒代码，而是为了方便测试。

因此，**投毒风险为 0%**。

**利用方式：**

1.  攻击者构造包含恶意 `Accept` Header 的 HTTP 请求。
2.  `Accept` Header 中包含路径穿越字符（如 `../`）和目标文件的路径（如 `/etc/passwd`）。
3.  Rails 应用的 Action View 组件在处理该请求时，由于漏洞，会读取并返回指定文件的内容。
4.  攻击者通过分析响应内容，获取敏感信息（如系统用户信息）。

**缓解措施：**

*   升级 Rails 版本到安全版本（>= 5.2.2.1, >= 5.1.6.2, >= 5.0.7.2, >= 4.2.11.1）。
*   限制对 `render file:` 方法的使用，并对用户输入进行严格的验证和过滤。
*   配置 Web 服务器，阻止包含恶意字符的 `Accept` Header 通过。

**项目地址:** [random-robbie/CVE-2019-5418](https://github.com/random-robbie/CVE-2019-5418)

**漏洞详情:** [CVE-2019-5418](https://nvd.nist.gov/vuln/detail/CVE-2019-5418)