## CVE-2023-22894-Strapi-敏感信息泄露

**漏洞编号:** CVE-2023-22894

**漏洞类型:** 敏感信息泄露

**影响应用:** Strapi

**危害等级:** 中危，可导致用户密码哈希和重置令牌泄露

**影响版本:** <= 4.5.5

**利用条件:** 需要访问Strapi管理面板

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2023-22894允许攻击者（需要访问管理面板）通过利用查询过滤器来发现敏感的用户详情。攻击者可以通过包含敏感信息的列来过滤用户，并从API响应中推断出值。如果攻击者具有超级管理员权限，则可以利用此漏洞来发现所有用户的密码哈希和密码重置令牌。如果攻击者拥有可以访问权限较低角色的API用户的用户名和电子邮件的管理面板访问权限（例如，编辑或作者），则可以利用此漏洞来发现所有API用户的敏感信息，但不能发现其他管理帐户的信息。

**有效性：**

根据漏洞描述和搜索引擎结果，提供的PoC代码是有效的。漏洞利用代码中的 `dump-auth.py` 脚本需要管理员权限，通过登录管理面板获取 API Token，然后利用 API 过滤功能，逐步猜测并dump出用户的密码哈希和密码重置 Token。代码中使用了多线程来加速密码哈希的猜测。

**投毒风险：**

代码主要功能是利用已知的 Strapi 漏洞，通过构造特定的 API 请求来获取敏感信息，并未发现明显的恶意代码或后门。`dump-authless.py`代码不完整，无法评估，不过可以推断出该代码会尝试在未经身份验证的情况下利用该漏洞。但是，也不能完全排除作者在代码中隐藏了不易察觉的投毒代码的可能性。保守估计投毒的概率为1%。

**利用方式：**

1.  **获取管理员权限：** 攻击者首先需要通过某种方式获取 Strapi 管理面板的访问权限，例如通过弱口令、社工或其他漏洞。
2.  **登录管理面板：** 使用有效的管理员凭据登录 Strapi 管理面板。
3.  **获取 API Token：**  `dump-auth.py` 脚本会自动完成，`dump-authless.py` 可能通过某些未知的漏洞实现。
4.  **利用 API 过滤：** 脚本通过构造恶意的 API 请求，利用 Strapi 的查询过滤器漏洞，筛选用户数据。
5.  **猜测密码哈希/Token：**  脚本通过逐个字符猜测的方式，dump 出用户的密码哈希和密码重置 Token。

总而言之，该漏洞利用的有效性较高，但前提是攻击者需要获得管理员权限。投毒风险较低，但仍需保持警惕。

**项目地址:** [Saboor-Hakimi/CVE-2023-22894](https://github.com/Saboor-Hakimi/CVE-2023-22894)

**漏洞详情:** [CVE-2023-22894](https://nvd.nist.gov/vuln/detail/CVE-2023-22894)