## CVE-2025-39965-Linux Kernel-XFRM UAF

**漏洞编号:** CVE-2025-39965

**漏洞类型:** UAF (Use-After-Free)

**影响应用:** Linux Kernel

**危害等级:** 高危，可能导致内核崩溃或权限提升

**影响版本:** 6.6.103 < 6.6.109, 6.12.43 < 6.12.50, 6.16.2 < 6.16.10, 6.15.11

**利用条件:** 需要具备创建和操作XFRM策略的能力, 通常需要root权限或CAP_NET_ADMIN capability。

**POC 可用性:** 可能

**投毒风险:** 0%

## 详情

CVE-2025-39965 存在于 Linux 内核的 XFRM (IPsec转换框架) 子系统中。漏洞原因是 `xfrm_alloc_spi` 函数不应该使用0作为SPI(Security Parameter Index)，当`x->id.spi == 0` 时意味着 "no SPI assigned", 但是在commit 94f39804d891 ("xfrm: Duplicate SPI Handling")之后，系统会创建状态并将其添加到byspi列表中。`__xfrm_state_delete` 函数不会从byspi列表中删除这些状态，导致在下次遍历byspi列表时出现UAF漏洞。

**有效性：**
根据漏洞库信息，此漏洞确实存在于特定版本的Linux内核中，且有修复补丁。但是,提供的代码仅是GNU通用公共许可证，不是漏洞利用的POC代码，因此无法直接判断POC的有效性。要判断其有效性，需要实际针对受影响内核版本编写和执行POC代码。

**投毒风险：**
提供的代码只是一个LICENSE文件，因此投毒风险为0%。仓库本身可能存在投毒代码,但是此分析只针对提供的内容进行.

**利用方式：**
1.  **触发漏洞:** 攻击者需要能够配置XFRM策略，这通常需要root权限或者CAP_NET_ADMIN capability。攻击者会通过某种方式导致系统分配一个SPI值为0的XFRM状态，并将其添加到byspi列表中。
2.  **释放UAF对象:**  当具有SPI值为0的XFRM状态对象被删除时，`__xfrm_state_delete` 函数不会从byspi列表中删除该对象。
3.  **利用UAF:** 之后，当内核再次遍历byspi列表时，会访问已经被释放的XFRM状态对象，导致UAF漏洞。攻击者可以通过控制该被释放的内存，来达到内核崩溃或权限提升的目的。

**总结:** 漏洞在于未正确处理SPI为0的XFRM状态，导致释放后重用，从而可能导致内核崩溃或权限提升。

**项目地址:** [Shreyas-Penkar/CVE-2025-39965](https://github.com/Shreyas-Penkar/CVE-2025-39965)

**漏洞详情:** [CVE-2025-39965](https://nvd.nist.gov/vuln/detail/CVE-2025-39965)