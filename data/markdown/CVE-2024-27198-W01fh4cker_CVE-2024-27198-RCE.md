## CVE-2024-27198-TeamCity 身份验证绕过 RCE

**漏洞编号:** CVE-2024-27198

**漏洞类型:** 身份验证绕过导致远程代码执行

**影响应用:** JetBrains TeamCity

**危害等级:** 高危，允许未经身份验证的攻击者执行任意管理操作和远程代码执行

**影响版本:** < 2023.11.4

**利用条件:** 需要目标 TeamCity 实例网络可达

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-27198 允许未经身份验证的攻击者绕过 TeamCity 的身份验证机制，从而执行管理员操作。根据漏洞库信息，这是一个严重漏洞，CVSS 评分为 9.8，表明其影响非常高。CISA 已将其添加到已知被利用漏洞目录 (KEV)，这意味着该漏洞已被积极利用。

**有效性：**

提供的 Python POC 代码 `CVE-2024-27198-RCE.py` 看起来是有效的。它利用了身份验证绕过漏洞，通过构造特定的请求，允许攻击者上传恶意插件到 TeamCity 服务器，从而实现远程代码执行。代码尝试获取TeamCity版本和操作系统信息，这有助于确定目标环境并选择合适的攻击载荷。POC通过生成包含恶意JSP文件的插件,进而执行命令.

**投毒风险：**

虽然大部分代码看起来是为了利用漏洞，但存在一些潜在的投毒风险：

*   **JSP Shell 内容：** POC允许指定`shell_file_content`参数，可以插入任意jsp代码，这可能被滥用.
*   **随机数生成：** 代码中使用了一些随机字符串，但这些随机数生成器的安全性可能不足以抵抗高级攻击者的分析。
*   **插件名：**恶意jar包的名称可能会被检测出来,需要额外处理.

总的来说，投毒的概率为 10%。 主要是作者可能在shell_file_content参数里面做手脚，比如加入反向shell，获取肉鸡权限等。

**利用方式：**

1.  **身份验证绕过：** 攻击者利用 TeamCity 的身份验证绕过漏洞，无需提供有效的用户名和密码即可访问受保护的资源。
2.  **上传恶意插件：** 攻击者通过构造特定的请求上传一个包含恶意 JSP 文件的插件（JAR 文件）。该插件会伪装成合法插件，但实际上包含恶意代码。
3.  **远程代码执行：** TeamCity 服务器会加载并执行上传的恶意插件，从而允许攻击者在服务器上执行任意代码。攻击者通常会利用这一点来执行系统命令、安装后门或窃取敏感数据。

总体来说，利用方式相当直接，依赖于身份验证绕过漏洞来执行代码。

**项目地址:** [W01fh4cker/CVE-2024-27198-RCE](https://github.com/W01fh4cker/CVE-2024-27198-RCE)

**漏洞详情:** [CVE-2024-27198](https://nvd.nist.gov/vuln/detail/CVE-2024-27198)