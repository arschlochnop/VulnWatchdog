## CVE-2021-30047 - VSFTPD Denial of Service

**漏洞编号:** CVE-2021-30047

**漏洞类型:** 拒绝服务 (DoS)

**影响应用:** VSFTPD

**危害等级:** 高危，可能导致服务中断

**影响版本:** 3.0.3

**利用条件:** 目标服务器运行着 VSFTPD 3.0.3 且允许建立新的 FTP 连接。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

根据漏洞信息、搜索引擎结果和提供的漏洞利用代码，漏洞 CVE-2021-30047 是 VSFTPD 3.0.3 版本中的一个拒绝服务漏洞。该漏洞是由于 VSFTPD 允许的连接数有限，攻击者可以通过建立大量并发连接耗尽服务器资源，从而导致拒绝服务。

**有效性评估：**
提供的 Python 脚本 `cve-2021-30047.py` 旨在通过创建大量 FTP 连接来利用此漏洞。脚本首先检查目标 FTP 服务器的端口是否开放，然后启动多个线程，每个线程尝试建立一个新的 FTP 连接。通过耗尽服务器的连接资源，可以实现拒绝服务。

**投毒风险分析：**
代码主要功能是创建大量socket连接，并使用subprocess启动ftp进程。脚本包含一个简单的定时器，在15分钟后杀死所有ftp进程。主要风险在于subprocess的使用，理论上可以通过修改ftp命令或者在ftp交互过程中发送恶意指令，达到控制服务器的目的。但是原作者并未这样做，只是简单地利用ftp命令建立连接。因此认为投毒风险较低，考虑到subprocess本身的安全风险，给出10%的投毒风险评估。

**利用方式分析：**
1.  **目标确定：** 确定运行 VSFTPD 3.0.3 的目标服务器和 FTP 端口 (默认为 21)。
2.  **连接测试：** 使用 `testar_conexao` 函数验证目标端口是否开放。
3.  **并发连接：** 使用 `iniciar_ataque_loop` 函数启动多个线程，每个线程通过 `subprocess.Popen(f"ftp {alvo} {porta}", shell=True, stdout=subprocess.DEVNULL, stderr=subprocess.DEVNULL)` 尝试建立 FTP 连接。`subprocess.Popen` 用于在后台运行 `ftp` 命令，无需交互，仅用于建立连接。
4.  **资源耗尽：** 大量并发连接最终会耗尽服务器资源，导致拒绝服务。
5.  **定时清理：** 使用 `temporizador` 函数在 15 分钟后自动终止所有 `ftp` 进程，以避免长时间占用资源。

总而言之，漏洞利用方式是通过脚本创建大量并发的FTP连接请求，消耗目标服务器的资源，实现拒绝服务攻击。代码中的定时器用于限制攻击持续时间。

**项目地址:** [Andreyft7/CVE-2021-30047](https://github.com/Andreyft7/CVE-2021-30047)

**漏洞详情:** [CVE-2021-30047](https://nvd.nist.gov/vuln/detail/CVE-2021-30047)