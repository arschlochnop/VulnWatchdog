## CVE-2019-2215 Android Binder Use-After-Free

**漏洞编号:** CVE-2019-2215

**漏洞类型:** Use-After-Free

**影响应用:** Android Kernel

**危害等级:** 高危，可导致权限提升至Linux内核级别

**影响版本:** Kernel (受影响版本)

**利用条件:** 需要安装恶意本地应用程序或网络应用中的其他漏洞

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-2215 漏洞存在于 Android 系统的 Binder 机制中，属于一个使用释放后内存（Use-After-Free）的漏洞。攻击者可以利用此漏洞将权限从普通应用程序提升到 Linux Kernel 级别，从而完全控制设备。

**有效性：**
提供的POC代码针对华为 P20 Pro (CLT-AL00) 做了适配，并提供了绕过华为加固内核的方案，包括禁用 SELinux 和处理内核栈指针混淆。从代码逻辑来看，该POC具有一定的有效性，至少在特定设备和内核版本上。

**投毒风险：**
查看提供的代码，主要包含以下文件：
*   Makefile：用于编译 patch_system.c 和 poc.c。
*   README.md：描述了漏洞利用的背景、用法和注意事项。
*   common.c：包含漏洞利用的公共函数，如 kernel_write/kernel_read。
*   poc.c：漏洞利用的核心代码，包含提权逻辑。
*   patch_system.c：用于禁用 SELinux。

虽然主要逻辑是提权，但`patch_system.c`通过修改selinux策略进行提权，存在一定风险，可以理解为一种“劫持”系统安全机制的后门，方便后续利用。但这部分是利用漏洞的必须环节，并非传统意义的投毒代码。因此，这里将投毒风险评估为10%。

**利用方式：**
1.  **环境准备：** 漏洞利用需要特定的运行环境，例如华为 P20 Pro (CLT-AL00)，并且需要root权限才能运行。
2.  **禁用SELinux：** 首先，运行 `patch_system.c`，该程序会利用漏洞来禁用 SELinux，从而绕过 SELinux 的保护机制。通过修改selinux mapping和调用`avc_ss_reset()`来实现
3.  **权限提升：** 接下来，运行 `poc.c`，该程序会利用 Binder 机制中的 Use-After-Free 漏洞，覆盖内核数据结构，从而将当前进程的 UID、GID 和 capabilities 修改为 root 用户，从而获取 root 权限。

总的来说，该漏洞利用需要一定的技术水平，并且需要针对特定设备和内核版本进行适配。但是，一旦成功利用，攻击者就可以完全控制设备，从而造成严重的危害。

**项目地址:** [llccd/TempRoot-Huawei](https://github.com/llccd/TempRoot-Huawei)

**漏洞详情:** [CVE-2019-2215](https://nvd.nist.gov/vuln/detail/CVE-2019-2215)