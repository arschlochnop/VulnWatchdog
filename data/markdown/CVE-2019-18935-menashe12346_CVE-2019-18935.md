## CVE-2019-18935-Telerik UI for ASP.NET AJAX-反序列化漏洞

**漏洞编号:** CVE-2019-18935

**漏洞类型:** 反序列化漏洞

**影响应用:** Telerik UI for ASP.NET AJAX

**危害等级:** 高危，远程代码执行

**影响版本:** <= 2019.3.1023

**利用条件:** 需要目标系统存在Telerik UI for ASP.NET AJAX组件，且encryption keys已知 (通过CVE-2017-11317, CVE-2017-11357或其他方式)，或者目标版本在未进行特定配置的情况下。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-18935 是一个存在于 Progress Telerik UI for ASP.NET AJAX 中的 .NET 反序列化漏洞。当加密密钥已知（由于 CVE-2017-11317 或 CVE-2017-11357 的存在或其他方式）时，RadAsyncUpload 函数容易受到攻击。漏洞利用会导致远程代码执行。提供的PoC脚本 `CVE-2019-18935.py` 利用该漏洞通过以下步骤进行攻击:

1.  **密钥利用（前提条件）**: 该脚本依赖于已知或可以被推断出的加密密钥。之前的漏洞 (CVE-2017-11317, CVE-2017-11357) 允许攻击者获取这些密钥，或者在未配置默认防御措施的情况下，密钥可能是默认的。
2.  **DLL上传**: PoC首先上传一个恶意的DLL文件（`reverse_shell.dll`）。该DLL文件通常包含反向shell代码。
3.  **构造RAU Post Data**: 脚本构造包含目标文件夹、临时目标文件夹、文件大小等信息的RAU (RadAsyncUpload) post data。 这个数据被加密和HMAC签名，密钥是前面提到的加密密钥。
4.  **反序列化利用**: 脚本构造一个恶意的 `AssemblyInstaller` 对象，指定上传的DLL文件的路径。当 Telerik UI 反序列化这个对象时，它会尝试加载并执行 DLL 文件，从而导致远程代码执行。
5.  **反向Shell**:  脚本在本地启动一个反向Shell监听器，恶意DLL执行后会连接到该监听器，从而允许攻击者远程控制目标系统。
6. **命令执行**: 成功建立反向shell连接后，PoC脚本将执行用户指定的命令。

**漏洞利用有效性分析:**

PoC 的有效性取决于以下因素:

*   **目标系统上 Telerik UI for ASP.NET AJAX 的版本**: 漏洞存在于 2019.3.1023 及更早版本。
*   **加密密钥的可用性**: 成功利用漏洞的关键是拥有正确的加密密钥。
*   **目标系统是否已应用缓解措施**: 从 2020.1.114 版本开始，Telerik 引入了默认配置，可以阻止此漏洞利用。
*   **防火墙和网络配置**:  反向Shell的连接可能受到防火墙或网络配置的限制。

**投毒风险分析:**

代码中存在一定的投毒风险，尽管可能性相对较低，约为10%。
*   **`reverse_shell.dll`**: 这是潜在的投毒点。用户需要自行编译或获取此 DLL。如果 DLL 是从不受信任的来源获取的，它可能包含恶意代码。
*   **命令注入**: 脚本直接将用户提供的命令传递给反向shell。如果用户输入的命令本身包含恶意代码，可能会导致额外的安全问题。但是这不属于投毒，属于用户使用不当。

**利用方式总结:**

1.  获取或猜测 Telerik UI for ASP.NET AJAX 使用的加密密钥。
2.  使用 PoC 脚本上传包含反向shell代码的 DLL 文件。
3.  利用反序列化漏洞加载并执行上传的 DLL 文件。
4.  通过反向shell连接控制目标系统并执行命令。

**项目地址:** [menashe12346/CVE-2019-18935](https://github.com/menashe12346/CVE-2019-18935)

**漏洞详情:** [CVE-2019-18935](https://nvd.nist.gov/vuln/detail/CVE-2019-18935)