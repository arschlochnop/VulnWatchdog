## CVE-2023-20198 Cisco IOS XE Web UI 权限提升漏洞

**漏洞编号:** CVE-2023-20198

**漏洞类型:** 权限提升

**影响应用:** Cisco IOS XE Software Web UI

**危害等级:** 高危，允许未授权的远程攻击者创建具有特权 15 权限的本地用户，从而完全控制受影响的设备。

**影响版本:** 受影响版本包括 16.1.1 到 17.12.1 以及 17.11.99SW

**利用条件:** Web UI 功能必须已启用。攻击者需要能够通过网络访问设备的 Web UI。

**POC 可用性:** 是

**投毒风险:** 20%

## 详情

CVE-2023-20198 是 Cisco IOS XE 软件 Web UI 中的一个权限提升漏洞。未经身份验证的远程攻击者可以利用此漏洞在受影响的系统上创建一个具有特权 15 访问权限的帐户，本质上是管理员权限。漏洞利用通常与另一个漏洞 CVE-2023-20273 结合使用，后者用于将权限提升到 root 并将植入程序写入文件系统。

**漏洞利用有效性：**

根据漏洞库信息、搜索引擎结果（特别是 horizon3.ai 的 PoC 描述）以及提供的漏洞利用代码片段来看，该漏洞的利用是有效的。存在公开可用的 PoC，允许攻击者绕过身份验证创建具有管理权限的用户。

**投毒风险分析：**

提供的代码片段分析表明，攻击流程依赖于 Nginx 配置和一个 Lua 脚本。Lua 脚本的核心功能在于身份验证绕过和命令执行。脚本通过检查是否存在特定的 "Authorization" Header以及Header的内容是否和通过REDACTED命令执行结果匹配来确定请求是否被授权。

由于 "REDACTED" 信息的缺失，我们无法完全确定是否存在恶意投毒代码。但是lua脚本的下列行为存在潜在的投毒风险：

1.  **外部命令执行:** 脚本多次使用 `io.popen()` 执行外部命令。如果这些命令包含恶意参数或旨在下载和执行其他代码，则可能导致系统受损。
2.  **硬编码的凭据和逻辑：**脚本逻辑依赖于特定的哈希值和其他硬编码的字符串。攻击者可能会修改这些字符串以创建变体，从而绕过安全检测或植入后门。
3.  **对/lua5的请求:** 当common_type=iox时,会调用/lua5,如果/lua5是作者控制的地址,则存在投毒风险。

基于以上分析，虽然无法确定明确的投毒代码，但脚本中使用的技术（尤其是外部命令执行）增加了被用于恶意目的的可能性，估计投毒风险为20%。

**漏洞利用方式：**

1.  **未授权访问:** 攻击者发送一个特制的 HTTP POST 请求到 `/webui/logoutconfirm.html`，绕过身份验证检查（利用 CVE-2023-20198）。这可能涉及到提供特定的 `Authorization` header，该header的值能够通过预设的验证。
2.  **创建高权限用户:** 绕过身份验证后，攻击者可以发送包含创建新用户（具有特权级别 15）的命令的请求体。该命令通过 `io.popen()` 执行，从而创建一个具有管理员权限的本地用户。
3.  **权限提升和植入：** (结合 CVE-2023-20273) 使用新创建的本地用户登录并利用 CVE-2023-20273 将权限提升至 root，从而能够在设备上安装植入程序。


**项目地址:** [Shadow0ps/CVE-2023-20198-Scanner](https://github.com/Shadow0ps/CVE-2023-20198-Scanner)

**漏洞详情:** [CVE-2023-20198](https://nvd.nist.gov/vuln/detail/CVE-2023-20198)