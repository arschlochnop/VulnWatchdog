## CVE-2021-4034 - Polkit pkexec 本地提权

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地提权

**影响应用:** polkit

**危害等级:** 高危，允许低权限用户获取 root 权限

**影响版本:** 所有版本（修复前）

**利用条件:** 目标系统需要安装且存在未修复的 polkit pkexec

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-4034（PwnKit）是 polkit pkexec 实用程序中的一个本地提权漏洞。pkexec 是一个 setuid 工具，允许非特权用户根据预定义的策略以特权用户身份运行命令。该漏洞是由于 pkexec 没有正确处理调用参数的数量，从而导致尝试将环境变量作为命令执行。攻击者可以通过构造环境变量来诱使 pkexec 执行任意代码，从而获得 root 权限。

**有效性：**
根据漏洞库信息、搜索引擎结果以及漏洞利用代码描述，该漏洞利用的有效性非常高。漏洞库信息明确指出该漏洞允许非特权用户获取管理权限。搜索引擎结果中包含大量关于该漏洞的分析、利用方法和修复方案，表明该漏洞是一个真实存在的，并且被广泛利用的漏洞。

**投毒风险：**
提供的漏洞利用代码只是一个 README.md 文件，描述了漏洞本身。该文件并不包含实际的利用代码，因此很难直接判断是否存在投毒风险。但由于真实的POC代码来源于互联网，下载和使用未经审查的利用代码始终存在潜在的投毒风险。考虑到POC来源不明，且仅为漏洞描述文件，判定投毒风险较低，预估为10%。

**利用方式：**
1.  **利用参数计数错误:** 攻击者需要通过某种方式使得pkexec的参数计数错误。
2.  **构造恶意环境变量:**  攻击者精心构造特定的环境变量，这些环境变量会被 pkexec 误认为是命令来执行。
3.  **执行任意代码:**  pkexec 在权限提升的情况下执行攻击者控制的任意代码，从而获得 root 权限。

总的来说，CVE-2021-4034 是一个严重的安全漏洞，应该尽快修复。使用未经验证的POC时注意潜在的风险。

**项目地址:** [ASG-CASTLE/CVE-2021-4034](https://github.com/ASG-CASTLE/CVE-2021-4034)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)