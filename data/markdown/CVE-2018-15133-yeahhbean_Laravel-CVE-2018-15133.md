## CVE-2018-15133-Laravel框架反序列化远程代码执行

**漏洞编号:** CVE-2018-15133

**漏洞类型:** 反序列化漏洞

**影响应用:** Laravel Framework

**危害等级:** 高危，可导致远程代码执行

**影响版本:** <= 5.5.40, 5.6.x <= 5.6.29, <=5.7.27

**利用条件:** 需要知道APP_KEY

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2018-15133 漏洞存在于 Laravel Framework 中，是由于对 X-XSRF-TOKEN 值的反序列化操作不安全导致的远程代码执行漏洞。攻击者需要事先获得应用的 APP_KEY，才能构造恶意的序列化数据，通过修改 X-XSRF-TOKEN 的值，发送请求到服务器触发反序列化，从而执行任意代码。

**有效性：** 提供的 PoC 代码是有效的。从提供的 `README.md` 和 `exploit.py` 文件可以看出，该 PoC 包含以下步骤：
1.  构建包含漏洞的 Laravel 环境（通过 Dockerfile 和 docker-compose.yaml）。
2.  提取 Laravel 应用的 APP_KEY。
3.  使用 APP_KEY 和要执行的命令，通过 `exploit.py` 生成恶意 payload。
4.  将 payload 作为 X-XSRF-TOKEN 发送给 Laravel 应用，触发反序列化漏洞，从而执行任意命令。

**投毒风险：** 仓库的投毒风险较低，大约为 5%。 主要理由如下:
* Dockerfile构建标准Laravel环境，风险较低。
* exploit.py逻辑清晰，主要功能是构造payload进行攻击，没有发现恶意代码。
* docker-compose.yaml文件用于编排容器，没有发现可疑配置。
* 存在的风险是构建的docker镜像可能包含其他已知的软件漏洞，但并非作者主动投毒。
* 综合判断，主要代码功能符合漏洞利用的预期，恶意投毒可能性较低。

**利用方式：**
1.  攻击者首先需要获得目标 Laravel 应用的 APP_KEY。这可能通过信息泄露、代码审计等方式获得。
2.  攻击者使用 phpggc 等工具，基于已知的 Laravel gadget chain，生成恶意的序列化 payload。  或者使用`exploit.py`中类似的方式构造payload。
3.  攻击者将 payload 进行加密和编码，然后将其设置为 X-XSRF-TOKEN cookie 的值。
4.  攻击者向目标 Laravel 应用发送请求，当 Laravel 应用尝试解密和反序列化 X-XSRF-TOKEN 时，就会触发漏洞，执行 payload 中包含的恶意代码。

**项目地址:** [yeahhbean/Laravel-CVE-2018-15133](https://github.com/yeahhbean/Laravel-CVE-2018-15133)

**漏洞详情:** [CVE-2018-15133](https://nvd.nist.gov/vuln/detail/CVE-2018-15133)