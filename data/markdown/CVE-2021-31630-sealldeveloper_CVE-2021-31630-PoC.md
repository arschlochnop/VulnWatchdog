## CVE-2021-31630-OpenPLC Webserver-命令注入

**漏洞编号:** CVE-2021-31630

**漏洞类型:** 命令注入

**影响应用:** OpenPLC Webserver

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** v3

**利用条件:** 需要能够访问OpenPLC Webserver的/hardware页面，并具有有效的用户名和密码。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-31630 漏洞存在于 OpenPLC Webserver v3 的 `/hardware` 页面，允许远程攻击者通过 "Hardware Layer Code Box" 组件执行任意代码。根据提供的PoC代码，利用方式如下：

1.  **身份验证：**  PoC脚本首先使用提供的用户名和密码登录到 OpenPLC Webserver。
2.  **构造恶意Payload：**  脚本构造一个包含反向shell的C代码，该代码被注入到 "Hardware Layer Code Box" 中。该C代码会创建一个socket连接到攻击者指定的IP地址和端口，然后将标准输入、输出和错误重定向到该socket，最后执行 `/bin/bash`，从而建立一个反向shell。
3.  **上传Payload：**  脚本将构造的包含恶意代码的请求发送到 `/hardware` 页面。
4.  **触发编译：**  脚本访问 `/compile-program?file=blank_program.st` 页面，触发 OpenPLC 编译包含恶意代码的“硬件层”。
5.  **建立反向Shell：**  一旦代码被编译和执行，目标系统会连接到攻击者的监听端口，从而允许攻击者执行任意命令。

**有效性：** 根据搜索结果和PoC代码，该漏洞的利用是有效的，可以实现远程代码执行。

**投毒风险：**
查看了README，发现sealldev修改了Hunt3r0x提交的代码，移除了政治信息并且修复了拼写错误。main.py中，baseURL 被硬编码为 "http://wifinetictwo.htb:8080"，这表明此PoC是为HackTheBox的 "WifineticTwo" 靶机设计的，存在诱导使用者在相同IP环境下执行恶意代码风险。同时，PoC中的代码本身包含一个反向shell，这在某些情况下可能被认为是具有攻击性的。但此反向shell是漏洞利用的一部分，不能简单地归类为投毒。
综上，代码的投毒风险较低，大约为 10%。这个百分比主要考虑到脚本的针对性和潜在的非预期使用情况。

**项目地址:** [sealldeveloper/CVE-2021-31630-PoC](https://github.com/sealldeveloper/CVE-2021-31630-PoC)

**漏洞详情:** [CVE-2021-31630](https://nvd.nist.gov/vuln/detail/CVE-2021-31630)