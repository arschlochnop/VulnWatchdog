## CVE-2024-32019-netdata-本地提权

**漏洞编号:** CVE-2024-32019

**漏洞类型:** 本地提权

**影响应用:** netdata

**危害等级:** 高危，本地权限提升至root

**影响版本:** >= 1.44.0-60, < 1.45.3

**利用条件:** 需要netdata agent存在漏洞版本且ndsudo被调用

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-32019是Netdata Agent中ndsudo工具的一个本地权限提升漏洞。ndsudo是一个root用户拥有的、设置了SUID位的可执行文件。它本应只运行一组受限的外部命令，但是其搜索路径由PATH环境变量控制。攻击者可以通过控制PATH环境变量来指定ndsudo查找这些命令的位置，如果这个位置是攻击者具有写权限的目录，那么攻击者就可以放置恶意程序并以root权限执行。

**有效性：** 根据漏洞描述和搜索结果，该漏洞存在利用价值，通过控制PATH环境变量来执行恶意程序达到提权效果。

**投毒风险：** 提供的代码仅为GNU GENERAL PUBLIC LICENSE，是开源协议许可，不包含直接的攻击payload或恶意代码。但license本身也是一种代码，如果结合特定的上下文，协议内容也可能被滥用。例如，攻击者可能创建一个合法的程序，但其行为违反了协议条款，从而造成损害。此仓库中发现直接投毒代码的概率较低，但存在潜在的滥用风险，估计投毒风险为5%。

**利用方式：**
1.  确定目标系统上运行的Netdata Agent版本在受影响范围内（>= 1.44.0-60, < 1.45.3）。
2.  查找ndsudo工具的位置。
3.  创建一个包含恶意命令的目录，例如/tmp/evil。
4.  将恶意程序（如反弹shell）放置到/tmp/evil目录下，并命名为ndsudo尝试执行的命令（例如，`ping`，`date` 等, 具体取决于 ndsudo 允许执行的命令）。
5.  修改PATH环境变量，将/tmp/evil添加到PATH的最前面：`export PATH=/tmp/evil:$PATH`。
6.  运行ndsudo，它将执行/tmp/evil目录下的恶意程序，从而获得root权限。

**项目地址:** [C0deInBlack/CVE-2024-32019-poc](https://github.com/C0deInBlack/CVE-2024-32019-poc)

**漏洞详情:** [CVE-2024-32019](https://nvd.nist.gov/vuln/detail/CVE-2024-32019)