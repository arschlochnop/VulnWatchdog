## CVE-2019-12840 - Webmin Package Updates 远程命令执行

**漏洞编号:** CVE-2019-12840

**漏洞类型:** 远程命令执行 (RCE)

**影响应用:** Webmin

**危害等级:** 高危，可导致完全系统控制

**影响版本:** <= 1.910

**利用条件:** 需要目标Webmin实例运行且攻击者具有“Package Updates”模块的访问权限，需要用户名密码进行登录。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

该漏洞存在于Webmin的Package Updates模块。任何被授权访问此模块的用户都可以通过`update.cgi`的`data`参数执行任意命令，权限为root。

**有效性：**

根据漏洞库信息、搜索引擎结果以及提供的PoC代码，该漏洞利用是有效的。多个来源证实了该漏洞的存在，并且提供了可利用的PoC代码。

**投毒风险：**

PoC代码主要包含以下几个部分：

1.  **登录模块：** 模拟用户登录Webmin。
2.  **漏洞利用模块：** 构造包含恶意命令的payload发送到`update.cgi`。
3.  **反弹shell模块:** 构造反弹shell的命令，并对其进行Base64编码。

该脚本的主要功能是利用漏洞，没有发现明显的、与漏洞利用无关的恶意代码。但是`b64revshell`函数提供了一种便捷的方式生成反弹shell，如果用户不小心，可能会被利用来传播恶意payload。投毒风险预估在5%，主要来自于使用者对反弹shell的滥用和脚本本身存在的微小可能性，比如代码格式或注释中隐藏的细微恶意指令。

**利用方式：**

1.  **身份验证：** 首先，攻击者需要有效的Webmin用户名和密码，或者能够绕过身份验证。
2.  **模块权限：** 攻击者需要具有“Package Updates”模块的访问权限。
3.  **构造Payload：** 攻击者构造包含恶意命令的HTTP POST请求，将其发送到`update.cgi`。
4.  **命令执行：** Webmin服务器执行payload中的命令，并以root权限执行。
5.  **获取结果：** 攻击者可以从响应中获取命令执行的结果，或者使用反弹shell获取交互式shell。

提供的PoC脚本首先尝试登录Webmin，如果登录成功，则构造包含命令的payload，通过POST请求发送到`/package-updates/update.cgi`，从而实现远程命令执行。

**项目地址:** [KrE80r/webmin_cve-2019-12840_poc](https://github.com/KrE80r/webmin_cve-2019-12840_poc)

**漏洞详情:** [CVE-2019-12840](https://nvd.nist.gov/vuln/detail/CVE-2019-12840)