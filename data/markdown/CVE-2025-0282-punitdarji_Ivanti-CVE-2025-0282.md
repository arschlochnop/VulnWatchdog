## CVE-2025-0282-Ivanti Connect Secure-栈溢出

**漏洞编号:** CVE-2025-0282

**漏洞类型:** 栈溢出

**影响应用:** Ivanti Connect Secure, Policy Secure, Neurons for ZTA gateways

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Connect Secure <= 22.7R2.4, Policy Secure <= 22.7R1.2, Neurons for ZTA gateways <= 22.7R2.3

**利用条件:** 需要目标设备运行受影响的 Ivanti 产品，且允许未授权网络访问。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2025-0282 是 Ivanti Connect Secure, Policy Secure, 和 Neurons for ZTA gateways 产品中的一个栈溢出漏洞。攻击者可以通过发送特制的 HTTP 请求到 `/dana-na/auth/url_default/welcome.cgi` 接口利用此漏洞，实现未授权远程代码执行。根据提供的漏洞利用代码 `CVE_2025_0282_Ivanti.py`，利用方式如下：

1.  **构造恶意 Payload：** 使用 `create_exploit_payload` 函数创建一个包含填充数据、`system()` 函数地址、虚假返回地址以及要执行的命令地址的 payload。该函数通过栈溢出覆盖返回地址为 `system()` 函数的地址，并利用 `system()` 函数执行指定的命令。
2.  **发送 Payload：** 使用 `send_payload` 函数通过 HTTPS POST 请求将恶意 payload 发送到目标设备的 `/dana-na/auth/url_default/welcome.cgi` 接口。此函数首先创建一个 SSL 连接，然后构造包含 payload 的 HTTP 请求，并通过 SSL 连接发送。
3.  **执行命令：** 成功利用漏洞后，目标设备将执行 payload 中包含的命令。
4.  **上传 Web Shell：** 代码中包含 `upload_web_shell` 函数，允许攻击者将本地的 web shell 文件上传到目标服务器的 `/shell.php` 路径下。通过`exploit_vulnerability` 函数在目标服务器上执行 `echo '{web_shell_content}' > /shell.php` 命令实现。
5.  **验证 Web Shell：** `verify_shell` 函数尝试访问上传的 web shell，检查其是否可用。
6.  **执行 Web Shell 命令:** `execute_shell_command` 函数,通过POST请求,设置`cmd`参数,执行相关命令.
7.  **代码审计和投毒风险分析:**
    *   `disable_selinux`, `prevent_syslog_forwarding`, `remount_drive_rw`, `remove_log_entries`, `enable_selinux`, `remount_drive_ro`, `disable_updates` 这些函数目前处于注释状态，意味着它们在当前脚本版本中不会被执行，但是这些函数具有潜在的恶意行为。 如果这些函数被激活，则可能存在以下风险：
        *   禁用 SELinux 会降低系统的安全性。
        *   阻止 syslog 转发会阻止安全事件的日志记录。
        *   以读写方式重新挂载驱动器可能会允许修改关键系统文件。
        *   删除日志条目会覆盖攻击的痕迹。
        *   禁用更新可能会使系统容易受到攻击。
    *   虽然 `upload_web_shell` 功能本身是漏洞利用的一部分，但它也可能被认为是投毒行为，因为它在目标系统上安装了一个后门，攻击者可以利用该后门进行进一步的恶意活动。
    *   由于这些函数在当前版本中没有被激活，因此认为投毒的风险较低,约10%。

基于搜索结果，CVE-2025-0282 已被积极利用，并且存在可用的利用代码，这表明提供的 POC 代码很可能有效。CISA 已发布了针对该漏洞的缓解说明，进一步证明了其严重性和可利用性。

**项目地址:** [punitdarji/Ivanti-CVE-2025-0282](https://github.com/punitdarji/Ivanti-CVE-2025-0282)

**漏洞详情:** [CVE-2025-0282](https://nvd.nist.gov/vuln/detail/CVE-2025-0282)