## CVE-2025-1974-ingress-nginx-RCE

**漏洞编号:** CVE-2025-1974

**漏洞类型:** 远程代码执行

**影响应用:** ingress-nginx

**危害等级:** 高危，可以完全控制 Kubernetes 集群，暴露所有 Secrets

**影响版本:** <= 1.11.4, 1.12.0

**利用条件:** 需要能够访问 Pod 网络，并且目标集群运行受影响版本的 ingress-nginx

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2025-1974 允许未经身份验证的攻击者通过 Pod 网络访问 ingress-nginx 控制器的 Admission Webhook，进而执行任意代码。 

**有效性：**

提供的 PoC 代码包含两个主要部分：

1.  **shell.so 构建脚本：**  该脚本用于构建一个共享对象 (`shell.so`)，其中包含反向 shell 代码。`shell.c` 文件中的 `reverse_shell` 函数会在加载该共享对象时自动执行，连接到攻击者指定的 IP 地址和端口。**需要注意的是，`shell.c` 中的 IP 地址和端口需要修改为攻击者的 IP 和端口，否则利用会失败。**构建脚本使用 Alpine Linux 镜像，并编译 `shell.c` 为一个小的共享库。

2.  **xpl.py 利用脚本：** 该脚本尝试通过修改 Ingress 对象的 annotation，将恶意的 `shell.so` 库加载到 ingress-nginx 控制器中。它通过遍历 `/proc/[pid]/fd/[fd]` 路径来定位 ingress-nginx 控制器可以访问的文件描述符，并尝试将文件描述符指向的路径注入到 `ssl_engine` 指令中，从而加载恶意的共享库。`review.json` 文件包含 AdmissionReview 对象，其中包含恶意的 Ingress 对象定义，它使用 template injection 的方式尝试加载 shell.so 文件。

**利用方式：**

1.  **构建恶意的 `shell.so`：** 修改 `shell.c` 中的 IP 地址和端口，然后运行 `run_build.sh` 脚本来构建 `shell.so` 文件。
2.  **发送恶意的 AdmissionReview 请求：**  `xpl.py` 脚本会读取 `review.json` 文件，并替换 `REPLACE` 字符串为不同的文件描述符路径，然后将 AdmissionReview 请求发送到 ingress-nginx 控制器的 Admission Webhook。
3.  **利用成功：** 如果成功找到了一个有效的文件描述符，ingress-nginx 控制器将加载恶意的 `shell.so` 文件，执行其中的反向 shell 代码，从而使攻击者获得对控制器的远程代码执行权限。

**投毒风险：**

存在一定的投毒风险，大约为10%。主要体现在以下几个方面：

*   **`shell.c` 文件：**  虽然 `shell.c` 的目的是创建一个反向 shell，但如果作者在代码中添加了额外的恶意逻辑（例如，删除文件、修改配置等），则会在受害者执行 PoC 时造成额外的损害。当前代码比较简单，风险较低。
*   **`xpl.py` 文件：** 该文件尝试进行文件描述符遍历。虽然该脚本主要用于漏洞利用，但是仍然可能存在一些利用失败的情况，可能会影响目标系统的稳定性。
*   **`build.sh`文件:**  虽然该脚本主要是用来编译,但是如果作者在编译过程中加入一些恶意的代码,是有可能存在投毒的。

总体而言，投毒风险较低，主要是因为 PoC 代码相对简单，功能明确。但是，在使用任何 PoC 代码时，都应该仔细审查代码，确保没有隐藏的恶意行为。

**项目地址:** [BiiTts/POC-IngressNightmare-CVE-2025-1974](https://github.com/BiiTts/POC-IngressNightmare-CVE-2025-1974)

**漏洞详情:** [CVE-2025-1974](https://nvd.nist.gov/vuln/detail/CVE-2025-1974)