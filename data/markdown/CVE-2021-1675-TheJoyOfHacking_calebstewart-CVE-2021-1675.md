## CVE-2021-1675 PrintNightmare Windows Print Spooler RCE

**漏洞编号:** CVE-2021-1675

**漏洞类型:** 远程代码执行

**影响应用:** Windows Print Spooler

**危害等级:** 高危，可能导致系统被完全控制

**影响版本:** 受影响的Windows版本，参见漏洞库信息

**利用条件:** 需要目标系统开启Print Spooler服务

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-1675，又名PrintNightmare，是一个存在于Windows Print Spooler服务中的远程代码执行漏洞。攻击者可以利用此漏洞在目标系统上以SYSTEM权限执行任意代码。从搜索引擎结果来看，该漏洞已经被广泛研究并存在公开可用的PoC代码。

**有效性：** 提供的PoC代码 `CVE-2021-1675.ps1` 是一个PowerShell脚本，它利用该漏洞添加新的本地管理员用户或执行自定义DLL。该脚本通过 `AddPrinterDriverEx` 函数来加载恶意的驱动程序，从而实现代码执行。根据漏洞库信息和搜索结果，此漏洞真实存在且PoC有效。

**投毒风险：**  该脚本允许用户自定义DLL，这本身不是投毒。投毒的风险在于，脚本作者可能在默认DLL（由`get_nightmare_dll`函数提供）中包含恶意代码，这些代码可能不明显，难以检测。此外，该脚本的功能是添加用户或者执行 DLL,本身功能具有一定的危险性，使用不当可能造成系统损坏。综合考虑，判定存在10%的投毒风险，主要集中在默认DLL是否包含恶意后门。

**利用方式：** 利用方式如下：

1.  **本地提权/远程代码执行：**  攻击者可以利用该漏洞在本地提升权限，或者通过网络远程利用，在受影响的系统上以SYSTEM权限执行任意代码。
2.  **DLL注入：** PoC代码通过 `AddPrinterDriverEx` 函数添加恶意的printer driver，导致恶意DLL被加载到Print Spooler服务中，从而执行任意代码。
3.  **添加管理员用户：**  PoC代码可以配置为添加一个新的本地管理员账户，从而控制受影响的系统。该脚本会生成一个临时DLL文件，该DLL会在系统中创建一个新的管理员账户，密码也可以自定义。脚本会修改内存中的某些地址,来实现账户的配置。
4.  **利用链：** 通常需要结合其他漏洞或者利用方式（例如，中间人攻击）来远程触发该漏洞。

**项目地址:** [TheJoyOfHacking/calebstewart-CVE-2021-1675](https://github.com/TheJoyOfHacking/calebstewart-CVE-2021-1675)

**漏洞详情:** [CVE-2021-1675](https://nvd.nist.gov/vuln/detail/CVE-2021-1675)