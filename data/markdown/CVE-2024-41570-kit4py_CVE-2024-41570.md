## CVE-2024-41570 - Havoc C2 未授权SSRF漏洞

**漏洞编号:** CVE-2024-41570

**漏洞类型:** 服务器端请求伪造 (SSRF)

**影响应用:** Havoc C2

**危害等级:** 高危，可能导致信息泄露、内网渗透、远程代码执行

**影响版本:** 2 0.7 及 c2_0.74

**利用条件:** 目标Havoc C2服务器可访问

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-41570 是 Havoc C2 (版本 2 0.7 和 c2_0.74) 中存在的一个未经身份验证的服务器端请求伪造（SSRF）漏洞。该漏洞位于demon callback处理中，允许未经授权的攻击者从团队服务器发送任意网络流量。根据提供的漏洞利用代码(exploit.py和README.md)，该漏洞可以通过以下步骤利用：

1.  **漏洞利用方式：**
    *   **注册Agent:** 伪造一个demon agent注册并进行checkin。
    *   **建立WebSocket连接:** 利用WebSocket与Havoc C2服务器建立连接，发送握手和认证payload。
    *   **RCE:** 利用建立的WebSocket连接，执行远程命令，实现反向Shell。

2.  **有效性：**
    *   根据提供的漏洞库信息和搜索结果，该漏洞是真实存在的，并且已经被公开披露。
    *   漏洞利用代码描述清晰，提供了必要参数和使用示例。
    *   GitHub上的POC代码仓库(thisisveryfunny/CVE-2024-41570-Havoc-C2-RCE 和 kit4py/CVE-2024-41570)进一步验证了漏洞的可利用性。
    *   因此，提供的POC代码被认为是有效的。

3.  **投毒风险：**
    *   该POC的README.md 明确指出，使用该脚本必须经过授权，并且不得违反法律和道德规范。但是依旧存在代码投毒的风险。
    *   分析 `exploit.py` 文件，主要功能是实现 SSRF 漏洞的利用和反向 shell 的建立。尽管代码中没有明显的恶意代码，但依然存在潜在的风险。
    *   代码中的 `HEADERS = {"User-Agent": ""}` 存在潜在的风险，虽然User-Agent目前为空，但作者可以后续更新版本添加恶意User-Agent头，配合其他漏洞进行攻击
    *   总的来说，投毒风险较低（大约 10%），因为该PoC主要依赖于 SSRF 漏洞本身，而没有明显植入恶意后门代码。但仍需谨慎使用，并仔细审查代码，尤其注意从不受信任的来源获取的代码。

为了避免投毒，建议：
    *   从可信赖的来源获取漏洞利用代码。
    *   在使用前，仔细审查代码，尤其注意可疑的函数调用和网络请求。
    *   在隔离环境中测试漏洞利用代码。


**项目地址:** [kit4py/CVE-2024-41570](https://github.com/kit4py/CVE-2024-41570)

**漏洞详情:** [CVE-2024-41570](https://nvd.nist.gov/vuln/detail/CVE-2024-41570)