## CVE-2019-19781-Citrix ADC/Gateway 目录遍历

**漏洞编号:** CVE-2019-19781

**漏洞类型:** 目录遍历

**影响应用:** Citrix ADC/Gateway

**危害等级:** 高危，可能导致敏感信息泄露和远程代码执行

**影响版本:** 10.5, 11.1, 12.0, 12.1, and 13.0

**利用条件:** 需要网络可达，目标系统存在漏洞

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-19781 是 Citrix Application Delivery Controller (ADC) 和 Gateway 产品中的一个目录遍历漏洞。攻击者可以通过构造恶意的URL，绕过身份验证，读取服务器上的任意文件，甚至执行任意代码。

**有效性评估：**

根据漏洞库信息、搜索引擎结果以及提供的漏洞利用代码（DFIR Notes），该漏洞的POC是有效的，并且已经被广泛利用。搜索结果显示该漏洞已被积极利用，多个安全厂商发布了相关的分析报告和检测工具。

**投毒风险评估：**

提供的代码主要是DFIR (Digital Forensics and Incident Response) Notes，旨在帮助安全人员检测和分析受影响的系统，而不是直接的攻击代码。其中包含了一些检测compromise indicators的命令和步骤，例如检查HTTP日志、修改的文件、cronjobs、运行的进程以及bash历史等。也提到Fireeye发布了检测工具。虽然大部分内容是用于安全分析，但也不排除作者在其中加入一些看似无害但实际有害的代码，所以存在一定的投毒风险，估计为10%。

**利用方式：**

1.  **目录遍历：** 攻击者利用目录遍历漏洞，可以访问受限制的目录和文件。
2.  **读取敏感文件：** 攻击者可以读取配置文件（如smb.conf）或其他包含敏感信息的关键文件。
3.  **远程代码执行：**  攻击者可能结合其他漏洞，例如通过上传恶意文件到可执行目录下，最终实现远程代码执行。
4.  **后门植入：** 攻击者可能会在受影响的系统上植入后门，以便长期控制系统。搜索结果提到`NOTROBIN`恶意软件利用了这个漏洞，并且存在恶意行为者阻止其他成功利用该漏洞。Fireeye也检测到了利用单个`POST`请求进行漏洞利用和植入后门的攻击。

漏洞利用代码 (DFIR Notes) 提供的检测手段：

*   检查HTTP日志文件，寻找异常请求。
*   检查指定日期后修改的文件，特别是`/netscaler/portal/templates/`、`/var/tmp/netscaler/portal/templates/`和`/var/vpn/bookmark/`目录下新建的`.xml`文件。
*   检查所有用户的cronjobs，寻找可疑的定时任务。
*   检查所有运行的进程和TCP/UDP连接，寻找可疑的进程和服务。
*   检查bash历史记录，寻找可疑的命令。
*   使用Shodan搜索暴露的Citrix NetScaler实例。
*   使用`curl`命令快速判断主机是否可被利用，即 `curl 'https://host/vpn/../vpns/cfg/smb.conf' --path-as-is`。


**项目地址:** [haxrob/CVE-2019-19781](https://github.com/haxrob/CVE-2019-19781)

**漏洞详情:** [CVE-2019-19781](https://nvd.nist.gov/vuln/detail/CVE-2019-19781)