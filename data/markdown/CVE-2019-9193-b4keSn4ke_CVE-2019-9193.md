## CVE-2019-9193-PostgreSQL-Authenticated-RCE

**漏洞编号:** CVE-2019-9193

**漏洞类型:** 远程代码执行

**影响应用:** PostgreSQL

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** 9.3 - 12.3

**利用条件:** 需要有效的PostgreSQL数据库账号密码，默认开启的COPY FROM PROGRAM功能, 用户需要具有执行`pg_execute_server_program`权限或者拥有superuser权限。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2019-9193漏洞允许经过身份验证的用户通过`COPY FROM PROGRAM`命令执行任意操作系统命令。尽管PostgreSQL团队认为这并非安全漏洞，因为`COPY FROM PROGRAM`的设计目的就是允许具有特定权限的用户执行系统命令，但如果配置不当，可能导致权限提升和系统被控制。

**有效性：**
提供的PoC代码利用了`COPY FROM PROGRAM`功能，通过构造恶意的SQL语句执行系统命令。PoC代码通过`psycopg2`库连接到PostgreSQL数据库，检查数据库版本，然后创建一个临时表，利用`COPY FROM PROGRAM`执行命令，并将结果存储在临时表中，最后删除该表。根据漏洞信息和PoC代码，该漏洞利用是有效的，前提是满足利用条件。

**投毒风险：**
PoC代码本身不包含明显的投毒代码。代码逻辑清晰，主要是连接数据库、执行SQL命令。 风险来自于恶意使用者可能会修改command参数, 插入具有恶意的命令, 但这不属于投毒代码, 是使用者的责任。作者本身投毒的概率较低，可以判定为 1%。

**利用方式：**
1.  攻击者需要拥有一个有效的PostgreSQL数据库账号和密码。
2.  攻击者需要连接到PostgreSQL数据库，并且数据库的`COPY FROM PROGRAM`功能已启用(默认开启)。
3.  攻击者使用`COPY FROM PROGRAM`命令，执行恶意的系统命令。例如，通过`COPY table FROM PROGRAM 'rm -rf /'`删除服务器上的所有文件（请勿尝试），或者执行其他恶意操作。
4.  如果攻击者拥有数据库的superuser权限，那么他们可以执行任何系统命令，而不需要`pg_execute_server_program`组。

**项目地址:** [b4keSn4ke/CVE-2019-9193](https://github.com/b4keSn4ke/CVE-2019-9193)

**漏洞详情:** [CVE-2019-9193](https://nvd.nist.gov/vuln/detail/CVE-2019-9193)