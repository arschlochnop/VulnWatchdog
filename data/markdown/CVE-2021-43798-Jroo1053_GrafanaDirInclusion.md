## CVE-2021-43798 - Grafana Directory Traversal

**漏洞编号:** CVE-2021-43798

**漏洞类型:** 目录遍历

**影响应用:** Grafana

**危害等级:** 高危，可能导致敏感文件泄露

**影响版本:** 8.0.0-beta1 到 8.3.0 (未修补版本)

**利用条件:** 目标Grafana实例存在于受影响版本，并且可通过网络访问，至少安装一个插件

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-43798 是一个 Grafana 目录遍历漏洞。根据漏洞库信息和搜索结果，该漏洞存在于 Grafana 8.0.0-beta1 到 8.3.0 版本（未修补版本）。攻击者可以利用该漏洞读取 Grafana 服务器上的任意文件。

**有效性：**
提供的 POC 代码 `exploit.py` 看起来是有效的。它通过构造包含目录遍历序列（`../`）的 URL，尝试访问 Grafana 服务器上的文件。代码逻辑比较清晰，首先选择一个存在漏洞的插件，然后利用`/public/plugins/<plugin_id>/../` 构造payload,再发送GET请求，接收服务器返回的内容。

**投毒风险：**
通过查看提供的POC代码，没有发现任何明显的恶意或投毒代码。 该脚本的主要功能是读取文件，并没有发现任何尝试修改系统配置、安装后门或执行其他恶意操作的迹象。因此，投毒风险评估为 0%。测试代码也主要关注验证漏洞的读取文件功能。

**利用方式：**
利用方式如下：
1.  确定目标 Grafana 服务器的版本是否在受影响范围内（8.0.0-beta1 到 8.3.0，未修补版本）。
2.  找到一个已安装的插件ID。POC代码中包含一个插件列表`VULN_PLUGINS`，可以从中选择一个。
3.  构造包含目录遍历序列的 URL：`https://<grafana_host>/public/plugins/<plugin_id>/../../../../../../../../../../etc/passwd`。
4.  发送 HTTP GET 请求到构造的 URL。
5.  如果漏洞存在，服务器将返回所请求文件的内容（例如 `/etc/passwd`）。

综上所述，该漏洞利用的有效性较高，并且没有明显的投毒风险。攻击者可以利用该漏洞读取服务器上的敏感文件，例如配置文件、密钥等，从而可能导致更严重的后果。

**项目地址:** [Jroo1053/GrafanaDirInclusion](https://github.com/Jroo1053/GrafanaDirInclusion)

**漏洞详情:** [CVE-2021-43798](https://nvd.nist.gov/vuln/detail/CVE-2021-43798)