## CVE-2024-3400 PAN-OS GlobalProtect 任意文件创建导致命令注入

**漏洞编号:** CVE-2024-3400

**漏洞类型:** 命令注入

**影响应用:** PAN-OS GlobalProtect

**危害等级:** 严重，未授权的攻击者可以以root权限执行任意代码

**影响版本:** PAN-OS 10.2（低于10.2.9-h1），PAN-OS 11.0（低于11.0.4-h1），PAN-OS 11.1（低于11.1.2-h3）

**利用条件:** 需要目标系统配置了GlobalProtect网关或GlobalProtect门户

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-3400是一个存在于Palo Alto Networks PAN-OS软件GlobalProtect功能中的任意文件创建导致命令注入漏洞。攻击者可以通过特制的HTTP请求创建任意文件，进而执行任意命令，获得root权限。

**利用方式：**

1.  **漏洞验证：** 首先，攻击者发送一个GET请求到`/global-protect/portal/images/0xr2r.txt`，如果返回404，则表示目标系统不存在此文件，可以继续利用。
2.  **文件创建：** 攻击者发送一个POST请求到`/ssl-vpn/hipreport.esp`，并在Cookie中设置`SESSID`为`/../../../var/appweb/sslvpndocs/global-protect/portal/images/0xr2r.txt`。POST请求的内容可以为空，或者包含一些payload数据，如`user=0xr2r&portal=0xr2r&authcookie=284ad748-7ce2-4753-a39a-aa381b18cf70&domain=0xr2r&computer=0xr2r&client-ip=0xr2r&client-ipv6=0xr2r&md5-sum=0xr2r&gwHipReportCheck=0xr2r`。此操作将在目标系统的指定路径下创建文件`0xr2r.txt`。
3.  **验证文件创建：** 再次发送GET请求到`/global-protect/portal/images/0xr2r.txt`，如果返回403，则表示文件已成功创建。

根据Volexity的分析，该漏洞是由于对`/ssl-vpn/hipreport.esp`的输入验证不足造成的，允许未经身份验证的攻击者创建任意文件。通过创建恶意文件，攻击者可以进一步利用命令注入漏洞执行任意代码。

**有效性：**
提供的POC代码是有效的，它展示了如何利用该漏洞在目标系统上创建任意文件。通过创建文件，可以为进一步的攻击（例如命令注入）奠定基础。

**投毒风险：**
此POC代码中未发现明显的投毒代码。该代码主要展示了如何利用漏洞创建文件。没有发现任何尝试在目标系统上安装后门或执行恶意操作的恶意代码.可以认为投毒风险为0%。但是，应该谨慎对待任何来自不受信任来源的代码，并进行彻底的审查。

**项目地址:** [0xr2r/CVE-2024-3400-Palo-Alto-OS-Command-Injection](https://github.com/0xr2r/CVE-2024-3400-Palo-Alto-OS-Command-Injection)

**漏洞详情:** [CVE-2024-3400](https://nvd.nist.gov/vuln/detail/CVE-2024-3400)