## CVE-2024-6387-OpenSSH-竞争条件

**漏洞编号:** CVE-2024-6387

**漏洞类型:** 竞争条件

**影响应用:** OpenSSH

**危害等级:** 高危，可能导致远程代码执行或拒绝服务

**影响版本:** 8.5p1 <= version <= 9.7p1

**利用条件:** 需要目标系统运行OpenSSH服务，且版本在受影响范围内

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2024-6387（又名regreSSHion）是OpenSSH服务器中的一个竞争条件漏洞，它允许未经身份验证的远程攻击者执行任意代码或造成拒绝服务。

**有效性：**
根据漏洞库信息、搜索引擎结果和漏洞利用代码判断，该漏洞是真实存在的，并且存在公开的PoC，因此有效性较高。

**投毒风险：**
提供的PoC代码（CVE-2024-6387_Check.py）的主要目的是检测目标是否存在该漏洞，而不是利用该漏洞。PoC 通过banner信息判断是否存在漏洞版本。
代码中存在极低的投毒风险。主要集中在以下的可能性：

*   **DNS解析的潜在风险：** PoC脚本包含DNS解析功能(`dns_resolve`)，如果攻击者控制了DNS服务器，则可能将目标IP解析到恶意服务器，从而进行中间人攻击。这是一个间接的投毒方式，依赖于外部环境的配合。
*   **结果误判：**虽然概率很低,如果修改PoC代码，使其在特定情况下报告目标为 vulnerable，即使实际上并非如此，攻击者可以利用此信息针对性地进行攻击。

综合来看，代码本身直接包含恶意payload的可能性较低，更多的是潜在的、间接的风险。因此，投毒风险估计为1%。

**利用方式：**
1.  **漏洞原理：** 该漏洞源于OpenSSH处理信号的方式存在竞争条件。当客户端尝试连接到服务器时，如果身份验证失败，服务器会发送一个信号给处理连接的进程。由于竞争条件，这个信号可能在不安全的时间点被处理，导致内存损坏或代码执行。
2.  **利用步骤：**
    *   攻击者向目标服务器发起SSH连接，但故意不进行身份验证（或提供错误的凭据）。
    *   攻击者利用竞争条件，在身份验证失败后，诱使服务器处理信号，从而触发漏洞。
    *   如果成功，攻击者可能能够执行任意代码，从而控制目标服务器。
3.  **影响：** 成功利用此漏洞可能导致完全控制受影响的系统，包括读取敏感信息、修改系统配置以及安装恶意软件。
4.  **缓解措施：** 及时更新OpenSSH版本是缓解此漏洞最有效的方法。也可以考虑禁用`LoginGraceTime`参数，但这样做可能会影响正常用户的连接体验。


**项目地址:** [xaitax/CVE-2024-6387_Check](https://github.com/xaitax/CVE-2024-6387_Check)

**漏洞详情:** [CVE-2024-6387](https://nvd.nist.gov/vuln/detail/CVE-2024-6387)