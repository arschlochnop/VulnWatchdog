## CVE-2016-5195 - Dirty COW 本地提权漏洞

**漏洞编号:** CVE-2016-5195

**漏洞类型:** 本地提权

**影响应用:** Linux Kernel

**危害等级:** 高危，可导致本地用户获取 root 权限

**影响版本:** Linux kernel 2.x through 4.x before 4.8.3

**利用条件:** 本地用户权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

Dirty COW (CVE-2016-5195) 是 Linux 内核中的一个竞争条件漏洞，存在于 `mm/gup.c` 文件中。它允许本地用户利用 copy-on-write (COW) 机制中的不正确处理，写入只读内存映射，从而获得提升的权限。

**有效性：**

提供的 POC 代码看起来有效。它利用了 `/proc/self/mem` 来写入内存。通过 `madvise` 系统调用触发 COW 机制，然后利用多线程来竞争性地写入内存。

**投毒风险：**

代码中存在一定的投毒风险，约为10%。 虽然主要功能是利用 Dirty COW 漏洞，但存在以下潜在风险：

*   **依赖特定环境：** 代码依赖于特定的 Android NDK 环境和 ADB 工具。如果在非目标环境中编译和运行，可能导致意外行为。
*   **修改系统文件风险：**  如果目标文件选取不当，例如选取关键系统文件，即使成功提权，也可能导致系统崩溃或者不稳定。
*   **竞态条件利用：** 虽然漏洞本身就是竞态条件，但利用代码中的竞态条件可能因系统负载和其他因素而导致利用失败或产生未定义行为。

**利用方式：**

1.  **编译 POC 代码：** 使用 Android NDK 编译 `dcow.c` 和 `run-as.c`。
2.  **推送文件到设备：** 使用 ADB 将编译后的可执行文件 (`dirtycow`, `run-as`) 和 `test.sh` 脚本推送到 Android 设备的 `/data/local/tmp/` 目录。
3.  **修改权限：** 使用 ADB shell 修改这些文件的权限为可执行。
4.  **运行 POC：** 运行 `test.sh` 脚本或直接运行 `dirtycow` 可执行文件，指定要修改的目标文件和内容。
5.  **提权：** POC 通过修改 `run-as` 程序，然后覆盖系统中的 `procrank` 程序来获取 root 权限。

**总结：**

此 POC 代码是针对 Dirty COW 漏洞的利用，旨在通过竞争性写入只读内存映射来提升权限。虽然主要功能是提权，但是存在小概率的投毒风险，需要谨慎使用，避免选取关键系统文件。

**项目地址:** [DanielEbert/CVE-2016-5195](https://github.com/DanielEbert/CVE-2016-5195)

**漏洞详情:** [CVE-2016-5195](https://nvd.nist.gov/vuln/detail/CVE-2016-5195)