## CVE-2021-1675 PrintNightmare Windows Print Spooler RCE

**漏洞编号:** CVE-2021-1675

**漏洞类型:** 远程代码执行

**影响应用:** Windows Print Spooler Service

**危害等级:** 高危，允许攻击者以SYSTEM权限执行任意代码

**影响版本:** 受影响的Windows版本包括Windows 7到Windows 10的多个版本，以及Windows Server 2008到Windows Server 2019的多个版本 (参考漏洞库信息)

**利用条件:** 默认情况下，Print Spooler服务运行，且未经修补 (参考搜索引擎结果)

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2021-1675，又名PrintNightmare，是一个Windows Print Spooler服务中的远程代码执行漏洞。 

**有效性：**
根据漏洞库信息、搜索引擎结果和提供的PoC代码，可以判断此漏洞是有效的。搜索引擎结果中多个链接表明存在公开的PoC利用代码，且该漏洞已被CISA列入已知被利用漏洞目录（KEV）。

**投毒风险：**
提供的PowerShell PoC代码的主要功能是利用PrintNightmare漏洞在目标系统上创建一个新的本地管理员用户，并将其添加到本地管理员组。此代码中存在投毒的可能性很低，因为其主要功能是添加用户，而非植入恶意代码，同时会尝试从内存加载DLL。虽然该DLL内容经过编码，但编码本身是为了方便传输和存储，并非混淆恶意行为，因此可以认为是良性的。只有在-DLL参数传递恶意dll的情况下，才有投毒风险。风险评估为1%。

**利用方式：**
此PoC利用方式：
1.  **DLL注入：** 漏洞利用的核心在于向Print Spooler服务注入恶意DLL。通过`AddPrinterDriverEx`函数添加一个恶意的打印机驱动，该驱动指向攻击者控制的DLL文件。
2.  **SYSTEM权限：** 由于Print Spooler服务以SYSTEM权限运行，注入的DLL也会以SYSTEM权限执行，从而允许攻击者完全控制受影响的系统。
3.  **用户创建：**  提供的PoC代码默认使用内置的payload（`get_nightmare_dll`函数）创建一个新的本地用户（默认用户名为`adm1n`，密码为`P@ssw0rd`），并将其添加到本地管理员组。攻击者可以自定义用户名和密码，或者指定自己的DLL执行任意代码。
4.  **远程利用：** 虽然PoC可能在本地执行，但Print Spooler服务通常也监听网络连接，这使得该漏洞可以通过网络进行远程利用。

总的来说，这是一个高危漏洞，利用起来相对简单，攻击者可以利用它获得受害者系统的完全控制权。

**项目地址:** [whoami-chmod777/CVE-2021-1675---PrintNightmare-LPE-PowerShell-](https://github.com/whoami-chmod777/CVE-2021-1675---PrintNightmare-LPE-PowerShell-)

**漏洞详情:** [CVE-2021-1675](https://nvd.nist.gov/vuln/detail/CVE-2021-1675)