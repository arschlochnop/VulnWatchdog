## CVE-2019-14287-Sudo权限提升

**漏洞编号:** CVE-2019-14287

**漏洞类型:** 权限提升

**影响应用:** Sudo

**危害等级:** 高危，允许普通用户以root权限执行命令

**影响版本:** < 1.8.28

**利用条件:** 攻击者需要拥有Runas ALL sudoer账户权限，但被禁止以root用户执行命令

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2019-14287 允许具有 `Runas ALL` 权限但被显式禁止以 `root` 身份运行命令的用户绕过此限制，通过指定用户ID `-u \#$((0xffffffff))` 或 `-u -1`来执行命令。该漏洞存在于Sudo 1.8.28之前的版本中。

**有效性：**

根据漏洞信息和搜索引擎结果，该漏洞是真实存在的，并且POC代码（Dockerfile）通过构建包含易受攻击的Sudo版本的Docker镜像来验证漏洞。Dockerfile中配置了`uogctf`用户，并赋予其`ALL=(ALL,!root)`权限，这正是触发漏洞的前提条件。通过SSH登录到容器，然后使用特定的`sudo`命令可以绕过`!root`限制，以`root`权限执行命令，从而读取`/root/root.txt`文件，证明漏洞利用成功。

**投毒风险：**

Dockerfile中存在潜在的投毒风险的可能性较低，约5%。
* 代码主要目的是为了复现CVE-2019-14287漏洞，提供一个可利用的环境。
*  Dockerfile中设置了一个flag文件`/root/root.txt`，仅用于演示漏洞，并非恶意代码。
* 修改了ssh配置,允许使用密码登录,但只是为了方便漏洞复现,不是后门.
* 虽然设置了默认密码，但这属于漏洞演示环境的一部分，方便用户快速验证，本身不是为了植入恶意代码

总体来说，该Dockerfile更侧重于漏洞的复现和演示，而不是植入恶意后门。

**利用方式：**

1.  攻击者首先需要获得一个具有`Runas ALL`权限，但被禁止以`root`身份运行命令的账号。例如，在`/etc/sudoers`文件中存在类似`username ALL=(ALL,!root) /bin/command`的配置。
2.  攻击者使用`sudo -u \#$((0xffffffff)) <command>`或`sudo -u -1 <command>`命令来执行目标命令。Sudo在处理`-u`选项时存在缺陷，会将此ID视为未指定用户，从而绕过`!root`限制。
3.  通过上述方式，攻击者可以以`root`权限执行任意命令，从而提升权限。

**项目地址:** [CMNatic/Dockerized-CVE-2019-14287](https://github.com/CMNatic/Dockerized-CVE-2019-14287)

**漏洞详情:** [CVE-2019-14287](https://nvd.nist.gov/vuln/detail/CVE-2019-14287)