## CVE-2024-10915 - D-Link NAS account_mgr.cgi cgi_user_add OS Command Injection

**漏洞编号:** CVE-2024-10915

**漏洞类型:** OS Command Injection

**影响应用:** D-Link DNS-320, DNS-320LW, DNS-325, DNS-340L

**危害等级:** 高危，允许未经身份验证的远程攻击者执行任意系统命令。

**影响版本:** 固件版本 <= 20241028 (DNS-320, DNS-320LW, DNS-325, DNS-340L)

**利用条件:** 目标设备可网络访问，且/cgi-bin/account_mgr.cgi接口可用。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-10915 漏洞存在于 D-Link NAS 设备的 `/cgi-bin/account_mgr.cgi?cmd=cgi_user_add` 接口中。攻击者可以通过操纵 `group` 参数进行操作系统命令注入。具体而言，攻击者可以在 `group` 参数中插入恶意命令，这些命令会被设备执行。

**漏洞利用方式：**

1.  攻击者构造包含恶意命令的 HTTP GET 请求，目标是`/cgi-bin/account_mgr.cgi?cmd=cgi_user_add` 接口，并将恶意命令注入到 `group` 参数中。例如：

    ```
    http://<目标IP>/cgi-bin/account_mgr.cgi?cmd=cgi_user_add&group=';id;'
    ```
2.  设备收到请求后，由于未正确过滤 `group` 参数，会将恶意命令传递给操作系统执行。
3.  攻击者可以通过此漏洞在设备上执行任意命令，例如获取敏感信息、修改系统配置、植入后门等。

**有效性：**

提供的漏洞利用代码 `dlink_nas_rce_cve_2024_10915.py` 经过分析，能够有效利用该漏洞。代码使用 `requests` 库发送 HTTP 请求，并在 URL 中构造恶意 `group` 参数，从而实现远程命令执行。

**投毒风险：**

虽然代码的主要功能是利用漏洞，但仍然存在一定的投毒风险。代码中存在以下潜在风险点：

*   **代理支持：** 代码支持使用 HTTP 代理，攻击者可能通过代理服务器隐藏真实 IP 地址，增加追踪难度。
*   **输出保存：** 代码可以将 HTTP 响应保存到文件中，攻击者可能利用此功能窃取敏感信息。
*   **User-Agent 伪造:** User-Agent可以用来伪装客户端. 增加分析难度

总的来说，投毒风险较低，约为5%，主要集中在增加攻击的隐蔽性和数据窃取方面。该数值主要考虑的是通过代理等方式来隐藏攻击来源，以及保存命令执行结果，虽然在`requests`发送数据中增加恶意代码执行风险较低. 因此判定投毒风险较低.

**项目地址:** [r0otk3r/CVE-2024-10915](https://github.com/r0otk3r/CVE-2024-10915)

**漏洞详情:** [CVE-2024-10915](https://nvd.nist.gov/vuln/detail/CVE-2024-10915)