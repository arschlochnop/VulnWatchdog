## CVE-2024-42327-Zabbix-SQL注入

**漏洞编号:** CVE-2024-42327

**漏洞类型:** SQL注入

**影响应用:** Zabbix

**危害等级:** 高危，可能导致数据泄露、权限提升和远程代码执行

**影响版本:** 6.0.0-6.0.31, 6.4.0-6.4.16, 7.0.0-7.0.1

**利用条件:** 需要Zabbix前端的非管理员用户账号，且该账号具备API访问权限。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2024-42327是Zabbix前端API中user.get方法存在的一个SQL注入漏洞。具有API访问权限的非管理员用户可以通过构造恶意的SQL语句，注入到`selectRole`参数中，从而执行任意SQL查询。该漏洞位于`CUser`类的`addRelatedObjects`函数中，该函数被`CUser.get`函数调用，而`CUser.get`函数对具有API访问权限的任何用户都可用。

**有效性：**
提供的PoC代码是有效的。它首先通过`user.login`方法获取一个API会话令牌，然后使用该令牌调用`user.get`方法，并在`selectRole`参数中注入一个延时注入payload (`pg_sleep()`)。如果响应时间超过预期的延迟，则表示目标服务器存在SQL注入漏洞。PoC代码还尝试从Users表提取信息。

**投毒风险：**
该PoC代码本身旨在验证漏洞的存在并提取用户信息。主要风险来自代码仓库本身。虽然PoC本身没有明显的恶意代码，但是仍然存在一些极低的风险：

*   **依赖风险：**  PoC代码依赖于`requests`模块，如果攻击者替换了`requests`模块或通过其他方式引入了恶意依赖项，则可能导致代码执行。

*   **目标攻击：**  针对特定目标，攻击者可能会修改PoC代码，例如，硬编码特定的数据库凭据或添加后门。

因此，综合评估，投毒风险较低，约为1%。

**利用方式：**
1.  **身份验证：**  攻击者需要一个Zabbix前端的非管理员用户账号，且该账号具备API访问权限。
2.  **获取API令牌：** 使用用户凭据通过`user.login`方法获取API会话令牌。
3.  **SQL注入：**  构造包含恶意SQL payload的JSON请求，通过`user.get`方法，在`selectRole`参数中注入SQL语句。例如，可以使用延时注入来判断漏洞是否存在。
4.  **数据提取/权限提升：**  利用SQL注入漏洞，攻击者可以读取数据库中的敏感数据，例如用户凭据、配置信息等。攻击者还可以尝试通过SQL注入来提升权限，例如创建管理员账号。
5.  **远程代码执行：**  在某些情况下，攻击者可能可以利用SQL注入漏洞执行任意代码。例如，如果Zabbix服务器的数据库用户具有文件写入权限，攻击者可以尝试将恶意代码写入到服务器的文件系统中，然后通过其他方式执行该代码。

**项目地址:** [depers-rus/CVE-2024-42327](https://github.com/depers-rus/CVE-2024-42327)

**漏洞详情:** [CVE-2024-42327](https://nvd.nist.gov/vuln/detail/CVE-2024-42327)