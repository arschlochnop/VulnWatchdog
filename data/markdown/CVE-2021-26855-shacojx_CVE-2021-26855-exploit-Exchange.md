## CVE-2021-26855 Microsoft Exchange Server 远程代码执行漏洞（ProxyLogon）

**漏洞编号:** CVE-2021-26855

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Microsoft Exchange Server

**危害等级:** 高危，可导致服务器完全控制

**影响版本:** 受影响的Exchange Server 2013, 2016, 2019 Cumulative Updates

**利用条件:** 需要能够访问 Exchange Server 的 OWA 接口。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-26855 是 Microsoft Exchange Server 中的一个服务器端请求伪造 (SSRF) 漏洞，是 ProxyLogon 攻击链的一部分。攻击者可以利用此漏洞发送任意 HTTP 请求并作为 Exchange 服务器进行身份验证。从搜索引擎结果和漏洞库信息可以得知，这是一个被广泛利用的漏洞，存在公开的PoC，并且被CISA添加到已知被利用的漏洞目录中。 

**漏洞利用方式:**

1.  **SSRF (CVE-2021-26855):** 利用 SSRF 漏洞绕过身份验证。
2.  **构造请求:** 攻击者首先发送一个包含特定 Cookie 的 GET 请求，利用 SSRF 漏洞。
3.  **NTLM 认证:** 使用 NTLM 认证绕过。
4.  **获取 FQDN:** 通过 NTLM type2 协议获取服务器的 FQDN (Fully Qualified Domain Name)。
5.  **发送恶意 XML:** 构造恶意的 XML 数据，通过 POST 请求发送到 Exchange Web Services (EWS) 端点，利用后端组件处理 XML 时存在的漏洞执行任意代码。  
6.  **用户枚举:**  PoC 代码还包含用户枚举的功能，增加了攻击面。

**有效性：**

提供的 Go 代码是一个可用的 PoC。它包含了漏洞验证、NTLM 认证和发送恶意 XML 数据的步骤。代码结构清晰，逻辑完整，可以直接用于检测和利用该漏洞。

**投毒风险：**

虽然代码看起来主要实现了漏洞利用的功能，但仍存在一定投毒风险的可能性：
* 用户枚举模块可能被滥用，用于非法收集用户信息。
* 代码中存在一些硬编码的参数和路径，可能在特定环境下不可用，需要使用者修改，可能存在被诱导修改恶意代码。
* 风险评估为 10%，因为代码的主要功能是漏洞利用，而非恶意行为，但是存在被滥用和修改的潜在风险。

**项目地址:** [shacojx/CVE-2021-26855-exploit-Exchange](https://github.com/shacojx/CVE-2021-26855-exploit-Exchange)

**漏洞详情:** [CVE-2021-26855](https://nvd.nist.gov/vuln/detail/CVE-2021-26855)