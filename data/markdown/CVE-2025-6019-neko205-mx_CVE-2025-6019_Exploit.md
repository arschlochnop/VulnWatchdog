## CVE-2025-6019-libblockdev-udisks-LPE

**漏洞编号:** CVE-2025-6019

**漏洞类型:** 本地提权

**影响应用:** libblockdev/udisks

**危害等级:** 高危，可导致本地用户提升为root权限

**影响版本:** Red Hat Enterprise Linux 7, 8, 9, 10 (可能影响其他Linux发行版)

**利用条件:** 需要本地用户具有 'allow_active' 权限，并且系统运行udisks daemon。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于libblockdev与udisks交互过程中，利用方式如下：

1.  **漏洞描述：** CVE-2025-6019 允许具有 'allow_active' 权限的本地用户通过利用 udisks daemon 提升为 root 权限。攻击者可以创建一个特制的 XFS 镜像，其中包含一个 SUID-root shell，然后诱使 udisks 调整其大小。这将以 root 权限挂载恶意文件系统，从而允许攻击者执行 SUID-root shell 并获得对系统的完全控制。

2.  **利用方式：**
    *   攻击者首先使用`1.sh`脚本创建一个恶意的XFS镜像 (`xfs.image`)，并在其中包含一个 SUID-root shell。
    *   然后，攻击者将此镜像传输到目标系统。
    *   在目标系统上，攻击者运行`2.sh`脚本。
    *   `2.sh`脚本首先尝试使用`udisksctl loop-setup`将XFS镜像设置为loop设备。
    *   脚本通过`gdbus call`调用 UDisks2 的 `Resize` 方法，触发漏洞。udisks 可能会尝试在没有正确安全标志的情况下调整恶意镜像的大小，从而允许执行 SUID-root shell。
    *   脚本随后搜索并执行该 SUID-root shell，实现提权。

3.  **有效性：** 提供的POC代码看起来是有效的。`1.sh` 创建包含 SUID bash 的镜像， `2.sh` 利用 `udisksctl loop-setup` 挂载镜像，然后使用 `gdbus call` 调用 `Resize` 函数尝试触发漏洞，最后查找并执行 SUID bash。

4.  **投毒风险：** 该仓库中存在一定投毒风险（约10%）。`1.sh`脚本中没有明显的恶意代码，主要负责创建XFS镜像。`2.sh`脚本中的风险在于，攻击者可能会在while循环中执行其他恶意命令，而不是简单的 sleep。另外，攻击者也可以在创建的xfs.image中包含其他后门程序，在提权后执行。`README.md` 没有发现可疑之处。

5.  **缓解措施：** 更新 libblockdev 和 udisks2 软件包至已修复版本。

**项目地址:** [neko205-mx/CVE-2025-6019_Exploit](https://github.com/neko205-mx/CVE-2025-6019_Exploit)

**漏洞详情:** [CVE-2025-6019](https://nvd.nist.gov/vuln/detail/CVE-2025-6019)