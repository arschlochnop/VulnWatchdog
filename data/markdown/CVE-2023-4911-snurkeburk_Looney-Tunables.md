## CVE-2023-4911 - Glibc ld.so 缓冲区溢出

**漏洞编号:** CVE-2023-4911

**漏洞类型:** 本地权限提升

**影响应用:** Glibc

**危害等级:** 高危，可导致本地权限提升为root

**影响版本:** 2.34 到 2.39 之前

**利用条件:** 本地用户，目标系统使用存在漏洞的Glibc版本，且程序具有SUID权限。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2023-4911 漏洞是 Glibc 动态链接器 ld.so 在处理 GLIBC_TUNABLES 环境变量时发生的缓冲区溢出。该漏洞允许本地攻击者通过精心构造的 GLIBC_TUNABLES 环境变量，在启动具有 SUID 权限的二进制文件时执行具有提升权限的代码。

**有效性：**
根据漏洞描述、搜索结果和提供的POC代码，该漏洞利用是有效的。搜索结果中多个链接（如Qualys博客）确认了该漏洞的存在和利用方式。提供的C代码通过构造特定的 GLIBC_TUNABLES 环境变量来触发缓冲区溢出，从而实现权限提升。

**投毒风险：**
提供的POC代码没有明显的投毒风险。代码的主要功能是构建恶意的环境变量并执行 `execve` 调用。代码中存在一些调试输出（注释掉的 `printf` 语句），但是没有发现任何尝试执行恶意操作或植入后门的代码。`printf`可以忽略。

**利用方式：**
1.  **确定目标：**  选择一个具有 SUID 权限的二进制文件。示例代码中使用了`/usr/bin/su`。
2.  **构造环境变量：**  利用 POC 代码构造 GLIBC_TUNABLES 环境变量，该环境变量包含精心设计的字符串，用于溢出缓冲区。代码中使用 `filler`，`kv`，`filler2` 和 `dt_rpath` 变量来填充和控制溢出。
3.  **执行 SUID 程序：**  使用 `execve` 系统调用，将构造好的环境变量传递给 SUID 程序。这将导致 `ld.so` 在加载程序时解析环境变量，触发缓冲区溢出，并允许攻击者执行任意代码。
4. 代码中通过多次 `fork` 和 `execve` 循环尝试提权，但实际上，因为每次 `execve` 调用都会替换掉当前进程的镜像，所以这个循环并没有实际意义。单次调用即可。 

**POC代码分析：**
*   `filler`、`kv` 和 `filler2` 变量用于填充 GLIBC_TUNABLES 环境变量，并触发缓冲区溢出。
*   `dt_rpath` 变量用于覆盖某些地址，以控制程序的执行流程。
*   `envp` 数组包含了所有环境变量，包括精心构造的 GLIBC_TUNABLES 环境变量。
*   代码通过 `execve` 调用启动 `/usr/bin/su` 程序，并将 `envp` 数组作为环境变量传递给它。通过重定向标准输出和标准错误到/dev/null，避免了程序输出干扰。

**项目地址:** [snurkeburk/Looney-Tunables](https://github.com/snurkeburk/Looney-Tunables)

**漏洞详情:** [CVE-2023-4911](https://nvd.nist.gov/vuln/detail/CVE-2023-4911)