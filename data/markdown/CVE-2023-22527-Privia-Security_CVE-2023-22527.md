## CVE-2023-22527 Atlassian Confluence OGNL注入 RCE

**漏洞编号:** CVE-2023-22527

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Atlassian Confluence Data Center/Server

**危害等级:** 高危，允许未授权用户执行任意代码

**影响版本:** 8.0.0 <= version <= 8.5.3

**利用条件:** 目标Confluence实例版本在受影响范围内，且可以通过网络访问。

**POC 可用性:** 是

**投毒风险:** 20%

## 详情

CVE-2023-22527是一个存在于Atlassian Confluence Server和Data Center的模板注入漏洞。未经身份验证的攻击者可以利用此漏洞在受影响的实例上实现远程代码执行。漏洞源于OGNL表达式注入。根据搜索结果，该漏洞已被广泛利用，攻击者使用此漏洞部署恶意软件，例如Elpaco Ransomware和Cryptojacking程序。

**有效性评估：**

提供的PoC代码通过构造一个包含恶意OGNL表达式的HTTP POST请求，利用`text-inline.vm`模板文件中的漏洞，实现在Confluence服务器上执行任意命令。PoC中通过设置HTTP响应头'Cmd'来回显命令执行的结果（`whoami`）。由于漏洞利用方式简单且危害巨大，该PoC的有效性非常高。

**投毒风险评估：**

分析提供的PoC代码，未发现明显的恶意代码或后门。但需要注意以下几点：

*   **供应链风险：** PoC依赖于第三方库`github.com/fatih/color`，虽然该库本身看起来无害，但存在供应链投毒的潜在风险。
*   **命令执行风险：** PoC允许执行任意命令，这意味着如果攻击者修改PoC中的命令，可能会执行恶意操作，例如下载和执行恶意软件。
*   **依赖文件风险:** `cve-2023-22527.exe`为编译后的二进制文件,增加了投毒的风险。

基于以上分析，投毒风险评估为20%。主要风险在于使用者使用编译后的文件以及修改PoC执行恶意命令的可能性。

**利用方式：**

1.  攻击者构造一个包含恶意OGNL表达式的HTTP POST请求。
2.  请求的目标URL是受影响Confluence实例的`/template/aui/text-inline.vm`端点。
3.  恶意OGNL表达式被注入到`label`参数中。
4.  Confluence服务器解析该OGNL表达式，导致远程代码执行。
5.  执行结果通过HTTP响应头返回。

**项目地址:** [Privia-Security/CVE-2023-22527](https://github.com/Privia-Security/CVE-2023-22527)

**漏洞详情:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)