## CVE-2023-4911-Glibc-本地权限提升

**漏洞编号:** CVE-2023-4911

**漏洞类型:** 缓冲区溢出

**影响应用:** Glibc

**危害等级:** 高危，本地权限提升至root

**影响版本:** 2.34 直到 2.39之前

**利用条件:** 本地访问，目标系统glibc版本在受影响范围内，存在SUID程序

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-4911是Glibc动态链接器ld.so中发现的缓冲区溢出漏洞。该漏洞位于处理GLIBC_TUNABLES环境变量的过程中。攻击者可以利用精心构造的GLIBC_TUNABLES环境变量，在启动具有SUID权限的二进制文件时，以提升的权限执行代码，从而获得root权限。

**有效性：**
根据漏洞库信息、搜索引擎结果以及提供的PoC代码，可以判断该漏洞利用的有效性较高。漏洞库信息将该漏洞评级为“高危”，并提供了详细的描述。搜索引擎结果中包含大量关于该漏洞的分析文章和利用示例，表明该漏洞已经得到了广泛的关注和研究。提供的PoC代码也验证了该漏洞的可利用性。PoC利用了`GLIBC_TUNABLES`环境变量的解析过程中的缓冲区溢出，通过精心构造该环境变量，覆盖某些关键函数，从而执行恶意代码，最终获得root权限。

**投毒风险：**
PoC代码中存在极低的投毒风险(5%)。原因是：
1.  **修改libc.so.6：**  PoC代码首先读取`/lib/x86_64-linux-gnu/libc.so.6`的内容，找到`__libc_start_main`函数的位置，然后用shellcode覆盖该函数的一部分。这是一种常见的利用方法，目的是在程序启动时劫持控制流。虽然这步修改看似危险，但PoC是在临时目录下创建了一个修改后的`libc.so.6`，并没有直接修改系统文件。
2.  **创建临时目录和文件：**  PoC代码创建了一个名为`"`的目录，并将修改后的`libc.so.6`复制到该目录下。目录名使用了引号，这可能是为了绕过某些安全检查。这部分代码的行为是可疑的，但也属于PoC利用的一部分，目的是让`ld.so`加载修改后的libc。
3.  **环境变量设置：**  PoC代码设置了大量的`GLIBC_TUNABLES`环境变量，以及一些其他的环境变量。这些环境变量的设置是漏洞利用的关键，目的是触发缓冲区溢出，并覆盖内存中的某些关键位置。虽然环境变量看起来很复杂，但它们都是漏洞利用所必需的。

**利用方式：**
该漏洞的利用方式如下：
1.  **利用GLIBC_TUNABLES环境变量：**  利用`GLIBC_TUNABLES`环境变量处理过程中的缓冲区溢出漏洞。
2.  **构造恶意环境变量：**  构造恶意的`GLIBC_TUNABLES`环境变量，覆盖内存中的某些关键位置。
3.  **劫持控制流：**  通过覆盖内存中的函数指针等关键数据，劫持程序的控制流。
4.  **执行恶意代码：**  执行事先准备好的shellcode，获得root权限。
5.  **目标程序：**  需要存在SUID权限的程序，例如PoC中使用的`/usr/bin/su`。

**项目地址:** [silent6trinity/looney-tuneables](https://github.com/silent6trinity/looney-tuneables)

**漏洞详情:** [CVE-2023-4911](https://nvd.nist.gov/vuln/detail/CVE-2023-4911)