## CVE-2024-6387-OpenSSH-竞争条件

**漏洞编号:** CVE-2024-6387

**漏洞类型:** 竞争条件

**影响应用:** OpenSSH

**危害等级:** 高危，可能导致远程代码执行或拒绝服务

**影响版本:** 8.5p1 <= version <= 9.7p1

**利用条件:** 需要目标系统运行受影响的OpenSSH版本，且攻击者能够建立SSH连接

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-6387（regreSSHion）是OpenSSH服务器(sshd)中的一个安全回归漏洞，存在于glibc-based Linux系统。该漏洞源于信号处理程序中的竞争条件，可能导致sshd以不安全的方式处理某些信号。未经身份验证的远程攻击者可以通过在设定的时间内未能通过身份验证来触发此漏洞。该漏洞利用代码尝试通过大量的连接请求触发竞争条件，通过调整glibc基地址和定时参数绕过ASLR，将恶意代码注入到堆中，最终实现以root权限远程代码执行。

有效性：根据漏洞信息和搜索结果，此POC代码具备一定的有效性，但成功利用需要满足特定条件，例如目标系统使用glibc，以及OpenSSH版本在受影响范围内。同时，漏洞利用的成功率受到系统负载、网络延迟等因素的影响，需要进行大量的尝试。

投毒风险：POC代码中存在一定的投毒风险。虽然POC代码的主要目的是利用已知的漏洞，但攻击者可能在代码中加入恶意功能，例如植入后门、收集敏感信息等。例如，shellcode 部分是明显的注入点。风险评定为10%，主要基于以下几点：
1.  **Shellcode 替换：** 代码明确指出 `shellcode` 变量是占位符，需要替换为实际的 shellcode。如果用户不小心使用了包含恶意指令的 shellcode，则可能导致投毒。
2.  **glibc 基地址猜测：** 虽然代码尝试多个 glibc 基地址，但如果攻击者预先知道目标系统的 glibc 地址，则可以修改 `GLIBC_BASES` 数组以提高利用成功率，同时也可能引入恶意地址。
3.  **Timing 参数调整：** 代码中的 `usleep` 函数用于控制连接尝试之间的延迟。攻击者可以通过调整这些参数来优化漏洞利用，但也可能引入导致拒绝服务 (DoS) 的参数。
4.  **编译选项：**POC 需要编译，攻击者可以在编译时添加额外的恶意编译选项，例如禁用安全特性等。
5.  **作者本身:** 仓库作者有投毒行为.

利用方式：
1.  攻击者首先需要确定目标系统是否运行受影响的OpenSSH版本，以及是否基于glibc。
2.  攻击者发起大量的SSH连接请求，尝试触发竞争条件。
3.  攻击者利用精心构造的数据包覆盖堆上的特定内存区域，将恶意代码注入到sshd进程中。
4.  一旦恶意代码成功执行，攻击者即可获得目标系统的控制权。

**项目地址:** [Karmakstylez/CVE-2024-6387](https://github.com/Karmakstylez/CVE-2024-6387)

**漏洞详情:** [CVE-2024-6387](https://nvd.nist.gov/vuln/detail/CVE-2024-6387)