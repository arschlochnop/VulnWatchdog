## CVE-2023-5360 - Royal Elementor Addons and Templates Arbitrary File Upload

**漏洞编号:** CVE-2023-5360

**漏洞类型:** 任意文件上传

**影响应用:** Royal Elementor Addons and Templates

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** < 1.3.79

**利用条件:** 需要目标wordpress站点安装并启用Royal Elementor Addons and Templates插件，且版本低于1.3.79，无需身份验证即可利用。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2023-5360漏洞是Royal Elementor Addons and Templates WordPress插件中存在的一个未经身份验证的任意文件上传漏洞。该漏洞允许未经身份验证的用户上传任意文件，包括PHP脚本等恶意文件，从而可能导致远程代码执行。

**有效性：**
根据漏洞库信息、搜索引擎结果和提供的漏洞利用代码，可以判断该POC代码有效。漏洞库信息明确指出该插件在1.3.79之前的版本存在此漏洞，并且提供了利用的参考链接。搜索引擎结果也证实了该漏洞的存在和影响。提供的漏洞利用代码包含两个部分：`csrf.html` 和 `mass.php`。

*   `csrf.html`：这是一个 HTML 文件，包含一个用于构造和提交恶意请求的表单。攻击者可以在此页面中输入目标站点的 URL 和 nonce 值（nonce值可以通过查看网页源代码获得），然后上传恶意PHP脚本。通过该表单，可以绕过一些安全检查，从而实现任意文件上传。
*   `mass.php`：这是一个 PHP 脚本，用于批量利用该漏洞。它接受一个包含目标 URL 列表的文件作为输入，并尝试在每个目标上上传恶意PHP脚本。该脚本首先尝试从目标站点的 HTML 源代码中提取 nonce 值，然后使用该值构造并发送一个 POST 请求，将恶意文件上传到目标服务器。

**投毒风险：**
经过分析，该POC代码**未发现明显的投毒代码**。`mass.php`脚本在利用时，明确指定了上传的文件类型为`ph$p`，且包含对上传的shell内容进行了检测，限制了shell的类型。但是，需要注意的是，使用者仍需审查利用代码，以防作者后期进行恶意修改。

**利用方式：**
利用方式主要分为两种：
1.  **使用`csrf.html`进行利用**
    1.  访问`csrf.html`页面，填写目标WordPress站点的URL和有效的nonce值(通过查看网页源代码查找`var WprConfig`)。
    2.  选择要上传的恶意PHP文件（webshell），并点击“Submit”按钮。
    3.  如果上传成功，恶意PHP文件将被保存在目标服务器的某个目录下，攻击者可以通过访问该文件来执行任意代码。
2.  **使用`mass.php`进行批量利用**
    1.  创建一个包含目标WordPress站点URL列表的文本文件，每行一个URL。
    2.  将恶意PHP文件（webshell）保存为`shell.ph$p`，或者修改脚本中的路径。
    3.  运行`mass.php`脚本，指定包含目标URL列表的文本文件作为输入参数。
    4.  脚本会自动尝试在每个目标站点上上传恶意PHP文件。
    5.  如果上传成功，脚本会输出恶意PHP文件的URL，攻击者可以通过访问该URL来执行任意代码。

**项目地址:** [nastar-id/CVE-2023-5360](https://github.com/nastar-id/CVE-2023-5360)

**漏洞详情:** [CVE-2023-5360](https://nvd.nist.gov/vuln/detail/CVE-2023-5360)