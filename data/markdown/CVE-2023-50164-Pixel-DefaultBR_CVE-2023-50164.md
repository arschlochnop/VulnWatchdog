## CVE-2023-50164 - Apache Struts 文件上传路径遍历与远程代码执行

**漏洞编号:** CVE-2023-50164

**漏洞类型:** 文件上传路径遍历与远程代码执行

**影响应用:** Apache Struts

**危害等级:** 高危，可能导致服务器文件泄露，任意文件上传与远程代码执行

**影响版本:** 2.0.0 <= version <= 2.5.32, 6.0.0 <= version <= 6.3.0.1

**利用条件:** 目标系统使用存在漏洞的Apache Struts版本，且存在文件上传功能

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-50164 存在于 Apache Struts 的文件上传组件中。攻击者可以操纵文件上传参数，利用路径遍历漏洞上传恶意文件，最终导致远程代码执行。

**有效性分析：**

漏洞库信息、搜索引擎结果和提供的漏洞利用代码均表明该漏洞是真实存在的，并且存在公开可用的PoC。 Akamai Security Intelligence Group的报告表明，自漏洞公开以来，已经观察到大量的利用尝试。PoC代码中包含上传PNG图片头和WebShell代码，允许攻击者上传恶意JSP文件。

**投毒风险分析：**

PoC代码中，`exploit.py` 脚本主要功能是构造包含恶意JSP WebShell 的PNG文件，并利用路径穿越漏洞上传到服务器，从而实现远程代码执行。`README.md` 声明该exp仅用于 HackTheBox 实验环境。上传后的JSP WebShell，本身就是攻击payload，风险在于被滥用进行非法渗透测试。投毒风险较低，估计在10%左右。

**利用方式：**

1.  **路径遍历：** 攻击者通过修改上传文件的参数（例如文件名），在文件名中添加`../`等路径遍历字符，使得上传的文件可以被写入到Web服务器的任意目录中。
2.  **恶意文件上传：** 攻击者上传包含恶意代码的文件，例如JSP WebShell。通常会伪装成图片文件（例如PNG），绕过一些基本的上传检查。
3.  **远程代码执行：** 攻击者通过访问上传的恶意文件，触发其中的恶意代码，从而在Web服务器上执行任意命令。

根据提供的利用代码, 漏洞利用包含以下步骤：
    *构造包含PNG文件头的JSP WebShell。
    *通过修改multipart/form-data的boundary来绕过一些WAF的检测。
    *将恶意文件上传到服务器。
    *通过访问上传的文件来执行命令。

**项目地址:** [Pixel-DefaultBR/CVE-2023-50164](https://github.com/Pixel-DefaultBR/CVE-2023-50164)

**漏洞详情:** [CVE-2023-50164](https://nvd.nist.gov/vuln/detail/CVE-2023-50164)