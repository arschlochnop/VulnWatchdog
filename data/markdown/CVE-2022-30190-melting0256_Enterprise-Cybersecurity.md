## CVE-2022-30190 Microsoft Windows Support Diagnostic Tool (MSDT) 远程代码执行漏洞

**漏洞编号:** CVE-2022-30190

**漏洞类型:** 远程代码执行

**影响应用:** Microsoft Windows Support Diagnostic Tool (MSDT)

**危害等级:** 高危，攻击者可以执行任意代码，控制受影响的系统

**影响版本:** 受影响的Windows版本众多，详情见漏洞库信息

**利用条件:** 需要用户打开包含恶意链接或文件的应用程序（如Word）

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-30190，又名Follina，是一个存在于Microsoft Windows Support Diagnostic Tool (MSDT) 中的远程代码执行漏洞。攻击者可以通过利用URL协议从调用应用程序（例如Word）调用MSDT来触发此漏洞。攻击者可以创建一个包含恶意链接或文件的应用程序（例如Word文档），当用户打开该文件时，MSDT将被调用并执行攻击者指定的任意代码。

**有效性：**
根据漏洞库信息、搜索引擎结果和提供的POC代码，可以判断此漏洞的POC代码是有效的。搜索引擎结果中包含了大量关于此漏洞的分析、利用和修复信息，证明了该漏洞的真实性和危害性。提供的Python脚本（follina.py）能够生成包含恶意代码的Word文档，该文档在被打开时可以触发MSDT并执行攻击者指定的命令。

**投毒风险：**
POC代码中存在一定程度的投毒风险。虽然该代码的主要目的是为了验证漏洞的存在和利用方式，但攻击者可以很容易地修改该代码，使其包含恶意功能，例如：

1.  **恶意命令执行：** `command` 参数允许攻击者指定要在目标系统上执行的任意命令。如果用户不小心使用了包含恶意命令的POC代码，可能会导致系统受到损害。
2.  **反向Shell：** `--reverse` 参数允许攻击者在目标系统上创建一个反向Shell，从而可以远程控制该系统。这是一种非常危险的功能，可能会导致严重的安全问题。
3. **下载恶意可执行文件**: POC代码中会尝试从Github下载nc.exe，github连接可能会指向其他恶意地址，从而下载恶意可执行文件

综合来看，该POC代码的投毒风险约为10%，主要来自于可能被篡改的命令和潜在的恶意链接。

**利用方式：**
此漏洞的利用方式如下：

1.  **生成恶意Word文档：** 使用提供的Python脚本（follina.py）生成包含恶意链接的Word文档。该脚本会创建一个临时的HTTP服务器，用于托管一个包含MSDT协议处理程序的HTML文件。
2.  **诱骗用户打开文档：** 通过电子邮件、社交媒体或其他方式，诱骗目标用户打开恶意Word文档。
3.  **触发漏洞：** 当用户打开Word文档时，Word会尝试加载HTML文件。HTML文件中的MSDT协议处理程序会被触发，导致MSDT执行攻击者指定的命令。
4.  **执行任意代码：** 攻击者可以利用此漏洞在目标系统上执行任意代码，例如安装恶意软件、窃取敏感数据或控制系统。

总而言之，CVE-2022-30190是一个高危漏洞，攻击者可以利用它在受影响的系统上执行任意代码。用户应尽快采取必要的安全措施，例如安装补丁或禁用MSDT协议处理程序，以防止受到攻击。

**项目地址:** [melting0256/Enterprise-Cybersecurity](https://github.com/melting0256/Enterprise-Cybersecurity)

**漏洞详情:** [CVE-2022-30190](https://nvd.nist.gov/vuln/detail/CVE-2022-30190)