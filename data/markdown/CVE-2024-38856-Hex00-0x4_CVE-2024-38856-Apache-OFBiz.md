## CVE-2024-38856-Apache OFBiz-未授权访问

**漏洞编号:** CVE-2024-38856

**漏洞类型:** 未授权访问

**影响应用:** Apache OFBiz

**危害等级:** 高危，可能导致信息泄露和远程代码执行

**影响版本:** <= 18.12.14

**利用条件:** 需要目标系统开启且可网络访问

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-38856是Apache OFBiz中的一个未授权访问漏洞。未经身份验证的端点可以执行屏幕渲染代码，如果满足某些前提条件，例如屏幕定义没有明确检查用户权限。提供的Python脚本"Apache_bang.py"包含用于利用此漏洞的有效载荷。

**有效性：**

提供的漏洞利用代码似乎是有效的。它利用了`/webtools/control/main/ProgramExport`端点，该端点容易受到Groovy代码注入的影响。该脚本首先对命令进行Base64编码，然后将其转换为Unicode有效负载，并将其作为`groovyProgram`参数发送到目标。脚本能够执行系统命令，证明了漏洞的存在。

**投毒风险：**

代码包含一个`get_logo()`函数，其中包含有关作者的信息，这本身并不恶意。此外，代码包含用于验证目标的命令，然后通过解码执行进行命令执行，逻辑完整，因此没有明显的投毒迹象。 脚本中的风险主要在于其利用漏洞的能力，而不是隐藏的恶意代码。 整体投毒风险较低，估计为10%。

**利用方式：**

1.  **目标识别：** 确定运行易受攻击的Apache OFBiz版本的系统，版本必须等于或低于18.12.14。
2.  **构造有效负载：** 使用`commandEncoder`函数将要执行的命令进行Base64编码。然后，使用`payloadUnicode`函数将编码的命令转换为Unicode转义序列。例如，要执行`id`命令，该脚本首先会对其进行base64编码并添加标记，然后将编码后的结果转换为unicode格式的payload。
3.  **发送请求：** 通过HTTP POST请求将构造的有效负载发送到`/webtools/control/main/ProgramExport`端点。`groovyProgram`参数包含Unicode有效负载。
4.  **命令执行：** OFBiz服务器执行Groovy代码，执行解码后的命令。
5.  **输出提取：** 该脚本使用`extract_output`函数从服务器的响应中提取命令的输出。它查找`[result]`标记来标识输出的开始和结束。
6.  **漏洞扫描（可选）：**脚本包含`scan_vulnerability`函数，用于初步验证目标是否容易受到攻击，通过ping、wget、curl指令确认。

总而言之，提供的代码似乎是利用CVE-2024-38856漏洞的可靠PoC，允许未经身份验证的攻击者在易受攻击的Apache OFBiz实例上执行任意命令。

**项目地址:** [Hex00-0x4/CVE-2024-38856-Apache-OFBiz](https://github.com/Hex00-0x4/CVE-2024-38856-Apache-OFBiz)

**漏洞详情:** [CVE-2024-38856](https://nvd.nist.gov/vuln/detail/CVE-2024-38856)