## CVE-2020-0610 Windows Remote Desktop Gateway (RD Gateway) 远程代码执行漏洞

**漏洞编号:** CVE-2020-0610

**漏洞类型:** 远程代码执行

**影响应用:** Windows Remote Desktop Gateway (RD Gateway)

**危害等级:** 高危，未经身份验证的攻击者可远程执行任意代码

**影响版本:** Windows Server 2019, 2016, 2012, 2012 R2

**利用条件:** 目标系统启用RD Gateway服务，且攻击者能够通过RDP连接到目标系统

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-0610 是一个 Windows 远程桌面网关（RD Gateway）中的远程代码执行漏洞。未经身份验证的攻击者可以通过RDP协议发送特制的请求，从而在目标系统上执行任意代码。漏洞位于RD Gateway处理RDP数据包碎片时，当fragment_id大于64时发生OOB写操作。利用方式主要通过构造恶意RDP请求触发该漏洞。

**有效性评估：**

根据提供的漏洞信息和搜索结果，CVE-2020-0610是一个真实存在的且影响广泛的远程代码执行漏洞，微软已经发布了补丁。提供的漏洞利用代码看起来是用于学习和验证目的的，它包含PowerShell脚本用于设置环境，以及Nuclei模板用于验证漏洞。`nuclei-debug-vulnerable.txt`和`nuclei-debug-patched.txt` 显示了Nuclei模板在有漏洞和修补后的系统上的调试输出结果，因此POC具有一定的有效性。

**投毒风险分析：**

该漏洞利用代码主要包含以下部分：

*   **README.md:** 包含项目介绍，使用说明和下载链接。
*   **scripts/add-udp-3391-firewall.ps1:** 添加防火墙规则，允许UDP端口3391的入站流量，这可能是为了支持某些特定的攻击场景，但也可能被恶意使用。
*   **scripts/sanity-check.ps1:** 检查RD Gateway角色和UDP/3391防火墙规则是否存在。
*   **samples/nuclei-debug-patched.txt & samples/nuclei-debug-vulnerable.txt:** Nuclei模板的调试输出示例，用于验证漏洞。

代码主要用于漏洞验证和演示，虽然 `add-udp-3391-firewall.ps1` 脚本有潜在的风险，但总体来看，投毒的可能性较低，约为10%。

**利用方式分析：**

1.  攻击者通过RDP协议连接到目标系统的RD Gateway服务。
2.  攻击者发送特制的RDP请求，该请求包含精心构造的数据包碎片，其中`fragment_id`大于64，导致OOB写操作。
3.  OOB写操作允许攻击者覆盖内存中的数据，从而执行任意代码。
4.  攻击者可以利用此漏洞在目标系统上以SYSTEM权限执行任意代码，从而完全控制系统。


**项目地址:** [Riocipta75/lab-cve-2020-0610](https://github.com/Riocipta75/lab-cve-2020-0610)

**漏洞详情:** [CVE-2020-0610](https://nvd.nist.gov/vuln/detail/CVE-2020-0610)