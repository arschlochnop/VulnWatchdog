## CVE-2019-3396-Confluence-Server-Server-Side Template Injection

**漏洞编号:** CVE-2019-3396

**漏洞类型:** Server-Side Template Injection

**影响应用:** Atlassian Confluence Server

**危害等级:** 高危，允许远程攻击者在Confluence服务器或数据中心实例上实现路径遍历和远程代码执行

**影响版本:** 受影响版本：6.6.12之前, 6.7.0到6.12.3之前, 6.13.0到6.13.3之前, 6.14.0到6.14.2之前

**利用条件:** 需要Confluence服务器存在Widget Connector宏，并且允许用户插入恶意模板

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-3396是一个存在于Atlassian Confluence Server中的服务器端模板注入漏洞。该漏洞位于Widget Connector宏中，允许未经身份验证的远程攻击者利用Velocity模板引擎的缺陷执行任意代码。攻击者可以通过构造恶意的Widget Connector宏参数，将恶意Velocity模板注入到服务器端，从而执行任意系统命令。

**有效性评估：**

根据漏洞库信息和搜索结果，该漏洞是一个严重的安全问题，已被广泛利用，存在公开的POC（Proof of Concept）代码。

**投毒风险评估：**

提供的代码段仅包含CC0 1.0通用许可协议的文本。此代码段本身不包含任何可执行代码或恶意指令，因此不存在投毒风险的可能性。投毒风险为0%。

**利用方式：**

利用方式通常涉及以下步骤：

1.  **漏洞发现：** 确认目标Confluence服务器运行的是受影响的版本。
2.  **构造Payload：** 构建包含恶意Velocity模板的HTTP请求。这个payload通常会利用`#set`指令来定义变量，并使用`$Runtime.getRuntime().exec()`方法来执行系统命令。示例：`\u0024\{Runtime.getRuntime().exec("touch /tmp/success")\}` 
3.  **发送请求：** 将构造好的请求发送到Confluence服务器的Widget Connector宏处理端点。
4.  **代码执行：** 如果漏洞利用成功，服务器将执行payload中的系统命令。

**排序优先级解释：**

*   **搜索引擎结果：** 提供了漏洞的背景信息、影响和利用案例，有助于快速了解漏洞的严重程度和影响范围。
*   **漏洞利用代码：**  POC代码直接展示了漏洞的利用方式，可以用于验证漏洞和进行渗透测试。
*   **漏洞库信息：** 提供了漏洞的官方描述、受影响版本和修复建议，是了解漏洞细节的重要来源。

**项目地址:** [kh4sh3i/CVE-2019-3396](https://github.com/kh4sh3i/CVE-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)