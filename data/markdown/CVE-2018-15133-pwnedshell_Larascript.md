## CVE-2018-15133-Laravel-反序列化RCE

**漏洞编号:** CVE-2018-15133

**漏洞类型:** 反序列化RCE

**影响应用:** Laravel Framework

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** <= 5.5.40, 5.6.x <= 5.6.29

**利用条件:** 需要知道应用的key，通常不容易获取，除非之前已经有特权访问或者已经成功攻击。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2018-15133 是 Laravel Framework 中的一个反序列化远程代码执行漏洞。攻击者可以通过在 X-XSRF-TOKEN 中插入恶意序列化数据，利用 Illuminate/Encryption/Encrypter.php 中的 decrypt 方法触发反序列化操作，结合 phpggc 中的 gadgetchains/Laravel/RCE/3/chain.php 链执行任意代码。

**有效性：**
根据漏洞库信息、搜索引擎结果以及漏洞利用代码仓库（`aljavier/exploit_laravel_cve-2018-15133` 和 `kozmic/laravel-poc-CVE-2018-15133`），该漏洞存在有效的利用方式。CISA 也将其加入到了已知被利用的漏洞列表中，证明其具有实际的威胁。

**投毒风险：**
提供的漏洞利用代码只有LICENSE，属于协议声明，不存在投毒代码。
`aljavier/exploit_laravel_cve-2018-15133`仓库包含exp利用代码。
`kozmic/laravel-poc-CVE-2018-15133` 仓库提供了一个简单的 Laravel 应用 PoC，证明了漏洞的可利用性。根据提供的代码片段，无法判断是否存在隐藏的投毒代码，需要进一步分析整个仓库的代码。
由于提供的漏洞利用代码只是协议说明，无法判断投毒风险，只能说明提供的代码没有投毒风险。

**利用方式：**
1.  **获取应用Key：** 攻击者需要首先获取 Laravel 应用的 APP_KEY。这通常是攻击中最困难的部分，可以通过信息泄露、目录遍历等方式尝试获取。
2.  **生成恶意Payload：** 使用 phpggc 工具，选择 Laravel/RCE/3 gadget 链，并指定要执行的命令，生成序列化的 payload。
3.  **加密Payload：** 使用获取到的 APP_KEY，利用 Laravel 的加密方法（Illuminate/Encryption/Encrypter.php）对 payload 进行加密。
4.  **发送请求：** 将加密后的 payload 放入 X-XSRF-TOKEN Cookie 中，发送到存在漏洞的 Laravel 应用。
5.  **触发RCE：** 当 Laravel 应用尝试解密和反序列化 X-XSRF-TOKEN 时，将触发 gadget 链，执行预先设定的恶意命令，实现远程代码执行。

**项目地址:** [pwnedshell/Larascript](https://github.com/pwnedshell/Larascript)

**漏洞详情:** [CVE-2018-15133](https://nvd.nist.gov/vuln/detail/CVE-2018-15133)