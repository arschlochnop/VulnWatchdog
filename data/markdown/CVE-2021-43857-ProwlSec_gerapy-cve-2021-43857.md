## CVE-2021-43857-Gerapy-远程代码执行

**漏洞编号:** CVE-2021-43857

**漏洞类型:** 远程代码执行

**影响应用:** Gerapy

**危害等级:** 高危，可导致服务器被完全控制

**影响版本:** < 0.9.8

**利用条件:** 目标服务器运行Gerapy < 0.9.8，攻击者可以网络访问Gerapy服务，并且知道或可猜测管理员账号密码（默认为admin/admin）

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2021-43857是Gerapy 0.9.8之前版本中存在的一个远程代码执行漏洞。根据漏洞库信息，该漏洞是由于未正确过滤OS命令注入的特殊字符导致的。搜索引擎结果显示该漏洞影响Gerapy 0.9.7，并且有公开的漏洞利用代码（Exploit-DB）。提供的漏洞利用代码是一个Python脚本，它首先尝试使用默认凭据（admin/admin）登录Gerapy控制台。成功登录后，脚本会创建一个新的项目（如果项目不存在），然后利用漏洞执行远程命令。脚本还包含了自动启动Netcat监听器的功能，方便攻击者获取反向shell。

**有效性：**
提供的PoC代码有效，它复现了Exploit-DB上公开的漏洞，可以执行远程代码。

**投毒风险：**
该PoC代码主要包含以下部分：
1.  登录Gerapy。
2.  创建项目。
3.  发送包含恶意代码的请求，触发RCE漏洞。
4.  启动Netcat监听器。

虽然代码功能上基本实现了漏洞利用，但仍然存在一定的投毒风险，主要体现在以下几个方面：

*   **隐蔽的反向Shell地址修改**：攻击者可能修改了反向shell连接的IP地址和端口，将shell连接到攻击者控制的服务器，从而窃取受害者的系统信息。不过根据提供的代码，反向shell地址和端口是直接从命令行参数获取的，降低了这种风险。
*   **恶意代码注入**：攻击者可能在PoC代码中插入额外的恶意代码，例如，在创建项目或发送请求时，执行一些非预期的操作，例如信息收集、植入后门、拒绝服务等。

经过分析，该PoC代码存在轻微的投毒风险，可能性约为5%。

**利用方式：**
1.  使用默认凭据（admin/admin）或通过其他方式获取Gerapy管理员账号的访问权限。
2.  运行提供的Python脚本，并指定目标IP地址、端口以及本地监听IP地址和端口。
3.  脚本会自动登录Gerapy控制台，创建一个新的项目（如果项目不存在），然后发送包含恶意代码的请求，触发RCE漏洞。
4.  目标服务器会执行攻击者指定的命令，并将结果发送到攻击者指定的IP地址和端口。
5.  攻击者可以通过Netcat等工具监听指定的端口，获取目标服务器的反向shell。

**项目地址:** [ProwlSec/gerapy-cve-2021-43857](https://github.com/ProwlSec/gerapy-cve-2021-43857)

**漏洞详情:** [CVE-2021-43857](https://nvd.nist.gov/vuln/detail/CVE-2021-43857)