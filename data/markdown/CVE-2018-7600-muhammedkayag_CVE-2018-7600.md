## CVE-2018-7600-Drupal-RCE

**漏洞编号:** CVE-2018-7600

**漏洞类型:** 远程代码执行

**影响应用:** Drupal

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** Drupal before 7.58, 8.x before 8.3.9, 8.4.x before 8.4.6, and 8.5.x before 8.5.1

**利用条件:** 需要Drupal网站启用user register功能，且未及时更新补丁

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2018-7600，又名Drupalgeddon2，是一个Drupal核心中的未经身份验证的远程代码执行漏洞。攻击者可以通过构造特定的请求，利用Drupal的表单渲染机制，在服务器上执行任意代码。

**有效性：**
根据漏洞库信息和搜索引擎结果，该漏洞影响多个Drupal版本，且存在公开的漏洞利用代码。提供的POC代码利用了Drupal的`/user/register`接口，通过`element_parents`和`ajax_form`参数，以及`mail[#post_render][]`等构造恶意的payload，从而实现远程代码执行。该POC代码的有效性较高，因为很多文章和EXP都在使用此种方法。

**投毒风险：**
查看POC代码，发现其功能是发送恶意请求以利用漏洞并在目标机器上建立反向shell。在提供的代码里，存在一个比较明显的风险是，如果攻击者修改了 `command` 变量，有可能植入恶意后门，该变量定义了反向shell连接的目标 IP 地址和端口。 还有就是代码中包含的利用成功后的提示信息，如果被篡改，可能导致用户误判，这些地方存在一定的投毒风险。综合来看，代码的投毒风险为10%，主要是因为利用代码本身功能比较直接，修改后容易被发现。

**利用方式：**
1.  **目标确定：** 确定目标Drupal网站，且版本在受影响范围内（Drupal before 7.58, 8.x before 8.3.9, 8.4.x before 8.4.6, and 8.5.x before 8.5.1）。
2.  **监听端口：** 使用`listener()`函数在攻击机上监听指定端口（默认为1337），等待反向shell连接。
3.  **构造Payload：**  构造恶意的POST请求，利用`user/register`接口，并设置`element_parents`、`ajax_form`、`mail[#post_render][]`等参数，将要执行的命令嵌入到`mail[#markup]`中。
4.  **发送请求：** 使用`requests.post()`函数将构造好的Payload发送到目标Drupal网站。
5.  **建立连接：**  如果目标网站存在漏洞且利用成功，目标机器会执行Payload中的命令，即建立与攻击机指定端口的反向shell连接。
6.  **交互式Shell：**  连接建立后，`listener()`函数会将终端设置为raw模式，实现与目标机器的交互式shell会话。

**项目地址:** [muhammedkayag/CVE-2018-7600](https://github.com/muhammedkayag/CVE-2018-7600)

**漏洞详情:** [CVE-2018-7600](https://nvd.nist.gov/vuln/detail/CVE-2018-7600)