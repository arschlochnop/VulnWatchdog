## CVE-2022-24891-ESAPI-XSS

**漏洞编号:** CVE-2022-24891

**漏洞类型:** 跨站脚本 (XSS)

**影响应用:** ESAPI

**危害等级:** 中危，可能导致用户信息泄露和恶意脚本执行

**影响版本:** <= 2.2.3.1

**利用条件:** 需要用户交互，攻击者需要诱使用户访问包含恶意脚本的链接。

**POC 可用性:** 否

**投毒风险:** 0%

## 详情

CVE-2022-24891 是 ESAPI (The OWASP Enterprise Security API) 中存在的一个跨站脚本 (XSS) 漏洞。该漏洞是由于 antisamy-esapi.xml 配置文件中 "onsiteURL" 的正则表达式不正确，导致 "javascript:" URLs 未能被正确地清理。攻击者可以利用此漏洞注入恶意脚本，当用户访问包含该恶意脚本的页面时，脚本将在用户的浏览器上执行。该漏洞影响 ESAPI 2.2.3.1 及更早版本。建议升级到 ESAPI 2.3.0.0 或更高版本，或者手动编辑 antisamy-esapi.xml 配置文件以修复该正则表达式。 

**有效性：**
根据漏洞库信息和搜索结果，该漏洞是真实存在的，并且有公开的修复方案。虽然没有直接可用的漏洞利用代码（POC），但漏洞原理清晰，攻击者可以构造包含 "javascript:" URL 的恶意输入来触发 XSS。

**投毒风险：**
提供的漏洞利用代码实际上是ESAPI的贡献指南`CONTRIBUTING-TO-ESAPI.txt`，只是一个文本文件，不包含任何可执行代码，因此不存在投毒风险。可以确定投毒风险为 0%。

**利用方式：**
1.  **找到易受攻击的ESAPI版本:** 确定目标应用程序正在使用 ESAPI 2.2.3.1 或更早版本。
2.  **识别输入点:** 找到应用程序中使用了 ESAPI 的 `antisamy-esapi.xml` 配置文件来过滤 URL 的输入点。这些输入点通常是允许用户输入 URL 的地方，例如链接、图片地址等。
3.  **构造恶意URL:**  构造一个包含 "javascript:" 前缀的恶意 URL，例如：`javascript:alert('XSS')`。由于 `antisamy-esapi.xml` 配置文件中的正则表达式不正确，这个恶意 URL 可能无法被正确过滤。
4.  **诱导用户访问:** 将包含恶意 URL 的输入提交到应用程序。如果应用程序没有正确过滤 URL，恶意 URL 将被呈现到页面上。诱导用户点击该链接或者访问包含该链接的页面。 当用户点击链接或访问页面时，浏览器会执行 "javascript:" URL 中的恶意脚本，导致 XSS 攻击。

由于此漏洞需要用户交互，因此CVSS评分为中危。

**项目地址:** [shoucheng3/ESAPI__esapi-java-legacy_CVE-2022-24891_2-2-3-1](https://github.com/shoucheng3/ESAPI__esapi-java-legacy_CVE-2022-24891_2-2-3-1)

**漏洞详情:** [CVE-2022-24891](https://nvd.nist.gov/vuln/detail/CVE-2022-24891)