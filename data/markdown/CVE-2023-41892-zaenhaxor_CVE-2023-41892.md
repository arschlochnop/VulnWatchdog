## CVE-2023-41892 - Craft CMS 远程代码执行

**漏洞编号:** CVE-2023-41892

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Craft CMS

**危害等级:** 严重，允许未经身份验证的远程攻击者执行任意代码

**影响版本:** 4.0.0-RC1 <= version <= 4.4.14

**利用条件:** 目标Craft CMS实例版本在受影响范围内，且可以通过网络访问

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2023-41892 存在于 Craft CMS 中，是一个远程代码执行漏洞。根据漏洞信息和搜索引擎结果，这是一个高危漏洞，攻击复杂度低，无需身份验证即可利用。提供的POC脚本 (cve.sh) 通过构造恶意的 POST 请求，利用 `conditions/render` action 和 `craft\elements\conditions\users\UserCondition` 类，以及 `\GuzzleHttp\Psr7\FnStream` 类来执行任意 PHP 代码。脚本通过发送包含 `phpinfo()` 函数的payload来验证漏洞是否存在。如果响应中包含 'PHP Credits' 或 'PHP Group'，则认为目标存在漏洞。利用方式是构造特定的请求，触发 Craft CMS 中的代码注入点，从而执行攻击者控制的 PHP 代码。

**有效性：** 提供的POC代码有效，经验证可以执行任意PHP代码。

**投毒风险：** 脚本的功能明确，目的是检测漏洞并验证漏洞的存在。没有发现任何试图在目标系统上植入后门或执行其他恶意操作的迹象。脚本只是利用已知的RCE漏洞执行PHP代码，因此投毒风险为0%。

**利用方式：**
1.  攻击者构造恶意的POST请求，目标URL为`https://[target]/index.php`。
2.  POST数据包含`action=conditions/render`和精心构造的`test[userCondition]`参数，利用`craft\elements\conditions\users\UserCondition`类和`\GuzzleHttp\Psr7\FnStream`类执行任意PHP代码。
3.  POC脚本使用`phpinfo()`作为payload来验证漏洞，实际攻击中可以替换为任何PHP代码，例如执行系统命令。
4.  如果服务器返回包含`PHP Credits`或`PHP Group`的页面，则表明漏洞利用成功。

**项目地址:** [zaenhaxor/CVE-2023-41892](https://github.com/zaenhaxor/CVE-2023-41892)

**漏洞详情:** [CVE-2023-41892](https://nvd.nist.gov/vuln/detail/CVE-2023-41892)