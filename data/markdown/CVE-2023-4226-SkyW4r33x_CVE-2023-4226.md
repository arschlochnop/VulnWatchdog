## CVE-2023-4226-Chamilo-LMS-远程代码执行

**漏洞编号:** CVE-2023-4226

**漏洞类型:** 未授权文件上传

**影响应用:** Chamilo LMS

**危害等级:** 高危，远程代码执行

**影响版本:** <= 1.11.24

**利用条件:** 需要认证的learner角色

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2023-4226 漏洞存在于 Chamilo LMS <= v1.11.24 的 `/main/inc/ajax/work.ajax.php` 文件中，允许经过身份验证的攻击者（具有learner角色）通过上传 PHP 文件来执行远程代码。

**利用方式：**
1.  攻击者需要拥有 Chamilo LMS 的 learner 角色账户并登录。
2.  攻击者利用`/main/inc/ajax/work.ajax.php`的文件上传功能。
3.  由于文件上传功能存在缺陷，攻击者可以上传包含恶意代码的 PHP 文件（例如webshell）。
4.  上传的 PHP 文件被存储在服务器的web可访问目录下。
5.  攻击者通过访问上传的 PHP 文件来执行其中的恶意代码，从而实现远程代码执行。

**有效性评估：**
根据漏洞描述和搜索结果，该漏洞利用的有效性较高。存在公开的POC代码（例如 krishnan-tech/CVE-2023-4226-POC），表明该漏洞是可利用的。 漏洞库信息也确认了可以通过上传php文件实现远程代码执行。
提供的Python POC代码 首先会检查是否存在rce.php和.htaccess文件， 如果没有rce.php,则退出， 如果没有.htaccess会创建，然后要求用户输入chamilo的URL，ch_sid cookie, defaultMyCourseView3 cookie, 以及反弹shell的IP和端口，然后上传webshell， 成功后访问URL执行webshell,实现RCE

**投毒风险分析：**
提供的漏洞利用代码 `/tmp/f692adaeb6248bf7f4717efbf128f318/CVE-2023-4226.py` 本身并未发现明显的投毒代码。代码逻辑较为清晰，主要功能是利用漏洞上传包含恶意代码的 PHP 文件，并执行。

  *   代码会检查 `rce.php` 和 `.htaccess` 文件是否存在，如果 `rce.php` 不存在，会提示用户创建，并退出， 这部分逻辑是正常的，`.htaccess` 文件用于允许执行上传的 PHP 文件。
  *   代码包含用于验证 IP 地址和端口的函数 `validate_ip` 和 `validate_port`，这有助于防止用户输入错误的 IP 地址和端口。

但是仍然存在极低的投毒风险（1%）：
 * 修改IP和PORT的函数存在被替换成恶意代码的风险，但是代码替换校验较为严格，只有特定的代码才会触发风险。
*  用户在使用该POC前，应当仔细检查代码，确保其安全性。建议从可信的来源获取POC代码。

**项目地址:** [SkyW4r33x/CVE-2023-4226](https://github.com/SkyW4r33x/CVE-2023-4226)

**漏洞详情:** [CVE-2023-4226](https://nvd.nist.gov/vuln/detail/CVE-2023-4226)