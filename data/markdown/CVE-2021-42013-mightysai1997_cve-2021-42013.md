## CVE-2021-42013 - Apache HTTP Server Path Traversal and Remote Code Execution

**漏洞编号:** CVE-2021-42013

**漏洞类型:** Path Traversal and Remote Code Execution

**影响应用:** Apache HTTP Server

**危害等级:** 高危，可能导致敏感信息泄露和远程代码执行

**影响版本:** 2.4.49, 2.4.50

**利用条件:** 目标服务器运行Apache HTTP Server 2.4.49 或 2.4.50，且存在Alias配置不当或CGI脚本未做权限限制。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-42013是对CVE-2021-41773的不完全修复。攻击者可以利用路径遍历漏洞读取Alias配置目录之外的文件，如果未配置"require all denied"，则可以成功读取。如果同时启用了CGI脚本，则可能导致远程代码执行。

**有效性：** 提供的POC代码针对CVE-2021-42013，包含Dockerfile、README.md和利用脚本。Dockerfile用于构建存在漏洞的Apache HTTP Server环境，README.md包含漏洞描述、环境搭建和脚本使用说明。利用脚本cve-2021-42013.py提供路径遍历和远程代码执行两种利用方式，通过参数`-u`指定目标URL，`-pt`执行路径遍历，`-rce`执行远程代码执行，`-l`批量扫描。

**投毒风险：**  检查`cve-2021-42013.py` 脚本，发现脚本功能正常，主要是构造payload发送请求，判断是否存在漏洞。 但是Dockerfile中直接wget下载了 httpd-2.4.50.tar.gz 包，存在被中间人攻击替换为恶意包的风险。且start.sh脚本权限被设置为777，任何用户都有修改权限，存在被植入后门的风险。 综合评估，投毒风险较低，约为10%。

**利用方式：**

1.  **路径遍历：** 利用`..`进行目录跳转，读取目标服务器上的任意文件。例如，`http://target/icons/.%2e/.%2e/.%2e/.%2e/.%2e/.%2e/.%2e/etc/passwd`。
2.  **远程代码执行：** 如果服务器启用了CGI，攻击者可以构造包含恶意代码的URL来执行命令。例如，访问`/cgi-bin/.%2e/.%2e/.%2e/.%2e/bin/sh`并传入shell命令作为参数。

利用的前提是目标Apache服务器版本为2.4.49或2.4.50，且存在Alias配置不当，或者CGI脚本未做严格的权限控制。需要关注服务器配置是否启用CGI，以及是否存在权限开放的目录，例如`icons`目录。

**项目地址:** [mightysai1997/cve-2021-42013](https://github.com/mightysai1997/cve-2021-42013)

**漏洞详情:** [CVE-2021-42013](https://nvd.nist.gov/vuln/detail/CVE-2021-42013)