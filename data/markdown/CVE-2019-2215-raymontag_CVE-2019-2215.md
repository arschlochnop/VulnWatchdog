## CVE-2019-2215 Android Binder Use-After-Free

**漏洞编号:** CVE-2019-2215

**漏洞类型:** Use-After-Free

**影响应用:** Android Kernel

**危害等级:** 高危，可导致权限提升至Linux Kernel

**影响版本:** Kernel

**利用条件:** 需要安装恶意本地应用程序或网络应用中的单独漏洞

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-2215 是Android Binder中的一个use-after-free漏洞。此漏洞位于binder.c中，允许应用程序提升权限到Linux Kernel。漏洞利用无需用户交互，但需要安装恶意本地应用程序或利用网络应用中的另一个漏洞。漏洞利用代码包括Makefile和cve-2019-2215.c，用于编译生成expolit可执行文件，adb push可以将编译好的exploit推送到android手机的/data/local/tmp目录下。

**有效性：**
根据漏洞信息，搜索引擎结果和提供的漏洞利用代码，可以判断此漏洞是有效的。 搜索引擎结果中多个条目表明该漏洞已经在野外被利用，并且存在公开的expolit。

**投毒风险：**
根据提供的Makefile和部分代码段，投毒风险较低。Makefile 只是用于编译漏洞利用程序的标准文件，本身不包含恶意代码。提供的代码段主要是关于 binder_poll 和 epoll_ctl 的函数调用，是漏洞利用的关键部分，也未发现恶意代码。但不能完全排除投毒风险，需要对完整的`cve-2019-2215.c`进行分析，才可完全排除风险。因此判断投毒风险为10%。

**利用方式：**
1.  **漏洞触发：** 漏洞存在于Android内核的Binder驱动程序中，具体在`binder.c`文件的`binder_thread`结构体的`wait`成员中存在UAF问题。
2.  **利用流程：**
    *   利用程序首先需要获得在设备上的执行权限，可以通过安装恶意应用或利用其他漏洞实现。
    *   利用程序创建并操作Binder对象，触发UAF漏洞。 具体来说，该漏洞的触发与eventpoll机制(`epoll_ctl`, `ep_insert`, `ep_item_poll`)以及`binder_poll`函数的调用有关。
    *   通过精心构造的内存布局，攻击者可以在释放后再次使用该内存区域，从而覆盖或修改内核数据。
    *   利用覆盖的内核数据，攻击者可以修改进程的凭据(credentials)，将其UID/GID设置为0，从而获得root权限。
3.  **权限提升：** 通过利用UAF漏洞修改内核数据，攻击者可以将恶意应用程序的权限提升到root级别，从而完全控制设备。

**项目地址:** [raymontag/CVE-2019-2215](https://github.com/raymontag/CVE-2019-2215)

**漏洞详情:** [CVE-2019-2215](https://nvd.nist.gov/vuln/detail/CVE-2019-2215)