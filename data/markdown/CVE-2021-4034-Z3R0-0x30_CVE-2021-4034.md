## CVE-2021-4034-Polkit-pkexec本地提权

**漏洞编号:** CVE-2021-4034

**漏洞类型:** 本地权限提升

**影响应用:** Polkit

**危害等级:** 高危，可使普通用户获得root权限

**影响版本:** 所有版本

**利用条件:** 本地用户可以访问pkexec

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2021-4034（Pwnkit）是Polkit的pkexec实用程序中的本地权限提升漏洞。pkexec是一个setuid工具，允许非特权用户按照预定义的策略以特权用户身份运行命令。漏洞原因是pkexec没有正确处理调用参数计数，导致尝试将环境变量作为命令执行。攻击者可以通过构造环境变量来诱使pkexec执行任意代码，从而获得root权限。

**利用方式：**

1.  **漏洞原理：** pkexec在处理参数时存在缺陷，导致它可以将某些环境变量的内容误认为是要执行的命令。通过精心构造环境变量，可以劫持程序的执行流程。

2.  **POC分析：** 提供的POC利用了glibc的gconv机制。`gconv`用于处理字符集转换。POC首先创建了一个恶意的`zero.so`共享对象，其中包含`gconv_init`函数，该函数会设置UID和GID为0，然后执行/bin/bash。然后创建一个`gconv-modules`文件，将`UTF-8`编码转换为`ZERO`编码时加载`zero.so`。接着，设置`GCONV_PATH=.`，并复制`zero.so`到当前目录，强制glibc加载当前目录下的`gconv`模块。最后，创建一个`zero_exploit.c`程序，设置一些环境变量，其中`CHARSET=ZERO`触发字符集转换，从而加载恶意的`zero.so`，提权执行bash。

3.  **有效性：** POC代码有效，可以成功利用CVE-2021-4034漏洞，在未打补丁的系统上获得root权限。搜索引擎结果和漏洞库信息均表明该漏洞易于利用，且已存在公开的利用代码。

4.  **投毒风险：** 仓库中存在投毒代码的可能性较低，估计为5%。虽然主要代码是漏洞利用，但不能完全排除作者在脚本中加入恶意命令的可能性。但总体来看，脚本内容直接，没有发现明显的恶意行为。

**项目地址:** [Z3R0-0x30/CVE-2021-4034](https://github.com/Z3R0-0x30/CVE-2021-4034)

**漏洞详情:** [CVE-2021-4034](https://nvd.nist.gov/vuln/detail/CVE-2021-4034)