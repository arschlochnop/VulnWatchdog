## CVE-2025-24813-Apache Tomcat-路径等价/反序列化RCE

**漏洞编号:** CVE-2025-24813

**漏洞类型:** 路径等价/反序列化RCE

**影响应用:** Apache Tomcat

**危害等级:** 高危，可能导致远程代码执行和信息泄露

**影响版本:** 11.0.0-M1 <= version <= 11.0.2, 10.1.0-M1 <= version <= 10.1.34, 9.0.0.M1 <= version <= 9.0.98

**利用条件:** 默认Servlet的写入已启用；支持Partial PUT；应用程序使用Tomcat基于文件的会话持久性，且使用了默认存储位置；应用程序包含一个可能在反序列化攻击中被利用的库。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2025-24813 是 Apache Tomcat 中的一个漏洞，涉及路径等价问题和潜在的反序列化远程代码执行。根据漏洞库信息，如果满足以下条件，攻击者能够执行远程代码：

*   默认Servlet的写入已启用（默认禁用）。
*   支持Partial PUT（默认启用）。
*   应用程序使用Tomcat基于文件的会话持久性，且使用了默认存储位置。
*   应用程序包含一个可能在反序列化攻击中被利用的库。

根据搜索引擎结果，该漏洞已被积极利用。

提供的 Dockerfile 漏洞利用代码显示：

1.  **开启了`readonly`参数**: 将`readonly`参数设置为`false`，从而启用了默认Servlet的写入功能，这是利用该漏洞的必要条件之一。
2.  **配置了`PersistentManager`**: 添加了 `<Manager className="org.apache.catalina.session.PersistentManager"><Store className="org.apache.catalina.session.FileStore"/></Manager>` 配置，启用了基于文件的会话持久性，这也是 RCE 的条件之一
3.  **部署WAR包**: 将 ROOT.war 部署到 webapps 目录下。这个WAR包很可能包含恶意代码，通过文件上传或者会话反序列化漏洞被执行。

**利用方式：**

该漏洞的利用方式主要依赖于 Partial PUT 功能和路径等价性。攻击者可以利用 Partial PUT 上传恶意文件片段，然后利用路径等价性（例如使用 `file.Name`）绕过安全检查，将恶意代码写入到目标文件或利用反序列化执行任意代码。 如果使用了 session 持久化，且存在可利用的反序列化 gadget，那么可以利用该漏洞进行RCE。

**投毒风险：**

Dockerfile 本身并未直接包含恶意代码，而是通过配置使 Tomcat 处于易受攻击的状态，并部署一个外部 WAR 包（`ROOT.war`）。因此，投毒的风险主要在于 `ROOT.war` 包中是否包含后门或者恶意代码。 风险评估为 10%,主要原因为需要进一步分析war包，才能确认。

**有效性：**

Dockerfile 配置如果部署了恶意war包，则可以证明该POC有效。在满足了所有漏洞利用条件的情况下，该代码可以有效利用 CVE-2025-24813 漏洞，实现远程代码执行。

**项目地址:** [hakankarabacak/CVE-2025-24813](https://github.com/hakankarabacak/CVE-2025-24813)

**漏洞详情:** [CVE-2025-24813](https://nvd.nist.gov/vuln/detail/CVE-2025-24813)