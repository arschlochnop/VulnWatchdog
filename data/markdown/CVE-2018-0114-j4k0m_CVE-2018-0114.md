## CVE-2018-0114 Node-jose JWT 签名伪造

**漏洞编号:** CVE-2018-0114

**漏洞类型:** JWT签名伪造

**影响应用:** Node-jose Library

**危害等级:** 高危，可能导致身份冒用和未授权访问

**影响版本:** < 0.11.0

**利用条件:** 应用程序使用存在漏洞版本的Node-jose库来验证JWT。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2018-0114漏洞存在于Cisco node-jose开源库0.11.0之前的版本中，允许未经身份验证的远程攻击者使用嵌入在令牌中的密钥重新签名令牌。漏洞原因是node-jose遵循JSON Web Signature (JWS)标准来处理JSON Web Tokens (JWTs)。此标准指定JSON Web Key (JWK)，表示公钥可以嵌入在JWS的header中。该公钥随后被信任用于验证。攻击者可以通过以下步骤利用此漏洞：

1.  获取一个有效的JWT。
2.  移除原始签名。
3.  在header中添加一个新的JWK，包含攻击者控制的公钥。
4.  使用与header中公钥对应的私钥对该对象进行签名。
5.  将伪造的JWT提交给应用程序。由于应用程序信任header中的JWK，因此它将接受攻击者伪造的签名。

根据漏洞利用代码仓库中的README.md，该漏洞的利用方式如下：

1.  使用`openssl`创建RSA私钥。
2.  从私钥的公钥部分提取`n`和`e`。
3.  使用相同的私钥对payload进行签名。
4.  更改payload中的`n`和`e`值，以确保它们与正在使用的私钥匹配。
5.  创建正确的payload作为令牌的主体。
6.  确保算法`alg`是用于签名的算法。很可能需要将值更改为`RS256`。

仓库中的`jwk-node-jose.py`可能包含实现该漏洞利用的示例代码。

**有效性：** 根据漏洞库信息和搜索结果，该漏洞存在且POC代码可用。因此，可以判断POC代码是有效的。

**投毒风险：** 提供的代码仓库中只包含了README.md文件，其中描述了漏洞的利用方式，并提供了一个Python脚本的链接。该描述主要是漏洞利用的说明，没有发现任何潜在的后门或恶意代码。所以投毒风险为0%。

**利用方式：** 利用方式总结如下：

1.  **构造包含恶意JWK的JWT Header：** 攻击者创建一个新的JSON Web Key (JWK)，包含攻击者控制的公钥，并将其嵌入到JWT的header中。
2.  **移除原始签名：** 删除JWT中的原始签名。
3.  **使用攻击者的私钥重新签名：** 使用与JWK中的公钥对应的私钥对JWT重新签名。
4.  **欺骗验证逻辑：** 将修改后的JWT发送到服务器。如果服务器信任JWT header中的JWK用于验证，则会错误地接受攻击者伪造的签名，从而允许攻击者冒充其他用户或绕过身份验证。

**项目地址:** [j4k0m/CVE-2018-0114](https://github.com/j4k0m/CVE-2018-0114)

**漏洞详情:** [CVE-2018-0114](https://nvd.nist.gov/vuln/detail/CVE-2018-0114)