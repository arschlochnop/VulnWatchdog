## CVE-2024-4040-CrushFTP-SSTI

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** CrushFTP

**危害等级:** 高危，可能导致任意文件读取、权限绕过和远程代码执行

**影响版本:** < 10.7.1 和 < 11.1.0

**利用条件:** 需要网络访问，目标系统运行存在漏洞的CrushFTP版本

**POC 可用性:** 是

**投毒风险:** 50%

## 详情

CVE-2024-4040 是 CrushFTP 中一个严重的服务器端模板注入（SSTI）漏洞。未经身份验证的远程攻击者可以利用此漏洞读取 VFS 沙箱之外的文件系统中的文件，绕过身份验证以获得管理员访问权限，并在服务器上执行远程代码。

**有效性：**
根据NVD、Rapid7、CISA ADP等信息来源以及大量安全厂商报告，此漏洞已被积极利用，PoC 已公开，利用的有效性较高。

**投毒风险：**
提供的漏洞利用代码包含两个脚本：`main.py` 和 `scan_logs.py`。
*   `main.py`: 增加了多线程和批量扫描，但内容仅是进行漏洞验证扫描，未发现直接的恶意代码。这个文件本身看起来没有立即的投毒迹象。但是，考虑到该脚本修改自他人代码，并且未提供原始版本对比，存在被植入后门的风险。存在攻击者将验证代码替换成恶意代码的可能性，例如植入反弹shell等。因此，`main.py` 的投毒风险是存在的。
*   `scan_logs.py`:  用于在 CrushFTP 服务器安装目录中搜索可能被利用的痕迹。该脚本本身没有明显的恶意行为。但攻击者可能利用此脚本扫描服务器信息，为下一步攻击做准备。
总体而言，代码仓库存在一定的投毒风险。主要风险点在于 `main.py` 可能被植入恶意代码。

**利用方式：**
根据漏洞描述，利用方式涉及向 CrushFTP 服务器发送特制的请求，该请求包含恶意构造的模板注入代码。服务器在处理该请求时，会将该代码解析并执行，从而允许攻击者执行以下操作：

1.  **任意文件读取：** 通过模板注入，攻击者可以读取服务器文件系统上的任意文件，包括配置文件、数据库文件等敏感信息。
2.  **权限绕过：** 攻击者可以通过模板注入绕过身份验证，获得管理员权限。
3.  **远程代码执行：** 通过执行任意代码，攻击者可以完全控制服务器，例如安装恶意软件、窃取数据等。

**综上所述，CVE-2024-4040 是一个高危漏洞，需要尽快修复。在使用公开的 PoC 代码时，务必进行安全审查，以避免被植入恶意代码。**

**项目地址:** [tucommenceapousser/CVE-2024-4040-Scanner](https://github.com/tucommenceapousser/CVE-2024-4040-Scanner)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)