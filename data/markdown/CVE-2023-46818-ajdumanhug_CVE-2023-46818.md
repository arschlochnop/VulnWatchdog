## CVE-2023-46818-ISPConfig-PHP代码注入

**漏洞编号:** CVE-2023-46818

**漏洞类型:** PHP代码注入

**影响应用:** ISPConfig

**危害等级:** 高危，允许管理员注入并执行任意PHP代码，可能导致服务器完全控制

**影响版本:** <= 3.2.11

**利用条件:** 需要管理员权限，并且`admin_allow_langedit`选项已启用

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-46818是ISPConfig 3.2.11及更早版本中的一个PHP代码注入漏洞。利用此漏洞，需要满足以下条件：

1.  **管理员权限：** 攻击者必须拥有ISPConfig的管理员账户。
2.  **`admin_allow_langedit`启用：**  `admin_allow_langedit`配置项必须被启用。该漏洞存在于`language_edit.php`文件中，该文件用于编辑语言文件。

**利用方式：**

1.  **登录：** 使用管理员账户登录ISPConfig控制面板。
2.  **获取CSRF令牌：** 访问`language_edit.php`页面，获取CSRF ID和CSRF Key。这个步骤是为了绕过CSRF保护。
3.  **注入恶意代码：** 构造包含恶意PHP代码的请求，通过`records`参数注入，并将其发送到`language_edit.php`。POC代码使用`file_put_contents`函数将一个webshell写入到服务器上的`admin/sh.php`文件中，该webshell接收通过HTTP头`C`传递的base64编码的命令并执行。
4.  **执行命令：** 访问webshell（`admin/sh.php`），并在HTTP头`C`中传递base64编码的命令。服务器会执行该命令并将结果返回。

**关于有效性：**

根据漏洞库信息、搜索引擎结果，以及提供的漏洞利用代码，该漏洞POC代码是有效的。多个来源（NVD、Recorded Future、Sploitus等）都确认了该漏洞的存在，并且提供了利用细节。提供的Python脚本实现了漏洞利用的完整流程。

**关于投毒风险：**

评估投毒风险较低，约为5%。该Python脚本主要功能是利用已知漏洞，但仍然存在极小的潜在风险：

*   **对远程服务器造成破坏的可能性：** POC利用代码中虽然主要目标是执行命令，如果webshell被其他人利用，或者注入的Payload被修改，可能会被用于其他恶意目的，例如删除文件、篡改配置等。
*   **依赖库风险：**  脚本依赖`requests`库，虽然该库本身很常用，如果被供应链投毒，也会影响此脚本。

总体而言，该代码的目的是实现已知的漏洞利用，投毒风险较低，但仍然需要人工审核。

**项目地址:** [ajdumanhug/CVE-2023-46818](https://github.com/ajdumanhug/CVE-2023-46818)

**漏洞详情:** [CVE-2023-46818](https://nvd.nist.gov/vuln/detail/CVE-2023-46818)