## CVE-2024-10220-Kubelet-任意命令执行

**漏洞编号:** CVE-2024-10220

**漏洞类型:** 任意命令执行

**影响应用:** Kubelet

**危害等级:** 高危，可能导致节点被完全控制

**影响版本:** <= 1.28.11, 1.29.0 <= version <= 1.29.6, 1.30.0 <= version <= 1.30.2

**利用条件:** 攻击者需要具有创建Pod和关联gitRepo Volume的权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-10220 允许攻击者通过特制的gitRepo Volume在 Kubernetes kubelet 组件上执行任意命令。漏洞利用方式如下：

1.  **漏洞原理：** 该漏洞源于 kubelet 在处理 gitRepo Volume 时，没有充分限制路径，允许攻击者利用 Git 钩子执行恶意命令。
2.  **利用步骤：**
    *   攻击者创建一个包含恶意 Git 仓库的 Pod。
    *   该仓库的 `.git/hooks` 目录下包含恶意脚本（例如 `post-checkout`, `pre-commit`等）。
    *   当 kubelet 克隆或更新该仓库时，Git 钩子会被触发，从而执行恶意脚本。
    *   由于 kubelet 通常以 root 权限运行，恶意脚本也会以 root 权限执行，从而控制节点。
3.  **POC分析：** 提供的POC代码 `/tmp/062232065a7902f899883e0db5641023/index.html` 内容为 "Malicious code"。这本身不是一个完整的 POC， 仅仅是一个指示Payload位置的文件。要成功利用此漏洞，需要一个包含恶意git hooks的Git仓库，然后通过Pod定义中的gitRepo volume引用该仓库。此文件可能存在投毒风险是因为：攻击者可以在 git 仓库中添加额外的后门或恶意功能，这些功能可能不会立即被发现，但会在后续被触发。 此文件index.html 可能只是一个诱饵。 因此投毒风险为10%。搜索引擎结果表明，该漏洞利用主要通过git hooks实现远程命令执行, 权限为Root.

**总结：** 漏洞利用的有效性取决于是否能创建一个包含恶意 Git 仓库的 Pod，以及是否能成功触发 Git 钩子。该漏洞风险极高，因为攻击者可以利用它完全控制受影响的 Kubernetes 节点。

**项目地址:** [orgC/CVE-2024-10220-demo](https://github.com/orgC/CVE-2024-10220-demo)

**漏洞详情:** [CVE-2024-10220](https://nvd.nist.gov/vuln/detail/CVE-2024-10220)