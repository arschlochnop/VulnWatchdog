## CVE-2021-3560-Polkit权限提升

**漏洞编号:** CVE-2021-3560

**漏洞类型:** 权限提升

**影响应用:** Polkit

**危害等级:** 高危，可导致本地普通用户获取Root权限，造成数据泄露、完整性破坏和系统不可用

**影响版本:** polkit 0.119及受影响版本，如Ubuntu 20.04 (policykit-1 0.105-26ubuntu1)

**利用条件:** 本地用户，目标系统安装了受影响版本的Polkit

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-3560 允许本地未授权用户通过利用Polkit中的D-Bus消息处理缺陷，绕过身份验证并获得Root权限。攻击者首先构造一个D-Bus消息请求创建具有sudo权限的新账户或者设置密码，然后中断（kill）该消息，导致Polkit在尝试获取消息发送者用户ID时发生错误。由于Polkit错误地处理了此错误，会将用户ID替换为0（Root用户ID），从而允许未授权请求以Root权限执行。

**有效性评估：**

根据漏洞信息、搜索结果和POC代码，该漏洞利用方法是有效的。漏洞库信息明确指出该漏洞允许权限提升，搜索结果中多个链接指向了漏洞详情、利用方法以及受影响的Linux发行版。POC代码提供了详细的利用步骤，包括发送D-Bus消息、中断消息以及相关的命令示例。

**投毒风险评估：**

POC代码主要包含利用漏洞的脚本和说明文档。虽然该代码本身是用于权限提升，存在一定的滥用风险，但并**没有发现**明显的、作者额外添加的恶意后门或代码。例如，自动植入SSH密钥、创建隐藏账户等。因此，投毒风险较低。但是，由于利用该漏洞可以获得Root权限，攻击者获得Root权限后可进行任何恶意操作，不能排除利用漏洞进行投毒的可能性。作者提供的是漏洞利用的证明和方法，其目的在于重现和理解漏洞，而非植入后门，因此投毒概率较低，估计为10%。

**利用方式：**

1.  **发送D-Bus消息：** 使用`dbus-send`命令向`org.freedesktop.Accounts`发送消息，请求创建具有sudo权限的新用户，或者设置密码。示例：
    ```bash
    dbus-send --system --dest=org.freedesktop.Accounts --type=method_call --print-reply /org/freedesktop/Accounts org.freedesktop.Accounts.CreateUser string:attacker string:"Pentester Account" int32:1
    ```
2.  **中断D-Bus消息：** 在Polkit处理消息之前，使用`kill`命令中断消息。这会删除消息的唯一ID。
3.  **Polkit错误处理：** Polkit在尝试使用已删除的消息ID获取消息发送者用户ID时，会遇到错误。Polkit会错误地将用户ID替换为0（Root用户ID）。
4.  **权限提升：** Polkit认为Root用户发起了请求，因此允许未授权请求以Root权限执行，从而实现权限提升。

**项目地址:** [AssassinUKG/Polkit-CVE-2021-3560](https://github.com/AssassinUKG/Polkit-CVE-2021-3560)

**漏洞详情:** [CVE-2021-3560](https://nvd.nist.gov/vuln/detail/CVE-2021-3560)