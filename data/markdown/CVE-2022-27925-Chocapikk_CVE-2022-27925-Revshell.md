## CVE-2022-27925-Zimbra-路径遍历/任意文件上传

**漏洞编号:** CVE-2022-27925

**漏洞类型:** 路径遍历/任意文件上传

**影响应用:** Zimbra Collaboration Suite (ZCS)

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 8.8.15, 9.0

**利用条件:** 需要管理员权限（根据搜索结果1，6，8表明可以绕过认证，实现未经身份验证的RCE），目标系统存在漏洞，可以访问Zimbra服务器。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

该漏洞存在于Zimbra Collaboration Suite (ZCS) 的mboximport功能中。拥有管理员权限的认证用户（或未经认证的用户，如果存在其他漏洞如CVE-2022-37042）可以上传包含恶意路径的ZIP文件，导致目录遍历，最终写入任意文件。POC通过上传包含JSP Webshell的ZIP文件到服务器，然后通过访问该Webshell执行任意命令。根据Volexity的博客，存在身份验证绕过。

**有效性：** 提供的POC代码似乎有效，因为它利用了 zip 文件解压时的路径遍历漏洞来上传 webshell，并且代码中包含了验证 webshell 是否成功上传并执行命令的逻辑。

**投毒风险：** POC代码本身主要是利用漏洞，没有明显的恶意投毒代码。代码首先构造一个ZIP文件，包含一个JSP webshell，然后通过POST请求上传该ZIP文件。之后，尝试访问上传的webshell并执行命令。投毒风险较低，主要风险在于利用成功后，上传的webshell本身就是后门。代码中的随机webshell文件名和反向shell功能可以被用于恶意目的，但这些都属于漏洞利用的范畴，而非代码投毒。

**利用方式：**

1.  **认证/未认证（取决于是否存在身份认证绕过漏洞）：** 根据漏洞描述，最初需要管理员权限。但根据搜索引擎结果 (例如Volexity博客) ，存在可以绕过身份验证的利用方法，可直接实现未授权RCE。 
2.  **构造恶意ZIP文件：**  创建一个包含恶意JSP文件的ZIP文件。恶意JSP文件包含 webshell 代码，允许远程执行命令。文件名使用路径遍历payload，例如 `../../../opt/zimbra/jetty_base/webapps/zimbraAdmin/shell.jsp`。
3.  **上传ZIP文件：**  使用mboximport功能上传构造的ZIP文件。POC代码中使用了两个不同的URL，都指向mboximport功能，以增加漏洞利用的成功率。
4.  **访问Webshell：**  上传成功后，通过构造的URL访问上传的JSP webshell，从而执行任意命令。
5.  **反向Shell：**  POC代码还包含创建反向shell的功能，允许攻击者获得对受感染服务器的shell访问权限。


**项目地址:** [Chocapikk/CVE-2022-27925-Revshell](https://github.com/Chocapikk/CVE-2022-27925-Revshell)

**漏洞详情:** [CVE-2022-27925](https://nvd.nist.gov/vuln/detail/CVE-2022-27925)