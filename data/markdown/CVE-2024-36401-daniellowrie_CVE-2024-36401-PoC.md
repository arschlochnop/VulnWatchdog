## CVE-2024-36401-GeoServer-RCE

**漏洞编号:** CVE-2024-36401

**漏洞类型:** 远程代码执行(RCE)

**影响应用:** GeoServer

**危害等级:** 严重，未经身份验证的远程代码执行

**影响版本:** 2.22.x (< 2.22.6), 2.23.x (>= 2.23.0, < 2.23.6), 2.24.x (>= 2.24.0, < 2.24.4), 2.25.x (>= 2.25.0, < 2.25.2)

**利用条件:** 默认 GeoServer 安装，允许网络访问，且目标版本在受影响范围内。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-36401 是 GeoServer 中的一个远程代码执行漏洞。该漏洞源于 GeoTools 库在处理要素类型属性名称时，不安全地将其传递给 commons-jxpath 库，从而允许攻击者通过构造恶意的 XPath 表达式来执行任意代码。利用方式是通过构造恶意的 WFS GetFeature, WFS GetPropertyValue, WMS GetMap, WMS GetFeatureInfo, WMS GetLegendGraphic 和 WPS Execute 请求，在请求的参数中注入恶意代码。提供的 PoC 代码 `geopwn.py` 演示了如何通过 WFS GetPropertyValue 请求，利用`exec`函数执行系统命令。

**有效性：**  提供的PoC代码看起来有效。它利用了WFS服务的GetPropertyValue请求，并构造包含恶意代码的`valueReference`参数，利用`exec`函数执行命令。它首先生成一个反向shell的payload，然后通过wget下载到目标机器，赋予执行权限，并最终执行。

**投毒风险：**  PoC 代码本身主要功能是利用漏洞实现远程代码执行。但是，也存在一定的投毒风险：

*   **依赖下载：** PoC脚本会通过wget下载shell，脚本中使用的 URL (evilURL)  由用户提供，存在被替换为恶意文件的风险。
*   **msfvenom参数：**  PoC脚本直接调用msfvenom生成payload，如果攻击者修改msfvenom的参数，可以生成包含恶意功能的payload。

总体而言，由于大部分操作依赖用户提供的参数和配置，直接投毒的可能性较低，主要风险在于用户配置不当或使用恶意 payload。投毒风险评估为10%。

**利用方式：**

1.  **准备：** 使用 `msfvenom` 生成反向 shell payload，并在攻击者控制的服务器上启动 HTTP 服务以提供 payload 下载。
2.  **构造恶意请求：**  利用 WFS GetPropertyValue 请求，在 `valueReference` 参数中注入恶意代码，通过 `exec` 函数执行系统命令。
3.  **下载 Payload：** 使用 `wget` 命令从攻击者控制的服务器下载反向 shell payload。
4.  **执行 Payload：**  使用 `chmod +x` 命令赋予 payload 执行权限，然后执行 payload 以获得反向 shell。

**项目地址:** [daniellowrie/CVE-2024-36401-PoC](https://github.com/daniellowrie/CVE-2024-36401-PoC)

**漏洞详情:** [CVE-2024-36401](https://nvd.nist.gov/vuln/detail/CVE-2024-36401)