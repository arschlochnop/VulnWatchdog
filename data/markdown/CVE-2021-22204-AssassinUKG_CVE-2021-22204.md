## CVE-2021-22204 - ExifTool DjVu 远程代码执行

**漏洞编号:** CVE-2021-22204

**漏洞类型:** 远程代码执行

**影响应用:** ExifTool

**危害等级:** 高危，可能导致服务器被控制

**影响版本:** >=7.44, <12.24

**利用条件:** 需要目标系统安装了受影响版本的ExifTool，并且能够处理DjVu文件。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

该漏洞存在于ExifTool的DjVu文件解析模块中，由于对用户提供的数据未进行充分的过滤，导致攻击者可以在DjVu文件中嵌入恶意的Perl代码，当ExifTool解析该文件时，嵌入的Perl代码会被执行，从而实现远程代码执行。 

**漏洞利用方式：**

1.  攻击者构造一个恶意的DjVu文件，其中包含嵌入的Perl代码。可以使用提供的脚本生成payload。
2.  将该DjVu文件嵌入到另一个文件中，例如JPG。提供的脚本使用 `exiftool` 工具将恶意的DjVu文件写入到目标图像文件的HasselbladExif元数据中。
3.  诱骗受害者使用受影响版本的ExifTool处理该文件。
4.  当ExifTool解析该文件时，DjVu文件中的恶意Perl代码将被执行，攻击者从而控制系统。

**关于投毒风险的评估：**

虽然提供的脚本可以成功利用该漏洞，但仍然存在轻微的投毒风险。风险主要在于：

*   脚本需要用户手动安装 `djvulibre-bin`，如果用户从非官方渠道获取该软件包，可能存在恶意软件。
*   脚本本身可能包含后门代码，但经过分析，其中植入后门的概率较低，脚本主要是生成expolit.djvu,然后通过exiftool写入到图片中。因此,投毒概率为5%。

**项目地址:** [AssassinUKG/CVE-2021-22204](https://github.com/AssassinUKG/CVE-2021-22204)

**漏洞详情:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)