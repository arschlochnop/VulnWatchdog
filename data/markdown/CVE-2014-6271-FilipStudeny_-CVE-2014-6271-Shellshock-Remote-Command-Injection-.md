## CVE-2014-6271 Shellshock

**漏洞编号:** CVE-2014-6271

**漏洞类型:** 远程命令执行

**影响应用:** GNU Bash

**危害等级:** 高危，可能导致远程代码执行和系统控制

**影响版本:** <= 4.3

**利用条件:** 目标系统存在CGI脚本，且配置不当允许通过HTTP Headers传递环境变量。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2014-6271，也被称为Shellshock，是一个存在于GNU Bash中的高危漏洞。该漏洞允许攻击者通过在环境变量中嵌入恶意代码，当Bash shell执行这些环境变量时，从而执行任意命令。

**有效性：**
根据漏洞库信息和搜索结果，此漏洞利用代码（Shellshock.py）有效。 搜索结果中多个链接都指向了该漏洞的细节和利用方法，证明了该漏洞的可利用性。漏洞利用代码本身也提供了两种payload：反向shell和文件浏览，具有一定的利用价值。

**投毒风险：**
分析提供的Python脚本 `Shellshock.py` ，代码主体结构清晰，主要功能是构造包含恶意代码的HTTP请求头，并发送到目标服务器。代码中存在一定的投毒风险，主要体现在以下几个方面：

*   **payload的可定制性：** 脚本允许用户自定义payload，这本身不是问题。但如果攻击者替换或修改了默认的payload生成方式，可能会插入恶意代码，例如，下载并执行其他恶意脚本。
*   **CGI路径：** 脚本中包含一些常见的CGI路径，攻击者可能通过修改这些路径来尝试不同的攻击目标。
*   **回连地址：** reverse shell需要指定lhost和lport，如果作者在代码中预设了后门地址，可能导致攻击者在不知情的情况下，将shell反弹给作者。但是，代码中这两个参数由用户指定，降低了直接投毒的风险。
*   **代码混淆：** 代码没有进行明显的混淆，可读性较强，降低了隐藏恶意代码的概率。

综合考虑，认为此POC存在10%的投毒风险，主要是因为payload的可定制性，可能被用于传播修改后的恶意脚本。需要仔细审查代码，尤其关注payload生成和CGI路径部分。

**利用方式：**
利用方式是利用Bash解析环境变量时存在的漏洞，通过构造恶意的HTTP请求头（例如Cookie或Referer），在其中嵌入包含恶意代码的函数定义。当目标服务器上的Bash shell执行CGI脚本时，会解析这些HTTP头，从而触发漏洞，执行攻击者注入的命令。具体步骤如下：

1.  **确定目标：** 找到存在CGI脚本且可能受Shellshock影响的服务器。
2.  **构造Payload：** 根据需要选择payload类型（反向shell或文件浏览），并设置相应的参数（例如lhost、lport、echo）。
3.  **发送请求：** 使用`Shellshock.py`脚本构造包含恶意payload的HTTP请求，并发送到目标服务器的CGI脚本。
4.  **执行命令：** 如果目标存在漏洞，Bash shell会执行payload中的恶意代码，例如建立反向shell连接或执行文件浏览命令，并将结果返回给攻击者。

**项目地址:** [FilipStudeny/-CVE-2014-6271-Shellshock-Remote-Command-Injection-](https://github.com/FilipStudeny/-CVE-2014-6271-Shellshock-Remote-Command-Injection-)

**漏洞详情:** [CVE-2014-6271](https://nvd.nist.gov/vuln/detail/CVE-2014-6271)