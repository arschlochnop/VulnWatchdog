## CVE-2024-4577-PHP-CGI参数注入-RCE

**漏洞编号:** CVE-2024-4577

**漏洞类型:** PHP-CGI参数注入

**影响应用:** PHP

**危害等级:** 高危，可导致远程代码执行

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8

**利用条件:** Windows系统，运行于CGI模式，启用了使用"Best Fit"策略的代码页，使用Apache服务器。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2024-4577是一个存在于Windows环境下PHP-CGI模式中的参数注入漏洞。当系统配置为使用某些代码页时，Windows可能会使用"Best-Fit"策略替换传递给Win32 API函数的命令行中的字符。PHP CGI模块可能会错误地将这些字符解释为PHP选项，从而允许恶意用户将选项传递给正在运行的PHP二进制文件，进而泄露脚本源代码或在服务器上执行任意PHP代码。

**利用方式：**

1.  攻击者通过构造包含特殊字符的URL发起请求。
2.  Windows的"Best-Fit"策略将这些特殊字符转换为其他字符。
3.  PHP-CGI错误地将转换后的字符解析为PHP选项。
4.  攻击者利用这些选项执行恶意PHP代码，例如包含`auto_prepend_file=php://input`，之后post恶意的php代码达到RCE。

**有效性：**

提供的PoC代码 (`CVE-2024-4577.py`) 是一个扫描器，用于检测目标URL是否存在CVE-2024-4577漏洞。它通过发送包含PHP代码的POST请求，然后验证响应中是否包含预期的MD5哈希值，以此判断目标是否易受攻击。根据搜索引擎的结果，此漏洞存在公开的利用方法。综合来看，该POC代码是有效的，可以用来检测漏洞。

**投毒风险：**

分析提供的PoC代码和相关文件，`CVE-2024-4577.py`的功能是检测漏洞是否存在，其逻辑相对简单，主要通过发送包含PHP代码的POST请求来验证。`README.md`文件描述了如何使用该脚本以及漏洞的基本信息。

`exploit.py`文件没有给出，从README.MD的描述看，存在利用代码的可能性。但从整体的漏洞描述和PoC scanner的代码来看，风险较低。总体风险概率估计为1%。主要考虑是`exploit.py`如果存在，可能存在后门代码或者植入恶意脚本的可能。鉴于其他代码的简洁性，暂且认为`exploit.py`如果存在也是为了完成漏洞验证和利用，投毒风险较低。

综上所述，该存储库的投毒风险较低，主要集中在`exploit.py`可能存在的恶意行为。

**项目地址:** [r0otk3r/CVE-2024-4577](https://github.com/r0otk3r/CVE-2024-4577)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)