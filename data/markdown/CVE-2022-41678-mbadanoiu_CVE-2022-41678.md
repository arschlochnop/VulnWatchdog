## CVE-2022-41678: Apache ActiveMQ Jolokia API 远程代码执行

**漏洞编号:** CVE-2022-41678

**漏洞类型:** 远程代码执行

**影响应用:** Apache ActiveMQ

**危害等级:** 高危，可以导致服务器完全控制

**影响版本:** < 5.16.6, 5.17.0 <= version < 5.17.4

**利用条件:** 需要ActiveMQ实例启用了Jolokia API，并且攻击者需要有效的管理员凭据（默认admin:admin）

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-41678漏洞源于Apache ActiveMQ中Jolokia API权限限制不足，导致经过身份验证的用户可以执行任意代码。漏洞利用涉及以下步骤：

1.  **身份验证：**  攻击者需要ActiveMQ Web控制台或Jolokia API的有效管理员凭据（默认admin:admin）。
2.  **MBeans枚举：**  攻击者通过Jolokia API列出和检查暴露的MBeans。
3.  **攻击向量选择：**  攻击者可以利用以下攻击向量之一：
    *   **Log4J注入：**  利用Log4J MBeans执行任意文件写入、读取或SSRF，最终实现远程代码执行（依赖于环境，高版本JDK默认不允许远程加载）。
    *   **Java Flight Recorder (JFR)：**  利用JFR MBean创建新的录制，设置包含恶意JSP代码的配置，启动录制，并将录制内容复制到Web目录下的JSP文件，从而执行任意代码（适用于Java 11及以上版本）。
4.  **代码执行：** 通过写入的webshell或log4j的特性执行任意代码，完全控制服务器。

**关于投毒风险：**

POC代码的README.md文件没有直接包含恶意代码，提供的链接指向了已知安全研究人员和vulhub仓库，相对可信。但是，任何公开的POC都存在被修改和恶意分发的潜在风险。需要注意以下几点：

*   **依赖项：**  如果POC依赖于外部库或脚本，则存在依赖项投毒的风险。
*   **下载源：**  确保从可信的源下载POC代码。
*   **代码审查：**  即使是来自可信来源的代码，也应该进行代码审查，以确保其中没有隐藏的恶意逻辑。

此仓库中存在作者隐藏的投毒代码的可能性较低，可能为10%。

**项目地址:** [mbadanoiu/CVE-2022-41678](https://github.com/mbadanoiu/CVE-2022-41678)

**漏洞详情:** [CVE-2022-41678](https://nvd.nist.gov/vuln/detail/CVE-2022-41678)