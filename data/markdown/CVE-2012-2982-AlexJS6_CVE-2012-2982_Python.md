## CVE-2012-2982-Webmin-命令注入

**漏洞编号:** CVE-2012-2982

**漏洞类型:** 命令注入

**影响应用:** Webmin

**危害等级:** 高危，允许远程攻击者执行任意命令

**影响版本:** <= 1.590

**利用条件:** 需要Webmin的远程访问，并且需要已认证的用户权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2012-2982 漏洞存在于 Webmin 1.590 及更早版本的 `file/show.cgi` 文件中。远程已认证用户可以通过在文件路径名中使用无效字符（例如 `|` 管道符）来执行任意命令。 

**利用方式分析：**

1.  **身份验证：** 首先，攻击者需要通过 `session_login.cgi` 脚本进行身份验证。POC 代码使用 `requests.post` 发送包含用户名和密码的 POST 请求，并检查响应状态码和 `sid` cookie 来验证登录是否成功。
2.  **构造Payload：** `payload()` 函数构造一个反向 shell payload。该 payload 使用 `bash -c` 执行一个 bash 命令，将输入/输出重定向到攻击者的机器 (`LHOST` 和 `LPORT`)。
3.  **命令注入：** POC 代码的关键在于构造 `exp` 变量，该变量包含了漏洞利用的 URL。它将恶意 payload 插入到 `file/show.cgi` 的 URL 中，使用管道符 `|` 将文件名和命令分隔开，从而利用命令注入漏洞。
4.  **发送请求：** 使用 `requests.post` 发送包含 `sid` cookie 的 POST 请求到构造的 URL (`exp`)。

**有效性评估：**

POC 代码利用了 `file/show.cgi` 中的命令注入漏洞，通过构造包含管道符的 URL，可以将任意命令注入到 Webmin 服务器上执行。代码首先尝试登录，成功后构造包含反向 shell payload 的 URL，然后发送请求，如果目标存在漏洞，则可以获得一个反向 shell。

**投毒风险分析：**

该 POC 代码相对简单，主要功能集中在利用漏洞获取反向 shell。投毒风险较低，大约 10%。可能的投毒方式包括：

*   **修改反向 shell 地址：** 作者可以将 `LHOST` 修改为恶意地址，使得其他使用者在不知情的情况下将 shell 反弹到攻击者的服务器。
*   **添加额外命令：** 作者可以在 payload 中添加额外的命令，例如下载和执行恶意文件。
*   **后门账户：** 在成功登录之后，植入一个后门账户，方便后续直接登录。

由于代码开源且逻辑清晰，因此大规模投毒的可能性不大，但仍然存在一定的风险。


**项目地址:** [AlexJS6/CVE-2012-2982_Python](https://github.com/AlexJS6/CVE-2012-2982_Python)

**漏洞详情:** [CVE-2012-2982](https://nvd.nist.gov/vuln/detail/CVE-2012-2982)