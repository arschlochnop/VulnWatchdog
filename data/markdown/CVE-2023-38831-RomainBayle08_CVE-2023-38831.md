## CVE-2023-38831 WinRAR 远程代码执行

**漏洞编号:** CVE-2023-38831

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** WinRAR

**危害等级:** 高危，可能导致远程代码执行和系统完全控制

**影响版本:** < 6.23

**利用条件:** 用户需要使用受影响的WinRAR版本打开恶意构造的ZIP或RAR压缩文件。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-38831 漏洞存在于 WinRAR 6.23 之前的版本中。攻击者可以创建一个特殊的 ZIP 压缩文件，该文件包含一个看似无害的文件（例如，.JPG 文件）和一个与该文件同名的文件夹。当用户尝试查看压缩文件中的无害文件时，WinRAR 会错误地执行文件夹中的内容，从而导致任意代码执行。

**有效性分析：**
提供的 POC 代码 `cve-2023-38831-exp-gen.py` 是一个漏洞利用生成器脚本，它接受诱饵文件 (`BAIT_NAME`)、脚本文件 (`SCRIPT_NAME`) 和额外的诱饵文件目录 (`BAIT_FILES`) 作为输入，并生成一个恶意 RAR 压缩文件 (`OUTPUT_NAME`)。脚本首先创建一个包含诱饵文件和脚本文件的临时目录结构，然后使用 `shutil.make_archive` 函数将该目录压缩为 ZIP 文件。关键在于，脚本会替换 ZIP 文件中特定文件的扩展名，利用 WinRAR 的漏洞，在用户尝试打开诱饵文件时执行脚本文件。`script.bat` 脚本会首先尝试打开诱饵文件（模拟用户行为），然后执行 `calc.exe`（作为漏洞利用成功的标志）。该 POC 的有效性较高，因为它模拟了真实的攻击场景。

**投毒风险分析：**
`cve-2023-38831-exp-gen.py` 脚本本身不包含明显的恶意代码或后门。但是，存在一定的投毒风险，因为该脚本允许攻击者指定要执行的任意脚本 (`SCRIPT_NAME`)。攻击者可以替换 `script.bat` 文件为包含恶意代码的文件，例如下载和执行其他恶意软件。此外，该脚本使用了`BAIT_FILES`参数，如果提供包含恶意文件的目录，也会构成投毒风险。所以存在一定投毒风险，但主要取决于用户提供的脚本和目录的内容。

**利用方式分析：**
1.  攻击者构造一个恶意 ZIP 压缩文件，其中包含一个诱饵文件（如 `CLASSIFIED_DOCUMENTS.pdf`）和一个与诱饵文件同名的文件夹。文件夹中包含一个脚本文件（如 `script.bat`）。
2.  攻击者将恶意 ZIP 文件发送给受害者，诱骗其使用 WinRAR 打开。
3.  当受害者尝试查看 ZIP 文件中的诱饵文件时，WinRAR 会错误地执行同名文件夹中的脚本文件。
4.  脚本文件执行任意代码，例如安装恶意软件或窃取敏感信息。

总的来说，该漏洞利用方式简单有效，风险较高。用户应尽快升级到 WinRAR 6.23 或更高版本。

**项目地址:** [RomainBayle08/CVE-2023-38831](https://github.com/RomainBayle08/CVE-2023-38831)

**漏洞详情:** [CVE-2023-38831](https://nvd.nist.gov/vuln/detail/CVE-2023-38831)