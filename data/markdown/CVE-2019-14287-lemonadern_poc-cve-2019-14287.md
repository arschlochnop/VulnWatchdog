## CVE-2019-14287

**漏洞编号:** CVE-2019-14287

**漏洞类型:** 权限提升/安全策略绕过

**影响应用:** Sudo

**危害等级:** 高危，允许普通用户以root权限执行命令，导致系统完全控制

**影响版本:** < 1.8.28

**利用条件:** 攻击者需要拥有在sudoers文件中被配置为`Runas ALL`权限的用户账户，但显式禁止root权限。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2019-14287漏洞允许具有`Runas ALL`权限的用户通过指定特殊的UserID（如`-1`或`4294967295`）来绕过sudo的安全策略，以root身份执行命令。即使sudoers文件明确禁止该用户以root身份运行命令，该漏洞仍然有效。

**有效性分析：**
提供的Dockerfile配置了一个存在漏洞的Sudo版本（1.8.21p2），并创建了一个名为user1的用户，该用户在sudoers文件中被赋予`ALL=(ALL, !root) NOPASSWD: ALL`权限。这意味着user1可以以任何用户的身份运行任何命令，但root除外。利用代码展示了如何通过`sudo -u#-1 whoami`命令绕过此限制，并以root身份执行`whoami`命令。因此，提供的POC代码是有效的。

**投毒风险分析：**
Dockerfile的内容主要用于搭建漏洞环境，其中包含下载特定版本sudo，创建用户并赋予sudo权限等常规操作，没有发现明显的恶意代码。
LICENSE文件采用MIT License，比较宽松，存在被恶意利用的可能性，但其本身不构成投毒。
README.md文件仅为漏洞演示说明，没有发现恶意代码。
docker-compose.yml文件定义了Docker容器的配置，也没有发现恶意代码。
综合判断，该仓库的投毒风险较低，约为5%。该风险主要来源于MIT协议的宽松性，攻击者可能利用该协议发布修改后的恶意版本。

**利用方式：**
1.  攻击者需要获得一个在sudoers文件中被授予`Runas ALL`权限的帐户，例如`user1 ALL=(ALL, !root) NOPASSWD: ALL`，但被显式禁止以root身份运行命令。
2.  攻击者使用`sudo -u#-1 <command>`或`sudo -u#4294967295 <command>`命令执行任意命令，这些命令将以root权限运行。
3.  Sudo在处理UserID时，将`-1`或`4294967295`错误地解释为UID 0（root），从而绕过了sudoers文件中对root用户的限制。

**项目地址:** [lemonadern/poc-cve-2019-14287](https://github.com/lemonadern/poc-cve-2019-14287)

**漏洞详情:** [CVE-2019-14287](https://nvd.nist.gov/vuln/detail/CVE-2019-14287)