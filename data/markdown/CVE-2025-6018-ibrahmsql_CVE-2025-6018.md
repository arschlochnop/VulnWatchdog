## CVE-2025-6018 PAM 本地权限提升漏洞

**漏洞编号:** CVE-2025-6018

**漏洞类型:** 本地权限提升 (LPE)

**影响应用:** PAM (Pluggable Authentication Modules)

**危害等级:** 高危，攻击者可利用此漏洞获得系统完全控制权限

**影响版本:** PAM 1.3.0 - 1.6.0 (受影响版本)

**利用条件:** 需要本地用户权限，可以通过SSH等方式登录系统

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2025-6018 是一个 PAM (Pluggable Authentication Modules) 中的本地权限提升漏洞。该漏洞允许一个非特权本地攻击者获得通常保留给物理存在的 "allow_active" 用户的提升权限。根据搜索结果，此漏洞与 CVE-2025-6019 常常被链接在一起利用，可以获得 root 权限。漏洞存在于pam-config中。

**有效性评估：**
提供的 POC 代码是一个 Python 脚本，它利用了 PAM 的 `pam_env.so` 模块中的一个环境变量注入漏洞。攻击者通过在 `~/.pam_environment` 文件中注入恶意环境变量，可以操纵 SystemD 会话，最终提升权限。

脚本包含以下步骤：
1.  **漏洞检测：** 脚本首先尝试检测目标系统上 PAM 的版本以及 `pam_env.so` 和 `pam_systemd.so` 是否被配置使用。它检查 `rpm -q pam` 或 `dpkg -l | grep libpam`的输出，寻找易受攻击的版本字符串，然后尝试使用 find 命令和 grep 命令查找包含'pam_env'和'pam_systemd'的文件。
2.  **恶意环境创建：** 如果系统被判断为易受攻击，脚本会创建一个恶意的 `~/.pam_environment` 文件，其中包含覆盖 XDG 和 SYSTEMD 环境变量的 payload。
3.  **权限提升测试：** 脚本尝试使用 `gdbus call` 命令来触发权限提升，例如尝试重启系统。

根据漏洞库信息和搜索结果，此漏洞是真实存在的，且多个来源表明存在可利用的 PoC 代码。

**投毒风险评估：**
阅读给出的 POC 脚本`CVE-2025-6018.py` ，发现此脚本的logger记录了详细的操作步骤以及相关命令，这些日志信息会写入到`cve_2025_6018_exploit.log`文件中。由于脚本使用了标准库paramiko进行SSH连接，没有发现直接执行恶意代码或者下载恶意文件的代码。该脚本主要目的是通过环境变量注入来利用漏洞，相对比较透明。

但是，任何 PoC 代码都存在一定的风险，例如：
*   **意外的副作用：** 即使 PoC 代码的目的是提权，但错误的使用方式可能会导致系统不稳定或其他问题。
*   **代码作者的恶意行为：** 尽管代码本身看起来是良性的，但作者可能在其他地方隐藏了恶意代码。虽然该脚本没有发现明显的恶意行为，但不能完全排除作者通过其他方式（例如，使用混淆的代码或利用未知的漏洞）来植入后门的可能。
考虑到以上风险，这里给出10%的投毒风险评估。

**利用方式：**
1.  **SSH 登录：** 攻击者需要具有目标系统的 SSH 登录凭据（用户名和密码）。
2.  **执行 PoC 脚本：** 攻击者将 PoC 脚本上传到目标系统，并使用 Python 解释器执行它。
3.  **权限提升：** 脚本会检测系统是否易受攻击，然后创建一个恶意的 `~/.pam_environment` 文件。当下一次用户登录或启动新会话时，PAM 会读取这个文件，设置被篡改的环境变量，从而允许攻击者执行特权操作。

总而言之，该漏洞是一个严重的安全问题，可被攻击者利用来获得受影响系统的完全控制权限。系统管理员应尽快应用补丁。

**项目地址:** [ibrahmsql/CVE-2025-6018](https://github.com/ibrahmsql/CVE-2025-6018)

**漏洞详情:** [CVE-2025-6018](https://nvd.nist.gov/vuln/detail/CVE-2025-6018)