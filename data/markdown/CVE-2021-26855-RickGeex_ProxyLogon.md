## CVE-2021-26855 Microsoft Exchange Server 远程代码执行漏洞 (ProxyLogon)

**漏洞编号:** CVE-2021-26855

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Microsoft Exchange Server

**危害等级:** 高危，允许未经身份验证的攻击者在Exchange服务器上执行任意代码

**影响版本:** Microsoft Exchange Server 2013 Cumulative Update 21, 22, 23; 2016 Cumulative Update 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19; 2019 Cumulative Update 1, 2, 3, 4, 5, 6, 7, 8

**利用条件:** 目标Exchange服务器存在漏洞且网络可达

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2021-26855 是一个存在于 Microsoft Exchange Server 中的服务器端请求伪造 (SSRF) 漏洞，属于 ProxyLogon 攻击链的一部分。攻击者可以利用此漏洞绕过身份验证，发送任意 HTTP 请求，并最终以 SYSTEM 权限执行任意代码。

**利用方式：**

1.  **SSRF (CVE-2021-26855)：** 攻击者首先利用 SSRF 漏洞，通过构造特制的 HTTP 请求，绕过身份验证。
2.  **获取 LegacyDN：**  利用autodiscover.xml获取LegacyDN信息。
3.  **获取SID：** 使用/mapi/emsmdb端点获取Security ID (SID)。
4.  **添加邮箱权限：**  使用获取的 SID，攻击者可以模拟管理员用户，并向任意邮箱添加访问权限。
5.  **写入 Webshell：**  最终，攻击者可以通过写入 Webshell 等方式在服务器上执行任意代码，控制服务器。

**有效性评估：**

提供的 POC 代码 `ProxyLogon.py` 实现了 ProxyLogon 攻击链的前几个阶段，包括 FQDN 解析、LegacyDN 获取和 SID 获取。根据漏洞库信息和搜索结果，此漏洞已被广泛利用，POC 代码的有效性较高。

**投毒风险分析：**

该POC本身目的是复现漏洞利用，如果恶意修改payload内容，比如在stage3/4中通过执行命令添加恶意账户、安装后门，的确存在投毒的风险。目前看代码本身是为了漏洞复现，没有发现明显的恶意代码。但是不能排除被修改后进行传播的可能性，因此评估投毒风险为 5%。

**项目地址:** [RickGeex/ProxyLogon](https://github.com/RickGeex/ProxyLogon)

**漏洞详情:** [CVE-2021-26855](https://nvd.nist.gov/vuln/detail/CVE-2021-26855)