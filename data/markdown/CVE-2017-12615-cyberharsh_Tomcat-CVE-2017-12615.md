## CVE-2017-12615 Apache Tomcat Remote Code Execution

**漏洞编号:** CVE-2017-12615

**漏洞类型:** 远程代码执行

**影响应用:** Apache Tomcat

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** 7.0.0 to 7.0.79 (在Windows上，且`readonly`初始化参数设置为false时)

**利用条件:** 运行在Windows上的Apache Tomcat 7.0.0 to 7.0.79, HTTP PUTs 必须启用 (例如通过设置 `readonly` 初始化参数为 false)

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2017-12615允许攻击者通过发送特制的HTTP PUT请求上传JSP文件到服务器。 如果服务器运行在Windows上，并且启用了HTTP PUT方法（`readonly`参数设置为false）， 攻击者可以上传包含恶意代码的JSP文件，然后通过请求该JSP文件来执行其中的代码， 从而实现远程代码执行。

**利用方式：**

1.  **条件检查:** 确保目标服务器运行在Windows上，并且是受影响的Tomcat版本（7.0.0 to 7.0.79）。 检查DefaultServlet的`readonly`初始化参数是否设置为`false`， 或者确认是否可以发送PUT请求。
2.  **上传恶意JSP文件:**  使用HTTP PUT方法上传一个包含恶意代码的JSP文件。  利用文件系统特性（如在Linux下使用`/`），绕过Tomcat的文件后缀检查。例如，可以使用以下请求：

    ```
    PUT /evil.jsp/ HTTP/1.1
    Host: your-ip:8080
    Accept: \*/\*
    Accept-Language: en
    User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
    Connection: close
    Content-Type: application/x-www-form-urlencoded
    Content-Length: [JSP代码长度]

    [恶意JSP代码]
    ```
3.  **执行恶意代码:**  上传成功后，通过浏览器或HTTP客户端请求上传的JSP文件（例如：`http://your-ip:8080/evil.jsp`），服务器将执行JSP文件中的恶意代码。

**POC有效性:**

提供的Dockerfile修改了Tomcat的`web.xml`文件，将`readonly`参数设置为`false`，从而启用了PUT方法。 README文件描述了利用方法，并提供了示例的HTTP PUT请求，证明了POC的有效性。

**投毒风险分析:**

提供的POC代码中，`Dockerfile`用于构建一个存在漏洞的Tomcat环境，方便漏洞复现。`flagA` 文件只是提供了一个标志，用于验证漏洞是否成功利用。没有发现任何明显的投毒代码， 因此，投毒风险较低（0%）。 该漏洞本身被广泛记录且有已知利用方法，该代码主要用于环境搭建和演示。

**项目地址:** [cyberharsh/Tomcat-CVE-2017-12615](https://github.com/cyberharsh/Tomcat-CVE-2017-12615)

**漏洞详情:** [CVE-2017-12615](https://nvd.nist.gov/vuln/detail/CVE-2017-12615)