## CVE-2024-27815-macOS-XNU内核缓冲区溢出

**漏洞编号:** CVE-2024-27815

**漏洞类型:** 缓冲区溢出

**影响应用:** macOS XNU Kernel

**危害等级:** 高危，可导致内核权限下的任意代码执行

**影响版本:** xnu-10002.1.13 (引入), xnu-10063.121.3 (修复)

**利用条件:** 需要应用有能力进行socket操作

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-27815是macOS XNU内核中的一个缓冲区溢出漏洞。根据漏洞利用代码和搜索结果，该漏洞出现在`sbconcat_mbufs`函数中，当`CONFIG_MBUF_MCACHE`开启时会触发。攻击者可以通过精心构造的数据，利用`socketpair`创建socket，然后通过`bind`操作触发`sbconcat_mbufs`中的溢出，覆盖相邻`mbuf`的`m_hdr`结构，从而控制该`mbuf`的元数据。这允许攻击者在内核上下文中执行任意代码，提升权限。提供的POC代码通过创建socketpair，绑定一个包含恶意m_hdr数据的socket名称到socketpair的一个端点，并写入0字节数据来触发漏洞。根据jprx的github，poc代码利用了绑定socket时发生缓冲区溢出。

**有效性：**
根据搜索结果和提供的利用代码，该POC代码被认为是有效的，因为它能够利用XNU内核中的缓冲区溢出漏洞，实现内核权限下的代码执行。

**投毒风险：**
分析提供的POC代码（TURPENTINE.c），没有发现任何可疑的或恶意的代码段。该代码主要用于演示漏洞的利用，而不是植入后门或执行其他恶意操作。因此，该代码的投毒风险较低，可视为0%。

**利用方式：**
1.  **漏洞触发:** 创建一个socketpair，然后绑定一个长度合适的socket名称到socketpair的一个端点。
2.  **缓冲区溢出:** 漏洞在于`sbconcat_mbufs`函数在处理过大的socket名称时，没有进行充分的边界检查，导致缓冲区溢出。
3.  **内存覆盖:** 通过溢出，攻击者可以覆盖相邻`mbuf`的`m_hdr`结构。
4.  **控制流劫持:** 通过修改`m_hdr`中的指针，可以劫持内核的控制流，执行任意代码，提升权限。

**项目地址:** [jprx/CVE-2024-27815](https://github.com/jprx/CVE-2024-27815)

**漏洞详情:** [CVE-2024-27815](https://nvd.nist.gov/vuln/detail/CVE-2024-27815)