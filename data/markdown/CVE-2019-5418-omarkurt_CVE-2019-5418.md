## CVE-2019-5418 - Rails Action View 文件内容泄露

**漏洞编号:** CVE-2019-5418

**漏洞类型:** 文件内容泄露

**影响应用:** Rails Action View

**危害等级:** 高危，可能导致敏感信息泄露

**影响版本:** < 5.2.2.1, < 5.1.6.2, < 5.0.7.2, < 4.2.11.1, v3

**利用条件:** 目标应用使用受影响的 Rails 版本，并调用了 `render file:` 方法。攻击者需要能够发送带有特制 Accept header 的 HTTP 请求。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-5418 是一个 Rails Action View 组件中的文件内容泄露漏洞。攻击者可以通过构造恶意的 `Accept` HTTP 头，结合使用 `render file:` 方法，来读取服务器上的任意文件。

**有效性：**
从漏洞库信息和搜索结果来看，该漏洞的存在是被广泛确认的，并且存在公开的PoC。提供的 `Gemfile` 和 `Gemfile.lock` 文件定义了一个使用易受攻击的 Rails 版本的应用程序，表明PoC是有效的，因为漏洞存在于该版本中。缺少实际的利用代码，`Gemfile` 只是搭建环境，但可以推断使用特制的 `Accept` 头来触发漏洞。

**投毒风险：**
提供的代码只是 `Gemfile` 和 `Gemfile.lock`，用于设置一个易受攻击的 Rails 环境。没有直接的恶意代码。但是，在实际利用过程中，攻击者可能会修改 Rails 应用的代码或依赖项，从而引入后门或恶意功能。由于这些文件定义了项目的依赖，如果攻击者控制了这些文件，就可以引入恶意的 gem 包，从而实现投毒。例如，可以使用恶意的gem替换正常的gem，或者通过`git_source`指定恶意的github仓库。然而，根据提供的文件，投毒的可能性较低，因为只是简单的项目依赖配置文件。因此，投毒风险估计为10%。

**利用方式：**
1.  **发送恶意请求：** 攻击者需要向目标 Rails 应用发送带有特制 `Accept` 头的 HTTP 请求。这个 `Accept` 头包含指向目标文件系统的路径，例如 `/etc/passwd`。关键在于构造特殊的 `Accept` 头来绕过 Rails 的安全检查。
2.  **触发 `render file:`：** 受影响的 Rails 应用必须调用 `render file:` 方法，并且传入的文件路径会受到 `Accept` 头的控制。
3.  **文件内容泄露：** 如果 `Accept` 头构造正确并且 `render file:` 被触发，Rails 会将目标文件的内容作为响应返回给攻击者。
4.  **路径遍历：** 攻击者可以使用路径遍历技巧（例如 `../`）来访问应用根目录之外的文件。

**项目地址:** [omarkurt/CVE-2019-5418](https://github.com/omarkurt/CVE-2019-5418)

**漏洞详情:** [CVE-2019-5418](https://nvd.nist.gov/vuln/detail/CVE-2019-5418)