## CVE-2017-0144 - Windows SMB 远程代码执行

**漏洞编号:** CVE-2017-0144

**漏洞类型:** 远程代码执行

**影响应用:** Windows SMBv1

**危害等级:** 高危，允许远程攻击者执行任意代码

**影响版本:** Windows Vista SP2; Windows Server 2008 SP2 and R2 SP1; Windows 7 SP1; Windows 8.1; Windows Server 2012 Gold and R2; Windows RT 8.1; and Windows 10 Gold, 1511, and 1607; and Windows Server 2016

**利用条件:** 目标系统开启SMBv1服务，攻击者可以访问目标系统的445端口。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2017-0144 漏洞，又名“永恒之蓝”(EternalBlue)，是一个存在于 Windows SMBv1 服务器中的远程代码执行漏洞。攻击者可以通过发送特制的 SMB 数据包利用此漏洞，从而在目标系统上执行任意代码。 

**有效性：**
根据漏洞库信息和搜索结果，此漏洞的POC代码（例如Exploit-DB上的42031, 42030, 41891, 41987）是有效的。提供的利用代码展示了利用 Metasploit 框架攻击 Windows Server 2008 R2 的过程，包括IP地址扫描、漏洞检测、利用模块选择、参数配置和执行等步骤，证明了POC的有效性。

**投毒风险：**
提供的POC代码看起来是一个教程，演示如何使用 Metasploit 框架中的 EternalBlue 漏洞利用模块。其中使用了一些外部链接，包括导入虚拟机镜像的链接，以及微软官方的补丁下载链接。虽然这个文档本身看起来没有明显的恶意代码，但是它依赖于外部资源，存在一定的投毒风险，例如：
*   虚拟机镜像可能包含恶意软件。
*   如果用户复制粘贴命令，攻击者可能通过修改教程内容，插入恶意命令。
*   即使使用Metasploit本身也存在风险，如果攻击者的Metasploit环境被篡改，可能执行恶意代码。

考虑到这些因素，投毒风险评估为 10%。

**利用方式：**
1.  **信息收集：** 使用IP扫描工具（如Advanced IP Scanner）和端口扫描工具（如Nmap）确定目标系统的IP地址和开放端口，并检测是否存在SMBv1服务。
2.  **漏洞检测：** 使用Nmap脚本（如`smb-vuln-ms17-010`）或Metasploit辅助模块检测目标系统是否存在CVE-2017-0144漏洞。
3.  **漏洞利用：** 使用Metasploit框架中的`exploit/windows/smb/ms17_010_eternalblue`模块。设置`RHOSTS`为目标IP地址，并根据需要配置其他参数（如payload）。执行`exploit`命令，成功后将在目标系统上获得一个Meterpreter会话。
4.  **后渗透：** 使用Meterpreter会话执行任意命令，例如获取系统信息、创建用户、安装后门等。示例代码展示了创建用户`zack`并将其添加到管理员组的过程，以及使用RDP登录目标系统的步骤。
5.  **补丁修复:** 下载安装微软官方提供的补丁，禁用SMBv1协议。

**项目地址:** [EEsshq/CVE-2017-0144---EtneralBlue-MS17-010-Remote-Code-Execution](https://github.com/EEsshq/CVE-2017-0144---EtneralBlue-MS17-010-Remote-Code-Execution)

**漏洞详情:** [CVE-2017-0144](https://nvd.nist.gov/vuln/detail/CVE-2017-0144)