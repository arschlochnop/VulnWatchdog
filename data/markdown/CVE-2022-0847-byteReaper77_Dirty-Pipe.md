## CVE-2022-0847 - Dirty Pipe

**漏洞编号:** CVE-2022-0847

**漏洞类型:** 本地权限提升

**影响应用:** Linux Kernel

**危害等级:** 高危，允许非特权用户覆盖只读文件并提升权限

**影响版本:** 5.8 <= version <= 5.16

**利用条件:** 本地用户访问权限，目标系统运行受影响的Linux内核版本

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-0847 (Dirty Pipe) 是一个存在于 Linux 内核 5.8 到 5.16 版本的本地权限提升漏洞。该漏洞源于内核在处理管道缓冲区时缺乏适当的初始化，导致非特权用户能够覆盖只读文件，包括 SUID 可执行文件，从而提升到 root 权限。

**有效性：**

提供的 PoC 代码利用了 Dirty Pipe 漏洞，可以有效实现本地权限提升。搜索引擎结果表明该漏洞已存在公开可用的 PoC，漏洞利用的有效性较高。

**投毒风险：**

分析提供的 PoC 代码，主要包含 `LICENSE`, `README.md`, `dirtypipe.c` 三个文件。`LICENSE` 为 MIT 许可证， `README.md` 描述了漏洞原理、利用方法、先决条件和免责声明。`dirtypipe.c` 为 C 语言编写的漏洞利用代码，其中包含了反调试机制，使得分析更加困难。代码本身用于利用 Dirty Pipe 漏洞，但不能排除作者加入恶意代码的可能性。由于需要编译运行，存在潜在的风险，评估投毒风险为 5% 。这个风险主要考虑到代码复杂度较高，人工审计难以覆盖所有角落，以及编译过程可能引入恶意代码。

**利用方式：**

1.  **环境准备：** 需要一个运行在受影响内核版本（5.8 到 5.16）的 Linux 系统，并确保具有本地用户访问权限。
2.  **编译 PoC 代码：** 使用 `gcc dirtypipe.c -Wall -O2 -fno-pie -no-pie -o dirtypipe` 命令编译 PoC 代码。
3.  **寻找目标 SUID 程序：**  选择一个可利用的 SUID 程序作为目标，例如 `passwd` 命令或其他具有 SUID 权限的可执行文件。
4.  **运行 PoC 代码：** 运行编译后的 `dirtypipe` 程序，并指定目标 SUID 程序的路径。
5.  **权限提升：**  PoC 代码会利用 Dirty Pipe 漏洞覆盖 SUID 程序的内容，然后执行被覆盖的程序，从而获得 root 权限。
6.  **清理（可选）：**  PoC 代码可能会尝试恢复原始的 SUID 程序，以避免引起注意，但通常建议手动检查和清理。

总而言之，该漏洞的利用方式是通过 Dirty Pipe 漏洞，将恶意代码注入到具有root权限的文件中，然后执行该文件以获得权限提升。

**项目地址:** [byteReaper77/Dirty-Pipe](https://github.com/byteReaper77/Dirty-Pipe)

**漏洞详情:** [CVE-2022-0847](https://nvd.nist.gov/vuln/detail/CVE-2022-0847)