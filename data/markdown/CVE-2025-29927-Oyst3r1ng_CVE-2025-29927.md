## CVE-2025-29927-Next.js Middleware Authorization Bypass

**漏洞编号:** CVE-2025-29927

**漏洞类型:** 认证绕过

**影响应用:** Next.js

**危害等级:** 高危，可能导致未授权访问和数据泄露

**影响版本:** Next.js 11.1.4 ~ 13.5.6, Next.js 14.0.0 ~ 14.2.25, Next.js 15.0.0 ~ 15.2.3

**利用条件:** 目标应用使用Next.js中间件进行认证，且版本在受影响范围内。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2025-29927 漏洞存在于 Next.js 的中间件中，允许攻击者绕过身份验证。该漏洞的利用方式是：通过在请求头中添加 `x-middleware-subrequest` 字段，并将其值设置为包含足够数量的中间件名称（默认为 `middleware`，可以通过params.name查看）的字符串，从而触发 Next.js 中间件的递归深度检查。当递归深度达到或超过阈值（`MAX_RECURSION_DEPTH = 5`）时，中间件会跳过认证逻辑，导致认证绕过。

POC 代码通过发送带有构造好的 `x-middleware-subrequest` 头部的请求到受保护的 `/admin` 路径来验证漏洞的存在。如果状态码从正常请求的状态码变为200，则表示漏洞存在。

**投毒风险分析：**

*   **Poc_CVE-2025-29927.py：** 该 POC 看起来相对安全。它使用 `pocsuite3` 框架，并且其主要目的是验证漏洞是否存在。验证逻辑是检查状态码是否发生变化。 没有明显的后门或恶意代码。
*   **README.md：** 描述了环境搭建和漏洞原理分析，没有发现可疑代码。

**投毒风险评估：**

尽管POC代码本身没有明显的投毒行为，但考虑到以下因素，仍存在一定风险：

1.  **第三方依赖：** `pocsuite3` 是一个第三方框架，需要安装。虽然该框架本身比较成熟，但仍存在被供应链攻击的风险，如果该框架被篡改，可能会引入恶意代码。
2.  **环境搭建：** README.md 中涉及项目源码的摘取和安装依赖，在环境搭建过程中，如果在安装了恶意的依赖包，可能导致系统被植入后门。

综上所述，该仓库存在一定的投毒风险，大概为10%。该风险主要来源于间接的供应链攻击或环境搭建过程中的恶意依赖包。

**利用方式总结：**

1.  确定目标 Next.js 应用使用中间件进行身份验证，且版本在受影响范围内。
2.  构造包含足够数量的中间件名称的 `x-middleware-subrequest` 请求头，例如：`x-middleware-subrequest: middleware:middleware:middleware:middleware:middleware`。
3.  向受保护的路由发送包含该请求头的请求。
4.  如果成功绕过身份验证，则可以访问受保护的资源。

**项目地址:** [Oyst3r1ng/CVE-2025-29927](https://github.com/Oyst3r1ng/CVE-2025-29927)

**漏洞详情:** [CVE-2025-29927](https://nvd.nist.gov/vuln/detail/CVE-2025-29927)