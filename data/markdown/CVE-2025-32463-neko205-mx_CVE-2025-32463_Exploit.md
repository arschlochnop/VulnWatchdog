## CVE-2025-32463-Sudo-本地提权

**漏洞编号:** CVE-2025-32463

**漏洞类型:** 本地提权

**影响应用:** Sudo

**危害等级:** 高危，本地用户可提升至root权限

**影响版本:** 1.9.14 <= version < 1.9.17p1

**利用条件:** 需要本地用户权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2025-32463 是 Sudo 软件中一个严重的安全漏洞，允许本地用户通过 `--chroot` 选项获得 root 权限。漏洞存在于 Sudo 1.9.14 到 1.9.17p1 之间的版本。

**漏洞利用方式：**

1.  **利用 `chroot` 选项:** 该漏洞的核心在于 `sudo` 命令的 `-R` 或 `--chroot` 选项，该选项允许用户在指定的目录中运行命令，如同进入了一个新的根目录环境。由于sudo会使用用户控制目录下的`/etc/nsswitch.conf`。
2.  **控制 `/etc/nsswitch.conf`:** 攻击者可以创建一个恶意的 `/etc/nsswitch.conf` 文件，该文件指示系统从攻击者控制的共享库中加载用户认证信息。在提供的POC中，攻击者创建了一个名为`woot/etc/nsswitch.conf`文件，内容为 `passwd: /woot1337`，这意味着系统将尝试从 `/woot1337` 共享库加载密码数据库。
3.  **共享库注入:** 攻击者创建一个包含恶意代码的共享库，POC中的 `woot1337.c` 包含一个 `woot` 函数，该函数使用 `setreuid(0, 0)` 和 `setregid(0, 0)` 将用户ID和组ID设置为root，然后执行 `/bin/bash`，从而获得root shell。恶意代码会被编译为名为`libnss_/woot1337.so.2`的共享库。
4.  **执行 `sudo -R`:** 最后，攻击者使用 `sudo -R woot woot` 命令，其中 `woot` 是包含恶意 `nsswitch.conf` 文件的目录，第二个 `woot` 似乎是一个占位符参数，通过利用 `chroot`，`sudo` 会使用攻击者提供的 `/etc/nsswitch.conf`，加载恶意的共享库，从而执行其中的恶意代码，最终获得 root 权限。

**有效性：**

根据提供的漏洞信息、搜索结果和漏洞利用代码，该POC代码有效。证据是 `run.sh` 脚本成功执行后，可以获得root shell。

**投毒风险：**

评估 POC 代码的投毒风险时，需要检查代码中是否存在任何隐藏的、非预期的恶意行为。在这个特定的 POC 中，主要风险在于 `woot1337.c` 文件中的代码。该代码的目的是提升权限并生成 root shell，这符合漏洞利用的目标。但是,存在作者在提权后植入后门或执行其他恶意操作的可能性，但根据现有代码无法直接判断，因此存在一定风险。

具体分析：

*   **woot1337.c:** 该文件中的代码是提权的核心，虽然看起来直接，但如果作者在其中添加了额外的代码，例如连接到外部服务器、安装后门、修改系统文件等，就会构成投毒行为。由于代码比较简单，直接读取并执行shell，因此投毒的概率相对较低。 *   **run.sh:** 该脚本主要负责创建环境、编译代码和执行漏洞利用。潜在的投毒风险可能包括在清理阶段删除关键文件、修改其他系统设置等。脚本目前只删除了创建的临时文件，风险较低。

综合来看，该POC代码的投毒风险较低，约为 10%。主要风险在于 `woot1337.c` 是否包含额外的恶意代码。虽然风险不高，但在实际使用时仍需谨慎。

**总结：**

该漏洞利用方式比较直接，利用了 `sudo` 的 `chroot` 选项和对 `nsswitch.conf` 的不安全处理来执行恶意代码。漏洞影响范围明确，利用条件也比较简单，使得它成为一个高危的本地提权漏洞。

**项目地址:** [neko205-mx/CVE-2025-32463_Exploit](https://github.com/neko205-mx/CVE-2025-32463_Exploit)

**漏洞详情:** [CVE-2025-32463](https://nvd.nist.gov/vuln/detail/CVE-2025-32463)