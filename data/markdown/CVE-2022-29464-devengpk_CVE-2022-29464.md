## CVE-2022-29464 - WSO2 Unrestricted File Upload RCE

**漏洞编号:** CVE-2022-29464

**漏洞类型:** 未限制文件上传导致远程代码执行

**影响应用:** WSO2 API Manager, Identity Server, Enterprise Integrator, Open Banking AM/KM

**危害等级:** 严重，允许未经身份验证的攻击者上传恶意文件并在服务器上执行任意代码

**影响版本:** WSO2 API Manager 2.2.0 up to 4.0.0, WSO2 Identity Server 5.2.0 up to 5.11.0, WSO2 Identity Server Analytics 5.4.0, 5.4.1, 5.5.0 and 5.6.0, WSO2 Identity Server as Key Manager 5.3.0 up to 5.11.0, WSO2 Enterprise Integrator 6.2.0 up to 6.6.0, WSO2 Open Banking AM 1.4.0 up to 2.0.0 and WSO2 Open Banking KM 1.4.0, up to 2.0.0

**利用条件:** 需要目标WSO2服务器实例可以通过网络访问，并且存在/fileupload端点。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-29464 漏洞存在于 WSO2 产品中，允许未经授权的文件上传，最终导致远程代码执行。攻击者可以利用 `/fileupload` 端点，通过 `Content-Disposition` 头部进行目录遍历，将恶意 JSP 文件上传到 Web 根目录下的 `repository/deployment/server/webapps` 目录等位置。由于 `/fileupload` 路由未受到身份验证的保护，攻击者无需登录即可利用此漏洞。

**利用方式：**
1.  攻击者构造包含恶意 JSP 代码的文件。
2.  攻击者向 `/fileupload` 端点发送包含 `Content-Disposition` 头部，进行目录遍历的 HTTP 请求，将恶意 JSP 文件上传到服务器的 Web 根目录下的可执行目录，例如 `repository/deployment/server/webapps`。
3.  服务器处理上传请求，并将恶意 JSP 文件写入目标目录。
4.  攻击者通过 Web 浏览器访问上传的 JSP 文件，触发恶意代码执行，从而实现远程代码执行。

**有效性：**
根据提供的漏洞信息、搜索引擎结果和漏洞利用代码，此漏洞利用代码有效。

**投毒风险：**
虽然提供的代码主要描述了漏洞原理，但代码中仍存在小概率潜在的投毒风险。作者可能会在利用代码中添加一些难以察觉的恶意代码，例如反弹 shell 或植入后门等。因此，在使用此类代码时，需要谨慎审查，确保其安全性。初步估计投毒风险为10%。

**项目地址:** [devengpk/CVE-2022-29464](https://github.com/devengpk/CVE-2022-29464)

**漏洞详情:** [CVE-2022-29464](https://nvd.nist.gov/vuln/detail/CVE-2022-29464)