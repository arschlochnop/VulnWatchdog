## CVE-2017-5638 - Apache Struts 2 远程代码执行

**漏洞编号:** CVE-2017-5638

**漏洞类型:** 远程代码执行

**影响应用:** Apache Struts 2

**危害等级:** 高危，允许未经身份验证的远程攻击者执行任意代码

**影响版本:** 2.3.x before 2.3.32, 2.5.x before 2.5.10.1

**利用条件:** 目标系统运行受影响版本的Apache Struts 2，并且可以通过网络访问

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2017-5638 存在于 Apache Struts 2 的 Jakarta Multipart parser 中，由于不正确的异常处理和错误消息生成，远程攻击者可以通过构造恶意的 Content-Type、Content-Disposition 或 Content-Length HTTP 标头执行任意命令。攻击者通常会在 Content-Type 标头中包含 #cmd= 字符串。

**有效性：**
根据漏洞库信息、搜索引擎结果以及提供的漏洞利用代码，可以确定此漏洞是有效的。大量的公开信息和可用的POC代码表明该漏洞已被广泛研究和利用。

**投毒风险：**
提供的代码包含两个文件：dorker.py 和 exploit.py。

*   **dorker.py：** 这是一个用于搜索引擎爬取的脚本，主要用于查找可能存在漏洞的Struts 2应用。它使用Google、Bing、Yahoo和Baidu等搜索引擎来搜索特定的dorks（搜索字符串）。该脚本本身不太可能包含恶意代码，因为它主要负责信息收集。
*   **exploit.py：** 该脚本包含实际的漏洞利用代码，用于向目标系统发送恶意请求以执行任意命令。虽然脚本的主要功能是利用漏洞，但仍然存在一定的投毒风险。风险点在于执行命令的部分，如果攻击者将恶意命令嵌入到脚本中，可能会对目标系统造成损害。例如，可以修改脚本以默认执行特定的恶意操作，或者在成功利用后植入后门。

因此，虽然 `exploit.py` 的主要目的是为了利用漏洞, 但依然需要谨慎检查其执行命令的部分。`dorker.py` 脚本本身不太可能包含恶意代码。综合分析，投毒风险评估为 10%。主要风险在于，如果下载来源不可信，下载的 `exploit.py` 文件可能已经被篡改，嵌入了恶意代码。

**利用方式：**
1.  **确定目标：** 使用 `dorker.py` 脚本或其他方法查找可能存在漏洞的 Apache Struts 2 应用。
2.  **构造恶意请求：** 使用 `exploit.py` 脚本构造包含恶意 OGNL 表达式的 HTTP 请求。恶意表达式通常嵌入在 Content-Type 标头中。
3.  **发送请求：** 将构造的 HTTP 请求发送到目标 Struts 2 应用。
4.  **执行命令：** 如果目标系统存在漏洞，恶意 OGNL 表达式将被执行，从而导致在服务器上执行任意命令。

**项目地址:** [leandrocamposcardoso/CVE-2017-5638-Mass-Exploit](https://github.com/leandrocamposcardoso/CVE-2017-5638-Mass-Exploit)

**漏洞详情:** [CVE-2017-5638](https://nvd.nist.gov/vuln/detail/CVE-2017-5638)