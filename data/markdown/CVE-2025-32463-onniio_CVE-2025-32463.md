## CVE-2025-32463-Sudo-本地提权

**漏洞编号:** CVE-2025-32463

**漏洞类型:** 本地提权

**影响应用:** Sudo

**危害等级:** 高危，本地用户可获取root权限

**影响版本:** 1.9.14 <= version < 1.9.17p1

**利用条件:** 本地用户权限，目标系统存在漏洞版本Sudo

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2025-32463是一个存在于Sudo 1.9.14到1.9.17p1版本的本地提权漏洞。该漏洞允许本地用户通过`--chroot`选项利用用户可控目录下的`/etc/nsswitch.conf`文件来获取root权限。

**有效性分析：**

从提供的漏洞库信息和搜索引擎结果来看，此漏洞是一个高危漏洞，并且已经被积极利用。提供的Dockerfile文件用于构建一个包含漏洞版本Sudo的环境，然后将漏洞利用脚本`sudo-cherrooe.sh`复制到目标环境中。

**利用方式：**

1.  **构建漏洞环境：** 使用Dockerfile构建包含漏洞版本Sudo的环境。
2.  **创建恶意`nsswitch.conf`：** `sudo-cherrooe.sh`脚本首先创建一个临时目录，然后在该目录下创建恶意的`nsswitch.conf`文件。这个文件指定了`passwd`数据库的查找方式为`/errooe2005`，也就是后续生成的恶意动态链接库。
3.  **编译恶意动态链接库：** 脚本编译一个共享对象库`libnss_/errooe2005.so.2`，这个库包含一个构造函数`errooe()`。构造函数在库加载时自动执行，会将当前用户的UID和GID设置为0，从而获取root权限，然后使用`/bin/sh -c` 执行传入的指令。
4.  **利用`sudo -R`和`--chroot`选项：** 脚本使用`sudo -R errooe errooe`命令，其中`errooe`是创建的临时目录。 `-R` 选项表示chroot到指定的目录。由于恶意的`nsswitch.conf`位于chroot目录中，Sudo会加载恶意的`libnss_/errooe2005.so.2`库，从而执行`errooe()`构造函数，提升权限并执行目标命令。

**投毒风险分析：**

虽然`sudo-cherrooe.sh`脚本是为了利用漏洞而设计的，但仍然存在一定的投毒风险。例如，作者可以在构造函数`errooe()`中添加额外的恶意代码，例如安装后门、窃取数据等。然而，提供的PoC代码主要专注于提权，直接添加隐蔽的持久化后门代码难度较大，因此投毒的概率较低, 估计为10%。仔细查看代码，发现它重置了`reuid`和`regid`为0并且允许了`execl` 执行传入的指令，有一定程度的风险。

**项目地址:** [onniio/CVE-2025-32463](https://github.com/onniio/CVE-2025-32463)

**漏洞详情:** [CVE-2025-32463](https://nvd.nist.gov/vuln/detail/CVE-2025-32463)