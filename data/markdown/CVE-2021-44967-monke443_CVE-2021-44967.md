## CVE-2021-44967 - LimeSurvey RCE

**漏洞编号:** CVE-2021-44967

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** LimeSurvey

**危害等级:** 高危，允许未经授权的用户在服务器上执行任意代码

**影响版本:** 5.2.4

**利用条件:** 需要有效的管理员权限进行插件上传和安装

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-44967 存在于 LimeSurvey 5.2.4 版本中。该漏洞允许具有管理员权限的远程攻击者通过上传并安装恶意插件来执行任意 PHP 代码，从而完全控制服务器。

**有效性：**
提供的 POC 代码看起来是有效的。它包含以下几个关键步骤：
1.  **生成 PHP Shell：** 创建一个反向 shell 的 PHP 代码，当被执行时，它会连接回攻击者的机器。
2.  **创建 XML 配置文件：** 创建一个描述插件的 XML 文件，其中包含插件的名称和其他元数据。
3.  **登录 LimeSurvey：** 使用提供的用户名和密码登录到 LimeSurvey 管理面板。
4.  **获取 CSRF Token：** 从管理页面获取 CSRF token，用于绕过 CSRF 保护。
5.  **上传并安装插件：** 将包含恶意 PHP 代码的插件（打包成 ZIP 文件）上传到 LimeSurvey，然后安装它。
6.  **触发恶意代码：** 访问恶意插件，从而触发反向 shell。

**投毒风险：**
POC 代码本身主要功能是利用漏洞，但仍然存在一定的投毒风险，主要体现在以下几个方面：
1.  **后门植入：** 恶意插件中除了反向 shell 之外，可能还包含其他后门代码，例如用于收集敏感信息、创建隐藏账户或执行其他恶意操作的代码。仔细分析反向shell代码，可以看到其内部使用了`uname -a; w; id; /bin/sh -i`等命令，如果攻击者稍微修改，可能将服务器信息泄露。
2.  **依赖项劫持：** 如果插件依赖于其他外部库或组件，攻击者可能会利用依赖项劫持来引入恶意代码。
3. **不明显的恶意行为:** 攻击者可以将恶意代码隐藏在看似正常的函数或功能中，使得难以检测。
总体来说，由于代码主要功能集中在RCE，投毒风险较低，大概在10%左右。

**利用方式：**
1.  **前提条件：** 攻击者需要具有 LimeSurvey 的管理员权限。
2.  **创建恶意插件：** 攻击者创建一个包含恶意 PHP 代码的插件，通常是一个 ZIP 文件，其中包含 PHP 代码文件和一个 XML 配置文件。
3.  **登录管理面板：** 攻击者使用有效的管理员凭据登录到 LimeSurvey 的管理面板。
4.  **上传并安装插件：** 攻击者导航到插件管理页面，上传恶意插件 ZIP 文件，然后安装它。
5.  **触发恶意代码：** 攻击者可以通过访问插件的特定功能或页面来触发恶意 PHP 代码的执行。例如插件的配置页面。
6.  **远程代码执行：** 恶意 PHP 代码在服务器上执行，攻击者可以利用它来执行任意命令、上传文件、修改数据库或执行其他恶意操作。
根据漏洞信息，利用此漏洞需要管理员权限。供应商认为，由于插件只能由超级管理员安装，因此这种行为不违反安全模型。

**项目地址:** [monke443/CVE-2021-44967](https://github.com/monke443/CVE-2021-44967)

**漏洞详情:** [CVE-2021-44967](https://nvd.nist.gov/vuln/detail/CVE-2021-44967)