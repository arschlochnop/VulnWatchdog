## CVE-2025-49844-Redis Lua Use-After-Free 远程代码执行

**漏洞编号:** CVE-2025-49844

**漏洞类型:** Use-After-Free

**影响应用:** Redis

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** < 8.2.2

**利用条件:** 需要已认证用户，并且Redis实例启用了Lua脚本功能

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于Redis的Lua脚本引擎中。当Redis服务器版本低于8.2.2时，经过身份验证的用户可以通过构造特制的Lua脚本操纵垃圾回收器，触发use-after-free漏洞，从而可能导致远程代码执行。

**有效性：**

提供的POC代码看起来是有效的。它利用了Redis Lua脚本引擎的漏洞，通过精心构造的Lua脚本，在垃圾回收过程中重新激活已经被释放的内存块，从而触发use-after-free漏洞。`CVE-2025-49844.lua` 脚本通过 `make_chunk_name` 函数，在luaY_parser依然持有字符串名称时运行垃圾回收器（GC），从而触发漏洞。`README.MD` 提供了漏洞的简要描述、利用方法和缓解措施，进一步增加了POC的可信度。

**投毒风险：**

从代码本身来看，主要的投毒风险在于，利用脚本可能会被修改为执行恶意操作，例如执行系统命令，写入文件等。虽然主体的利用是UAF，但是脚本的执行权限也需要关注。目前观察，代码本身的主要目的是触发漏洞，虽然利用脚本最终的目标是RCE, 但是代码本身并没有发现明显的后门或恶意代码。但是考虑到RCE的可能性，脚本的危害性是巨大的，所以风险仍然存在。经过分析，认为投毒的可能性为10%。因为这个漏洞本身已经是一个RCE漏洞，所以没有必要再进行复杂的投毒。

**利用方式：**

1.  **身份验证：** 攻击者需要首先通过身份验证，获得执行Lua脚本的权限。
2.  **执行恶意Lua脚本：** 攻击者将构造好的Lua脚本（`CVE-2025-49844.lua`）发送到Redis服务器执行。
3.  **触发Use-After-Free：** Lua脚本通过操纵垃圾回收器，触发Use-After-Free漏洞。
4.  **远程代码执行：** 成功触发Use-After-Free后，攻击者可以进一步利用该漏洞执行任意代码，控制Redis服务器。

**缓解措施：**

*   升级到Redis 8.2.2或更高版本。
*   使用ACL限制用户执行`EVAL`和`EVALSHA`命令，禁用Lua脚本功能。


**项目地址:** [elyasbassir/CVE-2025-49844](https://github.com/elyasbassir/CVE-2025-49844)

**漏洞详情:** [CVE-2025-49844](https://nvd.nist.gov/vuln/detail/CVE-2025-49844)