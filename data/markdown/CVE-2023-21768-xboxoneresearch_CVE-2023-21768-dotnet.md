## CVE-2023-21768 - Windows Ancillary Function Driver for WinSock Elevation of Privilege

**漏洞编号:** CVE-2023-21768

**漏洞类型:** 特权提升 (Elevation of Privilege)

**影响应用:** Windows Ancillary Function Driver for WinSock

**危害等级:** 高危，本地特权提升

**影响版本:** Windows Server 2022 (versionStartIncluding: 10.0.20348.0, versionEndExcluding: 10.0.20348.1487), Windows 11 21H2 (versionStartIncluding: 10.0.0, versionEndExcluding: 10.0.22000.1455), Windows 11 22H2 (versionStartIncluding: 10.0.22621.0, versionEndExcluding: 10.0.22621.1105)

**利用条件:** 本地访问权限

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-21768 是一个 Windows Ancillary Function Driver (AFD) for WinSock 的特权提升漏洞。攻击者利用此漏洞可以在受影响的系统上执行任意代码并获得更高的权限。 

**漏洞利用方式：**

1.  **漏洞成因:**  该漏洞是由于 AFD 驱动程序中存在未受信指针解引用 (CWE-822) 造成的。
2.  **攻击过程:** 攻击者利用此漏洞，通过精心构造的数据，导致AFD驱动程序解引用恶意地址，从而执行攻击者控制的代码。
3.  **利用代码分析:** 提供的 POC 代码 (C# 移植版本) 似乎是有效的，参考了其他公开的漏洞利用代码（zoemurmure 和 chompie1337 的 GitHub 仓库）。该代码尝试在 PowerShell 环境中编译和执行，通过 `Add-Type` 命令加载 C# 代码，然后调用 `XOR.EoP::Run` 函数来触发漏洞。

**有效性评估：**

根据搜索结果和 POC 代码，该漏洞的利用是可行的，并且存在公开的漏洞利用代码。

**投毒风险评估：**

尽管漏洞利用代码本身看起来是合法的漏洞利用程序，但仍然存在一些轻微的投毒风险。由于 POC 代码是从其他来源移植的，并且在 PowerShell 环境中动态编译和执行，因此存在引入恶意代码的可能性。此外，虽然主要功能是漏洞利用，但添加不明显但恶意的代码段来执行其他操作（例如，收集系统信息或创建后门）是可能的。尽管如此，由于代码量相对较小且可读性高，以及存在参考来源，因此投毒风险较低。保守估计为5%。需要注意的是，POC本身会进行提权操作，该行为不属于“投毒”。

**项目地址:** [xboxoneresearch/CVE-2023-21768-dotnet](https://github.com/xboxoneresearch/CVE-2023-21768-dotnet)

**漏洞详情:** [CVE-2023-21768](https://nvd.nist.gov/vuln/detail/CVE-2023-21768)