## CVE-2018-6789 - Exim base64d 缓冲区溢出

**漏洞编号:** CVE-2018-6789

**漏洞类型:** 缓冲区溢出

**影响应用:** Exim

**危害等级:** 高危，可远程代码执行

**影响版本:** < 4.90.1

**利用条件:** 目标系统运行Exim邮件服务器，且版本低于4.90.1，对外开放SMTP端口（通常是25端口）

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2018-6789是Exim邮件服务器base64d函数中的一个缓冲区溢出漏洞。攻击者可以通过发送特制的SMTP消息，利用base64解码过程中的漏洞触发缓冲区溢出，从而实现远程代码执行。

**有效性:**
根据漏洞库信息和搜索引擎结果，该漏洞是真实存在的，并且有公开的PoC代码。多个安全厂商和研究人员都对其进行了分析和验证，例如Rapid7、Tenable等。漏洞利用代码存在于Exploit-DB(44571, 45671)中，证明该漏洞可被利用。

**投毒风险:**
提供的“漏洞利用代码”实际上只是一份GNU通用公共许可证的文本。并不能直接用于漏洞验证。因此，无法直接分析其中是否包含投毒代码。但是从整体仓库文件来看，存在投毒的可能性较低，大约为5%，因为仅仅包含协议。

**利用方式:**
1.  **漏洞点：** 漏洞存在于Exim的SMTP监听器中的`base64d`函数中。
2.  **触发条件：** 发送精心构造的包含过长base64编码数据的SMTP消息。
3.  **溢出原理：** `base64d`函数在解码过程中，由于存在Off-by-one错误，导致缓冲区溢出。
4.  **利用方式：** 攻击者可以利用此溢出覆盖堆上的内存，进而控制程序执行流程，实现远程代码执行。
5.  **利用步骤：**
    *   向目标Exim服务器发送包含恶意base64编码数据的SMTP消息。
    *   消息会被`base64d`函数处理，触发缓冲区溢出。
    *   溢出覆盖关键内存区域，例如函数返回地址。
    *   将返回地址修改为攻击者控制的地址，指向shellcode。
    *   shellcode执行，获取服务器控制权。

总的来说，CVE-2018-6789是一个严重的安全漏洞，利用难度相对较低，攻击者可以利用公开的PoC代码轻松实现远程代码执行。建议受影响的用户尽快升级到Exim 4.90.1或更高版本。

**项目地址:** [beraphin/CVE-2018-6789](https://github.com/beraphin/CVE-2018-6789)

**漏洞详情:** [CVE-2018-6789](https://nvd.nist.gov/vuln/detail/CVE-2018-6789)