## CVE-2023-38646-Metabase-RCE

**漏洞编号:** CVE-2023-38646

**漏洞类型:** 远程代码执行

**影响应用:** Metabase

**危害等级:** 高危，无需认证即可远程代码执行

**影响版本:** < 0.46.6.1 和 < 1.46.6.1

**利用条件:** 目标Metabase实例未打补丁且网络可达

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-38646 是 Metabase 中存在的一个无需认证的远程代码执行漏洞。攻击者通过发送特制的 POST 请求到 `/api/setup/validate` 接口，利用 H2 数据库的特性，在 `subname` 字段中注入恶意的 JDBC URL。该URL包含一个CREATE TRIGGER语句，该语句在INFORMATION_SCHEMA.TABLES表上创建一个触发器，该触发器执行任意 Java 代码，从而实现远程代码执行。利用方式是通过提供一个包含反弹shell命令的payload，该命令会被base64编码后执行。漏洞利用代码中的投毒风险较低，主要是通过篡改IP和端口进行恶意连接，存在少量风险。 脚本要求用户指定目标 URL 和 token， token 通过 `/api/session/properties` 获取。

**漏洞利用方式：**

1.  获取目标 Metabase 实例的 URL 和 token（通过访问 `/api/session/properties` 获取）。
2.  配置漏洞利用脚本 `exploit.py`，设置目标 URL、token、攻击者的 IP 地址和端口。
3.  运行脚本，脚本将发送包含恶意 JDBC URL 的 POST 请求到目标 Metabase 实例。
4.  目标 Metabase 实例执行恶意代码，反弹 shell 到攻击者指定的 IP 地址和端口。

**投毒风险分析：**

代码主要功能是构造和发送恶意请求，虽然存在通过修改IP端口进行恶意连接的风险， 但是需要使用者自行配置。所以投毒风险较低，约为10%。

**项目地址:** [junnythemarksman/CVE-2023-38646](https://github.com/junnythemarksman/CVE-2023-38646)

**漏洞详情:** [CVE-2023-38646](https://nvd.nist.gov/vuln/detail/CVE-2023-38646)