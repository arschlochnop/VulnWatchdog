## CVE-2015-3224 Web Console IP Whitelist Bypass RCE

**漏洞编号:** CVE-2015-3224

**漏洞类型:** IP Whitelist Bypass

**影响应用:** Ruby on Rails Web Console

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Web Console < 2.1.3, Ruby on Rails 3.x/4.x

**利用条件:** 目标系统安装了存在漏洞的Web Console，并且攻击者能够发送HTTP请求到目标服务器

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2015-3224 漏洞存在于Ruby on Rails的Web Console中，允许攻击者绕过IP白名单限制，执行任意代码。漏洞原因是Web Console在确定客户端IP地址时，对`X-Forwarded-For` header处理不当。

**有效性评估：**

提供的POC代码似乎有效。它通过设置 `X-Forwarded-For` header为白名单IP（例如127.0.0.1）来绕过IP白名单的限制，然后利用 `cmd.php` 执行任意命令。POC首先下载一个反弹shell脚本 (pty.py)，然后执行它，从而建立一个反向shell连接。

**投毒风险评估：**

初步分析，投毒风险较低，大约为10%。主要考虑以下几点：

1.  `CVE-2015-3224.py`：该脚本主要用于利用漏洞，相对直接，但依赖于`cmd.php`这个文件存在潜在风险，可能是webshell。
2.  `pty.py`：这个脚本是一个简单的反弹shell，虽然本身不是恶意代码，但被攻击者利用后会造成危害。脚本中硬编码了反弹shell的IP地址和端口。如果该IP被攻击者控制，所有使用该脚本的受害者都会连接到攻击者的服务器。
3.  `README.md`：提供了一些基本的使用说明。

总体而言，该仓库代码较为简单，主要风险点在于反弹shell脚本`pty.py`可能被用于恶意用途，且`CVE-2015-3224.py`依赖的`cmd.php` 脚本可能存在恶意代码。

**利用方式：**

1.  **绕过IP白名单：** 攻击者通过在HTTP请求中设置 `X-Forwarded-For` header，伪造客户端IP地址，绕过Web Console的IP白名单限制。
2.  **上传反弹shell：** 攻击者利用漏洞，通过`cmd.php`上传一个反弹shell脚本（`pty.py`）。
3.  **执行任意代码：** 攻击者利用漏洞执行上传的反弹shell脚本，从而在目标服务器上执行任意代码，获取shell控制权。
4.  **建立反向连接：** 反弹shell脚本连接到攻击者指定的IP地址和端口，建立一个反向shell连接，攻击者可以通过该连接远程控制目标服务器。

**项目地址:** [n000xy/CVE-2015-3224-](https://github.com/n000xy/CVE-2015-3224-)

**漏洞详情:** [CVE-2015-3224](https://nvd.nist.gov/vuln/detail/CVE-2015-3224)