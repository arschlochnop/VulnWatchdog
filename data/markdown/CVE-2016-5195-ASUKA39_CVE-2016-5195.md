## CVE-2016-5195 Dirty COW

**漏洞编号:** CVE-2016-5195

**漏洞类型:** 权限提升

**影响应用:** Linux Kernel

**危害等级:** 高危，本地用户可获得 root 权限

**影响版本:** Linux kernel 2.x through 4.x before 4.8.3

**利用条件:** 需要本地用户权限，目标文件可读。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

Dirty COW (CVE-2016-5195) 是 Linux 内核中的一个竞争条件漏洞，它允许低权限本地用户获得对只读内存映射的写访问权限，从而导致权限提升。漏洞存在于 `mm/gup.c` 中，利用了 copy-on-write (COW) 机制处理不当的问题。

**利用方式：**

1.  **内存映射：** 首先，攻击者使用 `mmap()` 函数将目标只读文件映射到内存中，使用 `MAP_PRIVATE` 创建私有映射，这意味着写入时会触发 copy-on-write。
2.  **竞争条件：** 创建两个线程：
    *   **madvise 线程：** 该线程通过循环调用 `madvise()` 函数，并使用 `MADV_DONTNEED` 参数，来尝试释放内存页，从而清除对应的页表项。
    *   **procselfmem 线程：** 该线程打开 `/proc/self/mem` 文件，并通过循环调用 `lseek()` 定位到映射内存的起始位置，然后使用 `write()` 函数尝试写入新的内容到该内存区域。
3.  **利用过程：** 通过两个线程的并行执行，在 copy-on-write 机制完成之前，`madvise` 线程尝试释放内存页，而 `procselfmem` 线程尝试写入数据，从而导致竞争条件，绕过只读保护，直接修改原始文件。
4.  **提权：** 常见的利用方式是修改 `/etc/passwd` 文件以提升用户权限。

**有效性：**

提供的 POC 代码有效，可以成功利用 Dirty COW 漏洞覆盖只读文件内容。根据代码中的描述和利用流程，可以确定该 POC 的有效性。

**投毒风险：**

提供的 POC 代码中，存在投毒代码的可能性较低，大约为5%。 主要考虑以下几点：

*   代码主要功能集中在利用漏洞实现文件覆盖，没有发现明显的恶意操作。
*   代码逻辑较为清晰，没有隐藏的后门或者恶意代码。
*  代码本身需要root权限运行, 可能会被植入后门程序. 

但是，仍然需要谨慎对待，因为攻击者可能会在其他地方隐藏恶意代码，例如在编译过程中或者在运行时加载其他恶意模块。建议在受控环境中运行和分析代码。



**项目地址:** [ASUKA39/CVE-2016-5195](https://github.com/ASUKA39/CVE-2016-5195)

**漏洞详情:** [CVE-2016-5195](https://nvd.nist.gov/vuln/detail/CVE-2016-5195)