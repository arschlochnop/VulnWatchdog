## CVE-2021-43798-Grafana-目录遍历

**漏洞编号:** CVE-2021-43798

**漏洞类型:** 目录遍历

**影响应用:** Grafana

**危害等级:** 高危，可读取敏感文件

**影响版本:** >= 8.0.0, < 8.0.7; >= 8.1.0, < 8.1.8; >= 8.2.0, < 8.2.7; = 8.3.0

**利用条件:** 需要Grafana实例运行在受影响版本，并且存在可利用的插件

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2021-43798是Grafana的一个目录遍历漏洞，允许未经身份验证的攻击者读取服务器上的任意文件。漏洞存在于`/public/plugins/<plugin_id>/`路径下，攻击者可以通过构造包含`../`的payload来绕过目录限制，读取`/etc/passwd`等敏感文件。

**有效性：**

根据漏洞库信息、搜索引擎结果和提供的PoC代码，该漏洞是有效的。PoC代码通过构造恶意URL，利用目录遍历漏洞读取`/etc/passwd`文件来验证漏洞的存在。

**投毒风险：**

PoC代码本身主要功能是漏洞验证，并未发现明显的恶意投毒代码。PoC的功能相对独立，主要涉及发送HTTP请求和分析响应。但是，需要注意以下几点：

1.  `plugins.txt` 文件：该文件包含插件列表，用于枚举可能存在的插件目录。虽然没有直接的投毒代码，但如果该文件被恶意修改，加入不存在的插件，可能会导致大量的无效请求，造成拒绝服务攻击。
2.  依赖库：PoC依赖`requests`库，如果攻击者替换或篡改了`requests`库，可能会导致恶意代码执行。但这种风险并非PoC本身带来的，而是依赖库供应链的安全问题。
3.  写入文件：PoC会将漏洞URL写入`grafana 8.x_fileread_vuln.txt`文件，如果服务器权限配置不当，可能会导致信息泄露。

总体来说，该PoC的投毒风险较低，约为1%。主要风险在于对依赖库的篡改，或者利用不当造成的其他安全问题。

**利用方式：**

1.  确定目标Grafana实例的版本是否在受影响范围内（>= 8.0.0, < 8.0.7; >= 8.1.0, < 8.1.8; >= 8.2.0, < 8.2.7; = 8.3.0）。
2.  找到目标Grafana实例中安装的插件ID，可以通过访问`/public/plugins/`路径来枚举插件。
3.  构造包含目录遍历的URL：`/<grafana_host_url>/public/plugins/<plugin_id>/../../../../../../../../../../../etc/passwd`。
4.  发送HTTP请求，如果返回`/etc/passwd`的内容，则说明漏洞存在。
5.  可以替换`/etc/passwd`为其他文件路径，读取服务器上的其他敏感文件。

**项目地址:** [M0ge/CVE-2021-43798-grafana_fileread](https://github.com/M0ge/CVE-2021-43798-grafana_fileread)

**漏洞详情:** [CVE-2021-43798](https://nvd.nist.gov/vuln/detail/CVE-2021-43798)