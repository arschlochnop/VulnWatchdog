## CVE-2018-6574 Go "go get" 远程命令执行

**漏洞编号:** CVE-2018-6574

**漏洞类型:** 远程命令执行

**影响应用:** Go

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Go before 1.8.7, Go 1.9.x before 1.9.4, and Go 1.10 pre-releases before Go 1.10rc2

**利用条件:** 目标系统使用受影响的 Go 版本，并且执行了 `go get` 命令获取恶意代码。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2018-6574 漏洞允许在 `go get` 命令构建源代码时执行远程命令。 这是因为 Go 在处理 gcc 或 clang 插件功能时，未正确阻止 `-fplugin=` 和 `-plugin=` 参数。攻击者可以创建一个恶意的 Go 包，其中包含一个 `attack.c` 文件，该文件使用 `__attribute__((constructor))` 定义一个在加载时自动执行的函数 `malicious()`。这个函数会执行任意命令，例如本例中的 `/usr/local/bin/score 9ba57f82-9a67-46fe-885b-682c886cb726`。 `main.go` 文件使用 `#cgo CFLAGS: -fplugin=./attack.so` 指令来编译和链接 `attack.c` 文件生成的动态链接库 `attack.so`。 当用户使用 `go get` 命令获取并构建这个恶意包时，`attack.so` 会被加载，`malicious()` 函数会被自动执行，从而导致远程命令执行。

**有效性：**提供的 POC 代码有效。当目标系统使用存在漏洞的 Go 版本并执行 `go get` 命令时，攻击者可以通过托管包含恶意代码的仓库来利用此漏洞。

**投毒风险：**提供的代码本身就是一个漏洞利用程序，而非被投毒的代码。此仓库没有发现额外的、作者隐藏的投毒代码。 该POC的主要目标是演示漏洞而不是隐藏恶意代码。因此，投毒风险评估为0%。

**利用方式：**
1.  攻击者创建一个包含恶意 `attack.c` 和 `main.go` 文件的 Go 包。
2.  `attack.c` 文件包含一个在加载时自动执行的 `malicious()` 函数，用于执行任意命令。
3.  `main.go` 文件使用 `#cgo CFLAGS: -fplugin=./attack.so` 指令来编译和链接 `attack.so`。
4.  攻击者将恶意 Go 包托管在一个公开可访问的仓库中。
5.  受害者使用 `go get` 命令获取并构建这个恶意包。
6.  在构建过程中，`attack.so` 被加载，`malicious()` 函数被执行，从而导致远程命令执行。

**项目地址:** [markisback/CVE-2018-6574](https://github.com/markisback/CVE-2018-6574)

**漏洞详情:** [CVE-2018-6574](https://nvd.nist.gov/vuln/detail/CVE-2018-6574)