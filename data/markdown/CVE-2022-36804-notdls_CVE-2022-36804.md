## CVE-2022-36804-Bitbucket-命令注入

**漏洞编号:** CVE-2022-36804

**漏洞类型:** 命令注入

**影响应用:** Atlassian Bitbucket Server and Data Center

**危害等级:** 高危，允许远程攻击者执行任意代码

**影响版本:** 7.0.0 before version 7.6.17, from version 7.7.0 before version 7.17.10, from version 7.18.0 before version 7.21.4, from version 8.0.0 before version 8.0.3, from version 8.1.0 before version 8.1.3, and from version 8.2.0 before version 8.2.2, and from version 8.3.0 before 8.3.1

**利用条件:** 需要对公共仓库的访问权限或者对私有仓库的读取权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-36804 存在于 Atlassian Bitbucket Server 和 Data Center 的多个 API 接口中。 具有公共仓库访问权限或私有仓库读取权限的远程攻击者可以通过发送恶意 HTTP 请求来执行任意代码。漏洞原因是由于`git archive`命令的`--exec`参数存在参数注入漏洞。攻击者可以通过构造特定的URL，利用`%00`字符截断参数，并插入恶意的`--exec`参数执行任意命令。

**有效性：**
根据漏洞描述、搜索结果以及提供的PoC代码，该漏洞利用是有效的。多个来源（NVD, Rapid7, Atlassian, AssetNote等）证实了该漏洞的存在，并且提供了利用细节。

**投毒风险：**
提供的PoC代码主要包含一个 exploit.py 脚本和一个 README.md 文件。 exploit.py 脚本用于发送恶意请求以触发漏洞，README.md 文件提供了漏洞的描述和使用方法。检查了 exploit.py 脚本，未发现直接的恶意代码或后门，代码逻辑看起来是利用漏洞本身执行命令。投毒风险较低，但仍存在一定的风险，例如：

*   **依赖项投毒：** exploit.py 脚本依赖于 requests 和 urllib.parse 库，如果这些库被投毒，可能会影响 exploit.py 脚本的安全性。
*   **命令执行风险：** PoC本身需要用户提供要执行的命令。如果用户执行了恶意的命令，可能会对系统造成损害。

综合来看，投毒的风险较低，约占 10%。

**利用方式：**
1.  攻击者需要访问目标 Bitbucket Server 或 Data Center 实例。
2.  如果目标仓库是私有的，攻击者需要有效的会话 cookie (`BITBUCKETSESSIONID`)，否则需要目标存在公开仓库。
3.  攻击者构造包含恶意参数的 HTTP 请求发送到受影响的 API 接口。
4.  恶意请求中包含经过 URL 编码的命令，该命令将由服务器执行。
5.  攻击者可以利用该漏洞执行任意命令，例如建立反向 shell 或窃取敏感信息。

**项目地址:** [notdls/CVE-2022-36804](https://github.com/notdls/CVE-2022-36804)

**漏洞详情:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)