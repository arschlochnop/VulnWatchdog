## CVE-2014-6271-Shellshock

**漏洞编号:** CVE-2014-6271

**漏洞类型:** 远程代码执行

**影响应用:** GNU Bash

**危害等级:** 高危，允许远程攻击者通过构造的环境变量执行任意代码。

**影响版本:** <= 4.3

**利用条件:** 目标系统存在CGI脚本或其他方式允许设置环境变量并调用Bash。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2014-6271，也被称为Shellshock，是GNU Bash中的一个严重漏洞。该漏洞源于Bash处理环境变量中函数定义后trailing string的方式。攻击者可以利用此漏洞，通过构造包含恶意代码的环境变量，在目标系统上执行任意命令。

**有效性分析：**
提供的Python POC代码通过发送包含恶意构造的HTTP请求来利用此漏洞。它首先尝试通过User-Agent、Referer和Cookie头注入测试payload来检测漏洞是否存在，测试Payload特征是会输出特定字符串，验证是否可以执行代码，存在漏洞后再注入包含反向Shell的payload来利用该漏洞。

**投毒风险分析：**
代码存在潜在的投毒风险，主要体现在以下几个方面：
1.  **反向Shell地址：** 攻击者可能修改`lhost`和`lport`变量，将反向Shell指向恶意服务器，从而控制受害者机器。当前代码中并没有明显的恶意行为，但是依赖用户提供的参数。
2.  **Payload修改：** 攻击者可能修改`payload`变量，执行其他恶意命令，例如下载并执行恶意文件，删除系统文件等。当前Payload是反向shell，不属于投毒行为。
3.  **其他依赖：** 代码依赖于`pwncat`库，这个库本身可能存在安全问题或被篡改，从而引入新的安全风险。
4. **连接处理:** `pwncat.manager.Manager` 中可能包含未知的后门或恶意代码。 
综合来看，投毒风险较低（约10%），主要来自于参数修改和对依赖库的信任。

**利用方式：**
1.  **漏洞检测：**  POC首先向目标URL发送包含特殊构造header的HTTP请求(User-Agent, Referer, Cookie)。 这些header中包含恶意的Bash函数定义。
2.  **命令执行：**  如果目标系统存在漏洞，Bash在解析这些环境变量时，会执行注入的恶意代码。
3.  **反向Shell：**  利用代码中，注入的Payload为反向Shell，建立从目标系统到攻击者控制机器的TCP连接，从而允许攻击者远程控制目标系统。反向连接的地址由`lhost`和`lport`指定。
4. **监听连接:** 在攻击机上启动监听进程，等待目标机器的连接。

**漏洞缓解措施：**
*   升级Bash到最新版本。
*   避免在CGI脚本中使用Bash处理用户输入。
*   使用安全编码实践，验证所有用户输入。
*   使用入侵检测系统（IDS）和入侵防御系统（IPS）监控和阻止恶意流量。

**项目地址:** [K3ysTr0K3R/CVE-2014-6271-EXPLOIT](https://github.com/K3ysTr0K3R/CVE-2014-6271-EXPLOIT)

**漏洞详情:** [CVE-2014-6271](https://nvd.nist.gov/vuln/detail/CVE-2014-6271)