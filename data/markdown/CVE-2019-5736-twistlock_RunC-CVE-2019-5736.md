## CVE-2019-5736-runc容器逃逸

**漏洞编号:** CVE-2019-5736

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，允许容器逃逸并获得主机root权限

**影响版本:** <= 1.0-rc6 (Docker < 18.09.2)

**利用条件:** 攻击者需要能够在容器内以root身份执行命令，或者拥有可控镜像。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-5736 漏洞允许恶意容器覆盖宿主机上的 runc 二进制文件，从而获得宿主机的 root 权限。漏洞的根本原因是文件描述符处理不当，具体来说是与 `/proc/self/exe` 相关的问题。

**有效性分析：**
根据漏洞描述和搜索结果，提供的 POC 代码是有效的。多个来源（NVD, RedHat, Trend Micro, AWS, Sysdig, Tenable, Databricks）都确认了该漏洞的存在，并且提供了缓解措施。POC 代码通过两种方式利用该漏洞：
    *   **exec PoC:**  覆盖 `runc` 二进制文件，使其打印字符串。
    *   **Malicious Image PoC:**  覆盖 `runc` 二进制文件，使其运行反向 shell，从而允许攻击者连接到宿主机。

**投毒风险分析：**
分析提供的 POC 代码，发现存在一定的投毒风险，但风险较低。风险主要存在于以下几点：

1.  **`/malicious_image_POC/new_runc`:**  该文件包含一个简单的反向 shell 脚本，虽然其本身目的是演示漏洞利用，但攻击者可以替换该脚本为更具破坏性的代码，例如删除关键系统文件、植入恶意软件等。这种替换容易被发现，因此风险较低。
2.  **`/malicious_image_POC/overwrite_runc.c`:**  该 C 语言程序负责覆盖 runc 二进制文件。攻击者可以在此代码中添加额外的恶意逻辑，例如在覆盖 runc 之前执行某些操作，或者在成功覆盖 runc 之后执行某些操作。然而，由于此代码需要编译，并且目标是覆盖 `/proc/self/exe`, 行为较为明显,风险较低。
3. Dockerfile中执行了apt-get source libseccomp。攻击者可能利用此步骤下载恶意源码。
总而言之，此仓库投毒概率较低，大约为10%。因为代码简单直接，目的在于展示漏洞。但仍然需要注意，在生产环境中使用任何第三方代码之前，都应该进行仔细的审查。

**漏洞利用方式：**
1.  **获取容器内的 root 权限：** 攻击者需要首先在目标容器内获得 root 权限。这可以通过多种方式实现，例如利用容器内已存在的漏洞，或者利用错误配置。
2.  **覆盖 runc 二进制文件：** 攻击者利用 CVE-2019-5736 漏洞，通过 `/proc/self/exe` 覆盖宿主机上的 `runc` 二进制文件。POC 代码提供了两种方法来实现这一点。
3.  **触发 runc 执行：** 当 Docker 或其他容器管理工具需要执行某些操作（例如 `docker exec`、`docker run`）时，它会调用被覆盖的 `runc` 二进制文件。此时，攻击者植入的恶意代码将以 root 权限在宿主机上执行，从而导致容器逃逸，完全控制宿主机。


**项目地址:** [twistlock/RunC-CVE-2019-5736](https://github.com/twistlock/RunC-CVE-2019-5736)

**漏洞详情:** [CVE-2019-5736](https://nvd.nist.gov/vuln/detail/CVE-2019-5736)