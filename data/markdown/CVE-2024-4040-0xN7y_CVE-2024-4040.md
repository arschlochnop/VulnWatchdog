## CVE-2024-4040-CrushFTP-服务器端模板注入

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入

**影响应用:** CrushFTP

**危害等级:** 高危，可能导致任意文件读取、身份验证绕过和远程代码执行

**影响版本:** < 10.7.1 和 < 11.1.0

**利用条件:** 需要网络访问

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2024-4040 是 CrushFTP 中存在的一个服务器端模板注入（SSTI）漏洞。该漏洞影响所有 10.7.1 之前的 10.x 版本和 11.1.0 之前的 11.x 版本。未经身份验证的远程攻击者可以利用此漏洞读取文件系统中的任意文件（超出 VFS 沙箱范围），绕过身份验证以获得管理权限，并在服务器上执行远程代码。

**有效性：**
从提供的漏洞库信息和搜索结果来看，该漏洞已被广泛报道和利用，并且存在公开可用的利用代码。Rapid7 等安全公司也发布了相关的分析报告。因此，如果目标 CrushFTP 服务器的版本在此漏洞的影响范围内，则该漏洞利用是有效的。

**投毒风险：**
提供的 POC 代码 `/tmp/d16c01f072440651cb0b98bf3987b55f/README.md` 仅包含 CVE 编号和简单的说明，没有提供任何可执行代码。因此，从这段代码本身来看，投毒的风险非常低。但是需要检查完整的利用代码仓库以确定是否存在投毒代码。如果只根据提供的`README.md`文件进行判断,投毒的可能性非常低，考虑到代码本身十分简单，风险估计为1%。

**利用方式：**
根据漏洞库信息和搜索结果，该漏洞的利用方式包括以下步骤：

1.  **未经身份验证的攻击：** 攻击者无需任何凭据即可发起攻击。
2.  **SSTI 注入：** 攻击者通过构造包含恶意模板语法的请求，将恶意代码注入到 CrushFTP 服务器的模板引擎中。
3.  **任意文件读取：** 恶意模板可以读取服务器文件系统中的任意文件，包括配置文件、密钥等敏感信息。
4.  **身份验证绕过：** 通过读取配置文件或其他方式，攻击者可以绕过 CrushFTP 的身份验证机制，获得管理权限。
5.  **远程代码执行：** 利用管理权限，攻击者可以在服务器上执行任意代码，完全控制目标系统。

例如，攻击者可能通过向服务器发送包含 `{{...}}` 结构的恶意 HTTP 请求，从而触发 SSTI 漏洞，进而读取 `/etc/passwd` 文件或执行系统命令。

**项目地址:** [0xN7y/CVE-2024-4040](https://github.com/0xN7y/CVE-2024-4040)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)