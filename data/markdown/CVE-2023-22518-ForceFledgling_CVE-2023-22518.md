## CVE-2023-22518 - Atlassian Confluence Improper Authorization

**漏洞编号:** CVE-2023-22518

**漏洞类型:** Improper Authorization

**影响应用:** Atlassian Confluence Data Center and Server

**危害等级:** 高危，可能导致完全机密性、完整性和可用性损失

**影响版本:** 所有受影响版本（不包括不受影响版本）

**利用条件:** 需要网络访问Confluence实例

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2023-22518是一个严重的未授权漏洞，影响Atlassian Confluence Data Center和Server的所有版本。未经身份验证的攻击者可以利用此漏洞重置Confluence实例并创建一个Confluence实例管理员帐户。利用该账户，攻击者可以执行Confluence实例管理员可用的所有管理操作，从而导致完全的机密性、完整性和可用性损失。

**有效性：**
根据漏洞描述和提供的POC代码，此漏洞利用方法有效。POC通过向`/json/setup-restore.action`发送POST请求，上传包含恶意数据的zip文件，绕过身份验证，从而重置Confluence并创建一个管理员账户。搜索引擎结果也表明该漏洞已经被积极利用。

**投毒风险：**
分析提供的POC代码，没有发现明显的投毒代码。该POC的核心功能是利用未授权的`/json/setup-restore.action`接口进行数据库恢复，从而创建一个新的管理员账户。风险点主要集中在上传的`exploit-restore.zip`文件中的数据，该数据用于重置Confluence实例。如果攻击者提供的ZIP数据包含恶意配置或后门，则可能存在投毒风险。这里我们仅分析仓库提供的POC代码，并未对ZIP文件进行分析，因此我们认为仓库本身投毒风险为0%。

**利用方式：**
1.  攻击者构造一个POST请求，目标URL为`/json/setup-restore.action?synchronous=true`。
2.  请求体包含`buildIndex`参数设置为`false`，`file`参数上传恶意构造的zip文件（`exploit-restore.zip`），以及`edit`参数设置为`Upload and import`。
3.  通过设置`synchronous=true`参数，确保恢复操作同步执行。
4.  由于`/json/setup-restore.action`接口缺少身份验证检查，攻击者可以绕过身份验证，成功上传恶意zip文件并触发恢复操作。
5.  `exploit-restore.zip`中的数据用于重置Confluence实例，包括创建一个新的管理员账户。
6.  攻击者使用新创建的管理员账户登录Confluence，并获得完全的管理权限。

**项目地址:** [ForceFledgling/CVE-2023-22518](https://github.com/ForceFledgling/CVE-2023-22518)

**漏洞详情:** [CVE-2023-22518](https://nvd.nist.gov/vuln/detail/CVE-2023-22518)