## CVE-2025-32463-Sudo-本地权限提升

**漏洞编号:** CVE-2025-32463

**漏洞类型:** 本地权限提升

**影响应用:** Sudo

**危害等级:** 高危，本地用户可提升至root权限

**影响版本:** 1.9.14 <= version < 1.9.17p1

**利用条件:** 本地用户权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2025-32463 是一个影响 Sudo 的本地权限提升漏洞。攻击者可以利用 `sudo` 命令的 `-R` 选项（用于设置自定义运行时根目录）结合精心构造的 NSS (Name Service Switch) 配置文件，欺骗 Sudo 加载恶意的共享库，从而获得 root 权限。

**有效性:**

根据漏洞库信息和搜索结果，该漏洞允许本地用户获取root权限。提供的POC代码包含一个 `escalate.sh` 脚本，该脚本会创建一个临时目录，编译一个恶意的共享库 `libnss_/rootlib.so.2`，并准备一个伪造的 `nsswitch.conf` 文件。然后，脚本使用 `sudo -R rootfs rootlib` 命令，强制 Sudo 在 `chroot` 环境中使用攻击者控制的 `nsswitch.conf`，加载恶意共享库，该共享库会在构造函数中执行 `setreuid(0,0)` 和 `setregid(0,0)`，从而将当前用户的 effective UID 和 GID 设置为 0 (root)，然后执行 `/bin/bash`，产生一个 root shell。

**投毒风险:**

仔细检查 `escalate.sh` 脚本和 `escalate.c` 文件，并没有发现明显的投毒代码。`escalate.c` 中的代码仅仅是将当前用户提升为 root 权限并执行 `/bin/bash`。`escalate.sh` 中的代码主要负责设置环境和编译恶意共享库。不过，理论上作者可以在其他地方嵌入恶意代码，例如在编译过程中，虽然目前的证据并不充分。因此投毒风险存在，但概率较低，估计在 10% 左右。这个概率考虑了以下几点：
* 仓库代码相对简单，主要功能集中在提权，加入额外恶意功能会增加复杂度和暴露风险。
* 仓库作者公开了漏洞利用过程，如果存在明显的投毒代码，容易被发现。
* 潜在的投毒方式可能存在于编译环境或者不明显的代码逻辑中，难以直接判断。

**利用方式:**

1.  **准备环境:** 创建一个临时目录，并进入该目录。
2.  **创建恶意共享库:** 编写 C 代码，在共享库的构造函数中调用 `setreuid(0,0)` 和 `setregid(0,0)`，然后执行 `/bin/bash`。
3.  **编译恶意共享库:** 使用 `gcc` 将 C 代码编译成共享库。
4.  **创建伪造的 NSS 配置文件:** 创建一个 `nsswitch.conf` 文件，将 `passwd` 条目指向恶意共享库 (例如 `/rootlib`)。
5.  **利用 Sudo:** 使用 `sudo -R rootfs rootlib` 命令，其中 `rootfs` 目录包含伪造的 `nsswitch.conf` 文件，`rootlib` 是一个不存在的命令, 触发sudo去读取rootfs/etc/nsswitch.conf配置文件，Sudo 会在 chroot 环境中使用攻击者控制的 `nsswitch.conf`，加载恶意共享库。
6.  **获得 Root 权限:** 恶意共享库的构造函数会执行提权操作，然后执行 `/bin/bash`，从而获得 root shell。

**项目地址:** [FreeDurok/CVE-2025-32463-PoC](https://github.com/FreeDurok/CVE-2025-32463-PoC)

**漏洞详情:** [CVE-2025-32463](https://nvd.nist.gov/vuln/detail/CVE-2025-32463)