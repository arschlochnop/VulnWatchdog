## CVE-2018-10933 - libssh Authentication Bypass

**漏洞编号:** CVE-2018-10933

**漏洞类型:** Authentication Bypass

**影响应用:** libssh

**危害等级:** 高危，可能导致未授权访问和远程代码执行

**影响版本:** 0.6 - 0.7.5, 0.8 - 0.8.3

**利用条件:** 目标服务器运行受影响版本的libssh，且未进行身份验证

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2018-10933是libssh库中的一个身份验证绕过漏洞。攻击者可以通过发送`SSH2_MSG_USERAUTH_SUCCESS`消息来绕过身份验证。根据提供的漏洞利用代码，`checkip.py`、`checkit.py`和`sneak.py` 脚本都尝试利用此漏洞。`sneak.py`尝试扫描指定CIDR块中易受攻击的服务器，并将结果写入`ipaddresslist.txt`。`checkit.py`读取 `ipaddresslist.txt` 中的IP地址，并尝试进行身份验证绕过。`checkip.py` 直接连接到目标IP，尝试进行身份验证绕过，并执行`id`命令。

**有效性：**提供的POC代码有效，可以绕过身份验证并在目标服务器上执行命令。

**投毒风险：** 代码中存在小概率投毒风险。虽然核心逻辑是利用漏洞，但`sneak.py`会将扫描结果写入文件。如果攻击者恶意修改了IP地址扫描范围,可能会被用于扫描内网，一定程度上扩大攻击范围。代码本身依赖paramiko模块，如果安装源被篡改也可能造成供应链投毒。 综合判断投毒风险为10%。

**利用方式：**

1.  使用`sneak.py`扫描指定IP地址范围，查找存在漏洞的libssh服务器，并将结果保存到`ipaddresslist.txt`。
2.  使用`checkit.py`读取`ipaddresslist.txt`中的IP地址，并尝试通过发送`SSH2_MSG_USERAUTH_SUCCESS`消息绕过身份验证。
3.  如果身份验证绕过成功，服务器将允许攻击者执行任意命令。
4.  `checkip.py` 脚本直接尝试利用单个IP的漏洞，并执行`id`命令。

**安全建议：** 将libssh升级到0.7.6或0.8.4及以上版本。

**项目地址:** [0xadaw/libSSH-bypass](https://github.com/0xadaw/libSSH-bypass)

**漏洞详情:** [CVE-2018-10933](https://nvd.nist.gov/vuln/detail/CVE-2018-10933)