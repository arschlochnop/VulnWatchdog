## CVE-2024-3094 XZ Utils Backdoor

**漏洞编号:** CVE-2024-3094

**漏洞类型:** 供应链攻击/后门

**影响应用:** XZ Utils

**危害等级:** 极危，可导致未经授权的远程SSH访问

**影响版本:** 5.6.0 和 5.6.1

**利用条件:** 系统使用了受感染的XZ Utils版本，并且OpenSSH链接了liblzma库。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-3094是一个在XZ Utils 5.6.0和5.6.1版本中发现的供应链攻击。攻击者通过复杂的混淆手段，将恶意代码注入到liblzma库的构建过程中。该恶意代码能够拦截并修改与liblzma库的交互数据，特别是影响OpenSSH的身份验证过程，从而允许攻击者在未经授权的情况下远程访问系统。

**有效性分析：**
根据漏洞库信息和搜索引擎结果，此漏洞影响XZ Utils 5.6.0和5.6.1版本，影响严重程度为“极危”。漏洞利用代码（虽然本身不是一个完整的exploit，而更像是一个用于搭建测试环境的Dockerfile和Makefile）的存在进一步表明，该漏洞是真实且可利用的。

**投毒风险分析：**
提供的Dockerfile和Makefile主要用于构建一个包含编译工具和调试工具的Debian Bookworm容器，用于研究IFUNC（Indirect Function Call）的性能。这些代码本身**不是**漏洞利用代码，而是一个用于测试和研究IFUNC的辅助环境。虽然原作者的本意并非投毒，但仍存在一定风险。

*   Dockerfile：用于构建容器镜像，安装必要的软件包。没有发现明显的恶意代码。
*   Makefile：用于编译和运行测试代码，以及进行性能分析。存在利用编译时注入恶意代码的可能性，例如在编译选项中添加恶意链接库，或者修改源代码后再进行编译。但是，提供的Makefile并没有明显的恶意行为，它的目的主要是为了测试IFUNC。
*   README.md：是对整个项目的一个介绍，并没有发现什么有恶意行为的内容。

考虑到供应链攻击的性质，即使提供的代码本身没有明显的恶意行为，也不能完全排除投毒的可能性。可能存在的风险点在于Makefile中对编译过程的控制，以及可能存在的对编译环境的依赖。但总体来说，投毒的概率较低，约为5%。

**利用方式分析：**
1.  **恶意代码注入：** 攻击者通过复杂的混淆手段，将恶意代码伪装成测试文件，并嵌入到XZ Utils的源代码中。
2.  **构建过程劫持：** 在liblzma的构建过程中，恶意代码被提取并用于修改liblzma库的关键函数。
3.  **SSH后门：** 修改后的liblzma库会被OpenSSH链接，导致OpenSSH在身份验证过程中调用恶意代码。
4.  **远程访问：** 攻击者可以利用后门绕过SSH身份验证，从而获得对受感染系统的远程访问权限。

**总结：** CVE-2024-3094是一个非常严重的供应链攻击，它利用了XZ Utils的构建过程，在liblzma库中植入后门，最终导致OpenSSH被攻陷。虽然提供的代码本身不是一个完整的exploit，但Dockerfile和Makefile的存在表明该漏洞是真实且可利用的。投毒风险较低，但不能完全排除。利用方式是通过恶意代码注入、构建过程劫持和SSH后门，实现未经授权的远程访问。

**项目地址:** [robertdfrench/ifuncd-up](https://github.com/robertdfrench/ifuncd-up)

**漏洞详情:** [CVE-2024-3094](https://nvd.nist.gov/vuln/detail/CVE-2024-3094)