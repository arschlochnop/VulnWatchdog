## CVE-2020-11651-SaltStack认证绕过与远程代码执行

**漏洞编号:** CVE-2020-11651

**漏洞类型:** 认证绕过/远程代码执行

**影响应用:** SaltStack

**危害等级:** 高危，可导致完全控制Salt Master和Minion

**影响版本:** < 2019.2.4, 3000 <= version < 3000.2

**利用条件:** 需要能够访问Salt Master的4506端口

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-11651 存在于 SaltStack Salt 2019.2.4 之前和 3000 版本到 3000.2 版本。salt-master 进程的 ClearFuncs 类没有正确验证方法调用。这允许远程用户无需身份验证即可访问某些方法。这些方法可用于从 salt master 检索用户令牌，或在 salt minions 上运行任意命令。

**漏洞利用方式：**
1.  **认证绕过:** 攻击者可以绕过 salt-master 的身份验证机制，利用未授权访问。
2.  **信息泄露:** 利用未授权访问，攻击者可以获取敏感信息，例如 root key。
3.  **远程代码执行:** 通过 wheel 模块，攻击者可以使用 root key 在 salt master 或者 minion 上执行任意命令。

**有效性：**
根据漏洞描述和PoC代码，该PoC代码能够利用 CVE-2020-11651 漏洞，实现读取文件、远程代码执行等操作，因此该PoC有效。

**投毒风险：**
PoC代码存在一定的投毒风险，可能性为10%。
*   PoC中包含反弹shell的功能，如果攻击者恶意修改反弹shell的地址，可能会导致用户被反弹到攻击者控制的服务器上。
*   PoC中包含执行任意命令的功能，如果使用者不小心执行了恶意命令，可能会导致系统被破坏。
*   PoC需要用户输入目标IP，使用者可能会被诱导输入错误的IP地址，从而攻击到错误的服务器。

总的来说，该PoC的投毒风险较低，主要集中在使用不当可能导致的风险，但并不能完全排除作者隐藏恶意代码的可能性，建议使用者在使用前仔细检查代码。

**搜索引擎结果参考：**
*   NVD 和 Mitre CVE 页面提供了漏洞的基本信息。
*   Rapid7 和 Trend Micro 的文章分析了漏洞的细节和利用方式，以及该漏洞被用于传播 Coinminer 的案例。
*   GitHub 上的 PoC 可以用于验证漏洞是否存在。

**项目地址:** [ssrsec/CVE-2020-11651-CVE-2020-11652-EXP](https://github.com/ssrsec/CVE-2020-11651-CVE-2020-11652-EXP)

**漏洞详情:** [CVE-2020-11651](https://nvd.nist.gov/vuln/detail/CVE-2020-11651)