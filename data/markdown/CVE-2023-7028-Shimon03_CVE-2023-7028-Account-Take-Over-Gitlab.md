## CVE-2023-7028-GitLab-账户接管

**漏洞编号:** CVE-2023-7028

**漏洞类型:** 弱密码恢复机制

**影响应用:** GitLab

**危害等级:** 高危，允许攻击者无需用户交互即可接管账户

**影响版本:** 16.1 < version < 16.1.6, 16.2 < version < 16.2.9, 16.3 < version < 16.3.7, 16.4 < version < 16.4.5, 16.5 < version < 16.5.6, 16.6 < version < 16.6.4, 16.7 < version < 16.7.2

**利用条件:** 目标GitLab实例存在漏洞且可网络访问

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-7028 是一个影响 GitLab CE/EE 的账户接管漏洞。该漏洞源于密码重置流程中的缺陷，允许攻击者通过提供两个邮箱地址（目标用户的邮箱地址和一个攻击者控制的邮箱地址）来接收密码重置链接，从而控制目标用户的账户。POC代码通过以下步骤利用该漏洞：

1.  **获取 CSRF Token:** 从密码重置页面获取 CSRF token，用于后续的请求。
2.  **发送密码重置请求:** 构造包含两个邮箱地址（目标用户的邮箱和攻击者控制的邮箱）的 POST 请求到 `/users/password` 接口。
3.  **接收重置链接:** 攻击者在其控制的邮箱中收到密码重置链接。
4.  **重置密码:** 使用收到的链接，攻击者可以设置目标用户的密码，从而接管其账户。

**有效性：** 根据漏洞描述和搜索结果，POC代码有效，能够实现账户接管。

**投毒风险：**  POC代码主要功能是利用 GitLab 密码重置漏洞。代码中使用了 `requests` 库发送 HTTP 请求，`re` 库进行正则表达式匹配，`urllib.parse` 库进行 URL 编码，以及`OneSecMail_api`类与临时邮箱服务交互。其中`OneSecMail_api`存在不稳定性，如果临时邮箱服务出现问题，可能影响POC的成功率。

代码中发现潜在风险点是，该脚本使用了外部的 `1secmail.com` 临时邮箱服务。如果该服务被恶意控制或劫持，则可能存在一定投毒风险，例如在邮箱内容中插入恶意链接或脚本。但是，如果该服务正常，则POC代码本身并没有发现明显的恶意代码或后门，因此判定投毒风险较低，约为5%。

**利用方式：** 攻击者需要指定目标用户的邮箱地址和一个攻击者可以接收邮件的邮箱地址。然后，运行POC脚本，脚本会自动完成 CSRF token 获取、密码重置请求发送和密码重置链接提取等步骤。最后，攻击者使用重置链接设置新密码，完成账户接管。

**项目地址:** [Shimon03/CVE-2023-7028-Account-Take-Over-Gitlab](https://github.com/Shimon03/CVE-2023-7028-Account-Take-Over-Gitlab)

**漏洞详情:** [CVE-2023-7028](https://nvd.nist.gov/vuln/detail/CVE-2023-7028)