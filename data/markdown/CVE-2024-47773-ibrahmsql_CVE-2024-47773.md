## CVE-2024-47773-Discourse-缓存投毒

**漏洞编号:** CVE-2024-47773

**漏洞类型:** 缓存投毒

**影响应用:** Discourse

**危害等级:** 高危，可能导致信息篡改和拒绝服务

**影响版本:** < 3.3.2 (stable), < 3.4.0.beta2 (tests-passed)

**利用条件:** 目标网站启用了匿名用户缓存

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-47773 存在于 Discourse 平台中，允许攻击者通过发送大量的 XHR 请求来投毒缓存，导致匿名用户访问网站时获取到错误的或者不完整的页面内容。攻击者可以利用这一漏洞篡改页面内容或造成一定程度的拒绝服务。

**有效性：**根据漏洞描述和POC代码，此漏洞利用是有效的。POC代码通过发送大量XHR请求来尝试污染缓存，并检测响应是否缺少预加载数据来判断投毒是否成功。搜索引擎结果也确认了漏洞的存在和影响。

**投毒风险：**
分析POC代码后，发现以下可能存在的投毒风险点：
*   代码中通过`anon_session`模拟匿名用户进行请求，如果攻击者控制了`endpoint`参数，可以引导用户访问恶意的URL。但是，该风险较低，因为需要与缓存机制配合，且在可控范围内。
*  代码中存在多线程操作，若目标服务器资源有限，可能导致拒绝服务攻击。

综合来看，POC代码存在一定程度的投毒风险，但风险主要集中在可能被滥用于拒绝服务攻击。经分析，作者隐藏恶意代码的可能性较低，约为 10%。

**利用方式：**
1.  **检测目标：** 确定目标 Discourse 实例的版本低于受影响的版本，并且启用了匿名用户缓存。
2.  **构造请求：** 利用脚本构造大量的 XHR 请求，针对特定的endpoint（例如`/categories.json`）进行攻击。
3.  **缓存投毒：** 大量请求的目标是使服务器缓存不包含预加载数据的响应，污染缓存。
4.  **验证：** 匿名用户访问受影响的页面，如果页面显示不正常或缺少数据，则表示缓存投毒成功。

**项目地址:** [ibrahmsql/CVE-2024-47773](https://github.com/ibrahmsql/CVE-2024-47773)

**漏洞详情:** [CVE-2024-47773](https://nvd.nist.gov/vuln/detail/CVE-2024-47773)