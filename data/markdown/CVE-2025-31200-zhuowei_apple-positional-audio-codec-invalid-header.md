## CVE-2025-31200-CoreAudio-内存损坏

**漏洞编号:** CVE-2025-31200

**漏洞类型:** 内存损坏

**影响应用:** visionOS, iOS, iPadOS, tvOS, macOS (CoreAudio)

**危害等级:** 高危，可能导致代码执行

**影响版本:** < 2.4 (visionOS), < 18.4 (iOS, iPadOS, tvOS), < 15.4 (macOS)

**利用条件:** 处理恶意构造的音频文件

**POC 可用性:** 部分有效

**投毒风险:** 10%

## 详情

CVE-2025-31200 是一个存在于 Apple CoreAudio 组件中的内存损坏漏洞。该漏洞通过处理恶意构造的音频文件触发，可能导致代码执行。 

**有效性分析：**

提供的 POC 代码尝试利用 `apac::hoa::CodecConfig::Deserialize` 函数中的漏洞。代码修改了音频文件中的 `mRemappingArray` 和相关的 `AudioChannelLayout` 数据，以触发越界访问或内存损坏。 

从提供的 README.md 可以看出，作者在 macOS 和 visionOS 模拟器上遇到了不同的错误信息。这表明 POC 能够触发新的安全检查，但尚未成功实现代码执行。因此，可以认为 POC **部分有效**，能够触发漏洞，但需要进一步调试和完善才能实现完整的利用。

搜索引擎结果也表明该漏洞已被积极利用，并被 CISA 加入已知被利用的漏洞列表（KEV）。这增加了该漏洞利用的可能性，并表明有攻击者正在利用或已经利用了该漏洞。

**投毒风险分析：**

根据漏洞利用代码仓库内容分析，投毒风险较低。POC 代码主要包含以下内容：

*   **README.md：** 包含漏洞分析、利用思路、调试过程和遇到的问题。
*   **apac.ksy：**  用于解析 APAC 音频格式的 Kaitai Struct 文件，不包含恶意代码。
*   **encodeme.mm 和 build_encodeme.sh/run_encodeme.sh：** 用于生成和修改 APAC 音频文件，LLDB 脚本用于动态修改内存，以触发漏洞。虽然可以向 APAC 文件注入恶意代码，但从描述判断，作者主要是尝试触发漏洞。根据 README 的自述，作者主要是想搞清楚 patch 的原理，并没有明确的攻击目标和后门植入意图。

综合分析，该仓库中存在作者隐藏的投毒代码的可能性较低，风险评估在 **10%**。

**利用方式分析：**

1.  **漏洞根源：** CoreAudio 组件在处理 APAC 音频流时，`apac::hoa::CodecConfig::Deserialize` 函数中的边界检查不完善，导致可以构造特定的音频文件，触发内存损坏。
2.  **攻击步骤：**
    *   构造恶意的 APAC 音频文件，其中包含精心设计的 `mRemappingArray` 和相关的 `AudioChannelLayout` 数据。
    *   诱使用户（目标）播放该音频文件。可以通过多种途径传播，如恶意网站、钓鱼邮件、即时通讯工具等。
    *   当 CoreAudio 组件解析该音频文件时，会触发内存损坏漏洞，导致代码执行。
3.  **利用效果：** 攻击者可以利用该漏洞执行任意代码，例如安装恶意软件、窃取用户数据、远程控制设备等。
4.  **缓解措施：** 及时更新到已修复漏洞的操作系统版本（tvOS 18.4.1, visionOS 2.4.1, iOS iOS 18.4.1 and iPadOS 18.4.1, macOS Sequoia 15.4.1）。避免打开来源不明的音频文件。

**项目地址:** [zhuowei/apple-positional-audio-codec-invalid-header](https://github.com/zhuowei/apple-positional-audio-codec-invalid-header)

**漏洞详情:** [CVE-2025-31200](https://nvd.nist.gov/vuln/detail/CVE-2025-31200)