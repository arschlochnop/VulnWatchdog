## CVE-2020-13941: Apache Solr 绝对路径文件读取/写入漏洞

**漏洞编号:** CVE-2020-13941

**漏洞类型:** 文件读取/写入

**影响应用:** Apache Solr

**危害等级:** 高危，可能导致信息泄露和远程代码执行

**影响版本:** < 8.6.0

**利用条件:** 需要Solr Replication Handler启用，且攻击者可以访问Solr服务

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

根据漏洞信息和搜索结果，以及提供的POC代码，可以判断该漏洞利用是有效的。漏洞CVE-2020-13941存在于Apache Solr 8.6.0之前的版本中。由于Replication Handler对location参数缺乏验证，攻击者可以通过backup, restore和deleteBackup命令中的location参数指定任意文件路径，从而读取或写入Solr用户可以访问的任何位置的文件。在Windows环境下，更可以通过UNC路径，迫使Solr服务器连接到攻击者控制的SMB服务器，捕获NTLM hash或进行SMB Relay攻击。

**漏洞利用方式：**
1.  攻击者通过Replication Handler的API，发送包含恶意location参数的请求。
2.  如果目标系统是Windows，location参数可以设置为UNC路径指向攻击者控制的SMB服务器。
3.  如果目标系统是Linux或Windows，攻击者可以写入Solr配置文件到可写目录(例如/tmp)，然后修改core的location指向该文件，达到RCE的目的。

**投毒风险分析：**
提供的POC代码仓库包含一个README.md文件和一个PDF文档（通过URL引用）。直接查看README.md文件本身，并没有发现明显的恶意代码。但是，需要注意以下几点：
*   **PDF文档：** PDF文档是二进制文件，如果该文档被篡改，有可能包含恶意代码。因此，存在一定风险。建议谨慎查阅。
*   **UNC路径攻击本质：** 即使POC看起来无害，但利用UNC路径的攻击本身就可能被用于恶意目的。例如，攻击者可能利用此漏洞收集凭据。

综合评估，该仓库中存在作者隐藏的投毒代码的可能性较低，但由于UNC路径攻击本身的特性和PDF文档的潜在风险，我给出的投毒风险是10%。


**项目地址:** [mbadanoiu/CVE-2020-13941](https://github.com/mbadanoiu/CVE-2020-13941)

**漏洞详情:** [CVE-2020-13941](https://nvd.nist.gov/vuln/detail/CVE-2020-13941)