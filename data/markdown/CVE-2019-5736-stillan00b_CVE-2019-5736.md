## CVE-2019-5736-runc-容器逃逸

**漏洞编号:** CVE-2019-5736

**漏洞类型:** 容器逃逸

**影响应用:** runc (Docker, containerd, CRI-O)

**危害等级:** 高危，可导致主机root权限泄露

**影响版本:** <= 1.0-rc6 (Docker < 18.09.2)

**利用条件:** 需要在容器内以root身份执行命令，或拥有容器镜像的控制权

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-5736 是一个 runc 容器逃逸漏洞，攻击者可以利用该漏洞覆盖宿主机上的 runc 二进制文件，从而获得宿主机的 root 权限。

**漏洞利用方式：**

1.  攻击者需要能够在一个容器中以 root 身份执行命令。这可以通过以下两种方式实现：
    *   创建一个新的容器，并使用攻击者控制的镜像。
    *   攻击者已经拥有对现有容器的写入权限，可以通过 `docker exec` 等方式附加到该容器。
2.  攻击者在容器内执行特定的恶意代码，该代码会尝试打开 `/proc/self/exe`，并利用文件描述符处理不当的漏洞，从而覆盖宿主机上的 `runc` 二进制文件。
3.  当宿主机下次启动新的容器时，会执行被篡改的 `runc` 二进制文件，从而执行攻击者预先设定的恶意代码，最终获得宿主机的 root 权限。

**有效性：**

提供的POC代码验证了该漏洞的有效性，并且验证了将runC设置为只读可以缓解漏洞。

**投毒风险：**

虽然POC代码本身目的是验证缓解措施，但该代码可能被恶意修改以包含后门。仔细检查了`exploit.c`, `payload.c`, `pwn.sh` 和 `Makefile`，虽然没有发现明显的恶意代码，但存在一些潜在的风险：

*   `payload.c` 可以被修改为执行任意命令，从而在宿主机上植入后门。
*   `pwn.sh` 脚本的执行流程和依赖关系较为复杂，可能存在隐藏的漏洞或恶意代码。

由于POC代码的复杂性，无法完全排除投毒的可能性。估计投毒风险为10%。因为整体目的是验证，所以投毒可能性较低。


**项目地址:** [stillan00b/CVE-2019-5736](https://github.com/stillan00b/CVE-2019-5736)

**漏洞详情:** [CVE-2019-5736](https://nvd.nist.gov/vuln/detail/CVE-2019-5736)