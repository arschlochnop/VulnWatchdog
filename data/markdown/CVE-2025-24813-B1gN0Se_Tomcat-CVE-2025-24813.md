## CVE-2025-24813 - Apache Tomcat RCE

**漏洞编号:** CVE-2025-24813

**漏洞类型:** 远程代码执行 (RCE) / 信息泄露 / 文件篡改

**影响应用:** Apache Tomcat

**危害等级:** 高危，可能导致远程代码执行，信息泄露和文件被恶意修改

**影响版本:** 9.0.0.M1 <= Apache Tomcat <= 9.0.98, 10.1.0-M1 <= Apache Tomcat <= 10.1.34, 11.0.0-M1 <= Apache Tomcat <= 11.0.2

**利用条件:** DefaultServlet 写入功能启用 (readonly=false), Partial PUT 请求支持 (Tomcat 默认支持), 文件会话持久化启用 (context.xml 配置 PersistentManager 和 FileStore), 存在反序列化利用链 (类路径下包含存在漏洞的库)

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2025-24813 是 Apache Tomcat 中的一个路径等价漏洞，该漏洞源于 'file.Name' (内部点) 的处理不当。如果满足以下所有条件，则可能导致远程代码执行，信息泄露或文件篡改：

1.  **DefaultServlet 写入功能启用：** 必须在 `web.xml` 中配置 `readonly=false`，允许 DefaultServlet 写入文件。
2.  **Partial PUT 请求支持：** Tomcat 默认支持分块上传，允许攻击者通过分块上传恶意文件。
3.  **文件会话持久化启用：** 需要在 `context.xml` 中配置 `PersistentManager` 和 `FileStore`，启用基于文件的会话存储。
4.  **存在反序列化利用链：** 类路径下需要包含存在漏洞的库（例如，`commons-collections-3.2.1.jar`），使得攻击者可以通过反序列化漏洞执行任意代码。
5.  **信息泄露/文件篡改的先决条件:** 除了上述条件外，还需要满足：writes enabled for the default servlet, support for partial PUT, a target URL for security sensitive uploads that was a sub-directory of a target URL for public uploads, attacker knowledge of the names of security sensitive files being uploaded, the security sensitive files also being uploaded via partial PUT

**利用方式：**

1.  攻击者首先利用 Partial PUT 请求上传一个恶意构造的序列化对象，该对象包含一个反序列化利用链（例如，使用 Commons Collections）。
2.  由于启用了 DefaultServlet 的写入功能，恶意文件可以被写入到 Tomcat 的会话存储目录中。
3.  当 Tomcat 尝试反序列化该会话时，由于存在利用链，攻击者可以执行任意代码。
4. 若目标满足信息泄露/文件篡改的先决条件,攻击者可以通过构造恶意的Partial PUT请求，利用路径等价绕过限制，最终实现信息泄露或者文件篡改

**投毒风险分析：**

该POC代码提供了一个 Docker Compose 文件，用于搭建易受攻击的 Tomcat 环境。该环境配置了必要的组件（DefaultServlet 写入，Partial PUT，文件会话持久化），并且包含了一个 Commons Collections 库，可以用于反序列化攻击。

代码本身看起来是直接了当的漏洞演示。投毒风险较低，但是使用该POC时仍需注意。

**有效性分析：**

根据漏洞库信息、搜索结果以及提供的利用代码来看，该漏洞已经确认被利用，并且相关的利用方式和利用条件已经比较清晰。提供的POC代码针对的是 RCE 部分，有效性较高，但成功利用取决于是否满足所有前提条件。

**项目地址:** [B1gN0Se/Tomcat-CVE-2025-24813](https://github.com/B1gN0Se/Tomcat-CVE-2025-24813)

**漏洞详情:** [CVE-2025-24813](https://nvd.nist.gov/vuln/detail/CVE-2025-24813)