## CVE-2022-0847 (Dirty Pipe)

**漏洞编号:** CVE-2022-0847

**漏洞类型:** 本地权限提升

**影响应用:** Linux Kernel

**危害等级:** 高危，允许非特权用户覆盖只读文件，导致权限提升

**影响版本:** Linux Kernel 5.17 rc6，以及其他受影响版本 (参考漏洞库信息和搜索引擎结果)

**利用条件:** 需要本地访问权限

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-0847，也被称为“Dirty Pipe”，是一个Linux内核中的本地权限提升漏洞。漏洞原因是内核在处理管道缓冲区时未正确初始化某些标志位，导致可以向只读文件中写入数据。

**有效性分析：**
根据提供的漏洞库信息、搜索引擎结果和漏洞利用代码，此漏洞POC代码**有效**。漏洞库信息中明确指出漏洞存在于特定版本的Linux内核中，并且CISA已经将此漏洞加入已知被利用的漏洞列表中。搜索引擎结果中也显示了大量关于该漏洞的分析和利用文章，以及公开可用的POC代码。

**漏洞利用代码分析：**
提供的POC代码主要通过以下步骤利用该漏洞：

1.  **检查内核版本：**  `checkVuln()`函数用于检查当前运行的内核版本是否在受影响的范围内。
2.  **准备管道：**  `preparePipe()`函数创建并填充管道，然后耗尽管道缓冲区。
3.  **创建备份：**  `createBackup()` 函数备份 `/etc/passwd` 文件到 `/tmp/passwd.bak`。
4.  **利用splice写入：** `exploitFunction()` 函数的核心在于使用 `splice()` 系统调用将只读文件的一部分数据“复制”到管道中。然后，通过向管道写入恶意数据，从而覆盖只读文件中的内容，即`/etc/passwd`文件。
5.  **覆盖/etc/passwd：** 通过向管道写入包含恶意root用户的 `/etc/passwd` 项，攻击者可以添加或修改root用户的密码，从而获得root权限。
6. **恢复/etc/passwd：** 最后, 将 `/etc/passwd` 恢复.

**投毒风险分析：**
通过仔细分析提供的POC代码，**未发现明显的投毒代码**。 代码逻辑清晰，主要用于验证和利用Dirty Pipe漏洞。 虽然代码本身具有破坏性（会修改 `/etc/passwd` 文件），但这是漏洞利用的正常行为，而不是隐藏的恶意功能。 代码中存在恢复 `/etc/passwd` 步骤，减少了直接影响。 评估结果：该代码的投毒风险为0%。

**利用方式总结：**
1.  利用Dirty Pipe漏洞，通过`splice`系统调用将目标只读文件(如`/etc/passwd`)的部分内容放入pipe中.
2.  向pipe中写入恶意数据,覆盖只读文件中的相应内容.
3.  攻击者通常通过覆盖`/etc/passwd`文件添加或修改root用户密码，获得root权限。
4.  成功利用后，攻击者可以使用新密码通过`su`命令切换到root用户。

总而言之，提供的POC代码是有效的，用于演示Dirty Pipe漏洞的利用，允许非特权本地用户覆盖只读文件并提升权限，未发现恶意投毒代码。

**项目地址:** [mutur4/CVE-2022-0847](https://github.com/mutur4/CVE-2022-0847)

**漏洞详情:** [CVE-2022-0847](https://nvd.nist.gov/vuln/detail/CVE-2022-0847)