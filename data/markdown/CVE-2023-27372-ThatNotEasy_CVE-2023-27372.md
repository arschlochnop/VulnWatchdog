## CVE-2023-27372-SPIP-Remote Code Execution

**漏洞编号:** CVE-2023-27372

**漏洞类型:** Remote Code Execution

**影响应用:** SPIP

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** < 4.2.1

**利用条件:** 目标网站必须运行存在漏洞的SPIP版本，且漏洞利用点对外开放

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-27372是SPIP内容管理系统4.2.1之前版本中的一个远程代码执行漏洞。该漏洞源于SPIP处理反序列化数据的方式不当，允许未经身份验证的攻击者通过表单值执行任意命令。根据提供的漏洞利用代码，攻击者可以指定一个包含多个URL的文件和一个要执行的命令。该脚本会向这些URL发送特制的请求，其中包含序列化的恶意payload，从而在目标服务器上执行指定的命令，获取web用户权限。该漏洞利用代码的投毒风险较低，主要风险在于使用者自身行为，利用此工具进行未授权的渗透测试或攻击。因为代码中包含从 `lib/ua.txt` 读取 User-Agent 的操作，以及输出文件功能，存在一定的信息收集行为，可能用于后期攻击，但总体上代码逻辑清晰，风险可控。

**利用方式：**

1.  **漏洞定位：** SPIP 4.2.1之前的版本存在反序列化漏洞，具体位置在`oubli`参数中，允许在公共区域提交的表单值。
2.  **攻击流程：**
    *   攻击者构造包含恶意代码的序列化payload。
    *   将payload作为表单值提交给存在漏洞的SPIP站点。
    *   SPIP站点反序列化该数据时，恶意代码被执行。
3.  **漏洞利用代码分析：**
    *   `spip.py`脚本接受目标URL列表和要执行的命令作为参数。
    *   脚本使用`requests`库发送HTTP请求，将序列化的payload包含在POST请求的参数中。
    *   服务器端反序列化payload，执行攻击者指定的命令。
4.  **缓解措施：**
    *   将SPIP升级到3.2.18, 4.0.10, 4.1.8, 或 4.2.1及以上版本。
    *   限制对SPIP站点的公共访问。

**项目地址:** [ThatNotEasy/CVE-2023-27372](https://github.com/ThatNotEasy/CVE-2023-27372)

**漏洞详情:** [CVE-2023-27372](https://nvd.nist.gov/vuln/detail/CVE-2023-27372)