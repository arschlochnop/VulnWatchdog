## CVE-2023-4596 - Forminator 任意文件上传

**漏洞编号:** CVE-2023-4596

**漏洞类型:** 任意文件上传

**影响应用:** WordPress Forminator 插件

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** <= 1.24.6

**利用条件:** 目标网站安装了存在漏洞的Forminator插件，并且攻击者可以访问到Forminator插件启用的文件上传页面。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-4596 是 WordPress Forminator 插件中的一个高危漏洞，该漏洞允许未经身份验证的攻击者上传任意文件。漏洞存在于 `upload_post_image()` 函数中，该函数在文件上传到服务器*后*才进行文件类型验证。这使得攻击者可以绕过验证机制，上传恶意文件，例如 PHP webshell，从而实现远程代码执行。

**利用方式：**

1.  攻击者需要找到目标网站上使用了Forminator插件，并且启用了文件上传功能的页面，通常这些页面包含 `<input type="file" name="forminator-field-post-image-postdata">`元素。
2.  攻击者构造一个包含恶意代码的文件，例如 PHP webshell，并将其上传到目标服务器。
3.  由于文件类型验证是在文件上传之后进行的，因此攻击者可以通过一些手段绕过验证，例如修改 Content-Type 头部，或者使用 double extension。
4.  成功上传恶意文件后，攻击者可以通过访问该文件来执行恶意代码，从而控制目标服务器。

**POC 代码分析：**

POC 脚本 `exp.py` 使用 Python 编写，它具有以下功能：

*   检查目标网站是否安装了存在漏洞的 Forminator 插件。
*   尝试上传一个包含 PHP 代码的文件。
*   如果上传成功，则尝试访问该文件以执行 PHP 代码。
*   可选地，获取目标服务器上的反向 shell。

**投毒风险评估：**

尽管该 POC 脚本主要用于验证漏洞和进行渗透测试，但仍然存在一定的投毒风险，大约为10%。这些风险可能包括：

*   **后门代码：** 脚本本身可能包含隐藏的后门代码，允许作者或其他攻击者在目标系统上执行恶意操作。 虽然代码较为简单，但不能排除作者在代码中添加隐蔽后门的可能。
*   **恶意依赖：** `requirements.txt` 文件中列出的依赖项可能包含恶意代码或漏洞，这些恶意代码或漏洞可能会被利用来攻击目标系统。虽然常用的库风险较低,但不能排除存在恶意库的可能性
*   **不安全的文件处理：** 脚本可能会以不安全的方式处理上传的文件，从而导致其他漏洞，例如本地文件包含（LFI）。
*   **诱导性脚本：** README.md 文件中描述了如何使用该脚本，但可能存在误导性信息，导致用户在不知情的情况下执行恶意操作。

**缓解措施：**

*   始终从受信任的来源下载 POC 脚本。
*   仔细审查 POC 脚本的代码，以查找任何可疑的行为。
*   在隔离的环境中运行 POC 脚本。
*   及时更新 WordPress 和 Forminator 插件到最新版本。


**项目地址:** [X-Projetion/CVE-2023-4596-Vulnerable-Exploit-and-Checker-Version](https://github.com/X-Projetion/CVE-2023-4596-Vulnerable-Exploit-and-Checker-Version)

**漏洞详情:** [CVE-2023-4596](https://nvd.nist.gov/vuln/detail/CVE-2023-4596)