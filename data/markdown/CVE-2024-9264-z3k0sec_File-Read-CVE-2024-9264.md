## CVE-2024-9264-Grafana-命令注入和本地文件包含

**漏洞编号:** CVE-2024-9264

**漏洞类型:** 命令注入和本地文件包含

**影响应用:** Grafana

**危害等级:** 高危，可能导致远程代码执行和敏感信息泄露

**影响版本:** 11.0.x, 11.1.x, 11.2.x (未修复版本)

**利用条件:** 需要Grafana的SQL Expressions实验性功能启用，DuckDB二进制文件存在于Grafana的PATH中，以及具有Viewer或更高权限的Grafana用户。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-9264存在于Grafana的SQL Expressions功能中。攻击者可以利用该漏洞执行命令注入和本地文件包含攻击。\n\n**有效性分析：**\n根据漏洞库信息和搜索结果，该漏洞是真实存在的，并且有可用的POC。POC代码中的Dockerfile用于构建包含易受攻击的Grafana版本和DuckDB的Docker镜像，确保了漏洞利用的环境。poc.py脚本利用了read_csv_auto函数读取任意文件。因此，提供的POC代码是有效的。\n\n**投毒风险分析：**\n分析了POC代码仓库，没有发现明显的恶意代码，但仍需谨慎。\n*   **Dockerfile:** 用于安装Grafana和DuckDB，未发现异常。\n*   **README.md:** 描述了漏洞和使用方法，未发现异常。\n*   **docker-compose.yml:** 用于编排Grafana和MySQL容器，配置了数据库连接，未发现异常。\n*   **poc.py:** 主要的利用脚本，通过构造恶意的SQL查询语句来读取文件，未发现明显的后门代码。脚本只是利用了漏洞本身，属于漏洞利用，不应视为投毒。但不能排除作者故意留下不易察觉的隐蔽后门的可能，例如，通过复杂的SQL语句执行额外的操作，或者通过环境变量传递恶意代码。 综合判断，投毒的风险较低，约为5%。\n\n**利用方式：**\n1.  攻击者需要一个Grafana账户，且该账户至少具有Viewer权限。\n2.  Grafana需要启用SQL Expressions实验性功能，并且DuckDB二进制文件必须安装在Grafana服务器上，且位于Grafana进程的PATH环境变量中。\n3.  攻击者使用POC脚本，通过向Grafana的/api/ds/query端点发送包含恶意SQL查询的POST请求，查询中使用`read_csv_auto`函数读取目标文件。\n4.  服务器在处理请求时，由于未对用户输入进行充分的过滤，导致`read_csv_auto`函数读取了攻击者指定的文件内容。\n5.  攻击者从响应中提取文件内容。

**项目地址:** [z3k0sec/File-Read-CVE-2024-9264](https://github.com/z3k0sec/File-Read-CVE-2024-9264)

**漏洞详情:** [CVE-2024-9264](https://nvd.nist.gov/vuln/detail/CVE-2024-9264)