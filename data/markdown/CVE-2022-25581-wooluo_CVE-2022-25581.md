## CVE-2022-25581-Classcms-任意文件上传

**漏洞编号:** CVE-2022-25581

**漏洞类型:** 任意文件上传

**影响应用:** Classcms

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** <= 2.5

**利用条件:** 需要知道后台路径，拥有管理员账号密码，目标服务器可以访问攻击者的HTTP服务器。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-25581 漏洞存在于 Classcms v2.5 及以下版本，位于 `\class\classupload` 组件中。攻击者可以通过上传恶意文件（.txt，实际是zip压缩包）来注入代码并执行。

**有效性评估：**

提供的PoC代码看起来是有效的。它包含以下步骤：

1.  **登录后台：** 使用提供的用户名和密码登录后台，获取 Session Cookie。
2.  **获取 CSRF Token：** 访问后台页面以提取 CSRF token，用于后续的上传操作。
3.  **上传恶意压缩包：**  构造包含 Webshell 的压缩包 `shell.zip`，并利用特殊的 URL 绕过 host 白名单校验，通过 `downloadClass` 接口上传压缩包。利用了 `parse_url()` 和 `curl` 对 URL 解析的差异。
4.  **访问 Webshell：** 尝试访问上传的 Webshell，验证漏洞是否成功利用。

**投毒风险评估：**

投毒风险评估为 10%。PoC代码本身的主要目的是利用漏洞进行远程代码执行，但以下几个方面存在潜在风险：

*   **依赖外部资源：** 脚本依赖于攻击者控制的HTTP服务器来托管 `shell.zip`。攻击者可能在 `shell.zip` 中植入恶意代码，超出webshell本身的功能，从而扩大攻击范围。
*  **webshell 内容的潜在风险** webshell本身可以被视为payload,本身就存在恶意代码，但这部分不属于投毒代码。

总体而言，PoC的主要风险在于webshell的功能和外部资源的潜在恶意性，而不是代码本身的功能。

**利用方式：**

1.  攻击者需要找到 Classcms v2.5 或更早版本的实例。
2.  需要知道后台管理界面的URL，通常是 `/admin` 或类似的路径。
3.  攻击者需要拥有有效的管理员账号和密码，PoC中使用的是默认的 `admin/admin`。
4.  攻击者需要搭建一个可以被目标服务器访问的HTTP服务器，用于托管包含 Webshell 的 ZIP 文件 (shell.zip)。
5.  攻击者运行 PoC 脚本，脚本会自动完成登录、CSRF token 获取、恶意 ZIP 文件上传和 Webshell 访问等步骤。
6.  如果一切顺利，攻击者就可以通过菜刀/蚁剑等工具连接到 Webshell，从而控制目标服务器。

**项目地址:** [wooluo/CVE-2022-25581](https://github.com/wooluo/CVE-2022-25581)

**漏洞详情:** [CVE-2022-25581](https://nvd.nist.gov/vuln/detail/CVE-2022-25581)