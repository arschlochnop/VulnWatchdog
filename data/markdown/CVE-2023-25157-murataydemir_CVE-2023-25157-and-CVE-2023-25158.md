## CVE-2023-25157-GeoServer-SQL注入

**漏洞编号:** CVE-2023-25157

**漏洞类型:** SQL注入

**影响应用:** GeoServer

**危害等级:** 高危，可能导致未授权信息泄露、数据篡改和服务中断

**影响版本:** < 2.21.4, >= 2.22.0, < 2.22.2

**利用条件:** 需要GeoServer实例运行，且满足特定配置条件，例如PostGIS DataStore启用encode functions，或数据库表具有String主键列且prepared statements被禁用等。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-25157是GeoServer中的SQL注入漏洞，利用OGC Filter表达式语言和CQL（Common Query Language）的不当处理。根据漏洞利用代码描述，多个函数和过滤器都存在注入点：

*   `PropertyIsLike` filter: 当与String字段一起使用时，任何关系数据库的存储都会受到影响；PostGIS DataStore启用encode functions；或者image mosaic的索引存储在关系数据库中。
*   `strEndsWith` function: 当与PostGIS DataStore一起使用且encode functions启用时。
*   `strStartsWith` function: 当与PostGIS DataStore一起使用且encode functions启用时。
*   `FeatureId` filter: 当数据库表的String主键列使用时且prepared statements禁用时。
*   `jsonArrayContains` function: 当与String或JSON字段一起使用且与PostGIS或Oracle DataStore（仅在GeoServer 2.22.0及更高版本中）一起使用时。
*   `DWithin` filter: 当与Oracle DataStore一起使用时。

利用方式包括构造恶意的OGC Filter或CQL表达式，通过WFS、WMS或WCS协议发送给GeoServer，从而执行任意SQL命令。这可能导致敏感数据泄露、数据修改甚至服务中断。提供的POC代码库包含漏洞的详细描述和复现步骤，表明该漏洞的有效性较高。搜索引擎结果也证实了该漏洞的存在和危害。

关于投毒风险，由于POC代码只是提供漏洞复现和利用的步骤，主要关注点在于利用方式，并无发现明显的恶意代码，比如下载执行恶意脚本，上传恶意文件等操作。但是，如果攻击者修改了提供的POC并植入恶意代码，使用户在测试时受到攻击，则存在一定投毒风险。因此，将投毒风险评估为10%。

**项目地址:** [murataydemir/CVE-2023-25157-and-CVE-2023-25158](https://github.com/murataydemir/CVE-2023-25157-and-CVE-2023-25158)

**漏洞详情:** [CVE-2023-25157](https://nvd.nist.gov/vuln/detail/CVE-2023-25157)