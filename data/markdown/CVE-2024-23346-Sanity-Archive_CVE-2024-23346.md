## CVE-2024-23346-pymatgen-命令注入

**漏洞编号:** CVE-2024-23346

**漏洞类型:** 命令注入

**影响应用:** pymatgen

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** < 2024.2.20

**利用条件:** 需要目标系统存在pymatgen库的易受攻击版本，并且能够上传文件或提供恶意输入给`JonesFaithfulTransformation.from_transformation_str()`方法。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2024-23346 存在于 pymatgen 库的 `JonesFaithfulTransformation.from_transformation_str()` 方法中，由于该方法使用 `eval()` 函数处理输入，导致命令注入漏洞。攻击者可以通过上传包含恶意代码的 CIF 文件，或者向该方法提供恶意的转换字符串，从而执行任意代码。

**有效性：**
根据提供的漏洞信息、搜索引擎结果和漏洞利用代码，此漏洞是有效的。POC代码演示了如何利用此漏洞执行任意命令。

**投毒风险：**
POC代码主要包含以下部分：
1.  **恶意 CIF payload 生成：**  生成包含命令注入代码的 CIF 文件。注入代码位于`_space_group_magn.transform_BNS_Pp_abc`字段，使用python命令执行反弹shell命令。
2.  **登录目标系统：**  使用提供的用户名和密码登录目标系统。
3.  **上传恶意 CIF 文件：**  将生成的 CIF 文件上传到目标系统。
4.  **触发漏洞：**  通过访问上传的文件来触发漏洞，执行恶意代码。
5.  **反弹 Shell 监听：** 在本地启动一个 Netcat 监听器，等待反弹 shell 连接。
综上，代码主要用于演示漏洞，没有发现明显的恶意代码用于投毒。但是，**任何利用漏洞的行为都存在风险，使用者需要自行承担责任。** 考虑到POC代码的明确声明，以及代码逻辑的完整性，认为投毒风险较低。

**利用方式：**
1.  攻击者需要拥有目标系统的有效用户名和密码。
2.  攻击者使用 POC 代码生成包含恶意代码的 CIF 文件。
3.  攻击者登录目标系统。
4.  攻击者上传恶意 CIF 文件到目标系统。
5.  攻击者通过访问上传的文件，触发漏洞，执行 CIF 文件中的恶意代码，获得 shell 权限。
6.  攻击者可以在本地使用Netcat监听反弹的shell连接

**项目地址:** [Sanity-Archive/CVE-2024-23346](https://github.com/Sanity-Archive/CVE-2024-23346)

**漏洞详情:** [CVE-2024-23346](https://nvd.nist.gov/vuln/detail/CVE-2024-23346)