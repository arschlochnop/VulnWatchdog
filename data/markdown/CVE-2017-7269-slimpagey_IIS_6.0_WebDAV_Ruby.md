## CVE-2017-7269

**漏洞编号:** CVE-2017-7269

**漏洞类型:** 缓冲区溢出

**影响应用:** Microsoft IIS 6.0

**危害等级:** 高危，允许远程攻击者执行任意代码

**影响版本:** IIS 6.0 on Windows Server 2003 R2

**利用条件:** 需要目标服务器运行存在漏洞的IIS 6.0，并且WebDAV服务启用

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2017-7269是一个存在于Microsoft IIS 6.0 WebDAV服务中的缓冲区溢出漏洞。具体来说，`ScStoragePathFromUrl`函数在处理PROPFIND请求中以“If: <http://”开头的长header时存在缺陷，未进行充分的长度验证，导致缓冲区溢出。远程攻击者可以通过发送特制的PROPFIND请求，利用此漏洞在目标系统上执行任意代码。

**有效性评估：**
从漏洞库信息和搜索结果来看，CVE-2017-7269是一个已经公开披露且被广泛利用的漏洞。提供的漏洞利用代码（exploit.rb）针对此漏洞，利用Ruby编写，通过发送特制的HTTP请求触发缓冲区溢出，从而执行预定义的shellcode。搜索结果中，有多个文章和报告表明该漏洞已被用于实际攻击，例如挖矿等。

**投毒风险评估：**
检查提供的`exploit.rb`代码，发现它允许用户指定payload类型，包括calc.exe、BSOD（蓝屏死机）、msg（显示消息框）、cmd（执行命令并关闭）和adm（添加本地管理员账户）。 这些payload都是标准的功能型payload，并无明显恶意行为。需要注意的是cmd和adm payload允许执行任意命令,具有潜在的风险，但这不是投毒行为，因为利用方式已经很明确的列出来了.
该漏洞利用代码的主要风险在于，如果攻击者在不了解shellcode具体作用的情况下执行了exploit，可能会导致系统不稳定（如BSOD）。代码本身存在一些混淆，增加了一些风险。
综合评估，存在少量投毒风险。 此风险主要是由于漏洞利用者对shellcode的不了解所导致。

**利用方式：**
1.  **目标确认：** 确认目标服务器正在运行存在漏洞的IIS 6.0，且启用了WebDAV服务。
2.  **漏洞利用：** 使用提供的`exploit.rb`脚本，指定目标IP地址、端口和所需payload。
3.  **Payload选择：** 根据攻击目标，选择合适的payload。例如，使用calc payload测试漏洞，使用cmd或adm payload执行恶意操作（如安装后门或添加管理员账户）。
4.  **执行：** 运行脚本，向目标服务器发送包含恶意header的PROPFIND请求，触发缓冲区溢出。
5.  **代码执行：** 如果利用成功，目标服务器将执行预定义的shellcode，完成攻击目标。

**优先级排序:**
如先前所述，搜索引擎结果，漏洞利用代码和漏洞库信息在确定漏洞的严重性，有效性和风险方面，是依此递减的。
* 搜索引擎结果展现该漏洞已经被利用，且有对应的挖矿攻击. * 漏洞利用代码表明已经有可用的exp. * 漏洞库信息提供了漏洞的详细描述.

**项目地址:** [slimpagey/IIS_6.0_WebDAV_Ruby](https://github.com/slimpagey/IIS_6.0_WebDAV_Ruby)

**漏洞详情:** [CVE-2017-7269](https://nvd.nist.gov/vuln/detail/CVE-2017-7269)