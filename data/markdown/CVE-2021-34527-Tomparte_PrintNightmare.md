## CVE-2021-34527 PrintNightmare

**漏洞编号:** CVE-2021-34527

**漏洞类型:** 远程代码执行 (RCE) / 本地提权 (LPE)

**影响应用:** Windows Print Spooler

**危害等级:** 高危，可能导致远程代码执行和系统权限提升

**影响版本:** 受影响的Windows版本见漏洞库信息

**利用条件:** 打印服务未打补丁或配置不当，可能需要一定权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-34527（PrintNightmare）是一个Windows Print Spooler服务中的关键漏洞，允许经过身份验证的用户（在某些配置下，甚至可能未经身份验证）以SYSTEM权限执行远程代码。虽然微软发布了补丁，但最初的补丁并不完全有效，特别是对于本地提权（LPE）。

**有效性:**
从搜索结果和漏洞库信息来看，该漏洞是真实存在的，并且已被积极利用。提供的POC代码实际上**并非漏洞利用代码**，而是**缓解措施**。它通过修改注册表键来限制打印客户端连接和禁用安装打印机驱动时的警告和提权提示，以降低漏洞被利用的风险。

**投毒风险:**
该仓库的目的是提供缓解措施，而不是漏洞利用。尽管如此，任何代码库都存在潜在的投毒风险。此处的风险较低，约为10%，原因如下：
*   代码相对简单，易于审查。
*   代码主要操作注册表，影响系统策略，而非直接执行恶意代码。
*   作者提供了多个参考链接，方便用户验证代码的正确性。
但是，仍然存在一些风险：
*   恶意作者可能在脚本中添加额外的注册表修改，导致系统不稳定或出现其他问题。
*   批处理脚本可能被修改以执行其他命令，但这种修改相对容易被发现。

**利用方式:**
根据漏洞信息和搜索结果，攻击者可以利用此漏洞通过以下步骤执行任意代码：
1.  利用不安全的打印机驱动程序安装机制。
2.  上传并安装特制的恶意驱动程序。
3.  该恶意驱动程序以SYSTEM权限运行，允许攻击者完全控制系统。

需要注意的是，提供的POC代码是用来缓解漏洞的，通过修改注册表禁用或限制某些功能以降低攻击面，而不是利用漏洞本身。 它试图通过设置 `RegisterSpoolerRemoteRpcEndPoint`, `NoWarningNoElevationOnInstall`, 和 `UpdatePromptSettings` 注册表项来缓解漏洞，而不是利用漏洞。 然而，也存在潜在的投毒风险，即作者可能在脚本中包含了额外的、未说明的恶意操作。 用户在使用任何第三方脚本之前，都应该进行仔细审查。

**项目地址:** [Tomparte/PrintNightmare](https://github.com/Tomparte/PrintNightmare)

**漏洞详情:** [CVE-2021-34527](https://nvd.nist.gov/vuln/detail/CVE-2021-34527)