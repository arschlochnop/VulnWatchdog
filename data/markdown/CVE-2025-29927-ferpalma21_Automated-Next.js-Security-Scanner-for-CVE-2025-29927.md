## CVE-2025-29927-Next.js中间件授权绕过

**漏洞编号:** CVE-2025-29927

**漏洞类型:** 授权绕过

**影响应用:** Next.js

**危害等级:** 高危，可能导致未授权访问和数据泄露

**影响版本:** >= 11.1.4, <= 13.5.6, > 14.0.0, < 14.2.25, > 15.0.0, < 15.2.3

**利用条件:** 目标应用使用了Next.js中间件，并且版本在受影响范围内。 需要网络访问。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2025-29927 是一个 Next.js 中间件的授权绕过漏洞。如果授权检查发生在中间件中，攻击者可以通过操纵 `x-middleware-subrequest` 请求头来绕过授权检查，从而访问受保护的资源。 

**有效性：**
根据漏洞信息、搜索结果和提供的漏洞利用代码，该漏洞利用的有效性较高。漏洞库信息明确指出该漏洞存在于特定版本的 Next.js 中间件中。 搜索结果也显示多个安全博客和 NVD 都在讨论此漏洞，并强调了其严重性。提供的漏洞利用代码（扫描器）旨在检测和尝试利用此漏洞，进一步证实了其有效性。该POC通过版本识别和构造特定请求来验证漏洞。

**投毒风险：**
分析提供的 Javascript 代码，风险在于：
1. **依赖项风险：** `index.js` 依赖于 `puppeteer`, `yargs`, 和 `fs` 模块。如果这些依赖项本身被投毒，可能会影响脚本的安全性。
2. **外部资源引用：** 脚本从文件中读取 URL 列表 (`-f` 参数) 和字典文件 (`-w` 参数)。如果这些文件被恶意篡改，可能会导致脚本执行恶意操作。
3. **Puppeteer风险：** Puppeteer 用于模拟浏览器行为，如果网站存在恶意代码，Puppeteer 可能会被利用执行这些代码。 此外，如果Chromium路径(`-c`)被恶意修改,可能会加载恶意Chromium。
4. **尝试利用漏洞逻辑：**  `-a` 参数允许尝试利用漏洞，如果利用方式不当或目标系统存在防御机制，可能会导致拒绝服务或其他意外情况。
5. **结果输出：**  结果输出到文件 (`-o` 参数) 可能会导致敏感信息泄露。

虽然以上情况存在风险，但未发现作者主动添加的恶意代码。风险主要来自于不安全的使用方式和外部资源的潜在风险。因此，投毒风险评估为 10%。

**利用方式：**
1.  **版本检测：**  使用提供的脚本扫描目标网站，检测其是否使用 Next.js，并确定 Next.js 的版本。
2.  **漏洞验证：**  如果目标网站使用了受影响的 Next.js 版本，则尝试发送带有 `x-middleware-subrequest` 请求头的恶意请求，绕过中间件的授权检查，访问受保护的资源。
3.  **利用：** 使用攻击载荷（通过 `-w` 参数指定的字典文件），尝试不同的路径，以便绕过授权访问关键资源。
4.  **缓解措施:**  升级到 Next.js 14.2.25 或 15.2.3 或更高版本。如果无法升级，阻止包含 `x-middleware-subrequest` 头的外部用户请求。

**项目地址:** [ferpalma21/Automated-Next.js-Security-Scanner-for-CVE-2025-29927](https://github.com/ferpalma21/Automated-Next.js-Security-Scanner-for-CVE-2025-29927)

**漏洞详情:** [CVE-2025-29927](https://nvd.nist.gov/vuln/detail/CVE-2025-29927)