## CVE-2019-9193-PostgreSQL-RCE

**漏洞编号:** CVE-2019-9193

**漏洞类型:** 远程代码执行

**影响应用:** PostgreSQL

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** 9.3 <= version <= 11.7

**利用条件:** 需要PostgreSQL数据库的账号密码，并具有执行`COPY FROM PROGRAM`的权限(默认superuser或者pg_execute_server_program组的成员)

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2019-9193 允许攻击者通过 `COPY TO/FROM PROGRAM` 函数在数据库服务器上执行任意代码。虽然PostgreSQL官方认为这不是一个漏洞，而是一个功能，但攻击者可以利用此功能在服务器上执行操作系统命令。PoC代码通过连接到目标PostgreSQL数据库，创建一个临时表，然后使用 `COPY FROM PROGRAM` 执行指定的系统命令，并将结果存储在临时表中。最后，PoC代码检索并打印命令的结果，并删除临时表。

**有效性：**
根据提供的漏洞库信息、搜索引擎结果和漏洞利用代码，PoC代码是有效的。搜索引擎结果中多个链接都指向了该漏洞的利用方法，并且给出了相应的PoC。提供的PoC代码也实现了利用该漏洞执行任意命令的功能。

**投毒风险：**
该PoC代码主要功能是执行命令，没有明显的恶意代码。PoC 使用了 `argparse` 来解析参数，可以灵活地指定目标IP、端口、数据库、用户名、密码和要执行的命令。PoC创建临时表并删除，操作较为规矩，隐藏恶意代码的空间较小。PoC本身结构简单，功能明确，虽然存在很小的投毒可能性，但是整体风险不高。

**利用方式：**
1.  **身份验证：** 攻击者需要拥有PostgreSQL数据库的有效账号和密码。
2.  **权限判断：** 攻击者需要拥有执行`COPY FROM PROGRAM`的权限，该权限默认只赋予superuser或者`pg_execute_server_program`组的成员。
3.  **命令执行：** 攻击者使用 `COPY FROM PROGRAM` 命令执行任意操作系统命令。PoC代码使用 `psycopg2` 库连接到 PostgreSQL 数据库，构造恶意的SQL语句，利用 `COPY FROM PROGRAM` 执行系统命令。
4.  **结果获取：** 攻击者通过查询临时表，获取命令执行的结果。
5.  **清理现场：** 攻击者删除临时表，清理操作痕迹。

**项目地址:** [AxthonyV/CVE-2019-9193](https://github.com/AxthonyV/CVE-2019-9193)

**漏洞详情:** [CVE-2019-9193](https://nvd.nist.gov/vuln/detail/CVE-2019-9193)