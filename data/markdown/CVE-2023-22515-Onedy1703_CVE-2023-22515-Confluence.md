## CVE-2023-22515-Atlassian Confluence Broken Access Control

**漏洞编号:** CVE-2023-22515

**漏洞类型:** Broken Access Control

**影响应用:** Atlassian Confluence Server/Data Center

**危害等级:** 高危，可创建未授权的管理员账户，完全控制Confluence实例

**影响版本:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**利用条件:** Confluence实例可公开访问且未完成初始化配置

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-22515是一个存在于Atlassian Confluence Server和Data Center中的严重Broken Access Control漏洞。未经身份验证的攻击者可以利用此漏洞创建未经授权的Confluence管理员帐户，从而完全控制受影响的Confluence实例。

**有效性分析：**
根据漏洞库信息和搜索结果，该漏洞已经被积极利用。提供的POC代码是一个Nmap脚本，用于检测和利用该漏洞。脚本通过以下步骤尝试利用漏洞：

1.  **检测安装向导状态：** 检查`/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`是否返回200，判断Confluence是否处于未完成设置的状态。
2.  **注册管理员账户：** 如果处于未完成设置的状态，脚本会向`/setup/setupadministrator.action`发送POST请求，尝试注册一个管理员账户（用户名、密码等硬编码为"admin"）。同时附加header `X-Atlassian-Token: no-check`绕过token验证。
3.  **完成设置：**  向`/setup/finishsetup.action`发送POST请求，尝试完成安装设置
4.  **验证：** 检查注册管理员请求(`/setup/setupadministrator.action`)是否返回302重定向以及完成设置请求(`/setup/finishsetup.action`)是否返回200，以确认漏洞是否成功利用。

该POC代码的利用方式是利用Confluence未完成初始化配置时的安全缺陷，绕过权限检查，创建管理员账户。

**投毒风险分析：**
该仓库包含一个README.md和一个Nmap脚本myscrypt.nse。
*   **README.md：** 声明该仓库是教育目的，并提示用户注意执行文件的风险。这本身不构成投毒，但表明作者已知潜在风险。
*   **myscrypt.nse：** Nmap脚本的代码相对简单，主要功能是检测和利用CVE-2023-22515。代码中没有发现明显的恶意行为，如植入后门或执行其他未授权操作。但是，该脚本会尝试创建一个硬编码凭据（用户名：admin，密码：admin）的管理员帐户。如果攻击者成功利用此脚本，则创建的帐户本身可以被视为后门。投毒风险较低，大约为5%，因为主要风险是利用漏洞本身，而非植入额外恶意代码。

**漏洞利用方式总结：**
1.  漏洞存在于Confluence Server和Data Center版本中。
2.  漏洞允许未经身份验证的远程攻击者创建管理员账户。
3.  漏洞利用的前提是Confluence实例可以公开访问，并且尚未完成初始化设置。
4.  攻击者可以通过发送特制的HTTP请求到`/setup/setupadministrator.action`来创建管理员账户，然后使用`/setup/finishsetup.action`完成安装。
5.  成功利用此漏洞将导致完全控制受影响的Confluence实例。

**项目地址:** [Onedy1703/CVE-2023-22515-Confluence](https://github.com/Onedy1703/CVE-2023-22515-Confluence)

**漏洞详情:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)