## CVE-2024-6387-OpenSSH-竞争条件RCE/DoS

**漏洞编号:** CVE-2024-6387

**漏洞类型:** 竞争条件

**影响应用:** OpenSSH

**危害等级:** 高危，可能导致远程代码执行(RCE)和拒绝服务(DoS)

**影响版本:** 8.5p1 <= version <= 9.7p1

**利用条件:** 需要网络访问OpenSSH服务，并且目标系统基于glibc。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2024-6387（regreSSHion）是OpenSSH服务器中的一个安全漏洞，它是由CVE-2006-5051引入的回归错误。该漏洞是一个信号处理程序中的竞争条件，可能导致sshd以不安全的方式处理某些信号。未经身份验证的远程攻击者可以通过在设定的时间内未能通过身份验证来触发此漏洞，从而可能导致远程代码执行（RCE）或拒绝服务（DoS）。

**利用方式：**

1.  **建立连接：** 攻击者首先与易受攻击的OpenSSH服务器建立TCP连接。
2.  **SSH握手：** 攻击者尝试进行SSH握手，但故意不完成身份验证过程。这是为了触发`LoginGraceTime`超时。
3.  **堆准备：** 攻击者发送一系列SSH数据包，旨在操纵服务器的内存堆的布局。 这可能涉及到分配和释放内存，以便为利用创造合适的条件。
4.  **触发竞争条件：** 攻击者利用`LoginGraceTime`超时机制。当服务器由于握手超时而即将终止连接时，会发送一个信号。 攻击者尝试与此信号处理程序执行竞争，以修改服务器的内存。
5.  **代码执行：** 如果竞争成功，攻击者可以将恶意代码注入到服务器的内存中，并获得代码执行能力。 根据具体利用方式，这可能导致以root权限执行代码。

**有效性分析：**

根据漏洞库信息、搜索引擎结果和提供的PoC代码，此漏洞的利用是可行的。许多信息源表明，存在公开可用的PoC，并且已经有人成功利用了此漏洞。 PoC代码的功能是尝试利用这个竞态条件。

**投毒风险分析：**

PoC代码中存在投毒代码的风险很低，原因如下：

*   **代码结构：** 代码主要集中于建立连接、进行SSH握手、操纵堆内存以及尝试触发竞态条件。虽然代码较为复杂，但在总体流程上没有明显的恶意操作。
*   **Shellcode占位符：** 代码中存在一个 `shellcode` 占位符，明确提示用户需要替换成实际的 shellcode。这表明作者的意图是提供一个框架，而不是一个直接可用的恶意载荷。
*   **注释和说明：** 代码包含大量的注释和说明，解释了漏洞的原理、利用方法以及需要调整的参数。这表明作者的目的是帮助研究人员理解和复现漏洞，而不是隐藏恶意代码。
*   **随机性和尝试次数：** 代码包含大量的随机尝试，目的是为了提高漏洞利用的成功率。这种随机性使得代码难以预测，也增加了作者插入恶意代码的难度。
*   **外部依赖：** 代码没有包含明显的外部依赖或网络请求，这降低了其被用于下载或执行恶意代码的风险。

虽然直接投毒的可能性较低，但仍然存在一些潜在风险，比如在 `shellcode` 占位符中插入恶意代码，或者在调整参数的过程中引入错误，导致程序行为异常。因此，在使用 PoC 代码时，仍然需要进行仔细的代码审查和安全测试。

综上所述，此仓库中存在作者隐藏的投毒代码的可能性估计为1%。

**项目地址:** [DimaMend/cve-2024-6387-poc](https://github.com/DimaMend/cve-2024-6387-poc)

**漏洞详情:** [CVE-2024-6387](https://nvd.nist.gov/vuln/detail/CVE-2024-6387)