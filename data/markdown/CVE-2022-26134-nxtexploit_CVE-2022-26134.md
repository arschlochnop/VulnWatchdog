## CVE-2022-26134-Atlassian Confluence-OGNL注入

**漏洞编号:** CVE-2022-26134

**漏洞类型:** OGNL注入

**影响应用:** Atlassian Confluence Server/Data Center

**危害等级:** 高危，远程代码执行

**影响版本:** 1.3.0 < version < 7.4.17, 7.13.0 <= version < 7.13.7, 7.14.0 <= version < 7.14.3, 7.15.0 <= version < 7.15.2, 7.16.0 <= version < 7.16.4, 7.17.0 <= version < 7.17.4, 7.18.0 <= version < 7.18.1

**利用条件:** 目标Confluence实例对外开放，且版本在受影响范围内。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-26134 是一个 Atlassian Confluence Server 和 Data Center 中的 OGNL 注入漏洞。未经身份验证的攻击者可以通过构造恶意的请求，利用该漏洞在目标服务器上执行任意代码。

**有效性：**

提供的POC代码有效。搜索引擎结果表明该漏洞在野外被积极利用(webpage 0, 5, 6)。该POC代码可以检测目标Confluence的版本，并发送包含OGNL表达式的payload，从而在目标服务器上执行命令。它通过设置HTTP Header `X-Cmd-Response`来获取命令执行的结果。

**投毒风险：**

该仓库的投毒风险较低。代码较为简洁，主要功能是利用OGNL注入执行命令。虽然存在引入恶意依赖的可能性，但`requirements.txt`中只包含`bs4`, `requests`, `urllib3`这三个常用的库，被投毒的可能性不大。代码逻辑主要是构造Payload，执行命令，没有发现明显的后门代码。但仍存在一定风险，例如作者可能在之后版本引入恶意代码，或者利用依赖关系进行投毒。因此，投毒风险估计为10%。

**利用方式：**

1.  **版本检测：** POC 首先尝试从 `/login.action` 页面提取 Confluence 的版本信息，用于确定目标是否在受影响的范围内。
2.  **Payload 构造：**  POC 通过 URL 编码构造包含 OGNL 表达式的 Payload。该 Payload 利用 `org.apache.commons.io.IOUtils` 读取 Runtime 执行命令后的输入流，然后将结果设置到 HTTP 响应头的 `X-Cmd-Response` 字段中。
3.  **漏洞触发：**  POC 通过向目标 Confluence 实例发送包含 Payload 的 GET 请求来触发漏洞。
4.  **结果获取：**  POC 检查 HTTP 响应状态码是否为 302，如果是，则从响应头 `X-Cmd-Response` 中获取命令执行的结果。

**项目地址:** [nxtexploit/CVE-2022-26134](https://github.com/nxtexploit/CVE-2022-26134)

**漏洞详情:** [CVE-2022-26134](https://nvd.nist.gov/vuln/detail/CVE-2022-26134)