## CVE-2021-41617-OpenSSH-权限提升

**漏洞编号:** CVE-2021-41617

**漏洞类型:** 权限提升

**影响应用:** OpenSSH

**危害等级:** 中危，可能导致低权限用户提升至sshd进程的权限

**影响版本:** 6.2 <= version < 8.8 (需要特定非默认配置)

**利用条件:** 需要目标系统运行受影响的OpenSSH版本，且配置了AuthorizedKeysCommand 或 AuthorizedPrincipalsCommand，并以不同用户身份运行该命令。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2021-41617 存在于OpenSSH 6.2 到 8.x (不包含8.8)版本中。当使用特定的非默认配置时，由于补充组没有按预期初始化，可能导致权限提升。为AuthorizedKeysCommand 和 AuthorizedPrincipalsCommand 提供的辅助程序可能以sshd进程组成员的权限运行，如果配置指定以其他用户身份运行该命令。提供的POC代码只是一个banner抓取和版本检测脚本，用于验证目标是否运行了受影响的OpenSSH版本。它本身不包含任何漏洞利用代码，但可以帮助判断目标系统是否易受攻击。 投毒风险较低，因为脚本功能较为简单直接，主要是banner获取和版本比对，只做了版本检测，并没有做高危操作，但考虑到任何代码都存在潜在风险，故评估投毒风险为5%。

**利用方式：**

1.  **配置检查：** 检查目标系统sshd的配置，确认是否使用了`AuthorizedKeysCommand`或`AuthorizedPrincipalsCommand`指令，并且配置为以与运行sshd的用户不同的用户身份运行。
2.  **版本验证：** 使用提供的POC脚本或其他方法验证目标系统运行的OpenSSH版本是否在受影响的范围内（6.2 <= version < 8.8）。
3.  **权限提升：** 如果满足上述条件，攻击者可以构造恶意的`AuthorizedKeysCommand`或`AuthorizedPrincipalsCommand`脚本，利用未正确初始化的补充组权限，执行具有sshd进程权限的操作。这通常涉及到调用系统命令或修改系统文件，从而提升权限。这个漏洞的成功利用依赖于特定的配置，因此需要对目标系统进行仔细的检查。

**项目地址:** [AdnanApriliyansyahh/CVE-2021-41617](https://github.com/AdnanApriliyansyahh/CVE-2021-41617)

**漏洞详情:** [CVE-2021-41617](https://nvd.nist.gov/vuln/detail/CVE-2021-41617)