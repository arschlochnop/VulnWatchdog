## CVE-2022-42889-Apache Commons Text RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，可导致远程代码执行，完全控制受影响系统

**影响版本:** <= 1.9

**利用条件:** 应用程序使用受影响版本的Apache Commons Text，并且允许处理不可信的输入。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-42889 (Text4Shell) 是 Apache Commons Text 库中的一个高危漏洞。该漏洞源于程序在处理变量插值时，允许动态评估和扩展属性。在1.5到1.9版本中，默认包含的Lookup实例集中存在可能导致任意代码执行或与远程服务器通信的插值器，例如 "script" (使用JVM脚本引擎执行表达式), "dns" (解析DNS记录) 和 "url" (从URL加载值)。

**有效性：**
提供的POC代码利用了这些插值器来演示漏洞的利用。`README.md` 文件中给出了利用 `script`, `dns`, 和 `url` 前缀的示例，展示了如何执行任意代码（创建 `/tmp/blop` 文件）和进行网络交互。Dockerfile用于构建一个包含受影响版本的Commons Text的应用，方便漏洞演示。

**投毒风险：**
该仓库的主要目的是演示漏洞，并提供可利用的payload。但是，`mvnw` 文件（Maven Wrapper）是从互联网下载的，理论上存在被替换为恶意文件的风险，但这属于Maven Wrapper本身的信任问题，并非作者专门植入的后门。考虑到代码仓库的主要目的是漏洞演示，且利用方式较为直接，投毒的可能性较低，估计在10%左右。

**利用方式：**
攻击者可以构造包含恶意表达式的输入，利用 Commons Text 的变量插值功能执行任意代码或进行网络交互。例如：

*   `${script:javascript:java.lang.Runtime.getRuntime().exec('touch /tmp/blop')}` 执行系统命令。
*   `${dns:address|HOST}` 进行DNS解析，攻击者可以监控解析请求。
*   `${url:UTF-8:http://HOST}` 从指定URL加载内容，攻击者可以控制返回的内容。

应用程序如果使用受影响版本的 Commons Text，并且允许用户控制用于插值的字符串，则可能受到此漏洞的影响。修复方法是将 Apache Commons Text 升级到 1.10.0 或更高版本，该版本默认禁用有问题的插值器。

**项目地址:** [korteke/CVE-2022-42889-POC](https://github.com/korteke/CVE-2022-42889-POC)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)