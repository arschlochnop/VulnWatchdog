## CVE-2023-38831 WinRAR 远程代码执行

**漏洞编号:** CVE-2023-38831

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** WinRAR

**危害等级:** 高危，可导致完全系统控制

**影响版本:** < 6.23

**利用条件:** 用户需要使用WinRAR打开恶意构造的ZIP文件

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2023-38831 允许攻击者通过特制的ZIP文件在受害者系统上执行任意代码。该漏洞源于 WinRAR 处理包含同名文件和文件夹的 ZIP 档案时的不当行为。攻击者可以创建一个 ZIP 文件，其中包含一个良性文件（例如 CLASSIFIED_DOCUMENTS.pdf）和一个同名文件夹（例如 CLASSIFIED_DOCUMENTS.pdf）。当用户尝试访问良性文件时，WinRAR 实际上会执行该文件夹中的内容（例如 script.bat）。

**有效性:**

提供的 POC 代码 `cve-2023-38831-exp-gen.py` 旨在生成利用此漏洞的恶意 RAR 档案。该脚本通过以下步骤工作：

1.  创建临时目录 `TEMPLATE`。
2.  在 `TEMPLATE` 中创建一个与bait文件同名的文件夹，并在其中存放包含恶意命令的script文件（例如 `script.bat`， 其中包含`calc.exe & CLASSIFIED_DOCUMENTS.pdf`）。
3.  将bait文件存放在`TEMPLATE`目录。
4.  将`TEMPLATE`目录压缩为zip文件。
5.  修改压缩包中文件和文件夹的名字，构造漏洞。
6.  最终输出 `CVE-2023-38831-poc.rar`。

该脚本能够有效地生成利用 CVE-2023-38831 的 RAR 文件，因此提供的 POC 代码是有效的。

**投毒风险:**

对提供的 POC 代码 (`cve-2023-38831-exp-gen.py` 和 `script.bat`) 进行分析后，未发现明显的恶意代码或后门。该脚本的功能明确且集中于生成利用 CVE-2023-38831 的 RAR 档案。 `script.bat` 的主要功能是启动计算器程序 (`calc.exe`) 并尝试打开诱饵文档 (`CLASSIFIED_DOCUMENTS.pdf`)，这是一个典型的 PoC 行为。 因此，该仓库中存在作者隐藏的投毒代码的风险极低。

**利用方式:**

1.  攻击者使用 `cve-2023-38831-exp-gen.py` 脚本，指定诱饵文件（例如 `CLASSIFIED_DOCUMENTS.pdf`）和恶意脚本（例如 `script.bat`），生成恶意 RAR 档案。
2.  攻击者通过各种方式（例如，电子邮件、恶意网站）将恶意 RAR 档案分发给受害者。
3.  受害者使用易受攻击的 WinRAR 版本（< 6.23）打开恶意 RAR 档案。
4.  当受害者尝试访问诱饵文件时，WinRAR 错误地执行了同名文件夹中的恶意脚本。
5.  恶意脚本在受害者系统上执行任意代码，例如启动计算器或安装恶意软件。

**项目地址:** [b1tg/CVE-2023-38831-winrar-exploit](https://github.com/b1tg/CVE-2023-38831-winrar-exploit)

**漏洞详情:** [CVE-2023-38831](https://nvd.nist.gov/vuln/detail/CVE-2023-38831)