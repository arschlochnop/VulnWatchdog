## CVE-2015-3306 - ProFTPD mod_copy 文件访问控制漏洞

**漏洞编号:** CVE-2015-3306

**漏洞类型:** 文件读取/写入

**影响应用:** ProFTPD

**危害等级:** 高危，可读取任意文件，写入任意文件，甚至可导致远程代码执行

**影响版本:** 1.3.5

**利用条件:** 需要目标服务器运行ProFTPD 1.3.5，且启用了mod_copy模块，攻击者能够连接到FTP服务

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2015-3306 漏洞存在于 ProFTPD 1.3.5 的 mod_copy 模块中。该模块允许远程攻击者通过 `SITE CPFR` 和 `SITE CPTO` 命令读取和写入任意文件。

**有效性：**
提供的 PoC 代码有效。它包含两种利用方式：

*   **方法 1：** 复制任意文件。攻击者可以使用 `SITE CPFR` 指定源文件路径，然后使用 `SITE CPTO` 指定目标文件路径，从而将服务器上的任意文件复制到 Web 目录下，然后通过 Web 访问该文件。
*   **方法 2：** 写入后门。攻击者首先尝试将 `/proc/self/cmdline` 的内容复制到 `/tmp/...<?php passthru($_GET['img']);?>`，然后再将该临时文件复制到 Web 目录下，命名为 `lndex.php`。 成功后，可以通过访问 `http://<目标IP>/lndex.php?img=<命令>` 执行任意系统命令。

**投毒风险：**
经过分析，该 PoC 代码本身不包含明显的投毒代码。代码功能明确，目的是利用漏洞进行文件复制和后门写入，没有发现其他恶意行为。投毒风险评估为 0%。

**利用方式：**
攻击者通过 FTP 客户端连接到目标 ProFTPD 服务器，发送 `SITE CPFR` 和 `SITE CPTO` 命令来利用漏洞。具体步骤如下：

1.  使用 `SITE CPFR <源文件>` 指定要复制的源文件。
2.  使用 `SITE CPTO <目标文件>` 指定复制的目标文件。

如果目标文件是 Web 目录下的 PHP 文件，攻击者可以通过 Web 浏览器访问该文件，并执行恶意代码。

**项目地址:** [shk0x/cpx_proftpd](https://github.com/shk0x/cpx_proftpd)

**漏洞详情:** [CVE-2015-3306](https://nvd.nist.gov/vuln/detail/CVE-2015-3306)