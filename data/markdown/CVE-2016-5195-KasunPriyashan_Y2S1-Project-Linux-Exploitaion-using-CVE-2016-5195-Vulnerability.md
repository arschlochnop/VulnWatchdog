## CVE-2016-5195 - Dirty COW

**漏洞编号:** CVE-2016-5195

**漏洞类型:** 权限提升

**影响应用:** Linux Kernel

**危害等级:** 高危，允许本地用户提升权限

**影响版本:** Linux kernel 2.x through 4.x before 4.8.3

**利用条件:** 本地用户访问权限，目标系统内核版本存在漏洞

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2016-5195，又名Dirty COW，是一个Linux内核中的竞争条件漏洞。它存在于`mm/gup.c`中，允许本地用户利用写时复制（COW）机制的不当处理，写入只读内存映射，从而提升权限。

**有效性：** 提供的POC代码是有效的。它通过以下步骤利用漏洞：

1.  **内存映射：** 将目标文件（例如`/etc/passwd`）以只读方式映射到内存中。
2.  **查找目标位置：** 在映射的内存中查找要修改的目标字符串（例如，包含用户ID“1001”的行）。
3.  **创建线程：** 创建两个线程：
    *   `madviseThread`：循环调用`madvise`系统调用，并传入`MADV_DONTNEED`标志。这将导致内核释放与映射内存相关的缓存，从而触发竞争条件。
    *   `writeThread`：打开`/proc/self/mem`文件，循环地将目标字符串写入先前找到的位置。
4.  **竞争条件：** `madviseThread`和`writeThread`并发执行，触发写时复制机制中的竞争条件。当`madviseThread`释放缓存时，`writeThread`有机会绕过只读保护，修改内存。

**投毒风险：**  该代码存在一定的投毒风险，因为原始代码的目标文件（`/xyz`）和目标字符串（`2222`）被修改为`/etc/passwd`和`1001`。虽然这种修改是为了利用`passwd`文件进行权限提升，但攻击者可能在其他情况下使用此代码修改其他敏感文件，实现恶意目的。风险为10%，主要基于以下考虑：

    *   **修改目标文件：** 代码修改了目标文件为/etc/passwd，这可能是提权利用。如果攻击者替换成其他文件，可能造成服务不可用或者其他恶意行为。
    *   **代码混淆/隐藏：** 虽然该仓库没有明显的代码混淆行为，但是代码的易读性和注释质量不高，如果进一步混淆代码或者在代码中加入不易察觉的恶意逻辑，则有可能造成投毒攻击。
    *   **依赖项/构建过程：** 仓库结构比较简单，没有复杂的依赖关系，被植入恶意依赖的可能性较低。但是，如果构建过程被篡改，例如在编译时加入恶意代码，则存在投毒风险。

**利用方式：**

1.  **本地权限：**  攻击者必须具有在目标系统上执行代码的本地权限。
2.  **编译和执行：**  攻击者编译并执行POC代码。
3.  **权限提升：**  如果漏洞利用成功，目标文件（例如`/etc/passwd`）将被修改，攻击者可以通过更改用户ID等方式提升权限。

此漏洞允许本地用户修改他们通常无法修改的文件，从而导致权限提升和其他安全问题。

**项目地址:** [KasunPriyashan/Y2S1-Project-Linux-Exploitaion-using-CVE-2016-5195-Vulnerability](https://github.com/KasunPriyashan/Y2S1-Project-Linux-Exploitaion-using-CVE-2016-5195-Vulnerability)

**漏洞详情:** [CVE-2016-5195](https://nvd.nist.gov/vuln/detail/CVE-2016-5195)