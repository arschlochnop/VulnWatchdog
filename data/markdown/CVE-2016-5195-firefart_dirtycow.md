## CVE-2016-5195 - Dirty COW 本地提权

**漏洞编号:** CVE-2016-5195

**漏洞类型:** 本地权限提升

**影响应用:** Linux Kernel

**危害等级:** 高危，可导致普通用户提升为 root 权限

**影响版本:** Linux kernel 2.x through 4.x before 4.8.3

**利用条件:** 需要本地用户权限，目标系统内核版本存在漏洞

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2016-5195，又名“Dirty COW”，是一个Linux内核中的竞争条件漏洞。该漏洞存在于内存管理子系统处理写时复制（COW）时。利用该漏洞，本地用户可以利用不正确的 COW 处理来写入只读内存映射，从而获得提升的权限。 

**有效性：** 
提供的POC代码有效。它基于已知的Dirty COW漏洞的利用方法，并修改了/etc/passwd文件来创建一个新的具有root权限的用户。多个来源（如NVD, Red Hat, Exploit-DB）确认了该漏洞的存在和可利用性。

**投毒风险：**
尽管此POC的目的是利用Dirty COW漏洞提升权限，但代码中也存在一定的风险，特别是对于不熟悉漏洞利用的用户：

*   **10%的投毒风险:**
    *   **文件备份操作潜在问题：** 代码尝试将 `/etc/passwd` 备份到 `/tmp/passwd.bak`。如果 `/tmp` 目录没有写权限，或者备份操作失败，则原始 `/etc/passwd` 文件可能会损坏，导致系统无法启动。
    *   **密码哈希生成：** 代码使用 `crypt` 函数生成密码哈希。虽然 `crypt` 本身没有问题，但如果用户使用了弱密码，或者 salt 值不安全，可能会降低系统的安全性。
    *   **`/etc/passwd` 修改错误：** 如果由于某种原因，利用失败，或者在利用过程中出现错误，`/etc/passwd` 文件可能会被破坏，导致系统无法正常工作。

**利用方式：**
1.  **编译：** 使用`gcc -pthread dirty.c -o dirty -lcrypt`命令编译提供的C代码。
2.  **运行：**
    *   直接运行 `./dirty`，程序会提示用户输入新密码。
    *   或者，可以通过命令行参数指定密码 `./dirty my-new-password`。
3.  **利用：** 运行后，该程序会尝试利用 Dirty COW 漏洞，修改 `/etc/passwd` 文件，添加一个新的具有 root 权限的用户 `firefart` (默认用户名，可在代码中修改)。
4.  **登录：** 成功执行后，可以使用新创建的用户 `firefart` 及其设置的密码登录系统（例如，使用 `su firefart` 或 `ssh firefart@...`）。
5.  **恢复：** **非常重要**，在完成利用后，**务必**使用 `mv /tmp/passwd.bak /etc/passwd` 命令恢复原始的 `/etc/passwd` 文件，以避免潜在的系统问题。

总而言之，提供的POC代码可以有效地利用Dirty COW漏洞进行本地提权。但是，由于`/etc/passwd`文件被篡改,需要谨慎使用，并在利用后立即恢复原始文件。用户在使用前应充分了解代码的功能和潜在风险，并根据自身需求进行修改。

**项目地址:** [firefart/dirtycow](https://github.com/firefart/dirtycow)

**漏洞详情:** [CVE-2016-5195](https://nvd.nist.gov/vuln/detail/CVE-2016-5195)