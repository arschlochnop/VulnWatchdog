## CVE-2023-30990 - IBM i DDM 远程命令执行

**漏洞编号:** CVE-2023-30990

**漏洞类型:** 远程命令执行 (RCE)

**影响应用:** IBM i

**危害等级:** 高危，可远程执行CL命令

**影响版本:** 7.2, 7.3, 7.4, 7.5

**利用条件:** 需要目标系统开启 DDM 服务 (端口 446)

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2023-30990 允许远程攻击者在 IBM i 系统上以 QUSER 身份执行 CL 命令，原因是利用了 DDM（Distributed Data Management）架构的漏洞。 

**有效性分析：**

根据漏洞库信息、搜索结果和提供的漏洞利用代码，该漏洞是真实存在的，并且存在可用的 POC 代码。

*   漏洞库信息明确指出该漏洞的存在，并描述了攻击者可以通过 DDM 架构执行 CL 命令。
*   搜索结果中包含多个关于此漏洞的分析文章，以及 Fortra 提供的免费扫描工具，进一步验证了漏洞的存在和可利用性。
*   提供的 POC 代码包括两种利用方式：DRDA S38CMD 方法和 DRDA SQL 方法。这些脚本尝试利用 DDM 协议来执行任意 CL 命令。

**漏洞利用方式：**

漏洞利用的核心在于利用 DDM 协议的不安全实现。攻击者通过构造特定的 DDM 请求，绕过身份验证，然后执行任意 CL 命令。提供的 POC 代码展示了两种可能的利用方式：

1.  **DRDA S38CMD 方法 (ddm.py)：** 该方法直接使用 S38CMD 命令执行 CL 命令。脚本首先建立与目标 IBM i 系统的 DDM 连接（通常在 446 端口）。然后，它发送一系列 DDM 请求，最终构造并发送一个包含恶意 CL 命令的请求。
2.  **DRDA SQL 方法 (ddm-bypass-test.py)：** 该方法通过 SQL 注入的方式执行 CL 命令。脚本尝试利用 `QCMDEXC` 存储过程来执行 CL 命令。它构造一个包含恶意 CL 命令的 SQL 查询，并通过 DDM 协议发送到目标系统。因为系统没有进行充分的权限控制，最终造成远程命令执行

**投毒风险分析：**

仔细分析提供的 Python 脚本和 shell 脚本，并未发现明显的恶意投毒代码。脚本的功能主要是构造并发送 DDM 请求来利用漏洞。脚本利用了漏洞，但没有额外添加后门、数据窃取等恶意行为。

*   `ddm.py` 和 `ddm-bypass-test.py` 脚本的主要功能是建立 socket 连接，构造特定的数据包并通过 socket 发送，从而触发漏洞利用。
*   `exploit.sh` 脚本调用`ddm.py`执行命令。看起来是创建一个bindshell,但本质上也是调用`ddm.py` 执行命令。所以是正常的漏洞利用.

 考虑到网络攻击中所有代码都可能存在潜在风险，且攻击者可能修改代码植入恶意行为。 此仓库中投毒风险为1%。主要风险在于攻击者可能修改脚本以包含其他恶意功能，例如安装后门、窃取敏感信息等。

**项目地址:** [silentsignal/CVE-2023-30990](https://github.com/silentsignal/CVE-2023-30990)

**漏洞详情:** [CVE-2023-30990](https://nvd.nist.gov/vuln/detail/CVE-2023-30990)