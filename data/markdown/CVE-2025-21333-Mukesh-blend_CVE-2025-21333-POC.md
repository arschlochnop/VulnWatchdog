## CVE-2025-21333-Windows Hyper-V NT Kernel Integration VSP 权限提升漏洞

**漏洞编号:** CVE-2025-21333

**漏洞类型:** 权限提升

**影响应用:** Windows Hyper-V

**危害等级:** 高危，可能导致本地攻击者获得 SYSTEM 权限

**影响版本:** 受影响版本包括 Windows 10 21H2, Windows 11 22H2, Windows 10 22H2, Windows Server 2025, Windows 11 23H2, Windows Server 23H2, Windows 11 24H2 等，详见漏洞库信息

**利用条件:** 本地访问权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2025-21333 是一个 Windows Hyper-V NT Kernel Integration VSP (虚拟机服务提供者) 中的权限提升漏洞。该漏洞是由于堆缓冲区溢出导致的，允许本地攻击者获得 SYSTEM 权限。

**有效性分析：**

从搜索结果和提供的 POC 代码来看，此漏洞的 POC 是存在的，并且在 ExploitDev 的 Reddit 页面上有相关的讨论和利用代码，以及详细的 writeup。POC 代码的 README 文件中描述了利用 WNF 状态数据和 I/O ring IOP_MC_BUFFER_ENTRY 来触发堆缓冲区溢出的方法，代码也较为完整，包含项目文件以及必要的头文件，初步判断是有效的。

**投毒风险分析：**

在提供的代码中，`CVE-2025-21333-POC.cpp` 主要包含利用漏洞的代码逻辑，包括 Windows 头文件、combaseapi.h、ioringapi.h、tlhelp32.h、DbgEng.h、aclapi.h、自定义的wnf.h和Hexdump.hpp，以及std::vector等。代码包含了IO Ring相关的操作,以及和WNF相关的函数调用。虽然代码本身看起来是利用漏洞的正常代码，但任何利用内核漏洞的 POC 都存在潜在风险，例如如果编译后的二进制文件被篡改或引入了额外的恶意代码，可能导致系统不稳定或者被植入后门。从提供的文件信息来看，投毒风险较低，主要风险在于用户自行编译后是否被植入后门。

**利用方式：**

1.  **漏洞触发：** 通过 Hyper-V 的 NT Kernel Integration VSP 组件，利用 WNF（Windows Notification Facility）状态数据和 I/O ring IOP_MC_BUFFER_ENTRY机制触发堆缓冲区溢出。
2.  **权限提升：** 成功利用堆缓冲区溢出后，攻击者可以覆盖内核内存中的关键数据结构，例如 EPROCESS 结构中的 Token 字段。通过修改当前进程的 Token 字段，攻击者可以将其替换为 SYSTEM 用户的 Token，从而获得 SYSTEM 权限。
3.  **漏洞利用代码分析**
    *   `CVE-2025-21333-POC.sln`: Visual Studio 解决方案文件，用于编译 POC 代码。
    *   `README.md`: 包含了漏洞的简要描述、利用方法和资源链接，指向了包含详细 writeup 和 exploit 代码的 GitHub 仓库。
    *   `CVE-2025-21333-POC.cpp`: 包含了漏洞利用的 C++ 源代码，涉及 Windows API 调用、I/O Ring 操作和 WNF 状态数据等。
4. **缓解措施**
   *及时应用Microsoft 发布的补丁。

**项目地址:** [Mukesh-blend/CVE-2025-21333-POC](https://github.com/Mukesh-blend/CVE-2025-21333-POC)

**漏洞详情:** [CVE-2025-21333](https://nvd.nist.gov/vuln/detail/CVE-2025-21333)