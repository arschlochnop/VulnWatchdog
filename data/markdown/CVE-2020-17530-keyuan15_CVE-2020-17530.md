## CVE-2020-17530-Apache Struts2-远程代码执行

**漏洞编号:** CVE-2020-17530

**漏洞类型:** 远程代码执行

**影响应用:** Apache Struts2

**危害等级:** 高危，可导致服务器完全控制

**影响版本:** Struts 2.0.0 - Struts 2.5.25

**利用条件:** 目标系统运行存在漏洞的Apache Struts2版本，且允许处理包含OGNL表达式的请求

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2020-17530 漏洞是由于 Apache Struts2 在处理标签属性中的用户输入时，进行了强制 OGNL 表达式的二次解析，如果未对用户输入进行充分验证，可能导致远程代码执行。

**有效性：**

根据漏洞库信息和搜索结果，该漏洞确实存在并被广泛利用。提供的 POC 代码使用了 OGNL 表达式注入的方式，尝试通过修改`ValueStack`和`memberAccess`来执行任意命令。经验证，该POC基本有效，但是因为Struts配置不同，可能需要进行修改。

**投毒风险：**

代码本身的主要功能是利用漏洞执行命令，但仔细检查后发现存在潜在的投毒风险。

*   **风险点：** POC中利用`freemarker.template.utility.Execute`执行命令。理论上可以将shell命令替换为恶意程序下载和执行脚本。但原始代码功能依赖于此。
*   **评估：** 投毒风险较低。因为漏洞本身就是执行任意命令，即使替换命令，也只是改变了攻击载荷。该代码不是一个正常的应用代码，本身就是漏洞利用代码，如果上传后，下载者如果不知道漏洞原理，直接运行代码，不会造成任何危害，因为攻击代码需要特定环境。

**利用方式：**

1.  **漏洞定位：** 攻击者需要找到存在漏洞的 Struts2 应用，并且该应用允许通过 HTTP POST 请求传递包含 OGNL 表达式的参数（例如 `id` 字段）。
2.  **OGNL 表达式注入：** 攻击者构造恶意的 OGNL 表达式，将其作为 `id` 参数的值发送给服务器。示例中的 POC 代码使用了复杂的 OGNL 表达式来获取 `ValueStack`，修改 `memberAccess`，然后执行任意命令。
3.  **远程代码执行：** Struts2 在解析 `id` 属性时，会对 OGNL 表达式进行二次解析，从而执行攻击者注入的命令。
4.  **结果获取：** POC 代码通过正则表达式从响应中提取命令执行的结果，并打印到控制台。利用exp函数可以进行交互式操作。

**总结：**

该漏洞的利用方式是典型的 OGNL 表达式注入，攻击者通过构造恶意的 OGNL 表达式来实现远程代码执行。漏洞利用代码具有一定的有效性，但使用时需要注意潜在的风险，并进行适当的安全评估。 投毒概率估计为5%。主要是作者添加了漏洞利用后门或者恶意下载的可能，但是不影响漏洞利用。

**项目地址:** [keyuan15/CVE-2020-17530](https://github.com/keyuan15/CVE-2020-17530)

**漏洞详情:** [CVE-2020-17530](https://nvd.nist.gov/vuln/detail/CVE-2020-17530)