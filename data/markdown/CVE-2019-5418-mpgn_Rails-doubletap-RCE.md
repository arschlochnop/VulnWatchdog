## CVE-2019-5418 - Rails 文件内容泄露

**漏洞编号:** CVE-2019-5418

**漏洞类型:** 文件内容泄露

**影响应用:** Rails Action View

**危害等级:** 高危，可能导致敏感信息泄露，结合其他漏洞可导致RCE

**影响版本:** < 5.2.2.1, < 5.1.6.2, < 5.0.7.2, < 4.2.11.1 and v3

**利用条件:** 目标应用使用了存在漏洞的Rails版本，且允许外部访问。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-5418 漏洞是 Rails Action View 中的一个文件内容泄露漏洞。攻击者可以通过构造特制的 Accept header，结合 `render file:` 调用，读取目标服务器上的任意文件内容。

**漏洞利用方式:**

1.  攻击者发送包含恶意 Accept header 的 HTTP 请求。
2.  Rails 应用的 Action View 组件处理该请求时，由于未正确过滤或转义 Accept header 中的内容，导致可以进行路径遍历。
3.  攻击者可以利用路径遍历读取服务器上的任意文件，例如 `credentials.yml.enc` 和 `master.key` 等敏感文件。
4.  如果同时存在 CVE-2019-5420 (反序列化漏洞)，则攻击者可以使用泄露的 `secret_key_base` 值构造恶意 payload，实现远程代码执行 (RCE)。

**有效性:**

根据漏洞库信息和搜索结果，该漏洞的 POC 代码是有效的。多个来源都证实了该漏洞的存在和利用方法。

**投毒风险:**

提供的漏洞利用代码仓库 `Rails-doubletap-exploit` 包含利用 CVE-2019-5418 和 CVE-2019-5420 的代码。代码分析显示，它首先检查目标应用是否存在 CVE-2019-5418 漏洞，然后尝试获取 `credentials.yml.enc` 和 `master.key` 文件。拿到这些文件之后，就利用 CVE-2019-5420 漏洞实现远程代码执行。

投毒风险评估：虽然该仓库旨在演示漏洞利用，但可能存在作者隐藏的恶意代码，例如收集受害者信息、植入后门等。由于该漏洞需要能运行rails代码的服务器，所以投毒的概率相比于客户端漏洞更低，初步判断投毒风险较低，在10%左右。

**总结:**

CVE-2019-5418 是一个严重的文件内容泄露漏洞，如果与 CVE-2019-5420 结合，可能导致远程代码执行。攻击者可以通过构造恶意请求来利用此漏洞。

**项目地址:** [mpgn/Rails-doubletap-RCE](https://github.com/mpgn/Rails-doubletap-RCE)

**漏洞详情:** [CVE-2019-5418](https://nvd.nist.gov/vuln/detail/CVE-2019-5418)