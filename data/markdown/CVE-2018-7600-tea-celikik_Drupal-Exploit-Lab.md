## CVE-2018-7600 Drupalgeddon2

**漏洞编号:** CVE-2018-7600

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Drupal

**危害等级:** 高危，允许未经身份验证的远程攻击者执行任意代码，完全控制受影响的Drupal站点。

**影响版本:** Drupal 7.x (< 7.58), 8.x (< 8.3.9), 8.4.x (< 8.4.6), and 8.5.x (< 8.5.1)

**利用条件:** 目标Drupal站点必须是受影响的版本，且没有应用相应的安全补丁。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2018-7600（Drupalgeddon2）是一个Drupal核心的远程代码执行漏洞。根据漏洞库信息和搜索结果，该漏洞影响多个Drupal版本，允许未经身份验证的攻击者执行任意代码。漏洞利用代码展示了使用Metasploit的drupalgeddon2模块进行攻击的流程。 

**有效性：**
提供的POC代码基于Metasploit的`drupalgeddon2`模块，该模块是公开可用的，并且被广泛用于验证和利用此漏洞。因此，POC代码的**有效性很高**，如果目标满足漏洞利用条件，则能够成功执行。

**投毒风险：**
查看提供的漏洞利用代码，该代码主要是安装和配置Drupal 7.57以及使用Metasploit模块进行渗透测试的步骤。它还包含启用 ModSecurity 作为 WAF 的操作，并测试其防御能力，然后尝试使用 Metasploit 进行攻击。最后，展示了即使有WAF存在，攻击也失败了，没有打开 Meterpreter 会话。

虽然代码的本意是演示漏洞利用与防御，但依然存在极小的投毒风险：

*   环境配置脚本中，如果作者在安装包下载链接上做了手脚，替换成了恶意版本，存在投毒的可能性。但这部分可以通过校验安装包的HASH值来规避。
*   在ModSecurity规则配置中，如果包含了恶意的排除规则，则可能降低WAF的防御能力。然而，提供的配置看起来相对标准。考虑到该项目主要关注漏洞利用演示，而并非恶意软件分发，**投毒风险较低，估计在5%左右。**

**利用方式：**
1.  攻击者识别出运行着未修补的Drupal版本的站点。
2.  攻击者构造恶意请求，通常涉及`q`参数（Drupal的路径处理机制）。
3.  恶意请求利用了Drupal的某些组件对用户输入验证不足的缺陷。
4.  恶意请求导致在服务器上执行任意PHP代码，从而实现远程代码执行。
5.  可以使用Metasploit的`drupalgeddon2`模块自动化漏洞利用过程，或者手动构造payload。

**总结：**
CVE-2018-7600是一个严重的远程代码执行漏洞，利用方式相对简单，且有公开的Metasploit模块可用。尽管代码本身演示了漏洞利用和防御，但仍需警惕潜在的投毒风险。强烈建议受影响的Drupal站点尽快升级到安全版本。

**项目地址:** [tea-celikik/Drupal-Exploit-Lab](https://github.com/tea-celikik/Drupal-Exploit-Lab)

**漏洞详情:** [CVE-2018-7600](https://nvd.nist.gov/vuln/detail/CVE-2018-7600)