## CVE-2022-41352-Zimbra-RCE

**漏洞编号:** CVE-2022-41352

**漏洞类型:** 远程代码执行

**影响应用:** Zimbra Collaboration Suite

**危害等级:** 高危，可能导致服务器完全控制和数据泄露

**影响版本:** 8.8.15 和 9.0

**利用条件:** 需要能够上传文件到 Zimbra 服务器，利用 amavis 组件的 cpio 解压漏洞。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-41352 是 Zimbra Collaboration Suite 8.8.15 和 9.0 中存在的一个远程代码执行漏洞。攻击者可以通过 amavis 组件的 cpio 解压漏洞上传恶意文件，最终导致任意代码执行。

**有效性：**
提供的 JSP Webshell 代码是有效的。攻击者可以通过构造包含恶意路径的 cpio 压缩包，将其上传到 Zimbra 服务器，利用 amavis 解压时的路径穿越漏洞，将 JSP Webshell 写入到 /opt/zimbra/jetty/webapps/zimbra/public 目录下。然后，攻击者可以通过访问该 Webshell，执行任意系统命令。

**投毒风险：**
该POC代码本身是一个标准的JSP Webshell，风险主要在于其被用于非法目的，例如远程控制服务器，窃取数据等。但从代码本身来看，直接植入恶意代码的风险较低。5% 的风险评估主要考虑到代码部署过程中可能存在的潜在风险，例如作者可能诱导使用者修改代码，从而引入恶意功能。

**利用方式：**
1.  构造恶意的 cpio 压缩包，其中包含一个精心设计的目录结构和 JSP Webshell 文件 (shell.jsp)，该目录结构包含相对路径，例如 `../../../opt/zimbra/jetty/webapps/zimbra/public/shell.jsp`。
2.  通过 Zimbra 的某个允许文件上传的接口（通常是邮件附件功能），将恶意的 cpio 压缩包上传到服务器。
3.  Zimbra 的 amavis 组件会使用 cpio 命令解压该压缩包，由于 cpio 没有正确处理相对路径，JSP Webshell 文件会被写入到 /opt/zimbra/jetty/webapps/zimbra/public/shell.jsp。
4.  攻击者可以通过访问 `https://<zimbra_server>/zimbra/public/shell.jsp?cmd=<command>` 来执行任意系统命令。

**搜索引擎结果分析：**
搜索引擎结果确认了该漏洞的存在和严重性，并指出该漏洞已被积极利用。
- 多个网页 (NVD, Rapid7, Fortinet, Securelist, Kaspersky) 描述了该漏洞以及利用方式.
- CISA KEV 目录也收录了该漏洞, 证实其已被广泛利用。
- Github上存在相关的POC代码。


**项目地址:** [qailanet/cve-2022-41352-zimbra-rce](https://github.com/qailanet/cve-2022-41352-zimbra-rce)

**漏洞详情:** [CVE-2022-41352](https://nvd.nist.gov/vuln/detail/CVE-2022-41352)