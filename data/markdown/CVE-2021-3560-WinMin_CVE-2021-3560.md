## CVE-2021-3560-Polkit-权限提升

**漏洞编号:** CVE-2021-3560

**漏洞类型:** 权限提升

**影响应用:** Polkit

**危害等级:** 高危，可能导致完全系统控制

**影响版本:** polkit 0.119

**利用条件:** 本地用户

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2021-3560 允许本地非特权用户通过欺骗 polkit 绕过 D-Bus 请求的凭据检查，从而将权限提升为 root 用户。漏洞利用方式如下：

1.  **漏洞原理：** Polkit 在处理 D-Bus 请求时，由于某些逻辑错误，未正确验证请求者的身份，导致可以伪造身份进行操作。
2.  **利用方式：** PoC 代码通过创建一个恶意的身份验证代理（Authentication Agent），并将其注册到 Polkit。该代理在接收到来自 Polkit 的身份验证请求时，会始终返回成功，从而允许攻击者执行需要 root 权限的操作。
3.  **代码分析：**
    *   `Makefile`：编译 `exploit.c`，链接必要的库 (`dbus-1`, `dbus-glib-1`, `gio-2.0`)。
    *   `README.md`：提供了漏洞的简要描述和使用方法。
    *   `agent.c`：实现了 D-Bus 接口 `org.freedesktop.PolicyKit1.AuthenticationAgent`，用于注册和处理来自 Polkit 的身份验证请求。关键函数 `auth_agent_handle_method_call` 接收来自 Polkit 的认证请求并发送认证通过的消息。
4.  **有效性：** PoC 代码有效，可以成功利用该漏洞。
5.  **投毒风险：** PoC 代码本身是直接利用漏洞，**潜在投毒点** 可能存在于以下方面：
    *   `agent.c`中，攻击者可能会在身份验证代理中添加额外的恶意代码，例如，在成功获得 root 权限后，执行某些恶意操作（例如安装后门、窃取数据等）。但根据目前的分析， `agent.c` 代码中没有明显的恶意行为，只是简单地模拟了认证过程。
    *   `Makefile`中，攻击者可能会修改编译选项，例如添加 `-fplugin=...` 引入恶意编译插件，或者链接额外的恶意库。当前`Makefile`没有发现异常。
    因此，认为存在小概率投毒风险，可能性为5%。主要是因为攻击者可能会在 PoC 代码中添加额外的恶意行为。
6.  **漏洞修复：** 升级 Polkit 到修复版本。

**项目地址:** [WinMin/CVE-2021-3560](https://github.com/WinMin/CVE-2021-3560)

**漏洞详情:** [CVE-2021-3560](https://nvd.nist.gov/vuln/detail/CVE-2021-3560)