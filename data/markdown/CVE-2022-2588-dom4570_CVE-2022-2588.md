## CVE-2022-2588 Linux Kernel cls_route filter Use-After-Free

**漏洞编号:** CVE-2022-2588

**漏洞类型:** Use-After-Free

**影响应用:** Linux Kernel

**危害等级:** 中危 (CVSS:3.1/AV:L/AC:H/PR:L/UI:N/S:U/C:N/I:L/A:H)

**影响版本:** < 6.0~rc1

**利用条件:** 需要User Namespaces支持，低权限本地用户。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-2588 是 Linux 内核 cls_route 过滤器实现中的一个 Use-After-Free 漏洞。当handle值为0时，`route4_change` 函数在释放旧过滤器之前不会将其从哈希表中移除，导致可以再次访问已释放的内存。根据漏洞利用代码中的README.md，该漏洞在 Linux v3.17 中引入，并在 v5.19 中修复。触发漏洞需要 User Namespaces。

**利用方式:**

1.  创建一个 cls_route 过滤器，其 handle 值为 0。
2.  替换该过滤器。
3.  由于handle值为0，旧的过滤器不会从哈希表中移除，但会被释放。
4.  再次尝试访问该过滤器，导致 Use-After-Free。
5.  进一步利用 double-free 漏洞可以实现权限提升（DirtyCred类似思路）。

**有效性评估:**

根据提供的漏洞信息、搜索引擎结果以及漏洞利用代码，可以确认该漏洞的POC代码是有效的。多个来源（包括NVD、RedHat、nsfocusglobal等）都确认了该漏洞的存在，并提供了相关描述和修复建议。漏洞利用代码的README.md文件也详细解释了漏洞的原理和利用方式。

**投毒风险评估:**

分析提供的代码，Makefile文件只包含编译选项，README.md文件包含漏洞描述和利用说明。唯一需要关注的文件是exp_file_credential.c（未提供）。考虑到仓库的目的是复现漏洞，作者将恶意代码隐藏在exp_file_credential.c中的可能性较小，但是依然存在一定风险（比如通过某种方法在exp_file_credential.c里放置后门代码）。结合没有完全审查exp_file_credential.c文件以及漏洞复现的性质，投毒风险评估为10%。在实际使用前，务必对`exp_file_credential.c`进行代码审计。

**排序优先级解释:**

*   **搜索引擎结果 > 漏洞利用代码 > 漏洞库信息:**  搜索引擎结果提供了漏洞的广泛影响和修复情况，因此优先级最高。漏洞利用代码直接展示了漏洞的利用方式和POC，因此优先级高于漏洞库信息。漏洞库信息提供了漏洞的基本信息，但缺乏实际的利用细节。

**项目地址:** [dom4570/CVE-2022-2588](https://github.com/dom4570/CVE-2022-2588)

**漏洞详情:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)