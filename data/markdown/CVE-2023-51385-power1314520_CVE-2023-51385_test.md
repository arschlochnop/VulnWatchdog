## CVE-2023-51385-OpenSSH-命令注入

**漏洞编号:** CVE-2023-51385

**漏洞类型:** 命令注入

**影响应用:** OpenSSH

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** < 9.6

**利用条件:** 需要受害者克隆包含恶意.gitmodules文件的Git仓库

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-51385是OpenSSH 9.6之前版本中的一个命令注入漏洞。漏洞的根本原因是OpenSSH在处理用户名或主机名中的shell元字符时存在缺陷，当这些名称被扩展令牌引用时，可能导致命令注入。

**漏洞利用方式：**
1.  **利用场景:** 攻击者可以通过创建一个包含恶意`.gitmodules`文件的Git仓库来利用此漏洞。`.gitmodules` 文件用于定义Git子模块的配置信息。
2.  **攻击步骤:**
    *   攻击者创建一个恶意Git仓库，其中包含一个`.gitmodules`文件，该文件在`url`字段中嵌入恶意命令，例如：
        ```
        url = ssh://`echo helloworld > cve.txt`foo.example.com/bar
        ```
    *   攻击者诱使受害者克隆该恶意Git仓库，并且使用`--recurse-submodules`参数。该参数指示Git同时克隆仓库及其子模块。
    *   当Git处理`.gitmodules`文件时，会执行`url`字段中的命令，导致命令注入。
3.  **利用前提条件:**
    *   受害者使用OpenSSH 9.6之前的版本。
    *   受害者的SSH客户端配置了`ProxyCommand`，并且存在可利用的扩展令牌。
    *   受害者克隆了包含恶意`.gitmodules`文件的Git仓库，并且使用了`--recurse-submodules`参数。

**有效性评估：**
根据提供的漏洞信息和POC代码，此漏洞的利用是有效的。POC代码演示了如何通过在`.gitmodules`文件的`url`字段中嵌入恶意命令来实现命令注入。当受害者克隆包含此文件的Git仓库时，恶意命令会被执行。

**投毒风险评估：**
虽然提供的POC代码本身是为了验证漏洞而编写的，但仍存在一定投毒风险。攻击者可能在POC代码中添加额外的恶意代码，例如：

*   **收集用户信息：** 在命令注入的payload中添加收集受害者系统信息的代码，例如用户名、操作系统版本等，并将这些信息发送到攻击者的服务器。
*   **安装后门：** 在受害者系统中安装后门程序，以便攻击者可以长期控制受害者系统。
*   **传播恶意软件：** 利用受害者系统作为跳板，进一步传播恶意软件。

然而，根据提供的POC代码来看，并没有发现明显的恶意行为，只是验证了命令注入。但是，如果攻击者公开分享了修改后的POC，投毒风险就会增大。因此，综合考虑，投毒风险评估为10%。原因是poc本身功能较为简单，且开源，容易被审核。

**项目地址:** [power1314520/CVE-2023-51385_test](https://github.com/power1314520/CVE-2023-51385_test)

**漏洞详情:** [CVE-2023-51385](https://nvd.nist.gov/vuln/detail/CVE-2023-51385)