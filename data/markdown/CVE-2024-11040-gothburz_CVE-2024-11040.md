## CVE-2024-11040-vllm-project/vllm-拒绝服务

**漏洞编号:** CVE-2024-11040

**漏洞类型:** 拒绝服务 (DoS)

**影响应用:** vllm-project/vllm

**危害等级:** 高危，可能导致服务中断

**影响版本:** <= 0.5.2.2

**利用条件:** 需要网络访问目标vllm服务的/v1/completions或/v1/embeddings接口

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-11040存在于vllm-project/vllm版本0.5.2.2中，是一个拒绝服务漏洞。根据漏洞库信息和POC代码，该漏洞可以通过两种方式触发：

1.  **/v1/completions端点：** 发送POST请求到/v1/completions，启用'use_beam_search'并设置'best_of'为一个非常高的值（例如POC中的20000）。这将导致服务器资源耗尽，HTTP连接超时，vllm停止有效工作，请求处于挂起状态，阻止新的completion请求。POC代码展示了如何构造这样的请求。
2.  **/v1/embeddings端点：** 向/v1/embeddings端点提供无效的JSON输入，会导致后台循环出现问题，使所有后续的completion请求返回500错误，直到vllm重启。该方法POC代码未体现。

**有效性：**

提供的POC代码针对第一种利用方式，通过配置`use_beam_search`为`true`并将`best_of`设置为20000来触发拒绝服务。由于漏洞库信息明确指出该方法可行，且POC代码直接实现了该方法，因此判断POC代码有效。

**投毒风险：**

检查提供的POC代码，未发现任何明显的恶意或后门代码。该代码仅用于发送特定构造的HTTP POST请求，以利用已知的拒绝服务漏洞。代码只包含发送请求和处理响应的逻辑，未发现任何试图修改系统、窃取数据或执行其他恶意操作的部分。因此，投毒风险为0%。

**利用方式：**

利用方式是通过发送特制的HTTP POST请求到vllm服务的/v1/completions端点来触发拒绝服务。攻击者需要设置请求体中的`use_beam_search`为`true`，并设置`best_of`为一个较大的数值。这将导致vllm服务分配大量资源进行beam search计算，最终导致服务资源耗尽，无法处理其他请求，从而实现拒绝服务攻击。

**项目地址:** [gothburz/CVE-2024-11040](https://github.com/gothburz/CVE-2024-11040)

**漏洞详情:** [CVE-2024-11040](https://nvd.nist.gov/vuln/detail/CVE-2024-11040)