## CVE-2024-21413 - Microsoft Outlook 远程代码执行漏洞

**漏洞编号:** CVE-2024-21413

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Microsoft Outlook

**危害等级:** 高危，允许攻击者在目标系统上执行任意代码，可能导致完全控制

**影响版本:** 受影响版本包括 Microsoft Office 2016 (版本低于 16.0.5435.1001), Microsoft Office 2019, Microsoft 365 Apps for Enterprise 和 Microsoft Office LTSC 2021 (版本低于 https://aka.ms/OfficeSecurityReleases)

**利用条件:** 攻击者需要诱使用户点击恶意链接，利用 MonikerLink 漏洞触发 RCE。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-21413 是一个 Microsoft Outlook 远程代码执行漏洞，也被称为 MonikerLink 漏洞。攻击者可以构造特制的链接，当用户点击这些链接时，可以在受害者的计算机上执行任意代码，而无需用户进行任何交互。根据提供的漏洞利用代码，该PoC使用 PHP 通过 `class.phpmailer.php` 库发送包含恶意链接的电子邮件，诱导用户点击。一旦点击，受害者系统会尝试通过 SMB 协议连接到攻击者的服务器，从而泄露 NTLM 哈希值。然后攻击者可以使用这些哈希值进行进一步的攻击，例如破解密码或进行 Pass-the-Hash 攻击。

**有效性：**
提供的 PoC 代码看起来是有效的，因为它利用了 CVE-2024-21413 漏洞，通过发送包含恶意链接的邮件来尝试获取用户的 NTLM 哈希值。

**投毒风险：**
提供的 PoC 主要功能是利用漏洞，没有明显的恶意代码来直接损害用户系统。但代码中存在一定的潜在风险：
1.  `class.phpmailer.php` 是一个第三方库，虽然在这个例子中只是一个邮件发送工具，但仍然有可能包含潜在的漏洞或后门。
2.  攻击者可以修改 PHP 脚本，在成功获取哈希后执行其他恶意操作，例如下载并执行恶意程序。

因此，投毒风险评估为 10%，主要来自于第三方库的潜在风险和攻击者可能进行的二次利用。

**利用方式：**
1.  攻击者设置一个 SMB 服务器，使用 `impacket-smbserver` 监听传入的连接。
2.  攻击者修改 PHP 脚本，配置邮件服务器信息，并设置 Linux 服务器的 IP 地址。
3.  攻击者向目标用户发送包含恶意链接的电子邮件。
4.  当用户点击链接时，Outlook 尝试通过 SMB 协议连接到攻击者的服务器。
5.  用户的 NTLM 哈希值被发送到攻击者的服务器。
6.  攻击者可以使用获取的 NTLM 哈希值进行进一步的攻击。

**项目地址:** [MSeymenD/CVE-2024-21413](https://github.com/MSeymenD/CVE-2024-21413)

**漏洞详情:** [CVE-2024-21413](https://nvd.nist.gov/vuln/detail/CVE-2024-21413)