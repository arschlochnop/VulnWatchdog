## CVE-2025-32463-Sudo-本地提权

**漏洞编号:** CVE-2025-32463

**漏洞类型:** 本地提权

**影响应用:** Sudo

**危害等级:** 高危，允许本地用户获取root权限

**影响版本:** 1.9.14 到 1.9.17p1 (不包含 1.9.17p1)

**利用条件:** 本地用户访问权限，需要目标系统存在sudo命令。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2025-32463 存在于 Sudo 的 chroot 选项中，允许本地用户通过指定用户可控目录下的 /etc/nsswitch.conf 文件，利用 --chroot 选项获取 root 权限。

**漏洞利用方式：**

1.  **设置 Chroot 环境:** PoC脚本首先创建一个 chroot 环境，包括必要的 lib 和 etc 目录。
2.  **写入恶意的 nsswitch.conf:** 在 chroot 环境的 etc 目录下，创建一个 nsswitch.conf 文件，该文件配置 passwd 条目使用 Xfiles 模块。这是一个自定义的 NSS 模块，用于控制用户和组的解析。
3.  **编写 Payload 源码:** 编写一个 C 语言的 payload，该 payload 会在加载时执行，通过 unsetenv 删除 LD_PRELOAD 环境变量，并通过 setuid 和 setgid 设置用户和组 ID 为 0 (root)，然后执行 /bin/sh，从而获得 root shell。
4.  **编译 Payload:** 将 C 语言 payload 编译为共享对象 (libnss_Xfiles.so.2)，并将其放置在 chroot 环境的 lib 目录下。
5.  **运行 Sudo 命令:** 使用 sudo -R CHROOT id 命令，指定 chroot 环境为之前创建的目录。sudo 在 chroot 环境中运行时，会读取恶意的 nsswitch.conf 文件，加载恶意的 libnss_Xfiles.so.2 模块，从而执行 payload 中的代码，最终获得 root 权限。
6.  **清理 Payload 源码:** 删除编译过程中产生的 Payload 源码。

**有效性：**

根据提供的漏洞信息和 PoC 代码，此 PoC 代码是有效的，它演示了如何利用 CVE-2025-32463 漏洞进行本地提权。

**投毒风险：**

尽管 PoC 代码的主要功能是利用漏洞，但仍存在一定的投毒风险，可能性为10%。

*   **潜在的恶意修改:**  虽然代码主要用于演示漏洞利用，但攻击者可能在 payload 中添加额外的恶意代码，例如，安装后门、收集信息或进行其他未经授权的操作。

*   **依赖项风险:** 该PoC依赖gcc编译环境，如果gcc被替换为恶意版本，则存在被投毒的风险。

**总结：**

该漏洞的利用方式是通过构造一个恶意的 chroot 环境，并利用 sudo 的 --chroot 选项加载该环境中的恶意 NSS 模块，从而执行任意代码并获得 root 权限。虽然 PoC 代码主要用于演示漏洞利用，但仍需注意潜在的投毒风险，在使用前进行仔细的代码审查。

**项目地址:** [abrewer251/CVE-2025-32463_Sudo_PoC](https://github.com/abrewer251/CVE-2025-32463_Sudo_PoC)

**漏洞详情:** [CVE-2025-32463](https://nvd.nist.gov/vuln/detail/CVE-2025-32463)