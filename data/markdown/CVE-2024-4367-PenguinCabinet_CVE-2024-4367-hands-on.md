## CVE-2024-4367-Firefox-PDF.js 任意JavaScript执行

**漏洞编号:** CVE-2024-4367

**漏洞类型:** 任意JavaScript执行

**影响应用:** Firefox, Firefox ESR, Thunderbird

**危害等级:** 高危，可能导致跨站脚本攻击(XSS)和信息泄露。

**影响版本:** < Firefox 126, Firefox ESR < 115.11, Thunderbird < 115.11

**利用条件:** 用户需要打开恶意的PDF文件。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-4367是Mozilla Firefox、Firefox ESR和Thunderbird中PDF.js组件的一个漏洞。该漏洞源于在处理字体时缺少类型检查，允许在PDF.js上下文中执行任意JavaScript代码。攻击者可以制作一个特制的PDF文件，当用户使用受影响的Firefox版本打开该文件时，恶意JavaScript代码将被执行。 

**有效性：**

提供的POC代码看起来是有效的。`README.md` 文件中提供了利用步骤：
1.  使用 `CVE-2024-4367.py` 脚本生成包含恶意JavaScript代码的 `poc.pdf` 文件。
2.  使用 `firefox.py` 脚本启动易受攻击版本的Firefox (例如 125版)，并自动打开 `poc.pdf`。
3.  验证是否执行了JavaScript代码，是否弹出了alert窗口。

`firefox.py` 脚本可以下载并启动指定版本的Firefox Nightly版本，这方便了漏洞的验证。脚本还包含了下载特定版本Firefox的链接。

**投毒风险：**

对提供的POC代码进行了分析，投毒风险较低，约为5%。风险主要来自于以下几个方面：

1.  **`firefox.py`脚本:**
    *   该脚本会从Mozilla的官方FTP服务器下载Firefox Nightly版本。虽然这是官方来源，但攻击者可能在未来篡改这些FTP服务器（虽然可能性极低）。或者，在下载过程中发生中间人攻击，从而下载被篡改的Firefox版本。
    *   该脚本包含 `subprocess.run` 函数，用于执行下载的Firefox。如果攻击者能够控制脚本执行的参数，可能会注入额外的参数，导致执行恶意代码。
    *   尽管脚本的目的似乎是为了方便地下载和启动特定版本的Firefox，但用户仍然需要仔细检查脚本的内容，确保下载链接和执行过程是安全的。
2.  **`CVE-2024-4367.py`脚本 (未提供具体代码):**
    *   虽然`README.md`指向一个外部github库，但如果此库被篡改，执行脚本`CVE-2024-4367.py`生成的`poc.pdf`文件有可能嵌入更恶意的Payload.
3.  **免责声明:**
    *   `README.md` 中包含免责声明，这表明作者意识到潜在的风险，并试图撇清责任。但这并不能完全消除风险，用户仍然需要自行承担使用POC代码的后果。

总的来说，该仓库的主要目的是为了演示漏洞利用，而不是为了进行恶意攻击。但是，用户在使用这些代码时仍然需要保持警惕，仔细审查代码内容，确保了解潜在的风险。

**利用方式：**

1.  **漏洞触发:** 攻击者需要制作包含特定格式的恶意PDF文件，该文件利用了PDF.js在处理字体时类型检查的缺失。
2.  **JavaScript执行:** 当受害者使用受影响的Firefox版本打开该PDF文件时，PDF.js会尝试解析恶意字体数据，由于缺少类型检查，导致任意JavaScript代码在PDF.js上下文中执行。
3.  **攻击目标:** 攻击者可以利用执行的JavaScript代码来窃取敏感信息（例如 cookies）、执行跨站脚本攻击(XSS)、或者进行其他恶意活动。

**总结：**
该漏洞允许攻击者通过构造恶意的PDF文件，在用户的浏览器中执行任意JavaScript代码。由于Firefox默认使用PDF.js打开PDF文件，因此该漏洞具有较高的影响范围。提供的POC代码可以帮助安全研究人员验证和理解该漏洞，但也需要注意潜在的安全风险。

**项目地址:** [PenguinCabinet/CVE-2024-4367-hands-on](https://github.com/PenguinCabinet/CVE-2024-4367-hands-on)

**漏洞详情:** [CVE-2024-4367](https://nvd.nist.gov/vuln/detail/CVE-2024-4367)