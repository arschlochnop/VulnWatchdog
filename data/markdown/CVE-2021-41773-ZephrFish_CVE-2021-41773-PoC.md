## CVE-2021-41773 - Apache HTTP Server Path Traversal and Remote Code Execution

**漏洞编号:** CVE-2021-41773

**漏洞类型:** 路径遍历（Path Traversal）/远程代码执行（RCE）

**影响应用:** Apache HTTP Server

**危害等级:** 高危，可能导致敏感信息泄露和远程代码执行

**影响版本:** 2.4.49

**利用条件:** 目标服务器运行Apache HTTP Server 2.4.49，并且开启了`cgi-bin`或`icons`目录，以及未对Alias指令配置的目录进行“require all denied”限制。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-41773 存在于 Apache HTTP Server 2.4.49 中，是一个路径遍历漏洞。攻击者可以利用该漏洞，通过构造特殊的 URL（包含编码后的路径遍历字符，如`.%2e`），访问服务器上受限目录之外的文件。如果服务器配置允许执行 CGI 脚本，则可能进一步导致远程代码执行。

**有效性：**
提供的`full.py`和`poc.py` PoC 代码尝试利用此漏洞。`full.py`脚本会读取目标列表（hosts.txt），然后针对每个目标，尝试通过 HTTP 和 HTTPS 协议，发送包含路径遍历的请求，访问`/etc/passwd`文件。如果响应中包含`root:*`字符串，则认为目标存在漏洞。

**投毒风险：**
查看提供的文件，`CODEOWNERS`和`README.md`没有发现恶意代码。 `poc.py`本身存在问题, 代码不完整，缺少发起请求的代码,有潜在风险,存在代码缺失,导致投毒或者payload失效，增加攻击者攻击复杂度。 `full.py` 脚本比较完整，但是代码质量不高，存在异常捕获 `except: pass`，可能隐藏一些错误信息。综合判断，该仓库存在一定概率的投毒风险，大约为10%。 主要体现在poc.py的请求代码缺失上，可能导致payload失效。

**利用方式：**
1.  **路径遍历：** 攻击者构造包含`.%2e`等路径遍历字符的 URL，绕过服务器对 URL 的规范化处理。
2.  **文件读取：** 成功遍历路径后，攻击者可以读取服务器上的任意文件，例如`/etc/passwd`、web 应用的配置文件等。
3.  **远程代码执行（RCE）：** 如果服务器配置允许 CGI 脚本的执行，攻击者可以上传恶意脚本，并通过路径遍历漏洞访问该脚本，从而在服务器上执行任意代码。为了实现RCE，需要满足以下条件：开启了CGI支持，并且能够通过遍历访问到CGI脚本目录，同时该目录没有被 “require all denied” 保护。

**缓解措施：**
*   升级到 Apache HTTP Server 2.4.50 或更高版本。
*   配置 `Alias` 指令时，确保使用 `Require all denied` 限制对目录的访问。
*   禁用不必要的 CGI 脚本执行。

**项目地址:** [ZephrFish/CVE-2021-41773-PoC](https://github.com/ZephrFish/CVE-2021-41773-PoC)

**漏洞详情:** [CVE-2021-41773](https://nvd.nist.gov/vuln/detail/CVE-2021-41773)