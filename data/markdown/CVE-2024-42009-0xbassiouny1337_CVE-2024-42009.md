## CVE-2024-42009-Roundcube-XSS

**漏洞编号:** CVE-2024-42009

**漏洞类型:** 存储型XSS

**影响应用:** Roundcube Webmail

**危害等级:** 高危，可能导致邮件窃取、会话劫持、恶意代码执行

**影响版本:** 1.5.7 及 1.6.x 到 1.6.7

**利用条件:** 需要受害者查看包含恶意payload的邮件

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-42009 是 Roundcube Webmail 1.5.7 和 1.6.x 到 1.6.7 版本中存在的存储型跨站脚本漏洞。根据漏洞库信息和搜索引擎结果，攻击者可以通过发送特制的电子邮件消息，利用 `program/actions/mail/show.php` 中 `message_body()` 函数的反序列化问题，注入恶意 JavaScript 代码。  

**有效性：**
提供的 POC 代码尝试通过向联系人表单发送包含恶意 XSS payload 的消息来利用此漏洞。Payload 的目的是当受害者查看包含该 payload 的邮件时，`onanimationstart` 事件会触发，执行 `fetch` 请求来窃取邮件内容，并将其发送到攻击者的监听服务器。代码使用了 base64 编码来传输窃取到的内容。

**投毒风险：**
代码中存在轻微的投毒风险。主要集中在以下几点：
1.  **硬编码的攻击者 IP 地址和端口：** `exploit.py` 文件中 `YOUR_IP:4444` 需要替换为攻击者的实际 IP 地址和端口。如果攻击者在不知情的情况下直接运行代码，可能会泄露攻击者的 IP 地址。
2.  **TARGET_URL 的正确性：**  需要根据实际情况修改 `TARGET_URL` 变量。如果目标 URL 不正确，攻击将无法成功。
3. **邮件发送对象:** "THE_ONE_U_WILL_SEND_EMAIL_TO"需要被替换，否则会导致攻击无法成功。

虽然存在上述需要修改的地方，可以判定为有一定概率存在诱导用户错误配置，从而泄露信息或导致利用失败的目的，但整体代码逻辑清晰，主要功能是实现漏洞利用而非恶意破坏或植入后门，因此可以判定**投毒风险较低，大约为10%**。

**利用方式：**
1.  攻击者构造包含恶意 XSS payload 的电子邮件，例如利用 `style` 属性和 `onanimationstart` 事件。
2.  攻击者将此邮件发送给目标 Roundcube 用户。
3.  当目标用户查看该邮件时，邮件内容在 `messagebody()` 函数中被处理，由于反序列化问题，恶意 JavaScript 代码会被执行。
4.  恶意 JavaScript 代码窃取邮件内容，通过 HTTP 请求发送到攻击者控制的服务器。
5.  攻击者在服务器上接收并解码窃取到的邮件内容。

此利用方式的关键在于绕过 Roundcube 的输入验证和输出编码机制，成功注入恶意 JavaScript 代码。

**项目地址:** [0xbassiouny1337/CVE-2024-42009](https://github.com/0xbassiouny1337/CVE-2024-42009)

**漏洞详情:** [CVE-2024-42009](https://nvd.nist.gov/vuln/detail/CVE-2024-42009)