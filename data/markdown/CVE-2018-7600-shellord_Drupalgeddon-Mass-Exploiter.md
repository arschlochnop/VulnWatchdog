## CVE-2018-7600 - Drupalgeddon2

**漏洞编号:** CVE-2018-7600

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Drupal

**危害等级:** 高危，允许未经身份验证的远程攻击者执行任意代码

**影响版本:** Drupal before 7.58, 8.x before 8.3.9, 8.4.x before 8.4.6, and 8.5.x before 8.5.1

**利用条件:** 目标系统运行存在漏洞的Drupal版本，且允许外部网络访问。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2018-7600 (Drupalgeddon2) 是一个存在于Drupal核心中的远程代码执行漏洞。该漏洞源于对用户提供的输入验证不足，允许攻击者在服务器上执行任意代码。

**有效性:**
根据漏洞库信息、搜索结果和提供的漏洞利用代码，该漏洞利用的有效性很高。漏洞库信息明确指出该漏洞允许远程代码执行，搜索结果表明存在大量针对该漏洞的利用尝试，并且已经有公开的Exploit-DB条目。提供的Python代码 `mass.py` 实现了对Drupal 7 和 Drupal 8的批量漏洞利用，进一步证明了漏洞的可利用性。

**投毒风险:**
分析提供的`mass.py`代码，发现该代码主要功能是批量检测和利用Drupal的CVE-2018-7600和CVE-2018-7602漏洞。代码结构清晰，包含漏洞检测和利用的核心逻辑，没有明显的恶意或隐藏功能。但是,批量漏洞利用脚本本身如果被恶意使用，例如，大规模扫描和攻击未经授权的系统，也存在一定的潜在风险。 `README.md` 文件描述了脚本的用法，包括指定目标列表、输出文件、worker数量和代理等，以及要利用的漏洞编号。
代码中存在使用eval或者其他类似的高危函数的情况，攻击者可能会篡改`COMMAND`变量来执行恶意操作。这种潜在的风险主要来自于用户的不当使用或者受到攻击者恶意篡改的情况，而不是代码作者有意植入后门。

**利用方式:**
1.  **Drupal 7:**
    *   利用 `user/password` 路径，通过构造特定的GET和POST参数，触发`passthru`函数执行命令。
    *   首先发送包含恶意payload的POST请求到 `user/password`，触发 Drupal 的渲染过程。
    *   然后从返回的 HTML 中提取 `form_build_id`。
    *   最后再次发送包含`form_build_id`的POST请求到 `file/ajax/name/#value/{form_build_id}`，从而执行恶意代码。
2.  **Drupal 8:**
    *   利用 `user/register` 路径，通过构造特定的GET和POST参数，触发`exec`函数执行命令。
    *   构造包含恶意payload的POST请求到 `/user/register`。
漏洞利用依赖于未打补丁的Drupal版本中存在的输入验证漏洞，攻击者可以利用这些漏洞执行任意PHP代码，从而完全控制受影响的系统。

**项目地址:** [shellord/Drupalgeddon-Mass-Exploiter](https://github.com/shellord/Drupalgeddon-Mass-Exploiter)

**漏洞详情:** [CVE-2018-7600](https://nvd.nist.gov/vuln/detail/CVE-2018-7600)