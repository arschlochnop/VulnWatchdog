## CVE-2021-43798-Grafana-目录遍历

**漏洞编号:** CVE-2021-43798

**漏洞类型:** 目录遍历

**影响应用:** Grafana

**危害等级:** 高危，可能导致敏感信息泄露

**影响版本:** 8.0.0-beta1 到 8.3.0 (除 8.0.7, 8.1.8, 8.2.7, 8.3.1)

**利用条件:** 需要网络访问Grafana实例，且Grafana版本在受影响范围内

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-43798 存在于 Grafana 8.0.0-beta1 到 8.3.0 版本中，是一个目录遍历漏洞。攻击者可以利用该漏洞读取服务器上的任意文件。根据漏洞库信息和搜索引擎结果，该漏洞影响 Grafana 实例，允许未经身份验证的攻击者通过构造包含目录遍历序列（如 `../../..`）的 URL，访问服务器上的敏感文件。漏洞利用代码提供了一个 bash 脚本，该脚本通过循环遍历 `plugins.txt` 文件中的插件 ID，构造恶意的 URL 并发送 HTTP 请求。如果 Grafana 实例存在漏洞，脚本将读取指定的文件内容并将其保存到 `results.txt` 文件中。 

**有效性：** 提供的POC代码有效，因为它可以利用目录遍历漏洞读取 Grafana 服务器上的任意文件。漏洞库信息和搜索结果也证实了该漏洞的存在和可利用性。

**投毒风险：** 分析POC代码后，未发现明显的恶意代码或后门。脚本的主要功能是构造和发送 HTTP 请求，以及读取和保存响应。脚本中使用的命令（如 `curl`，`grep`，`cat`）都是常见的 Linux 命令，没有被滥用的迹象。`timeout` 命令用于防止请求无限期地挂起。`plugins.txt` 文件包含常见的 Grafana 插件名称，用于构造目录遍历的 URL。脚本的目的是利用目录遍历漏洞读取文件，而不是执行恶意操作。因此，投毒风险为 0%。

**利用方式：** 
1.  **确定目标 Grafana 实例的版本：** 攻击者需要确定目标 Grafana 实例的版本是否在受影响的范围内（8.0.0-beta1 到 8.3.0，不包括 8.0.7、8.1.8、8.2.7 和 8.3.1）。
2.  **选择插件 ID：** 攻击者需要选择一个有效的 Grafana 插件 ID。`plugins.txt` 文件提供了一个插件 ID 列表。
3.  **构造恶意 URL：** 攻击者需要构造包含目录遍历序列的恶意 URL。URL 的格式如下：
    `http://<grafana_host_url>/public/plugins/<plugin_id>/../../../../../../../../..<file_path>`
    其中，`<grafana_host_url>` 是 Grafana 实例的 URL，`<plugin_id>` 是插件 ID，`<file_path>` 是要读取的文件的路径。
4.  **发送 HTTP 请求：** 攻击者需要发送 HTTP 请求到构造的恶意 URL。
5.  **读取文件内容：** 如果 Grafana 实例存在漏洞，服务器将返回文件的内容。攻击者可以读取返回的内容来获取敏感信息。

**项目地址:** [victorhorowitz/grafana-exploit-CVE-2021-43798](https://github.com/victorhorowitz/grafana-exploit-CVE-2021-43798)

**漏洞详情:** [CVE-2021-43798](https://nvd.nist.gov/vuln/detail/CVE-2021-43798)