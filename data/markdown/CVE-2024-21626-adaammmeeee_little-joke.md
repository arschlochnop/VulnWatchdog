## CVE-2024-21626-runc-容器逃逸

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可能导致主机文件系统访问和控制

**影响版本:** < 1.1.12

**利用条件:** 需要运行受影响版本的runc的容器环境

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-21626 是 runc 中的一个漏洞，允许攻击者通过文件描述符泄露和进程当前工作目录操作来实现容器逃逸。根据漏洞信息，在run exec或run命令下，新创建的容器进程可能拥有主机文件系统命名空间下的工作目录。

**有效性评估：**
根据搜索结果和漏洞描述，该漏洞确实存在，并且有公开的利用方法。搜索结果中[webpage 8](https://github.com/NitroCao/CVE-2024-21626)提到了利用方式，即通过运行一个带有`-w`参数的容器即可利用，说明POC较为简单，有效性较高。

**投毒风险分析：**
提供的漏洞利用代码包含两个 shell 脚本：
*   `/tmp/492ca481629d410b60352234cdd9b0e9/script1.sh`：该脚本只是简单地输出一些警告信息，表明系统存在漏洞，提示用户更新 runc 版本。它没有执行任何恶意操作。
*   `/tmp/492ca481629d410b60352234cdd9b0e9/script2.sh`：该脚本修改用户的 `.bashrc` 文件，使得每次打开终端时都会随机显示不同的颜色。虽然修改了 `.bashrc` 文件，但它没有执行任何危险操作，只是更改了终端的显示效果。

综合来看，提供的POC代码主要用于演示漏洞的存在，并无明显的恶意代码，判断存在轻微投毒代码的概率是10%，主要原因是`script2.sh`修改了`.bashrc`，虽然没有直接危害，但可能会影响用户体验。

**利用方式：**
根据漏洞描述和搜索结果，该漏洞的利用方式主要有以下几种：
1.  **通过 `runc exec` 命令逃逸：** 攻击者可以利用该漏洞，使新创建的容器进程拥有主机文件系统命名空间下的工作目录，从而访问甚至修改主机上的文件。
2.  **通过恶意镜像逃逸：** 攻击者可以在恶意镜像中利用该漏洞，当用户运行该镜像时，容器进程可以访问主机文件系统。
3.  **覆盖主机二进制文件：** 攻击者可以利用该漏洞覆盖主机上的二进制文件，从而实现完整的容器逃逸。

总而言之，CVE-2024-21626是一个严重的安全漏洞，攻击者可以利用该漏洞实现容器逃逸，从而控制主机。建议受影响的用户尽快升级到 runc 1.1.12 或更高版本。

**项目地址:** [adaammmeeee/little-joke](https://github.com/adaammmeeee/little-joke)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)