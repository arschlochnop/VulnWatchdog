## CVE-2025-32463-Sudo-本地提权

**漏洞编号:** CVE-2025-32463

**漏洞类型:** 本地提权

**影响应用:** Sudo

**危害等级:** 高危，可获得Root权限

**影响版本:** 1.9.14 ~ 1.9.17p1 (不包含1.9.17p1)

**利用条件:** 本地用户权限

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2025-32463 是 Sudo 1.9.14 到 1.9.17p1 之间版本存在的一个本地提权漏洞。该漏洞允许本地用户通过 `--chroot` 选项，利用用户可控目录下的 `/etc/nsswitch.conf` 文件来获得 root 权限。

**利用方式：**

1.  **创建临时目录：** 利用 Python 的 `tempfile.mkdtemp` 创建一个临时目录，作为漏洞利用的工作空间。
2.  **构造恶意代码（woot1337.c）：**  创建一个 C 文件 `woot1337.c`，其中包含一个构造函数 `woot`，该函数在程序加载时执行，通过 `setreuid(0,0)` 和 `setregid(0,0)` 将当前进程的 UID 和 GID 设置为 root，然后执行 `/bin/bash`，从而获得 root shell。
3.  **创建 nsswitch.conf 文件：** 创建 `woot/etc/nsswitch.conf` 文件，该文件指定 `passwd` 数据库的查找方式为本地文件 `/woot1337`。这个文件会被 Sudo 的 `--chroot` 选项读取。
4.  **编译恶意代码：** 使用 GCC 将 `woot1337.c` 编译成共享库 `libnss_/woot1337.so.2`。`-shared` 选项创建共享库，`-fPIC` 选项生成位置无关代码，`-Wl,-init,woot` 选项指定 `woot` 函数作为初始化函数。
5.  **执行 Sudo：** 使用 `sudo -R woot woot` 命令，`-R woot` 参数指定使用 `woot` 目录作为 chroot 根目录。由于 `nsswitch.conf` 文件被修改，系统会尝试加载 `libnss_/woot1337.so.2`，执行其中的 `woot` 函数，从而获得 root 权限。
6.  **清理：** 清理临时目录。

**有效性：**

提供的 POC 代码是有效的。它利用了 Sudo 的 `--chroot` 选项和对 `/etc/nsswitch.conf` 文件处理不当的漏洞。

**投毒风险：**

代码中存在少量投毒风险（5%）。 虽然主要目的是利用漏洞，但作者可以添加一些看似无害，实则具有恶意功能（例如，收集用户信息，删除关键文件）的代码到C代码`woot1337.c`中。 仔细审查编译和执行的外部代码是必要的。

**项目地址:** [dr4xp/sudo-chroot](https://github.com/dr4xp/sudo-chroot)

**漏洞详情:** [CVE-2025-32463](https://nvd.nist.gov/vuln/detail/CVE-2025-32463)