## CVE-2022-29464 - WSO2 任意文件上传导致远程代码执行

**漏洞编号:** CVE-2022-29464

**漏洞类型:** 任意文件上传 / 远程代码执行

**影响应用:** WSO2 API Manager, Identity Server, Enterprise Integrator, Open Banking AM/KM

**危害等级:** 高危，允许未授权的攻击者上传恶意文件并执行任意代码

**影响版本:** WSO2 API Manager 2.2.0 up to 4.0.0, WSO2 Identity Server 5.2.0 up to 5.11.0, WSO2 Identity Server Analytics 5.4.0, 5.4.1, 5.5.0 and 5.6.0, WSO2 Identity Server as Key Manager 5.3.0 up to 5.11.0, WSO2 Enterprise Integrator 6.2.0 up to 6.6.0, WSO2 Open Banking AM 1.4.0 up to 2.0.0 and WSO2 Open Banking KM 1.4.0, up to 2.0.0.

**利用条件:** 目标WSO2服务器存在/fileupload endpoint且未进行适当的路径限制。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-29464是一个存在于多个WSO2产品中的高危漏洞，允许未经身份验证的攻击者通过`/fileupload`端点上传任意文件，从而导致远程代码执行。攻击者利用路径遍历漏洞将恶意JSP文件上传到webapps目录下，例如`../../../../repository/deployment/server/webapps/authenticationendpoint/evil.jsp`。上传成功后，攻击者可以通过访问该JSP文件来执行任意系统命令。提供的POC代码通过构造包含恶意JSP代码的文件上传请求，利用该漏洞。代码首先上传一个包含命令执行功能的JSP文件，然后通过发送带有`cmd`参数的GET请求来执行系统命令。代码中未发现任何隐藏的、与漏洞利用无关的恶意代码，因此投毒风险较低。

**漏洞利用方式：**

1.  **文件上传：** 攻击者向目标WSO2服务器的`/fileupload`端点发送POST请求，上传包含恶意JSP代码的文件。Content-Disposition头包含路径遍历序列，将文件上传到webapps目录下。
2.  **代码执行：** 攻击者通过访问上传的JSP文件（例如`/authenticationendpoint/evil.jsp?cmd=whoami`）来执行任意系统命令。服务器执行JSP代码，并将命令执行结果返回给攻击者。

**有效性：**

根据漏洞描述和POC代码，此漏洞利用是有效的。利用成功与否取决于目标系统是否存在漏洞，是否打补丁，以及是否配置正确。

**搜索引擎结果：**

搜索结果表明，CVE-2022-29464是一个已被广泛利用的漏洞，多个安全厂商发布了关于该漏洞的分析报告和修复建议。有报告指出，该漏洞已被用于安装Cobalt Strike beacons和其他恶意软件。


**项目地址:** [gbrsh/CVE-2022-29464](https://github.com/gbrsh/CVE-2022-29464)

**漏洞详情:** [CVE-2022-29464](https://nvd.nist.gov/vuln/detail/CVE-2022-29464)