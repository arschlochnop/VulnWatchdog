## CVE-2023-44487-HTTP/2 Rapid Reset

**漏洞编号:** CVE-2023-44487

**漏洞类型:** 拒绝服务 (DoS)

**影响应用:** HTTP/2协议

**危害等级:** 高危，可能导致服务器资源耗尽，服务中断

**影响版本:** 所有受影响的HTTP/2实现

**利用条件:** 目标服务器启用了HTTP/2协议

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-44487 描述的是 HTTP/2 协议中的一个拒绝服务漏洞，被称为“Rapid Reset”攻击。

**漏洞分析：**
攻击者通过快速建立和取消大量的 HTTP/2 stream (流)来消耗服务器资源。其利用方式如下：

1.  **连接建立：** 攻击者与目标服务器建立一个 HTTP/2 连接。
2.  **stream 创建和发送：** 攻击者快速创建新的 HTTP/2 stream，并发送请求头部。
3.  **stream 重置：** 在服务器完全处理请求之前，攻击者立即重置(RST_STREAM)这些 stream。
4.  **资源耗尽：**  服务器需要为每个 stream 分配资源，即使 stream 很快就被重置。攻击者重复以上过程，可以快速消耗服务器的 CPU、内存和带宽，导致拒绝服务。

**有效性：**
提供的 POC 代码 `rapidreset.py` 旨在复现该漏洞。该代码使用 `h2` 库创建 HTTP/2 连接，然后循环创建 stream，发送头部，并立即使用 `RST_STREAM` 帧重置这些 stream。从代码逻辑看，该 POC 应该是有效的，因为它模拟了 rapid reset 攻击的核心步骤。

**投毒风险：**
查看提供的Python代码，没有发现明显的恶意代码或后门。
*   代码主要用于创建socket连接，建立TLS连接，构造和发送HTTP/2请求和RST_STREAM帧。
*   代码中没有执行任何系统命令或访问本地文件系统的操作。
*   没有发现任何混淆或加密的代码。

尽管如此，仍然存在微小的投毒风险，可能性大约为10%。这种风险主要来源于以下几个方面：
*   **依赖项风险：** `h2` 库本身可能存在安全漏洞，或者被恶意篡改，但这种可能性较低。
*   **代码缺陷：** 代码可能存在一些细微的缺陷，虽然不直接构成恶意代码，但在特定环境下可能被利用。
*   **作者恶意：** 尽管代码表面上是合法的PoC，但作者可能隐藏了一些难以检测的恶意行为，例如在特定条件下执行某些操作。

**利用方式：**
要成功利用此漏洞，攻击者需要：

1.  **目标确认：** 确认目标服务器支持 HTTP/2 协议且存在漏洞。
2.  **连接建立：** 与目标服务器建立 TCP 连接，并协商使用 HTTP/2 协议。
3.  **攻击执行：** 运行 POC 代码，或编写类似脚本，快速发送和重置大量 stream。
4.  **监控：** 监控目标服务器资源使用情况，确认攻击是否成功。

**缓解措施：**
针对此漏洞，常见的缓解措施包括：

*   **限制 stream 数量：**  限制单个 HTTP/2 连接允许的最大 stream 数量。
*   **限制 stream 创建速率：** 限制 stream 的创建速率，防止快速创建大量 stream。
*   **设置连接超时：** 设置连接超时时间，防止恶意连接长时间占用资源。
*   **升级：** 更新服务器软件到已修复此漏洞的版本。

**项目地址:** [pabloec20/rapidreset](https://github.com/pabloec20/rapidreset)

**漏洞详情:** [CVE-2023-44487](https://nvd.nist.gov/vuln/detail/CVE-2023-44487)