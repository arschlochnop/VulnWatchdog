## CVE-2025-22224-VMware-TOCTOU竞态条件

**漏洞编号:** CVE-2025-22224

**漏洞类型:** TOCTOU竞态条件导致的权限提升

**影响应用:** VMware ESXi, VMware Workstation

**危害等级:** 严重，可能导致从虚拟机逃逸并在主机上执行代码

**影响版本:** ESXi 8.0 (小于ESXi80U3d-24585383和ESXi80U2d-24585300), ESXi 7.0 (小于ESXi70U3s-24585291), Workstation 17.x (小于17.6.3), Cloud Foundation 5.x, 4.5.x, Telco Cloud Platform 5.x, 4.x, 3.x, 2.x, Telco Cloud Infrastructure 3.x, 2.x

**利用条件:** 需要虚拟机内的本地管理权限

**POC 可用性:** 是

**投毒风险:** 80%

## 详情

CVE-2025-22224 是 VMware ESXi 和 Workstation 中的一个 TOCTOU（Time-of-Check Time-of-Use）竞态条件漏洞，会导致越界写入。攻击者利用该漏洞可以在主机上以虚拟机的 VMX 进程身份执行代码。从漏洞描述和搜索引擎结果来看，此漏洞影响广泛且危害严重，存在可用的 PoC 利用代码。

**有效性：**

提供的 PoC 代码描述了利用 VMX 进程中的 TOCTOU 漏洞，该漏洞发生在资源操作期间（例如，内存映射 I/O），由于在检查和实际使用之间未能重新验证访问控制，因此攻击者可以在验证后更改文件描述符或内存区域。PoC 通过两个线程同步利用此漏洞：一个线程重复触发虚拟机内的易受攻击的系统调用，另一个线程并发地竞相在检查之后、使用之前交换内存区域或文件描述符。这种竞争条件会导致主机 VMX 进程中损坏的指针解引用，从而允许攻击者覆盖敏感结构并提升权限。
根据漏洞信息和搜索结果，此漏洞的 PoC 是可用的，并且该 PoC 描述的利用方式与漏洞描述一致，因此该 PoC 代码的有效性较高。

**投毒风险：**

由于PoC代码提供的是一个链接，指向下载位置，因此存在较高的投毒风险。攻击者可能在PoC代码中植入恶意代码，例如反向 shell 或其他后门，从而在成功利用漏洞后进一步控制受害系统。即使提供的链接指向一个看似可信的存储库，该存储库也有可能被恶意用户控制，从而分发被篡改的 PoC 代码。
根据经验，通过链接下载的PoC代码存在更高的风险，因此投毒风险评定为 80%。

**利用方式：**

1.  攻击者需要在受影响的 VMware 环境中获得一个虚拟机的本地管理权限。
2.  攻击者需要在虚拟机内运行 PoC 代码，该代码会触发 VMX 进程中的 TOCTOU 漏洞。
3.  PoC 代码会利用竞态条件，在 VMX 进程执行检查后、使用资源前更改资源（例如，内存区域或文件描述符）。
4.  成功的利用会导致 VMX 进程中的越界写入，允许攻击者覆盖敏感数据结构。
5.  通过覆盖这些数据结构，攻击者可以提升权限，并在主机上以 VMX 进程的身份执行任意代码，从而实现虚拟机逃逸。

**项目地址:** [lacelruz/CVE-2025-22224](https://github.com/lacelruz/CVE-2025-22224)

**漏洞详情:** [CVE-2025-22224](https://nvd.nist.gov/vuln/detail/CVE-2025-22224)