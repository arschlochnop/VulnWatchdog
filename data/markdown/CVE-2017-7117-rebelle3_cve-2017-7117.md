## CVE-2017-7117-WebKit-类型混淆和UAF

**漏洞编号:** CVE-2017-7117

**漏洞类型:** 类型混淆和UAF(Use-After-Free)

**影响应用:** WebKit (Safari, iOS, iCloud for Windows, iTunes for Windows, tvOS)

**危害等级:** 高危，可能导致任意代码执行或拒绝服务

**影响版本:** iOS < 11, Safari < 11, iCloud < 7.0 (Windows), iTunes < 12.7 (Windows), tvOS < 11

**利用条件:** 用户访问恶意网页

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2017-7117 是一个存在于WebKit中的类型混淆和UAF漏洞。该漏洞的利用方式是首先通过类型混淆让JIT编译器错误地将一个Array对象识别为String对象。然后，利用这个类型混淆，在Array对象被释放后，仍然可以通过之前“错误识别”的String类型的变量访问该内存区域，从而实现UAF。攻击者可以利用UAF漏洞读取任意内存数据，甚至可以构造恶意的内存数据，最终实现任意代码执行。提供的POC代码首先触发类型混淆漏洞，然后使用内存喷射技术在释放的内存区域填充特定的数据，最终通过遍历array 查找特殊的值，从而找到目标对象，并泄露其内存地址。 

**有效性：** 根据提供的漏洞信息、搜索引擎结果以及漏洞利用代码（POC），该漏洞是真实存在的，且POC代码能够在特定版本的WebKit上触发该漏洞，证明了其有效性。

**投毒风险：** 提供的代码主要是演示漏洞利用过程，用于学习和研究目的。虽然仓库声明"Do NOT use this for nefarious purposes",仓库中并没有明显的恶意代码或者后门，但存在以下风险：
1.  **误用风险：** 不具备相关知识的人员可能不理解代码，错误使用可能导致系统崩溃或其他问题。
2.  **二次利用风险：** 其他攻击者可能会基于此POC修改和扩展，用于恶意攻击。
3.  **依赖风险:**  代码可能依赖特定的环境或库，如果环境不满足，可能会出现问题。

因此，投毒风险较低，但存在一定的安全风险，估计为10%。

**利用方式：**
1.  **类型混淆：** 利用JavaScript的特性，通过循环和赋值，欺骗JIT编译器，使其将Array对象错误地识别为String对象。
2.  **UAF：** 触发JIT编译器的bug，在Array对象被释放后，依然可以通过之前类型混淆的String类型的变量访问该内存区域。
3.  **内存喷射：** 通过创建大量的对象，在内存中填充特定的数据（locator），以便后续查找。
4.  **地址泄露：** 在释放的内存区域中查找locator，然后通过相对偏移计算出目标对象的内存地址。

总而言之，此漏洞利用需要对JavaScriptCore的内部机制以及内存管理有深入的理解。


**项目地址:** [rebelle3/cve-2017-7117](https://github.com/rebelle3/cve-2017-7117)

**漏洞详情:** [CVE-2017-7117](https://nvd.nist.gov/vuln/detail/CVE-2017-7117)