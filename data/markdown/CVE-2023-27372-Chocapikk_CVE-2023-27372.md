## CVE-2023-27372 SPIP Remote Code Execution

**漏洞编号:** CVE-2023-27372

**漏洞类型:** Remote Code Execution (RCE)

**影响应用:** SPIP

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** < 4.2.1

**利用条件:** 需要目标SPIP站点存在，且能访问其spip.php?page=spip_pass页面

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2023-27372是SPIP CMS 4.2.1之前版本中的一个远程代码执行漏洞。该漏洞源于程序在处理表单值时，反序列化过程存在缺陷。未经身份验证的攻击者可以通过向易受攻击的SPIP实例上的spip.php?page=spip_pass页面提交特制的表单值，从而利用此漏洞执行任意代码。

**漏洞利用方式：**

1.  **获取Anti-CSRF Token：** PoC脚本首先访问`spip.php?page=spip_pass`页面，解析HTML，提取名为`formulaire_action_args`的input标签中的`value`属性，该值用作Anti-CSRF token。
2.  **构造恶意Payload：**  PoC脚本使用PHP序列化的方式构造恶意代码，通过`oubli`参数传递给`spip.php?page=spip_pass`。
3.  **发送POST请求：**  将包含Anti-CSRF token和恶意payload的POST请求发送到`spip.php?page=spip_pass`，触发反序列化漏洞，从而执行任意代码。
4.  **解析输出：**PoC脚本使用正则表达式提取命令执行结果，如果执行`whoami`成功则认为漏洞存在。

**有效性：**

根据漏洞库信息、搜索结果，以及提供的PoC代码，可以确定该漏洞是真实存在的，并且该PoC代码看起来可以有效利用该漏洞实现远程代码执行。

**投毒风险：**

检查PoC代码发现，该脚本的功能主要是利用CVE-2023-27372漏洞进行RCE验证。通过以下几个方面评估投毒风险：

*   **LeakIX API Key配置:** 脚本中`LEAKIX_API_KEY` 变量需要用户自己配置LeakIX API Key，如果用户不配置则无法从LeakIX获取SPIP URLs。
*   **Payload执行命令:** Payload中执行的命令是`whoami`，这是一个相对安全的命令，用于判断是否成功执行代码。但也存在执行其他命令的潜在风险。
*   **代码逻辑：** 代码逻辑相对清晰，主要是发送请求、解析响应和执行命令。但作者可以加入一些恶意代码来增加风险。
*   **第三方库：** 使用了`requests`、`bs4`、`rich`等第三方库，这些库本身可能存在安全漏洞。

综合考虑，该PoC代码存在少量投毒风险，可能被利用执行未经授权的命令、搜集或窃取用户信息。 风险评估为1%。

**项目地址:** [Chocapikk/CVE-2023-27372](https://github.com/Chocapikk/CVE-2023-27372)

**漏洞详情:** [CVE-2023-27372](https://nvd.nist.gov/vuln/detail/CVE-2023-27372)