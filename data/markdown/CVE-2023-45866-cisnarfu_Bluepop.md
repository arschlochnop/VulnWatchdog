## CVE-2023-45866-BlueZ-蓝牙HID注入

**漏洞编号:** CVE-2023-45866

**漏洞类型:** 蓝牙HID注入

**影响应用:** BlueZ

**危害等级:** 高危，允许未经身份验证的设备注入HID消息，可能导致远程代码执行

**影响版本:** <= 5.64

**利用条件:** 目标设备必须运行受影响的BlueZ版本，攻击者必须在蓝牙范围内

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-45866是BlueZ中的一个漏洞，它允许未经身份验证的外围角色HID设备发起和建立加密连接，并接受HID键盘报告。这使得攻击者可以注入HID消息，而无需中央角色进行用户交互来授权访问。提供的POC代码（Bluepop）尝试利用此漏洞通过模拟蓝牙键盘向目标系统发送预定义的按键序列（duckyscript）。

**有效性：**

根据漏洞描述和搜索引擎结果，该漏洞是存在的，并且存在可用的POC。提供的POC代码尝试自动化利用过程。

**投毒风险：**

分析POC代码后，虽然大部分代码看起来是合法的漏洞利用代码，存在以下可能的投毒风险：

1.  **依赖包:** `requirements.txt` 文件中包含了`pyobjc` 依赖，这个依赖通常用于 MacOS 开发。如果目标不是 MacOS，安装该依赖可能是可疑行为。虽然不一定是恶意，但增加了潜在的风险。
2.  **Payloads 目录:** 该工具依赖于从 `payloads` 目录读取 duckyscript，如果这个目录包含精心构造的恶意脚本，可能造成远超预期的危害。
3. **后门风险**: 代码中存在`subprocess.run(command, shell=True)`，这种写法存在命令注入的风险，如果可以控制`command`变量的内容，则可以执行任意命令. 基于以上分析，该仓库中存在作者隐藏的投毒代码的可能性约为10%。这个估计主要基于依赖包的潜在不确定性和使用 `subprocess.run` 函数带来的命令注入风险。

**利用方式：**

1.  攻击者使用Bluepop工具扫描附近的蓝牙设备。
2.  选择一个目标设备。
3.  工具模拟一个蓝牙键盘。
4.  利用漏洞，未经授权与目标设备建立连接。
5.  工具将预先编写的duckyscript（包含按键序列）注入到目标系统，从而执行恶意操作，例如打开终端、执行命令或安装恶意软件。
6.  工具移除配对信息。

**优先级：**

搜索引擎结果和漏洞库信息都确认了漏洞的存在和影响。POC代码提供了一种利用该漏洞的方法。因此，利用方式的分析优先级为：搜索引擎结果 > 漏洞利用代码 > 漏洞库信息。

**项目地址:** [cisnarfu/Bluepop](https://github.com/cisnarfu/Bluepop)

**漏洞详情:** [CVE-2023-45866](https://nvd.nist.gov/vuln/detail/CVE-2023-45866)