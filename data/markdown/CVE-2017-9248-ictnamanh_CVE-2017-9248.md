## CVE-2017-9248 - Telerik UI for ASP.NET AJAX Cryptographic Weakness

**漏洞编号:** CVE-2017-9248

**漏洞类型:** 加密缺陷

**影响应用:** Telerik UI for ASP.NET AJAX

**危害等级:** 高危，可能导致MachineKey泄露、任意文件上传/下载、XSS或ASP.NET ViewState compromise以及远程代码执行

**影响版本:** R2 2017 SP1 之前版本，Sitefinity 10.0.6412.0 之前版本

**利用条件:** 目标系统使用存在漏洞的Telerik UI for ASP.NET AJAX，且允许通过HTTP(S)访问`Telerik.Web.UI.DialogHandler.aspx`。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2017-9248 漏洞是 Telerik UI for ASP.NET AJAX 中的一个加密缺陷，由于 `Telerik.Web.UI.DialogParametersEncryptionKey` 或 `MachineKey` 未得到适当保护，攻击者可以利用此漏洞绕过加密保护机制。该漏洞可能导致多个严重后果，包括：

*   **MachineKey 泄露：** 攻击者可以获取 MachineKey，这允许他们解密和篡改 ASP.NET 应用程序的数据，例如 ViewState。
*   **任意文件上传/下载：** 攻击者可以使用泄露的密钥来上传恶意文件或下载敏感文件。
*   **跨站脚本攻击 (XSS)：** 攻击者可以注入恶意脚本到受影响的应用程序中。
*   **ASP.NET ViewState compromise：** 攻击者可以篡改 ViewState，从而控制应用程序的行为。
*   **远程代码执行 (RCE)：** 结合其他漏洞，攻击者可能最终实现远程代码执行，完全控制目标系统。

**漏洞利用方式：**

1.  **确定目标系统是否使用存在漏洞的 Telerik UI for ASP.NET AJAX 版本。**
2.  **利用漏洞泄露 MachineKey。**  根据漏洞利用代码和搜索结果，可以利用 `Telerik.Web.UI.DialogHandler.aspx` 的加密缺陷，通过构造特定的请求，根据返回的错误信息爆破 MachineKey。
3.  **利用泄露的 MachineKey 执行攻击。**  一旦获取了 MachineKey，攻击者就可以进行上述的各种攻击，例如，上传webshell，篡改ViewState等。

提供的PoC代码 `exploit.py` 的主要功能是：

*   通过发送带有加密的`dp`参数的HTTP请求到`Telerik.Web.UI.DialogHandler.aspx`，来利用加密缺陷。
*   根据服务器返回的特定的错误消息，来推断MachineKey的字符。
*   使用字典树来优化爆破过程。
*   逐步构建完整的 MachineKey。

**投毒风险评估：**

仔细分析提供的 PoC 代码，没有发现明显的投毒代码。PoC 代码的主要目的是利用漏洞，并没有尝试执行任何恶意操作，比如回连攻击者服务器，或者进行本地文件篡改等行为。但是，需要注意的是，使用 PoC 代码进行漏洞测试或攻击具有潜在风险，可能会对目标系统造成损害。

**搜索引擎结果优先级：**

搜索引擎结果确认了此漏洞的严重性，并提供了关于漏洞利用和修复的各种信息，包括 CISA 的分析报告、NVD 的漏洞描述、Telerik 官方的缓解措施、以及其他安全研究人员的分析。这些信息对于理解漏洞和评估风险非常有用。搜索结果也证实了该漏洞已被积极利用。

**综合评估：**

该漏洞是一个高危漏洞，利用代码有效，且PoC代码本身没有发现投毒风险，但是使用PoC具有潜在的攻击风险。攻击者可以利用此漏洞获取系统控制权，因此需要尽快修复。

**项目地址:** [ictnamanh/CVE-2017-9248](https://github.com/ictnamanh/CVE-2017-9248)

**漏洞详情:** [CVE-2017-9248](https://nvd.nist.gov/vuln/detail/CVE-2017-9248)