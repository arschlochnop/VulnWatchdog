## CVE-2019-11043-PHP-FPM远程代码执行

**漏洞编号:** CVE-2019-11043

**漏洞类型:** 远程代码执行

**影响应用:** PHP-FPM

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** 7.1.x (< 7.1.33), 7.2.x (< 7.2.24), 7.3.x (< 7.3.11)

**利用条件:** Nginx作为前端服务器，配置不当，将请求传递给PHP-FPM

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-11043是一个PHP-FPM的远程代码执行漏洞。该漏洞存在于当Nginx作为前端服务器时，如果配置不当，攻击者可以通过构造特殊的请求，利用PHP-FPM中的缓冲区溢出漏洞，覆盖FCGI协议数据，从而执行任意代码。

**有效性：**

根据漏洞库信息、搜索结果和提供的漏洞利用代码，该漏洞的POC是有效的。漏洞库信息中明确指出该漏洞可以导致远程代码执行，并给出了github链接（https://github.com/neex/phuip-fpizdam）包含利用代码。搜索引擎结果也确认了该漏洞的存在和利用方式，并指出受影响的版本和配置。

提供的POC代码`main.py`通过调用`detect.py`来检测目标是否存在漏洞，并自动计算利用所需的参数。 如果成功检测到漏洞，将允许执行任意命令。

**投毒风险：**

分析POC代码后，投毒风险较低，约为10%。 风险主要来自以下几个方面：

1.  **依赖风险：** 代码依赖`requests`库，如果requests库被篡改，可能引入恶意代码。
2.  **命令执行风险：** 成功利用漏洞后，可以通过`?a=/usr/bin/yourcommand`执行命令，如果执行恶意命令，可能对系统造成危害。**（但这属于漏洞本身利用的范畴，而非代码投毒）**
3.  **临时文件：** 代码会在`/tmp/`目录下创建临时文件（例如`/tmp/a`），尽管代码中尝试清理，但可能存在清理不彻底的情况。

综上，虽然存在一定的风险，但主要集中在使用漏洞利用后的命令执行方面，POC代码本身的投毒风险较低。

**利用方式：**

利用该漏洞的步骤如下：

1.  **环境确认：** 确保目标系统运行着受影响版本的PHP-FPM，并使用Nginx作为前端服务器。
2.  **漏洞检测：** 运行`main.py -u <目标URL>`，POC会自动检测目标是否存在漏洞，并计算利用所需的参数 (QueryStringLength和PisosLength)。
3.  **参数配置：** POC自动修改`session.auto_start`的值，为利用做准备。
4.  **命令执行：**  如果检测成功，可以通过在URL中添加`?a=<命令>`来执行任意命令。例如 `?a=/usr/bin/id`。
5.  **清理：** 利用完毕后,POC会尝试清理临时文件，但建议手动检查/tmp目录，确保没有残留文件。

**项目地址:** [huowen/CVE-2019-11043](https://github.com/huowen/CVE-2019-11043)

**漏洞详情:** [CVE-2019-11043](https://nvd.nist.gov/vuln/detail/CVE-2019-11043)