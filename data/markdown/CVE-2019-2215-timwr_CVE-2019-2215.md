## CVE-2019-2215 Android Binder Use-After-Free

**漏洞编号:** CVE-2019-2215

**漏洞类型:** Use-After-Free

**影响应用:** Android Kernel

**危害等级:** 高危，可导致权限提升至Linux内核级别

**影响版本:** Kernel

**利用条件:** 需要安装恶意本地应用或利用网络应用中的其他漏洞

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2019-2215 是 Android Binder 中存在的 use-after-free 漏洞。攻击者可以通过该漏洞将权限从普通应用程序提升到 Linux 内核级别。根据漏洞库信息，利用该漏洞不需要用户交互，但需要安装恶意本地应用程序或利用网络应用程序中的其他漏洞。

**有效性：**
提供的 POC 代码来源于多个已知的漏洞利用示例，如 Google Project Zero 和 qu1ckr00t 等，表明该漏洞存在并且可以被利用。代码逻辑清晰，利用了 binder 驱动中的 use-after-free 漏洞。因此，POC代码很可能是有效的。

**投毒风险：**
分析 POC 代码内容发现其目的是为了利用 CVE-2019-2215 漏洞。代码中包含构建 Makefile 和 Android.mk 文件，用于编译和构建 Android 可执行文件，以及 C 语言源代码，实现了利用 use-after-free 漏洞来获取内核 R/W 权限。整体代码结构清晰，没有发现明显的恶意或隐藏代码。尽管如此，在复制粘贴代码时存在引入错误的可能性，或者作者可能在不明显的地方进行了细微的修改，导致利用失败或产生其他副作用。因此，虽然概率较低，但仍然存在一定的投毒风险。综合评估，投毒风险为 5%。

**利用方式：**
1.  **漏洞原理：** 该漏洞是 binder.c 文件中的 use-after-free 漏洞，发生在 Binder 驱动程序中。
2.  **利用步骤：**
    *   首先，通过`epoll_ctl` 将binder_fd添加到epfd中，监听事件。
    *   构造一个 iovec 数组，其中 `iovec_array[IOVEC_INDX_FOR_WQ]` 指向 `dummy_page_4g_aligned`，用于在内核中伪造 waitqueue 结构。
    *   使用 pipe 创建管道，并设置管道大小为 0x1000。
    *   fork 创建子进程。子进程中，等待 2 秒后，调用 epoll_ctl 从 epfd 中删除 binder_fd，然后从管道中读取数据。
    *   父进程调用 ioctl(binder_fd, BINDER_THREAD_EXIT, NULL)，触发 binder 线程退出。
    *   父进程调用 writev 将 iovec 数组写入管道，触发 use-after-free 漏洞。
    *   父进程从管道中读取数据，泄漏内核信息。
    *   从泄漏的数据中获取 `current_ptr` (当前 task_struct 的指针)。
3.  **权限提升：** 通过泄漏的内核信息和利用 use-after-free 漏洞，可以实现内核任意地址读写，从而修改进程的权限信息，最终实现权限提升。

**结论：**
CVE-2019-2215 是一个严重的安全漏洞，利用难度相对较低，影响范围广泛。该漏洞已经被广泛利用，包括 APT 组织。及时更新 Android 系统和内核版本是防范该漏洞的有效方法。

**项目地址:** [timwr/CVE-2019-2215](https://github.com/timwr/CVE-2019-2215)

**漏洞详情:** [CVE-2019-2215](https://nvd.nist.gov/vuln/detail/CVE-2019-2215)