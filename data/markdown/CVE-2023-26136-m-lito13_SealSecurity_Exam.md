## CVE-2023-26136-tough-cookie-原型污染

**漏洞编号:** CVE-2023-26136

**漏洞类型:** 原型污染

**影响应用:** tough-cookie

**危害等级:** 中危，可能导致拒绝服务或权限提升

**影响版本:** < 4.1.3

**利用条件:** 需要使用CookieJar且rejectPublicSuffixes=false

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-26136是tough-cookie包在4.1.3版本之前的原型污染漏洞。当使用CookieJar且`rejectPublicSuffixes=false`时，由于对Cookie处理不当，攻击者可以通过构造恶意的Cookie，例如将Cookie的Domain设置为`__proto__`，从而污染JavaScript对象的原型，影响所有继承该原型的对象。

**有效性：**
提供的POC代码展示了如何利用URL查询参数或者直接设置Cookie的Domain为`__proto__`来污染原型。代码中还提供了修复方案，即在初始化对象时使用`Object.create(null)`，创建一个没有原型的空对象，以防止原型污染。

**投毒风险：**
该仓库中可能存在投毒代码。`changes.diff` 文件中虽然包含了修复漏洞的补丁，但是攻击者可能在提交修复补丁的同时，添加一些不易察觉的恶意代码，例如在其他文件中添加后门，或者修改构建脚本引入恶意依赖。评估投毒风险为10%，主要是因为该仓库看起来是一个学习/演示项目，而非实际的发布包，投毒的动机相对较低。需要仔细审查代码变更，特别是构建和依赖管理部分，才能确定是否存在恶意代码。

**利用方式：**
1.  **构造恶意URL：** 攻击者可以构造包含`__proto__`属性的URL，例如`https://vulnerable-website.com/?__proto__[badProperty]=payload`，当URL解析器处理该URL时，会将`badProperty`添加到所有对象的原型链上。
2.  **设置恶意Cookie：**  攻击者可以设置Cookie的Domain为`__proto__`，并设置相应的属性值。当`tough-cookie`处理该Cookie时，会将属性添加到所有对象的原型链上。示例代码如下：

```javascript
cookiejar.setCookie("Slonser=polluted; Domain=__proto__; Path=/notauth", "https://__proto__/admin", { loose: true }, (err, cookie) => {})
```

**影响：**
成功利用此漏洞后，攻击者可以修改全局对象的属性，从而影响整个应用程序的行为。例如，可以修改内置对象的属性，导致程序崩溃或执行恶意代码。在某些情况下，攻击者还可以利用原型污染漏洞实现权限提升。

**项目地址:** [m-lito13/SealSecurity_Exam](https://github.com/m-lito13/SealSecurity_Exam)

**漏洞详情:** [CVE-2023-26136](https://nvd.nist.gov/vuln/detail/CVE-2023-26136)