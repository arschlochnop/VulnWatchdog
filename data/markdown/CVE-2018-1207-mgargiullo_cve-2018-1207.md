## CVE-2018-1207-Dell iDRAC7/iDRAC8 CGI 注入

**漏洞编号:** CVE-2018-1207

**漏洞类型:** CGI 注入

**影响应用:** Dell iDRAC7/iDRAC8

**危害等级:** 高危，可导致远程代码执行

**影响版本:** < 2.52.52.52

**利用条件:** 需要网络可达，目标iDRAC管理界面未打补丁且版本低于2.52.52.52

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2018-1207 漏洞存在于 Dell EMC iDRAC7/iDRAC8 设备中，版本低于 2.52.52.52。这是一个 CGI 注入漏洞，未经身份验证的远程攻击者可以利用 CGI 变量执行远程代码。

**利用方式：**

1.  **漏洞验证：** 通过发送包含 `LD_DEBUG=files` 的 GET 请求到 `/cgi-bin/login` 路径，检查响应中是否包含 `/lib/` 字符串，以确认目标是否易受攻击。
2.  **Payload生成：**  PoC 代码首先生成一个反向 shell 的 C 语言 payload。该 Payload 会连接攻击者指定的 IP 地址和端口，并将 shell 重定向到该连接。 PoC 使用 `sh4-linux-gnu-gcc-11` 交叉编译器将 C 代码编译成一个共享对象 (.so) 文件，此步骤需要目标环境安装对应的交叉编译链。
3.  **Payload上传：**  PoC 将编译好的 payload 通过 POST 请求上传到 `/cgi-bin/putfile` 路径。上传的数据包含一个别名 `RACPKSSHAUTHKEY1`，payload 长度，以及 payload 本身，这些数据经过特定的格式打包。
4.  **触发执行：**  PoC 通过发送 GET 请求到 `/cgi-bin/discover` 路径，并设置 `LD_PRELOAD=/tmp/sshpkauthupload.tmp`，来强制加载上传的 payload。由于 CGI 程序的执行环境会加载 LD_PRELOAD 指定的共享对象，因此可以执行上传的恶意代码，从而建立反向 shell。

**有效性：**

根据漏洞信息和漏洞利用代码，该 POC 代码是有效的，可以利用该漏洞在目标系统上执行任意代码，从而获得系统的控制权。 exploit-db 网站上也有对应的利用代码验证了有效性。

**投毒风险：**

分析漏洞利用代码，没有发现作者隐藏的恶意代码。 该脚本所做的事情就是编译生成反向shell的C代码，并上传到目标机器，并触发执行，没有发现额外的恶意行为， 因此投毒风险为 0%。

**项目地址:** [mgargiullo/cve-2018-1207](https://github.com/mgargiullo/cve-2018-1207)

**漏洞详情:** [CVE-2018-1207](https://nvd.nist.gov/vuln/detail/CVE-2018-1207)