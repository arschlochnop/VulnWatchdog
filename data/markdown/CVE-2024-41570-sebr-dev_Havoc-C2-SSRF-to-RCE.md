## CVE-2024-41570-Havoc C2-SSRF+RCE

**漏洞编号:** CVE-2024-41570

**漏洞类型:** SSRF+RCE

**影响应用:** Havoc C2

**危害等级:** 高危，可能导致服务器信息泄露，远程代码执行，以及发起对内网的攻击

**影响版本:** 0.7

**利用条件:** 需要能够访问Havoc C2的监听端口

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-41570是Havoc C2 0.7版本中存在的一个未经身份验证的服务器端请求伪造(SSRF)漏洞。根据漏洞描述和搜索结果，攻击者可以通过伪造Demon代理注册和checkins，在Teamserver上打开TCP socket，并从中读取/写入数据。这使得攻击者可以从Teamserver发起任意网络流量，例如扫描内网、访问Teamserver内部资源。结合代码来看, 在注册代理时, 大部分参数可控, 从而达到控制后续socket的目的。

**漏洞利用方式：**

1.  **SSRF利用：** 攻击者发送特制的请求到Havoc C2 Teamserver的监听端口，利用未授权的Demon回调处理功能，指定Teamserver向任意目标发起请求。
2.  **RCE利用 (Authenticated):** github上thisisveryfunny/CVE-2024-41570-Havoc-C2-RCE给出了RCE的方案，该方案需要结合SSRF才能触发RCE漏洞, 需要认证。

**有效性评估：**

提供的POC代码根据commit记录和描述，实现了SSRF漏洞的利用，可以模拟Demon代理注册并打开Socket进行通信，从而验证了漏洞的存在和可利用性。

**投毒风险评估：**

POC代码本身看起来是用于验证和利用漏洞的，主要功能是构造恶意请求。但是由于代码中包含大量的网络请求以及加密解密操作，存在以下几点潜在的投毒风险：

*   **恶意依赖：** 虽然代码中只使用了常用的requests和pycryptodome库，但仍然存在被替换为恶意版本的风险，例如通过PyPI投毒。
*   **后门代码：** 作者可以在代码中插入隐蔽的后门，例如在发送请求前执行一段恶意代码，或者在处理响应时植入webshell。 本代码中并未发现明显的后门代码。
*   **资源消耗：** 攻击者可能恶意修改代码，使其在运行过程中消耗大量资源，导致拒绝服务攻击。

总体来说，代码的投毒风险较低，但仍需要保持警惕，建议在使用前仔细审查代码，并从可信的来源获取依赖。


**项目地址:** [sebr-dev/Havoc-C2-SSRF-to-RCE](https://github.com/sebr-dev/Havoc-C2-SSRF-to-RCE)

**漏洞详情:** [CVE-2024-41570](https://nvd.nist.gov/vuln/detail/CVE-2024-41570)