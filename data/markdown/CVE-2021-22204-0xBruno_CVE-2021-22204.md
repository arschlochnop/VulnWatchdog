## CVE-2021-22204 ExifTool DjVu 远程代码执行

**漏洞编号:** CVE-2021-22204

**漏洞类型:** 远程代码执行

**影响应用:** ExifTool

**危害等级:** 高危，可导致服务器被完全控制

**影响版本:** >=7.44, <12.24

**利用条件:** 目标系统安装了存在漏洞版本的ExifTool，且能够处理DjVu文件。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

该漏洞存在于ExifTool的DjVu文件解析模块中。攻击者可以通过构造恶意的DjVu文件，利用ANTa标签中的Perl代码注入，实现远程代码执行。

**有效性:** 提供的POC代码有效，因为它演示了如何创建一个恶意的DjVu文件，该文件包含Perl代码，当ExifTool解析该文件时，会执行这些代码。该POC还创建了一个包含Payload的JPEG文件，用于触发漏洞。

**投毒风险:** 在所提供的代码片段中，没有发现明显的投毒代码。该脚本的主要目的是生成一个包含反向shell的DjVu文件。`exploit.sh` 的作用是自动化生成恶意文件，以及调用 exiftool 触发漏洞，并没有发现任何恶意行为。`README.md` 也只是一个说明文档。

**利用方式:**
1.  **创建恶意DjVu文件:** 首先，脚本创建一个简单的PBM图像文件，并将其转换为DjVu格式。然后，它将恶意的ANTa标签附加到DjVu文件中。ANTa标签包含嵌入的Perl代码，该代码用于建立反向shell连接到攻击者的机器。
2.  **生成包含Payload的JPEG:** 利用Exiftool的config功能，将DjVu Payload 嵌入到JPEG文件头中，当exiftool 解析这个JPEG文件时，会触发漏洞
3.  **触发漏洞:** 攻击者需要将构造好的恶意DjVu文件传递给易受攻击的ExifTool版本。当ExifTool解析DjVu文件时，嵌入的Perl代码将被执行，从而在目标系统上建立一个反向shell。

**总结:** 该漏洞利用涉及构造恶意的DjVu文件，利用ExifTool的漏洞执行任意代码。该漏洞的CVSS评分为中等，但由于可以实现远程代码执行，因此风险非常高。该POC的有效性很高，因为已经存在公开可用的利用代码。

**项目地址:** [0xBruno/CVE-2021-22204](https://github.com/0xBruno/CVE-2021-22204)

**漏洞详情:** [CVE-2021-22204](https://nvd.nist.gov/vuln/detail/CVE-2021-22204)