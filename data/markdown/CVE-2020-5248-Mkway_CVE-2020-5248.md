## CVE-2020-5248 - GLPI 默认加密密钥漏洞

**漏洞编号:** CVE-2020-5248

**漏洞类型:** 硬编码密钥

**影响应用:** GLPI

**危害等级:** 高危，可能导致敏感数据泄露

**影响版本:** < 9.4.6

**利用条件:** 需要访问 GLPI 数据库或应用程序，获取加密数据

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2020-5248 漏洞源于 GLPI 9.4.6 之前版本使用了一个公开的默认加密密钥 `GLPIKEY`。攻击者可以利用此密钥解密数据库中所有使用该密钥加密的敏感数据，如密码等。

**有效性：**

提供的 POC 代码旨在演示如何利用该漏洞。`docker-compose.yml` 文件配置了一个包含易受攻击 GLPI 版本的 Docker 环境。`decrypt_any.php` 文件包含了解密函数，该函数使用硬编码的 `GLPIKEY` 解密提供的加密字符串。通过访问 `http://localhost:8080/poc/decrypt_any.php` 可以执行解密操作。

**投毒风险：**

检查提供的代码，主要关注是否存在恶意代码或后门。`docker-compose.yml` 部署了一个已知存在漏洞的 GLPI 版本，这本身不是恶意行为，而是为了复现漏洞。各个Dockerfile文件，只是镜像构建配置，并未发现任何恶意的代码。`decrypt_any.php` 文件只包含了解密功能，用于验证漏洞，但可能存在代码注入的风险。总体来说，投毒风险较低，但是不能完全排除，故设为1%。

**利用方式：**

1.  **环境搭建：** 使用提供的 Dockerfile 和 docker-compose.yml 构建包含易受攻击 GLPI 版本的环境。
2.  **数据获取：**  攻击者首先需要访问 GLPI 数据库或应用程序，获取使用默认 `GLPIKEY` 加密的敏感数据。这可能涉及SQL注入或其他漏洞的配合利用。
3.  **数据解密：**  使用 `decrypt_any.php` 脚本或类似的工具，利用硬编码的 `GLPIKEY` 解密获取的加密数据。
4.  **权限提升：**  解密后的数据可用于进一步的攻击，例如，利用解密后的管理员密码登录系统，提升权限。

**缓解措施：**

*   升级到 GLPI 9.4.6 或更高版本。
*   如果无法升级，应立即更改默认的 `GLPIKEY`，并重新加密所有敏感数据。但官方文档也提到，很难知道哪些数据使用了这个密钥加密，特别是插件产生的数据。


**项目地址:** [Mkway/CVE-2020-5248](https://github.com/Mkway/CVE-2020-5248)

**漏洞详情:** [CVE-2020-5248](https://nvd.nist.gov/vuln/detail/CVE-2020-5248)