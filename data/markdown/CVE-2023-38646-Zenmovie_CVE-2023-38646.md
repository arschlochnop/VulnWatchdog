## CVE-2023-38646-Metabase-RCE

**漏洞编号:** CVE-2023-38646

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Metabase

**危害等级:** 高危，未经身份验证的远程代码执行

**影响版本:** 0.46.6.1之前版本，1.46.6.1之前Enterprise版本，以及其他受影响的固定版本之前的版本

**利用条件:** 目标 Metabase 实例可从攻击者控制的网络访问，无需身份验证

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-38646 漏洞是 Metabase 中一个未经身份验证的远程代码执行漏洞。 根据漏洞库信息、搜索引擎结果和提供的漏洞利用代码，此漏洞利用的有效性很高。

**有效性:**

*   漏洞库信息明确指出该漏洞允许未经身份验证的攻击者在服务器上执行任意命令。
*   搜索引擎结果确认了该漏洞的严重性，并提供了多个关于该漏洞的描述、影响和技术细节的网页链接，包括PoC代码的GitHub链接。
*   提供的PoC代码 (`CVE-2023-38646.py`) 看起来是一个完整的漏洞利用脚本，它利用了 Metabase 的 `setup-token` 和 H2 数据库的特性来执行任意代码。

**利用方式:**

1.  **获取 Setup Token 和 Metabase 版本:** PoC 首先向 `/api/session/properties` 发送 GET 请求，检索 `setup-token` 和 Metabase 版本。
2.  **构造 Payload:**  构建反弹 shell 的 payload, 并对其进行 Base64 编码。
3.  **构造Exploit数据:** PoC 构建一个包含恶意 H2 数据库连接字符串的 JSON 数据。该字符串包含一个利用 `CREATE TRIGGER` 的 payload，该触发器在 `INFORMATION_SCHEMA.TABLES` 上执行 `SELECT` 操作之前执行任意命令。`token` 字段拼接了 setup token 和 base64 编码后的 payload。
4.  **发送恶意请求:** PoC 向 `/api/setup/validate` 发送带有构造的 JSON 数据的 POST 请求。这个请求会触发 H2 数据库连接和触发器，从而执行任意代码。

**投毒风险:**

PoC代码本身的反弹shell连接地址是可以配置的, 如果作者想投毒,可以将IP地址写死,或者加入其他恶意操作.
*   漏洞利用代码主要功能是利用漏洞，实现远程代码执行，其目的是明确的。
*   `README.md` 文件只包含 PoC 的基本信息。

因此，该仓库中存在作者隐藏的投毒代码的风险较低, 大概在10%左右。投毒的主要风险在于恶意修改payload，例如反弹shell地址或者插入其他的恶意操作。

**项目地址:** [Zenmovie/CVE-2023-38646](https://github.com/Zenmovie/CVE-2023-38646)

**漏洞详情:** [CVE-2023-38646](https://nvd.nist.gov/vuln/detail/CVE-2023-38646)