## CVE-2024-2961-glibc-iconv缓冲区溢出

**漏洞编号:** CVE-2024-2961

**漏洞类型:** 缓冲区溢出

**影响应用:** glibc

**危害等级:** 高危，可能导致拒绝服务或远程代码执行

**影响版本:** < 2.40

**利用条件:** 需要目标系统使用存在漏洞的glibc版本，并且存在可利用的iconv()函数调用。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-2961是glibc库iconv()函数中的一个缓冲区溢出漏洞。该漏洞影响glibc 2.39及更早版本。当使用`iconv()`函数将字符串转换为ISO-2022-CN-EXT字符集时，可能导致输出缓冲区溢出最多4个字节。

**有效性评估：**

根据漏洞信息和搜索引擎结果，此漏洞存在已知的PoC。PoC代码利用了PHP的`php://filter`流包装器以及一系列的`convert.iconv.*`过滤器链，通过精心构造的输入，触发glibc的iconv函数进行字符集转换，最终造成缓冲区溢出。利用方式较为复杂，依赖于PHP环境和特定的配置。

根据搜索引擎的结果发现，存在远程代码执行的可能性，结合给出的EXP代码来看，EXP中的利用是通过构造特定的`convert.iconv`链条最终溢出达到读取文件内容或者写入的目的。

**投毒风险评估：**

提供的PoC代码主要通过HTTP请求发送payload，并下载`/proc/self/maps`和libc文件。虽然PoC中包含了一些base64编码和解码操作，以及`convert.iconv` 链条，但整体逻辑看起来是为了利用漏洞，没有明显的恶意代码，但仍然存在很小的风险。

风险点在于：

1.  **依赖外部资源：** PoC可能需要下载远程文件（libc），攻击者可以替换这些文件为恶意文件。
2.  **命令执行：** PoC允许指定要执行的命令，如果目标系统配置不当，可能导致恶意命令执行。
3.  **未知的依赖项风险：** PoC可能依赖于未知的或未公开的第三方库，这些库可能存在安全漏洞，或者被攻击者篡改。

综合评估，PoC代码存在一定的投毒风险，但概率较低(5%)，需要仔细审计代码，并确保使用的外部资源是可信的。

**利用方式：**

1.  **目标识别：** 确定目标系统使用的glibc版本低于2.40，并且存在iconv()函数调用。
2.  **构造Payload：**  使用`php://filter`流包装器和一系列的`convert.iconv.*`过滤器链构造恶意的payload，触发缓冲区溢出。
3.  **信息泄露/代码执行：** 利用溢出覆盖相邻的变量或函数指针，从而实现信息泄露或远程代码执行。

**项目地址:** [regantemudo/PHP-file-read-to-RCE-CVE-2024-2961-](https://github.com/regantemudo/PHP-file-read-to-RCE-CVE-2024-2961-)

**漏洞详情:** [CVE-2024-2961](https://nvd.nist.gov/vuln/detail/CVE-2024-2961)