## CVE-2024-9474 PAN-OS Web管理界面权限提升漏洞

**漏洞编号:** CVE-2024-9474

**漏洞类型:** 权限提升

**影响应用:** PAN-OS

**危害等级:** 高危，允许具有Web管理界面访问权限的PAN-OS管理员以root权限执行操作

**影响版本:** 10.1.0 to 10.1.14-h5, 10.2.0 to 10.2.12-h1, 11.0.0 to 11.0.6-h0, 11.1.0 to 11.1.5-h0, 11.2.0 to 11.2.4-h0

**利用条件:** 需要PAN-OS管理员访问Web管理界面

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-9474是一个Palo Alto Networks PAN-OS软件中的权限提升漏洞。该漏洞允许具有Web管理界面访问权限的PAN-OS管理员以root权限在防火墙上执行操作。根据漏洞描述，该漏洞是由于PAN-OS软件未能正确验证管理员的权限，从而允许攻击者利用该漏洞获取root权限。\n\n**有效性评估：**\n\n根据提供的漏洞信息、搜索结果和漏洞利用代码，该漏洞的POC代码是有效的。搜索结果表明，该漏洞已被积极利用，并且存在公开可用的利用代码。提供的POC代码（cve.py）利用了未经身份验证的访问漏洞，结合命令注入，可以执行任意命令。\n\n**投毒风险评估：**\n\n审查提供的POC代码，发现以下几点：\n\n*   **依赖性：** 该脚本依赖于Python3标准库以及`requests`库。标准库通常是安全的，`requests`库是一个常用的HTTP客户端库，被广泛使用。\n*   **代码逻辑：** 代码的总体逻辑是合理的，用于发送HTTP请求，利用漏洞。\n*   **输出：** 脚本会将结果输出到文件 (`output.txt`)，但这种行为本身不是恶意。\n*   **Webshell/后门：**  脚本本身并没有明显植入webshell或者持久性后门的行为。它通过命令注入执行命令并将结果写到`/var/appweb/htdocs/unauth/{output_name}`， 攻击者可以通过访问该URL获取命令执行结果。这是一个漏洞验证的手段，不应该被认为是投毒。\n\n虽然整体代码看起来没有明显的投毒行为，但依然存在一定风险：\n\n*   **恶意URL：**  攻击者可以修改脚本，将目标URL替换为恶意的URL，诱导用户执行。\n*   **依赖库风险：** `requests` 库本身若存在漏洞，或者被恶意篡改，也会间接影响此脚本的安全性。\n*   **命令注入风险：** 攻击者可能滥用命令注入，在目标系统执行恶意操作。\n\n综合评估，投毒风险较低，约为5%。主要风险在于使用者滥用漏洞本身，以及对第三方库的潜在安全风险。\n\n**利用方式：**\n\n1.  **确定目标：** 攻击者需要确定运行受影响PAN-OS版本的Palo Alto Networks防火墙，并且其Web管理界面可以从攻击者的位置访问。尤其需要关注暴露在公网上的管理界面。\n2.  **身份验证绕过：**  利用`/php/ztp_gate.php/.js.map` 路径绕过身份验证检查。\n3.  **命令注入：**  通过构造包含恶意命令的`payload`参数，利用`/php/utils/createRemoteAppwebSession.php/peppa.js.map` 接口进行命令注入。\n4.  **执行命令：** 注入的命令以root权限执行。命令执行的结果被重定向到Web服务器的可访问目录`/var/appweb/htdocs/unauth/`。\n5.  **获取结果：** 攻击者可以通过访问特定的URL（例如，`{url}/unauth/{output_name}`）来检索命令执行的结果。\n6.  **交互式Shell：** 该POC允许通过输入命令与目标系统进行交互， 形成一个简单的交互式shell。


**项目地址:** [deathvu/CVE-2024-9474](https://github.com/deathvu/CVE-2024-9474)

**漏洞详情:** [CVE-2024-9474](https://nvd.nist.gov/vuln/detail/CVE-2024-9474)