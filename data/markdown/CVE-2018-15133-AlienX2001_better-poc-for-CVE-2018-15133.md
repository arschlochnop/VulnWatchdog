## CVE-2018-15133 Laravel Framework 反序列化远程代码执行

**漏洞编号:** CVE-2018-15133

**漏洞类型:** 反序列化漏洞导致远程代码执行

**影响应用:** Laravel Framework

**危害等级:** 高危，可能导致远程代码执行，完全控制服务器

**影响版本:** <= 5.5.40, 5.6.x <= 5.6.29

**利用条件:** 需要知道APP_KEY，可以通过其他漏洞获取或之前已获得特权访问

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2018-15133 存在于 Laravel Framework 5.5.40 及之前版本，以及 5.6.x 系列的 5.6.29 及之前版本中。攻击者可以通过在 X-XSRF-TOKEN 中发送恶意序列化数据，利用 `unserialize` 函数执行任意代码。利用链涉及 `Illuminate/Encryption/Encrypter.php` 的 decrypt 方法以及 phpggc 中的 `PendingBroadcast` gadget chain。攻击的先决条件是攻击者需要知道 Laravel 应用的 `APP_KEY`，这通常很难，但可以通过信息泄露漏洞或其他攻击获得。提供的 PoC 代码包含一个 bash 脚本 `betterpoc.sh` 用于自动化利用，以及一个 PHP 脚本 `cve-2018-15133.php` 用于生成恶意 X-XSRF-TOKEN。`betterpoc.sh` 脚本通过调用 `phpggc` 生成反序列化 payload，然后使用 `cve-2018-15133.php` 脚本利用 APP_KEY 加密 payload，最终通过 curl 发送包含恶意 token 的 POST 请求。投毒风险分析：尽管 PoC 代码主要用于漏洞验证，自动化脚本存在轻微风险，例如通过修改命令注入后门，该风险较低，约10%，因需要使用者进行配置，且代码清晰可见。利用方式总结：1. 获取目标 Laravel 应用的 APP_KEY。2. 使用 phpggc 生成执行任意命令的反序列化 payload。3. 使用 cve-2018-15133.php 脚本，利用 APP_KEY 加密 payload 生成 X-XSRF-TOKEN。4. 发送包含恶意 X-XSRF-TOKEN 的 POST 请求到目标服务器。

**项目地址:** [AlienX2001/better-poc-for-CVE-2018-15133](https://github.com/AlienX2001/better-poc-for-CVE-2018-15133)

**漏洞详情:** [CVE-2018-15133](https://nvd.nist.gov/vuln/detail/CVE-2018-15133)