## CVE-2019-5420 - Rails 开发模式远程代码执行

**漏洞编号:** CVE-2019-5420

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Rails

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** < 5.2.2.1, < 6.0.0.beta3

**利用条件:** Rails 应用运行于开发模式, 且攻击者能够猜测或获取到 development 模式下的 secret_key_base.

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2019-5420 是一个 Rails 框架的远程代码执行漏洞，存在于开发模式下。攻击者可以通过猜测自动生成的 development 模式 secret token，然后结合其他 Rails 内部机制来执行任意代码。

**有效性：**

提供的 Dockerfile 和 Gemfile 看起来是有效的 POC 代码。Dockerfile 配置了一个包含 Rails 5.2.2 的 Ruby 环境，这是受漏洞影响的版本之一。它创建了一个新的 Rails 应用 `verifier_rce` 并设置了必要的依赖。该 POC 旨在模拟一个易受攻击的 Rails 开发环境，从而允许攻击者利用该漏洞。

**投毒风险：**

分析 POC 代码，发现投毒风险较低，约 5%。虽然代码本身旨在重现漏洞环境，但存在以下几点潜在的投毒可能：

*   **依赖风险：** Gemfile 中引入的 gems 可能会包含未知的安全问题或后门。尽管这些 gem 是 Rails 5.2.2 所需的，但我们仍需警惕供应链攻击。
*   **未明确删除测试代码/文件：** POC 代码可能包含一些用于验证漏洞的代码或文件，如果没有明确删除，可能会被误用。

总体来说，此 POC 的目的在于复现漏洞，而非恶意攻击。因此，其投毒风险较低。但仍然建议使用者仔细审查代码，确保没有隐藏的恶意行为。

**利用方式：**

1.  **目标识别：** 确定目标 Rails 应用是否运行在开发模式下。通常可以通过查看响应头或错误信息来判断。
2.  **secret_key_base 猜测/获取：** 尝试猜测或通过其他方式获取 development 模式下的 `secret_key_base`。由于开发模式下，`secret_key_base` 的生成通常不具备足够的随机性，因此存在被猜测的可能性。
3.  **构造恶意请求：** 利用获取到的 `secret_key_base`，构造包含恶意代码的请求。具体的构造方式会根据 Rails 内部机制有所不同，可能涉及到 session manipulation 或其他攻击向量。
4.  **执行任意代码：** 将恶意请求发送到目标服务器，导致服务器执行任意代码，从而获得服务器的控制权。

总的来说，漏洞利用的关键在于获取到 `secret_key_base`。成功获取后，攻击者就可以利用 Rails 内部机制来执行任意代码。

**项目地址:** [cved-sources/cve-2019-5420](https://github.com/cved-sources/cve-2019-5420)

**漏洞详情:** [CVE-2019-5420](https://nvd.nist.gov/vuln/detail/CVE-2019-5420)