## CVE-2020-0688 Microsoft Exchange Server 远程代码执行漏洞

**漏洞编号:** CVE-2020-0688

**漏洞类型:** 远程代码执行

**影响应用:** Microsoft Exchange Server

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** Microsoft Exchange Server 2013 Cumulative Update 23, 2019 Cumulative Update 3/4, 2016 Cumulative Update 14/15, 2010 Service Pack 3 Update Rollup 30

**利用条件:** 需要有效的域用户凭据以及能够访问Exchange服务器的ECP接口。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-0688 是一个 Microsoft Exchange Server 中的远程代码执行漏洞，存在于 Exchange Control Panel (ECP) 组件中。该漏洞的根源在于 Exchange 在反序列化 ViewState 数据时使用了硬编码的 validationKey 和 validationAlgorithm。攻击者可以通过构造恶意的 ViewState 数据，利用 Ysoserial.net 等工具生成 payload，然后通过 ECP 接口发送，从而在 Exchange 服务器上执行任意代码。PoC 代码 `CVE-2020-0688.py` 通过模拟登录 OWA 获取 `__VIEWSTATEGENERATOR` 和 `ASP.NET_SessionId`，然后利用 `ysoserial.exe` 生成 payload 并将其注入到 ECP 请求的 `__VIEWSTATE` 参数中，最后发送请求触发漏洞。

**漏洞利用方式：**
1.  获取目标 Exchange 服务器的有效域用户凭据。
2.  使用该凭据登录 OWA，获取 `__VIEWSTATEGENERATOR` 和 `ASP.NET_SessionId`。
3.  使用 `ysoserial.exe` 工具，指定 `__VIEWSTATEGENERATOR` 和硬编码的 `validationKey` 及 `validationAlgorithm`，生成恶意 ViewState payload。
4.  构造包含恶意 ViewState payload 的 ECP 请求，发送到目标 Exchange 服务器。
5.  如果漏洞利用成功，服务器会执行 payload 中的恶意代码。

**投毒风险分析：**
PoC 代码 `CVE-2020-0688.py` 本身的功能是利用漏洞，但存在一定的投毒风险：

*   **ysoserial.exe 的来源：** PoC 代码依赖于外部工具 `ysoserial.exe`，如果该工具被替换为恶意版本，则可能导致攻击者执行的不是预期的命令，而是攻击者植入的恶意代码。
*   **command 参数：** PoC 代码允许攻击者通过 `-c` 参数指定要执行的命令，攻击者可能会无意中或恶意地执行有害的命令。
*   **FSharp.Core.xml:** 虽然文件内容看起来是XML，但是里面并没有显示实际的代码功能，所以推断可能是投毒的代码，但是无法验证。 

**项目地址:** [youncyb/CVE-2020-0688](https://github.com/youncyb/CVE-2020-0688)

**漏洞详情:** [CVE-2020-0688](https://nvd.nist.gov/vuln/detail/CVE-2020-0688)