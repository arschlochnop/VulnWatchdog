## CVE-2022-22965 Spring4Shell RCE

**漏洞编号:** CVE-2022-22965

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Spring Framework

**危害等级:** 高危，允许未经身份验证的远程代码执行

**影响版本:** Spring Framework versions 5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+ and all old and unsupported versions，JDK 9+，Tomcat 作为 WAR 部署

**利用条件:** Spring MVC 或 Spring WebFlux 应用程序，运行在 JDK 9+ 上，部署为 WAR 包在 Tomcat 上。需要网络可达。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22965，又名 Spring4Shell，是一个Spring框架中的远程代码执行漏洞。该漏洞允许未经身份验证的攻击者通过数据绑定利用不当的输入验证，在目标系统上执行任意代码。漏洞利用依赖于以下条件：

*   **受影响的Spring版本：** Spring Framework versions 5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+ and all old and unsupported versions
*   **JDK 版本：** JDK 9 及以上
*   **部署方式：** 应用必须部署为 WAR 包在 Tomcat 上运行，而不是 Spring Boot 可执行 JAR。
*   **利用方式：**  攻击者通过构造恶意的HTTP请求，利用Spring的数据绑定功能修改`class.module.classLoader.resources.context.parent.pipeline.first`等属性，从而写入恶意JSP Webshell到Tomcat服务器，进而执行任意命令。

**漏洞利用代码分析：**

提供的漏洞利用代码是一个基于 JavaFx 开发的图形化工具 (Rexbb.jar)。它简化了漏洞利用过程，主要功能包括：

1.  **发送 Payload：**  自动构造和发送包含恶意参数的 HTTP 请求，利用 Spring 的数据绑定漏洞。
2.  **RCE 检测：**  在成功写入 Webshell 后，执行任意命令，并将结果回显。
3.  **命令执行：**  允许用户输入自定义命令，并在目标系统上执行。

该工具通过图形界面封装了漏洞利用的细节，降低了利用门槛。

**投毒风险分析：**

该POC工具本身存在一定的投毒风险。虽然主要功能是利用Spring4Shell漏洞，但作者可能在代码中加入恶意逻辑，例如：

*   **后门植入：**  在 Webshell 中添加额外的后门，方便攻击者长期控制目标系统。
*   **信息窃取：**  在命令执行过程中，收集敏感信息并发送到攻击者控制的服务器。
*   **恶意传播：**  利用漏洞感染其他系统。

由于无法直接审查 Rexbb.jar 的源代码，因此存在一定的信任风险。建议在使用此类工具时，保持警惕，在安全隔离的环境中进行测试，并进行代码审计，以确保工具的安全性。

**投毒可能性评估：**

虽然不能确定是否存在投毒代码，但根据代码的性质，作者具备植入恶意代码的可能性。相对来说，作者详细说明了POC使用方式以及原理，降低了投毒可能性。因此，评估投毒风险为10%。

**项目地址:** [zangcc/CVE-2022-22965-rexbb](https://github.com/zangcc/CVE-2022-22965-rexbb)

**漏洞详情:** [CVE-2022-22965](https://nvd.nist.gov/vuln/detail/CVE-2022-22965)