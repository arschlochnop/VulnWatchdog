## CVE-2023-46818-ISPConfig-PHP代码注入

**漏洞编号:** CVE-2023-46818

**漏洞类型:** PHP代码注入

**影响应用:** ISPConfig

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** <= 3.2.11

**利用条件:** 需要管理员权限，且admin_allow_langedit选项开启

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2023-46818是一个存在于ISPConfig 3.2.11及之前版本中的PHP代码注入漏洞。该漏洞位于language_edit.php文件中，允许具有管理员权限的用户，如果启用了`admin_allow_langedit`选项，则可以通过修改语言文件注入并执行任意PHP代码。

**漏洞利用方式：**

1.  **身份验证：** 攻击者必须首先以管理员身份登录到ISPConfig控制面板。
2.  **访问语言文件编辑器：** 登录后，攻击者需要导航到语言文件编辑器。
3.  **注入恶意PHP代码：** 攻击者通过`records` POST参数，将恶意PHP代码注入到语言文件的内容中。由于输入没有经过充分的清理，攻击者可以插入任意PHP代码。
4.  **代码执行：** 当ISPConfig加载或执行被修改的语言文件时，注入的PHP代码将被执行，从而允许攻击者在服务器上执行任意命令。

**POC代码分析：**

提供的Python POC代码自动化了漏洞利用过程。它执行以下步骤：

1.  **登录：** 使用提供的URL、用户名和密码登录到ISPConfig。
2.  **构造Payload：** 构造包含恶意PHP代码的Payload，该代码会将一个WebShell写入到服务器上的`sh.php`文件中。
3.  **CSRF Token获取:**  获取CSRF ID和Key，绕过CSRF防御
4.  **注入代码：** 向`language_edit.php`发送包含Payload的POST请求。
5.  **启动Shell：** 连接到新创建的WebShell，允许攻击者执行任意命令。

**有效性评估：**

根据漏洞描述和POC代码，该漏洞利用是有效的。POC代码提供了一个可以直接利用该漏洞的有效方法，搜索结果也确认了该漏洞的存在以及利用的可能性。

**投毒风险评估：**

检查POC代码后，发现该代码主要功能是利用漏洞进行代码注入，在/admin/目录下写入webshell，实现远程代码执行。虽然该代码用于恶意目的，但它本身没有隐藏任何额外的、与漏洞利用无关的恶意代码。因此，投毒风险较低，约为1%。

虽然可以判定POC代码不属于投毒代码,但在实际环境中，利用此漏洞本身就是一种恶意行为，会导致服务器被完全控制。


**项目地址:** [bipbopbup/CVE-2023-46818-python-exploit](https://github.com/bipbopbup/CVE-2023-46818-python-exploit)

**漏洞详情:** [CVE-2023-46818](https://nvd.nist.gov/vuln/detail/CVE-2023-46818)