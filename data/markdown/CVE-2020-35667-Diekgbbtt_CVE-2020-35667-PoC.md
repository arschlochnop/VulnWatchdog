## CVE-2020-35667-JetBrains TeamCity SSRF

**漏洞编号:** CVE-2020-35667

**漏洞类型:** SSRF (服务器端请求伪造)

**影响应用:** JetBrains TeamCity Plugin

**危害等级:** 中危，可能暴露用户凭据

**影响版本:** < 2020.2.85695

**利用条件:** TeamCity 实例需要运行易受攻击的插件版本，并且攻击者需要有权限发送恶意请求给 TeamCity 服务器。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞是 JetBrains TeamCity Plugin 中存在的一个 SSRF 漏洞。根据漏洞库信息，攻击者可以利用该漏洞发送恶意请求，从而可能暴露用户凭据。 

**利用方式：**

1.  **SSRF攻击：** 攻击者构造包含恶意URL的请求，发送给TeamCity服务器。
2.  **内部资源访问：**  TeamCity服务器在收到恶意请求后，会尝试访问攻击者指定的URL，如果TeamCity服务器有权访问内部网络或其他受保护的资源，攻击者可以通过此漏洞实现对这些资源的未授权访问。
3.  **凭据泄露：**  如果TeamCity服务器访问的内部资源需要身份验证，且身份验证信息可以通过HTTP请求头传递，攻击者可以通过SSRF漏洞获取到这些凭据。

**POC有效性：**

提供的POC代码包含以下组件：

*   **TeamCity Server Dockerfile：** 用于构建包含易受攻击的TeamCity服务器的Docker镜像，用于本地复现漏洞。
*   **TeamCity Server Entrypoint Script：**  用于配置和启动TeamCity服务器。
*   **HTTP Listener Dockerfile：** 用于构建一个简单的HTTP监听器（sink.py）的Docker镜像，用于接收TeamCity服务器发送的请求。
*   **HTTP Listener (sink.py)：**  使用 Flask 编写的 HTTP 监听器，用于记录收到的所有请求，包括请求头、请求体等。攻击者可以通过控制TeamCity服务器访问此监听器来验证SSRF漏洞的存在，并获取TeamCity服务器发送的请求信息。

此PoC搭建了可控环境来复现SSRF漏洞，证明了该漏洞的可利用性。 

**投毒风险分析：**

虽然提供的代码旨在演示SSRF漏洞，但存在一些潜在的投毒风险：

*   **HTTP Listener的安全隐患：** `sink.py` 记录所有请求，攻击者可能会修改此脚本以执行恶意操作，例如将收集到的凭据发送到外部服务器，或者利用收集到的信息进一步攻击内部网络。这种可能性较低，因为`sink.py`代码本身比较简单且容易审查。
*   **TeamCity Server配置篡改：** `docker-entrypoint.sh` 脚本用于配置 TeamCity 服务器。攻击者可能会篡改此脚本，例如添加恶意用户、更改管理员密码，或者配置 TeamCity 服务器以执行恶意代码。但是，此处的脚本主要关注TeamCity的启动，没有发现明显的恶意配置。
*   **Dockerfile恶意软件添加：**  攻击者可能在`tc-server/Dockerfile` 中添加额外的命令，例如下载和执行恶意软件，或者安装后门程序。  

综合来看，投毒风险较低，约为10%。主要集中在对 `sink.py` 和 `docker-entrypoint.sh`的潜在恶意修改，以及在 Dockerfile 中添加恶意软件的可能性上。但是，由于代码量相对较小，且目的是复现SSRF漏洞，因此攻击者添加复杂恶意代码的可能性较低。

**项目地址:** [Diekgbbtt/CVE-2020-35667-PoC](https://github.com/Diekgbbtt/CVE-2020-35667-PoC)

**漏洞详情:** [CVE-2020-35667](https://nvd.nist.gov/vuln/detail/CVE-2020-35667)