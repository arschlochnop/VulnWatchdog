## CVE-2018-19323: GIGABYTE GDrv MSR 任意读写导致权限提升

**漏洞编号:** CVE-2018-19323

**漏洞类型:** 权限提升

**影响应用:** GIGABYTE APP Center, AORUS GRAPHICS ENGINE, XTREME GAMING ENGINE, OC GURU II

**危害等级:** 高危，可完全控制系统

**影响版本:** GIGABYTE APP Center v1.05.21及更早版本, AORUS GRAPHICS ENGINE 1.57之前版本, XTREME GAMING ENGINE 1.26之前版本, OC GURU II v2.08

**利用条件:** 需要安装存在漏洞的GIGABYTE驱动 (gdrv.sys)

**POC 可用性:** 是

**投毒风险:** 20%

## 详情

CVE-2018-19323 漏洞存在于 GIGABYTE 的 GDrv 低级驱动程序中，允许未经授权的用户读取和写入机器特定寄存器 (MSR)。这使得攻击者可以利用此漏洞进行权限提升，甚至完全控制系统。

**有效性分析：**

漏洞库信息表明，该漏洞已被公开披露，并且存在已知的利用方式。搜索引擎结果也表明该漏洞被积极利用。提供的漏洞利用代码描述看起来较为完整，包括了内核利用，多架构支持，反分析和反调试，自定义payload等等特性。从代码结构来看, 包括了`exploit.py`主脚本，`core.py`驱动交互和漏洞利用，`payloads.py`有效荷载生成，`evasion.py`反调试反虚拟机，`monitor.py`监控，`multiarch.py`多架构支持以及`framework.py`和主流C2框架集成。 整体来说，POC代码完成度较高，可信度较高。

**投毒风险分析：**

尽管该POC提供了多种功能，但仍然存在一定的投毒风险。虽然有法律警告声明不负责滥用，但是作者`kali`在代码中可能隐藏恶意功能，例如植入后门或收集用户信息。由于POC代码较为复杂，完全审计所有代码以确保没有恶意行为是比较困难的。风险主要存在于以下几个方面:

1.  **Evasion模块：**虽然Evasion模块旨在绕过安全检测，但也可能被滥用，用于隐藏恶意代码或行为。
2.  **Payloads模块：**Payloads模块可以生成自定义shellcode，如果生成包含恶意功能的shellcode，可能导致严重后果。
3.  **Framework模块：**集成了Metasploit, Cobalt Strike等框架，可能存在恶意配置或利用。
4. **License中篡改作者名称**: 一般来说开源项目不会把copyright年份设置成将来的年份, 且作者名称kali可能存在恶意。

根据代码的复杂性，以及潜在的滥用可能性，我认为存在 **20%** 的投毒风险。

**利用方式：**

该漏洞的利用方式通常涉及以下步骤：

1.  **利用漏洞驱动：** 攻击者首先需要利用存在漏洞的 GIGABYTE 驱动程序（如 `gdrv.sys`）。
2.  **MSR 读写：** 通过该驱动，攻击者可以读取和写入任意 MSR。
3.  **内核地址泄露：** 攻击者通过读取特定的 MSR（例如 `IA32_LSTAR`）来泄露内核基址。
4.  **执行 Shellcode：** 攻击者通过修改 MSR 来控制程序执行流程，加载并执行自定义的 shellcode。
5.  **权限提升：** Shellcode 的目标通常是窃取系统 token，从而将当前进程的权限提升到 `NT AUTHORITY\SYSTEM`。

简而言之，攻击者通过漏洞驱动，利用 MSR 读写能力，最终实现内核级别的代码执行和权限提升。

**项目地址:** [blueisbeautiful/CVE-2018-19323](https://github.com/blueisbeautiful/CVE-2018-19323)

**漏洞详情:** [CVE-2018-19323](https://nvd.nist.gov/vuln/detail/CVE-2018-19323)