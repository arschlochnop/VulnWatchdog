## CVE-2023-22809-sudoedit权限提升

**漏洞编号:** CVE-2023-22809

**漏洞类型:** 权限提升

**影响应用:** sudo

**危害等级:** 高危，允许本地低权限用户提升至root权限

**影响版本:** 1.8.0 <= version < 1.9.12p2

**利用条件:** 需要目标系统存在sudo且版本在受影响范围内，并且用户拥有sudoedit权限。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-22809是sudoedit中的一个权限提升漏洞。该漏洞源于sudoedit在处理用户提供的环境变量（SUDO_EDITOR, VISUAL, EDITOR）中的额外参数时存在缺陷。攻击者可以通过设置包含`--`参数的恶意编辑器环境变量来绕过保护机制，并附加任意文件到sudoedit处理的文件列表中，从而以root权限编辑或创建任意文件。

**有效性:** 根据漏洞描述和搜索结果，提供的POC代码利用了此漏洞。它通过设置环境变量，使得`sudoedit`可以执行任意命令，进而复制`/bin/bash`并设置SUID位，最终通过执行`/tmp/bash -p`来获取root权限。因此，POC代码是有效的。

**投毒风险:** POC代码的主要目的是提权，执行`cp /bin/bash /tmp/bash && chmod +s /tmp/bash`，这是一个提权的常见手法，验证漏洞是否存在。该脚本中没有明显的恶意代码。但如果此脚本被放入一个恶意软件仓库，则可以被认为含有一定的投毒风险，比如作者可以加入其他恶意操作在提权后执行。风险占比大约10%。

**利用方式:**
1.  攻击者需要在一个已经存在sudo的系统上拥有一个低权限账户，并且该账户可以使用sudoedit命令。
2.  攻击者通过设置环境变量`SUDO_EDITOR`、`VISUAL`或`EDITOR`，使其包含`--`参数以及想要操作的恶意文件路径。
3.  攻击者运行`sudoedit`命令。
4.  `sudoedit`会错误地将恶意文件添加到要编辑的文件列表中，从而允许攻击者以root权限编辑或创建这些文件。
5.  攻击者利用该权限修改系统文件，或者如POC中所示，复制一个具有SUID权限的bash shell，然后执行该shell以获得root权限。

**项目地址:** [AntiVlad/CVE-2023-22809](https://github.com/AntiVlad/CVE-2023-22809)

**漏洞详情:** [CVE-2023-22809](https://nvd.nist.gov/vuln/detail/CVE-2023-22809)