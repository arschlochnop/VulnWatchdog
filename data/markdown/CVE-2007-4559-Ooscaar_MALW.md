## CVE-2007-4559 - Python tarfile 目录遍历漏洞

**漏洞编号:** CVE-2007-4559

**漏洞类型:** 目录遍历

**影响应用:** Python tarfile module (Polemarch易受攻击)

**危害等级:** 高危，允许远程攻击者覆盖任意文件

**影响版本:** 所有使用存在漏洞的tarfile模块的Python版本

**利用条件:** 需要用户协助，上传恶意构造的TAR文件

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2007-4559 是一个存在于Python tarfile模块中的目录遍历漏洞。攻击者可以创建一个恶意构造的TAR文件，其中包含带有“..”序列的文件名，当用户使用tarfile.extract或tarfile.extractall函数提取此TAR文件时，攻击者可以覆盖服务器上的任意文件。

**有效性：**
提供的POC代码是有效的，并且是针对Polemarch服务器的完整漏洞利用。它利用CVE-2007-4559漏洞，允许攻击者注入cryptominer（Monero）和rootkit。

**投毒风险：**
此仓库存在一定投毒风险（估计为10%）。虽然主要目的是利用已知的CVE-2007-4559漏洞，但仍有可能在编译脚本或配置中引入细微的恶意修改，例如在rootkit或shellcode中嵌入后门，从而在受害者系统上建立持久存在点。

风险分析：

*   Dockerfile：检查Dockerfile发现其目的在于创建一个包含漏洞环境的Docker镜像，方便漏洞利用。
*   README.md：描述了如何使用CVE-2007-4559漏洞攻击Polemarch服务器，包括编译二进制文件、设置服务器和上传恶意TAR文件。
*   STORY.md：描述了漏洞发现和利用的背景故事，包括如何通过网络钓鱼获取服务器访问权限。

代码分析发现该POC的主要目的是演示漏洞利用，并没有明显的恶意投毒代码。

**利用方式：**
利用方式主要包括以下步骤：

1.  **创建恶意TAR文件：** 攻击者构造一个包含带有目录遍历序列（“..”）的文件名的TAR文件。
2.  **上传恶意TAR文件：** 攻击者需要某种方式将此恶意TAR文件上传到目标系统，例如通过Web应用程序的文件上传功能。
3.  **提取恶意TAR文件：** 目标应用程序使用存在漏洞的tarfile.extract或tarfile.extractall函数提取上传的TAR文件。由于目录遍历漏洞，恶意文件将被写入攻击者指定的位置，从而实现任意文件覆盖。

在此POC中，攻击者利用此漏洞将cryptominer、rootkit和被感染的`polemarchctl` Docker entrypoint注入Polemarch服务器，从而控制受害者系统。


**项目地址:** [Ooscaar/MALW](https://github.com/Ooscaar/MALW)

**漏洞详情:** [CVE-2007-4559](https://nvd.nist.gov/vuln/detail/CVE-2007-4559)