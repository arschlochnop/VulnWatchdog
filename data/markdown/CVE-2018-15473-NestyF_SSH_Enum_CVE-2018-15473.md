## CVE-2018-15473-OpenSSH用户名枚举

**漏洞编号:** CVE-2018-15473

**漏洞类型:** 用户名枚举

**影响应用:** OpenSSH

**危害等级:** 中危，可能被用于后续的暴力破解或其他攻击

**影响版本:** <= 7.7

**利用条件:** 需要网络连通性，目标主机开启SSH服务

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2018-15473 漏洞是 OpenSSH 7.7 及更早版本中的一个用户枚举漏洞。该漏洞源于 OpenSSH 在处理无效用户认证请求时，没有延迟 bailout 直到完全解析完包含该请求的数据包。攻击者可以利用该漏洞，通过发送特制的 SSH 请求，根据服务器响应时间的不同，判断目标主机上是否存在特定的用户名。

**有效性:**
提供的 POC 代码 `ssh_enum_usr.py` 利用了这一漏洞。它通过尝试使用无效的公钥对不同的用户名进行身份验证，并根据 `AuthenticationException` 异常来判断用户是否存在。如果服务器立即返回 `AuthenticationException`，则表示用户名无效；如果服务器花费一些时间处理请求，则表示用户名有效。因此，提供的 POC 代码是有效的。

**投毒风险:**
分析提供的代码：

*   `README.md` 只是描述了漏洞和利用方法，没有恶意代码。
*   `ssh_enum_usr.py` 主要实现了用户名枚举的功能。其中 `add_boolean` 函数被定义为空函数，旨在防止在认证过程中发送额外的布尔值，这可能是为了避免触发某些安全机制。作者通过修改`paramiko.message.Message.add_boolean`的方式存在一定风险，可能导致其他依赖`paramiko`库的程序出现异常。总体来看，核心的用户名枚举逻辑并没有明显的投毒行为。主要风险在于`paramiko`库的修改可能影响其他程序,以及脚本本身被恶意使用。脚本利用了时间差来判断用户是否存在，这种方法可能受到网络延迟和服务器负载的影响，存在误报的可能。代码中使用 colorama 库来格式化输出，但这不是安全风险。该脚本宣称仅用于教育目的。
*  总体评估，投毒风险较低，约为10%。

**利用方式:**
1.  攻击者首先需要确定目标主机上运行的 OpenSSH 版本小于等于 7.7。
2.  攻击者可以使用 POC 脚本 `ssh_enum_usr.py`，指定目标 IP 地址、端口和用户名列表。
3.  脚本会尝试使用无效的公钥对每个用户名进行身份验证。
4.  根据服务器的响应时间，脚本可以判断用户名是否存在，并将结果输出到控制台。
5.  攻击者可以将枚举到的用户名用于后续的攻击，例如暴力破解密码。

**漏洞修复建议:**
升级 OpenSSH 到 7.8 或更高版本，该版本修复了此漏洞。

**项目地址:** [NestyF/SSH_Enum_CVE-2018-15473](https://github.com/NestyF/SSH_Enum_CVE-2018-15473)

**漏洞详情:** [CVE-2018-15473](https://nvd.nist.gov/vuln/detail/CVE-2018-15473)