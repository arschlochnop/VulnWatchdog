## CVE-2022-25174 - Jenkins Pipeline Shared Groovy Libraries Plugin OS Command Injection

**漏洞编号:** CVE-2022-25174

**漏洞类型:** OS 命令注入

**影响应用:** Jenkins Pipeline: Shared Groovy Libraries Plugin

**危害等级:** 高危，允许攻击者在 Jenkins 控制器上执行任意 OS 命令

**影响版本:** <= 552.vd9cc05b8a2e1

**利用条件:** 攻击者需要具有 Item/Configure 权限

**POC 可用性:** 是 (需要自行构造)

**投毒风险:** 10%

## 详情

CVE-2022-25174 漏洞存在于 Jenkins Pipeline Shared Groovy Libraries 插件中，版本 552.vd9cc05b8a2e1 及更早版本受影响。该漏洞是由于插件对 Pipeline 库使用相同的检出目录处理不同的 SCM，允许具有 Item/Configure 权限的攻击者通过精心设计的 SCM 内容在控制器上执行任意操作系统命令。 

**有效性：** 漏洞库信息和搜索结果确认了漏洞的存在和高危性。虽然提供的代码段是`CHANGELOG.md`，不是直接的 PoC 代码，但它确认了受影响的版本范围，有助于识别目标系统是否存在此漏洞。利用此漏洞需要构造恶意的 SCM 内容，因此需要额外的工作来创建一个有效的 PoC。 

**投毒风险：** 提供的代码段是插件的更新日志，其中包含版本信息和修复说明。虽然changelog本身没有直接的投毒代码风险，但任何SCM都有可能存在投毒风险。如果攻击者能够修改或控制共享库的内容，他们就可以在其中插入恶意代码。由于此漏洞的本质涉及通过 SCM 内容执行命令，因此需要警惕是否存在通过 SCM 投毒的风险。假设 SCM 被攻破，存在潜在恶意代码，投毒风险预估为 10%。这个风险主要体现在恶意修改或添加共享库中的文件，以便在 Pipeline 执行期间触发恶意行为。

**利用方式：**
1.  攻击者需要具有 Jenkins 的 Item/Configure 权限。
2.  攻击者配置一个包含恶意代码的 SCM 仓库，该仓库会被用作 Pipeline 的共享库。
3.  由于漏洞，Jenkins 会为不同的 SCM 重用相同的检出目录。
4.  当 Pipeline 执行时，恶意 SCM 仓库中的代码会被检出到 Jenkins 控制器的文件系统中。
5.  恶意代码通过某种方式被执行，例如通过 Groovy 脚本中的命令注入。
6.  由于代码在 Jenkins 控制器上执行，攻击者可以执行任意操作系统命令。


**项目地址:** [shoucheng3/jenkinsci__workflow-cps-global-lib-plugin_CVE-2022-25174_544-vff04fa68714d](https://github.com/shoucheng3/jenkinsci__workflow-cps-global-lib-plugin_CVE-2022-25174_544-vff04fa68714d)

**漏洞详情:** [CVE-2022-25174](https://nvd.nist.gov/vuln/detail/CVE-2022-25174)