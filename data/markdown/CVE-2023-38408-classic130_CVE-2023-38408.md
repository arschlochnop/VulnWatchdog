## CVE-2023-38408-OpenSSH-Agent转发RCE

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 高危，可导致远程代码执行

**影响版本:** < 9.3p2

**利用条件:** 需要开启ssh-agent转发功能，并连接到受控的恶意服务器。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2023-38408 漏洞存在于 OpenSSH 9.3p2 之前的版本中，利用了 ssh-agent 的 PKCS#11 功能对库搜索路径验证不足的问题。攻击者通过控制目标机器连接的 SSH 服务器，诱导受害者加载恶意的 PKCS#11 模块，从而实现远程代码执行。

**有效性：** 根据漏洞描述和搜索结果，此漏洞的POC是存在的，并且已经有公开的利用代码和分析文章。从 Qualys 的分析报告来看，漏洞是可利用的。

**投毒风险：** 提供的代码仓库中只包含一个README.md 文件和 gpl-3.0.txt 许可证文件。没有发现任何可疑的代码，因此投毒风险为 0%。

**利用方式：**
1.  **受害者开启 Agent 转发：** 受害者在使用 SSH 客户端连接远程服务器时，开启了 agent forwarding 功能 ( `-A` 参数)。
2.  **攻击者控制恶意服务器：** 攻击者控制一个 SSH 服务器，并诱使受害者连接到该服务器。
3.  **利用不安全的搜索路径：** 当 SSH 客户端尝试加载 PKCS#11 模块时，由于搜索路径验证不足，攻击者可以控制加载恶意模块。
4.  **远程代码执行：** 恶意 PKCS#11 模块被加载后，执行攻击者预先设定的恶意代码，从而控制受害者的 SSH 客户端。

简而言之，受害者连接到一个被攻击者控制的服务器，该服务器会使 ssh-agent 加载一个恶意的 PKCS#11 库，导致代码执行。此漏洞依赖于 SSH agent forwarding 功能的开启。

**项目地址:** [classic130/CVE-2023-38408](https://github.com/classic130/CVE-2023-38408)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)