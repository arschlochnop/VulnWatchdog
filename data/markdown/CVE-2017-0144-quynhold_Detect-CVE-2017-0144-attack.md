## CVE-2017-0144 (EternalBlue)

**漏洞编号:** CVE-2017-0144

**漏洞类型:** 远程代码执行

**影响应用:** Windows SMBv1

**危害等级:** 高危，可能导致系统完全控制

**影响版本:** Windows Vista SP2; Windows Server 2008 SP2 and R2 SP1; Windows 7 SP1; Windows 8.1; Windows Server 2012 Gold and R2; Windows RT 8.1; Windows 10 Gold, 1511, and 1607; and Windows Server 2016

**利用条件:** 目标系统开启SMBv1服务，且未安装MS17-010补丁

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2017-0144，又名EternalBlue，是Windows SMBv1协议中的一个远程代码执行漏洞。攻击者可以通过精心构造的SMB数据包发送到目标系统，利用该漏洞在目标系统上执行任意代码。根据提供的漏洞信息、搜索结果和漏洞利用代码分析如下：

**有效性：**提供的Python脚本 `detectcve20170144.py` 是一个**检测脚本**，而不是利用脚本。它通过抓包分析SMB数据包，检测是否存在EternalBlue攻击的特征（例如，SMB状态码 `0xc000000d`）。真正的漏洞利用通常会使用Metasploit框架或其他工具，发送包含恶意shellcode的SMB数据包来执行远程代码。 因此，提供的代码**不能直接利用**，但可以用于**检测**EternalBlue攻击。

**投毒风险：**分析`detectcve20170144.py`脚本，发现存在一定的投毒风险。脚本中包含越南语注释，以及将TCP Payload进行编码和解码的复杂操作，虽然可能是为了处理字符集问题，但增加了代码审查的难度。存在一定的风险，即作者可能通过这些复杂操作隐藏恶意代码，例如将特定payload注入到网络流量中。此外脚本会写入 `bcd.csv` 和 `log.txt` 文件，如果对文件名或写入内容未进行充分的安全检查，可能存在潜在的恶意利用。因此，保守估计投毒风险为10%。

**利用方式：**EternalBlue漏洞的利用方式通常包括以下步骤：

1.  **扫描目标：** 使用Nmap等工具扫描目标网络，查找开启SMBv1服务的 vulnerable 主机。
2.  **漏洞利用：** 使用Metasploit框架中的 `exploit/windows/smb/ms17_010_eternalblue` 模块或其它EternalBlue利用工具。
3.  **配置参数：** 设置`RHOST`（目标IP地址），根据目标系统版本选择合适的payload，例如 `windows/x64/meterpreter/reverse_tcp`。
4.  **执行攻击：** 运行 `exploit` 命令，向目标系统发送特制的SMB数据包。
5.  **获取权限：** 如果漏洞利用成功，攻击者将在目标系统上获得远程代码执行权限，通常会获得一个Meterpreter shell。

总而言之，提供的Python脚本并非直接的漏洞利用代码，而是一个检测脚本，用于监测网络流量中EternalBlue攻击的迹象。漏洞的实际利用需要借助Metasploit等工具。

**项目地址:** [quynhold/Detect-CVE-2017-0144-attack](https://github.com/quynhold/Detect-CVE-2017-0144-attack)

**漏洞详情:** [CVE-2017-0144](https://nvd.nist.gov/vuln/detail/CVE-2017-0144)