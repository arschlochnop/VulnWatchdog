## CVE-2025-32462-Sudo主机名绕过

**漏洞编号:** CVE-2025-32462

**漏洞类型:** 权限提升

**影响应用:** Sudo

**危害等级:** 中危，本地权限提升

**影响版本:** 1.8.8 <= Sudo < 1.9.17p1

**利用条件:** 需要存在sudoers文件配置了非当前主机或ALL的主机名规则，并且攻击者是sudoers中被限制的用户

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2025-32462 存在于 Sudo 1.9.17p1 之前的版本中。当 sudoers 文件指定的主机既不是当前主机也不是 ALL 时，此漏洞允许列出的用户在非预期的机器上执行命令。

**漏洞利用分析：**

1.  **漏洞原理：** 该漏洞允许用户通过 `-h` 选项欺骗 sudo 命令，绕过 sudoers 文件中基于主机名的访问限制。即使 sudoers 文件限制用户在特定主机上使用 sudo，攻击者仍然可以通过指定另一个 sudoers 文件中允许的主机来执行命令。
2.  **POC 代码分析：**
    *   `matrix-sudo-escape.sh` 脚本首先检测 Sudo 版本是否易受攻击。
    *   然后，它创建一个新用户，并配置sudoers文件以允许该用户在特定的主机名上执行命令。
    *   脚本将主机名设置为受限制的主机名，确认新用户无法在此主机上运行 sudo。
    *   最后，它使用 `-h` 选项指定允许的主机名，绕过限制，并尝试以 root 身份执行 `whoami` 命令。如果成功，则验证漏洞。
3.  **利用方式：** 攻击者必须是系统中已经存在的用户，但受到 sudoers 文件中主机名限制。他们可以通过使用 `sudo -h <allowed_host> <command>` 绕过此限制，其中 `<allowed_host>` 是 sudoers 文件中允许的主机名。

**投毒风险分析：**

该脚本具有一定的投毒风险，虽然主要是演示漏洞利用，但是依然存在以下风险：

1.  **密码硬编码：** 脚本需要输入用户密码,虽然脚本中没保存,但如果用于自动化攻击,存在被记录的风险. 尽管脚本创建用户后会删除用户，但如果在利用过程中出现异常，可能会残留创建的用户。
2.  **Sudoers 文件修改：** 脚本会修改 `/etc/sudoers` 文件，尽管有备份和恢复机制，但在某些情况下（例如脚本执行中断），可能会导致 sudoers 文件损坏，影响系统安全。脚本尝试恢复sudoers，如果恢复失败（权限问题或中断），可能导致系统不稳定，需要手动修复sudoers文件。
3.  **主机名修改：** 脚本会临时修改主机名，如果脚本在修改主机名后未正确恢复，可能会导致网络问题或其他应用程序出现异常。
4.  **潜在的恶意命令注入：**  尽管脚本使用了 `set -euo pipefail` 来提高安全性，但如果攻击者能够修改脚本内容，仍有可能注入恶意命令。

**结论：**

该POC代码有效，可以验证 CVE-2025-32462 漏洞。利用方式是通过 `-h` 选项欺骗 sudo 命令，绕过主机名限制。 投毒风险较低，约为 10%。主要风险在于sudoers文件修改和主机名修改，可能导致系统不稳定。脚本本身的目的是演示漏洞，风险主要在于使用不当或被恶意修改。

**项目地址:** [cybersentinelx1/CVE-2025-32462-Exploit](https://github.com/cybersentinelx1/CVE-2025-32462-Exploit)

**漏洞详情:** [CVE-2025-32462](https://nvd.nist.gov/vuln/detail/CVE-2025-32462)