## CVE-2024-3400 PAN-OS GlobalProtect 命令注入漏洞

**漏洞编号:** CVE-2024-3400

**漏洞类型:** 命令注入

**影响应用:** PAN-OS GlobalProtect

**危害等级:** 高危，可导致远程代码执行

**影响版本:** PAN-OS 10.2, PAN-OS 11.0, and PAN-OS 11.1 （未升级到指定hotfix版本）

**利用条件:** 需要目标系统配置了GlobalProtect gateway 或 GlobalProtect portal

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞是由于PAN-OS GlobalProtect功能中存在任意文件创建导致的命令注入漏洞。未经验证的攻击者可以通过向目标服务器发送特制的请求，在目标服务器上创建恶意文件，进而执行任意系统命令，最终获得root权限。漏洞利用代码通过修改Cookie中的`SESSID`参数，指向一个包含命令注入的路径，然后发送POST请求到`/ssl-vpn/hipreport.esp`来触发该漏洞。httpx用于快速扫描目标域名下的活跃主机及端口，Subfinder用于子域名枚举。

**有效性评估：**
根据漏洞信息和漏洞利用代码，该PoC代码是有效的。漏洞库信息明确指出存在公开的PoC，并且漏洞被大规模利用。搜索结果中也包含大量关于该漏洞的分析和利用信息。该PoC代码通过构造恶意的Cookie，利用了任意文件创建的漏洞，实现了命令注入。

**投毒风险分析：**
PoC代码本身的功能是验证漏洞是否存在。代码主要包含以下功能：
1.  **子域名枚举:**  使用`subfinder`工具枚举目标域名的子域名，这本身没有投毒风险，但如果`subfinder`本身被替换成恶意版本，则存在风险。
2.  **活跃主机扫描:** 使用`httpx`工具扫描活跃主机，同样，需要保证`httpx`工具本身的安全性。
3.  **漏洞验证:** 通过构造特殊的Cookie和URI，发送POST请求来验证目标是否存在漏洞。这个过程本身是漏洞利用的一部分，**不是投毒代码**。
4. **临时文件处理**: 代码中会创建和删除临时文件(`temp_domains.txt`)，如果存在恶意修改，可能导致拒绝服务或信息泄露，但可能性较低。

**潜在投毒点分析：**
*   **依赖外部工具:** PoC依赖`subfinder`和`httpx`这两个外部工具。如果这两个工具被恶意版本替换，则存在投毒风险。例如，恶意版本的`subfinder`可能返回错误的子域名，或者`httpx`被修改为执行恶意代码。这种风险的评估概率是10%。

**利用方式：**
1.  **子域名枚举 (可选):** 使用`subfinder`等工具枚举目标域名的子域名。如果已知目标IP地址，则可以跳过此步骤。
2.  **活跃主机扫描:** 使用`httpx`等工具扫描目标子域名的80,443,4443,8443端口，确定哪些主机是活跃的。
3.  **漏洞验证:** 对活跃的主机，构造包含恶意代码的Cookie，发送POST请求到`/ssl-vpn/hipreport.esp`，验证漏洞是否存在。Cookie包含的文件路径指向可以执行命令的位置，从而实现命令注入。
4.  **命令执行:** 成功利用漏洞后，攻击者可以在目标系统上执行任意命令，从而控制系统。

**项目地址:** [nanwinata/CVE-2024-3400](https://github.com/nanwinata/CVE-2024-3400)

**漏洞详情:** [CVE-2024-3400](https://nvd.nist.gov/vuln/detail/CVE-2024-3400)