## CVE-2024-36401-GeoServer-RCE

**漏洞编号:** CVE-2024-36401

**漏洞类型:** 远程代码执行

**影响应用:** GeoServer

**危害等级:** 高危，未经身份验证的攻击者可以通过构造恶意请求执行任意代码。

**影响版本:** 受影响版本包括2.22.6之前的所有版本，2.23.0到2.23.6，2.24.0到2.24.4，以及2.25.0到2.25.2。

**利用条件:** 目标GeoServer实例需对外开放，且位于受影响的版本范围内。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-36401是GeoServer中的一个远程代码执行漏洞，源于GeoTools库在处理要素类型属性名称时，未安全地将其传递给commons-jxpath库，导致攻击者可以通过XPath表达式注入执行任意代码。该漏洞影响多个OGC请求参数，包括WFS GetFeature、WFS GetPropertyValue、WMS GetMap、WMS GetFeatureInfo、WMS GetLegendGraphic和WPS Execute请求。\n\n**有效性：**\n提供的PoC代码（`detect.py`）旨在检测目标GeoServer实例是否存在此漏洞。它通过发送特制的WFS请求，利用XPath注入漏洞尝试执行`curl`命令，向指定的OOB（带外）服务器发送请求。如果收到OOB请求，则表明目标存在漏洞。根据漏洞描述和搜索引擎结果，此PoC代码应该有效。\n\n**投毒风险：**\nPoC代码的主要功能是漏洞检测，但仍然存在潜在的投毒风险。以下是分析：\n1.  **OOB服务器依赖：** PoC依赖于一个外部OOB服务器来确认漏洞的存在。如果攻击者控制了该OOB服务器，可以记录目标IP，进行后续攻击活动。\n2.  **`curl`命令：** PoC代码中使用了`curl`命令，虽然是为了检测目的，但如果目标系统上不存在`curl`，或者`curl`命令的行为被修改（例如，通过别名或包装器），可能会导致PoC执行失败，或者执行其他恶意操作。例如，如果`curl`被替换为一个恶意的脚本，该脚本可能会执行额外的系统命令，从而对目标系统造成损害。\n3.  **漏洞利用本身：** 虽然PoC主要用于检测，但它本质上也是一个漏洞利用工具。如果PoC被恶意传播并被不法分子使用，可能会导致未经授权的远程代码执行。\n\n综合来看，该PoC的投毒风险较低，主要风险在于OOB服务器被恶意利用和`curl`命令的潜在风险。因此，投毒风险评估为10%。\n\n**利用方式：**\n1.  **发送恶意WFS请求：** 攻击者构造包含恶意XPath表达式的WFS请求，利用`wfs:valueReference`参数注入代码。\n2.  **执行任意代码：** 由于GeoServer不安全地评估属性名称，恶意XPath表达式被执行，导致任意代码执行。\n3.  **带外验证（OOB）：** PoC通过执行`curl`命令，向OOB服务器发送请求，验证代码是否成功执行。攻击者可以将`curl`替换为其他命令，例如反弹shell，以实现更深入的攻击。

**项目地址:** [jakabakos/CVE-2024-36401-GeoServer-RCE](https://github.com/jakabakos/CVE-2024-36401-GeoServer-RCE)

**漏洞详情:** [CVE-2024-36401](https://nvd.nist.gov/vuln/detail/CVE-2024-36401)