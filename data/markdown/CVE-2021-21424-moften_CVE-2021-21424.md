## CVE-2021-21424-Symfony-UserEnumeration

**漏洞编号:** CVE-2021-21424

**漏洞类型:** 信息泄露/用户枚举

**影响应用:** Symfony

**危害等级:** 中危，可能导致用户枚举，为进一步攻击提供信息

**影响版本:** >= 2.8.0, < 3.4.48; >= 4.0.0, < 4.4.23; >= 5.0.0, < 5.2.8

**利用条件:** 目标系统启用了 Web Profiler 且未在生产环境中禁用 /app_dev.php, /_profiler 或 /_wdt。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-21424 漏洞存在于 Symfony 框架中，允许未经授权的攻击者枚举用户。该漏洞是由于在尝试使用用户切换功能时，根据用户是否存在而返回不同的处理方式引起的。攻击者可以通过检查返回的错误信息或状态码来判断用户是否存在。

**有效性分析：**

根据漏洞描述和提供的 POC 代码，该漏洞的利用方式是通过访问 `/_profiler/` 接口获取 token 列表，然后使用这些 token 访问 profiler 数据。如果 Web Profiler 未在生产环境中禁用，攻击者可以利用此漏洞泄露敏感信息，包括环境变量、内部路由、数据库配置等。

提供的 Python 脚本首先访问 `BASE_URL/_profiler/` 获取所有 token 的 URL，然后循环访问每个 token URL，检查响应内容是否包含 `APP_ENV` 字符串。如果包含，则认为泄露了敏感数据并打印响应内容。

结合搜索引擎结果，该漏洞确实存在且影响多个 Symfony 版本。

**投毒风险分析：**

查看提供的 Python 脚本和 README.md 文件，没有发现明显的恶意代码或者后门。脚本的功能是扫描 Symfony 的 Web Profiler 并尝试提取敏感信息，属于正常的漏洞利用行为。

**利用方式：**

1.  确定目标系统运行的是受影响的 Symfony 版本。
2.  确认目标系统启用了 Web Profiler，并且 `/app_dev.php`, `/_profiler` 或 `/_wdt` 接口在生产环境中可以访问。
3.  使用提供的 Python 脚本，修改 `BASE_URL` 为目标系统的 URL。
4.  运行脚本，脚本会自动扫描 Web Profiler 并尝试提取敏感信息，如环境变量、数据库配置等。
5.  根据提取到的信息，可以进行进一步的攻击，例如利用数据库配置信息连接数据库或者利用环境变量中的凭据提升权限。

综上，该 POC 代码的有效性较高，不存在投毒风险，利用方式是通过访问 Web Profiler 提取敏感信息。

**项目地址:** [moften/CVE-2021-21424](https://github.com/moften/CVE-2021-21424)

**漏洞详情:** [CVE-2021-21424](https://nvd.nist.gov/vuln/detail/CVE-2021-21424)