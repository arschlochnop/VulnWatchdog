## CVE-2024-23897 - Jenkins 任意文件读取

**漏洞编号:** CVE-2024-23897

**漏洞类型:** 任意文件读取

**影响应用:** Jenkins

**危害等级:** 高危，允许未授权的攻击者读取 Jenkins 控制器上的任意文件

**影响版本:** <= 2.441, <= LTS 2.426.2

**利用条件:** 需要能够通过HTTP/WebSocket/SSH访问Jenkins CLI接口

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-23897 是 Jenkins 中存在的一个任意文件读取漏洞。该漏洞源于 Jenkins CLI 命令解析器中的一个功能，该功能会将参数中以'@'字符开头的后跟文件路径的内容替换为文件的实际内容。未经过身份验证的攻击者可以通过构造包含恶意文件路径的请求，利用该漏洞读取 Jenkins 控制器文件系统上的任何文件。根据漏洞库信息、搜索引擎结果以及提供的漏洞利用代码（PoC），对漏洞利用的有效性、投毒风险和利用方式进行分析如下：

**1. 有效性：**

   *   **漏洞库信息：** 漏洞库信息明确指出 CVE-2024-23897 允许未经身份验证的攻击者读取任意文件。
   *   **搜索引擎结果：** 搜索结果中的多个链接（例如，NVD、Trend Micro、Zscaler、Uptycs、Splunk）都确认了该漏洞的存在以及其严重性，并表明该漏洞允许任意文件读取。一些文章甚至提到可以利用该漏洞实现远程代码执行(RCE)，虽然直接利用文件读取RCE可能需要更复杂的条件，但文件读取本身是一个严重的安全问题。
   *   **漏洞利用代码：** 提供的 Python PoC 代码 `CVE-2024-23897.py` 尝试利用此漏洞。它通过构造特定的 HTTP 请求，包含以 `@` 开头的文件路径来触发漏洞。PoC 包含发送 `download` 和 `upload` 请求到 `/cli?remoting=false` 接口，并设置 `Session` 和 `Side` 头。其中 `download` 请求用于读取文件内容，`upload` 请求可能用于辅助漏洞利用或传递命令。代码通过构建特定的数据包来发送包含文件路径的指令。结合漏洞描述，利用 `@` 字符触发文件读取是漏洞的核心。因此，提供的 PoC 代码基本有效。

**2. 投毒风险：**

   *   在提供的 PoC 代码中，潜在的投毒风险较低，约为 10%。主要考虑以下几点：

        *   代码的目的是读取文件内容，主要通过构造 HTTP 请求来实现。代码中没有直接执行命令或写入文件的操作。
        *   代码包含处理 HTTP 请求和响应的逻辑，这部分代码可能存在潜在的漏洞，但不太可能直接导致恶意代码执行。
        *   `calculate_header_in_bytes` 函数根据不同的命令设置不同的 header。如果攻击者能够控制命令，则可能影响 Jenkins 的行为。但是根据目前的代码来看，没有发现明显的后门。
        *   `calculate_tail_in_bytes` 函数中语言选项如果可控也存在一定的安全隐患。但是代码本身没有明显的投毒。

**3. 利用方式：**

   1.  **确定目标 Jenkins 实例：** 攻击者需要找到存在 CVE-2024-23897 漏洞的 Jenkins 实例。
   2.  **构建恶意请求：** 攻击者构建一个包含恶意文件路径的 HTTP POST 请求，发送到 Jenkins 的 `/cli?remoting=false` 端点。文件路径需要以 `@` 字符开头，例如 `@/etc/passwd`。
   3.  **设置请求头：**  需要设置正确的请求头，包括 `Session` 和 `Side`，以及 `Content-type`（对于 `upload` 请求）。
   4.  **发送请求并获取响应：** 攻击者发送构建好的请求，并解析 Jenkins 的响应。如果漏洞利用成功，响应将包含目标文件的内容。
   5.  **读取敏感信息：** 攻击者可以利用该漏洞读取 Jenkins 控制器上的任何文件，包括配置文件、密钥、凭据等敏感信息，从而进一步攻击 Jenkins 系统。

**总结：**

CVE-2024-23897 是 Jenkins 中一个严重的安全漏洞，它允许未经身份验证的攻击者读取 Jenkins 控制器上的任意文件。提供的 PoC 代码可以有效地利用该漏洞。代码本身存在一定的投毒风险，但是并不明显。攻击者可以利用该漏洞读取敏感信息，进一步威胁 Jenkins 系统的安全。

**项目地址:** [xaitax/CVE-2024-23897](https://github.com/xaitax/CVE-2024-23897)

**漏洞详情:** [CVE-2024-23897](https://nvd.nist.gov/vuln/detail/CVE-2024-23897)