## CVE-2024-53677 - Apache Struts文件上传路径穿越导致RCE

**漏洞编号:** CVE-2024-53677

**漏洞类型:** 文件上传路径穿越/远程代码执行

**影响应用:** Apache Struts

**危害等级:** 高危，可导致任意文件上传和远程代码执行

**影响版本:** 2.0.0 <= version < 6.4.0

**利用条件:** 使用了存在漏洞的FileuploadInterceptor，并允许文件上传功能。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-53677是Apache Struts中的一个文件上传漏洞，攻击者可以通过操纵文件上传参数实现路径穿越，从而将恶意文件上传到受限目录，最终可能导致远程代码执行。 

**有效性分析：**

提供的Dockerfile和相关文件构成了一个可用于复现该漏洞的Docker环境。Dockerfile配置了Maven来构建Struts应用，然后部署到Tomcat服务器。`tomcat-users.xml`添加了管理员账户，`context.xml`定义了Tomcat上下文。`README.md` 文件提供了搭建环境的步骤，表明这是一个可用的PoC环境。

**投毒风险分析：**

代码主要目的是搭建漏洞环境，以便进行漏洞复现。但是`/tmp/e2ab3a0d694a1c73866387b5d303b4a6/struts-app/mvnw` 文件中存在可疑点，如果`if [ -f /etc/mavenrc ]`判断成立，可能会执行`/etc/mavenrc`文件，存在被恶意覆盖`/etc/mavenrc`文件,执行恶意代码的风险。
因此，投毒风险评估为较低，大约为10%。主要基于以下判断：
  *  代码的主要目的是复现漏洞，而不是恶意攻击。
  *  虽然存在潜在的风险点（如`mvnw`脚本），但没有明确的恶意代码或行为。
  *  环境搭建过程相对透明，用户可以审查代码。

**利用方式：**

1.  攻击者通过构造恶意的文件上传请求，利用路径穿越漏洞，将包含恶意代码的文件（如JSP webshell）上传到服务器上的任意目录。
2.  利用`FileuploadInterceptor`处理文件上传请求时，没有充分验证文件路径，导致攻击者可以控制上传文件的目标路径。
3.  一旦恶意文件上传成功，攻击者就可以通过访问该文件，执行其中的恶意代码，从而控制服务器。
4.  根据搜索结果，该漏洞已经被积极利用，因此需要立即修复。

**项目地址:** [0xdeviner/CVE-2024-53677](https://github.com/0xdeviner/CVE-2024-53677)

**漏洞详情:** [CVE-2024-53677](https://nvd.nist.gov/vuln/detail/CVE-2024-53677)