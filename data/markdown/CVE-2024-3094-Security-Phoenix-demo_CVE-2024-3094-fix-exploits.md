## CVE-2024-3094-xz-utils供应链后门

**漏洞编号:** CVE-2024-3094

**漏洞类型:** 供应链后门

**影响应用:** xz-utils

**危害等级:** 高危，允许未经授权的远程SSH访问，可能导致远程代码执行和数据泄露

**影响版本:** 5.6.0和5.6.1

**利用条件:** 目标系统必须使用受感染的xz-utils版本，且sshd链接到liblzma。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-3094是一个存在于xz-utils 5.6.0和5.6.1版本中的供应链后门漏洞。该漏洞通过一系列复杂的混淆，在liblzma的构建过程中从伪装的测试文件中提取预构建的目标文件，然后用它来修改liblzma代码中的特定函数。这导致任何链接到这个被修改的liblzma库的软件都可能受到影响，恶意代码可以拦截和修改与该库的数据交互。 

**有效性分析：**
提供的POC代码主要是检测脚本，用于判断系统是否存在CVE-2024-3094漏洞。这些脚本通过以下方式进行检测：

1.  **检查liblzma是否被sshd使用：**  脚本首先查找sshd使用的liblzma库的路径。
2.  **检查函数签名：**  脚本使用hexdump命令检查liblzma库中是否存在特定的恶意函数签名。
3.  **检查xz版本：**  脚本检查xz工具的版本，判断是否为受影响的版本（5.6.0或5.6.1）。

如果所有检查都表明存在漏洞，则脚本会报告系统可能易受攻击。因此，提供的脚本**并非漏洞利用代码，而是检测脚本**，用于验证系统是否受到影响。根据搜索引擎结果，存在利用此漏洞进行远程代码执行的潜在可能，但提供的代码仅用于检测。

**投毒风险分析：**
虽然提供的脚本本身的主要功能是检测漏洞，但是仍需对脚本内容进行细致的分析，防范作者在其中隐藏潜在的恶意代码。以下是分析结果：

1.  **脚本来源：**  脚本来自于开源社区，并经过了修改。
2.  **代码混淆：**  脚本本身没有明显的代码混淆。
3.  **外部命令调用：**  脚本使用了`whereis`、`ldd`、`grep`、`awk`、`hexdump`、`sort`等外部命令。虽然这些命令本身是系统自带的，但如果系统中的这些命令被替换为恶意版本，则可能导致安全风险。
4.  **版本检查逻辑：**  版本检查的逻辑相对简单，但是如果存在其他漏洞，可能会被绕过。
5.  **修改历史：**  脚本经过了修改，需要仔细审查修改内容，确保没有引入恶意代码。

综上所述，此仓库中存在作者隐藏投毒代码的风险较低，但不能完全排除，概率约为**10%**。

**利用方式分析：**
根据漏洞信息和搜索结果，CVE-2024-3094漏洞的利用方式如下：

1.  **供应链攻击：**  攻击者通过入侵xz-utils的开发流程，将恶意代码注入到xz-utils的源代码中。
2.  **构建过程注入：**  恶意代码在liblzma的构建过程中，从伪装的测试文件中提取预构建的目标文件，并修改liblzma代码中的特定函数。
3.  **SSH后门：**  被修改的liblzma库会被sshd等程序链接，从而允许攻击者绕过SSH身份验证，获得未经授权的远程访问权限。
4.  **远程代码执行：**  攻击者可以通过SSH后门执行任意代码，从而控制受影响的系统。

**总结：**
CVE-2024-3094是一个严重的供应链后门漏洞，攻击者通过修改xz-utils的源代码，在liblzma库中植入恶意代码，从而允许未经授权的远程SSH访问。提供的POC代码主要是检测脚本，用于判断系统是否存在漏洞，**并不包含直接的漏洞利用代码**。虽然脚本本身投毒风险较低，但仍需谨慎使用，并仔细审查其内容。

**项目地址:** [Security-Phoenix-demo/CVE-2024-3094-fix-exploits](https://github.com/Security-Phoenix-demo/CVE-2024-3094-fix-exploits)

**漏洞详情:** [CVE-2024-3094](https://nvd.nist.gov/vuln/detail/CVE-2024-3094)