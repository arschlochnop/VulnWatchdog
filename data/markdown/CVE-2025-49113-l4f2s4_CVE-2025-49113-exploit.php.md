## CVE-2025-49113-Roundcube-Webmail-RCE

**漏洞编号:** CVE-2025-49113

**漏洞类型:** PHP对象反序列化导致的远程代码执行

**影响应用:** Roundcube Webmail

**危害等级:** 高危，可导致远程代码执行

**影响版本:** < 1.5.10, 1.6.0 <= version < 1.6.11

**利用条件:** 需要已认证的用户凭据

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2025-49113是Roundcube Webmail中存在的一个严重漏洞，影响1.5.10之前的版本以及1.6.0到1.6.10版本。此漏洞允许经过身份验证的用户通过`program/actions/settings/upload.php`中未验证的`_from`参数执行远程代码。漏洞的根本原因是PHP对象反序列化。攻击者可以构造一个恶意序列化的PHP对象，并将其作为`_from`参数的值传递给服务器。当服务器尝试反序列化此对象时，恶意代码会被执行，从而允许攻击者在服务器上执行任意命令。

**漏洞利用方式：**

1.  **身份验证：** 攻击者需要拥有有效的Roundcube Webmail用户凭据才能利用此漏洞。
2.  **构造恶意Payload：** 攻击者需要构造一个包含恶意代码的PHP对象，并将其序列化。提供的POC代码使用`Crypt_GPG_Engine`类来执行命令。该类在构造函数中接受一个参数，该参数被base64编码，然后通过`echo`和`sh`执行。这允许攻击者执行任意shell命令。
3.  **上传Payload：** 攻击者通过`_from`参数将构造的序列化对象payload注入到URL中,模拟文件上传请求，触发反序列化漏洞。
4.  **远程代码执行：** 当Roundcube Webmail服务器尝试反序列化恶意对象时，会执行攻击者注入的代码，从而实现远程代码执行。

**POC代码分析：**

*   `Crypt_GPG_Engine`类是payload构造的关键，它允许执行任意shell命令。
*   `getCookiesFromHeaders`函数用于从HTTP头中提取cookie。
*   `checkVersion`函数用于检测目标Roundcube Webmail的版本，以确认其是否易受攻击。
*   `verifySession`函数用于验证提供的cookie是否有效，确认是否已登录。
*   `uploadImage`函数模拟上传包含恶意payload的图片文件，触发漏洞。

**投毒风险分析：**

查看提供的POC代码，该代码的目的是利用反序列化漏洞执行任意命令。虽然使用了`Crypt_GPG_Engine`来执行命令，但这属于漏洞利用的一部分，不是投毒。其中使用`base64_encode`避免特殊字符，然后使用`echo`和`sh`来执行命令，比较常规。

**结论：** 提供的POC代码是有效的，可以用于利用CVE-2025-49113漏洞实现远程代码执行。代码中没有发现明显的投毒行为。投毒风险较低（0%）。

**项目地址:** [l4f2s4/CVE-2025-49113-exploit.php](https://github.com/l4f2s4/CVE-2025-49113-exploit.php)

**漏洞详情:** [CVE-2025-49113](https://nvd.nist.gov/vuln/detail/CVE-2025-49113)