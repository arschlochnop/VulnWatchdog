## CVE-2025-21756-Linux Kernel vsock Use-After-Free

**漏洞编号:** CVE-2025-21756

**漏洞类型:** Use-After-Free

**影响应用:** Linux Kernel

**危害等级:** 高危，可能导致权限提升和内核崩溃

**影响版本:** Linux kernel versions prior to the fixes mentioned in the CVE details

**利用条件:** 需要启用CONFIG_VSOCKETS内核配置

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2025-21756 存在于Linux内核的vsock子系统中，是一个经典的use-after-free漏洞。根据漏洞信息，当 transport 在重新分配时，socket binding 状态处理不当导致此漏洞。具体来说，`vsock_remove_bound()` 函数在 sk 被绑定并移动到绑定列表之前被调用，从而释放了 socket 结构。之后 `vsock_bind()` 函数尝试访问已释放的 socket 结构，导致use-after-free。

**漏洞利用方式分析：**

1.  **触发漏洞：**PoC 通过 `vsock_bind()` 和 `getsockname()`  等函数创建并绑定 vsock socket。然后，它利用传输重新分配期间的竞争条件触发 `vsock_remove_bound()` 的过早调用。
2.  **内存布局：** PoC 代码尝试通过分配大量的 socket 对象来控制内存布局，这有助于增加漏洞利用的可靠性。 `junk[FLUSH]` ,`pre[PRE]`和`post[POST]`这些操作用于进行内存的填充，以便后续的释放可以触发 UAF。
3.  **利用UAF：** PoC中的关键步骤是`vsock_bind(VMADDR_CID_LOCAL, VMADDR_PORT_ANY, SOCK_SEQPACKET);` 和后续的 `bind(junk[i], (struct sockaddr *)&sa, sizeof(sa))`。通过重复绑定操作，可以创造UAF利用的条件。通过netlink socket进行诊断操作。
4.  **权限提升：** 成功触发 UAF 后，攻击者可以控制被释放内存的内容，并覆盖关键的内核数据结构。通过覆盖这些数据结构，攻击者可以修改进程的凭据，从而获得 root 权限。

**有效性评估：**

根据PoC代码和漏洞描述，可以判断该PoC具有较高的有效性。漏洞描述中提供了详细的堆栈信息，这表明该漏洞在真实环境中是可利用的。搜索结果也表明，该漏洞已经有公开的PoC代码。

**投毒风险评估：**

PoC代码本身包含漏洞利用逻辑，可能存在一定的投毒风险。通过阅读 `README.md` 文件,作者提示需要检查`CONFIG_VSOCKETS` 是否开启,如果开启则存在风险。该PoC代码直接编译运行，没有发现明显的恶意代码。 投毒风险评估在10%左右，主要基于对代码作者的信任和代码本身实现的复杂性，不能完全排除作者在代码中隐藏后门或恶意逻辑的可能性，但可能性较低。

总而言之，CVE-2025-21756 是一个严重的安全漏洞，攻击者可以利用它来获得 root 权限。建议尽快升级到修复后的内核版本。

**项目地址:** [mr-spongebob/CVE-2025-21756](https://github.com/mr-spongebob/CVE-2025-21756)

**漏洞详情:** [CVE-2025-21756](https://nvd.nist.gov/vuln/detail/CVE-2025-21756)