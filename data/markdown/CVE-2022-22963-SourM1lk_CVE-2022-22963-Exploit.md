## CVE-2022-22963-Spring Cloud Function-远程代码执行

**漏洞编号:** CVE-2022-22963

**漏洞类型:** 远程代码执行

**影响应用:** Spring Cloud Function

**危害等级:** 高危，可能导致远程代码执行和数据泄露

**影响版本:** Spring Cloud Function versions 3.1.6, 3.2.2 和所有旧版本

**利用条件:** 需要目标系统运行受影响版本的Spring Cloud Function，且开启了routing功能，攻击者需要能够访问到functionRouter endpoint.

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22963是Spring Cloud Function中的一个远程代码执行漏洞。当使用routing功能时，攻击者可以通过提供特制的SpEL表达式作为routing-expression，导致远程代码执行和访问本地资源。

**有效性：**
根据漏洞信息、搜索结果和提供的漏洞利用代码，可以判断该漏洞的POC代码是有效的。漏洞库信息中提到该漏洞允许远程代码执行，搜索结果也确认了这一点，并指出可以在未经身份验证的情况下通过网络利用该漏洞。漏洞利用代码提供了一个Rust实现的PoC，可以发送任意命令到目标服务器执行。

**投毒风险：**
该POC代码的投毒风险较低，约为10%。代码主要功能是利用SpEL表达式执行命令。虽然可以执行任意命令，但作者在代码中隐藏恶意Payload可能性较低。
1.  代码结构清晰，主要功能是发送包含SpEL表达式的HTTP请求。
2.  代码中存在`<shell_code>` 占位符，暗示用户需要自行替换shellcode，存在被替换成恶意shellcode的风险
3.  依赖项`reqwest`, `tokio`, `colored` 都是比较常见的库，被植入恶意代码的可能性较低。

**利用方式：**
1.  攻击者通过构造包含恶意SpEL表达式的`spring.cloud.function.routing-expression` header，发送到目标系统的`/functionRouter` endpoint。
2.  目标系统在处理routing-expression时，SpEL表达式被执行，从而导致远程代码执行。
3.  提供的POC代码允许攻击者发送任意命令到目标系统执行，可以通过修改`touch_command`、`shellcode_command`、`custom_command`变量的值，执行不同的命令或shellcode。

**项目地址:** [SourM1lk/CVE-2022-22963-Exploit](https://github.com/SourM1lk/CVE-2022-22963-Exploit)

**漏洞详情:** [CVE-2022-22963](https://nvd.nist.gov/vuln/detail/CVE-2022-22963)