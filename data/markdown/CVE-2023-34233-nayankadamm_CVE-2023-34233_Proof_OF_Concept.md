## CVE-2023-34233-Snowflake Python Connector-命令注入

**漏洞编号:** CVE-2023-34233

**漏洞类型:** 命令注入

**影响应用:** Snowflake Python Connector

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** < 3.0.2

**利用条件:** 需要用户交互，诱骗用户访问恶意构造的SSO URL

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-34233 是 Snowflake Python Connector 中存在的一个命令注入漏洞，影响版本低于 3.0.2。该漏洞源于单点登录（SSO）浏览器 URL 认证过程。攻击者可以通过以下步骤利用此漏洞：

1.  **建立恶意资源：** 攻击者需要搭建一个恶意的、公开可访问的服务器，该服务器能够响应 SSO URL 并返回包含恶意 payload 的内容。
2.  **诱骗用户：** 攻击者诱骗用户访问恶意构造的连接 URL。这可以通过网络钓鱼或其他社会工程学方法实现。
3.  **远程代码执行：** 如果用户访问了恶意 URL，用户的本地机器将执行恶意 payload，从而导致远程代码执行。

提供的 Dockerfile 和相关文件包含用于验证此漏洞的概念验证（PoC）代码。Dockerfile 用于构建包含易受攻击的 Snowflake Connector 版本的 Docker 镜像。PoC 脚本旨在检测该漏洞并展示其利用方式。

**有效性评估：**

根据漏洞描述和提供的 PoC 代码，该漏洞利用是有效的。PoC 代码的目的是验证该漏洞是否可以利用，并且包含 unpatched 版本的连接器。

**投毒风险评估：**

虽然提供的代码主要是为了验证漏洞，但是仍然存在一定的投毒风险。`requirements.txt`允许自定义安装的python依赖包，攻击者可以通过控制这些依赖包引入恶意代码。尽管如此，这个风险较低，因为主要的代码都在PoC脚本中，可以人工审计。`config.toml` 文件包含 Snowflake 账户的敏感信息（账号标识符、用户名、密码等）。如果用户不小心将包含真实凭据的 `config.toml` 文件提交到版本控制系统（如 Git），攻击者可能会获取这些凭据并访问 Snowflake 数据库。

**利用方式总结：**

1.  攻击者搭建恶意 SSO 服务器，响应包含恶意 payload 的 SSO URL。
2.  攻击者通过钓鱼等手段诱导用户点击恶意链接。
3.  用户使用存在漏洞的 Snowflake Python Connector 连接到恶意 SSO 服务器。
4.  恶意 payload 在用户本地机器上执行，导致命令注入。

**缓解措施：**

*   升级到 Snowflake Python Connector 的 3.0.2 或更高版本。
*   使用 URL 白名单限制允许的 SSO URL。
*   实施反钓鱼措施，教育用户识别和避免恶意链接。

**项目地址:** [nayankadamm/CVE-2023-34233_Proof_OF_Concept](https://github.com/nayankadamm/CVE-2023-34233_Proof_OF_Concept)

**漏洞详情:** [CVE-2023-34233](https://nvd.nist.gov/vuln/detail/CVE-2023-34233)