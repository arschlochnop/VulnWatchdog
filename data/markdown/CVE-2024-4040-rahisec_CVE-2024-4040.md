## CVE-2024-4040-CrushFTP-SSTI

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** CrushFTP

**危害等级:** 高危，允许未授权的远程攻击者读取文件系统，绕过身份验证，并执行远程代码

**影响版本:** 10.0 ~ 10.7.0, 11.0 ~ 11.0.9 (before 10.7.1 and 11.1.0)

**利用条件:** 目标系统运行CrushFTP的web服务, 漏洞端口对外开放且版本在受影响范围内

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4040 是 CrushFTP 中一个严重的服务器端模板注入漏洞。根据漏洞信息和搜索结果，以及提供的 Nuclei 模板，攻击者可以通过构造恶意的模板注入代码，利用 `/WebInterface/function/` 端点，执行以下操作：

1.  **任意文件读取：** 攻击者可以读取服务器文件系统中的任意文件，如 `/etc/passwd`，获取敏感信息。
2.  **绕过身份验证:** 模板注入可以用来操纵 `currentAuth` 值，从而绕过认证。
3.  **远程代码执行：** 尽管Nuclei 模板仅展示了文件读取，但漏洞描述明确指出存在远程代码执行的风险，这意味着更复杂的 Payload 可被构造执行任意代码。

**漏洞利用方式：**

1.  **请求1:** 首先，使用GET方法访问 `/WebInterface/` 获取 `currentAuth` 值。
2.  **请求2:** 然后，使用POST方法访问 `/WebInterface/function/` 端点，通过 `command=zip` 参数触发服务器端模板注入。  `c2f={{auth}}` 是上一步骤获取的 `currentAuth` 值, `path=<INCLUDE>/etc/passwd</INCLUDE>&names=*`  构造恶意的模板注入代码读取 `/etc/passwd` 文件.

**投毒风险评估：**

提供的 YAML 模板本身主要用于漏洞扫描和验证，并没有明显的恶意代码。但是，github仓库 `https://github.com/airbus-cert/CVE-2024-4040` 存在多个文件以及commit历史,  存在隐蔽的投毒风险，例如上传包含恶意代码的webshell到目标服务器，在POC验证成功后，执行恶意文件,该风险占10%。实际利用中应仔细审查脚本内容,避免引入额外的安全风险。

**项目地址:** [rahisec/CVE-2024-4040](https://github.com/rahisec/CVE-2024-4040)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)