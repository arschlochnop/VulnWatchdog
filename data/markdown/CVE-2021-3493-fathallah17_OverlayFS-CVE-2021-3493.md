## CVE-2021-3493 - Ubuntu OverlayFS 本地提权

**漏洞编号:** CVE-2021-3493

**漏洞类型:** 本地权限提升

**影响应用:** Linux Kernel (OverlayFS)

**危害等级:** 高危，可导致本地权限提升至root

**影响版本:** 4.4 <= Linux Kernel < 5.8.0-50.56 (Ubuntu 特定版本)

**利用条件:** 需要存在Ubuntu内核中允许非特权用户挂载OverlayFS的补丁，且用户命名空间未被禁用。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2021-3493 是一个存在于 Linux 内核 OverlayFS 实现中的权限提升漏洞。漏洞的根本原因是 OverlayFS 在设置底层文件系统中文件的 capabilities 时，没有正确地验证用户命名空间。在存在允许非特权用户挂载 OverlayFS 的 Ubuntu 内核补丁的环境中，攻击者可以利用此漏洞获得提升的权限。

**利用方式：**

1.  **环境准备：**  目标系统需要是受影响的 Ubuntu 版本，并且允许非特权用户挂载 OverlayFS，同时用户命名空间没有被禁用。
2.  **获取漏洞利用代码：**  从可信来源获取漏洞利用代码 (例如 SSD-Disclosure 提供的 exploit.c)。
3.  **编译漏洞利用代码：**  使用 gcc 等编译器将 exploit.c 编译为可执行文件。
4.  **执行漏洞利用代码：**  运行编译后的可执行文件。漏洞利用代码会利用 OverlayFS 的漏洞，通过设置文件 capabilities 来提升当前用户的权限至 root。
5.  **获取 root 权限：**  成功执行漏洞利用代码后，用户将获得 root 权限。

**关于投毒风险：**

提供的POC代码只是一个简单的利用方式,不太可能包含恶意代码。但始终需要对任何来源的漏洞利用代码进行审查，以降低风险。
对下载的文件进行检查，如哈希校验，可以最大程度的避免引入恶意代码。

**有效性评估：**

根据漏洞描述和利用代码，该漏洞利用是有效的。利用代码通过OverlayFS的漏洞，允许低权限用户获得root权限。

**其他信息:**
CISA 已将此漏洞添加到已知被利用的漏洞目录 (KEV) 中，表明该漏洞已被广泛利用。

**项目地址:** [fathallah17/OverlayFS-CVE-2021-3493](https://github.com/fathallah17/OverlayFS-CVE-2021-3493)

**漏洞详情:** [CVE-2021-3493](https://nvd.nist.gov/vuln/detail/CVE-2021-3493)