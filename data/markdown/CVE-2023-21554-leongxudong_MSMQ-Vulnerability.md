## CVE-2023-21554 - Microsoft Message Queuing (MSMQ) 远程代码执行漏洞

**漏洞编号:** CVE-2023-21554

**漏洞类型:** 远程代码执行

**影响应用:** Microsoft Message Queuing (MSMQ)

**危害等级:** 高危，可能导致远程代码执行和系统控制

**影响版本:** 受影响的Windows版本详见CVE信息

**利用条件:** 目标系统需要启用并运行MSMQ服务，且攻击者能够访问目标机器的1801端口。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-21554是一个Microsoft Message Queuing (MSMQ)服务中的远程代码执行漏洞。攻击者可以通过向MSMQ服务发送特制的恶意消息，利用该漏洞在目标系统上执行任意代码。\n\n**有效性分析：**\n根据提供的漏洞信息和利用代码，该漏洞的PoC是可用的。PoC代码（poc.py）通过socket连接目标IP地址的1801端口，然后发送一系列预先准备好的二进制数据包（establish_connection.bin, connection_parameters.bin, user_message.bin）。这些数据包模拟了MSMQ的通信过程，利用了协议解析中的漏洞。攻击者需要根据实际情况修改PoC中的IP地址，并确保相应的数据文件存在。从3tternp的代码库修改而来，降低了投毒的可能性。\n\n**投毒风险分析：**\n虽然PoC代码本身看起来直接利用漏洞，但仍然存在一定的投毒风险。PoC代码依赖于外部二进制文件（.bin文件）。如果这些文件被替换为包含恶意代码的版本，攻击者可以通过该PoC执行任意代码。因此，在运行PoC之前，务必验证这些二进制文件的来源和完整性。通过分析PoC代码，发现其主要功能是发送预先制作好的数据包。如果这些数据包被修改为包含恶意指令，可能导致不可预测的行为。根据文件来源和代码分析，投毒风险估计为10%。\n\n**利用方式分析：**\n1.  **环境准备：** 攻击者需要安装Python，并获取PoC代码和相关的数据文件。\n2.  **目标确定：** 攻击者需要确定目标机器的IP地址，并且目标机器需要运行MSMQ服务。\n3.  **PoC配置：** 攻击者需要修改PoC代码中的IP地址，指向目标机器。\n4.  **漏洞触发：** 攻击者运行PoC代码，PoC代码会连接目标机器的1801端口，并发送恶意消息。\n5.  **代码执行：** 如果漏洞利用成功，攻击者可以在目标机器上执行任意代码。通常，攻击者会利用该漏洞来安装后门程序或执行其他恶意操作。\n\n**缓解措施：**\n1.  及时安装Microsoft提供的安全补丁。\n2.  禁用不需要的MSMQ服务。\n3.  限制MSMQ服务的访问权限。\n4.  使用防火墙阻止对1801端口的未授权访问。\n5.  监控MSMQ服务的异常行为。

**项目地址:** [leongxudong/MSMQ-Vulnerability](https://github.com/leongxudong/MSMQ-Vulnerability)

**漏洞详情:** [CVE-2023-21554](https://nvd.nist.gov/vuln/detail/CVE-2023-21554)