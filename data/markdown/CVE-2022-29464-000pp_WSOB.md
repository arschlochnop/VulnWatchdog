## CVE-2022-29464 - WSO2 任意文件上传导致远程代码执行

**漏洞编号:** CVE-2022-29464

**漏洞类型:** 任意文件上传/远程代码执行

**影响应用:** WSO2 API Manager, Identity Server, Enterprise Integrator, Open Banking AM/KM

**危害等级:** 高危，可导致服务器完全控制

**影响版本:** WSO2 API Manager 2.2.0 to 4.0.0, WSO2 Identity Server 5.2.0 to 5.11.0, WSO2 Identity Server Analytics 5.4.0, 5.4.1, 5.5.0 and 5.6.0, WSO2 Identity Server as Key Manager 5.3.0 to 5.11.0, WSO2 Enterprise Integrator 6.2.0 to 6.6.0, WSO2 Open Banking AM 1.4.0 to 2.0.0 and WSO2 Open Banking KM 1.4.0 to 2.0.0

**利用条件:** 需要目标服务器开放fileupload端点，且攻击者可访问。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-29464 漏洞存在于多个WSO2产品中，允许未经授权的文件上传，最终导致远程代码执行。

**漏洞利用方式：**

攻击者通过 `/fileupload` 端点，利用 `Content-Disposition` 头部的目录穿越（Path Traversal）序列，将恶意文件上传到Web根目录下的可执行目录，例如 `../../../../repository/deployment/server/webapps`。上传的文件会被服务器解析执行，从而实现远程代码执行。

**有效性：**

根据漏洞库信息、搜索引擎结果（如Rapid7、Trend Micro等安全厂商的分析）和提供的POC代码（WSOB工具），该漏洞利用的有效性很高。网上有大量的关于此漏洞的分析文章和漏洞利用案例。

**投毒风险：**

提供的POC代码是一个相对简单的Python脚本，主要功能是利用该漏洞进行文件上传。主要包含以下几个文件:
* `main.py`: 主程序入口，解析参数并启动漏洞利用。
* `src/interface/ui.py`: 定义了用户界面相关的函数，如显示banner。
* `src/wsob/main.py`: 漏洞利用的核心代码。
* `requirements.txt`: 依赖的Python库。

通过分析POC代码，**未发现明显的恶意代码或后门**。代码逻辑相对清晰，主要是发送HTTP请求，构造恶意的文件上传请求，进行目录穿越，实现任意文件上传。

但依旧存在潜在的投毒风险：

1.  **依赖风险：** `requirements.txt` 中列出的依赖库可能存在安全漏洞，攻击者可以通过供应链攻击，篡改这些依赖库，从而植入恶意代码。但是概率较低。
2. **漏洞利用代码本身的缺陷:**  漏洞利用代码中可能包含未知的缺陷或者错误，导致利用失败，或者引发其他安全问题。但是根据目前搜索结果该POC相对比较成熟。

**综合评估，该POC代码存在轻微的投毒风险，大约为5%。**

**项目地址:** [000pp/WSOB](https://github.com/000pp/WSOB)

**漏洞详情:** [CVE-2022-29464](https://nvd.nist.gov/vuln/detail/CVE-2022-29464)