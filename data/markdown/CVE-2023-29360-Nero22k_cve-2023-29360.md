## CVE-2023-29360 - Microsoft Streaming Service Elevation of Privilege

**漏洞编号:** CVE-2023-29360

**漏洞类型:** 权限提升

**影响应用:** Microsoft Streaming Service (MSKSSRV.SYS)

**危害等级:** 高危，本地权限提升

**影响版本:** 受影响的Windows版本 (参考漏洞库信息)

**利用条件:** 需要本地访问权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-29360 是 Microsoft Streaming Service 中的一个权限提升漏洞，存在于 `MSKSSRV.SYS` 驱动中。攻击者可以通过构造特定的IOCTL请求，利用驱动中的漏洞，最终提升权限。

**有效性：**

根据提供的POC代码，该漏洞的利用通过发送特定的IOCTL到 `MSKSSRV.SYS` 驱动实现。代码中包含了用于与驱动交互的IOCTL码 (例如 `IOCTL_RegisterStream`, `IOCTL_InitializeStream`)，以及构造的输入缓冲区结构体 (`InputBuffer`)。通过调用 `NtDeviceIoControlFile` 函数将这些IOCTL发送到设备驱动，如果驱动没有正确处理这些请求，可能导致权限提升。

**投毒风险：**

虽然POC代码看起来是合法的漏洞利用，但存在一些潜在的投毒风险，占比10%。主要集中在以下几个方面：

*   **硬编码值：** 代码中存在一些硬编码的常量值，例如 `inbuff.Flags = 0x000000136FE7474D`，这些值可能与特定版本的操作系统或驱动相关。如果这些值不正确，可能导致exploit无法正常工作，或者触发其他未知的行为。
*   **驱动依赖：** 该exploit严重依赖于 `MSKSSRV.SYS` 驱动的存在和特定行为。如果目标系统上不存在该驱动，或者驱动版本不兼容，exploit将无法工作。这使得exploit的适用性受到限制。
*   **事件处理：** 代码中使用了 `CreateEventW` 函数来创建事件对象。虽然看起来是标准的Windows API用法，但如果事件没有被正确处理或者泄露，可能导致资源耗尽或拒绝服务。

**利用方式：**

1.  **查找设备：** 首先，需要找到 `MSKSSRV.SYS` 驱动对应的设备句柄。通常可以通过设备接口名称或符号链接来找到该设备。
2.  **构造IOCTL请求：** 根据漏洞原理，构造特定的IOCTL请求和输入缓冲区。代码中已经定义了 `InputBuffer` 结构体，并设置了相应的字段值。
3.  **发送IOCTL请求：** 调用 `NtDeviceIoControlFile` 函数将IOCTL请求发送到设备驱动。
4.  **利用漏洞：** 如果驱动没有正确处理IOCTL请求，可能导致内存破坏、代码执行或权限提升。

**总结：**

提供的POC代码似乎是针对 CVE-2023-29360 的有效利用，但使用前需要仔细审查，并确保目标系统符合漏洞利用的条件。 代码中存在细微的投毒风险，但整体可利用性较高。需要注意的是，不应将POC验证的后门代码误判为投毒代码。需要仔细区分两者。

**项目地址:** [Nero22k/cve-2023-29360](https://github.com/Nero22k/cve-2023-29360)

**漏洞详情:** [CVE-2023-29360](https://nvd.nist.gov/vuln/detail/CVE-2023-29360)