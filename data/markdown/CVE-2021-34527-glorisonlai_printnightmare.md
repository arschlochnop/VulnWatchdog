## CVE-2021-34527 PrintNightmare

**漏洞编号:** CVE-2021-34527

**漏洞类型:** 远程代码执行

**影响应用:** Windows Print Spooler

**危害等级:** 高危，可导致SYSTEM权限的远程代码执行

**影响版本:** 受影响的Windows版本及其相应版本号详见漏洞库信息

**利用条件:** 需要经过身份验证的用户或者可以通过其他方式触发Print Spooler服务

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-34527（PrintNightmare）是Windows Print Spooler服务中的一个远程代码执行漏洞。攻击者可以利用此漏洞在受影响的系统上以SYSTEM权限执行任意代码。 

**有效性：**
根据漏洞库信息、搜索引擎结果和提供的漏洞利用代码，该漏洞是真实存在的，并且存在可用的POC代码。 搜索引擎结果中也明确指出存在可利用该漏洞的EXP.

**投毒风险：**
提供的POC代码（README.md）本身不包含可执行代码，因此直接包含恶意代码的可能性较低。但是，`printnightmare` 目录可能包含其他文件，这些文件可能包含恶意代码。 并且考虑到这是一个广泛公开的漏洞，攻击者可能修改公开的exp进行传播。因此，存在一定风险。

初步判断投毒风险为10%，主要基于以下几点：
1.  仅有README.md文件，无法直接判断代码功能
2.  漏洞广泛公开，攻击者可能修改EXP。

**利用方式：**
利用方式通常涉及以下步骤：
1.  攻击者利用经过身份验证的账户或者未经身份验证的情况下，通过网络或其他方式与目标系统的Print Spooler服务通信。
2.  攻击者向Print Spooler服务发送特制的请求，触发漏洞。
3.  漏洞触发后，攻击者可以上传并执行恶意的DLL文件，从而在目标系统上以SYSTEM权限执行任意代码。
4.  通过执行恶意代码，攻击者可以安装程序、查看、更改或删除数据，或者创建具有完全用户权限的新账户。

**修复方案:**
1. 及时安装微软官方发布的补丁。
2. 禁用Print Spooler服务（如果不需要打印功能）。
3. 检查并设置注册表项：HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows NT\Printers\PointAndPrint下的NoWarningNoElevationOnInstall和UpdatePromptSettings为0。

**项目地址:** [glorisonlai/printnightmare](https://github.com/glorisonlai/printnightmare)

**漏洞详情:** [CVE-2021-34527](https://nvd.nist.gov/vuln/detail/CVE-2021-34527)