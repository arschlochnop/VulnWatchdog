## CVE-2023-0386-Linux Kernel OverlayFS权限提升

**漏洞编号:** CVE-2023-0386

**漏洞类型:** 权限提升

**影响应用:** Linux Kernel

**危害等级:** 高危，本地用户可以提升权限到root

**影响版本:** Linux kernel 6.2-rc6 (根据漏洞库信息，实际影响范围可能更广)

**利用条件:** 需要本地用户权限，目标系统需要启用 OverlayFS

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

该漏洞存在于 Linux 内核的 OverlayFS 子系统中。当用户将具有 capabilities 的 setuid 文件从 nosuid 挂载复制到另一个挂载时，存在权限映射问题，可能导致本地用户获得未经授权的权限提升。

**利用方式：**

1.  **创建 FUSE 文件系统：** POC 使用 FUSE 创建一个伪文件系统，该文件系统提供一个名为 `a.out` 的文件，该文件具有 setuid root 权限和capabilities。
2.  **创建 OverlayFS 挂载：**  POC 创建一个 OverlayFS 挂载点，其中 lowerdir 指向 FUSE 文件系统，upperdir 和 workdir 用于 OverlayFS 的操作。
3.  **在 OverlayFS 中复制文件：** POC 尝试在 OverlayFS 挂载点中创建一个与 lowerdir 中 `a.out` 同名的文件，触发漏洞。
4.  **权限提升：** 通过漏洞，OverlayFS 将具有 capabilities 的 setuid 文件复制到 upperdir，然后通过执行upperdir中的`a.out`，本地用户可以提升权限。

**有效性：**

根据搜索引擎结果 (如 vicarius.io 的文章和 Rapid7 的模块)，该漏洞存在可利用的 POC，并且已被成功利用进行本地权限提升。提供的 POC 代码与漏洞描述相符，应该能够有效利用此漏洞。

**投毒风险：**

分析提供的 POC 代码，未发现明显的投毒代码。POC 代码的主要目的是利用 OverlayFS 的漏洞来提升权限，而不是执行恶意操作或植入后门。

*   `ss.c` 文件用于创建一个简单的 setuid root 的程序，这部分是漏洞利用的一部分，而不是恶意代码。
*   POC 代码创建的文件和目录都是为了利用 OverlayFS 漏洞，没有发现隐藏的恶意逻辑。

因此，可以认为此 POC 代码的投毒风险较低，概率为 0%。

**项目地址:** [orilevy8/cve-2023-0386](https://github.com/orilevy8/cve-2023-0386)

**漏洞详情:** [CVE-2023-0386](https://nvd.nist.gov/vuln/detail/CVE-2023-0386)