## CVE-2022-22965 Spring4Shell RCE

**漏洞编号:** CVE-2022-22965

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Spring Framework

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** Spring Framework versions 5.3.X prior to 5.3.18+, 5.2.x prior to 5.2.20+ and all old and unsupported versions

**利用条件:** JDK 9+, Tomcat 作为 WAR 部署, 并且应用使用了Spring MVC或Spring WebFlux

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-22965 (Spring4Shell) 是一个存在于Spring Framework中的远程代码执行漏洞。攻击者可以通过精心构造的请求，利用数据绑定机制，修改 Tomcat 的 AccessLogValve 组件的属性，从而写入恶意 WebShell 到服务器，最终实现 RCE。

**漏洞利用有效性:**
根据漏洞库信息和搜索结果，该漏洞在特定环境下（JDK 9+, Tomcat WAR部署）可以被成功利用。提供的POC代码（`web-threat-mitigation`仓库）也证实了这一点，该仓库提供了一个使用Metasploit进行漏洞利用的示例，展示了在有WAF和无WAF的情况下，利用的成功与失败。因此，可以判断POC代码是有效的。

**投毒风险:**
分析提供的代码仓库，主要是演示如何检测和缓解web应用程序威胁，通过 OWASP ZAP, Burp Suite, 和 ModSecurity WAF。它还包括了CVE-2022-22965 (Spring4Shell)的漏洞利用。代码仓库中没有明显的恶意代码或者后门, 但是考虑到任何人都可以修改和传播这些代码，以及实际环境中可能存在的复杂性，仍然不能完全排除投毒的可能。 风险估计为5%。

**利用方式:**
1.  **确定目标环境:**  检查目标应用程序是否满足漏洞利用的先决条件 (Spring MVC/WebFlux, JDK 9+, Tomcat WAR部署)。
2.  **发送恶意请求:**  构造包含恶意参数的HTTP请求，利用Spring的数据绑定机制，修改Tomcat的`AccessLogValve`组件属性。
3.  **写入WebShell:** 通过修改`directory`、`prefix`、`suffix`和`pattern`属性，将WebShell写入到服务器上的可访问目录。
4.  **执行命令:**  通过访问写入的WebShell，执行任意命令，实现远程代码执行。

**防御建议:**
*   升级Spring Framework到不受影响的版本 (5.3.18+, 5.2.20+)。
*   使用WAF (如ModSecurity) 并配置OWASP CRS来检测和阻止恶意请求。
*   限制数据绑定的使用，避免将用户输入直接绑定到敏感对象属性。

**项目地址:** [brunoh6/web-threat-mitigation](https://github.com/brunoh6/web-threat-mitigation)

**漏洞详情:** [CVE-2022-22965](https://nvd.nist.gov/vuln/detail/CVE-2022-22965)