## CVE-2025-24071 Microsoft Windows File Explorer Spoofing Vulnerability

**漏洞编号:** CVE-2025-24071

**漏洞类型:** NTLM Hash Leak / 信息泄露

**影响应用:** Microsoft Windows File Explorer

**危害等级:** 中危，攻击者可获取用户NTLM Hash，可能进行后续攻击

**影响版本:** 受影响的Windows版本包括Windows 10, Windows 11, Windows Server等，具体版本范围见漏洞库信息

**利用条件:** 需要用户下载并解压恶意ZIP文件

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2025-24071是一个Windows文件资源管理器欺骗漏洞，攻击者可以诱导用户下载并解压包含恶意`.library-ms`文件的ZIP压缩包，当用户解压该文件时，Windows资源管理器会自动向攻击者指定的SMB服务器发起身份验证请求，泄露用户的NTLM哈希。

**有效性评估：**

根据漏洞描述和提供的Metasploit模块代码，该漏洞利用是有效的。该Metasploit模块能够自动生成包含恶意`.library-ms`文件的ZIP压缩包，并配合SMB Capture模块捕获泄露的NTLM哈希。多个搜索结果表明该漏洞已经公开，并存在相应的利用方法。

**投毒风险评估：**

对提供的Metasploit模块代码进行分析，发现其主要功能是生成恶意的`.library-ms`文件并将其打包到ZIP文件中，以及提供与Metasploit的SMB Capture模块集成的功能。代码本身没有发现明显的恶意行为，例如植入后门或执行其他未授权操作。但仍然存在一些潜在的风险：

*   **依赖项风险：** 该模块依赖于`zip` gem。如果`zip` gem被恶意篡改，则可能存在投毒风险。
*   **ATTACKER_IP地址：** 如果用户设置了错误的`ATTACKER_IP`地址，可能会将NTLM哈希发送给错误的服务器。

综合考虑，该POC代码存在较低的投毒风险，可能性大约为5%。该风险主要来自于依赖项以及用户配置错误。

**利用方式分析：**

1.  **攻击者准备：**
    *   攻击者使用Metasploit的`auxiliary/server/ntlm_hash_leak`模块生成包含恶意`.library-ms`文件的ZIP压缩包。
    *   攻击者设置`ATTACKER_IP`为攻击者自己的IP地址，`SHARE_NAME`为SMB共享名称。
    *   攻击者启动Metasploit的`auxiliary/server/capture/smb`模块，监听SMB连接并捕获NTLM哈希。
2.  **诱骗受害者：**
    *   攻击者将生成的ZIP压缩包发送给受害者，诱骗其下载并解压。
    *   可以通过社会工程学等方式，伪装ZIP文件，诱导用户解压。
3.  **漏洞触发：**
    *   受害者解压ZIP压缩包，Windows资源管理器自动解析`.library-ms`文件，并尝试连接到攻击者指定的SMB服务器。
    *   在连接过程中，受害者的NTLM哈希被发送到攻击者的SMB服务器。
4.  **攻击者利用：**
    *   攻击者使用Metasploit的SMB Capture模块捕获受害者的NTLM哈希。
    *   攻击者可以尝试破解NTLM哈希，或使用NTLM哈希进行Pass-the-Hash攻击。

**项目地址:** [FOLKS-iwd/CVE-2025-24071-msfvenom](https://github.com/FOLKS-iwd/CVE-2025-24071-msfvenom)

**漏洞详情:** [CVE-2025-24071](https://nvd.nist.gov/vuln/detail/CVE-2025-24071)