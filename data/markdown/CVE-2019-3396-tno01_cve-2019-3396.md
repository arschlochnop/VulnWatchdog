## CVE-2019-3396-Atlassian Confluence-服务器端模板注入

**漏洞编号:** CVE-2019-3396

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** Atlassian Confluence Server/Data Center

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** < 6.6.12, 6.7.0 <= version < 6.12.3, 6.13.0 < version < 6.13.3, 6.14.0 < version < 6.14.2

**利用条件:** 需要能够访问存在 Widget Connector 宏的 Confluence 页面

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-3396 漏洞是 Atlassian Confluence Server 和 Data Center 中的一个服务器端模板注入（SSTI）漏洞。它存在于 Widget Connector 宏中，允许未经身份验证的远程攻击者通过构造恶意的 Velocity 模板，实现路径遍历和远程代码执行。漏洞影响的版本包括 6.6.12 之前的 6.6.x 版本，6.7.0 到 6.12.3 之前的 6.12.x 版本，6.13.0 到 6.13.3 之前的 6.13.x 版本，以及 6.14.0 到 6.14.2 之前的 6.14.x 版本。

**有效性：**

根据漏洞库信息和搜索引擎结果，该漏洞被广泛利用，存在公开的漏洞利用代码（例如 Exploit-DB 46731）。该漏洞已被 CISA 添加到已知被利用的漏洞目录中，表明其真实性和严重性。提供的 POC 代码 `/tmp/deed01dabaaab5a9c3b0b4b4d2014a34/README.md`  内容过于简单,仅包含标题 `# cve-2019-3396`，可能只是一个占位符，说明 POC 是存在的，但**需要结合其他信息确认具体的payload**。

**投毒风险：**

提供的 POC 代码只有一个 README 文件，内容非常简单，几乎没有投毒的可能。但是，完整的漏洞利用代码可能包含恶意代码。因为此README.md文件只是整个POC代码的一个组成部分. 考虑漏洞利用的复杂性和潜在的风险,投毒风险评估为10%。

**利用方式：**

1.  **定位存在 Widget Connector 宏的页面：**  攻击者需要找到 Confluence 实例中使用了 Widget Connector 宏的页面。
2.  **构造恶意 Velocity 模板：**  攻击者构造包含恶意代码的 Velocity 模板。该模板将被注入到 Widget Connector 宏中。
3.  **服务器端模板注入：**  当 Confluence 服务器渲染包含恶意模板的页面时，Velocity 引擎会执行模板中的代码，从而导致服务器端代码执行。
4.  **远程代码执行：**  攻击者通过执行任意代码来控制 Confluence 服务器，可能包括执行系统命令、安装恶意软件等。

根据搜索结果中的一些文章，该漏洞已被用于传播加密货币矿工、GandCrab 勒索软件和 AESDDoS 僵尸网络恶意软件。

**项目地址:** [tno01/cve-2019-3396](https://github.com/tno01/cve-2019-3396)

**漏洞详情:** [CVE-2019-3396](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)