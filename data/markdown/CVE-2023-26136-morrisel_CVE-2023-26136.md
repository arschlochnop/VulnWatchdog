## CVE-2023-26136-tough-cookie-原型污染

**漏洞编号:** CVE-2023-26136

**漏洞类型:** 原型污染

**影响应用:** tough-cookie

**危害等级:** 中危，可能导致应用配置被篡改，甚至远程代码执行，取决于应用如何使用受污染的原型

**影响版本:** < 4.1.3

**利用条件:** 需要在使用 tough-cookie 的应用中，CookieJar 的 rejectPublicSuffixes 设置为 false

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-26136 是 tough-cookie 包版本低于 4.1.3 的原型污染漏洞。当 CookieJar 的 rejectPublicSuffixes 设置为 false 时，由于不正确地处理 Cookie，导致原型污染。漏洞出现在对象的初始化方式上。

**有效性：**
提供的 POC 代码通过修改 `memstore.js` 文件，将 `this.idx = {};` 替换为 `this.idx = Object.create(null);` 来修复该漏洞。原始版本在特定配置下确实存在原型污染的风险，而修改后的版本避免了从 `Object.prototype` 继承属性，从而阻止了原型污染。根据提供的 `index.js` 中的测试脚本显示，原始版本会被成功利用（`EXPLOITED SUCCESSFULLY`），而修复后的版本利用会失败（`EXPLOIT FAILED`），验证了 POC 的有效性。

**投毒风险：**
代码库中可能存在投毒风险。虽然主要的修改是为了修复原型污染漏洞，但是仍然存在一些小的风险。

*   **非必要文件：**`README.md`中存在作者信息,增加了溯源的可能性,降低了攻击者匿名性,正常漏洞仓库中不应存在作者信息.
*   **测试代码：** 测试代码中可能存在后门，或者可能被修改为包含恶意行为。

综合考虑，代码库中存在潜在投毒代码的风险较低，约为10%。

**利用方式：**
1.  **漏洞前提：** 应用使用了受影响版本的 `tough-cookie`，并且 `CookieJar` 的 `rejectPublicSuffixes` 设置为 `false`。
2.  **攻击方式：** 攻击者通过构造包含恶意属性的 Cookie，例如 `__proto__.polluted = 'evil'`，并将其注入到 CookieJar 中。
3.  **漏洞结果：** 由于 `tough-cookie` 在初始化对象时存在缺陷，恶意属性会被添加到 `Object.prototype` 上，从而污染了整个 JavaScript 应用的原型链。攻击者可以通过污染原型链来修改应用的行为，例如修改全局配置、注入恶意代码等。具体危害取决于应用如何使用受污染的原型，严重情况下可能导致远程代码执行。
4.  **修复方式：** 使用 `Object.create(null)` 创建对象，避免从 `Object.prototype` 继承属性。

**项目地址:** [morrisel/CVE-2023-26136](https://github.com/morrisel/CVE-2023-26136)

**漏洞详情:** [CVE-2023-26136](https://nvd.nist.gov/vuln/detail/CVE-2023-26136)