## CVE-2023-38408 - OpenSSH Agent Forwarding RCE

**漏洞编号:** CVE-2023-38408

**漏洞类型:** 远程代码执行

**影响应用:** OpenSSH

**危害等级:** 严重，允许远程攻击者在受害者机器上执行任意代码

**影响版本:** < 9.3p2

**利用条件:** 开启了 SSH agent forwarding 功能，攻击者能够控制服务端，且能写入客户端文件系统。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-38408 是 OpenSSH 中 ssh-agent 的 PKCS#11 功能中的一个漏洞，由于其搜索路径不够安全，导致远程代码执行。如果 agent 被转发到攻击者控制的系统，攻击者可以利用此漏洞。

**有效性：**
根据漏洞信息和搜索引擎结果，该漏洞被认为具有高危风险，存在可利用的 POC 代码，利用成功可以导致远程代码执行。

**投毒风险：**
提供的 POC 代码描述了一个利用场景，涉及 shellcode 注入、信号处理劫持等复杂步骤。直接判定其为恶意投毒存在难度。虽然代码中涉及从攻击者机器向受害者机器传输shellcode并通过`nc`进行连接，但这是漏洞利用过程的必要组成部分，如果不是相关领域的专业人员，可能会误判。`linuxx64.elf.stub`被用于ssh-add -s参数，但其用途尚不清晰，可能被用于特定的利用方式，或者为了绕过检测。`libttcn3-rt2-dynamic.so, libKF5SonnetUi.so.5.92.0 and libns3.35-wave.so.0.0.0`，看起来是为了触发SIGSEGV，可能存在隐藏的恶意操作，或者仅仅是构造crash的手段，风险占5%。

**利用方式：**
1.  攻击者通过 SSH 连接到服务器。
2.  攻击者获得受害者 Alice 在同一服务器上的 SSH agent socket。
3.  攻击者构造 shellcode，通过某种方式（如 netcat）将其注入到受害者 Alice 的 ssh-agent 进程中。
4.  攻击者通过 `ssh-add -s` 添加恶意的 PKCS#11 模块，触发漏洞，劫持 ssh-agent 的执行流程。
5.  利用 shellcode 执行任意命令，例如反弹 shell 或执行其他恶意操作。
6.  最后，通过nc监听端口，获取shell。

**项目地址:** [TX-One/CVE-2023-38408](https://github.com/TX-One/CVE-2023-38408)

**漏洞详情:** [CVE-2023-38408](https://nvd.nist.gov/vuln/detail/CVE-2023-38408)