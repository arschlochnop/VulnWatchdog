## CVE-2023-34362-MOVEit Transfer-SQL注入

**漏洞编号:** CVE-2023-34362

**漏洞类型:** SQL注入

**影响应用:** MOVEit Transfer

**危害等级:** 高危，可能导致未授权访问数据库，信息泄露，甚至远程代码执行。

**影响版本:** < 2021.0.6 (13.0.6), < 2021.1.4 (13.1.4), < 2022.0.4 (14.0.4), < 2022.1.5 (14.1.5), < 2023.0.1 (15.0.1)

**利用条件:** 需要网络访问 MOVEit Transfer Web 应用。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

该漏洞存在于 MOVEit Transfer Web 应用的 guestaccess.aspx 页面，是一个未经身份验证的 SQL 注入漏洞。攻击者可以通过构造恶意的 SQL 语句注入到 `MyPkgSelfProvisionedRecips` session 变量中，然后触发 `guestaccess.aspx` 的处理逻辑来执行 SQL 语句，从而获取数据库的敏感信息，甚至修改或删除数据库中的数据。POC 代码通过设置特定的 session 变量并发送包含恶意 SQL 语句的请求来利用此漏洞。

**有效性评估：**

*   漏洞库信息和搜索引擎结果表明该漏洞是一个高危且被广泛利用的漏洞。
*   提供的 POC 代码实现了利用该漏洞的步骤，包括获取 CSRF token，设置 session 变量，以及触发 SQL 注入。
*   代码中包含创建 JWT 并获取 access token 的功能，可能用于绕过某些身份验证机制，执行更高级别的操作，例如删除文件。

**投毒风险评估：**

代码主要通过SQL注入利用已知漏洞。`create_jwt`函数依赖`key.pem`和`cert.crt`文件，如果这两个文件本身被替换为恶意文件，可能会导致私钥泄露或权限提升漏洞。代码本身功能比较单一，直接植入后门的可能性较低，投毒的可能性较低。

**利用方式：**

1.  **获取 Session ID:** 向 MOVEit Transfer Web 应用发送请求，获取 `ASP.NET_SessionId` cookie。
2.  **获取 CSRF Token:** 向 `guestaccess.aspx` 发送 POST 请求，获取 CSRF token。
3.  **设置 Session 变量:**  利用 `MOVEitISAPI.dll` 的漏洞，通过设置 `MyPkgSelfProvisionedRecips` session 变量注入恶意 SQL 语句。
4.  **触发 SQL 注入:** 向 `guestaccess.aspx` 发送包含 CSRF token 的 POST 请求，触发 SQL 注入。
5.  **获取 Access Token (可选):** 如果需要执行更高级别的操作，可以使用提供的 JWT 创建功能获取 access token。
6.  **执行恶意操作 (可选):** 使用 access token 执行恶意操作，例如删除文件。

总的来说，这个 POC 的有效性很高，因为它利用了一个已知的、被广泛利用的漏洞。 投毒风险较低，但需要关注 `key.pem`和`cert.crt`文件。

**项目地址:** [errorfiathck/MOVEit-Exploit](https://github.com/errorfiathck/MOVEit-Exploit)

**漏洞详情:** [CVE-2023-34362](https://nvd.nist.gov/vuln/detail/CVE-2023-34362)