## CVE-2019-12840 - Webmin Package Updates 远程命令执行

**漏洞编号:** CVE-2019-12840

**漏洞类型:** 远程命令执行

**影响应用:** Webmin

**危害等级:** 高危，可获取 root 权限

**影响版本:** <= 1.910

**利用条件:** 需要 Webmin 访问权限，以及拥有 Package Updates 模块的权限

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2019-12840 漏洞允许任何被授权访问 Webmin "Package Updates" 模块的用户，通过 `update.cgi` 的 `data` 参数执行任意命令，从而获得 root 权限。

**有效性：**
根据漏洞库信息、搜索结果和漏洞利用代码，此漏洞的 POC 代码有效。漏洞库和搜索引擎结果均表明，该漏洞存在且允许远程命令执行。提供的 POC 代码通过 Node.js 脚本利用该漏洞。

**投毒风险：**
分析提供的 Node.js 脚本，脚本主要功能是：
1.  设置不验证 TLS 证书。
2.  定义目标 Webmin 主机、本地监听主机和端口、用户名和密码。
3.  定义了用于登录和触发漏洞的 URL。
4.  定义了用于发送 HTTP 请求的 `request` 函数，处理 Cookie 和 HTTPS 代理。
5.  `startListener` 函数启动一个 TCP 服务器监听指定端口，用于接收反向 Shell 连接。
6.  `execExploit` 函数负责登录 Webmin 并利用漏洞执行命令。首先构造登录参数并发送 POST 请求进行身份验证。如果登录成功，则构造包含反向 Shell 命令的 Payload，并将其作为 `update.cgi` 的 `data` 参数发送，从而触发命令执行。

脚本尝试建立反向 shell。 虽然反向 shell 本身可以被利用于恶意目的，但提供的代码的明确目的是利用已知的漏洞，而不是引入隐藏的后门或恶意功能。

**风险评估结论：**

代码中存在的微小风险点：
* `process.env.NODE_TLS_REJECT_UNAUTHORIZED = '0';` 禁用 TLS 证书验证在生产环境中是不安全的，可能被中间人攻击利用。但在这里是为了方便漏洞利用，因为目标 Webmin 实例可能使用自签名证书。可以视作正常利用。

* `remoteHost`，`localHost`，`localPort`，`username`，`password` 这些变量允许用户自定义，虽然增加了使用的灵活性，但也存在被滥用的可能。

基于以上分析，此 POC 代码的投毒风险较低，约为 1%。

**利用方式：**
1.  攻击者需要拥有 Webmin 的账号密码，并且该账号拥有 "Package Updates" 模块的权限。
2.  攻击者运行提供的 Node.js 脚本，脚本会自动登录 Webmin，并构造包含反向 Shell 命令的 Payload。
3.  脚本通过向 `update.cgi` 发送 POST 请求，将 Payload 作为 `data` 参数传递，从而触发命令执行。
4.  目标 Webmin 服务器执行 Payload 中的反向 Shell 命令，连接到攻击者指定的 IP 地址和端口，从而建立反向 Shell 连接。
5.  攻击者通过反向 Shell 获得目标服务器的 root 权限。

**项目地址:** [fenix0499/CVE-2019-12840-NodeJs-Exploit](https://github.com/fenix0499/CVE-2019-12840-NodeJs-Exploit)

**漏洞详情:** [CVE-2019-12840](https://nvd.nist.gov/vuln/detail/CVE-2019-12840)