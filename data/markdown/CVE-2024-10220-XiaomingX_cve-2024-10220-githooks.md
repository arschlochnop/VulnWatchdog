## CVE-2024-10220-Kubernetes-Kubelet-gitRepo任意命令执行

**漏洞编号:** CVE-2024-10220

**漏洞类型:** 任意命令执行

**影响应用:** Kubernetes Kubelet

**危害等级:** 高危，可能导致节点接管

**影响版本:** <=1.28.11, 1.29.0 <= version <= 1.29.6, 1.30.0 <= version <= 1.30.2

**利用条件:** 攻击者需要具有创建Pod和关联gitRepo volume的权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-10220 漏洞允许攻击者通过构造恶意的gitRepo volume在 Kubernetes kubelet 组件上执行任意命令。从搜索结果来看，此漏洞影响多个 Kubernetes 版本。利用方式是，攻击者创建一个包含恶意配置的 gitRepo volume 的 Pod。Kubelet 在拉取 Git 仓库时，如果仓库中存在恶意的 Git hooks 目录，则可能导致 kubelet 在宿主机上执行任意命令，从而绕过容器隔离并获得主机权限。

提供的漏洞利用代码片段只包含了`HEAD`和`LICENSE`文件，它们本身不包含任何恶意代码，因此直接利用提供的代码片段本身无法触发漏洞。但这些文件是git仓库的有效组成部分，攻击者可能利用这些基础文件，配合恶意的git hooks达到攻击目的。

**有效性：** 根据漏洞描述和搜索结果，该漏洞是有效的，利用恶意构造的gitRepo Volume可以执行任意命令。

**投毒风险：** 提供的代码片段本身不构成投毒，因为仅仅是Git仓库中的`HEAD`引用和 `LICENSE` 许可协议，不包含任何可执行代码。但如果攻击者将这些文件与恶意的git hooks（例如 post-checkout, post-merge 等）结合，则可能在受害者拉取仓库后执行恶意代码，从而达到投毒的目的。 投毒风险评估为 10%，主要考量在于需要结合恶意 git hooks 才能实现。 这部分风险是由于在利用过程中，需要引入额外的恶意代码到 Git 仓库中，从而使得其他克隆该仓库的用户也受到影响的可能性。虽然提供的代码本身无害，但是作为一个攻击链的一部分，它提高了整体的投毒风险。

**利用方式：**

1.  攻击者需要具有创建 Pod 和关联 gitRepo volume 的权限。
2.  攻击者创建一个包含恶意 Git hooks 的 Git 仓库，例如 `post-checkout`、`post-merge` 等。
3.  攻击者创建一个 Pod，并使用 `gitRepo` volume 指向包含恶意 Git hooks 的仓库。
4.  当 Kubelet 拉取 Git 仓库时，恶意的 Git hooks 会被触发，从而在宿主机上执行任意命令。

**项目地址:** [XiaomingX/cve-2024-10220-githooks](https://github.com/XiaomingX/cve-2024-10220-githooks)

**漏洞详情:** [CVE-2024-10220](https://nvd.nist.gov/vuln/detail/CVE-2024-10220)