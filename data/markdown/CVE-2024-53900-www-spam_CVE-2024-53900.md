## CVE-2024-53900-Mongoose-Search注入

**漏洞编号:** CVE-2024-53900

**漏洞类型:** Search注入/NoSQL注入

**影响应用:** Mongoose

**危害等级:** 高危，可能导致数据泄露和未经授权的数据访问

**影响版本:** < 8.8.3

**利用条件:** 应用程序使用Mongoose并且使用了$where操作符进行查询

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-53900是Mongoose在处理`$where`操作符时存在的问题，可能导致Search注入。攻击者可以通过构造恶意的`$where`查询语句，绕过安全限制，从而访问或修改数据库中的敏感数据。根据漏洞库信息和搜索引擎结果，此漏洞的CVSS评分较高，表明其具有较高的风险。

**漏洞利用有效性：**

提供的PoC代码旨在利用CVE-2024-53900。它包含一个`docker-compose.yml`文件，用于搭建包含存在漏洞的Mongoose应用的Docker环境。`exploit.py`脚本尝试动态发现API路径，并生成MongoDB ObjectId，然后利用`$where`进行注入尝试。因此，PoC代码看起来是有效的。

**投毒风险：**

虽然PoC的主要功能是验证漏洞，但仍需关注潜在的投毒风险。

*   `docker-compose.yml` 文件：检查镜像来源是否可信，`mongo:6` 是否包含已知后门。在本例中，`mongo:6` 是官方镜像，风险较低，但仍然需要保持警惕。
*   `exploit.py` 文件：虽然代码的主要目的是漏洞利用，但是需要检查是否存在恶意代码片段，例如反向shell、数据窃取等。目前提供的代码看起来主要是用于发现API端点和生成payload，风险相对较低。

综合考虑，由于PoC代码的主要目的是漏洞验证，且代码结构相对简单，恶意代码的隐藏空间有限，因此，投毒风险较低，估计在10%左右。

**漏洞利用方式：**

1.  **环境搭建：** 使用`docker-compose.yml`搭建包含存在漏洞的Mongoose应用的Docker环境，包括MongoDB数据库和Mongoose应用。
2.  **路径发现：** `exploit.py`首先尝试动态发现目标应用的API路径。通过发送HTTP请求并解析响应，查找潜在的API端点。
3.  **ObjectId生成：** 脚本会生成有效的MongoDB ObjectId，用于构造payload。
4.  **注入尝试：** 利用发现的API路径和ObjectId，构造包含恶意`$where`操作符的查询语句，发送到目标应用。
5.  **验证：** 通过观察响应，判断漏洞是否成功利用。如果成功，攻击者可能能够执行任意JavaScript代码，进而访问或修改数据库中的数据。

**项目地址:** [www-spam/CVE-2024-53900](https://github.com/www-spam/CVE-2024-53900)

**漏洞详情:** [CVE-2024-53900](https://nvd.nist.gov/vuln/detail/CVE-2024-53900)