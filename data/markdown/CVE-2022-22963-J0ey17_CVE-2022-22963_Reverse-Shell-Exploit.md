## CVE-2022-22963-Spring Cloud Function-远程代码执行

**漏洞编号:** CVE-2022-22963

**漏洞类型:** 远程代码执行

**影响应用:** Spring Cloud Function

**危害等级:** 高危，可导致服务器被完全控制

**影响版本:** Spring Cloud Function 3.1.6, 3.2.2 and older unsupported versions

**利用条件:** 目标系统使用Spring Cloud Function且开启了路由功能，允许用户提供的SpEL表达式作为路由规则。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-22963 是 Spring Cloud Function 中的一个远程代码执行漏洞。当使用了路由功能时，攻击者可以通过构造恶意的 SpEL 表达式作为路由规则，从而在服务器上执行任意代码。

**有效性：**
根据漏洞库信息、搜索引擎结果以及提供的漏洞利用代码，可以判定该漏洞利用代码是有效的。搜索引擎结果显示该漏洞是可被利用的，并且无需身份验证即可远程利用。提供的Python脚本尝试通过 `functionRouter` 端点注入恶意SpEL表达式来执行命令。

**投毒风险：**
分析漏洞利用代码，主要功能是发送包含恶意SpEL表达式的POST请求到 `/functionRouter` 端点，并使用 `java.lang.Runtime.getRuntime().exec()` 执行命令。代码中没有发现明显的投毒代码。脚本首先会测试目标是否易受攻击，然后在得到用户确认后才会尝试获取反向Shell。创建监听线程的部分是预期行为，用于接收反向shell。base64编码是为了绕过某些字符过滤。
因此，投毒风险评估为 0%。

**利用方式：**
1.  攻击者首先需要确定目标系统是否运行着受影响版本的 Spring Cloud Function，并且使用了路由功能。
2.  攻击者构造一个包含恶意 SpEL 表达式的 HTTP POST 请求，该表达式会执行攻击者想要执行的命令。
3.  将该请求发送到 `/functionRouter` 端点。
4.  Spring Cloud Function 将会解析 SpEL 表达式，并在服务器上执行该表达式，从而导致远程代码执行。
5.  该POC提供反向shell，在目标服务器上执行反向shell的bash命令。

**项目地址:** [J0ey17/CVE-2022-22963_Reverse-Shell-Exploit](https://github.com/J0ey17/CVE-2022-22963_Reverse-Shell-Exploit)

**漏洞详情:** [CVE-2022-22963](https://nvd.nist.gov/vuln/detail/CVE-2022-22963)