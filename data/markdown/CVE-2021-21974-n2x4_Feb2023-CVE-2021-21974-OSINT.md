## CVE-2021-21974 - VMware ESXi OpenSLP 堆溢出

**漏洞编号:** CVE-2021-21974

**漏洞类型:** 堆溢出

**影响应用:** VMware ESXi

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** ESXi 7.0 before ESXi70U1c-17325551, 6.7 before ESXi670-202102401-SG, 6.5 before ESXi650-202102101-SG, VMware Cloud Foundation 4.x before 4.2 and 3.x

**利用条件:** 攻击者需要与ESXi主机处于同一网络段，并且能够访问427端口。

**POC 可用性:** 是

**投毒风险:** 95%

## 详情

CVE-2021-21974 存在于 VMware ESXi 的 OpenSLP 服务中，是一个堆溢出漏洞。攻击者通过向 ESXi 主机的 427 端口发送特制的 SLP 请求，触发 OpenSLP 服务的堆溢出，最终实现远程代码执行。

**有效性：**
从搜索结果来看，该漏洞已被广泛研究，并且存在公开的PoC。诸多安全厂商的报告显示，该漏洞被ESXiArgs 勒索软件利用，影响较大。Rapid7 等机构确认存在大量未修补的 ESXi 服务器，证明漏洞的利用是有效的。

**投毒风险：**
提供的“漏洞利用代码”实为一个名为`ESXResults.csv`的CSV文件，其中包含大量Bitcoin地址和对应的比特币数量以及一个TOXID。该文件很可能并非真正的漏洞利用代码，而是一个被伪装成PoC的恶意文件，目的是收集潜在受害者的信息（例如，关联受感染服务器和特定比特币地址），或者用于其他恶意目的，例如钓鱼攻击。因此，该文件存在极高的投毒风险。

**利用方式：**
根据漏洞信息，利用方式为：
1.  攻击者与目标 ESXi 主机处于同一网络段。
2.  攻击者能够访问 ESXi 主机的 427 端口（OpenSLP 服务端口）。
3.  攻击者构造恶意的 SLP 请求，发送到 ESXi 主机的 427 端口。
4.  OpenSLP 服务处理恶意请求时，发生堆溢出。
5.  攻击者利用堆溢出，执行任意代码，控制 ESXi 主机。

尽管实际的漏洞利用代码未提供，但从漏洞描述和搜索结果可以推断，该漏洞利用的重点在于构造特定的 SLP 请求，以触发 OpenSLP 服务的堆溢出。目前已经有公开的PoC，可用于生成有效的攻击载荷。

**项目地址:** [n2x4/Feb2023-CVE-2021-21974-OSINT](https://github.com/n2x4/Feb2023-CVE-2021-21974-OSINT)

**漏洞详情:** [CVE-2021-21974](https://nvd.nist.gov/vuln/detail/CVE-2021-21974)