## CVE-2024-27876

**漏洞编号:** CVE-2024-27876

**漏洞类型:** 竞争条件导致任意文件写入

**影响应用:** macOS, iOS, iPadOS, visionOS

**危害等级:** 高危，可能导致任意代码执行

**影响版本:** macOS Ventura < 13.7, macOS Sonoma < 14.7, macOS Sequoia < 15, iOS/iPadOS < 17.7, iOS/iPadOS < 18, visionOS < 2

**利用条件:** 需要用户解压恶意构造的压缩包

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-27876 是一个存在于多个 Apple 操作系统中的竞争条件漏洞。攻击者可以利用此漏洞，通过恶意构造的压缩包，在目标系统上写入任意文件。由于这是一个竞争条件漏洞，利用成功的概率可能不高，并且需要用户交互（解压恶意压缩包）。

**漏洞利用有效性：**

根据漏洞信息和提供的POC代码，该漏洞利用是有效的。POC代码提供了一个用于生成恶意压缩包的工具，该压缩包可以触发漏洞。

**投毒风险：**

分析POC代码，发现其主要功能是生成包含特定文件和目录结构的恶意压缩包，以触发 AppleArchive 库中的竞争条件。代码中未发现明显的恶意代码或后门。但是，由于代码的目的是利用漏洞，因此存在被用于恶意目的的风险。例如，攻击者可以利用该工具生成包含恶意payload的压缩包，诱骗用户解压，从而在目标系统上执行恶意代码。代码作者在LICENSE文件中声明了免责声明，表明不对任何损害负责。虽然代码本身没有发现投毒，但由于其目的的特殊性，仍然存在一定的投毒风险，估计在10%左右。

**利用方式：**

1.  攻击者使用提供的POC代码，生成恶意构造的压缩包（.aar文件）。
2.  攻击者诱骗目标用户下载并解压该恶意压缩包。
3.  当目标系统使用存在漏洞的 AppleArchive 库解压该压缩包时，会触发竞争条件漏洞。
4.  攻击者利用该漏洞，在目标系统上写入任意文件，例如覆盖系统文件或添加恶意可执行文件。
5.  写入任意文件后，攻击者可以进一步利用这些文件来执行恶意代码或获取系统控制权。

代码通过 `libAppleArchive-ExploitMaker/main.c`  中的 `create_entry_dir` 和 `create_entry_subdir` 函数创建目录结构，可能是为了在特定位置写入文件，从而实现攻击目的。

**项目地址:** [0xilis/CVE-2024-27876](https://github.com/0xilis/CVE-2024-27876)

**漏洞详情:** [CVE-2024-27876](https://nvd.nist.gov/vuln/detail/CVE-2024-27876)