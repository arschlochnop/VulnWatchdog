## CVE-2023-33246-Apache RocketMQ-远程代码执行

**漏洞编号:** CVE-2023-33246

**漏洞类型:** 远程代码执行

**影响应用:** Apache RocketMQ

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** <= 5.1.0

**利用条件:** RocketMQ的NameServer、Broker或Controller组件暴露在公网，且未进行权限验证

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-33246 是 Apache RocketMQ 中的一个远程代码执行漏洞。由于 RocketMQ 的多个组件（NameServer、Broker 和 Controller）可能暴露在公网上且缺乏适当的权限验证，攻击者可以通过以下两种方式利用此漏洞：

1.  **更新配置功能：** 攻击者可以利用更新配置功能，通过发送恶意配置来执行任意命令，命令以 RocketMQ 运行用户的身份执行。
2.  **伪造 RocketMQ 协议内容：** 攻击者可以构造恶意的 RocketMQ 协议内容，达到执行命令的目的。

提供的漏洞利用代码是一个环境搭建的说明文档，引用了其他利用代码仓库。代码本身没有包含直接的漏洞利用payload，但给出了搭建漏洞环境的方法，参考链接包含着漏洞利用代码，因此可以判断该漏洞的POC是有效的。

**投毒风险分析：**

此仓库主要提供了环境搭建和参考链接，本身不包含直接的攻击代码，但间接引导用户使用参考链接中的POC。 如果参考链接的POC被植入恶意代码(例如反弹shell到恶意IP)，则存在投毒风险。由于无法直接评估参考链接的安全性，这里给出一个相对保守的估计，投毒风险的可能性为 10%。 这个风险主要来自于用户下载和使用来自不可信来源的POC。

**漏洞利用方式总结：**

1.  **漏洞定位：** 确定目标系统运行着受影响版本的 Apache RocketMQ，并且相关组件暴露在公网上。
2.  **攻击向量选择：** 选择利用更新配置功能或伪造 RocketMQ 协议内容这两种方式之一。
3.  **构造 Payload：** 构造包含恶意命令的 Payload。例如，如果利用更新配置功能，则需要构造能够执行任意命令的配置信息。如果伪造 RocketMQ 协议，则需要构造符合 RocketMQ 协议格式的恶意数据。
4.  **发送 Payload：** 将构造好的 Payload 发送到目标系统的 RocketMQ 组件。
5.  **执行命令：** 目标系统执行 Payload 中的命令，攻击者从而获得对系统的控制。

搜索引擎结果表明该漏洞已被广泛关注，并存在被利用的风险。CISA 也将此漏洞添加到已知被利用漏洞目录中，表明该漏洞具有较高的实际危害。

**项目地址:** [4mazing/CVE-2023-33246-Copy](https://github.com/4mazing/CVE-2023-33246-Copy)

**漏洞详情:** [CVE-2023-33246](https://nvd.nist.gov/vuln/detail/CVE-2023-33246)