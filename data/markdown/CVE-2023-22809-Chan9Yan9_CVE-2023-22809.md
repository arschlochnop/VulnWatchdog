## CVE-2023-22809-sudoedit权限提升

**漏洞编号:** CVE-2023-22809

**漏洞类型:** 权限提升

**影响应用:** sudo

**危害等级:** 高危，允许低权限用户提升到root权限

**影响版本:** 1.8.0 - 1.9.12p1

**利用条件:** 用户需要具有sudoedit权限，可以编辑至少一个文件。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-22809漏洞存在于sudo的sudoedit功能中。该漏洞是由于sudoedit在处理用户提供的环境变量(SUDO_EDITOR, VISUAL, EDITOR)中的额外参数时存在缺陷，允许本地攻击者通过在环境变量中注入包含“--”的恶意参数，将任意文件添加到待编辑的文件列表中，从而绕过sudoers策略，编辑本无权编辑的文件，最终提升权限。

**有效性:** 根据漏洞库信息、搜索引擎结果和漏洞利用代码，该漏洞的POC代码是有效的。漏洞利用代码中的exp_passwd.sh脚本通过修改/etc/passwd文件将root用户的权限赋予当前用户，exp_sudoers.sh脚本通过修改/etc/sudoers文件，允许当前用户无密码执行sudo命令，从而实现权限提升。

**投毒风险:** 漏洞利用代码中存在一定的投毒风险，风险评估为10%。

*   **exp_passwd.sh:** 该脚本直接修改/etc/passwd文件，将root的用户名替换为当前用户名。如果攻击者恶意修改该脚本，可能会导致系统账户出现混乱，甚至导致系统无法启动。虽然脚本的目的是为了权限提升，但是修改passwd是比较敏感的操作，有潜在风险。
*   **exp_sudoers.sh:** 该脚本通过修改/etc/sudoers文件，允许当前用户无密码执行sudo命令。如果攻击者恶意修改该脚本，可能会添加其他用户的sudo权限，或者直接禁用所有用户的sudo权限。

**利用方式:**

1.  **检查sudo版本:** 脚本首先检查当前sudo版本是否在受影响范围内。
2.  **检查sudoedit权限:** 脚本检查当前用户是否具有sudoedit权限，并且可以编辑root拥有的文件。
3.  **修改/etc/passwd (exp_passwd.sh):**  如果条件满足，exp_passwd.sh脚本会提示用户修改/etc/passwd文件，将root的用户名替换为当前用户名，从而获得root权限。 需要手动修改，需要用户干预，存在社工风险
4.  **修改/etc/sudoers (exp_sudoers.sh):** 如果条件满足，exp_sudoers.sh脚本会提示用户修改/etc/sudoers文件，添加一行配置，允许当前用户无密码执行sudo命令，然后切换到root用户，从而获得root权限。 需要手动修改，需要用户干预，存在社工风险

总而言之，该漏洞的利用方式是利用sudoedit的参数处理缺陷，篡改敏感文件（/etc/passwd或/etc/sudoers）来实现权限提升。虽然脚本本身提供了提权的手段，但是修改系统关键配置文件始终存在一定的风险，攻击者可以在此基础上进行恶意投毒。

**项目地址:** [Chan9Yan9/CVE-2023-22809](https://github.com/Chan9Yan9/CVE-2023-22809)

**漏洞详情:** [CVE-2023-22809](https://nvd.nist.gov/vuln/detail/CVE-2023-22809)