## CVE-2023-27372-SPIP-远程代码执行

**漏洞编号:** CVE-2023-27372

**漏洞类型:** 远程代码执行

**影响应用:** SPIP

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** < 4.2.1

**利用条件:** 需要能够访问SPIP网站的spip_pass页面

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-27372是SPIP内容管理系统中的一个远程代码执行漏洞。该漏洞源于`protege_champ`函数对用户输入的反序列化处理不当，攻击者可以通过构造恶意的序列化数据，并将其作为`oubli`参数传递给`spip.php?page=spip_pass`页面，从而在服务器上执行任意PHP代码。

**有效性分析：**

根据漏洞描述和提供的PoC代码，该漏洞是有效的。PoC代码首先尝试获取CSRF token，然后构造包含恶意PHP代码的序列化payload，最后将其发送到目标服务器。服务器在处理`oubli`参数时，会调用`unserialize`函数，从而触发远程代码执行。

**投毒风险分析：**

PoC代码本身的主要功能是验证漏洞的存在并执行任意命令。PoC中存在执行系统命令的代码，如果使用者不小心，可能会对自己造成危害。仔细阅读代码，发现作者加入恶意代码的可能性较低，但不能完全排除。评估投毒风险为10%。

**利用方式：**

1.  访问目标SPIP网站的`spip.php?page=spip_pass`页面。
2.  获取该页面的CSRF token。
3.  构造包含恶意PHP代码的序列化payload。例如，可以使用`<?php system('whoami'); ?>`来执行`whoami`命令。
4.  将payload作为`oubli`参数，连同CSRF token一起，POST到`spip.php?page=spip_pass`页面。
5.  如果服务器存在漏洞，则会执行payload中的PHP代码，并将结果返回给攻击者。

**缓解措施：**

*   升级SPIP到4.2.1或更高版本。
*   使用提供的patch修复`protege_champ`函数，添加输入验证和过滤。

**项目地址:** [0SPwn/CVE-2023-27372-PoC](https://github.com/0SPwn/CVE-2023-27372-PoC)

**漏洞详情:** [CVE-2023-27372](https://nvd.nist.gov/vuln/detail/CVE-2023-27372)