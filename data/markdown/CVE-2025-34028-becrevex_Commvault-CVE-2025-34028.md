## CVE-2025-34028-Commvault-RCE

**漏洞编号:** CVE-2025-34028

**漏洞类型:** 远程代码执行

**影响应用:** Commvault Command Center Innovation Release

**危害等级:** 高危，未授权远程代码执行

**影响版本:** 11.38

**利用条件:** 目标系统运行Commvault Command Center Innovation Release 11.38，并且可通过网络访问。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞是一个未经身份验证的路径遍历漏洞，允许攻击者上传包含恶意代码的ZIP文件。服务器在解压ZIP文件时，由于路径遍历，会将恶意文件释放到任意位置，最终导致远程代码执行。

**有效性分析：**

根据漏洞库信息、搜索引擎结果和提供的Nmap脚本来看，此漏洞利用是有效的。多个来源都表明该漏洞允许未经身份验证的远程代码执行，并且已经有公开的PoC代码。

Nmap脚本的工作原理如下：

1.  **检测目标是否为Commvault：** 通过访问`/commandcenter/deployServiceCommcell.do`路径，检查响应内容是否包含特定字符串`</cv:cvMessages>`，以此来判断目标是否运行Commvault。
2.  **构造恶意ZIP文件：** 脚本使用base64编码的ZIP文件，解密后包含一个JSP shell。
3.  **上传ZIP文件：** 脚本利用路径遍历漏洞，通过`servicePack`参数将ZIP文件上传到`/Reports/MetricsUpload/<random_dir>/`目录下，其中`<random_dir>`是一个随机生成的目录名。
4.  **触发JSP shell：** 脚本尝试访问上传的JSP shell：`/reports/MetricsUpload/<random_dir>/.tmp/dist-cc/dist-cc/shell.jsp`。
5.  **验证漏洞：** 如果JSP shell成功执行，会返回当前系统用户，脚本通过检查返回内容是否包含`<p>Current User: ([^<]+)</p>`来判断漏洞是否成功利用。

**投毒风险分析：**

在提供的漏洞利用代码中，投毒风险较低，约为10%。主要考量点如下：

*   **Nmap脚本的特性：** Nmap脚本通常用于安全扫描和漏洞验证，其目的是发现漏洞，而不是植入恶意代码。脚本中的代码主要是为了上传和执行JSP shell，以验证漏洞的存在。
*   **JSP shell：** 代码中包含一个base64编码的JSP shell。这个shell的功能非常简单，只是返回当前系统用户。它本身不包含任何恶意代码，但如果被滥用，可能会被攻击者进一步利用。
*   **随机目录名：** 脚本使用随机目录名来上传ZIP文件，这可以降低被其他恶意脚本覆盖的风险。
*   **风险点：** 脚本可能被修改后用于恶意目的。例如，攻击者可能会替换JSP shell，上传更具危害性的代码。但就目前提供的代码而言，风险较低。

**利用方式总结：**

攻击者通过以下步骤利用此漏洞：

1.  发送包含恶意ZIP文件的HTTP POST请求到`/commandcenter/deployServiceCommcell.do`，利用路径遍历漏洞将文件上传到服务器上的任意位置。
2.  服务器解压ZIP文件，并将其中的恶意JSP shell释放到指定目录。
3.  攻击者通过访问JSP shell的URL来执行任意代码。

此漏洞的利用无需身份验证，且危害性极高，可导致服务器完全受控。

**项目地址:** [becrevex/Commvault-CVE-2025-34028](https://github.com/becrevex/Commvault-CVE-2025-34028)

**漏洞详情:** [CVE-2025-34028](https://nvd.nist.gov/vuln/detail/CVE-2025-34028)