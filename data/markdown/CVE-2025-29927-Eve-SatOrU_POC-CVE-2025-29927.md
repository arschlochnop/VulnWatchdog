## CVE-2025-29927-Next.js 中间件授权绕过

**漏洞编号:** CVE-2025-29927

**漏洞类型:** 授权绕过

**影响应用:** Next.js

**危害等级:** 高危，可能导致未授权访问、数据泄露、XSS攻击和缓存投毒

**影响版本:** 11.1.4 <= 版本 <= 13.5.6, > 14.0.0 < 14.2.25, > 15.0.0 < 15.2.3

**利用条件:** 应用程序使用了Next.js中间件进行授权检查

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2025-29927 是 Next.js 中间件中的一个授权绕过漏洞。该漏洞允许攻击者通过操纵 `x-middleware-subrequest` 标头绕过身份验证和授权检查。根据提供的 PoC 代码，攻击者可以使用包含特定 `x-middleware-subrequest` 标头的 HTTP 请求来访问受保护的路由（例如 `/admin`），而无需经过正常的身份验证流程。此外，PoC 还演示了如何利用此漏洞绕过 CSP（内容安全策略）并执行 XSS 攻击，以及进行缓存投毒的 DoS 攻击。

**有效性：** PoC 代码有效。它提供了一个清晰的演示，展示了如何利用 `x-middleware-subrequest` 标头绕过中间件中的授权检查。

**投毒风险：** PoC 代码本身主要是为了演示漏洞的，相对简单。然而，存在轻微的投毒风险。该存储库可能包含一些隐蔽的代码修改，这些修改不是漏洞利用直接需要的，但可能会导致恶意行为。例如，存在更改 `npm run dev` 执行的脚本的可能性，以便在本地环境中引入后门或收集信息。但根据文件内容进行初步判断，投毒风险较低，大约为5%。这部分风险主要是考虑到在克隆和运行第三方代码时总是需要保持警惕，特别是涉及到网络服务。

**利用方式：** 该漏洞主要通过以下方式利用：

1.  **授权绕过：** 攻击者发送包含特定 `x-middleware-subrequest` 标头的 HTTP 请求，绕过中间件中的身份验证和授权检查，从而访问受保护的资源。
2.  **CSP 绕过：**  攻击者利用此漏洞绕过 CSP 策略，从而允许执行恶意脚本，导致 XSS 攻击。
3.  **缓存投毒 DoS：** 攻击者通过发送包含 `x-middleware-subrequest` 标头的请求来强制服务器缓存错误的内容，从而导致缓存投毒攻击，影响正常用户的访问。

**修复建议：**

1.  升级 Next.js 到 >= 14.2.25 或 >= 15.2.3 版本。
2.  在无法升级的情况下，阻止包含 `x-middleware-subrequest` 标头的外部用户请求到达 Next.js 应用程序。
3. 验证中间件逻辑以防止绕过。

**项目地址:** [Eve-SatOrU/POC-CVE-2025-29927](https://github.com/Eve-SatOrU/POC-CVE-2025-29927)

**漏洞详情:** [CVE-2025-29927](https://nvd.nist.gov/vuln/detail/CVE-2025-29927)