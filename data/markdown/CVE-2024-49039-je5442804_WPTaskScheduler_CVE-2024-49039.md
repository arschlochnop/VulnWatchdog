## CVE-2024-49039 - Windows Task Scheduler 权限提升漏洞

**漏洞编号:** CVE-2024-49039

**漏洞类型:** 权限提升

**影响应用:** Windows Task Scheduler

**危害等级:** 高危，允许低权限用户提升至 SYSTEM 权限

**影响版本:** 受影响的Windows版本包括但不限于 Windows 10, Windows 11, Windows Server 2016, Windows Server 2019, Windows Server 2022 和 Windows Server 2025 的特定版本。

**利用条件:** 需要本地用户权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-49039 是一个 Windows Task Scheduler 中的权限提升漏洞。攻击者可以利用此漏洞，通过本地应用获取更高的权限。根据漏洞利用代码 `Readme.md` 描述，该漏洞与 `WPTaskScheduler.dll` 组件相关，该组件是 Win10 1507 之后 Task Scheduler 的一部分。

**有效性评估：**
根据 `Readme.md` 的描述和搜索引擎结果，该漏洞已经被积极利用。提供的POC代码包含了利用该漏洞进行权限提升的代码，包括作为exe编译和作为dll注入两种方式，这说明POC代码可能是有效的。

**投毒风险分析：**
虽然不能完全排除投毒的可能，但基于以下几点，判断投毒风险较低。`Readme.md` 描述了该 POC 的原理和测试方法，并没有隐藏任何可疑代码或行为。代码包括了编译成exe或者编译成dll两种测试思路，并且介绍了Reflective DLL Injection方式。代码整体结构清晰，功能明确，主要是利用Task Scheduler的漏洞，来bypass某些安全机制以达到权限提升目的。

代码中可能存在的风险点在于 Reflective DLL Injection，攻击者可以在注入的 DLL 中执行任意代码，但这属于 Reflective DLL Injection 本身带来的风险，而非该 POC 特有的投毒行为。另外代码里面提到了donut shellcode, 如果在sandbox里使用, 存在风险.

**利用方式：**
1.  **RPC 连接：** 利用 WPTaskScheduler.dll 建立 RPC 连接，绕过 Restricted Token Sandbox 的限制。
2.  **权限提升：** 通过构造特定的 Task Scheduler 任务或配置，利用 WPTaskScheduler.dll 提升进程权限至 Medium Integrity 或更高。
3.  **DLL 注入：** 将编译好的 DLL 注入到目标进程 (如 Chrome 的 gpu-process 或 audio.mojom.AudioService)，执行恶意代码。
4.  **Persistence:** 利用 WPTaskScheduler.dll的特性，实现持久化。

**缓解措施：**
*   及时安装 Microsoft 提供的安全更新，修复 Task Scheduler 漏洞。
*   限制 Task Scheduler 的访问权限，避免非授权用户创建或修改任务。
*   监控 Task Scheduler 的活动，及时发现异常行为。

**项目地址:** [je5442804/WPTaskScheduler_CVE-2024-49039](https://github.com/je5442804/WPTaskScheduler_CVE-2024-49039)

**漏洞详情:** [CVE-2024-49039](https://nvd.nist.gov/vuln/detail/CVE-2024-49039)