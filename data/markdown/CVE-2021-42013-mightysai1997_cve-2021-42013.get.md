## CVE-2021-42013 - Apache HTTP Server Path Traversal 和远程代码执行

**漏洞编号:** CVE-2021-42013

**漏洞类型:** 路径遍历和远程代码执行

**影响应用:** Apache HTTP Server

**危害等级:** 高危，可能导致文件泄露和远程代码执行

**影响版本:** 2.4.49 和 2.4.50

**利用条件:** 需要目标服务器运行受影响的 Apache HTTP Server 版本，且Alias配置不当并开启了CGI脚本执行。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2021-42013 是 Apache HTTP Server 2.4.49 和 2.4.50 中存在的一个路径遍历和远程代码执行漏洞。该漏洞是 CVE-2021-41773 的不完整修复。

**有效性：**

根据漏洞库信息、搜索引擎结果和提供的漏洞利用代码，此漏洞利用是有效的。漏洞库信息明确指出该漏洞允许攻击者使用路径遍历攻击将 URL 映射到 Alias 指令配置目录之外的文件。搜索引擎结果也证实了该漏洞的存在，并提供了相关的利用信息。

提供的 Dockerfile 和 Python 脚本 `cve-2021-42013.py` 构成了一个可用于验证和利用该漏洞的 POC。Dockerfile 用于构建一个包含易受攻击的 Apache HTTP Server 2.4.50 实例的 Docker 镜像。Python 脚本可以用来检测路径遍历或远程代码执行漏洞。

**投毒风险：**

对 POC 代码进行分析，`cve-2021-42013.py` 脚本本身相对简单，主要功能是发送 HTTP 请求并检查响应。它包含以下功能：

*   **路径遍历 PoC (-pt)：**  尝试利用路径遍历漏洞读取服务器上的文件。
*   **远程代码执行 PoC (-rce)：**  如果服务器启用了 CGI，则尝试执行命令。
*   **批量扫描 (-l)：**  从文件中读取 URL 列表并进行扫描。

潜在的投毒风险点在于：

1.  **依赖项：**  脚本依赖于 `requests` 和 `urllib` 库，理论上可以通过篡改这些库来植入恶意代码，但这种情况的可能性较低。
2.  **CGI 执行：**  远程代码执行依赖于服务器启用 CGI，如果攻击者控制了 CGI 脚本的内容，则可以执行任意代码。但这更多的是漏洞利用本身的风险，而非 POC 代码的投毒。

综合来看，该 POC 代码的投毒风险较低，约为 5%。 主要风险来自CGI环境和脚本本身。没有发现明显的恶意代码。

**利用方式：**

利用该漏洞需要以下步骤：

1.  **确定目标服务器是否运行受影响的 Apache HTTP Server 版本 (2.4.49 或 2.4.50)。**
2.  **检查服务器的 Alias 配置。**  Alias 指令将 URL 映射到文件系统上的特定目录。漏洞利用的关键在于绕过这些 Alias 指令的限制。
3.  **如果服务器启用了 CGI，则可以尝试远程代码执行。**  攻击者可以构造一个包含恶意代码的 CGI 脚本，并通过路径遍历漏洞来执行它。
4.  **如果服务器未启用 CGI，则可以尝试路径遍历漏洞来读取敏感文件。**

攻击者可以使用如下 payload 来进行漏洞测试：

*   **路径遍历：** `/.%2e/.%2e/.%2e/.%2e/.%2e/.%2e/.%2e/etc/passwd`
*   **远程代码执行：**  需要服务器启用 CGI，并构造包含恶意代码的 CGI 脚本。

**项目地址:** [mightysai1997/cve-2021-42013.get](https://github.com/mightysai1997/cve-2021-42013.get)

**漏洞详情:** [CVE-2021-42013](https://nvd.nist.gov/vuln/detail/CVE-2021-42013)