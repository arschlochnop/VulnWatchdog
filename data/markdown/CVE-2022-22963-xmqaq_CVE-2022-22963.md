## CVE-2022-22963 Spring Cloud Function SpEL表达式注入

**漏洞编号:** CVE-2022-22963

**漏洞类型:** 远程代码执行

**影响应用:** Spring Cloud Function

**危害等级:** 高危，可能导致远程代码执行和敏感信息泄露

**影响版本:** Spring Cloud Function versions 3.1.6, 3.2.2 and all old and unsupported versions

**利用条件:** 需要目标应用使用了Spring Cloud Function的路由功能，并且对外暴露了`/functionRouter`端点。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-22963是Spring Cloud Function框架中的一个远程代码执行漏洞。当使用了路由功能时，攻击者可以通过构造恶意的SpEL表达式，通过`spring.cloud.function.routing-expression` header进行注入，从而在目标服务器上执行任意代码。

**漏洞利用方式：**

1.  **检测：** 通过发送带有恶意SpEL表达式的POST请求到`/functionRouter`端点，如果服务器返回500错误并且包含`Internal Server Error`，则可能存在漏洞。
2.  **命令执行：** 利用`T(java.lang.Runtime).getRuntime().exec("command")` SpEL表达式执行任意命令。
3.  **DNSLog验证：** 使用`ping`命令和DNSLog服务验证漏洞。
4.  **反弹Shell：** 构造反弹shell命令，并进行Base64编码，然后通过SpEL表达式执行。

**关于投毒风险的分析：**

提供的Python脚本中，反弹shell的功能需要将shell命令进行Base64编码, 有可能存在将特定IP地址或者恶意代码植入到Base64编码中的风险, 但是整体代码逻辑是为了验证漏洞的存在. 投毒风险较低，初步评估为10%。

**项目地址:** [xmqaq/CVE-2022-22963](https://github.com/xmqaq/CVE-2022-22963)

**漏洞详情:** [CVE-2022-22963](https://nvd.nist.gov/vuln/detail/CVE-2022-22963)