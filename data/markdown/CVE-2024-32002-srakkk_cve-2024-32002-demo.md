## CVE-2024-32002-Git递归克隆远程代码执行

**漏洞编号:** CVE-2024-32002

**漏洞类型:** 远程代码执行

**影响应用:** Git

**危害等级:** 高危，允许未经身份验证的攻击者在受害者机器上执行任意代码

**影响版本:** < 2.39.4, >= 2.40.0 < 2.40.2, = 2.41.0, >= 2.42.0 < 2.42.2, >= 2.43.0 < 2.43.4, = 2.44.0, = 2.45.0

**利用条件:** 目标系统需要使用受影响版本的Git，且需要在大小写不敏感的文件系统（例如macOS的默认设置，Windows）上克隆包含恶意配置的仓库，同时`core.symlinks`配置未显式设置为`false`。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-32002 漏洞允许攻击者通过精心构造包含恶意子模块的 Git 仓库，利用 Git 在大小写不敏感的文件系统上的处理缺陷，将恶意 hook 写入 `.git/` 目录，从而在克隆仓库时执行任意代码。攻击者可以诱骗用户克隆恶意仓库，从而在用户不知情的情况下执行恶意代码。

**有效性分析：**

根据漏洞描述，提供的POC代码旨在演示如何利用此漏洞。通过`git clone --recursive`命令克隆该仓库，如果目标系统满足漏洞触发条件（受影响的Git版本，大小写不敏感的文件系统，未禁用符号链接），则可能触发漏洞，导致恶意代码执行。提供的POC利用方法符合漏洞描述，因此POC**可能有效**。

**投毒风险分析：**

提供的代码片段包括：

*   `/README.md`: 包含克隆仓库的说明。
*   `/docs/README.md`: 简单的文档说明。
*   `/src/example.py`: 一个简单的Python脚本，用于处理数据并打印结果。

初步分析表明，提供的代码本身并没有明显的恶意代码或后门。主要的风险在于该仓库可能包含隐藏的恶意 Git 配置（例如存在于.gitmodules或者.git/hooks中）或者子模块，当使用`git clone --recursive`时被自动执行。

由于无法直接看到.git目录下的文件，因此无法完全排除投毒风险。假设`git clone --recursive` 命令在满足条件下，自动触发恶意hook的可能性比较低，但是仍然存在。因此这里给出了5%的投毒可能性。

**利用方式：**

1.  攻击者创建一个包含恶意子模块的 Git 仓库。
2.  恶意子模块包含一个 hook，该 hook 会在仓库被克隆时执行任意代码。
3.  攻击者诱骗受害者克隆该恶意仓库。
4.  当受害者使用 `git clone --recursive` 命令克隆仓库时，恶意 hook 被执行，从而导致远程代码执行。

要减轻此漏洞的影响，用户应避免克隆来自不受信任来源的仓库，并确保使用的 Git 版本已更新到修复此漏洞的版本。 此外，如果不需要符号链接，可以禁用符号链接支持，通过设置`git config --global core.symlinks false`来缓解风险。

**项目地址:** [srakkk/cve-2024-32002-demo](https://github.com/srakkk/cve-2024-32002-demo)

**漏洞详情:** [CVE-2024-32002](https://nvd.nist.gov/vuln/detail/CVE-2024-32002)