## CVE-2020-17519-Apache Flink-目录遍历

**漏洞编号:** CVE-2020-17519

**漏洞类型:** 目录遍历

**影响应用:** Apache Flink

**危害等级:** 高危，可能导致敏感信息泄露

**影响版本:** 1.11.0 to 1.11.2

**利用条件:** JobManager的REST API暴露在网络中，且JobManager进程对目标文件具有读取权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-17519 存在于 Apache Flink 1.11.0 到 1.11.2 版本中。攻击者可以通过 JobManager 的 REST 接口，利用目录遍历漏洞读取 JobManager 进程可访问的本地文件系统上的任意文件。漏洞利用代码 `CVE-2020-17519.py` 通过构造包含目录遍历字符的 URL 来实现文件读取。例如：`TARGET_URI + cmd`，其中 `cmd` 是经过 URL 编码的文件路径。该 POC 脚本支持单个 URL 测试和批量 URL 测试。 

**有效性：**
根据提供的漏洞库信息、搜索引擎结果和漏洞利用代码，可以判断该漏洞的 POC 代码是有效的。搜索引擎结果中多个链接表明该漏洞已被积极利用，且 CISA 已将其添加到已知被利用的漏洞目录（KEV）。

**投毒风险：**
对提供的 POC 代码进行分析，发现以下潜在风险：

*   **代理设置：** POC 代码中包含 `proxies = {"http":"http://127.0.0.1:8080"}`，如果攻击者诱导用户使用恶意代理，可能会截获用户的请求和响应，造成信息泄露。虽然该代理设置被注释掉了，但可能会被使用者启用。
*   **写入文件：** POC 脚本会在检测到漏洞后将存在漏洞的 URL 写入 `存在漏洞地址.txt` 文件。此行为本身没有直接的投毒风险，但如果脚本被修改为写入恶意内容到其他文件，则可能存在投毒风险。
*   **异常处理：** POC 使用了通用的 `except:` 块，这可能会掩盖一些潜在的错误，使得用户难以发现脚本的异常行为。如果攻击者利用这一点，可能会在脚本中隐藏恶意代码。

综合考虑，该 POC 代码存在一定的投毒风险，但主要集中在潜在的代理劫持和异常处理方面。判断投毒概率为 10%。

**利用方式：**
1.  **确定目标：** 找到运行 Apache Flink 1.11.0 到 1.11.2 版本的 JobManager，且其 REST API 暴露在网络中。
2.  **构造恶意 URL：** 构造包含目录遍历字符的 URL，例如：`http://<target_ip>:<port>/jobmanager/logs/..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252fetc%252fpasswd`。
3.  **发送请求：** 使用 GET 请求发送恶意 URL。
4.  **获取文件内容：** 如果漏洞存在，JobManager 将返回目标文件的内容。

此漏洞的利用前提是JobManager进程需要拥有读取目标文件的权限。攻击者可以利用此漏洞读取敏感配置文件、日志文件等，从而获取敏感信息。

**项目地址:** [QmF0c3UK/CVE-2020-17519](https://github.com/QmF0c3UK/CVE-2020-17519)

**漏洞详情:** [CVE-2020-17519](https://nvd.nist.gov/vuln/detail/CVE-2020-17519)