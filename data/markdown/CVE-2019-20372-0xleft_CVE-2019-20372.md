## CVE-2019-20372-NGINX HTTP Request Smuggling

**漏洞编号:** CVE-2019-20372

**漏洞类型:** HTTP Request Smuggling

**影响应用:** NGINX

**危害等级:** 中危，可能导致未授权访问

**影响版本:** < 1.17.7

**利用条件:** 需要存在负载均衡或者反向代理，且存在特定的 error_page 配置

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-20372 漏洞存在于 NGINX 1.17.7 之前的版本中。当 NGINX 配置了特定的 `error_page` 指令时，允许攻击者进行 HTTP 请求走私。该漏洞允许攻击者在负载均衡器或反向代理的环境下，读取未授权的网页。根据提供的POC代码，利用方式如下：

1.  **漏洞原理：** 该漏洞利用了 Nginx 在处理 `error_page` 指令时，对请求的解析不一致性。具体来说，如果 `error_page` 指令中使用了完整的 URL（例如 `http://localhost/401.html`），则 Nginx 可能会错误地处理后续的请求。
2.  **POC 代码分析：**
    *   `server.sh`：该脚本使用 Docker 构建并运行一个存在漏洞的 Nginx 服务器。
    *   `Dockerfile`：该文件定义了 Nginx 镜像，使用了 Nginx 1.17.6 版本，存在漏洞。
    *   `nginx.conf`：该文件是 Nginx 的配置文件，关键在于 `error_page 401 http://localhost/401.html;` 这一行。它将 401 错误重定向到 `http://localhost/401.html`。
    *   `exploit.py`：该 Python 脚本利用 `pwn` 库发送构造的 HTTP 请求。它发送两个连续的 GET 请求，第一个请求的目标 Host 是 `localhost`，第二个请求的目标 Host 是 `adminhost`。
3.  **利用过程：** 攻击者发送两个 HTTP 请求，第一个请求触发 `error_page`， Nginx 将其重定向到指定的 URL。由于 Nginx 对请求处理的缺陷，会将第二个请求走私到后端服务器（adminhost）。因为 error_page 使用http://url，Nginx 会将第二个请求当作一个全新的请求处理，而忽略了连接中的未处理数据。
4.  **漏洞验证：** 攻击者可以通过发送如 POC 所示的构造的 HTTP 请求，如果能够成功访问 `adminhost` 上的资源（例如获取 flag），则说明漏洞存在。
5.  **投毒风险评估：** 经过对POC代码的分析，没有发现任何明显的恶意代码或后门。该仓库仅包含用于演示和验证漏洞的必要文件。`poison` 的可能性为 0%。 搜索结果显示，该漏洞在多个安全报告和 CVE 数据库中都有记录，进一步佐证了该漏洞的存在性和利用方式。
6.  **有效性评估：** POC代码有效。 该漏洞利用了 Nginx 配置不当导致的请求走私漏洞，如果目标环境满足漏洞触发条件，则可以利用该漏洞。

**项目地址:** [0xleft/CVE-2019-20372](https://github.com/0xleft/CVE-2019-20372)

**漏洞详情:** [CVE-2019-20372](https://nvd.nist.gov/vuln/detail/CVE-2019-20372)