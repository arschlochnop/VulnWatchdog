## CVE-2024-43425-Moodle-RCE

**漏洞编号:** CVE-2024-43425

**漏洞类型:** 远程代码执行

**影响应用:** Moodle

**危害等级:** 高危，允许攻击者在服务器上执行任意命令

**影响版本:** Moodle 4.1 to 4.1.11, 4.2 to 4.2.8, 4.3 to 4.3.5, 4.4 to 4.4.1

**利用条件:** 需要有效的Moodle账户，并且该账户需要拥有添加/更新问题的权限。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于Moodle的计算题型中，攻击者可以通过利用不安全的题库编辑功能，构造恶意数据，实现在服务器上执行任意代码。利用方式如下：

1.  **获取登录Token：** 首先通过GET请求登录页面`/login/index.php`，从响应中提取`logintoken`。
2.  **登录Moodle：** 使用提取的`logintoken`，以及用户名和密码，通过POST请求`/login/index.php`进行登录。
3.  **获取Sesskey：** 登录成功后，通过GET请求`/my/courses.php`，提取`sesskey`。
4.  **获取Course ID：** 使用`sesskey`，通过POST请求`/lib/ajax/service.php`获取课程ID。
5.  **创建恶意问题：**  构造包含恶意代码的题目，通过POST请求`/question/bank/editquestion/question.php`创建。
6.  **触发执行：**  当Moodle处理该题目时，恶意代码将被执行，从而实现远程代码执行。

**关于投毒风险：**

虽然该POC代码可以利用，但代码中存在一定的投毒风险。主要体现在以下几个方面：
*   **依赖安装风险**：`requirements.txt` 文件中可能包含恶意依赖包，这些包在安装后可能执行恶意代码。但就当前提供的代码来看，该风险较低，因为利用的是Moodle自身的漏洞。
*   **代码执行风险**：`exploit.py`脚本本身可能存在漏洞，允许攻击者通过修改脚本的参数或逻辑来执行恶意操作，例如删除文件或修改数据库信息，该风险较低。
总体而言，投毒风险较低，但使用者仍然需要对代码进行审查和验证，确保其安全性。

**项目地址:** [aayush256-sys/Moodle-authenticated-RCE](https://github.com/aayush256-sys/Moodle-authenticated-RCE)

**漏洞详情:** [CVE-2024-43425](https://nvd.nist.gov/vuln/detail/CVE-2024-43425)