## CVE-2019-9193-PostgreSQL-RCE

**漏洞编号:** CVE-2019-9193

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** PostgreSQL

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** 9.3 through 11.2

**利用条件:** 需要具有PostgreSQL数据库的Superuser权限或属于pg_execute_server_program组的用户

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-9193 允许拥有足够权限的 PostgreSQL 用户利用 `COPY TO/FROM PROGRAM` 功能执行任意操作系统命令。

**有效性：**
提供的 Python 脚本 `portgres_rce.py` 利用了 `COPY FROM PROGRAM` 命令来执行反向 shell。该脚本会创建一个 TCP 服务器，并在目标系统上执行 Perl 脚本，该脚本尝试连接到攻击者的监听端口，从而建立反向 shell 连接。根据漏洞描述和搜索结果，该方法是有效的。

**投毒风险：**
检查 `portgres_rce.py` 脚本后，未发现任何明显的恶意代码或投毒行为。脚本的目的是利用已知的漏洞，而不是植入后门或执行其他未经授权的操作。脚本逻辑较为清晰，主要功能是建立反向 shell。脚本中没有发现额外的网络连接、文件操作或任何可疑的行为。因此，投毒风险较低，接近0%。`README.md` 只是漏洞说明，没有可疑内容。

**利用方式：**
1.  攻击者需要具有 PostgreSQL 数据库的 Superuser 权限或属于 `pg_execute_server_program` 组的用户。
2.  攻击者运行 `portgres_rce.py` 脚本，提供目标 PostgreSQL 服务器的 IP 地址和端口，以及攻击者监听反向 shell 的 IP 地址和端口。
3.  脚本使用 `psycopg2` 库连接到目标数据库。
4.  脚本执行一系列 SQL 命令：
    *   删除名为 `RCE_BASE` 的表（如果存在）。
    *   创建名为 `RCE_BASE` 的表。
    *   使用 `COPY RCE_BASE FROM PROGRAM` 命令执行 Perl 脚本。该 Perl 脚本会尝试连接到攻击者指定的 IP 地址和端口。
    *   再次删除 `RCE_BASE` 表。
5.  Perl 脚本成功连接后，攻击者可以在其监听端口上接收反向 shell，从而在目标系统上执行任意命令。搜索结果表明，这个漏洞在多个版本的 PostgreSQL 中存在，并且有公开的利用代码。

综上所述，该漏洞利用有效，且提供的 POC 代码未发现明显的投毒风险。

**项目地址:** [wkjung0624/cve-2019-9193](https://github.com/wkjung0624/cve-2019-9193)

**漏洞详情:** [CVE-2019-9193](https://nvd.nist.gov/vuln/detail/CVE-2019-9193)