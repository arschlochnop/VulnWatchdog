## CVE-2024-4577-PHP-CGI Argument Injection

**漏洞编号:** CVE-2024-4577

**漏洞类型:** OS Command Injection

**影响应用:** PHP

**危害等级:** Critical，可能导致远程代码执行

**影响版本:** PHP 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8 (Windows, CGI mode, specific code page settings)

**利用条件:** Windows系统，以CGI模式运行的PHP，并且系统启用了使用"Best Fit"策略的代码页。

**POC 可用性:** 是

**投毒风险:** 99%

## 详情

CVE-2024-4577是一个PHP-CGI中的参数注入漏洞，当PHP在Windows上以CGI模式运行时，如果系统配置为使用特定的代码页，Windows可能会使用“Best-Fit”行为来替换命令行中的字符。PHP CGI模块可能会将这些字符错误地解释为PHP选项，从而允许恶意用户将选项传递给正在运行的PHP二进制文件，从而泄露脚本源代码，在服务器上运行任意PHP代码等。

**漏洞利用方式：**

攻击者可以通过构造特殊的URL，向PHP-CGI传递恶意参数。这些参数会被PHP解析并执行，从而导致远程代码执行。

提供的Go代码是一个漏洞扫描器，它尝试利用CVE-2024-4577漏洞。该代码通过向目标URL发送包含恶意payload的POST请求，以此验证目标是否容易受到攻击。Payload `<?php phpinfo(); ?>` 用于检查服务器是否执行了PHP代码，如果响应包含“PHP Version”，则认为该站点容易受到攻击。

**投毒风险分析：**

提供的代码中发现了明显的投毒行为。

1.  **可疑的变量和函数名：** 代码包含例如`fjButtonKdiC`和`ykupeFR`, `LoqqYHAv`, `oTHs`等命名不规范和意义不明的变量和函数,增加了代码的混淆程度。
2.  **执行shell命令：** `fjButtonKdiC`函数构造了一个wget命令，从`monsoletter.icu`下载shell脚本并使用`bash`执行。这是一个典型的后门行为，允许攻击者在受害者机器上执行任意命令。
3. **cmd命令：** 代码后面使用了cmd命令
4.  **初始化的代码：** 在main函数执行之前就调用了可疑函数,这意味着只要执行漏洞验证的代码,后门就会被执行
综上所述，该代码具有极高的投毒风险，不应在任何生产环境中使用。它会下载并执行来自未知来源的恶意脚本，危及系统安全。

**项目地址:** [shockingbonu/CVE-2024-4577-PHP-RCE](https://github.com/shockingbonu/CVE-2024-4577-PHP-RCE)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)