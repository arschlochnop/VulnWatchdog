## CVE-2024-2961-glibc-iconv缓冲区溢出

**漏洞编号:** CVE-2024-2961

**漏洞类型:** 缓冲区溢出

**影响应用:** glibc

**危害等级:** 高危，可能导致拒绝服务、信息泄露或远程代码执行

**影响版本:** < 2.40

**利用条件:** 需要目标系统使用受影响的glibc版本，且应用程序调用了iconv()函数，并转换到ISO-2022-CN-EXT字符集。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-2961 是 glibc iconv() 函数中的一个缓冲区溢出漏洞。该漏洞存在于glibc 2.39及更早版本中，当使用 iconv() 函数将字符串转换为 ISO-2022-CN-EXT 字符集时，可能导致输出缓冲区溢出，最多溢出 4 个字节。这可能导致应用程序崩溃或覆盖相邻变量，进而可能被利用执行任意代码。

**有效性分析：**

根据漏洞库信息和搜索引擎结果，该漏洞是真实存在的，并且存在可利用的POC。提供的POC代码是一个名为`blind-cnext-exploit.py`的Python脚本，它利用了该漏洞实现了在PHP环境下的盲文件读取和远程代码执行。`README.md`文件提供了更详细的漏洞信息和利用方法的说明。

**投毒风险分析：**

分析`blind-cnext-exploit.py`的内容。代码结构相对复杂，涉及PHP filter chain的利用，但整体框架和逻辑比较清晰。主要的风险点在于`Remote`类，它负责与目标服务器交互并发送payload，如果`Remote`类中的代码被修改为恶意代码，例如在成功利用后执行额外的恶意操作，则存在投毒风险。但是，在对提供的代码进行分析后，并未发现明显的恶意行为。

`requirements.txt`文件需要安装的依赖库也需要进行检查，是否存在引入恶意库的可能。
综合判断，投毒风险较低，大约为10%。主要风险集中在`Remote`类的具体实现和`requirements.txt`依赖库。

**利用方式：**

该漏洞的利用方式如下：

1.  **触发漏洞：**  利用iconv()函数将特定的字符串转换为ISO-2022-CN-EXT字符集，触发缓冲区溢出。
2.  **盲文件读取：**  利用PHP filter chain技术，结合iconv()的漏洞，实现在目标服务器上的盲文件读取。
3.  **信息泄露：**  读取目标服务器上的敏感文件，例如PHP的配置文件、源代码等。
4.  **远程代码执行：**  通过文件读取，获取关键信息，例如libc地址、堆地址等，然后构造特定的payload，覆盖关键数据，最终实现远程代码执行。

提供的POC代码主要针对PHP环境，通过盲文件读取实现RCE。


**项目地址:** [ambionics/cnext-exploits](https://github.com/ambionics/cnext-exploits)

**漏洞详情:** [CVE-2024-2961](https://nvd.nist.gov/vuln/detail/CVE-2024-2961)