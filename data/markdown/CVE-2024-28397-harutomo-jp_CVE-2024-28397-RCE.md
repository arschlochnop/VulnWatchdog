## CVE-2024-28397-js2py-代码注入

**漏洞编号:** CVE-2024-28397

**漏洞类型:** 代码注入

**影响应用:** js2py

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** <= 0.74

**利用条件:** 目标服务器运行js2py且允许POST请求

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-28397 存在于 js2py v0.74 之前的版本中。该漏洞允许攻击者通过构造恶意的 API 调用，执行任意代码。具体而言，漏洞存在于 `js2py.disable_pyimport()` 组件中，攻击者可以通过此函数获取对 Python 对象的引用，并利用该引用来执行任意 Python 代码，从而绕过沙箱。提供的 POC 代码通过构造包含恶意 JavaScript 代码的 JSON payload，并将其 POST 到目标服务器的指定 endpoint 触发漏洞，从而实现远程代码执行。

**有效性：**
根据漏洞信息和提供的 POC 代码，该漏洞利用的有效性较高。POC 代码利用 JavaScript 构造 Python 代码执行链，绕过 js2py 的沙箱限制，成功执行系统命令。从 github 仓库的标题也可确认 POC 的存在，搜索引擎结果中也有大量关于该漏洞的信息。

**投毒风险：**
分析提供的 POC 代码和 README 文件，没有发现明显的投毒代码。代码逻辑清晰，目的是利用漏洞实现远程代码执行，而非植入恶意后门或执行其他恶意行为。作者只是提供了一个漏洞利用脚本，该仓库中不存在作者隐藏的投毒代码, 投毒风险为 0%。

**利用方式：**
1.  **目标确定：** 确定存在漏洞的 js2py 应用服务器的 IP 地址和 endpoint 路径。
2.  **Payload 构造：** 构造包含恶意 JavaScript 代码的 JSON payload。这段 JavaScript 代码会利用 `js2py.disable_pyimport()` 函数或其它方式获取对 Python 对象的引用，然后利用该引用执行任意 Python 代码。
3.  **发送请求：** 使用 POST 请求将 payload 发送到目标服务器的 endpoint。请求头需要设置 `Content-Type: application/json`。
4.  **执行命令：** 目标服务器上的 js2py 代码会解析 payload 中的 JavaScript 代码并执行，从而执行攻击者预先设定的恶意 Python 代码，实现远程代码执行。
5.  **反弹 Shell (可选)：**  如果需要反弹 shell，可以在 payload 中设置反弹 shell 的命令，并将攻击机的 IP 地址和端口号填入 payload。或者通过 `--cmd` 参数指定要执行的命令。

**项目地址:** [harutomo-jp/CVE-2024-28397-RCE](https://github.com/harutomo-jp/CVE-2024-28397-RCE)

**漏洞详情:** [CVE-2024-28397](https://nvd.nist.gov/vuln/detail/CVE-2024-28397)