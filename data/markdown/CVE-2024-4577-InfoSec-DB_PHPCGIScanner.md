## CVE-2024-4577 PHP-CGI Argument Injection

**漏洞编号:** CVE-2024-4577

**漏洞类型:** 远程代码执行

**影响应用:** PHP

**危害等级:** 高危，可导致远程代码执行和敏感信息泄露

**影响版本:** 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before 8.3.8

**利用条件:** Windows系统，运行于CGI模式，并启用了使用"Best Fit"策略的代码页。需要网络访问。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4577 是一个 PHP-CGI 参数注入漏洞，存在于 Windows 平台上的 PHP CGI 模式。当系统配置为使用某些代码页时，Windows 可能会使用“Best-Fit”策略来替换传递给 Win32 API 函数的命令行中的字符。PHP CGI 模块可能会将这些字符错误地解释为 PHP 选项，从而允许恶意用户将选项传递给正在运行的 PHP 二进制文件，从而泄露脚本的源代码或在服务器上执行任意 PHP 代码。

**有效性：**
根据漏洞信息和搜索结果，此漏洞的利用是有效的。多个来源表明该漏洞已在野外被利用，并且存在公开可用的 PoC 代码。

**投毒风险：**
提供的代码库是一个扫描器，用于检测系统是否容易受到 CVE-2024-4577 攻击。它没有包含漏洞利用代码，因此，直接利用此代码库进行攻击是不可能的。主要代码是检测是否存在漏洞，而非利用漏洞。代码库虽然引入了requests,colorama,pyfiglet等库,但在合理的范围内,没有发现明显的恶意代码或后门,但是考虑到任何依赖引入都存在一定的风险，因此投毒风险评估为10%。

**利用方式：**
该漏洞利用方式如下：
1.  **目标环境：** 目标服务器必须运行在 Windows 操作系统上，并且 PHP 运行在 CGI 模式下。
2.  **代码页配置：** 系统需要配置为使用某种代码页，该代码页使用 "Best Fit" 策略进行字符转换。
3.  **参数注入：** 攻击者通过构造包含特定字符的 URL 或 POST 请求，利用 Windows 的 "Best Fit" 转换特性，将恶意参数注入到 PHP 的命令行中。
4.  **远程代码执行：** 注入的恶意参数被 PHP CGI 模块解析，从而允许攻击者执行任意 PHP 代码或操作系统命令。例如，攻击者可以使用 `-d` 参数来修改 `php.ini` 配置，或者使用 `-r` 参数来直接执行 PHP 代码。

攻击者可以利用此漏洞读取服务器上的敏感文件，修改网站内容，甚至完全控制服务器。

**项目地址:** [InfoSec-DB/PHPCGIScanner](https://github.com/InfoSec-DB/PHPCGIScanner)

**漏洞详情:** [CVE-2024-4577](https://nvd.nist.gov/vuln/detail/CVE-2024-4577)