## CVE-2024-32002 - Git 递归克隆远程代码执行漏洞

**漏洞编号:** CVE-2024-32002

**漏洞类型:** 远程代码执行

**影响应用:** Git

**危害等级:** 严重，可能导致远程代码执行和系统完全控制

**影响版本:** 受影响版本包括 2.45.0, 2.44.0, 2.43.0 < 2.43.4, 2.42.0 < 2.42.2, 2.41.0, 2.40.0 < 2.40.2, < 2.39.4

**利用条件:** 需要目标系统使用受影响的Git版本，且允许递归克隆包含恶意submodule的仓库。利用需要case-insensitive文件系统，且默认开启了symlink(core.symlinks=true)

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-32002是Git中一个严重的安全漏洞，它允许攻击者通过构造恶意的Git仓库，在目标系统上执行任意代码。攻击的核心在于利用了Git处理submodule时的不严谨性，特别是在大小写不敏感的文件系统上。

**漏洞利用方式：**

1.  **恶意仓库构造：** 攻击者创建一个包含submodule的Git仓库。该submodule的URL被精心构造，包含恶意payload。利用`ssh://-oProxyCommand=payload/`格式的URL，使得在submodule初始化时，`ProxyCommand`会被执行，从而达到远程命令执行的效果。
2.  **受害者克隆：** 受害者使用Git克隆该恶意仓库，并使用 `--recurse-submodules` 参数或者配置`git config --global submodule.recurse true`。递归克隆submodules.
3.  **触发漏洞：** 在克隆过程中，Git会尝试初始化submodule。由于submodule的URL包含恶意payload，Git会执行`ProxyCommand`指定的命令，从而在受害者系统上执行攻击者预设的恶意代码。

**有效性：**

根据漏洞库信息、搜索引擎结果（尤其是[webpage 4 begin]到[webpage 6 begin]）和提供的漏洞利用代码，可以确认该漏洞是有效的。多个来源都提供了关于此漏洞的分析、利用方式和缓解措施。POC代码利用Metasploit框架模拟了恶意Git服务器，展示了如何通过构造恶意的submodule URL来执行任意命令。

**投毒风险：**

提供的Metasploit模块本身用于漏洞利用演示，主要功能是搭建一个包含恶意submodule配置的Git仓库。该模块将payload插入到`.gitmodules`文件中，并通过`ProxyCommand`执行。

虽然没有明显的“投毒”代码，但依然存在以下风险：

*   **payload隐蔽性：**攻击者可能在payload中嵌入看似无害但实则具有恶意行为的代码，例如下载执行其他恶意程序、窃取敏感信息等。这种payload可以通过混淆、加密等技术来逃避检测，因此存在一定的投毒风险。

综合评估，投毒风险较低，大约为5%。主要风险在于Payload部分可能包含恶意指令。


**项目地址:** [Basyaact/CVE-2024-32002-PoC_Chinese](https://github.com/Basyaact/CVE-2024-32002-PoC_Chinese)

**漏洞详情:** [CVE-2024-32002](https://nvd.nist.gov/vuln/detail/CVE-2024-32002)