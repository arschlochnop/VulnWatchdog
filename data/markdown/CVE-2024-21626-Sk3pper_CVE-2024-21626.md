## CVE-2024-21626-runc容器逃逸

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可导致完全的容器逃逸，控制宿主机

**影响版本:** < 1.1.12

**利用条件:** 需要用户运行受污染的镜像或者使用runc exec

**POC 可用性:** 是

**投毒风险:** 20%

## 详情

CVE-2024-21626 是 runc 中的一个容器逃逸漏洞，源于文件描述符泄露。攻击者可以利用此漏洞，通过 `runc exec` 创建的新容器进程，使其工作目录位于宿主机文件系统命名空间中，从而访问宿主机文件系统。恶意镜像也可以利用此漏洞，使容器进程通过 `runc run` 获得宿主机文件系统的访问权限。攻击者可以覆盖宿主机上的二进制文件，从而实现完全的容器逃逸。

**有效性：**
根据漏洞库信息和搜索结果，该漏洞已经确认存在，并且有PoC。提供的Dockerfile和README.md描述了利用方式和环境准备，表明该漏洞可以被成功利用。

**投毒风险：**
提供的代码片段主要包含Dockerfile和README.md，用于配置漏洞利用环境，没有明显的恶意代码。风险主要在于：
1.  Dockerfile中的ubuntu镜像可能被替换为包含恶意软件的镜像（低可能性，因为Dockerfile指定了明确的ubuntu版本）。
2.  README.md引导用户安装特定版本的docker和runc，如果用户从不可信的源下载这些软件包，可能会安装被篡改的版本（中等可能性）。
3.  github仓库作者本身存在投毒可能，通过后续提交恶意代码，诱导用户下载，但目前提供的代码没有明显风险。
因此, 综合判断, 投毒风险较低，假设为20%。

**利用方式：**
根据漏洞描述，存在多种利用方式：
1.  **攻击 1（恶意镜像）：** 构建包含恶意payload的镜像，当运行此镜像时，容器进程获得宿主机文件系统的访问权限，执行恶意操作。
2.  **攻击 2（runc exec）：** 使用 `runc exec` 在已存在的容器中执行新进程，由于文件描述符泄露，新进程的工作目录可能位于宿主机，从而访问宿主机文件系统。
3.  **攻击 3a/3b（二进制文件覆盖）：** 利用前两种攻击方式，进一步覆盖宿主机上的二进制文件，实现完全的容器逃逸。提供的代码仓库的描述印证了可以通过 `-w` 参数指定工作目录来利用此漏洞。
Dockerfile中`WORKDIR /proc/self/fd/8` 这行代码，正是利用了文件描述符泄露，尝试将容器的工作目录指向宿主机的文件描述符。

**项目地址:** [Sk3pper/CVE-2024-21626](https://github.com/Sk3pper/CVE-2024-21626)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)