## CVE-2021-41773-Apache HTTP Server-路径遍历

**漏洞编号:** CVE-2021-41773

**漏洞类型:** 路径遍历

**影响应用:** Apache HTTP Server

**危害等级:** 高危，可能导致敏感信息泄露和远程代码执行

**影响版本:** 2.4.49

**利用条件:** 需要目标服务器运行Apache HTTP Server 2.4.49版本，并且配置允许CGI脚本执行

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2021-41773 存在于 Apache HTTP Server 2.4.49 版本中。该漏洞是由于对路径规范化处理的更改存在缺陷导致。攻击者可以利用路径遍历攻击将 URL 映射到 Alias 指令配置目录之外的文件。如果这些目录之外的文件没有受到默认配置 "require all denied" 的保护，则请求可能会成功。如果为这些别名路径启用了 CGI 脚本，则可能允许远程代码执行。

**有效性：**
根据漏洞库信息和搜索结果，该漏洞是真实存在的，并且已被广泛利用。提供的 Dockerfile 和 README.md 文件提供了一个可行的漏洞利用方式。

**利用方式：**
1.  **路径遍历：** 攻击者可以通过构造包含 `..` 或 URL 编码的 `..%2f` 的恶意 URL，绕过服务器的路径检查，访问受限文件。
2.  **CGI 执行：** 如果目标服务器启用了 CGI 脚本执行，攻击者可以通过路径遍历访问 CGI 脚本，并执行任意代码。

**POC 代码分析：**

*   **Dockerfile:** 该 Dockerfile 用于构建一个存在 CVE-2021-41773 漏洞的 Apache HTTP Server 2.4.49 环境。
    *   `FROM httpd:2.4.49`：指定使用 Apache HTTP Server 2.4.49 镜像作为基础镜像。
    *   `RUN sed -i 's/#LoadModule cgi_module/LoadModule cgi_module/' /usr/local/apache2/conf/httpd.conf`：启用 CGI 模块。
    *   `RUN echo ...`：配置 CGI 目录，允许执行 CGI 脚本。
    *   `RUN echo "AllowEncodedSlashes On" >> /usr/local/apache2/conf/httpd.conf`：允许 URL 中包含编码的斜杠，这是利用该漏洞的关键。
    *   `COPY test.cgi /usr/local/apache2/cgi-bin/test.cgi`：复制一个测试 CGI 脚本到 CGI 目录下。
    *   `RUN chmod +x /usr/local/apache2/cgi-bin/test.cgi`：为测试 CGI 脚本添加执行权限。
*   **README.md:** 该文件描述了 CVE-2021-41773 漏洞的细节，以及如何使用 Nmap NSE 脚本检测该漏洞。提供了 Nmap 脚本的架构、payload 设置、HTTP 请求和响应处理、输出格式和错误处理。

**投毒风险：**
提供的 Dockerfile 主要用于搭建漏洞环境以进行验证，风险极低。它本身没有包含恶意代码。
虽然 *test.cgi* 文件内容未知，这里假设 *test.cgi* 为安全的代码，否则投毒的概率会升高。
综合评估投毒风险为 1%。


**项目地址:** [charanvoonna/CVE-2021-41773](https://github.com/charanvoonna/CVE-2021-41773)

**漏洞详情:** [CVE-2021-41773](https://nvd.nist.gov/vuln/detail/CVE-2021-41773)