## CVE-2007-2447-Samba-远程命令注入

**漏洞编号:** CVE-2007-2447

**漏洞类型:** 远程命令注入

**影响应用:** Samba

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 3.0.0 <= Samba <= 3.0.25rc3

**利用条件:** 目标系统运行受影响的Samba版本，并且启用了"username map script" (针对SamrChangePassword函数) 或者攻击者已通过身份验证 (针对远程打印和文件共享管理函数)。需要能够访问SMB端口(445)。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2007-2447是Samba 3.0.0到3.0.25rc3版本中smbd的MS-RPC功能中的一个远程命令注入漏洞。攻击者可以通过shell元字符利用该漏洞执行任意命令。

**漏洞利用方式：**

根据漏洞描述和提供的PoC代码，此漏洞存在两种主要的利用场景:

1.  **SamrChangePassword函数 + "username map script":** 当Samba配置中的`username map script`选项启用时，攻击者可以向`SamrChangePassword`函数传递包含shell元字符的恶意用户名，从而执行任意命令。
2.  **远程打印/文件共享管理函数 (需认证):** 经过身份验证的用户可以利用与远程打印和文件共享管理相关的其他MS-RPC函数，通过注入shell元字符来执行命令。

提供的Python脚本 `smb3.0.20.py` 旨在利用此漏洞。脚本使用 `msfvenom` 生成反向连接的payload，然后将其作为用户名的一部分注入。脚本通过SMB协议连接到目标服务器，并尝试利用漏洞执行payload。

**有效性：**

根据漏洞信息、搜索引擎结果和PoC代码，该漏洞是有效的。PoC代码中包含了生成payload和发送payload的逻辑，如果目标环境满足漏洞利用的条件，则可以成功执行任意命令。

**投毒风险：**

PoC代码的投毒风险较低（约为1%）。`smb3.0.20.py`脚本中的主要逻辑是利用`msfvenom`生成payload，并通过SMB协议发送。Payload本身可能具有恶意功能，但这取决于攻击者如何配置`msfvenom`。`README.md`中仅提供了安装依赖和运行脚本的指导，未发现其他恶意代码。需要注意的是，`msfvenom`本身可能存在风险，如果使用来路不明的msfvenom，则可能存在安全风险。

总的来说，主要风险在于攻击者使用的payload，而不是PoC代码本身。

**项目地址:** [h3x0v3rl0rd/CVE-2007-2447](https://github.com/h3x0v3rl0rd/CVE-2007-2447)

**漏洞详情:** [CVE-2007-2447](https://nvd.nist.gov/vuln/detail/CVE-2007-2447)