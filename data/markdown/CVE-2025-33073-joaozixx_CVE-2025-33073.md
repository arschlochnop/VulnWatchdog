## CVE-2025-33073 Windows SMB Client 提权漏洞

**漏洞编号:** CVE-2025-33073

**漏洞类型:** 权限提升

**影响应用:** Windows SMB Client

**危害等级:** 高危，允许经过身份验证的攻击者通过网络提升权限。

**影响版本:** 受影响的Windows版本（参见CVE描述中的版本范围）

**利用条件:** 攻击者需要位于与目标系统相同的网络中，并拥有有效的域凭据。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2025-33073是一个Windows SMB客户端提权漏洞，允许经过身份验证的攻击者通过不正确的访问控制提升权限。该漏洞利用链包含以下步骤：

1.  **添加恶意DNS记录:** 使用dnstool.py工具，通过提供的用户名和密码，在域控制器的DNS服务器上添加一个恶意的DNS记录。这个记录将攻击者的IP地址与特定的DNS名称（`localhost1UWhRCAAAAAAAAAAAAAAAAAAAAAAAAAAAAwbEAYBAAAA`）关联起来。
2.  **验证DNS记录:** 脚本会等待恶意DNS记录生效，通过`dig`命令进行验证，确保记录已经成功添加到DNS服务器并且可以解析。
3.  **启动NTLM Relay:** 脚本启动`ntlmrelayx`工具，监听传入的NTLM认证请求，并将其转发到目标服务器。可以指定自定义命令，或者使用默认的`secretsdump`来提取目标系统的凭据。可以选择通过xterm启动，或直接在当前终端运行。
4.  **触发PetitPotam强制认证:** 脚本利用`nxc`（`netexec`）工具，通过PetitPotam（`coerce_plus`模块）强制目标服务器向攻击者控制的服务器进行NTLM认证。PetitPotam通过MS-EFSRPC协议触发认证。目标服务器会尝试解析之前添加的恶意DNS记录，并将NTLM认证信息发送到攻击者的`ntlmrelayx`监听器。

整个过程依赖于NTLM中继攻击，以及利用PetitPotam强制目标机器向攻击者控制的服务器进行认证。攻击者利用中继的NTLM认证信息，可以执行任意命令或提取目标系统的敏感信息，从而提升权限。

**有效性：**
根据搜索结果和提供的PoC代码，此PoC利用链看起来是有效的。Synacktiv的博客文章详细分析了此漏洞，并提供了利用此漏洞绕过NTLM反射缓解措施的方法。PoC代码旨在自动化整个攻击链。

**投毒风险：**
PoC代码本身没有明显的投毒代码，但存在以下潜在风险：

*   **依赖项风险：** 该脚本依赖于`dnstool.py`、`impacket-ntlmrelayx`和`nxc`。如果这些依赖项本身被篡改或包含恶意代码，那么使用该脚本也可能受到影响。
*   **滥用风险：** 该脚本提供的功能可以被滥用于未经授权的渗透测试或攻击。脚本作者或未经授权的第三方可能会修改该脚本以包含其他恶意功能，例如植入后门、删除数据等。但从现有代码本身来看，直接植入后门代码的概率较低,大约为10%，因为代码流程比较清晰，主要是调用现有的工具和库。

**利用方式总结：**
该漏洞利用方式的核心是利用NTLM中继攻击，结合恶意DNS记录和PetitPotam强制认证，将目标服务器的NTLM认证信息中继到攻击者控制的服务器，并利用这些信息提升权限。攻击者首先诱使目标服务器向攻击者控制的服务器进行认证，然后利用中继的认证信息执行任意命令或提取敏感信息。

**项目地址:** [joaozixx/CVE-2025-33073](https://github.com/joaozixx/CVE-2025-33073)

**漏洞详情:** [CVE-2025-33073](https://nvd.nist.gov/vuln/detail/CVE-2025-33073)