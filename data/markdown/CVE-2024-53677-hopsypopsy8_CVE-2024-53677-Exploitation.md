## CVE-2024-53677-Apache Struts文件上传RCE

**漏洞编号:** CVE-2024-53677

**漏洞类型:** 远程代码执行（RCE）

**影响应用:** Apache Struts

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** 2.0.0 < version < 6.4.0

**利用条件:** 启用了基于 FileUploadInterceptor 的旧文件上传逻辑，且存在文件上传功能

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-53677 是 Apache Struts 中的一个文件上传漏洞，攻击者可以通过操纵文件上传参数来实现路径遍历，从而上传恶意文件并执行远程代码。

**有效性：**

根据漏洞库信息、搜索结果和提供的漏洞利用代码，该漏洞的POC代码有效。多个来源表明该漏洞已在实际环境中被利用，并且存在公开可用的利用代码。

**投毒风险：**

分析提供的漏洞利用代码（/tmp/6fab2f844aba42ca86705ccc230e42e1/README.md）：

*   该代码描述了一个利用 CVE-2024-53677 的方法，涉及修改文件上传请求，通过 OGNL 表达式注入参数，绕过文件类型限制，并将恶意 JSP payload 附加到上传的文件中。
*   payload部分给出的是引用外部shell.jsp的代码，需要进一步分析shell.jsp本身，因为仅仅看readme.md本身无法确定payload是否安全
*   exploit.py同样是引用外部脚本，需要关注其代码是否包含恶意操作
*   python3 http.server -m 3004 命令用于提供web服务，有被用于恶意文件分发的可能性

综合考虑，该仓库存在一定投毒风险，但考虑到提供的步骤是为了利用漏洞进行渗透测试，恶意行为通常与渗透测试的目标有关。由于需要引用的shell.jsp和python脚本来源未知，不能排除恶意脚本的存在，考虑到脚本存在从外部拉取，存在潜在的风险。所以给出10%的投毒风险评估。

**利用方式：**

1.  **识别攻击向量：** 找到存在文件上传功能的页面。
2.  **版本确认：** 确定目标 Apache Struts 的版本是否在受影响范围内（2.0.0 到 6.4.0 之前）。可以通过查找 `pom.xml` 文件等方式确认。
3.  **修改文件上传请求：** 使用 BurpSuite 等工具截获文件上传请求，添加利用 OGNL 的参数，例如：
    ```
    ...(上传的文件内容).&{#context['com.opensymphony.xwork2.dispatcher.HttpServletRequest'].getSession().setAttribute('rand','freak')}.&{(#context['com.opensymphony.xwork2.dispatcher.HttpServletRequest'].getSession().getValue('rand')).getRuntime().exec('touch /tmp/success')}
    ```
4.  **附加 Payload：** 将 JSP payload 附加到上传的文件数据中，例如使用 webshell 。
5.  **发送请求：** 发送修改后的请求。
6.  **访问 Payload：** 访问上传的 JSP 文件，触发 payload 执行。
7.  **获取 Shell：** 如果 payload 是 webshell，则可以通过 webshell 执行任意命令，例如建立反向 shell。

**项目地址:** [hopsypopsy8/CVE-2024-53677-Exploitation](https://github.com/hopsypopsy8/CVE-2024-53677-Exploitation)

**漏洞详情:** [CVE-2024-53677](https://nvd.nist.gov/vuln/detail/CVE-2024-53677)