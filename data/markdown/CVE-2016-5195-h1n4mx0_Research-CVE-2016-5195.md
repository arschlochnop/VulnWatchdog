## CVE-2016-5195 Dirty COW 本地提权漏洞

**漏洞编号:** CVE-2016-5195

**漏洞类型:** 权限提升

**影响应用:** Linux Kernel

**危害等级:** 高危，可从低权限用户提升到root权限

**影响版本:** Linux kernel 2.x through 4.x before 4.8.3

**利用条件:** 本地用户，目标系统内核版本在受影响范围内

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2016-5195，又名Dirty COW，是Linux内核中存在的一个竞争条件漏洞。该漏洞源于内核在处理写时复制（COW）机制时存在缺陷，允许本地用户利用此漏洞写入只读内存映射，从而获得提升的权限。

**有效性分析：**

根据漏洞信息和搜索结果，该漏洞是真实存在的，并且有公开的PoC代码。该漏洞在野外被广泛利用，因此提供的PoC代码理论上是有效的，只要目标系统满足漏洞利用条件（内核版本未修复）。

**投毒风险分析：**

PoC代码包含两个线程：`writeThread` 和 `madviseThread`。`writeThread` 通过 `/proc/self/mem` 写入内存，`madviseThread` 通过 `madvise` 系统调用来触发竞争条件。代码本身相对简单，主要利用了竞争条件来绕过只读保护。

仔细查看代码，可以发现`/proc/self/mem` 是一个比较危险的文件，使用不当可能导致系统崩溃。虽然提供的代码是利用Dirty COW漏洞，但理论上可以通过修改 `writeThread` 的写入目标或内容，植入恶意代码或破坏系统关键文件。因此，存在一定的投毒风险，风险占比估计为 10%。 风险主要来自于使用者可能不了解代码细节，直接使用时被修改过的恶意代码所利用。

**漏洞利用方式：**

1.  **查找目标文件：** 漏洞利用程序首先需要确定要修改的目标文件，例如 `/etc/passwd` 文件，该文件存储了用户帐户信息。
2.  **内存映射：** 程序使用 `mmap` 系统调用将目标文件映射到内存中，注意是以只读的方式映射。
3.  **竞争条件触发：**  `madviseThread`  线程调用  `madvise`  系统调用，尝试释放内存页，而  `writeThread`  线程则通过  `/proc/self/mem`  尝试写入被映射的内存区域。这两个线程的并发执行，会触发  COW  机制的竞争条件。
4.  **写入只读内存：**  如果竞争条件成功触发，`writeThread`  线程就可以绕过只读保护，将恶意内容写入到被映射的内存区域，从而修改了目标文件。
5.  **权限提升：**  通过修改  `/etc/passwd`  文件，攻击者可以添加一个新的 root  用户，或者修改现有用户的密码，从而获得 root  权限。

**项目地址:** [h1n4mx0/Research-CVE-2016-5195](https://github.com/h1n4mx0/Research-CVE-2016-5195)

**漏洞详情:** [CVE-2016-5195](https://nvd.nist.gov/vuln/detail/CVE-2016-5195)