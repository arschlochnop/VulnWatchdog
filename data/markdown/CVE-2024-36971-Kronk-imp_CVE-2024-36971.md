## CVE-2024-36971-Linux Kernel __dst_negative_advice() UAF

**漏洞编号:** CVE-2024-36971

**漏洞类型:** Use-After-Free (UAF)

**影响应用:** Linux Kernel

**危害等级:** 高危，可能导致提权或拒绝服务

**影响版本:** 4.6 <= Linux Kernel < 4.19.316, 5.4.278, 5.10.219, 5.15.161, 6.1.94, 6.6.34, 6.9.4, 6.10

**利用条件:** 本地权限，触发特定网络条件（UDP sockets）。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-36971 是 Linux 内核中 `__dst_negative_advice()` 函数存在的一个 Use-After-Free 漏洞。该漏洞是由于在清除 `sk->sk_dst_cache` 时没有遵循正确的 RCU 规则，导致可能出现 UAF。正确流程应先清除 `sk->sk_dst_cache`，然后调用 `dst_release(old_dst)`，而 `__dst_negative_advice()` 的顺序错误。POC 代码利用 scapy 构造一个 UDP 包，包含一个偏移，一段 NOP sled，和 INT3 指令用于调试。攻击者可以利用此漏洞，通过精心构造的网络数据包，触发 `__dst_negative_advice()` 函数中的UAF，进而实现提权或拒绝服务。

**有效性：** 提供的POC代码尝试通过发送特制的UDP数据包来触发漏洞。通过构造特定offset的数据，可以覆写某些数据结构，从而触发UAF。

**投毒风险：** 代码本身是一个简单的漏洞利用PoC，主要功能是构造并发送UDP数据包，没有发现任何额外的恶意代码或者后门，因此投毒风险较低。

**利用方式：**
1.  利用此漏洞需要本地权限。
2.  构造恶意的 UDP 包，利用特定的offset和恶意代码。
3.  发送 UDP 包到目标系统，触发 `__dst_negative_advice()` 函数调用。
4.  利用UAF漏洞执行恶意代码，实现提权或者拒绝服务。

**项目地址:** [Kronk-imp/CVE-2024-36971](https://github.com/Kronk-imp/CVE-2024-36971)

**漏洞详情:** [CVE-2024-36971](https://nvd.nist.gov/vuln/detail/CVE-2024-36971)