## CVE-2024-37010 Owncloud 外部存储不安全直接对象引用

**漏洞编号:** CVE-2024-37010

**漏洞类型:** 不安全直接对象引用 (IDOR)

**影响应用:** Owncloud

**危害等级:** 中危，可能导致未授权访问其他用户的外部存储

**影响版本:** 受影响版本未知，但已在安全公告中修复

**利用条件:** 需要有效的Owncloud用户账户

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-37010 是 Owncloud 中的一个 IDOR 漏洞，存在于外部存储管理功能中。攻击者可以利用此漏洞，通过修改存储 ID 来访问其他用户的外部存储，从而可能窃取存储中的敏感信息。该漏洞的利用方式如下：

1.  **漏洞原理：** Owncloud 在处理外部存储时，没有正确验证用户是否有权访问请求的存储 ID。这使得攻击者可以尝试不同的存储 ID，直到找到属于其他用户的存储。
2.  **POC 代码分析：** 提供的 Python 脚本 `CVE-2024-37010.py` 模拟了攻击过程。它首先通过用户名和密码登录 Owncloud 服务器，获取 `requesttoken`。然后，它通过向 `/index.php/apps/files_external/userstorages/{id}` 发送 PUT 请求来修改外部存储的配置。攻击者可以修改`id`参数的值，尝试不同的存储 ID。脚本中将 `backendOptions.host` 设置为攻击者控制的域名 `asazlwwlkfeyxhjcvupstf0cz45dx5hso.oast.fun`，并设置 `testOnly` 为 `True`。这会触发 Owncloud 服务器尝试连接到该域名，并将一些认证信息（例如，会话凭据）发送到攻击者控制的服务器，从而实现信息窃取。`applicableUsers`参数指定可以应用此存储的用户, 可以通过修改这个参数,达到权限提升的目的
3.  **利用方式：**  
    *   攻击者首先需要一个有效的 Owncloud 用户账户。
    *   攻击者使用提供的 POC 脚本，指定 Owncloud 服务器的 URL、用户名和密码。
    *   攻击者可以通过指定单个 `storage_id` 或 `range_id` 来尝试不同的存储 ID。
    *   脚本会尝试修改指定存储 ID 的配置，并将 `backendOptions.host` 设置为攻击者控制的域名。 Owncloud 会尝试连接该域名,可能泄露凭据
4.  **有效性评估：** 该 POC 代码看起来是有效的，因为它能够利用 IDOR 漏洞来修改外部存储的配置，并可能窃取凭据。
5.  **投毒风险评估：**  脚本中存在将`backendOptions.host`设置为攻击者控制的域名的行为，如果攻击者在`stealth=True`的情况下，构造恶意的存储名称`{}:_pwned_storage`可能会导致其他用户点击后触发恶意行为。 此外，如果代码被修改以在生产环境中运行，则可能存在风险，例如在没有 `--testOnly` 参数的情况下执行可能会破坏目标系统的存储配置.投毒风险评估为10%。

**项目地址:** [SarpantKeltiek/CVE-2024-37010](https://github.com/SarpantKeltiek/CVE-2024-37010)

**漏洞详情:** [CVE-2024-37010](https://nvd.nist.gov/vuln/detail/CVE-2024-37010)