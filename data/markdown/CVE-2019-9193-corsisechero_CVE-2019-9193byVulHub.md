## CVE-2019-9193-PostgreSQL-命令执行

**漏洞编号:** CVE-2019-9193

**漏洞类型:** 命令执行

**影响应用:** PostgreSQL

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** 9.3-11.2

**利用条件:** 需要具有PostgreSQL的管理员权限或pg_execute_server_program组的权限

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2019-9193允许拥有`COPY TO/FROM PROGRAM`权限（通常是超级用户或`pg_execute_server_program`组的成员）的用户执行任意操作系统命令。漏洞利用方式是利用`COPY FROM PROGRAM`功能，该功能允许PostgreSQL从一个外部程序读取数据并将其导入到数据库表中。攻击者可以构造恶意的`COPY FROM PROGRAM`语句，使其执行任意的系统命令。根据搜索引擎结果和漏洞库信息，该漏洞存在争议，PostgreSQL团队认为这不是一个安全漏洞，因为`COPY TO/FROM PROGRAM`的功能就是这样设计的，但它确实可以被滥用来执行命令。提供的POC代码描述了如何利用这个功能执行`id`命令。投毒风险较低，因为该漏洞利用的是PostgreSQL的内置功能，作者很难在提供的POC代码中隐藏恶意代码。虽然理论上可以将要执行的命令替换为恶意命令，但在当前的上下文中没有发现此类迹象。`docker-compose.yml`文件只是为了方便搭建测试环境，本身不包含恶意代码。

根据漏洞库信息，即使是超级用户也可以不通过`COPY FROM PROGRAM`执行命令。但通过`COPY FROM PROGRAM`，普通用户如果拥有了`pg_execute_server_program`的权限组，也可以进行提权。

由于postgresql团队不认为这是漏洞，所以修复方案就是不要给普通用户赋予`pg_execute_server_program`权限，使用户无法使用`COPY TO/FROM PROGRAM`执行命令。

**项目地址:** [corsisechero/CVE-2019-9193byVulHub](https://github.com/corsisechero/CVE-2019-9193byVulHub)

**漏洞详情:** [CVE-2019-9193](https://nvd.nist.gov/vuln/detail/CVE-2019-9193)