## CVE-2017-9841-PHPUnit-RCE

**漏洞编号:** CVE-2017-9841

**漏洞类型:** 远程代码执行(RCE)

**影响应用:** PHPUnit

**危害等级:** 高危，可完全控制服务器

**影响版本:** PHPUnit < 4.8.28 和 5.x < 5.6.3

**利用条件:** 需要目标服务器开放/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php 路径，且使用受影响的PHPUnit版本

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2017-9841是PHPUnit框架中Util/PHP/eval-stdin.php文件存在的一个远程代码执行漏洞。该漏洞允许攻击者通过向目标URL发送以"<?php "开头的HTTP POST请求数据来执行任意PHP代码。

**有效性：**

提供的漏洞利用代码(Argus PHPUnit Scanner)似乎有效。它通过尝试访问已知的`eval-stdin.php`路径，发送包含唯一指纹的PHP代码，并分析响应来验证代码执行。搜索引擎结果也表明该漏洞确实存在并且已被利用。

**投毒风险：**

尽管该漏洞利用代码主要功能是扫描和检测漏洞，并非直接利用，但仍存在一定的投毒风险。具体分析如下：

*   **风险点分析：**
    1.  **扫描器逻辑：** 扫描器本身需要发起HTTP请求，处理响应，如果作者在代码中植入恶意逻辑，例如在特定条件下修改请求头、请求体或者恶意处理响应数据，可能导致目标服务器遭受攻击或被植入后门。
    2.  **结果文件处理：** 扫描结果会被写入文件，如果这些文件处理逻辑存在漏洞（例如格式化字符串漏洞），可能被利用。
    3.  **依赖库：** 扫描器依赖于多个第三方库（requests, colorama, tqdm等）。虽然这些库本身通常是安全的，但总是存在一定的供应链风险。作者可能通过替换这些库或者引入恶意版本来投毒，影响到扫描器的行为。
*   **风险评估：**
    代码存在网络请求，存在依赖库，所以存在一定的投毒风险。

**利用方式：**

1.  **确定目标：** 找到使用了存在漏洞版本的PHPUnit，并且/vendor目录暴露在外的网站。
2.  **发送恶意请求：** 使用POST方法，向目标`eval-stdin.php`路径发送请求，请求内容以`<?php `开头，包含需要执行的PHP代码。例如：`<?php system($_GET['cmd']); ?>`
3.  **执行代码：** 目标服务器上的`eval-stdin.php`文件会执行POST数据中的PHP代码，攻击者可以通过`cmd`参数传递命令。

总体来说，虽然提供的代码是一个漏洞扫描器，但仍然存在一定的投毒风险，尤其是在使用未经验证的第三方工具时需要格外小心。建议在使用前进行代码审计，或者使用官方和信誉良好的漏洞扫描工具。

**项目地址:** [joelindra/Argus](https://github.com/joelindra/Argus)

**漏洞详情:** [CVE-2017-9841](https://nvd.nist.gov/vuln/detail/CVE-2017-9841)