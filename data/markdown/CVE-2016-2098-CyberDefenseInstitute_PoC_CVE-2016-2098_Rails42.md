## CVE-2016-2098-Ruby on Rails Action Pack RCE

**漏洞编号:** CVE-2016-2098

**漏洞类型:** 远程代码执行

**影响应用:** Ruby on Rails Action Pack

**危害等级:** 高危，允许远程攻击者执行任意Ruby代码

**影响版本:** before 3.2.22.2, 4.x before 4.1.14.2, and 4.2.x before 4.2.5.2

**利用条件:** 应用程序未使用安全的方式来处理render方法的用户输入

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2016-2098 漏洞是 Ruby on Rails Action Pack 中的一个远程代码执行漏洞。它允许远程攻击者通过利用应用程序对 `render` 方法的不受限制的使用来执行任意 Ruby 代码。

**漏洞分析：**

根据漏洞描述，漏洞的根源在于 Action Pack 组件在搜索用于渲染的模板时，处理用户提供的不可信输入的方式存在缺陷。如果应用程序将不可信的输入传递给 `render` 方法，攻击者可以构造恶意的输入来执行任意代码。

**POC 代码分析：**

提供的 POC 代码是 `Gemfile` 和 `Gemfile.lock` 文件，它们用于定义和锁定 Ruby 项目的依赖项。`Gemfile` 指定了项目使用的 Rails 版本 (4.2.5.1)，以及其他 gem 依赖项。`Gemfile.lock` 文件则记录了项目中使用的 gem 的确切版本，用于确保一致的构建。

这些文件本身并不包含漏洞利用代码，它们只是 Rails 应用配置的一部分。实际的漏洞利用需要向存在漏洞的 `render` 方法传递恶意的参数。

**有效性评估：**

POC 代码的有效性取决于目标应用程序是否使用了存在漏洞的 Rails 版本，并且允许用户控制传递给 `render` 方法的参数。如果满足这些条件，则漏洞利用是有效的。

**投毒风险评估：**

检查 `Gemfile` 和 `Gemfile.lock` 文件中是否存在投毒代码，需要检查是否有恶意或未知的 gem 依赖。当前提供的代码中，没有发现明显的投毒迹象。使用了常见的Rails版本和相关的gem包,例如 `rails`, `sqlite3`, `sass-rails`等。 但是，无法完全排除作者在其他地方添加恶意代码的可能性，例如在 `app` 目录下的 controller 或 view 文件中。

由于仅仅通过 `Gemfile` 和 `Gemfile.lock` 文件无法进行全面的代码审计，因此可以认为投毒风险非常低，约为1%。

**利用方式：**

1.  **找到易受攻击的 `render` 方法：** 确定应用程序中哪些地方使用了 `render` 方法，并且用户可以控制传递给 `render` 方法的参数。
2.  **构造恶意输入：** 构造包含恶意 Ruby 代码的输入字符串。例如，攻击者可以使用诸如 `<%= system('whoami') %>` 之类的代码来执行系统命令。
3.  **将恶意输入传递给 `render` 方法：** 将构造的恶意输入作为参数传递给 `render` 方法。这将导致应用程序执行恶意代码。

**总结：**

CVE-2016-2098 是一个严重的远程代码执行漏洞，需要及时修补。应用程序开发人员应该避免将不受信任的用户输入传递给 `render` 方法，并使用最新版本的 Rails 以获得安全修复。

**项目地址:** [CyberDefenseInstitute/PoC_CVE-2016-2098_Rails42](https://github.com/CyberDefenseInstitute/PoC_CVE-2016-2098_Rails42)

**漏洞详情:** [CVE-2016-2098](https://nvd.nist.gov/vuln/detail/CVE-2016-2098)