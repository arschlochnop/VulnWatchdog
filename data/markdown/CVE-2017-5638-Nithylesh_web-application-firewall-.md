## CVE-2017-5638-Apache Struts2-远程代码执行

**漏洞编号:** CVE-2017-5638

**漏洞类型:** 远程代码执行

**影响应用:** Apache Struts2

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** 2.3.x before 2.3.32, 2.5.x before 2.5.10.1

**利用条件:** 目标系统运行存在漏洞版本的Apache Struts2，且允许HTTP请求。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2017-5638是Apache Struts 2 Jakarta Multipart parser中的一个远程代码执行漏洞。攻击者可以通过构造恶意的Content-Type、Content-Disposition或Content-Length HTTP头，在服务器上执行任意命令。

**有效性:**
提供的`vulnerable.py`脚本可以有效利用此漏洞，通过设置恶意的`Content-Type`头，向目标服务器发送包含OGNL表达式的HTTP请求，从而执行任意命令。

**投毒风险:**
仓库中存在投毒代码的风险较低，约10%。分析如下：
  * `server.py`文件模拟了一个简单的WAF，但其阻止模式相当基础，可能被绕过。
  * `vulnerable.py`脚本是漏洞利用的核心，其本身的目的就是执行任意命令，这使得判断其中是否包含恶意代码变得困难。尽管如此，脚本逻辑相对清晰，主要是构造payload发送请求并打印响应。但是依旧存在以下情况:
  * 存在隐藏的反向shell或者其他恶意指令的可能，但需要进一步分析才能确定。

**利用方式:**
1.  攻击者发送特制的HTTP请求，该请求的`Content-Type`头包含恶意的OGNL表达式。
2.  Struts2框架在处理multipart请求时，会解析`Content-Type`头。
3.  由于漏洞存在，OGNL表达式会被执行，从而在服务器上执行攻击者指定的命令。
4.  `vulnerable.py` 脚本通过 `check_vulnerability` 和 `execute_command` 函数展示了如何构造包含恶意OGNL表达式的 `Content-Type` 头并发送请求。

**优先级排序理由:**
搜索引擎结果提供了漏洞的基本信息和利用场景，但漏洞利用代码 `vulnerable.py` 更为关键，因为它直接展示了漏洞的利用方式。漏洞库信息作为补充，提供了漏洞影响的版本范围和基本描述。


**项目地址:** [Nithylesh/web-application-firewall-](https://github.com/Nithylesh/web-application-firewall-)

**漏洞详情:** [CVE-2017-5638](https://nvd.nist.gov/vuln/detail/CVE-2017-5638)