## CVE-2023-45878-GibbonEdu-任意文件写入导致RCE

**漏洞编号:** CVE-2023-45878

**漏洞类型:** 任意文件写入

**影响应用:** GibbonEdu Gibbon

**危害等级:** 高危，允许未经身份验证的远程代码执行

**影响版本:** <= 25.0.1

**利用条件:** 需要能够访问存在漏洞的GibbonEdu实例，无需身份验证

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-45878 存在于 GibbonEdu 25.0.1及更早版本中，是一个未经身份验证的任意文件写入漏洞。攻击者可以利用 `rubrics_visualise_saveAjax.phps` 接口，通过构造恶意的 `img` 和 `path` 参数，将任意PHP代码写入服务器的任意位置。漏洞利用的详细步骤如下：

1.  **漏洞原理：**`rubrics_visualise_saveAjax.phps` 文件存在漏洞，因为它允许未经身份验证的访问，并且不正确地处理 `img` (base64编码的图像) 和 `path` 参数。通过设置 `path` 参数，可以指定写入文件的目标目录，结合 `img` 参数可以写入任意内容。
2.  **利用方式：**
    *   攻击者首先构造一个包含恶意PHP代码的 `img` 参数，该代码将被base64编码。
    *   然后，攻击者通过POST请求将 `img` 参数和 `path` 参数发送到 `rubrics_visualise_saveAjax.php` 接口，`path` 参数指定写入文件的路径和文件名（例如 `gibbon_myconfig.php`）。
    *   服务器将base64解码后的 `img` 参数内容写入 `path` 参数指定的文件中，从而创建一个包含恶意PHP代码的webshell。
    *   攻击者可以通过访问创建的webshell，执行任意PHP代码，实现远程代码执行。
3.  **POC代码分析：** 提供的shell脚本 `CVE-2023-45878.sh` 自动化了漏洞利用过程：
    *   首先，使用 `msfvenom` 生成一个Windows平台的反向shell可执行文件。
    *   然后，通过 `curl` 命令向目标服务器发送POST请求，利用CVE-2023-45878漏洞写入webshell（`gibbon_myconfig.php`），该webshell允许执行任意命令。
    *   接着，脚本启动一个Python HTTP服务器，用于将反向shell可执行文件传输到目标系统。
    *   使用webshell下载反向shell可执行文件。
    *   最后，执行下载的反向shell，从而在攻击者和目标系统之间建立反向shell连接。
4.  **有效性：** 根据漏洞信息和POC代码分析，该POC代码是有效的，可以利用 CVE-2023-45878 漏洞实现未经身份验证的远程代码执行。
5. **投毒风险:** 该脚本的主要目的是演示和利用漏洞。其中存在投毒代码的可能性较低，但仍然存在一些潜在风险：
    *   `msfvenom`生成的反向shell本身可能被安全软件标记为恶意软件，但这属于正常情况，不是投毒。
    *   脚本中的curl命令，如果目标服务器存在其他漏洞，攻击者可以利用这些漏洞进行进一步的攻击。但这不是脚本本身投毒。
    *   脚本在生成payload的地方存在风险，如果作者修改了payload，可能会导致其他问题。 根据代码内容，投毒风险较低, 估计在10%。

**项目地址:** [0xyy66/CVE-2023-45878_to_RCE](https://github.com/0xyy66/CVE-2023-45878_to_RCE)

**漏洞详情:** [CVE-2023-45878](https://nvd.nist.gov/vuln/detail/CVE-2023-45878)