## CVE-2018-6574

**漏洞编号:** CVE-2018-6574

**漏洞类型:** 远程代码执行

**影响应用:** Go

**危害等级:** 高危，可能导致任意代码执行

**影响版本:** Go < 1.8.7, Go 1.9.x < 1.9.4, Go 1.10 pre-releases < Go 1.10rc2

**利用条件:** 用户使用go get命令获取包含恶意代码的包

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2018-6574 允许攻击者在受害者使用 `go get` 命令获取恶意 Go 包时执行任意代码。该漏洞的根源在于 `go get` 命令在构建过程中没有正确过滤 gcc/clang 的插件参数，导致攻击者可以通过 `-fplugin=` 或 `-plugin=` 参数指定恶意插件，从而执行任意代码。

**有效性：**

提供的 POC 代码是有效的，它通过创建一个包含恶意 C 代码（`2018.c`）的 Go 包来实现远程代码执行。恶意 C 代码使用 `__attribute__((constructor))` 在库加载时自动执行 `malicious()` 函数，该函数执行 `/usr/local/bin/score 0634e7ff-26c1-4d5e-817e-a214be2151b7` 命令。 `main.go` 文件使用 `#cgo CFLAGS: -fplugin=./attack.so` 指令告诉 Go 编译器在构建时加载 `attack.so` 插件（通过编译 `2018.c` 得到）。

**投毒风险：**

该POC代码本身就是一个漏洞演示，旨在展示如何利用该漏洞执行任意命令。`2018.c` 中执行的 `/usr/local/bin/score 0634e7ff-26c1-4d5e-817e-a214be2151b7` 命令是预期的payload。该代码仓库的目的是演示漏洞，而不是为了植入后门。因此投毒风险评估为0%。

**利用方式：**

1.  **创建恶意Go包:** 攻击者创建一个包含恶意 C 代码和 Go 代码的 Go 包。恶意 C 代码编译成一个共享库（`attack.so`）。
2.  **上传恶意Go包:** 攻击者将恶意 Go 包上传到公共代码托管平台（如 GitHub）。
3.  **诱骗受害者:** 攻击者诱骗受害者使用 `go get` 命令获取恶意 Go 包。
4.  **执行恶意代码:** 当受害者使用 `go get` 命令获取恶意 Go 包时，Go 编译器会加载恶意共享库，并执行其中的恶意代码。

**缓解措施：**

*   升级 Go 版本到受影响版本之外（>= 1.8.7, >= 1.9.4, >= 1.10rc2）。
*   避免使用来自不受信任来源的 Go 包。


**项目地址:** [iNoSec2/cve-2018-6574](https://github.com/iNoSec2/cve-2018-6574)

**漏洞详情:** [CVE-2018-6574](https://nvd.nist.gov/vuln/detail/CVE-2018-6574)