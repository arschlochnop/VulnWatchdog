## CVE-2022-36804 - Atlassian Bitbucket Server and Data Center 远程代码执行

**漏洞编号:** CVE-2022-36804

**漏洞类型:** 远程代码执行

**影响应用:** Atlassian Bitbucket Server and Data Center

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** <7.6.17, <7.17.10, <7.21.4, <8.0.3, <8.1.3, <8.2.2, and <8.3.1

**利用条件:** 需要对公共或私有Bitbucket存储库具有读取权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-36804 是 Atlassian Bitbucket Server 和 Data Center 中多个 API 端点存在的一个命令注入漏洞。攻击者通过发送恶意的 HTTP 请求，利用 `git --exec` 参数执行任意命令。

**有效性:** 根据漏洞描述和搜索引擎结果（尤其是 `rapid7.com`, `assetnote.io`, `thekh4tt4k.medium.com`），此漏洞利用 PoC 代码有效。提供的 PoC 代码包含构建易受攻击环境的 Dockerfile 和利用漏洞的 Python 脚本，以及使用说明，用于验证 RCE 并执行自定义命令，甚至建立反向 shell。

**投毒风险:** 分析 PoC 代码，特别是 `cve-2022-36804.py` 脚本，主要功能是发送恶意请求以触发命令注入。投毒风险较低，约为10%。潜在的风险可能存在于脚本中使用的 User-Agent 字符串或者请求头部的其他字段中，作者可能暗中搜集使用者信息。此外，Dockerfile 下载的 Bitbucket 版本可能包含恶意软件,但这不在本次评估范围内。

**利用方式:**

1.  攻击者需要具有对目标 Bitbucket 仓库的读取权限（公共或私有）。
2.  攻击者构造包含恶意命令的 HTTP 请求，该命令会被注入到 git 命令的 `--exec` 参数中。
3.  服务器在执行 git 命令时，会执行攻击者注入的恶意命令，从而导致远程代码执行。
4.  PoC 代码演示了如何利用该漏洞执行任意系统命令，例如 `id`，以及如何建立反向 shell。

利用此漏洞，攻击者可以完全控制 Bitbucket 服务器，窃取敏感数据，篡改代码，或者将服务器作为跳板攻击其他内部系统。

**项目地址:** [asepsaepdin/CVE-2022-36804](https://github.com/asepsaepdin/CVE-2022-36804)

**漏洞详情:** [CVE-2022-36804](https://nvd.nist.gov/vuln/detail/CVE-2022-36804)