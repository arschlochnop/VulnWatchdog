## CVE-2019-14287-Sudo权限绕过

**漏洞编号:** CVE-2019-14287

**漏洞类型:** 权限绕过

**影响应用:** Sudo

**危害等级:** 高危，允许普通用户以root权限执行任意命令

**影响版本:** < 1.8.28

**利用条件:** 需要用户在sudoers文件中被配置为拥有Runas ALL权限，但同时被禁止以root身份运行命令

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-14287 漏洞允许拥有 Runas ALL 权限的 sudoer 账户绕过策略黑名单和会话 PAM 模块，并可能导致错误的日志记录。通过使用精心构造的用户 ID 调用 sudo，例如 `sudo -u \#$((0xffffffff))` 或 `sudo -u#-1 bash`，可以绕过 `!root` 配置，从而以 root 身份执行命令。 

**有效性:** 提供的 Dockerfile 和相关脚本构成了一个有效的 POC。它首先创建一个存在漏洞的 sudo 环境 (1.8.21p2)，并配置了一个用户 alice，该用户被允许以任何其他用户的身份运行命令，但 root 除外。 run.sh脚本结合readme.md文件展示了如何利用 `sudo -u#-1 bash` 命令绕过此限制，从而以 root 身份执行 bash。

**投毒风险:** 提供的代码仓库主要用于漏洞演示，从代码分析来看，没有发现任何明显的投毒代码。所有的脚本和配置文件都服务于漏洞的复现和演示目的。readme.md 文件清晰地解释了漏洞的原理和利用方法。build.sh 和 release.sh 脚本用于构建和发布 Docker 镜像，没有恶意行为。因此，评估投毒风险为 0%。

**利用方式:**
1.  **前提条件:** 攻击者需要拥有在 sudoers 文件中配置了 `Runas ALL` 权限的账户（例如，`alice ALL=(ALL,!root) NOPASSWD: ALL`）。这意味着该用户可以以任何其他用户的身份运行命令，但通常被禁止以 root 身份运行命令。
2.  **绕过限制:** 攻击者使用 `sudo -u#-1` 或 `sudo -u \#$((0xffffffff))` 命令指定一个非法的用户 ID。由于 Sudo 在 1.8.28 之前的版本中对此类用户 ID 的处理存在缺陷，导致其未能正确地应用 `!root` 限制。
3.  **提权:** 通过上述绕过，攻击者成功地以 root 身份执行任意命令，从而获得系统完全控制权。

总而言之，该漏洞的利用依赖于特定 sudo 配置和用户输入，并且需要特定的sudo版本才会触发。

**项目地址:** [CashWilliams/CVE-2019-14287-demo](https://github.com/CashWilliams/CVE-2019-14287-demo)

**漏洞详情:** [CVE-2019-14287](https://nvd.nist.gov/vuln/detail/CVE-2019-14287)