## CVE-2021-3156 (Baron Samedit)

**漏洞编号:** CVE-2021-3156

**漏洞类型:** 堆缓冲区溢出

**影响应用:** sudo

**危害等级:** 高危，允许本地用户提升权限至root

**影响版本:** sudo 1.8.2 到 1.8.31p2 和 1.9.0 到 1.9.5p1

**利用条件:** 本地用户可执行sudo命令

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2021-3156，也被称为“Baron Samedit”，是一个存在于`sudo`工具中的堆缓冲区溢出漏洞。该漏洞允许任何本地用户提升权限至root，即使该用户未在`sudoers`文件中列出。

**有效性：**

根据提供的漏洞库信息和搜索结果，此漏洞是一个真实存在的，并且影响广泛的sudo漏洞。Qualys研究团队发现了此漏洞，并且有公开的PoC代码。

提供的PoC代码旨在验证目标系统是否存在CVE-2021-3156漏洞。它通过`sudoedit -s`命令，结合精心构造的参数，触发堆缓冲区溢出。如果系统存在漏洞，PoC代码通常会导致`sudo`程序崩溃。

**投毒风险：**

提供的PoC代码主要用于检测漏洞是否存在，本身没有发现明显的恶意代码或后门。但是，在使用任何第三方提供的漏洞利用代码时，都应该保持警惕。仔细审查代码，确保它只执行预期的操作，而不会执行任何潜在的恶意行为。因为此代码执行PoC验证，存在一定的风险，所以判定投毒风险为5%。

**利用方式：**

1.  **漏洞触发：** 利用`sudoedit -s`命令，结合一个以单反斜杠结尾的命令行参数，触发`set_cmnd()`函数中的堆缓冲区溢出。
2.  **控制溢出内容：**  通过环境变量来控制溢出内容，写入任意数据（包括空字节）。
3.  **权限提升：** 通过操纵堆的布局，覆盖关键的结构，例如`service_user`或`defaults`，最终执行任意代码并获得root权限。

**项目地址:** [Shuhaib88/Baron-Samedit-Heap-Buffer-Overflow-CVE-2021-3156](https://github.com/Shuhaib88/Baron-Samedit-Heap-Buffer-Overflow-CVE-2021-3156)

**漏洞详情:** [CVE-2021-3156](https://nvd.nist.gov/vuln/detail/CVE-2021-3156)