## CVE-2025-55616-Zsh-RCE

**漏洞编号:** CVE-2025-55616

**漏洞类型:** RCE

**影响应用:** Zsh

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 未知，需要进一步评估Zsh版本

**利用条件:** 本地用户权限, GDB调试环境

**POC 可用性:** 是

**投毒风险:** 20%

## 详情

该漏洞利用了Zsh的历史命令展开功能结合GDB调试进行远程代码执行。攻击者首先运行Zsh并触发历史命令展开机制（`!`和`!!11111111111`）。然后，通过GDB修改内存中的`system`函数地址和RSP/RIP寄存器，劫持程序执行流程，最终执行恶意shellcode。PoC代码中，首先使用pexpect库与GDB进行交互，启动Zsh，运行命令，并尝试利用`!` 和 `!!11111111111` 触发漏洞。接下来，它修改内存，设置RDI寄存器指向shellcode的地址，并设置RIP寄存器指向`system`函数，从而执行shellcode。 shellcode的功能是创建一个反向shell连接到攻击者的IP地址和端口。 

**有效性：**
根据提供的PoC代码和说明文档，该漏洞利用依赖于本地GDB调试，并在已知内存地址上覆盖数据，需要根据具体的系统环境和Zsh版本调整内存地址（`p system`），因此有效性取决于环境配置的正确性。

**投毒风险：**
PoC代码本身的行为是尝试利用漏洞，但其中存在一定的投毒风险，体现在反向shell的IP地址和端口。如果作者植入了恶意的IP地址，运行该PoC会导致目标机器连接到未知的攻击者。README文档中提示需要修改IP地址，降低了直接投毒的风险。PoC代码还要求更改system函数地址，这也可能引入错误，导致程序崩溃或其他未定义行为，虽然不是直接投毒，但可能使漏洞分析人员或使用者感到困惑。综合来看，投毒风险为20%。

**利用方式：**
1.  运行PoC脚本，该脚本使用pexpect库与GDB交互。
2.  PoC启动zsh -f
3.  PoC运行 "!" 和 "!!11111111111" 命令，触发历史记录功能缺陷。
4.  通过GDB修改内存。
5.  将RDI寄存器设置为指向Shellcode地址。
6.  将RIP寄存器设置为指向 system 函数地址。
7.  执行 `continue` 指令，使程序恢复运行，从而执行shellcode，创建反向shell。
8. 需要注意的是，shellcode硬编码在脚本中，建立到192.168.100.1:4444的反向shell。

**项目地址:** [livepwn/CVE-2025-55616](https://github.com/livepwn/CVE-2025-55616)

**漏洞详情:** [CVE-2025-55616](https://nvd.nist.gov/vuln/detail/CVE-2025-55616)