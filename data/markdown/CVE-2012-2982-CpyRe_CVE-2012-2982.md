## CVE-2012-2982-Webmin-命令执行

**漏洞编号:** CVE-2012-2982

**漏洞类型:** 命令执行

**影响应用:** Webmin

**危害等级:** 高危，可导致远程代码执行

**影响版本:** <= 1.590

**利用条件:** 需要Webmin的登录凭证

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2012-2982是Webmin 1.590及更早版本中file/show.cgi的一个命令执行漏洞。攻击者通过在路径名中使用无效字符（如“|”）来执行任意命令。

**漏洞利用方式：**

1.  **身份验证：** 首先，攻击者需要拥有Webmin的有效登录凭证。`exp.py` 和 `subprocess-exp.py` 脚本都包含登录功能，使用提供的用户名和密码登录。
2.  **会话ID (SID)：** 成功登录后，服务器会设置一个名为`sid`的cookie，用于后续的身份验证。利用脚本会提取此`sid`。
3.  **构造恶意请求：** 攻击者构造一个包含恶意命令的URL，该URL的目标是`file/show.cgi`。利用的关键在于在文件路径中注入管道符`|`，将命令注入到shell中。
4.  **发送请求：**  利用脚本将包含恶意命令的请求发送到目标Webmin服务器，并将之前获取的`sid` cookie添加到请求头中。
5.  **命令执行：**  Webmin服务器执行恶意命令。
6.  **反弹shell：** 在提供的`exp.py`中，payload被构造为反弹shell的命令。脚本在攻击者的机器上监听一个端口，然后目标服务器连接到该端口并提供一个shell。
7.  **利用脚本细节：** `exp.py`使用requests库发送HTTP请求，而`subprocess-exp.py`尝试使用更复杂的方法来处理响应内容。`subprocess-exp.py`尝试执行一个python反弹shell，并尝试通过socket发送和接收数据，这种方式可能不够稳定，但是提供了另一种思路。

**有效性：**

提供的PoC代码（`exp.py` 和 `subprocess-exp.py`）看起来有效，因为它们利用了CVE描述中提到的管道符注入。 搜索结果中也提及了metasploit模块的存在，进一步证实了漏洞的可利用性。 提供的脚本都提供了验证Webmin版本漏洞的可能性。

**投毒风险：**

对提供的PoC代码进行分析后，没有发现明显的恶意代码。`requirements.txt` 文件中列出的依赖项（requests, string, secrets, sys, socket, subprocess, base64）都是常见的Python库，用于发送HTTP请求，处理字符串，生成随机数，进行系统调用和编码等操作，没有发现可疑之处。 尽管 `subprocess-exp.py` 使用了 `base64` 编码，但这仅仅是对payload进行编码，以避免某些字符被过滤，不属于投毒行为。代码逻辑主要集中于利用漏洞，而不是执行隐藏的恶意操作。 投毒风险评估为 **0%**。

**项目地址:** [CpyRe/CVE-2012-2982](https://github.com/CpyRe/CVE-2012-2982)

**漏洞详情:** [CVE-2012-2982](https://nvd.nist.gov/vuln/detail/CVE-2012-2982)