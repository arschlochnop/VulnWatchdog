## CVE-2019-18634-Sudo-Stack Buffer Overflow

**漏洞编号:** CVE-2019-18634

**漏洞类型:** 栈缓冲区溢出

**影响应用:** Sudo

**危害等级:** 高危，可能导致提权

**影响版本:** < 1.8.26

**利用条件:** pwfeedback在/etc/sudoers中被启用

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2019-18634 漏洞存在于 Sudo 1.8.26 之前的版本中。如果 /etc/sudoers 文件中启用了 `pwfeedback` 选项，攻击者可以通过向 `getln()` 函数的 stdin 发送一个长字符串，从而触发 `sudo` 进程中的栈缓冲区溢出。根据漏洞库信息和搜索引擎结果，漏洞利用需要 `pwfeedback` 选项被启用，这并非默认配置，而需要管理员手动配置。提供的 PoC 代码 `exploit.py` 尝试利用此漏洞，通过向 `sudo` 命令的标准输入注入恶意 payload。代码首先使用 `process()` 函数启动一个 `sudo` 进程，并设置环境变量 `SUDO_ASKPASS`指向shell脚本。然后，构造一个包含大量 `junk` 字节和覆盖返回地址的 payload，通过 `os.write()` 函数将其写入 `sudo` 进程的标准输入。该 payload 的目的是覆盖返回地址，从而劫持程序的控制流。`README.md` 文件说明此 PoC 在 Ubuntu 20.04 和 sudo 1.8.25 上有效，并指向了一个分析文章。

**有效性评估：**提供的POC代码似乎是有效的，`README.md` 提到在特定环境下可以成功利用此漏洞。多个搜索引擎结果也表明此漏洞存在可利用的PoC。

**投毒风险评估：** 风险较低。POC 代码本身功能相对清晰，主要目的是利用缓冲区溢出漏洞。虽然`shell.sh`如果被替换为恶意脚本会引入风险，但就给出的`exploit.py`本身来说，风险较小。`shell.sh`文件本身缺失，需要用户提供，这加大了用户引入风险的可能性。默认情况下，该PoC需要用户手动替换shell脚本为反向shell，如果用户替换的脚本包含恶意代码，则可能存在投毒风险。

**利用方式：**

1.  **前提条件：** `pwfeedback` 必须在 `/etc/sudoers` 文件中被启用。
2.  **漏洞触发：** 攻击者通过向需要密码验证的sudo命令输入超长字符串触发栈缓冲区溢出。
3.  **Payload注入：** 攻击者构造包含恶意代码的 payload，覆盖栈上的返回地址。
4.  **代码执行：** 当函数返回时，程序控制流被劫持，执行攻击者注入的恶意代码，从而实现提权。


**项目地址:** [paras1te-x/CVE-2019-18634](https://github.com/paras1te-x/CVE-2019-18634)

**漏洞详情:** [CVE-2019-18634](https://nvd.nist.gov/vuln/detail/CVE-2019-18634)