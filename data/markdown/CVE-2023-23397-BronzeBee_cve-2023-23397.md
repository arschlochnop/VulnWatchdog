## CVE-2023-23397-Microsoft Outlook Elevation of Privilege Vulnerability

**漏洞编号:** CVE-2023-23397

**漏洞类型:** 权限提升

**影响应用:** Microsoft Outlook

**危害等级:** 高危，可能导致Net-NTLM hash泄露和身份冒用

**影响版本:** 受影响版本包括：Microsoft Office LTSC 2021, Microsoft Outlook 2016, Microsoft 365 Apps for Enterprise, Microsoft Office 2019, Microsoft Outlook 2013 Service Pack 1。详细版本信息请参考漏洞库信息。

**利用条件:** 攻击者需要能够发送电子邮件给受害者。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-23397 是 Microsoft Outlook 中的一个权限提升漏洞。攻击者可以利用此漏洞窃取受害者的 Net-NTLM 哈希，从而冒充受害者的身份并进行进一步的攻击。漏洞的根源在于 Outlook 没有正确验证输入，攻击者可以通过在电子邮件中嵌入特制的 UNC 路径来触发漏洞。当 Outlook 处理包含恶意 UNC 路径的电子邮件时，它将尝试连接到该路径，并将用户的 Net-NTLM 哈希发送到攻击者控制的服务器。

**有效性评估：**
根据漏洞库信息和搜索结果，CVE-2023-23397 是一个已被积极利用的漏洞，并且CISA已将其添加到已知被利用的漏洞目录中。提供的漏洞利用代码似乎有效，因为它允许攻击者创建包含恶意 payload 的 TNEF 编码的 Outlook 电子邮件，并通过纯 SMTP 发送，从而触发 Net-NTLM 哈希的泄露。

**投毒风险评估：**
分析提供的POC代码，风险较低。代码主要功能是构造并发送包含漏洞触发payload的邮件。虽然任何代码都存在潜在的恶意修改可能，但该POC代码相对简单，主要利用了已知的漏洞。

**利用方式分析：**
1.  攻击者使用提供的 Python 脚本 (cve-2023-23397.py) 创建一个特制的 Outlook 电子邮件，其中包含一个指向攻击者控制的服务器的恶意 UNC 路径 (例如 \\10.10.10.10\share\1.wav)。这个 UNC 路径被嵌入到电子邮件的某个属性中，例如 `PidLidReminderOverride`。
2.  攻击者通过 SMTP 将此电子邮件发送给受害者。
3.  当受害者使用 Outlook 打开或预览该电子邮件时，Outlook 会尝试连接到恶意 UNC 路径，并自动向攻击者控制的服务器发送受害者的 Net-NTLM 哈希。
4.  攻击者可以使用捕获的 Net-NTLM 哈希进行 NTLM 中继攻击或其他身份验证攻击，从而提升权限并访问受害者的资源。

**缓解措施：**
*   及时安装 Microsoft 提供的安全更新以修复此漏洞。
*   阻止出站 SMB 流量（端口 445）以防止 Net-NTLM 哈希泄露。
*   配置 Outlook 以禁用自动身份验证到 UNC 路径。
*   监视网络流量以检测对外部 SMB 服务器的连接尝试。

**项目地址:** [BronzeBee/cve-2023-23397](https://github.com/BronzeBee/cve-2023-23397)

**漏洞详情:** [CVE-2023-23397](https://nvd.nist.gov/vuln/detail/CVE-2023-23397)