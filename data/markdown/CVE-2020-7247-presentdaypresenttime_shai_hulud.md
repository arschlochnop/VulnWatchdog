## CVE-2020-7247 - OpenSMTPD 远程命令执行

**漏洞编号:** CVE-2020-7247

**漏洞类型:** 远程命令执行

**影响应用:** OpenSMTPD

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** 6.6

**利用条件:** 目标服务器运行OpenSMTPD 6.6版本，且使用未注释的默认配置

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-7247 漏洞存在于 OpenSMTPD 6.6 的 smtp_session.c 文件中的 smtp_mailaddr 函数中。由于输入验证不正确，远程攻击者可以通过构造包含 shell 元字符的 MAIL FROM 字段的 SMTP 会话，以 root 权限执行任意命令。提供的漏洞利用代码 (infect.py) 尝试利用此漏洞。该代码首先使用 nmap 扫描局域网以发现潜在的 OpenSMTPD 服务器，然后尝试连接到这些服务器并在 MAIL FROM 字段中注入命令。漏洞利用脚本尝试下载并执行 `woot.sh` 脚本，这个脚本的功能未知，存在潜在的投毒风险。 docker-compose.yml 脚本配置了多个 OpenSMTPD 实例，用于搭建测试环境。\n\n**有效性:** 根据漏洞信息和搜索引擎结果，该漏洞利用的有效性较高。漏洞库信息和搜索结果都确认了该漏洞的存在和可利用性。\n\n**投毒风险:** `infect.py` 中包含从 `raw.githubusercontent.com/presentdaypresenttime/shai_hulud/main/woot.sh` 下载并执行脚本的代码，该脚本内容未知，存在潜在的投毒风险，攻击者可以通过修改 `woot.sh` 的内容植入恶意代码。因此，投毒风险评估为10%。\n\n**利用方式:** 漏洞利用的步骤如下：\n1. 使用 nmap 扫描局域网，发现运行 OpenSMTPD 服务的服务器。\n2. 连接到目标服务器的 25 端口。\n3. 发送 HELO 命令建立连接。\n4. 发送包含恶意命令的 MAIL FROM 命令，利用 shell 注入漏洞执行命令。\n5. 发送 RCPT TO, DATA 命令模拟邮件发送过程。\n6. 发送 QUIT 命令断开连接。

**项目地址:** [presentdaypresenttime/shai_hulud](https://github.com/presentdaypresenttime/shai_hulud)

**漏洞详情:** [CVE-2020-7247](https://nvd.nist.gov/vuln/detail/CVE-2020-7247)