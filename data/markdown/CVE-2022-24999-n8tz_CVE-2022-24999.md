## CVE-2022-24999-qs-Prototype污染

**漏洞编号:** CVE-2022-24999

**漏洞类型:** Prototype污染

**影响应用:** qs (Node.js 库)

**危害等级:** 高危，可能导致拒绝服务 (DoS) 攻击

**影响版本:** < 6.10.3 (以及Express < 4.17.3)

**利用条件:** 应用程序使用受影响的qs版本，并且允许原型链污染。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-24999 漏洞存在于 `qs` 库 6.10.3 之前的版本中。该漏洞允许攻击者通过在 URL 查询字符串中注入 `__proto__` 属性来污染 JavaScript 对象的原型链。  

**有效性：**  

提供的 POC 代码是有效的。它展示了如何通过设置 Array 在 `__proto__` 属性中创建“array-like”对象。 通过设置不合理的 "length"值，会导致 Node 进程挂起，从而造成拒绝服务。

**投毒风险：**

尽管提供的代码主要用于演示漏洞利用，但仍存在一定的投毒风险。`qs-vulns` 目录下的一些示例 (例如 `ghostValues.js`) 演示了如何通过原型污染注入恶意值。如果攻击者能够控制应用程序的查询字符串，他们可以利用此漏洞来修改应用程序的行为。代码仓库本身可能存在一些不明显的后门，虽然主要目的是展示漏洞，存在一定的潜在风险。

投毒风险评估：10%

**利用方式：**

1.  **构造恶意查询字符串：** 攻击者构造包含 `__proto__` 属性的恶意 URL 查询字符串，例如：`categories[_proto__]=b&categories[_proto__]&categories[length]=100000000`。
2.  **发送请求：** 攻击者将构造的 URL 发送到易受攻击的应用程序。
3.  **原型污染：** `qs` 库解析查询字符串时，会错误地处理 `__proto__` 属性，导致 JavaScript 对象的原型链被污染。
4.  **拒绝服务 (DoS)：** 通过设置非常大的 `length` 属性，导致应用程序在尝试操作这些对象时进入死循环，最终导致拒绝服务。

**总结：**

CVE-2022-24999 是一个原型污染漏洞，允许攻击者通过恶意构造的查询字符串来执行 DoS 攻击。应用程序应升级到 `qs` 库的修复版本（>= 6.10.3）或 Express 4.17.3 之后的版本。

**项目地址:** [n8tz/CVE-2022-24999](https://github.com/n8tz/CVE-2022-24999)

**漏洞详情:** [CVE-2022-24999](https://nvd.nist.gov/vuln/detail/CVE-2022-24999)