## CVE-2023-4911-glibc-ld.so 本地提权

**漏洞编号:** CVE-2023-4911

**漏洞类型:** 缓冲区溢出

**影响应用:** glibc

**危害等级:** 高危，本地权限提升

**影响版本:** 2.34 到 2.39 之前的版本

**利用条件:** 本地用户权限，目标系统使用存在漏洞的glibc版本，并且存在具有SUID权限的可执行文件。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-4911 是 glibc 动态链接器 ld.so 中 GLIBC_TUNABLES 环境变量处理时发现的缓冲区溢出漏洞。攻击者可以利用此漏洞，通过构造恶意的 GLIBC_TUNABLES 环境变量，在使用 SUID 权限启动二进制文件时执行具有提升权限的代码，从而实现本地提权。

**漏洞利用方式：**

1.  **利用环境变量：** 漏洞利用依赖于设置 `GLIBC_TUNABLES` 环境变量。攻击者需要构造一个过长的环境变量值，触发 `ld.so` 中的缓冲区溢出。
2.  **覆盖内存：** 溢出发生在堆上，攻击者通过控制溢出内容来覆盖相邻内存区域，例如 `l_info` 结构体中的 `DT_RPATH` 项，使其指向攻击者控制的内存。
3.  **执行恶意代码：** 通过覆盖 `DT_RPATH`，攻击者可以劫持程序执行流程，跳转到预先准备好的 shellcode，shellcode 通常包含提权操作，例如设置 `setuid(0)` 和 `setgid(0)` 然后执行 `/bin/sh`。
4.  **SUID程序：** 该漏洞必须结合SUID程序才能提权，因为漏洞本身利用的是动态链接器`ld.so`在加载SUID程序时解析`GLIBC_TUNABLES`环境变量时出现的漏洞。

**有效性评估：**

根据漏洞信息、搜索结果和提供的 POC 代码，可以判断该漏洞利用是有效的。搜索结果中包含多个关于 CVE-2023-4911 的分析和利用的文章，以及利用示例。提供的 POC 代码尝试利用该漏洞来提权。

**POC分析:**

*   POC代码主要通过设置`GLIBC_TUNABLES`，KV_PAYLOAD等一系列环境变量，来构造溢出。
*   代码尝试循环运行`/usr/bin/su --help`命令，并监测命令执行的时间，如果时间超过1秒，则认为攻击成功，可能已经获取到shell
*   代码中还包含生成libc.so.6的代码

**投毒风险评估：**

评估为 10%。 代码本身具有漏洞利用特征，主要风险在于：

*   **shellcode 位置：** 尽管代码看起来是在尝试获取 root shell， 但shellcode的有效性依赖于目标系统的环境。如果 shellcode 的偏移量不正确，利用将失败，甚至可能导致程序崩溃。
*   **生成 libc.so.6 的代码：**  虽然代码试图从`/lib/x86_64-linux-gnu/libc.so.6`复制libc文件，但是如果libc.so.6被替换成包含恶意代码的文件,则存在风险.，但是代码中未见直接修改libc.so.6的行为，因此风险较低。
*   **依赖性：** 提供的代码依赖于特定版本的JDK(JDK22)，可能无法直接在其他环境中编译和运行。这限制了恶意利用的范围，但也可能被利用来传播恶意代码。

**项目地址:** [shacojx/CVE-2023-4911-Exploit](https://github.com/shacojx/CVE-2023-4911-Exploit)

**漏洞详情:** [CVE-2023-4911](https://nvd.nist.gov/vuln/detail/CVE-2023-4911)