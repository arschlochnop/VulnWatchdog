## CVE-2023-22527-Atlassian Confluence-RCE

**漏洞编号:** CVE-2023-22527

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Atlassian Confluence Server and Data Center

**危害等级:** 高危，未授权远程代码执行

**影响版本:** 8.0.0 <= version < 8.5.4

**利用条件:** 目标Confluence实例可访问，且版本在受影响范围内。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-22527 是 Atlassian Confluence Server 和 Data Center 中的一个模板注入漏洞。未经过身份验证的攻击者可以通过注入 OGNL 表达式来执行任意代码。PoC代码利用 `template/aui/text-inline.vm` 终端点，通过 POST 请求发送恶意 OGNL 表达式，从而实现远程代码执行。

**有效性：**
根据漏洞库信息、搜索结果和提供的 PoC 代码，此漏洞的 PoC 代码是有效的。 漏洞库信息明确指出这是一个 RCE 漏洞，并且CISA将其添加到了已知被利用的漏洞目录(KEV)中。 搜索结果中也提到了该漏洞已被武器化，攻击者利用它来传递恶意软件。PoC 代码可以成功地在目标系统上执行任意命令。

**投毒风险：**
PoC 代码本身主要包含漏洞验证和利用的代码，没有发现明显的恶意代码。不过存在一些隐患:

*   **依赖管理：** PoC 使用了 `requests` 库，如果 `requests` 库被恶意版本替换，则可能存在投毒。
*   **命令执行：** PoC 允许执行任意命令，如果攻击者诱导用户执行恶意命令，则可能存在投毒风险。
*   **代码审查：** 尽管代码看起来没有明显的恶意行为，但是人工审查仍然是必要的，以确保没有隐藏的漏洞或后门。
综合评估，投毒风险较低，约为5%。

**利用方式：**
1.  攻击者发送包含恶意 OGNL 表达式的特制 POST 请求到 `/template/aui/text-inline.vm` 终端点。
2.  Confluence Server 在处理请求时，由于存在模板注入漏洞，OGNL 表达式会被执行。
3.  OGNL 表达式利用 `freemarker.template.utility.Execute` 类执行任意系统命令。
4.  命令执行的结果会被写入响应，并返回给攻击者。
5.  攻击者可以利用这个漏洞执行任意代码，例如安装恶意软件，窃取数据，或者控制服务器。

**项目地址:** [kh4sh3i/CVE-2023-22527](https://github.com/kh4sh3i/CVE-2023-22527)

**漏洞详情:** [CVE-2023-22527](https://nvd.nist.gov/vuln/detail/CVE-2023-22527)