## CVE-2020-7961-Liferay-Deserialization

**漏洞编号:** CVE-2020-7961

**漏洞类型:** 反序列化漏洞

**影响应用:** Liferay Portal

**危害等级:** 高危，允许远程代码执行

**影响版本:** < 7.2.1 CE GA2

**利用条件:** 需要网络访问Liferay Portal的JSONWS接口

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-7961是Liferay Portal 7.2.1 CE GA2之前的版本中存在的一个反序列化漏洞，攻击者可以通过JSON Web Services (JSONWS)接口发送恶意构造的序列化数据，从而执行任意代码。漏洞利用方式如下：

1.  **漏洞原理：** Liferay Portal的JSONWS接口在处理用户请求时，没有对传入的参数进行充分的校验，导致攻击者可以发送恶意的序列化数据。
2.  **利用方式：**
    *   攻击者首先需要找到Liferay Portal的JSONWS接口，通常位于`/api/jsonws/invoke`。
    *   然后，攻击者需要构造一个包含恶意代码的序列化对象，例如利用`ysoserial`等工具生成。
    *   将序列化对象作为参数，通过POST请求发送到JSONWS接口。
    *   Liferay Portal在反序列化该对象时，会执行其中的恶意代码，从而导致远程代码执行。
3.  **POC有效性：** 提供的Go代码通过扫描URL列表，向目标发送包含特定Payload的POST请求到`/api/jsonws/invoke`，然后检查响应内容是否包含"java.lang.IllegalStateException"和"Unable to deserialize object"字符串。如果包含，则认为目标存在CVE-2020-7961漏洞。
4.  **投毒风险：**  
    *  README.md只包含漏洞描述，无风险。
    *  `liferay.go` 存在一定的投毒风险。代码会从指定的URL列表中读取URL，并尝试访问`/api/jsonws/invoke`。虽然核心逻辑是检测漏洞，但攻击者可能会在提供的URL列表中包含指向恶意服务器的链接，或者修改检测逻辑本身，使其在某些情况下执行恶意操作。此外，`checkFile` 函数中对错误信息的判断如果被恶意修改，可能会产生误报，引导使用者攻击不存在漏洞的目标。
    * 风险比例评估为 10%。主要是因为代码逻辑较为简单直接，核心目的是漏洞检测，但仍然存在被利用进行信息收集或误导性攻击的可能性。
5.  **搜索引擎结果补充：** 搜索结果提供了漏洞的详细描述、利用方式、缓解措施等信息，确认了漏洞的存在和危害。

**项目地址:** [shacojx/GLiferay-CVE-2020-7961-golang](https://github.com/shacojx/GLiferay-CVE-2020-7961-golang)

**漏洞详情:** [CVE-2020-7961](https://nvd.nist.gov/vuln/detail/CVE-2020-7961)