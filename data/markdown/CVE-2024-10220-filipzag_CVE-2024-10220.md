## CVE-2024-10220-Kubernetes-kubelet-gitRepo-命令执行

**漏洞编号:** CVE-2024-10220

**漏洞类型:** 命令执行

**影响应用:** Kubernetes kubelet

**危害等级:** 高危，允许攻击者在主机节点上执行任意命令，可能导致集群完全受控。

**影响版本:** <= 1.28.11, 1.29.0 <= version <= 1.29.6, 1.30.0 <= version <= 1.30.2

**利用条件:** 攻击者需要具有创建Pod以及使用gitRepo volume的权限。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-10220 漏洞存在于 Kubernetes kubelet 组件中，允许攻击者通过特制的 gitRepo volume 执行任意命令。

**有效性：**

根据漏洞信息和搜索引擎结果，该漏洞允许攻击者在受影响的 Kubernetes 集群中的节点上执行任意命令。提供的 POC 代码展示了一个利用此漏洞的简单示例，该示例创建一个包含恶意 hook 的 git 仓库。当 kubelet 拉取该仓库时，恶意 hook 会被执行，从而在节点上创建 `/tmp/cve-2024-10220` 文件，内容为 "You have been pwned!"。由于 POC 代码能够成功触发命令执行，因此可以认为该 POC 是有效的。

**投毒风险：**

分析提供的 POC 代码，`/tmp/ed40431b94c4f7558e5bd729b365fbc6/hooks/post-checkout` 脚本仅仅是简单的写入文件。没有发现任何隐藏的，具有破坏性或恶意行为的代码。因此，POC 代码本身不包含投毒行为，投毒风险为 0%。当然，实际攻击中，攻击者可能会在 `post-checkout` 脚本中添加更具危害性的代码。

**利用方式：**

1.  攻击者创建一个包含恶意 Git hooks 的 Git 仓库，例如 `post-checkout`。
2.  攻击者创建一个 Kubernetes Pod，该 Pod 使用 `gitRepo` volume 指向包含恶意 Git hooks 的 Git 仓库。
3.  当 kubelet 在节点上拉取（`git clone`）该仓库时，Git hooks 会被自动执行，从而在节点上执行攻击者预定义的任意命令。
4.  由于 kubelet 通常以 root 权限运行，因此攻击者可以在节点上以 root 权限执行命令，从而完全控制节点。

**缓解措施：**

*   升级 kubelet 到不受影响的版本（>= 1.28.12, >= 1.29.7, >= 1.30.3, 1.31.0）
*   限制用户创建具有 gitRepo volume 的 Pod 的权限。

**项目地址:** [filipzag/CVE-2024-10220](https://github.com/filipzag/CVE-2024-10220)

**漏洞详情:** [CVE-2024-10220](https://nvd.nist.gov/vuln/detail/CVE-2024-10220)