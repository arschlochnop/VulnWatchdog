## CVE-2024-50379-Apache Tomcat-TOCTOU Race Condition RCE

**漏洞编号:** CVE-2024-50379

**漏洞类型:** TOCTOU Race Condition

**影响应用:** Apache Tomcat

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 11.0.0-M1 <= version <= 11.0.1, 10.1.0-M1 <= version <= 10.1.33, 9.0.0.M1 <= version <= 9.0.97

**利用条件:** 默认Servlet启用写入（非默认配置），文件系统大小写不敏感

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-50379 是 Apache Tomcat 中的一个时间检查/时间使用 (TOCTOU) 竞争条件漏洞。该漏洞出现在 JSP 编译期间，当默认 servlet 启用了写入（非默认配置）且文件系统大小写不敏感时，允许远程代码执行 (RCE)。攻击者可以利用此漏洞上传一个文件，并通过竞争条件使其被 Tomcat 作为 JSP 文件执行，从而导致任意代码执行。提供的代码段是 Apache 2.0 许可协议，并非漏洞利用代码本身，因此无法直接验证 POC 的有效性。但根据搜索结果，存在公开的POC，可以利用。由于提供的代码只是许可协议，不包含恶意代码，因此投毒风险为0%。利用方式如下：

1.  **上传恶意文件：** 攻击者上传一个恶意文件，该文件伪装成 JSP 文件，但实际上包含恶意代码。
2.  **竞争条件：** 攻击者利用 TOCTOU 漏洞，在 Tomcat 检查文件类型和实际编译文件之间制造时间差。
3.  **绕过检查：** 在检查通过后，攻击者通过某种方式修改文件内容，使其成为真正的 JSP 文件，并包含恶意代码。
4.  **远程代码执行：** Tomcat 编译并执行该 JSP 文件，从而导致远程代码执行。

**项目地址:** [dragonked2/CVE-2024-50379-POC](https://github.com/dragonked2/CVE-2024-50379-POC)

**漏洞详情:** [CVE-2024-50379](https://nvd.nist.gov/vuln/detail/CVE-2024-50379)