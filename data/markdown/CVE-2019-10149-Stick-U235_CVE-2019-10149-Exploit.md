## CVE-2019-10149-Exim-远程命令执行

**漏洞编号:** CVE-2019-10149

**漏洞类型:** 远程命令执行

**影响应用:** Exim

**危害等级:** 高危，可能导致远程代码执行和系统完全控制

**影响版本:** 4.87-4.91

**利用条件:** 目标系统运行受影响版本的Exim，且允许从攻击者主机到目标机器25端口的TCP连接

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-10149是Exim 4.87到4.91版本中存在的一个远程命令执行漏洞。该漏洞源于`deliver_message()`函数中对收件人地址的不当验证。攻击者可以利用此漏洞，通过构造包含恶意命令的特殊邮件，在目标系统上执行任意代码，从而完全控制系统。

**有效性分析：**
根据漏洞库信息、搜索引擎结果以及提供的PoC代码，可以确认此漏洞是真实存在的，并且PoC代码可以有效利用此漏洞。

**投毒风险分析：**
PoC代码通过`nc`在目标机器上反弹shell，监听31415端口。代码本身目的是利用漏洞，没有发现隐藏的恶意代码或后门，因此投毒风险较低，为0%。

**漏洞利用方式：**
1.  PoC首先通过`nc`连接到目标Exim服务器的25端口（SMTP）。
2.  发送`HELO`命令，声明客户端主机名。
3.  发送`MAIL FROM`命令，指定发件人地址。
4.  发送`RCPT TO`命令，指定收件人地址，其中收件人地址包含恶意的payload：`${run{\x2fbin\x2fsh\t-c\t\x22nc\t-lp\t31415\t-e\t\x2fbin\x2fsh\x22}}@localhost`。
    *   这个payload使用了Exim的`${run{}}`扩展函数，可以在Exim进程中执行任意命令。
    *   payload的功能是执行`nc -lp 31415 -e /bin/sh`，即在目标机器上监听31415端口，并将/bin/sh绑定到该端口，相当于反弹了一个shell。
5.  发送`DATA`命令，开始邮件内容传输。
6.  发送一系列`Received:`头，用于填充邮件内容并触发漏洞（原因在于Exim对过长的头部处理可能存在问题，也可能是为了绕过某些过滤）。
7.  发送`.
`表示邮件内容结束。
8.  发送`QUIT`命令断开连接。
9.  PoC最后使用`nc localhost 31415`连接到目标机器上反弹的shell，实现远程代码执行。

**项目地址:** [Stick-U235/CVE-2019-10149-Exploit](https://github.com/Stick-U235/CVE-2019-10149-Exploit)

**漏洞详情:** [CVE-2019-10149](https://nvd.nist.gov/vuln/detail/CVE-2019-10149)