## CVE-2023-46604-Apache ActiveMQ-RCE

**漏洞编号:** CVE-2023-46604

**漏洞类型:** 远程代码执行

**影响应用:** Apache ActiveMQ

**危害等级:** 高危，可导致服务器完全控制

**影响版本:** < 5.15.16, < 5.16.7, < 5.17.6, < 5.18.3

**利用条件:** 需要网络访问ActiveMQ broker或client，且目标使用存在漏洞的ActiveMQ版本。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2023-46604 存在于 Apache ActiveMQ 的 OpenWire 协议中，是一个远程代码执行漏洞。攻击者可以通过构造恶意的 OpenWire 消息，利用 Java 反序列化漏洞，使 ActiveMQ Broker 或 Client 执行任意代码。

**有效性:**
提供的POC代码通过构造包含恶意 Spring Bean 定义的 XML 文件，利用 `java.lang.ProcessBuilder` 或 `javax.script.ScriptEngineManager`在目标系统上执行任意命令。这些POC分别实现了创建文件、窃取文件和创建用户等功能，证明了漏洞利用的有效性。

**投毒风险:**
分析提供的POC代码，没有发现明显的投毒代码。所有的POC代码都专注于利用漏洞执行命令，没有发现额外植入后门或进行恶意传播的行为。但实际环境中，攻击者可能会使用类似的POC进行恶意活动，例如植入后门、传播恶意软件等，因此实际利用存在较高风险。

**利用方式:**
1.  **确定目标 ActiveMQ 版本:** 确认目标 ActiveMQ Broker 或 Client 使用的是存在漏洞的版本 ( < 5.15.16, < 5.16.7, < 5.17.6, < 5.18.3)。
2.  **构造恶意 OpenWire 消息:**  攻击者构造一个包含恶意 XML 文件的 OpenWire 消息。该 XML 文件利用 Spring Bean 的特性，通过 `java.lang.ProcessBuilder` 或 `javax.script.ScriptEngineManager` 执行命令。
3.  **发送恶意消息:**  攻击者将构造好的恶意 OpenWire 消息发送到 ActiveMQ Broker 或 Client。
4.  **触发 RCE:**  ActiveMQ Broker 或 Client 在处理 OpenWire 消息时，会反序列化 XML 文件，从而执行 XML 中定义的恶意命令，实现远程代码执行。

**风险:**
成功利用此漏洞，攻击者可以在目标系统上执行任意代码，完全控制服务器，窃取敏感信息，植入后门，进行恶意破坏等。

**项目地址:** [nitzanoligo/CVE-2023-46604-demo](https://github.com/nitzanoligo/CVE-2023-46604-demo)

**漏洞详情:** [CVE-2023-46604](https://nvd.nist.gov/vuln/detail/CVE-2023-46604)