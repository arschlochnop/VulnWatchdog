## CVE-2024-4040-CrushFTP-SSTI

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入(SSTI)

**影响应用:** CrushFTP

**危害等级:** 严重，可能导致任意文件读取，身份验证绕过和远程代码执行

**影响版本:** < 10.7.1 和 < 11.1.0

**利用条件:** 目标服务器运行受影响版本的CrushFTP，且可以通过网络访问

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-4040是CrushFTP中的一个服务器端模板注入漏洞。未经验证的远程攻击者可以利用此漏洞从VFS沙箱外部读取文件系统中的文件，绕过身份验证以获得管理权限，并在服务器上执行远程代码。

**有效性：**
根据漏洞库信息、搜索结果以及提供的漏洞利用代码，该漏洞POC有效。漏洞已经被积极利用，并且有公开可用的POC。

**投毒风险：**
尽管该POC的主要功能是文件读取，获取session，和漏洞验证，但仍然存在一定的投毒风险：
*   **依赖项：** 该POC使用requests库，虽然是常用库，但如果requests库本身被篡改，可能导致恶意代码执行。
*   **文件写入：** `-s` 参数会将 session 写入到 sessions.obj 文件, 如果后续有其他脚本依赖这个文件，并且 sessions.obj 被恶意修改，则存在潜在风险

因此，投毒风险评估为5%。主要是代码相对简单，功能明确，直接执行系统命令的可能性较低。但仍需注意依赖项的安全性以及文件写入操作。

**利用方式：**
1.  **文件读取：** 通过 `-r` 参数指定要读取的文件路径，利用SSTI读取服务器上的任意文件。
2.  **获取Admin Session：** 通过 `-s` 参数尝试从服务器检索管理员会话令牌，可能绕过身份验证获得管理员权限。
3.  **漏洞检测：** 通过 `-c` 参数检查目标服务器是否存在漏洞。

利用方式是，首先通过WebInterface接口发送包含恶意模板的POST请求，服务器在处理该请求时，由于没有正确过滤模板中的特殊字符，导致模板引擎执行了攻击者注入的恶意代码，从而实现任意文件读取、身份验证绕过或远程代码执行。

**项目地址:** [jakabakos/CVE-2024-4040-CrushFTP-File-Read-vulnerability](https://github.com/jakabakos/CVE-2024-4040-CrushFTP-File-Read-vulnerability)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)