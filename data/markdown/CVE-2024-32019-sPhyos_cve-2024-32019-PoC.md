## CVE-2024-32019 - Netdata ndsudo 本地权限提升

**漏洞编号:** CVE-2024-32019

**漏洞类型:** 本地权限提升

**影响应用:** Netdata

**危害等级:** 高危，允许低权限用户提升至 root 权限

**影响版本:** >= 1.44.0-60, < 1.45.0-169 和 >= 1.45.0, < 1.45.3

**利用条件:** 目标系统安装了受影响版本的 Netdata，且 ndsudo 工具设置了 SUID root 权限，并且攻击者可以执行 ndsudo。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-32019 漏洞存在于 Netdata 的 `ndsudo` 工具中。该工具以 root 权限运行，但它使用 `PATH` 环境变量来查找要执行的命令。攻击者可以通过在 `PATH` 环境变量中添加一个指向恶意目录的路径，并在该目录中放置一个与 `ndsudo` 尝试执行的命令同名的恶意程序，从而以 root 权限执行任意代码。

**有效性:**

提供的 POC 代码是有效的。它展示了如何利用此漏洞。

**利用方式:**

1.  创建一个包含恶意程序（例如，反弹 shell）的目录。
2.  将恶意程序命名为 `ndsudo` 尝试执行的命令之一（例如，`nvme-list`）。
3.  将包含恶意程序的目录添加到 `PATH` 环境变量的开头。
4.  运行 `ndsudo` 命令。`ndsudo` 将执行恶意程序，从而使攻击者获得 root 权限。

**投毒风险:**

根据提供的代码分析，该仓库似乎主要提供了一个 checker 脚本来帮助安全研究人员和管理员识别和验证漏洞是否存在，旨在帮助防御者评估风险和验证补丁，而不是提供武器化的 PoC。因此，该仓库中存在作者隐藏的投毒代码的风险较低。

检查器代码会检查以下内容：

*   `/opt/netdata/usr/libexec/netdata/plugins.d/ndsudo` (或安装位置) 的 SUID/所有权。
*   `PATH` 中早于常见系统路径的可写目录。
*   `ndsudo` 尝试执行的白名单子命令是否存在。
*   可选地运行 `ndsudo --test <subcommand>` 来打印已解析的命令而不执行它 (谨慎使用，先阅读代码)。

因此，**投毒风险评估为 0%**。


**项目地址:** [sPhyos/cve-2024-32019-PoC](https://github.com/sPhyos/cve-2024-32019-PoC)

**漏洞详情:** [CVE-2024-32019](https://nvd.nist.gov/vuln/detail/CVE-2024-32019)