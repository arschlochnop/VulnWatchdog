## CVE-2023-5360 - Royal Elementor Addons and Templates - Unauthenticated Arbitrary File Upload

**漏洞编号:** CVE-2023-5360

**漏洞类型:** 任意文件上传

**影响应用:** Royal Elementor Addons and Templates WordPress plugin

**危害等级:** 高危，可能导致远程代码执行 (RCE)

**影响版本:** < 1.3.79

**利用条件:** 目标WordPress站点安装了Royal Elementor Addons and Templates插件，且版本低于1.3.79，无需身份验证即可利用。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2023-5360 漏洞存在于 Royal Elementor Addons and Templates WordPress 插件中，版本低于 1.3.79。该插件未正确验证上传的文件，允许未经身份验证的用户上传任意文件，包括 PHP 文件，从而导致远程代码执行（RCE）。

**漏洞利用方式：**

1.  **获取 Elementor nonce：** 攻击者首先访问包含 Elementor 组件的页面，从 HTML 源代码中提取 `WprConfig` 变量中的 `nonce` 值。该nonce用于绕过插件的安全性检查。
2.  **构造恶意请求：** 攻击者构造一个 POST 请求，发送到 `/wp-admin/admin-ajax.php` 端点，其中包含以下参数：
    *   `wpr_addons_nonce`:  从目标站点获取的 nonce 值。
    *   `max_file_size`:  文件大小限制。
    *   `allowed_file_types`:  允许的文件类型。
    *   `action`:  设置为 `wpr_addons_upload_file`，触发文件上传功能。
    *   `triggering_event`:  触发事件。
    *   `uploaded_file`:  包含恶意 PHP 代码的文件，文件名为 `shell-{random.randint(1000,9999)}.php`。
3.  **上传恶意文件：**  攻击者将构造的 POST 请求发送到目标服务器，服务器将上传恶意 PHP 文件。
4.  **执行恶意代码：**  攻击者通过访问上传的 PHP 文件，即可执行其中的恶意代码，控制目标服务器。

**代码分析和投毒风险评估：**

提供的 Python 脚本 `CVE-2023-5360.py` 实现了上述漏洞利用过程。脚本的主要功能包括：

*   **获取 nonce：**  从目标页面提取 Elementor nonce。
*   **生成 payload：** 允许用户选择简单的webshell或者反弹shell。webshell是利用php的system()函数来执行命令，反弹shell是通过bash反弹shell到攻击者的IP地址和端口。
*   **上传文件：**  构造并发送 POST 请求，上传包含恶意 PHP 代码的文件。
*   **触发 payload：**  访问上传的文件，触发恶意代码的执行。
*   **启动监听器（可选）：**如果选择反弹shell，脚本可以自动启动一个`nc`监听器。

代码中未发现明显的恶意代码或后门，主要功能是利用漏洞上传并执行用户选择的payload。脚本的意图是明确的，即利用 CVE-2023-5360 漏洞进行渗透测试或攻击。

**结论：**

*   **有效性：**  提供的 POC 代码有效，可以利用 CVE-2023-5360 漏洞在目标服务器上上传并执行任意 PHP 代码。
*   **投毒风险：**  代码中没有明显的投毒代码，因此投毒风险较低。可以认为投毒风险为0%。

**项目地址:** [X3RX3SSec/CVE-2023-5360](https://github.com/X3RX3SSec/CVE-2023-5360)

**漏洞详情:** [CVE-2023-5360](https://nvd.nist.gov/vuln/detail/CVE-2023-5360)