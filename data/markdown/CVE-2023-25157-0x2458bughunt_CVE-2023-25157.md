## CVE-2023-25157-GeoServer-SQL注入

**漏洞编号:** CVE-2023-25157

**漏洞类型:** SQL注入

**影响应用:** GeoServer

**危害等级:** 高危，可能导致数据泄露和远程代码执行

**影响版本:** < 2.21.4, >= 2.22.0, < 2.22.2

**利用条件:** 需要网络访问到存在漏洞的GeoServer实例

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-25157是GeoServer中的一个SQL注入漏洞。根据漏洞库信息，该漏洞存在于2.22.0到2.22.2之前的版本以及2.21.4之前的版本。搜索引擎结果也确认了该漏洞的存在，并提供了相关的分析和检测方法。提供的POC代码包含两个Python脚本：

*   `GeoServer_Path-Finder.py`: 这个脚本用于检测目标主机上是否存在GeoServer的WFS服务，通过访问`/geoserver/ows?service=WFS&version=1.0.0&request=GetCapabilities`路径来判断。如果返回状态码为200，则认为服务存在，并将URL写入到输出文件中。
*   `GeoServer_Keyword-Checker.py`: 这个脚本用于检查目标网站的响应内容中是否包含特定的关键词，例如`<Title>GeoServer Web Feature Service</Title>`，用于验证GeoServer是否运行，但该脚本和SQL注入漏洞本身关联不大.

虽然提供的Python脚本本身并不直接利用SQL注入漏洞，但是它们可以作为漏洞利用的前期侦察手段，用于发现目标环境中存在的GeoServer实例。找到目标实例后，攻击者可以利用CQL注入点构造恶意的SQL查询，从而读取数据库信息甚至执行任意代码。

**有效性：**

提供的脚本本身并不能直接利用SQL注入，但可以作为漏洞利用前期信息收集的辅助工具。其有效性体现在能够快速识别目标网络中运行的Geoserver服务。

**投毒风险：**

通过分析代码，发现投毒风险较低。`GeoServer_Path-Finder.py` 和 `GeoServer_Keyword-Checker.py` 的主要功能是发送HTTP请求并检查响应。虽然存在通过hosts文件传入目标地址，但该操作属于脚本的正常功能，而非恶意代码植入。脚本对输入的主机列表没有做任何过滤和校验，如果攻击者控制了hosts文件，是有可能通过注入恶意链接来redirect到其他站点，造成信息泄露或者XSS。所以风险评估为10%。

**利用方式：**

1.  **信息收集：** 使用 `GeoServer_Path-Finder.py` 扫描目标网络，查找运行Geoserver的实例。
2.  **验证服务：** 找到Geoserver实例后,通过访问`/geoserver/ows?service=WFS&version=1.0.0&request=GetCapabilities`路径验证Geoserver服务是否存在。
3.  **SQL注入：** 确定存在漏洞的GeoServer实例后，利用OGC Filter表达式语言或CQL中的SQL注入点，构造恶意的SQL查询语句，发送到服务器。
4.  **数据窃取/代码执行：** 成功注入后，根据具体的注入点和数据库配置，可以读取敏感数据、修改数据库内容，甚至执行任意代码。

**项目地址:** [0x2458bughunt/CVE-2023-25157](https://github.com/0x2458bughunt/CVE-2023-25157)

**漏洞详情:** [CVE-2023-25157](https://nvd.nist.gov/vuln/detail/CVE-2023-25157)