## CVE-2023-22515-Confluence-Broken Access Control

**漏洞编号:** CVE-2023-22515

**漏洞类型:** Broken Access Control

**影响应用:** Atlassian Confluence Data Center and Server

**危害等级:** 高危，未经身份验证的攻击者可以创建 Confluence 管理员帐户并访问 Confluence 实例

**影响版本:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**利用条件:** Confluence Data Center 和 Server 实例必须公开访问，且未完成初始化设置

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-22515 是 Atlassian Confluence Data Center 和 Server 中的一个严重漏洞，属于访问控制错误。未经身份验证的远程攻击者可以利用此漏洞创建未经授权的 Confluence 管理员帐户，从而完全控制受影响的 Confluence 实例。

**有效性分析：**

根据漏洞信息、搜索结果以及提供的漏洞利用代码，该漏洞的利用具有较高的有效性。

*   **漏洞信息：** CVE 信息明确指出这是一个 Broken Access Control 漏洞，且有实际利用案例。
*   **搜索结果：** 搜索结果显示，该漏洞已被广泛讨论和利用，多个安全厂商发布了相关报告和预警，CISA也将此漏洞收录到KEV。
*   **漏洞利用代码：** 提供的 Python 脚本 `cve-2023-22515.py` 实现了创建管理员帐户的功能，通过发送特定的 HTTP 请求到未完成设置的 Confluence 实例，可以绕过身份验证，创建新的管理员帐户。

**投毒风险分析：**

*   **README.md:**  `README.md` 文件描述了脚本的使用方法，没有发现可疑代码。
*   **cve-2023-22515.py:**  `cve-2023-22515.py` 主要功能是利用 Confluence 的未授权初始化设置接口创建管理员账号。代码逻辑较为清晰，主要包含以下步骤：
    1.  `request_1` 函数：用于检测 Confluence 实例是否处于未初始化状态 (`/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`)，检查是否存在漏洞。
    2.  `request_2` 函数：通过 POST 请求向 `/setup/setupadministrator.action` 发送用户名、密码和邮箱等信息，创建管理员帐户。
    3.  `request_3` 函数：通过 POST 请求向 `/setup/finishsetup.action` 发送请求，完成设置。
代码中使用了 `requests` 库发送 HTTP 请求，并设置了一些常用的 Header。变量 `headers1`, `headers2`, `headers3` 中未发现恶意代码。 脚本通过参数 `-H`, `-U`, `-PW`, `-E`, `-P` 接受用户指定的 URL、用户名、密码、邮箱和代理设置，增强了脚本的灵活性。

综合来看，此脚本主要功能是利用漏洞创建管理员，但依然存在一定的投毒风险，例如：

*   **代理劫持风险：** 脚本支持代理设置 (`-P` 或 `--proxies`)。如果攻击者提供恶意代理服务器，可能会导致流量劫持或中间人攻击。
*   **依赖包风险：** 虽然代码本身没有明显的恶意行为，但如果 `requests` 或 `tld` 等依赖库被恶意篡改，同样可能引入安全风险。

因此，**投毒风险评估为 10%**。主要是考虑到用户可能会使用恶意代理或者依赖包存在被篡改的可能性。

**利用方式：**

1.  **目标检测：** 攻击者首先需要找到存在漏洞且未完成初始化的 Confluence Data Center 或 Server 实例。通过访问 `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false` 接口，如果返回状态码为 200，则表明目标可能存在漏洞。
2.  **创建管理员帐户：** 攻击者使用漏洞利用脚本，指定目标 Confluence 实例的 URL，并提供用户名、密码和邮箱等信息。脚本会向 `/setup/setupadministrator.action` 接口发送 POST 请求，创建新的管理员帐户。
3.  **完成初始化设置：** 脚本会向 `/setup/finishsetup.action` 接口发送 POST 请求，完成 Confluence 的初始化设置。
4.  **登录和控制：** 攻击者使用新创建的管理员帐户登录 Confluence，获得管理员权限，从而可以完全控制 Confluence 实例。

**项目地址:** [DsaHen/cve-2023-22515-exp](https://github.com/DsaHen/cve-2023-22515-exp)

**漏洞详情:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)