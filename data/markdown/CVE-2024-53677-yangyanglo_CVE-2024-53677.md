## CVE-2024-53677-Apache Struts 文件上传路径遍历导致RCE

**漏洞编号:** CVE-2024-53677

**漏洞类型:** 文件上传路径遍历

**影响应用:** Apache Struts

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 2.0.0 < Version < 6.4.0

**利用条件:** 需要开启了基于FileuploadInterceptor的旧文件上传逻辑

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-53677 是一个 Apache Struts 框架中的文件上传漏洞，允许攻击者通过操纵文件上传参数，实现路径遍历，最终可能导致远程代码执行。

**有效性：**
根据漏洞库信息和搜索结果，此漏洞确实存在，且具有较高的风险。提供的POC代码尝试利用此漏洞，其基本原理是通过修改上传的文件名参数，使其包含路径遍历字符（如`../`），从而将文件上传到Web服务器上非预期的目录中。POC代码通过`-u`指定上传地址，`-filename`指定包含路径遍历的文件名，`-file`指定需要上传的文件，`-type`指定上传类型(单文件或多文件)。如果服务器对上传的文件类型没有严格限制，攻击者可以上传包含恶意代码的JSP文件或其他脚本文件，从而执行任意命令。

**投毒风险：**
仔细审查了提供的POC代码（s2-067.py），没有发现任何明显的投毒代码。该脚本的主要功能是构造包含路径遍历的文件上传请求，并发送给目标服务器。脚本本身没有执行任何恶意操作，例如下载、执行其他程序或修改系统配置。因此，判断此仓库中存在作者隐藏的投毒代码的可能性为0%。

**利用方式：**
1.  **确定目标：**  首先需要确定目标Apache Struts应用存在漏洞，并且使用了旧的文件上传机制（基于`FileuploadInterceptor`）。
2.  **构造恶意请求：**  使用POC代码或类似工具，构造包含路径遍历的文件上传请求。关键在于修改`filename`参数，使其包含`../`序列，指向Web服务器上可写目录。
3.  **上传恶意文件：**  将包含恶意代码的JSP文件（或其他类型的Web脚本文件）作为上传内容。
4.  **触发恶意代码：**  上传成功后，通过Web浏览器或其他工具访问上传的恶意文件，触发其中的代码执行。

**漏洞缓解措施:**

1. 升级到Apache Struts 6.4.0或更高版本。
2. 迁移到新的文件上传机制。
3. 如果无法迁移，限制上传文件的后缀名，使用自定义随机文件名称。

**项目地址:** [yangyanglo/CVE-2024-53677](https://github.com/yangyanglo/CVE-2024-53677)

**漏洞详情:** [CVE-2024-53677](https://nvd.nist.gov/vuln/detail/CVE-2024-53677)