## CVE-2024-38063-Windows TCP/IP远程代码执行漏洞

**漏洞编号:** CVE-2024-38063

**漏洞类型:** 远程代码执行

**影响应用:** Windows TCP/IP 协议栈

**危害等级:** 严重，可能导致远程代码执行，完全控制受影响系统

**影响版本:** 受影响的Windows版本包括Windows 10, Windows 11, Windows Server 2008 至 2022，详情见漏洞库信息

**利用条件:** 需要目标系统启用IPv6，攻击者需要能够向目标系统发送IPv6数据包。

**POC 可用性:** 是

**投毒风险:** 30%

## 详情

CVE-2024-38063 是一个Windows TCP/IP协议栈中的远程代码执行漏洞，CVSS评分为9.8，属于严重级别漏洞。利用该漏洞，攻击者可以通过发送特制的IPv6数据包，实现在目标系统上执行任意代码。由于TCP/IP协议栈是Windows操作系统的核心组件，该漏洞一旦被成功利用，可能导致受影响系统被完全控制。 

**有效性分析：**
根据搜索引擎结果和漏洞库信息，该漏洞是一个真实的、高危的远程代码执行漏洞。漏洞利用代码看起来有效，它尝试通过构造畸形的IPv6数据包，触发整数下溢漏洞，并利用该漏洞执行任意代码。

**投毒风险分析：**
该漏洞利用代码（packetmanipulation.pl）本身是用Perl编写的，并内嵌了C代码。Perl脚本用于处理命令行参数、构建IPv6数据包以及发送数据包。C代码负责生成包含漏洞利用的payload。  以下为风险点分析:
*   **代码复杂性：** 代码具有一定复杂性，包含了数据包构造、网络发送、以及C语言payload生成等多个环节，这增加了代码审查的难度，可能隐藏恶意代码。
*   **随机性和自适应性：** 代码中存在一些随机数生成和自适应的特性（`rand()`函数、`autoevade`参数），这使得恶意行为更难被预测和检测。如果这些随机数或者自适应行为被用于植入后门，则排查更加困难。
*   **内嵌C代码：** C代码部分负责生成payload，是漏洞利用的核心。对C代码的分析需要更专业的知识，也更容易隐藏恶意代码。例如，可以在payload中植入shellcode，或者在某些特定条件下触发恶意行为。
*   **payload生成方式：** Payload的生成方式 (create_cve_2024_38063_payload 函数) 较为复杂， 包含随机数据填充、特定字节的修改以及整数下溢的触发， 这使得代码阅读者难以快速识别是否存在恶意篡改。

尽管存在以上风险点，但经过初步分析，没有发现明显的恶意代码。payload的生成过程主要围绕漏洞利用展开，没有发现用于建立反向连接或执行恶意操作的函数。 风险点主要集中在以下几点： 1. 动态调整的SLEEP时间可能被滥用 2. 内嵌C代码存在通过修改关键参数达到远程控制。

因此，综合评估，投毒的风险大约为30%。

**利用方式分析：**
1.  **环境准备：** 攻击者需要一台能够发送原始IPv6数据包的机器，并且目标系统需要启用IPv6。
2.  **构造恶意数据包：** 利用提供的PoC代码，可以构造包含恶意payload的IPv6数据包。该payload旨在触发TCP/IP协议栈中的整数下溢漏洞。
3.  **发送数据包：** 将构造好的IPv6数据包发送给目标系统。
4.  **远程代码执行：** 如果漏洞利用成功，攻击者将在目标系统上获得代码执行权限，从而可以执行任意命令。

**项目地址:** [haroonawanofficial/CVE-2024-38063-Research-Tool](https://github.com/haroonawanofficial/CVE-2024-38063-Research-Tool)

**漏洞详情:** [CVE-2024-38063](https://nvd.nist.gov/vuln/detail/CVE-2024-38063)