## CVE-2023-0386 OverlayFS 本地提权漏洞

**漏洞编号:** CVE-2023-0386

**漏洞类型:** 本地提权

**影响应用:** Linux Kernel

**危害等级:** 高危，可使普通用户提升为root权限

**影响版本:** Linux kernel 6.2-rc6 及之前版本

**利用条件:** 需要本地用户权限，目标系统启用OverlayFS

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2023-0386 是一个 Linux 内核漏洞，存在于 OverlayFS 子系统中。该漏洞允许未经授权的用户通过 OverlayFS 绕过权限检查，从而执行具有 capabilities 属性的 setuid 文件。利用该漏洞，本地用户可以提升其在系统上的权限。

**有效性：**

根据搜索结果，已经有多个关于该漏洞的分析和利用的报告。 Rapid7 也有公开的利用模块。提供的代码中Makefile显示其编译流程,以及所需依赖, 能够编译poc,初步判断PoC的有效性较高。

**投毒风险：**

检查提供的PoC代码，包括 `Makefile`、`README.md`、`config` 文件,代码量较少，未发现明显的恶意代码或后门。虽然无法100%保证不存在隐藏的风险，但根据现有信息，投毒的可能性较低。配置文件是内核配置信息，不包含可执行代码。Makefile是编译脚本，主要用于控制编译过程，没有恶意行为。poc.c （未提供）是攻击的核心，投毒风险主要存在于该文件中。但是从Makefile 的编译参数来看，使用了 -static 参数，这会将所有依赖的库静态链接到可执行文件中，减少了运行时依赖，一定程度上降低了动态链接库替换的风险。总体评估风险较低，判定投毒风险为1%。

**利用方式：**

漏洞的利用方式是利用 OverlayFS 在复制具有 capabilities 属性的 setuid 文件时，uid 映射的错误。攻击者可以通过以下步骤利用该漏洞：

1.  创建一个具有 capabilities 属性的 setuid 文件在 nosuid 的挂载点上。
2.  使用 OverlayFS 将该文件复制到另一个挂载点。
3.  由于 uid 映射错误，复制后的文件可能保留 capabilities 属性，但 uid 变为攻击者的 uid。
4.  攻击者现在可以执行该文件，并获得与该文件原始所有者相同的权限，从而提升权限。

搜索结果中 vicarius.io 的文章 `CVE-2023-0386 A Linux kernel bug in overlayfs - vsociety` 提供了漏洞的原理和利用过程，可作为参考。

**项目地址:** [veritas501/CVE-2023-0386](https://github.com/veritas501/CVE-2023-0386)

**漏洞详情:** [CVE-2023-0386](https://nvd.nist.gov/vuln/detail/CVE-2023-0386)