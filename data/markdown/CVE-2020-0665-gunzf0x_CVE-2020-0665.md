## CVE-2020-0665 Active Directory 权限提升

**漏洞编号:** CVE-2020-0665

**漏洞类型:** 权限提升

**影响应用:** Active Directory

**危害等级:** 高危，可能允许攻击者提升在 Active Directory 环境中的权限

**影响版本:** 受影响的Windows版本包括Windows 7 SP1到Windows 10 1909以及对应的Windows Server版本

**利用条件:** 攻击者需要在受信任的林中拥有一个账户，并能够请求目标用户的 TGT 委派。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-0665 漏洞存在于 Active Directory 森林信任中，由于默认设置允许信任林中的攻击者请求受信任林中身份的 TGT 委派，从而导致权限提升。根据漏洞信息，多个版本的 Windows 和 Windows Server 受到影响。利用方式涉及使用 `frida` 库来拦截进程并修改 SID 过滤逻辑，从而绕过安全限制。攻击者需要提供子域 SID 和本地服务器 SID，并指定要拦截的进程（例如 lsass.exe）。PoC 代码通过修改进程内存中的 SID 过滤逻辑，使得攻击者可以获得更高的权限。

**有效性评估：**
提供的 PoC 代码似乎有效，因为它使用了 `frida` 库来动态地修改目标进程的内存。通过修改 SID 过滤，攻击者可以绕过原始的安全限制。

**投毒风险评估：**
PoC 代码的投毒风险较低，约为 10%。主要风险在于，攻击者可能会修改 PoC 代码，例如添加额外的恶意功能，比如在成功提权后执行任意代码。此外，在不了解代码的情况下运行，可能会对系统稳定性造成影响。

**利用方式：**
1.  攻击者需要在受信任的林中拥有一个账户。
2.  攻击者需要确定目标用户的 SID (Child SID) 和目标服务器的 SID (Local SID)。
3.  攻击者需要选择一个进程进行注入（建议 lsass.exe）。
4.  攻击者运行 PoC 代码，该代码会使用 `frida` 注入目标进程。
5.  `frida` 脚本会修改目标进程的 SID 过滤逻辑。
6.  攻击者现在可以请求目标用户的 TGT 委派，并获得更高的权限。

**项目地址:** [gunzf0x/CVE-2020-0665](https://github.com/gunzf0x/CVE-2020-0665)

**漏洞详情:** [CVE-2020-0665](https://nvd.nist.gov/vuln/detail/CVE-2020-0665)