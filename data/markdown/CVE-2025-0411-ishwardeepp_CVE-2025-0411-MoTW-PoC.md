## CVE-2025-0411 7-Zip Mark-of-the-Web Bypass Vulnerability

**漏洞编号:** CVE-2025-0411

**漏洞类型:** Mark-of-the-Web (MotW) Bypass

**影响应用:** 7-Zip

**危害等级:** 高危，可能导致任意代码执行，受害者无需察觉的情况下运行恶意程序

**影响版本:** 24.08 (x64) 及之前版本

**利用条件:** 用户需要访问恶意网页或打开恶意文件（例如，通过钓鱼邮件接收到的恶意压缩包）。7-Zip需要安装在受害者机器上。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2025-0411 存在于 7-Zip 的 Mark-of-the-Web (MotW) 处理中。当 7-Zip 从带有 MotW 标记的恶意压缩包中提取文件时，不会将 MotW 传播到提取的文件。这意味着，即使压缩包本身被标记为来自不受信任的来源，提取的文件也不会有任何安全警告，允许恶意代码在用户不知情的情况下执行。

**漏洞利用方式：**

1.  攻击者创建一个包含恶意可执行文件（例如 `executable.exe`）的压缩包，并将其放置在一个双层压缩包中(`double_compressed.7z`)。
2.  攻击者通过钓鱼或其他方式诱使用户下载该压缩包。
3.  如果用户使用易受攻击版本的 7-Zip (<=24.08) 打开并解压该压缩包，7-Zip 不会将 MotW 标记传播到提取的 `executable.exe` 文件。
4.  由于没有 MotW 标记，`executable.exe` 文件可以静默执行，从而允许攻击者在用户系统上运行任意代码。

**有效性：**

提供的 POC 代码似乎有效，它首先检查 7-Zip 版本，然后编译一个 C++ 文件（包含 shellcode），最后将其压缩到双层7z压缩包中。双层压缩是 MotW 绕过的关键，根据搜索结果，这种方法被恶意攻击者在实际攻击中使用。

**投毒风险：**

POC 代码本身包含一段 shellcode，这段shellcode如果被用户执行，将会触发恶意行为，比如连接攻击者的服务器，下载执行恶意文件，或者进行其他恶意操作，此行为是POC验证的后门代码,不能算作投毒代码。

README.md 中提到了 SmokeLoader 活动，以及该漏洞与 CVE-2024-38213 和 CVE-2024-21412 的相似性，这些信息都表明该漏洞已被积极利用，因此用户应该保持警惕。

虽然代码本身看起来没有明显的恶意代码，但需要考虑到以下几点：

*   **shellcode 的真实意图：** POC 中的 shellcode 包含一段二进制代码，需要对其进行分析才能确认其真实目的。虽然示例中提供的 shellcode 较为常见，但攻击者可以很容易地替换成更复杂的 shellcode，执行其他恶意操作。

因此，虽然代码本身没有明显的投毒代码，但存在 shellcode 被用于恶意目的的风险。这里将投毒风险评估为10%，主要是因为C++代码相对简单，主要风险在于Shellcode的内容。

**项目地址:** [ishwardeepp/CVE-2025-0411-MoTW-PoC](https://github.com/ishwardeepp/CVE-2025-0411-MoTW-PoC)

**漏洞详情:** [CVE-2025-0411](https://nvd.nist.gov/vuln/detail/CVE-2025-0411)