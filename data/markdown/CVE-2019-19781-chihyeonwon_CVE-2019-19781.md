## CVE-2019-19781 - Citrix ADC and Gateway Directory Traversal / Remote Code Execution

**漏洞编号:** CVE-2019-19781

**漏洞类型:** 目录遍历 / 远程代码执行

**影响应用:** Citrix Application Delivery Controller (ADC) 和 Gateway

**危害等级:** 高危，可能导致信息泄露和远程代码执行

**影响版本:** 10.5, 11.1, 12.0, 12.1, 13.0

**利用条件:** 目标系统存在漏洞，攻击者需要网络访问权限。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-19781是一个存在于Citrix ADC和Gateway中的目录遍历漏洞，未经身份验证的攻击者可以通过发送特制的HTTP请求来读取敏感文件，甚至执行任意代码。根据搜索引擎结果，该漏洞在野外被积极利用。漏洞利用代码显示，它通过操纵`/vpns/`路径，利用`newbm.pl`脚本中的目录遍历缺陷，将恶意XML文件写入到目标系统的`/netscaler/portal/templates/`目录。这个XML文件包含Perl代码，允许攻击者执行任意命令。攻击者首先添加包含恶意代码的书签，然后通过访问该书签对应的XML文件来触发命令执行。该代码有一定的投毒风险，主要体现在以下几个方面：

1.  **依赖性问题**：该POC依赖于目标系统特定的文件路径和脚本。如果目标系统的配置略有不同，POC可能无法正常工作。
2.  **命令执行上下文**：攻击者执行命令的权限取决于Citrix ADC/Gateway进程的运行权限。如果该进程的权限过高，可能导致系统范围的破坏。
3.  **日志和监控**：成功的利用会留下日志记录，使攻击者容易被检测到。为了避免检测，攻击者可能会试图清除日志或采取其他规避措施。
4.  **Perl 代码风险**：perl脚本本身可能存在其他安全问题，或者被用于执行其他恶意活动。

**利用方式：**

1.  发送包含目录遍历序列（例如`../`）的恶意HTTP请求到`/vpns/`路径下的某个易受攻击的脚本（例如`newbm.pl`）。
2.  通过构造特殊的`NSC_USER`头和`url`参数，将包含Perl代码的XML文件写入到目标系统的模板目录。
3.  访问写入的XML文件，触发Perl代码执行，从而执行任意命令。

根据CVE信息以及搜索引擎结果，该漏洞影响范围较广，危害性高。根据CISA的known exploited vulnerabilities catalog，该漏洞已被列入CISA, 积极被利用。

**项目地址:** [chihyeonwon/CVE-2019-19781](https://github.com/chihyeonwon/CVE-2019-19781)

**漏洞详情:** [CVE-2019-19781](https://nvd.nist.gov/vuln/detail/CVE-2019-19781)