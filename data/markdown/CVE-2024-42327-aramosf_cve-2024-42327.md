## CVE-2024-42327-Zabbix-SQL注入

**漏洞编号:** CVE-2024-42327

**漏洞类型:** SQL注入

**影响应用:** Zabbix

**危害等级:** 高危，可能导致权限提升、敏感信息泄露

**影响版本:** <= 7.0.1, <= 6.4.16, <= 6.0.31

**利用条件:** 需要Zabbix前端非管理员用户账户，且该账户具有API访问权限

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2024-42327是Zabbix前端API中CUser类的addRelatedObjects函数存在SQL注入漏洞。该漏洞允许拥有API访问权限的非管理员用户通过构造恶意的SQL语句来绕过权限验证，执行未授权的数据库操作。 

**有效性：**
根据漏洞库信息、搜索结果以及漏洞利用代码，该漏洞利用代码的有效性较高。漏洞库信息明确指出该漏洞存在，并提供了受影响的版本范围。搜索结果中，多个来源确认了该漏洞的存在及其严重性，并且有公开的PoC代码（如GitHub链接）。提供的PoC代码脚本通过Zabbix API登录，然后循环获取用户ID的信息，如果成功利用漏洞，可以泄露敏感信息。

**投毒风险：**
提供的PoC代码主要功能是利用SQL注入漏洞获取Zabbix用户信息。代码本身相对简单，主要是通过Zabbix的API进行身份验证和数据获取。虽然使用了`requests`库，但没有发现明显的恶意行为，例如执行系统命令或修改文件等。但是使用者要小心网络传输过程中的流量劫持，如果被投毒替换，则使用者有风险。经过详细分析，认为其中存在投毒代码的可能性较低，大概1%。

**利用方式：**
1.  **身份验证：** 使用有效的Zabbix用户名和密码，通过user.login API方法获取身份验证令牌（auth token）。
2.  **漏洞触发：** 使用获取的auth token，调用user.get API方法，构造包含恶意SQL语句的userids参数。由于CUser类的addRelatedObjects函数存在SQL注入，恶意SQL语句将被执行。
3.  **信息泄露：** 成功利用SQL注入后，攻击者可以获取数据库中的敏感信息，例如用户名、密码哈希等。
4.  **权限提升：**  通过SQL注入，攻击者可能提升自己的权限，甚至获取管理员权限。
5. **远程代码执行:** Github 上有通过此漏洞利用可以获取到RCE的代码。

总而言之，此漏洞的风险在于未经授权的数据访问和潜在的权限提升。PoC的存在以及CVSS评分9.9表明该漏洞较为严重，应及时修复。

**项目地址:** [aramosf/cve-2024-42327](https://github.com/aramosf/cve-2024-42327)

**漏洞详情:** [CVE-2024-42327](https://nvd.nist.gov/vuln/detail/CVE-2024-42327)