## CVE-2024-7627 - Bit File Manager WordPress Plugin RCE

**漏洞编号:** CVE-2024-7627

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Bit File Manager WordPress Plugin

**危害等级:** 高危，允许未经身份验证的攻击者执行任意代码

**影响版本:** 6.0 - 6.5.5

**利用条件:** 需要启用 Guest User Read 权限

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2024-7627 存在于 Bit File Manager WordPress 插件 6.0 到 6.5.5 版本中。当 Guest User Read 功能启用时，`checkSyntax` 函数中存在竞争条件漏洞。攻击者可以通过发送包含恶意代码的文件，利用此漏洞在服务器上执行任意代码。

**利用方式：**

1.  **获取 AJAX nonce：** POC 代码首先从文件管理器的页面获取一个有效的 AJAX nonce。这个 nonce 用于通过身份验证。
2.  **获取随机文件hash：**POC代码通过读取目录文件列表，获取一个可写的文件hash值。
3.  **写入恶意PHP代码：** POC 代码尝试将包含恶意 PHP 代码（允许执行任意系统命令）写入 `/wp-content/uploads/file-managertemp.php`。这是利用竞争条件的关键步骤，通过并发请求，尝试在文件验证之前访问该临时文件。
4.  **执行命令：** 一旦恶意 PHP 代码写入成功，攻击者可以通过访问 `EDITED_TEMPORARY_FILE_URL` 并传递 `cmd` 参数来执行系统命令，例如 `id`、`uname -a` 或 `whoami`。
5.  **交互式Shell：**POC代码提供一个交互式的Shell来与目标系统交互

**有效性：**

根据漏洞描述、搜索引擎结果以及提供的 PoC 代码，可以判断此漏洞利用是有效的。

**投毒风险：**

PoC 代码的主要功能是利用已知的 RCE 漏洞，并非旨在进行恶意投毒。代码中包含从目标站点获取 nonce 和文件 hash 的逻辑，这表明它旨在利用目标站点自身的功能，而不是引入外部恶意代码。虽然不能完全排除极小的投毒风险（例如，通过修改 `PHP_PAYLOAD`变量达到攻击者控制的目的），但整体投毒风险较低。综上，判断投毒风险为1%。

**项目地址:** [lkmn1/CVE-2024-7627](https://github.com/lkmn1/CVE-2024-7627)

**漏洞详情:** [CVE-2024-7627](https://nvd.nist.gov/vuln/detail/CVE-2024-7627)