## CVE-2022-21661-WordPress-SQL注入

**漏洞编号:** CVE-2022-21661

**漏洞类型:** SQL注入

**影响应用:** WordPress

**危害等级:** 高危，可能导致数据泄露、数据篡改甚至远程代码执行

**影响版本:** < 5.8.3

**利用条件:** 需要目标WordPress站点开启了`wp-admin/admin-ajax.php`接口，且服务器运行着存在漏洞的WordPress版本。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2022-21661是WordPress中`WP_Query`类由于不当的输入过滤导致的SQL注入漏洞。攻击者可以利用此漏洞，通过构造恶意的SQL查询语句，影响数据库操作。根据漏洞库信息和搜索引擎结果，此漏洞的利用复杂度较高(CVSS Attack Complexity: HIGH)，需要具有一定权限(CVSS Privileges Required: HIGH)。提供的PoC代码 `main.py` 尝试通过两种方式验证漏洞的存在：首先，它发送一个包含恶意SQL语句的POST请求到`wp-admin/admin-ajax.php`，利用`extractvalue()`函数尝试提取数据库信息，如果返回结果中包含随机字符串的MD5哈希值，则判断为存在漏洞。其次，如果第一个测试失败，它会尝试基于时间的盲注，通过`sleep(5)`函数来判断是否存在SQL注入。如果服务器响应时间超过5秒，则也判断为存在漏洞。

**有效性：**根据漏洞信息和PoC代码分析，此PoC具有较高的有效性，可以用于检测目标WordPress站点是否存在CVE-2022-21661漏洞。

**投毒风险：** 代码主要功能是发送特制的HTTP请求以验证SQL注入漏洞。未发现明显的恶意代码，例如文件写入，系统命令执行等。但是，`requirements.txt`文件缺失，无法完整评估是否存在依赖库投毒的可能。代码逻辑相对简单，主要是发送HTTP请求并判断响应，直接构成严重危害的可能性较低。因此，投毒风险较低，估计在1%以下。尽管如此，仍然建议仔细审查依赖项，并在受控环境中运行PoC。

**利用方式：** 攻击者首先访问`/wp-admin/admin-ajax.php`，如果返回400错误且包含'0'，则继续尝试利用SQL注入。攻击者通过构造包含恶意SQL语句的POST请求到`/wp-admin/admin-ajax.php`，利用`tax_query`参数中的`term_taxonomy_id`字段进行注入。PoC尝试使用`extractvalue()`函数提取信息或使用`sleep()`函数进行时间盲注来验证漏洞的存在。

**项目地址:** [sealldeveloper/CVE-2022-21661-PoC](https://github.com/sealldeveloper/CVE-2022-21661-PoC)

**漏洞详情:** [CVE-2022-21661](https://nvd.nist.gov/vuln/detail/CVE-2022-21661)