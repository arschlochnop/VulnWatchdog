## CVE-2024-3400 PAN-OS GlobalProtect 远程命令执行

**漏洞编号:** CVE-2024-3400

**漏洞类型:** 命令注入

**影响应用:** PAN-OS GlobalProtect

**危害等级:** 高危，允许未授权的攻击者以root权限执行任意代码

**影响版本:** PAN-OS 10.2.0 < 10.2.9-h1, PAN-OS 11.0.0 < 11.0.4-h1, PAN-OS 11.1.0 < 11.1.2-h3， 并且配置了GlobalProtect网关或门户

**利用条件:** 目标系统需要配置GlobalProtect网关或门户，且版本在受影响范围内

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-3400 是 Palo Alto Networks PAN-OS 软件 GlobalProtect 功能中的一个命令注入漏洞，由于任意文件创建导致。根据Volexity的分析和 Palo Alto Networks 的公告，该漏洞允许未经身份验证的攻击者在防火墙上以 root 权限执行任意代码。

**有效性：**
根据漏洞信息和搜索结果，该漏洞的PoC是有效的，并且已经被积极利用。CISA已经将其添加到已知被利用漏洞的目录中。提供的PoC代码通过构造包含目录遍历的 Cookie，尝试访问`/var/appweb/sslvpndocs/global-protect/portal/images/watchtowr.txt`，从而验证漏洞的存在。

**投毒风险：**
此PoC代码本身相对简单，主要用于验证漏洞是否存在。投毒风险较低，估计在10%左右。尽管如此，任何从非官方来源下载的代码都存在潜在风险。用户应仔细审查代码，理解其功能，并在隔离环境中运行。潜在的投毒方式可能包括：

*   **恶意URL重定向：** PoC 中使用的 URL 可能会被更改为指向恶意站点，诱骗用户下载其他恶意软件。
*   **命令注入修改：** 攻击者可能修改 PoC 代码，添加额外的命令注入 payload，在测试时执行恶意操作。

**利用方式：**
1.  **漏洞触发：** 通过构造包含目录遍历的 `SESSID` Cookie，发送到 `/ssl-vpn/hipreport.esp` 路径。
2.  **任意文件创建：** 成功利用后，攻击者可以创建任意文件。
3.  **命令注入：** 利用任意文件创建漏洞，执行任意操作系统命令，最终获得 root 权限。

总体而言，该漏洞影响严重，利用方式简单，已经出现公开的PoC，建议尽快修复。

**项目地址:** [tfrederick74656/cve-2024-3400-poc](https://github.com/tfrederick74656/cve-2024-3400-poc)

**漏洞详情:** [CVE-2024-3400](https://nvd.nist.gov/vuln/detail/CVE-2024-3400)