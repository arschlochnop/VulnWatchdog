## CVE-2020-0796-Windows SMBv3远程代码执行

**漏洞编号:** CVE-2020-0796

**漏洞类型:** 远程代码执行

**影响应用:** Windows SMBv3

**危害等级:** 高危，可能导致远程代码执行和系统控制

**影响版本:** Windows 10 Version 1903/1909, Windows Server Version 1903/1909

**利用条件:** 目标系统需要启用SMBv3协议，且未安装相关补丁

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-0796（也称为SMBGhost）是Microsoft Server Message Block 3.1.1 (SMBv3) 协议处理特定请求时存在的一个远程代码执行漏洞。攻击者可以通过构造恶意的SMBv3数据包发送到目标服务器，触发缓冲区溢出，从而实现远程代码执行。

**有效性：**
根据漏洞库信息和搜索引擎结果，存在公开可用的PoC代码，证明了该漏洞的可利用性。提供的漏洞利用代码看起来像是对现有 PoC 的自动化包装器，集成了漏洞检测和利用功能。代码中提到 "This exploit is not **stable**"，表明利用可能存在不稳定性，成功率并非100%。

**投毒风险：**
分析提供的Python代码（Smb_Ghost.py）和README.md文件，存在一定的投毒风险，但概率较低。理由如下：
*   代码中引用了其他GitHub仓库的扫描器和漏洞利用代码，如果这些仓库被投毒，可能会间接影响该代码。
*   代码中允许用户加载自定义shellcode，如果用户加载了恶意的shellcode，可能会对目标系统造成危害。因此，用户需要谨慎使用该功能。
*   README中提供的MEGA下载链接存在潜在风险，因为用户可能下载到被篡改的恶意ISO镜像。
*   根据风险评估，投毒风险大概为10%，主要存在于间接依赖和用户自定义shellcode环节。

**利用方式：**
1.  **漏洞检测：** 使用脚本自带的扫描器（基于ioncodes的scanner）检测目标系统是否存在SMBGhost漏洞。扫描器主要检查目标系统是否启用了易受攻击的SMBv3.1.1协议。
2.  **漏洞利用：** 如果目标系统存在漏洞，使用脚本中的漏洞利用模块（基于chompie1337的SMBGhost_RCE_PoC）发送特制的SMBv3数据包，触发缓冲区溢出。
3.  **远程代码执行：** 通过缓冲区溢出，攻击者可以执行任意代码。脚本支持两种方式：
    *   使用msfvenom生成反向shell，从而获得目标系统的控制权。
    *   加载自定义的shellcode，执行特定的恶意操作，例如添加用户到管理员组。

总之，该漏洞利用方式是先检测，后利用，利用成功后可以执行任意代码。用户需要注意自定义shellcode的安全性，以及MEGA链接下载的ISO镜像的安全性。

**项目地址:** [Barriuso/SMBGhost_AutomateExploitation](https://github.com/Barriuso/SMBGhost_AutomateExploitation)

**漏洞详情:** [CVE-2020-0796](https://nvd.nist.gov/vuln/detail/CVE-2020-0796)