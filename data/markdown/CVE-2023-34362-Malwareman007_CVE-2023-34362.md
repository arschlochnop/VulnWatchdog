## CVE-2023-34362-MOVEit Transfer-SQL注入

**漏洞编号:** CVE-2023-34362

**漏洞类型:** SQL注入

**影响应用:** MOVEit Transfer

**危害等级:** 高危，可能导致数据泄露、数据篡改和远程代码执行

**影响版本:** 受影响版本包括2021.0.6 (13.0.6)之前的版本, 2021.1.4 (13.1.4)之前的版本, 2022.0.4 (14.0.4)之前的版本, 2022.1.5 (14.1.5)之前的版本, 和 2023.0.1 (15.0.1)之前的版本,以及所有早于这五个版本的版本 (例如，2020.0和2019x)

**利用条件:** 需要网络访问，未授权攻击即可利用

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-34362是MOVEit Transfer中的一个SQL注入漏洞，攻击者可以通过构造恶意的SQL语句，利用guestaccess.aspx页面，从而获取对数据库的未授权访问，甚至执行任意SQL命令。

**漏洞利用有效性:**
根据漏洞信息、搜索结果和提供的POC代码，该漏洞利用的有效性较高。漏洞库信息表明这是一个在野利用的漏洞，搜索引擎结果也证实了这一点，并提到Clop勒索软件团伙利用此漏洞进行攻击。POC代码尝试利用guestaccess.aspx进行SQL注入，通过设置特定的session变量，将SQL语句注入到数据库查询中。

**投毒风险分析:**
POC代码本身看起来是用于利用漏洞的，但存在潜在的投毒风险。create_jwt 函数尝试读取key.pem和cert.crt，如果这两个文件被替换为恶意文件，攻击者有可能通过该POC植入后门。由于需要文件读取，且代码逻辑较为复杂，存在一定被植入恶意代码的风险，风险程度为10%。

**利用方式:**
1.  **获取CSRF Token:** 首先，利用`get_csrf`函数发送POST请求到`guestaccess.aspx`，获取CSRF Token。
2.  **设置Session变量:** 利用`set_session_variables`函数，通过`MOVEitISAPI.dll`设置包含恶意SQL语句的Session变量。该函数通过构造特定的HTTP头，绕过身份验证，将恶意SQL代码传递到后端。
3.  **触发SQL注入:** 调用`do_guest_access`函数，通过发送包含CSRF Token和相关参数的POST请求到`guestaccess.aspx`，触发SQL注入。
4.  **执行SQL语句:** 恶意SQL语句被执行，可能导致数据泄露、篡改或远程代码执行。
5.  **创建JWT(可疑):**create_jwt函数创建jwt，读取证书文件，这可能被用于身份认证绕过或者其他恶意操作，但是否一定存在恶意行为有待进一步分析。

**项目地址:** [Malwareman007/CVE-2023-34362](https://github.com/Malwareman007/CVE-2023-34362)

**漏洞详情:** [CVE-2023-34362](https://nvd.nist.gov/vuln/detail/CVE-2023-34362)