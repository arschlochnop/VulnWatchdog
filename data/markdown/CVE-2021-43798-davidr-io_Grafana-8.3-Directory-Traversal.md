## CVE-2021-43798-Grafana-目录遍历

**漏洞编号:** CVE-2021-43798

**漏洞类型:** 目录遍历

**影响应用:** Grafana

**危害等级:** 高危，可能导致敏感信息泄露

**影响版本:** >= 8.0.0, < 8.0.7; >= 8.1.0, < 8.1.8; >= 8.2.0, < 8.2.7; = 8.3.0

**利用条件:** 需要网络访问，目标Grafana实例存在受影响的版本。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

该漏洞是Grafana中的一个目录遍历漏洞，攻击者可以通过构造特殊的URL，读取服务器上的任意文件。根据漏洞库信息，受影响的版本包括8.0.0-beta1到8.3.0（除了已修复的版本）。漏洞利用代码提供了一个Python脚本，该脚本允许用户指定要读取的文件，并利用漏洞读取文件内容。利用方式是通过 `http://{ip}:{port}/public/plugins/alertlist/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e{file2read}` 这样的URL进行目录穿越，读取目标文件。

**有效性：**

根据漏洞信息和提供的PoC代码，可以判断该PoC代码是有效的。PoC代码直接利用了漏洞描述中的URL路径进行文件读取，并提供交互式界面方便读取任意文件。搜索结果中的文章也证明了漏洞的存在和可利用性。

**投毒风险：**

分析提供的Python脚本 `readFiles.py`，该脚本主要功能是构造恶意URL来读取文件，本身不存在恶意代码，例如反弹shell，植入后门等行为。脚本只是简单地发送HTTP请求并打印响应。因此，投毒风险较低，为0%。

**利用方式：**

1.  确定目标Grafana实例的版本是否在受影响的范围内。
2.  找到安装的插件ID（此处PoC中使用的是 `alertlist`）。
3.  使用提供的Python脚本 `readFiles.py`，指定目标Grafana实例的IP地址和端口号。
4.  在脚本提示符下，输入要读取的文件路径（例如 `/etc/passwd`）。
5.  脚本将构造恶意URL并发送HTTP请求，然后打印响应内容，即目标文件的内容。
6.  可以通过多次输入不同的文件路径来读取多个文件。

**项目地址:** [davidr-io/Grafana-8.3-Directory-Traversal](https://github.com/davidr-io/Grafana-8.3-Directory-Traversal)

**漏洞详情:** [CVE-2021-43798](https://nvd.nist.gov/vuln/detail/CVE-2021-43798)