## CVE-2017-16995-Linux Kernel BPF 权限提升

**漏洞编号:** CVE-2017-16995

**漏洞类型:** 本地权限提升

**影响应用:** Linux Kernel

**危害等级:** 高危，允许本地用户提升权限

**影响版本:** <= 4.4

**利用条件:** 需要本地用户权限, 目标内核版本在受影响范围内并且启用了 BPF_SYSCALL

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2017-16995 漏洞存在于Linux内核的BPF验证器中，具体是 `kernel/bpf/verifier.c` 文件的 `check_alu_op` 函数。由于不正确的符号扩展，本地用户可以利用此漏洞导致拒绝服务（内存损坏）或可能造成未指定的其他影响，最终实现本地权限提升。漏洞影响内核版本至4.4。

**有效性评估：**
漏洞库信息、搜索引擎结果和Exploit-DB均表明存在该漏洞，且有公开可用的EXP。搜索结果中GitHub链接 `https://github.com/senyuuri/cve-2017-16995` 指出了有针对此漏洞的源码分析和利用代码。

**投毒风险评估：**
提供的POC代码只有一个编译脚本 `compile.sh`，脚本中包含了编译 `hello.c`, `doubleput.c` 和 `suidhelper.c` 的命令，没有发现明显的恶意代码或者下载其他文件的行为。投毒风险较低，大概在 10%。当然不排除在其他源文件中存在隐藏的后门代码。需要检查 `hello.c`, `doubleput.c` 和 `suidhelper.c` 的源代码才能最终确定是否存在投毒行为。

**利用方式分析：**
根据搜索结果和漏洞描述，该漏洞是由于 BPF 验证器在处理算术运算时，符号扩展存在缺陷，导致可以绕过验证器的安全检查，从而构造恶意的 BPF 程序。攻击者利用此漏洞，可以通过 bpf(2) 系统调用提交恶意的 BPF 程序，实现任意内存读写，最终覆盖敏感数据结构如用户凭据等，从而提升权限。EXP通常会利用这个漏洞来覆盖进程的 `cred` 结构体，将其uid/gid设置为0，达到root权限。

**项目地址:** [ivilpez/cve-2017-16995.c](https://github.com/ivilpez/cve-2017-16995.c)

**漏洞详情:** [CVE-2017-16995](https://nvd.nist.gov/vuln/detail/CVE-2017-16995)