## CVE-2021-41773 - Apache HTTP Server Path Traversal & Remote Code Execution

**漏洞编号:** CVE-2021-41773

**漏洞类型:** 路径遍历 & 远程代码执行

**影响应用:** Apache HTTP Server

**危害等级:** 高危，允许未授权的攻击者访问敏感信息，甚至执行任意代码。

**影响版本:** 2.4.49

**利用条件:** 目标服务器运行Apache HTTP Server 2.4.49，并且配置允许CGI脚本执行或者存在Alias-like指令的配置。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2021-41773 是 Apache HTTP Server 2.4.49 版本中存在的一个路径遍历漏洞。攻击者可以利用该漏洞，通过构造特殊的 URL，绕过 Alias-like 指令的限制，访问服务器上受限目录之外的文件。如果服务器同时启用了 CGI 脚本执行，攻击者还可以通过该漏洞执行任意代码。

**有效性：**

提供的 PoC 代码是有效的。通过发送包含 URL 编码的路径遍历字符的 HTTP 请求，可以读取`/etc/passwd`等敏感文件，或者如果启用了 CGI，则可以执行系统命令。

例如，使用 `curl http://localhost:8080/cgi-bin/.%2e/.%2e/.%2e/.%2e/etc/passwd` 可以尝试读取`/etc/passwd`文件。
如果服务器配置允许 CGI 执行，使用 `curl 'localhost:8080/cgi-bin/.%2e/.%2e/.%2e/.%2e/bin/sh' -d 'A=|echo;id'` 可以在服务器上执行 `id` 命令。

**投毒风险：**

查看提供的 Dockerfile 和 httpd.conf 文件，未发现明显的恶意代码。`blueteamsteve` 提供的 Docker 镜像配置目的是为了复现漏洞，使得利用更加方便。虽然代码本身没有恶意，但如果攻击者修改 Dockerfile 或者 httpd.conf 文件，加入恶意代码并重新构建镜像，可能会存在投毒风险。从现有信息判断，代码本身投毒风险极低，给出1%的概率。 

**利用方式：**

1.  **路径遍历：** 攻击者通过构造包含`/.%2e/.%2e/`的特殊 URL，尝试访问服务器上的任意文件。`%2e` 是`.`的 URL 编码，用于绕过某些安全限制。
2.  **远程代码执行（RCE）：** 如果服务器启用了 CGI 脚本，攻击者可以通过路径遍历访问到 `/bin/sh` 等 shell 程序，并执行任意命令。

为了成功利用该漏洞，目标服务器需要满足以下条件：

*   运行 Apache HTTP Server 2.4.49 版本。
*   服务器的配置存在 Alias-like 指令，且对受限目录之外的文件没有进行严格的访问控制。
*   可选：服务器启用了 CGI 脚本执行。

**项目地址:** [mightysai1997/CVE-2021-41773S](https://github.com/mightysai1997/CVE-2021-41773S)

**漏洞详情:** [CVE-2021-41773](https://nvd.nist.gov/vuln/detail/CVE-2021-41773)