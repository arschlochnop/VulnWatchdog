## CVE-2021-29505-XStream远程命令执行

**漏洞编号:** CVE-2021-29505

**漏洞类型:** 远程命令执行

**影响应用:** XStream

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** < 1.4.17

**利用条件:** 目标系统使用存在漏洞的XStream版本，且未启用或正确配置安全防护机制（如白名单）。需要网络访问。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-29505 是一个存在于 XStream 1.4.17 之前版本的反序列化漏洞，允许远程攻击者通过构造恶意的 XML 输入流来执行任意命令。 

**有效性：**
根据漏洞库信息和搜索结果，此漏洞确实存在并且影响 XStream 1.4.17 之前的版本。提供的 POC 代码使用了`java.util.PriorityQueue`和`com.sun.xml.internal.ws.api.message.Packet`等类，结合RMI远程调用，构造了一个恶意 XML 载荷，可以触发目标系统上的远程代码执行。POC 描述中也说明了成功利用CommonsCollections6链通过 RMI Listener 执行了计算器程序，验证了漏洞的有效性。

**投毒风险：**
该仓库中的代码主要包含一个README描述复现过程和一个利用EXP文件，README文件主要是描述如何启动RMI服务监听，EXP文件是通过XStream进行反序列化漏洞利用，没有发现任何恶意、隐藏的投毒代码。因此，投毒风险较低。风险评估：0%

**利用方式：**
1.  **漏洞原理：** XStream 在反序列化 XML 数据时，由于未对类型进行严格校验，攻击者可以利用一些特定的类（如 POC 中的`java.util.PriorityQueue`，`javax.naming.ldap.Rdn_-RdnEntry`以及`com.sun.xml.internal.ws.api.message.Packet`等）构造恶意对象，结合 RMI 技术，触发 JNDI 注入，最终执行任意代码。
2.  **利用步骤：**
    *   攻击者首先需要搭建一个恶意的 RMI 服务，该服务会绑定一个包含恶意代码的对象。
    *   然后，攻击者构造一个包含恶意 XML 载荷的请求发送给存在漏洞的 XStream 服务。
    *   XStream 服务在反序列化该 XML 时，会触发 RMI 调用，从而执行恶意 RMI 服务上的代码。
3.  **缓解措施：**
    *   升级 XStream 到 1.4.17 或更高版本。
    *   使用 XStream 的安全框架，配置白名单，限制 XStream 可以反序列化的类型。

**项目地址:** [MyBlackManba/CVE-2021-29505](https://github.com/MyBlackManba/CVE-2021-29505)

**漏洞详情:** [CVE-2021-29505](https://nvd.nist.gov/vuln/detail/CVE-2021-29505)