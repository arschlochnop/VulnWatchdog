## CVE-2017-12637 SAP NetWeaver 目录遍历

**漏洞编号:** CVE-2017-12637

**漏洞类型:** 目录遍历

**影响应用:** SAP NetWeaver Application Server Java

**危害等级:** 高危，可能导致敏感信息泄露

**影响版本:** 7.5

**利用条件:** 需要网络访问，且目标系统存在漏洞

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2017-12637是一个存在于SAP NetWeaver AS Java 7.5中的目录遍历漏洞。攻击者可以利用该漏洞读取服务器上的任意文件。根据漏洞库信息和搜索引擎结果，该漏洞已经被公开利用，并且CISA已将其添加到已知被利用漏洞目录中。

**有效性分析：**

提供的PoC代码是一个Python脚本，它通过构造包含`..`的URL来尝试读取`/etc/passwd`文件。脚本首先读取包含目标主机名的文件，然后对每个目标构造恶意URL，使用`curl`命令发送HTTP请求，并检查响应体中是否包含`/etc/passwd`的内容（通过正则表达式匹配`root:.*?:0:0:`）。如果找到匹配，则表明漏洞存在。

**投毒风险分析：**

PoC代码主要功能是利用目录遍历漏洞读取`/etc/passwd`文件，代码相对简单，主要的网络请求使用`curl`命令，subprocess.run的使用是存在风险的，如果解析的`input_file`包含恶意注入的命令，在未做充分过滤的情况下存在一定的命令执行风险，但是整体代码逻辑是清晰的，没有发现明显的恶意代码或者后门。

*   `TRAVERSAL_PATH`变量定义了目录遍历的payload，直接构造payload来读取/etc/passwd文件，此操作没有风险。
*   `ETC_PASSWD_PATTERN`变量使用正则表达式来匹配/etc/passwd文件的内容，用于验证漏洞是否存在，此操作没有风险。
*   `run_curl`函数使用`subprocess.run`来执行curl命令。这里如果 hostname或者 port 被恶意篡改，可能会存在潜在风险。但整体利用方向是目录遍历，因此判定投毒风险较低。
*   `main`函数负责读取输入文件、遍历目标主机、调用`run_curl`函数以及输出结果。也没有明显的恶意行为。

综合判断，该PoC代码的投毒风险较低，大约为5%。风险主要来自于subprocess.run的输入参数hostname和port可能被恶意构造，但需要用户主动提供恶意输入文件。

**利用方式：**

1.  准备包含目标SAP NetWeaver服务器主机名或IP地址（以及端口号，如果非标准端口）的文本文件。
2.  运行PoC脚本，指定输入文件和可选的输出文件。
3.  脚本会尝试利用目录遍历漏洞读取每个目标服务器上的`/etc/passwd`文件。
4.  如果成功读取到`/etc/passwd`文件，脚本会输出成功的消息，并在输出文件中记录详细信息。
5.  攻击者可以通过这种方式读取服务器上的其他敏感文件，从而获取敏感信息。

**项目地址:** [abrewer251/CVE-2017-12637_SAP-NetWeaver-URL-Traversal](https://github.com/abrewer251/CVE-2017-12637_SAP-NetWeaver-URL-Traversal)

**漏洞详情:** [CVE-2017-12637](https://nvd.nist.gov/vuln/detail/CVE-2017-12637)