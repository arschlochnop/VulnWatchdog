## CVE-2024-21626-runc容器逃逸

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可能导致主机控制

**影响版本:** < 1.1.12

**利用条件:** 内核支持openat2 (kernel version >= 5.6), 可以创建容器并指定执行命令, 可以指定容器使用的镜像

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-21626是runc中的一个容器逃逸漏洞。利用该漏洞，攻击者可以从容器中逃逸到主机文件系统，甚至可以获得主机的控制权。

**有效性：**

提供的POC代码看起来是有效的。它利用了runc中的文件描述符泄漏漏洞，通过`process.cwd`的trickery，使得容器进程的工作目录位于主机文件系统命名空间中，从而实现容器逃逸。

`Dockerfile`用于构建包含必要工具（netcat）和POC脚本的镜像。
`poc.sh` 脚本会将一个反弹shell脚本写入到主机文件系统的`/bin/bash.copy`，然后启动一个 netcat 监听，等待反弹 shell 连接。
`verify.sh`脚本尝试通过遍历不同的文件描述符，读取主机上的`/etc/passwd`文件，来验证漏洞是否存在。
`README.md` 提供了漏洞描述、使用说明以及参考链接，并说明了漏洞利用的前提条件。

根据搜索结果，这个漏洞影响了runc 1.1.12之前的版本，并且多个来源都确认了漏洞的存在和利用方法，因此该POC的有效性较高。

**投毒风险：**

该仓库可能存在轻微的投毒风险，可能性约为10%。

主要风险点在于 `poc.sh` 脚本，它在主机上写入了一个名为 `/bin/bash.copy` 的文件。虽然这个文件本身是为了利用漏洞而创建的反弹shell，但如果攻击者在 `poc.sh` 中加入额外的恶意代码，例如删除关键文件、安装后门或者执行其他恶意操作，那么就会带来投毒风险。 用户如果直接使用未经审查的`poc.sh`，可能会在主机上留下潜在的后门。

同时需要说明的是，`verify.sh`脚本中遍历文件描述符的操作，如果被滥用，也可能对主机造成一定的资源消耗。

**利用方式：**

1.  **环境准备：** 确保运行runc的版本低于1.1.12，且满足POC所需的前置条件（内核版本、容器创建权限等）。
2.  **构建镜像：** 使用提供的`Dockerfile`构建一个包含POC脚本的docker镜像。
3.  **运行容器：** 运行构建好的镜像，并执行`poc.sh`脚本。 脚本会尝试在宿主机上创建一个名为`/bin/bash.copy`的反弹shell，并启动监听。
4.  **建立连接：** 在另一个终端上执行 `/bin/bash.copy`, 随后攻击者即可通过 netcat 建立连接，获得主机的shell。
5.  **逃逸：** 此时，攻击者已经逃逸到主机文件系统，并拥有了主机的shell，可以执行任意操作。

简而言之，该漏洞利用方式是通过文件描述符泄漏，将容器内的操作映射到主机文件系统，从而写入恶意文件，获得反弹shell，最终实现容器逃逸。

**项目地址:** [Wall1e/CVE-2024-21626-POC](https://github.com/Wall1e/CVE-2024-21626-POC)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)