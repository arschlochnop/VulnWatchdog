## CVE-2024-32002-Git-RCE

**漏洞编号:** CVE-2024-32002

**漏洞类型:** 远程代码执行

**影响应用:** Git

**危害等级:** 高危，允许攻击者在目标机器上执行任意代码

**影响版本:** v2.45.0, v2.44.0, <=v2.43.3, <=v2.42.1, v2.41.0, <=v2.40.1, <=v2.39.3

**利用条件:** 目标系统需要安装存在漏洞的Git版本，并且文件系统大小写不敏感且支持符号链接(或配置`core.symlinks=true`)

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-32002 漏洞存在于 Git 的子模块功能中。攻击者可以构造包含恶意子模块的仓库，利用 Git 在处理子模块时可能将文件写入 `.git/` 目录而不是子模块工作目录的漏洞。通过精心构造的子模块，攻击者可以在目标机器上执行任意代码。利用过程如下：

1.  **恶意仓库准备：** 攻击者创建两个仓库 rep1 和 rep2。
2.  **rep1 (恶意子模块)：** 在 rep1 中，创建一个 `executable/hooks/post-checkout` 文件，该文件包含要执行的恶意代码（例如，启动计算器应用）。使用`git update-index --chmod=+x executable/hooks/post-checkout`命令赋予该文件执行权限，并推送到 rep1 仓库。
3.  **rep2 (主仓库)：** 在 rep2 中，将 rep1 作为子模块添加到 `A/modules/exploit` 路径下。
4.  **漏洞触发：**  关键在于创建 `dotgit.txt` 文件，内容为 `.git`，计算其哈希值，然后构造 `index.info` 文件，该文件将 `A/modules/exploit/.git` 设置为符号链接指向计算出的哈希对象，以此欺骗 Git。
5.  **克隆触发：** 当受害者使用 `git clone --recursive $REP2` 命令克隆 rep2 仓库时，Git 会尝试递归克隆子模块 rep1。
6.  **代码执行：** 由于 rep2 中 `A/modules/exploit/.git` 被伪造成符号链接，Git 在处理子模块时会将 rep1 中的 `executable/hooks/post-checkout` 文件错误地写入 `.git/hooks` 目录，从而使其成为一个 Git 钩子。`post-checkout` 钩子会在 `git clone` 操作完成后自动执行，从而触发恶意代码。

**投毒风险分析：**

  此POC本身旨在利用漏洞，但其中存在潜在的投毒风险。例如，`exploit.sh` 中定义的 `exploit` 变量决定了执行的恶意代码。虽然当前 POC 中是启动计算器，但攻击者完全可以替换为更具危害性的命令，例如下载并执行恶意脚本。虽然代码中声明“USE ONLY FOR EDUCATIONAL PURPOSES!”，但仍需谨慎使用。

**有效性分析：**

 根据漏洞描述和搜索结果，该 POC 有效。提供的 POC 代码展示了如何利用此漏洞在目标机器上执行任意代码。

**风险缓解：**

*   升级 Git 到修复后的版本。
*   避免克隆来自不受信任来源的仓库。
*   禁用 Git 的符号链接支持（`git config --global core.symlinks false`）。
*   对克隆的仓库进行安全审查。

**项目地址:** [FlojBoj/CVE-2024-32002](https://github.com/FlojBoj/CVE-2024-32002)

**漏洞详情:** [CVE-2024-32002](https://nvd.nist.gov/vuln/detail/CVE-2024-32002)