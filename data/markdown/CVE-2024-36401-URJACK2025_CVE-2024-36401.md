## CVE-2024-36401 GeoServer 远程代码执行

**漏洞编号:** CVE-2024-36401

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** GeoServer

**危害等级:** 高危，未经身份验证的远程代码执行

**影响版本:** 2.22.6之前, 2.23.0 < 2.23.6, 2.24.0 < 2.24.4, 2.25.0 < 2.25.2

**利用条件:** GeoServer实例暴露在网络上，且运行在受影响版本范围内。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-36401是GeoServer中的一个远程代码执行漏洞，该漏洞源于GeoTools库在处理属性名称时，不安全地将其传递给commons-jxpath库进行XPath表达式的评估。由于此XPath评估被错误地应用于简单要素类型，因此影响了所有GeoServer实例。攻击者可以通过构造恶意的WFS、WMS或WPS请求，在未经身份验证的情况下，利用`valueReference`注入Java代码来执行任意系统命令。

**有效性：** 提供的PoC代码 `exp.py` 利用了此漏洞。它通过构造包含恶意代码的XML Payload，并将其发送到GeoServer的WFS接口 `/geoserver/wfs`，从而实现远程命令执行。PoC提供了两种利用模式：`cmd` 模式用于执行单条命令，`reverse` 模式用于建立反弹Shell连接。

**投毒风险：**  该PoC存在一定的投毒风险，虽然主要功能是利用漏洞，但攻击者可以利用PoC的灵活性嵌入恶意代码，例如下载并执行额外的恶意软件。反弹shell的bash命令和http请求等行为都有可能被恶意利用。风险预估为10%。

**利用方式：**
1.  **确定目标:**  确定运行着存在漏洞版本的GeoServer实例，并确认其网络可访问性。
2.  **构造Payload:** 使用PoC脚本 `exp.py`，选择 `cmd` 模式执行任意命令，或者选择 `reverse` 模式建立反弹Shell。
3.  **发送请求:**  PoC脚本会构造包含恶意Java代码的XML Payload，并通过POST请求发送到目标的WFS接口 `/geoserver/wfs`。
4.  **执行代码:**  如果漏洞存在，GeoServer会执行Payload中的恶意代码，从而实现远程命令执行。如果是反弹shell模式，需要在攻击者机器上监听指定端口，等待目标机器反弹shell连接。

**项目地址:** [URJACK2025/CVE-2024-36401](https://github.com/URJACK2025/CVE-2024-36401)

**漏洞详情:** [CVE-2024-36401](https://nvd.nist.gov/vuln/detail/CVE-2024-36401)