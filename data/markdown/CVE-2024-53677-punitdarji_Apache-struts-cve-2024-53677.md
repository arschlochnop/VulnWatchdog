## CVE-2024-53677-Apache Struts 文件上传漏洞

**漏洞编号:** CVE-2024-53677

**漏洞类型:** 文件上传/路径遍历/远程代码执行

**影响应用:** Apache Struts

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 2.0.0 < version < 6.4.0

**利用条件:** 使用 FileuploadInterceptor 的 Struts 应用，需要网络访问

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-53677 是 Apache Struts 中的一个文件上传漏洞。攻击者可以操纵文件上传参数，利用路径遍历漏洞将文件上传到受限目录，从而可能导致远程代码执行。

**有效性：**
漏洞库信息和搜索结果均表明该漏洞是真实存在的，且风险较高，多个安全厂商发布了相关预警和分析报告。提供的 POC 代码利用了参数覆盖和路径遍历来上传文件，并验证文件是否可访问，如果目标是WebShell，还可以执行命令。此利用方式较为常见且有效。

**投毒风险：**
查看提供的`exploit.py`脚本，该脚本主要功能是利用multipart/form-data上传文件，并通过`destination_path`参数来控制上传文件的路径，存在以下几个需要关注的点：

1.  **`simulate_i18n_errors()`函数**：虽然该函数只是模拟国际化错误，但如果被恶意修改，可能会引入其他潜在的攻击向量。
2.  **`execute_remote_command()`函数**：这个函数允许执行远程命令，是漏洞利用的关键部分。如果被篡改，可能导致意外的系统行为。
3.  **依赖库**：`requests`和`requests_toolbelt`是常用的库，但如果被替换为恶意版本，可能导致信息泄露或者代码执行。

此外，`README.md`中引用的YouTube视频链接和GitHub仓库链接也存在一定的风险，例如链接可能指向恶意网站或包含恶意代码的仓库。

考虑到以上因素，该仓库存在一定的投毒风险，但主要是因为利用过程中涉及远程代码执行，如果验证的webshell存在后门也可能导致被控，而并非作者主动投毒。综合评估投毒风险在10%左右。

**利用方式：**
1.  **路径遍历：** 攻击者通过修改上传的文件名，利用“../”等相对路径，将文件上传到Web服务器的任意目录，绕过上传限制。
2.  **参数覆盖：**  利用Struts框架的特性，覆盖文件上传相关的参数，例如`top.UploadFileName`，从而指定上传文件的目标路径。
3.  **上传恶意文件：**  上传包含恶意代码的文件，例如JSP WebShell，然后通过访问该文件来执行任意命令。
4.  **远程代码执行：** 结合路径遍历和恶意文件上传，攻击者可以在Web服务器上执行任意代码，控制服务器。

总的来说，攻击者通过构造恶意请求，欺骗服务器，最终实现远程代码执行。漏洞利用需要目标应用使用了易受攻击的`FileuploadInterceptor`。

**项目地址:** [punitdarji/Apache-struts-cve-2024-53677](https://github.com/punitdarji/Apache-struts-cve-2024-53677)

**漏洞详情:** [CVE-2024-53677](https://nvd.nist.gov/vuln/detail/CVE-2024-53677)