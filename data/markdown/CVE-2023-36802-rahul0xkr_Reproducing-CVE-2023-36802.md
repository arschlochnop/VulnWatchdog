## CVE-2023-36802 - Microsoft Streaming Service Proxy Elevation of Privilege Vulnerability

**漏洞编号:** CVE-2023-36802

**漏洞类型:** 权限提升 (Elevation of Privilege)

**影响应用:** Microsoft Streaming Service Proxy (mskssrv.sys)

**危害等级:** 高危，可导致本地权限提升至SYSTEM

**影响版本:** 受影响的Windows版本请参考CVE详情

**利用条件:** 本地访问

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-36802 是 Microsoft Streaming Service Proxy 中的一个权限提升漏洞。该漏洞源于 mskssrv.sys 驱动程序中缺少类型检查，导致类型混淆。

**漏洞利用方式:**

1.  **类型混淆：** `FSRendezvousServer::FindObject` 函数返回的对象没有进行类型验证，直接被强制转换为 `StreamObject`。如果返回的是一个 `Context` 对象，则会导致越界访问。
2.  **堆喷射（Heap Spraying）：** 利用堆喷射技术，将可控的“假对象”放置在脆弱的 `Context` 对象旁边。
3.  **信息泄露：** 通过 `ConsumeTx` -> `GetStats`，驱动程序会返回越界内存，从而泄露内核地址，绕过 KASLR。
4.  **任意读写：** 利用 `PublishRx` 循环写入假字段，结合堆喷射，可以控制写入地址。 另一个路径 `UnmapPages` 允许攻击者释放可控地址的内存，创建use-after-free。
5.  **Token窃取：** 遍历 `EPROCESS.ActiveProcessLinks` 列表，找到 PID 为 4 的 System 进程，然后将 System 进程的 Token 复制到攻击者的进程中。

**POC有效性评估:**

根据搜索结果，此漏洞在野外已被利用。提供的代码包含 Visual Studio 解决方案文件、漏洞分析文档和测试系统版本信息。漏洞分析文档详细描述了漏洞的原理和利用方法，包括堆喷射、信息泄露和 Token 窃取。这些信息表明提供的 POC 代码很可能有效。

**投毒风险分析:**

POC 代码主要包含一个 Visual Studio 解决方案，用于编译利用程序。虽然没有直接的证据表明存在恶意代码，但需要注意以下几点：

*   **代码审计：** 仔细审计源代码是必要的，以确认是否存在任何隐藏的恶意行为，例如植入后门。
*   **编译过程：** 确保在安全的环境中编译 POC 代码，避免受到恶意软件的影响。
*   **依赖项：** 检查 POC 代码是否依赖于任何外部库或组件，并验证这些依赖项的安全性。

根据目前的信息，投毒的可能性较低（约 10%），但不能完全排除。 风险主要来自于未经验证的源代码的潜在风险， 需要进行详细的代码审计才能给出更准确的评估。

**缓解措施：**

*   应用 Microsoft 提供的安全补丁。
*   实施纵深防御策略，限制对敏感资源的访问。

**项目地址:** [rahul0xkr/Reproducing-CVE-2023-36802](https://github.com/rahul0xkr/Reproducing-CVE-2023-36802)

**漏洞详情:** [CVE-2023-36802](https://nvd.nist.gov/vuln/detail/CVE-2023-36802)