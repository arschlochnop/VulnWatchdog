## CVE-2024-27198-JetBrains TeamCity 身份验证绕过

**漏洞编号:** CVE-2024-27198

**漏洞类型:** 身份验证绕过

**影响应用:** JetBrains TeamCity

**危害等级:** 严重，允许未经身份验证的攻击者执行管理操作

**影响版本:** < 2023.11.4

**利用条件:** 需要网络访问TeamCity服务器，目标版本低于2023.11.4

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-27198是JetBrains TeamCity服务器中存在的一个身份验证绕过漏洞。该漏洞允许未经身份验证的攻击者通过访问特定的URL（/pwned?jsp=/app/rest/users;.jsp）并构造恶意请求来创建新的管理员用户。该漏洞的利用不需要任何特权或用户交互。漏洞利用代码首先尝试获取TeamCity的版本信息，然后通过发送带有用户名、密码和管理员角色的JSON有效负载的POST请求到漏洞URL来创建用户。如果服务器容易受到攻击，将成功创建具有管理员权限的新用户。 

**有效性：**
根据漏洞库信息、搜索引擎结果和漏洞利用代码，该漏洞的利用代码应该有效，因为该漏洞已被广泛利用，并且CISA已将其添加到已知被利用漏洞目录(KEV)。

**投毒风险：**
此仓库中存在作者隐藏的投毒代码的风险较低，约为10%。 代码本身比较简单，主要功能是发送请求创建用户。 风险主要来自于以下几点：

*   **依赖项风险：** 虽然代码本身只使用了 `requests` 和 `urllib3` 库，但攻击者可能会通过替换或篡改这些库来植入恶意代码。 但可能性较低。
*   **代码混淆或隐藏：** 代码的可读性较高，没有发现任何混淆或隐藏代码。 但仍然存在一定风险，攻击者可能通过细微的修改来添加恶意功能。

**利用方式：**

1.  使用提供的Python脚本，指定目标TeamCity服务器的URL、要创建的管理员用户名和密码。
2.  脚本首先尝试获取TeamCity服务器的版本。
3.  然后，脚本构造一个包含用户名、密码和管理员权限的JSON payload，并将其发送到`/pwned?jsp=/app/rest/users;.jsp`端点。
4.  如果服务器存在漏洞，则会创建一个新的管理员用户，攻击者可以使用该用户登录并控制TeamCity服务器。

**项目地址:** [geniuszly/CVE-2024-27198](https://github.com/geniuszly/CVE-2024-27198)

**漏洞详情:** [CVE-2024-27198](https://nvd.nist.gov/vuln/detail/CVE-2024-27198)