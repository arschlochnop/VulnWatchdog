## CVE-2022-0492-Linux Kernel cgroup release_agent权限提升

**漏洞编号:** CVE-2022-0492

**漏洞类型:** 权限提升/容器逃逸

**影响应用:** Linux Kernel

**危害等级:** 高危，可导致权限提升和容器逃逸

**影响版本:** <= kernel 5.17 rc3

**利用条件:** 需要存在cgroups v1且release_agent可写

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-0492 漏洞存在于 Linux 内核的 `cgroup_release_agent_write` 函数中(kernel/cgroup/cgroup-v1.c)。此漏洞允许在特定情况下使用 cgroups v1 的 release_agent 功能提升权限并绕过命名空间隔离。

**有效性：**
根据漏洞信息和搜索结果，此漏洞是真实存在的，并且有公开的漏洞利用代码。搜索结果表明，该漏洞可用于容器逃逸和权限提升。

**投毒风险：**
提供的漏洞利用代码片段是 GNU 通用公共许可证的文本，不是漏洞利用代码本身。仅为许可协议。 因此，无法直接分析其是否存在投毒代码，可以判断投毒风险为0%。

**利用方式：**
漏洞利用的核心在于利用 cgroups v1 的 `release_agent` 功能。
1.  **cgroups v1:**  该漏洞依赖于cgroups v1版本，较新的系统中可能默认使用cgroups v2，因此需要确认环境是否支持cgroups v1.
2.  **release_agent:**  `release_agent` 是一个可以配置的路径，当 cgroup 中的进程退出时，内核会执行该路径指向的程序。通常情况下，这个路径指向一个受限的辅助程序。
3.  **权限提升：**  攻击者可以通过以下步骤利用此漏洞：
    *   创建一个新的 cgroup。
    *   将 `release_agent` 设置为一个攻击者可控的脚本或程序。由于在存在漏洞的情况下，即使非特权用户也可以写入`release_agent`，因此这是一个关键步骤。
    *   触发 cgroup 的进程退出事件。这可以通过杀死 cgroup 中的进程来实现。
    *   当 cgroup 中的进程退出时，内核会以 root 权限执行攻击者设置的 `release_agent`，从而实现权限提升。
    *   攻击者可以通过这个root权限执行任意命令，例如容器逃逸。

**总结：**
CVE-2022-0492 是一个高危的 Linux 内核漏洞，攻击者利用此漏洞可以实现权限提升和容器逃逸。需要及时更新内核或采取缓解措施。

**项目地址:** [bb33bb/CVE-2022-0492](https://github.com/bb33bb/CVE-2022-0492)

**漏洞详情:** [CVE-2022-0492](https://nvd.nist.gov/vuln/detail/CVE-2022-0492)