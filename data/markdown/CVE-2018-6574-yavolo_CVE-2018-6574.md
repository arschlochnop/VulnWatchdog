## CVE-2018-6574 - Go "go get" 远程命令执行

**漏洞编号:** CVE-2018-6574

**漏洞类型:** 远程命令执行

**影响应用:** Go

**危害等级:** 高危，允许远程代码执行

**影响版本:** Go before 1.8.7, Go 1.9.x before 1.9.4, Go 1.10 pre-releases before Go 1.10rc2

**利用条件:** 用户使用受影响版本的Go执行 `go get` 命令获取包含恶意代码的包。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2018-6574 漏洞允许攻击者在用户使用 `go get` 命令下载和构建包含恶意代码的Go包时，执行任意命令。该漏洞是由于 Go 在构建过程中没有正确阻止 `-fplugin=` 和 `-plugin=` 参数传递给 gcc 或 clang 编译器造成的。攻击者可以创建一个包含恶意 C 代码的 Go 包，并利用 `// #cgo CFLAGS:` 指令将恶意代码编译成共享库，然后在构建过程中执行。 

**有效性：** 提供的PoC代码是有效的。其中 `a.c` 文件包含恶意C代码，该代码在编译成动态链接库 (`a.so`) 后，会被 `main.go` 文件中的 `// #cgo CFLAGS: -fplugin=./a.so` 指令加载并在构建过程中执行。`a.c` 中的代码 `system("/usr/local/bin/score 6c9d4862-4326-403c-a1c6-47a2ad6fcda5");` 会执行任意系统命令。

**投毒风险：** 此处 `a.c` 中执行 `system("/usr/local/bin/score 6c9d4862-4326-403c-a1c6-47a2ad6fcda5");` 可以视作 PoC的一部分，用于证明漏洞存在，但同时也存在一定的投毒风险。开发者可能隐藏其他恶意代码，例如窃取用户凭据或安装后门。由于`score`命令指向位置未知,可能存在更大的风险.

**利用方式：**

1.  **创建恶意Go包：** 攻击者创建一个包含 `a.c` 和 `main.go` 文件的恶意Go包。
2.  **植入恶意C代码：** 在 `a.c` 文件中编写要执行的恶意C代码。PoC中为执行特定的命令。
3.  **CGO指令：** 在 `main.go` 文件中使用 `// #cgo CFLAGS: -fplugin=./a.so` 指令，指示 Go 编译器在构建过程中加载并执行恶意共享库。
4.  **诱骗用户安装：** 攻击者将恶意Go包上传到公共代码仓库或通过其他方式诱骗用户使用 `go get` 命令下载和构建该包。
5.  **执行恶意代码：** 当用户使用 `go get` 命令构建恶意包时，恶意C代码将被编译成共享库并执行，从而导致远程命令执行。

**项目地址:** [yavolo/CVE-2018-6574](https://github.com/yavolo/CVE-2018-6574)

**漏洞详情:** [CVE-2018-6574](https://nvd.nist.gov/vuln/detail/CVE-2018-6574)