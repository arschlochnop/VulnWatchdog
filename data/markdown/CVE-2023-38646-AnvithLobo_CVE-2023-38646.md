## CVE-2023-38646-Metabase-RCE

**漏洞编号:** CVE-2023-38646

**漏洞类型:** 远程代码执行

**影响应用:** Metabase

**危害等级:** 高危，未经身份验证的远程代码执行

**影响版本:** Metabase open source before 0.46.6.1 and Metabase Enterprise before 1.46.6.1

**利用条件:** 目标Metabase实例可通过网络访问

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2023-38646允许未经身份验证的攻击者在Metabase服务器上执行任意命令。该漏洞利用H2数据库的特性，通过构造恶意的数据库连接字符串，在建立数据库连接时执行预先设定的Java代码。具体来说，利用方式是：

1.  **获取Token：** 首先，通过访问`/api/session/properties`端点获取一个setup token。
2.  **构造Payload：**  然后，构造一个包含恶意H2数据库连接字符串的JSON payload。这个连接字符串中利用`CREATE TRIGGER`语句创建触发器，在`INFORMATION_SCHEMA.TABLES`表上执行`SELECT`操作前触发。触发器执行的JavaScript代码使用`java.lang.Runtime.getRuntime().exec()`执行反向shell命令。
3.  **Base64编码：** 使用Base64对反向shell指令进行编码，避免特殊字符影响。
4.  **发送Payload：**  最后，将构造好的JSON payload发送到`/api/setup/validate`端点，触发漏洞。

**有效性：**  提供的PoC代码有效，可以成功利用该漏洞。

**投毒风险：**  代码中没有明显的投毒行为。脚本的主要功能是利用漏洞并执行反向shell。作者提供的代码逻辑清晰，没有发现任何恶意代码片段或者隐藏的后门。该脚本的功能与描述一致，目的是利用Metabase的漏洞来获取远程代码执行权限。因此, 投毒风险评估为0%。

**项目地址:** [AnvithLobo/CVE-2023-38646](https://github.com/AnvithLobo/CVE-2023-38646)

**漏洞详情:** [CVE-2023-38646](https://nvd.nist.gov/vuln/detail/CVE-2023-38646)