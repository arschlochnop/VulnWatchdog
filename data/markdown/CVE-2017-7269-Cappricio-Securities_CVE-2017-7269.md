## CVE-2017-7269 - Microsoft IIS 6.0 WebDAV 缓冲区溢出

**漏洞编号:** CVE-2017-7269

**漏洞类型:** 缓冲区溢出

**影响应用:** Microsoft IIS 6.0

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Windows Server 2003 R2 上的 IIS 6.0

**利用条件:** 目标服务器运行未打补丁的 Microsoft IIS 6.0，并且启用了 WebDAV 服务

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2017-7269 是 Microsoft IIS 6.0 WebDAV 服务中 ScStoragePathFromUrl 函数的缓冲区溢出漏洞。攻击者可以通过发送包含特制 'If:' 头部的 PROPFIND 请求，利用该漏洞在目标服务器上执行任意代码。

**有效性：**
根据漏洞库信息、搜索引擎结果和提供的漏洞利用代码（Python脚本），可以判断该漏洞利用是有效的。多个来源表明该漏洞已被广泛利用，并且存在公开的 Metasploit 模块和 Python 脚本。

**投毒风险：**
提供的漏洞利用代码主要是一个漏洞扫描器，用于检测目标是否存在 CVE-2017-7269 漏洞。 通过快速浏览，发现该脚本还集成了 Telegram 通知功能。虽然没有发现明显的恶意代码，但依然存在一定的风险，例如：
*   **依赖风险：** 该脚本依赖于多个Python库，这些库可能存在安全问题，或者被恶意篡改。
*   **Telegram API 密钥泄露：** 如果攻击者获取了用于Telegram通知的 API 密钥，则可以滥用该功能。
*   **报告欺骗：** 扫描器可能会产生误报或者漏报，攻击者可能会利用此弱点。
*   **信息收集：** 该工具可能会收集目标服务器的信息并发送到外部服务器(通过Telegram)。

综合考虑，投毒风险评定为10%，主要是由于脚本依赖项和潜在的滥用风险。

**利用方式：**
1.  攻击者构造一个恶意的 HTTP PROPFIND 请求，该请求包含一个特别长的 'If:' 头部。该头部的内容以 "If: <http://" 开头。
2.  当 IIS 6.0 的 WebDAV 服务处理这个请求时，`ScStoragePathFromUrl` 函数会因为没有正确检查输入长度而发生缓冲区溢出。
3.  攻击者可以通过精心设计的溢出数据覆盖内存中的关键区域，例如函数返回地址。
4.  通过控制返回地址，攻击者可以将程序执行流程劫持到预先设定的恶意代码，从而在目标服务器上执行任意命令。

**项目地址:** [Cappricio-Securities/CVE-2017-7269](https://github.com/Cappricio-Securities/CVE-2017-7269)

**漏洞详情:** [CVE-2017-7269](https://nvd.nist.gov/vuln/detail/CVE-2017-7269)