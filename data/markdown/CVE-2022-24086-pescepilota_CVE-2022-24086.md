## CVE-2022-24086-Magento-RCE

**漏洞编号:** CVE-2022-24086

**漏洞类型:** 远程代码执行

**影响应用:** Magento Commerce

**危害等级:** 高危，未经身份验证的远程代码执行

**影响版本:** <= 2.4.3-p1 和 <= 2.3.7-p2

**利用条件:** 目标系统运行受影响的Magento版本，且攻击者可访问checkout页面

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-24086 是一个 Adobe Commerce (Magento) 中的不当输入验证漏洞，存在于 checkout 流程中。攻击者可以利用此漏洞在未经身份验证的情况下执行远程代码。 

**有效性评估:**
根据提供的漏洞利用代码，POC利用了Magento模板引擎的特性，通过在First Name和City字段中注入恶意代码，最终导致远程代码执行。具体来说，攻击者利用`this.getTemplateFilter().filter()`来执行PHP代码，并通过`$order.shipping_address.city`等变量来传递恶意负载。搜索引擎结果也表明，该漏洞已经被实际利用。

**投毒风险分析:**
代码仓库中可能存在的投毒风险较低，约 10%。
*   `docker-compose.yml` 文件使用了官方的 `bitnami/magento` 和 `bitnami/mariadb` 镜像，降低了镜像投毒的风险。但是，仍然可能存在环境变量配置不当，导致安全风险。例如,`ALLOW_EMPTY_PASSWORD=yes` 只建议在开发环境中使用.
*   `README.md` 文件中的POC代码旨在演示漏洞的利用方法，虽然本身不是恶意代码，但如果被恶意修改，可能存在投毒风险。
总体来说，该仓库的投毒风险较低，主要集中在对镜像配置和POC代码的潜在篡改上。

**利用方式:**
1.  攻击者通过checkout页面，在 shipping address 的 First Name 和 City 字段中注入恶意模板代码。
2.  恶意代码利用Magento的模板引擎执行任意PHP代码。
3.  利用 `nc` 命令反弹shell，实现远程代码执行。

**项目地址:** [pescepilota/CVE-2022-24086](https://github.com/pescepilota/CVE-2022-24086)

**漏洞详情:** [CVE-2022-24086](https://nvd.nist.gov/vuln/detail/CVE-2022-24086)