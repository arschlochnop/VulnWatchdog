## CVE-2025-21333 Windows Hyper-V NT Kernel Integration VSP Elevation of Privilege Vulnerability

**漏洞编号:** CVE-2025-21333

**漏洞类型:** 权限提升

**影响应用:** Windows Hyper-V

**危害等级:** 高危，可能导致虚拟机数据泄露、完整性破坏和拒绝服务

**影响版本:** Windows 10 21H2 (版本 10.0.19043.0 到 10.0.19044.5371), Windows 11 22H2 (版本 10.0.22621.0 到 10.0.22621.4751), Windows 10 22H2 (版本 10.0.19045.0 到 10.0.19045.5371), Windows Server 2025 (版本 10.0.26100.0 到 10.0.26100.2894), Windows 11 23H2 (版本 10.0.22631.0 到 10.0.22631.4751), Windows Server 23H2 (版本 10.0.25398.0 到 10.0.25398.1369), Windows 11 24H2 (版本 10.0.26100.0 到 10.0.26100.2894)

**利用条件:** 本地用户权限，需要启用并运行Hyper-V。

**POC 可用性:** 是

**投毒风险:** 80%

## 详情

CVE-2025-21333 是一个 Windows Hyper-V NT Kernel Integration VSP 权限提升漏洞。根据漏洞描述和搜索结果，攻击者可以利用恶意构造的 Virtual Service Provider (VSP) 来提升权限，最终控制 Hyper-V 主机。这是一个堆溢出漏洞（CWE-122）。

**有效性：**
提供的 POC 代码是一个 Visual Studio 解决方案，包含 C++ 代码。代码中包含Windows头文件，如 `<Windows.h>`, `<ioringapi.h>`和自定义头文件`wnf.h`。通过检查代码，可以发现其中利用了Windows Notification Facility（WNF）状态数据和I/O ring IOP_MC_BUFFER_ENTRY。搜索结果中reddit论坛的帖子也说明这是一个windows内核堆溢出漏洞，并提供了github链接。

**投毒风险：**
提供的代码片段中，最可疑的部分是 `README.md` 文件中提供的下载链接：`[Download Exploit](https://github.com/file/Soft.zip)`。该链接指向一个名为 `Soft.zip` 的 ZIP 文件，从不可信来源下载未经验证的可执行文件具有极高的风险。虽然直接提供的C++代码本身看起来是标准漏洞利用代码，但`README.md`文件中的下载链接是潜在的恶意软件投放点。用户可能被诱导下载包含恶意payload的zip文件，而非真正的漏洞利用程序。因此，存在较高的投毒风险。
另外，`wnf.h`等自定义头文件没有提供，意味着使用者必须自己查找或编写相关代码，这增加了利用难度，也为潜在的投毒留下了空间。攻击者可以提供带有恶意代码的`wnf.h`文件，诱导用户使用。
总体来说，投毒风险较高，估计为80%。

**利用方式：**
1.  **触发漏洞:** 利用特制的 VSP 触发 Hyper-V NT Kernel Integration 中的堆溢出。
2.  **WNF状态数据操控:** 通过操纵WNF状态数据，控制内核内存的布局。
3. **I/O ring IOP_MC_BUFFER_ENTRY：** 通过操控I/O环，控制内核内存的读写。
4.  **权限提升:** 覆盖关键内核数据结构，例如当前进程的 Token，将其替换为 SYSTEM 用户的 Token，从而提升权限。

**项目地址:** [SerabiLem/CVE-2025-21333-POC](https://github.com/SerabiLem/CVE-2025-21333-POC)

**漏洞详情:** [CVE-2025-21333](https://nvd.nist.gov/vuln/detail/CVE-2025-21333)