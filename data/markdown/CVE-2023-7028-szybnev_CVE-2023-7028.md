## CVE-2023-7028-GitLab-账号接管

**漏洞编号:** CVE-2023-7028

**漏洞类型:** 弱密码恢复机制

**影响应用:** GitLab

**危害等级:** 高危，可导致账户接管

**影响版本:** 16.1 prior to 16.1.6, 16.2 prior to 16.2.9, 16.3 prior to 16.3.7, 16.4 prior to 16.4.5, 16.5 prior to 16.5.6, 16.6 prior to 16.6.4, and 16.7 prior to 16.7.2

**利用条件:** 目标GitLab实例存在漏洞，且攻击者已知目标用户的邮箱地址

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-7028是GitLab CE/EE中的一个严重漏洞，允许攻击者通过向未验证的邮箱地址发送密码重置邮件来接管用户账户。漏洞存在于密码重置流程中，攻击者可以在重置密码时，将目标用户的邮箱和攻击者控制的邮箱同时添加到请求参数中，从而导致重置邮件同时发送到这两个邮箱。攻击者通过获取发送到自己邮箱的重置链接，可以重置目标用户的密码，进而接管其账户。

**有效性：** 提供的POC代码利用了该漏洞，通过构造包含目标用户邮箱和攻击者邮箱的请求来触发密码重置流程，并从临时邮箱服务(1secmail.com)获取重置链接以完成密码重置，从而验证漏洞的有效性。

**投毒风险：** 代码中使用了`1secmail.com`这个临时邮箱服务，目的是为了方便漏洞利用的自动化，本身不属于投毒行为。主要关注点在于是否存在恶意代码植入。代码存在通过网络请求获取和发送数据行为，理论上存在被篡改的风险，但从代码逻辑来看，没有发现明显的后门或恶意行为。考虑到代码较长，存在一定的隐藏风险，但整体风险较低，估计在10%左右。

**利用方式：**
1.  攻击者需要知道目标GitLab实例的URL和目标用户的邮箱地址。
2.  攻击者运行POC脚本，脚本会自动创建一个临时邮箱(如果攻击者没有指定自己的邮箱)。
3.  脚本构造一个包含目标用户邮箱和临时邮箱的密码重置请求，并发送到GitLab服务器。
4.  GitLab服务器会将密码重置链接同时发送到目标用户邮箱和临时邮箱。
5.  脚本从临时邮箱中获取密码重置链接。
6.  脚本使用该链接重置目标用户的密码，从而接管其账户。

**项目地址:** [szybnev/CVE-2023-7028](https://github.com/szybnev/CVE-2023-7028)

**漏洞详情:** [CVE-2023-7028](https://nvd.nist.gov/vuln/detail/CVE-2023-7028)