## CVE-2016-10033-PHPMailer-远程代码执行

**漏洞编号:** CVE-2016-10033

**漏洞类型:** 远程代码执行

**影响应用:** PHPMailer

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** < 5.2.18

**利用条件:** 目标系统运行有存在漏洞的PHPMailer版本，并且配置为使用`mail`传输方式。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2016-10033漏洞存在于PHPMailer 5.2.18之前的版本中。攻击者可以通过在`Sender`属性中构造包含`\"` (反斜杠双引号)的恶意字符串，向`mail`命令传递额外的参数，从而执行任意代码。漏洞的利用方式如下：

1.  **漏洞原理：**  PHPMailer在处理`mail`传输方式时，没有充分过滤`Sender`属性，导致参数注入。
2.  **利用方式：** 攻击者通过设置`Sender`属性为包含恶意代码的字符串，例如：`" -oQ/tmp -X/tmp/shell.php somefake@email.com`，这段代码尝试将shell写入到目标服务器的`/tmp/shell.php`文件中。然后发送邮件，PHPMailer会调用`mail`命令，并将恶意代码作为参数传递给`mail`命令，从而导致代码执行。
3.  **POC分析：** 提供的POC代码包含一个Dockerfile、docker-compose.yml、README.md和一个shell脚本`wordpress-rce-exploit.sh`。
    *   **Dockerfile：**  用于构建包含WordPress和Exim4的Docker镜像，Exim4用于模拟邮件服务器。
    *   **docker-compose.yml：**  用于部署包含WordPress和MariaDB的Docker容器。
    *   **wordpress-rce-exploit.sh：**  该脚本利用CVE-2016-10033漏洞，通过构造恶意的`Host`头，将包含反弹shell的命令注入到`mail`命令中。脚本首先启动一个简单的HTTP服务器，用于托管反弹shell的payload，然后通过curl发送包含恶意`Host`头的请求到WordPress的`wp-login.php`页面，触发漏洞。

4.  **有效性：**  提供的POC代码是有效的，可以利用CVE-2016-10033漏洞在目标系统上执行任意代码。搜索结果中的多个链接也确认了该漏洞的存在和利用。
5.  **投毒风险：**  经过分析，该仓库的主要功能是演示如何利用CVE-2016-10033漏洞。但是，在`wordpress-rce-exploit.sh`脚本中，存在通过HTTP服务器提供payload的行为，如果攻击者替换了rce.txt的内容，可能导致植入其他恶意代码,比如挖矿脚本等。因此，存在一定的投毒风险。但主要的逻辑是漏洞利用，投毒的风险较低，估计为10%。


**项目地址:** [chipironcin/CVE-2016-10033](https://github.com/chipironcin/CVE-2016-10033)

**漏洞详情:** [CVE-2016-10033](https://nvd.nist.gov/vuln/detail/CVE-2016-10033)