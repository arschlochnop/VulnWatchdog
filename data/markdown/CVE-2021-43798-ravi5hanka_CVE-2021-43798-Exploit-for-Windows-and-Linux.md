## CVE-2021-43798 - Grafana 目录遍历漏洞

**漏洞编号:** CVE-2021-43798

**漏洞类型:** 目录遍历

**影响应用:** Grafana

**危害等级:** 高危，可能导致敏感信息泄露

**影响版本:** 8.0.0-beta1 到 8.3.0 (不包括已修复版本 8.0.7, 8.1.8, 8.2.7, 8.3.1)

**利用条件:** 目标 Grafana 实例运行在受影响版本范围内，且可以通过网络访问 /public/plugins/ 路径。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2021-43798 是 Grafana 中的一个目录遍历漏洞，允许未经身份验证的攻击者读取服务器上的任意文件。漏洞存在于 /public/plugins/<plugin_id>/ 路径，其中 <plugin_id> 是已安装插件的 ID。攻击者可以通过构造包含目录遍历序列（如 ../）的 URL 来访问受限目录之外的文件。

**有效性:** 提供的POC代码是有效的。它利用了 Grafana 的目录遍历漏洞，允许攻击者读取服务器上的任意文件。该代码可以根据目标操作系统（Linux 或 Windows）构造合适的路径，并发送 HTTP 请求以检索文件内容。

**投毒风险:**  代码本身看起来主要是为了利用漏洞。README.md 文件说明了代码的功能，即适配 Linux 和 Windows 系统。虽然存在微小的投毒风险（5%），但这主要在于代码的潜在滥用，而非恶意代码本身。例如，攻击者可能会修改代码以自动化扫描和数据提取，但原始代码的核心功能是读取文件，不包含主动植入后门等恶意行为。

**利用方式:**
1.  确定目标 Grafana 实例的版本是否在受影响范围内。
2.  选择一个已安装的插件 ID。 提供的python代码中已内置插件ID的列表。
3.  构造包含目录遍历序列的 URL。 例如，`/public/plugins/<plugin_id>/../../../../../../../../etc/passwd`。
4.  发送 HTTP GET 请求到构造的 URL。
5.  如果漏洞存在，服务器将返回请求的文件内容。该POC脚本通过输入文件路径，自动构造payload并发送请求。需要指定目标系统的类型。

该漏洞的修复方法是将 Grafana 升级到 8.0.7、8.1.8、8.2.7 或 8.3.1 及以上版本。

**项目地址:** [ravi5hanka/CVE-2021-43798-Exploit-for-Windows-and-Linux](https://github.com/ravi5hanka/CVE-2021-43798-Exploit-for-Windows-and-Linux)

**漏洞详情:** [CVE-2021-43798](https://nvd.nist.gov/vuln/detail/CVE-2021-43798)