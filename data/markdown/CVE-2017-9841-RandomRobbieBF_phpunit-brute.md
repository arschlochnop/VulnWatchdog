## CVE-2017-9841-PHPUnit-远程代码执行

**漏洞编号:** CVE-2017-9841

**漏洞类型:** 远程代码执行

**影响应用:** PHPUnit

**危害等级:** 高危，可导致服务器完全控制

**影响版本:** PHPUnit < 4.8.28 和 5.x < 5.6.3

**利用条件:** 目标服务器安装了存在漏洞版本的PHPUnit，且/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php文件可以通过Web访问。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2017-9841 漏洞存在于 PHPUnit 4.8.28 之前版本和 5.x 5.6.3 之前版本中的 Util/PHP/eval-stdin.php 文件。该漏洞允许远程攻击者通过以 "<?php " 子字符串开头的 HTTP POST 数据执行任意 PHP 代码。该漏洞的利用方式是向暴露的/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php URI发送POST请求，请求体包含恶意的PHP代码。 

**POC有效性：**
根据漏洞描述和提供的POC代码，该POC有效。POC代码（phpunit-brute.py）通过尝试常见的PHPUnit安装路径，向目标URL发送包含 `<?php phpinfo();` 的POST请求，如果返回的响应中包含 “PHP License as published by the PHP Group”，则认为该路径存在漏洞。

**投毒风险：**
该POC代码的主要功能是暴力破解可能存在的漏洞路径，并发送包含phpinfo()函数的POST请求以验证漏洞是否存在。代码中存在通过HTTP请求外部github资源的行为，存在一定投毒风险，主要体现在:
1. githubusercontent内容可能被篡改,该脚本本身并不会执行任何恶意代码,但是如果githubusercontent的内容被篡改,那么该脚本的功能和预期输出将发生改变,例如将`phpinfo()`替换为其他恶意代码。
2.  该脚本会向found.txt中写入发现的URL，攻击者可以通过修改该文件来引导受害者访问恶意站点。综合判断，投毒风险较低，大约为5%。

**利用方式：**
1.  使用`phpunit-brute.py`脚本，指定目标URL（`-u` 参数）开始扫描。
2.  脚本会尝试不同的PHPUnit路径，并发送包含PHP代码的POST请求。
3.  如果脚本找到可利用的路径，会将该路径写入`found.txt`文件。
4.  攻击者可以修改POST请求中的PHP代码，执行任意命令，从而控制服务器。

**项目地址:** [RandomRobbieBF/phpunit-brute](https://github.com/RandomRobbieBF/phpunit-brute)

**漏洞详情:** [CVE-2017-9841](https://nvd.nist.gov/vuln/detail/CVE-2017-9841)