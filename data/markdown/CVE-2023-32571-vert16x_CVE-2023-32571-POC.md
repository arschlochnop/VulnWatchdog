## CVE-2023-32571-Dynamic Linq RCE

**漏洞编号:** CVE-2023-32571

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Dynamic Linq

**危害等级:** 高危，允许攻击者执行任意代码和命令

**影响版本:** 1.0.7.10 through 1.2.25 (before 1.3.0)

**利用条件:** 需要能够向存在漏洞的 Dynamic Linq 方法（如 Where, Select, OrderBy）传递不可信的输入。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-32571 漏洞存在于 Dynamic Linq 库中，允许攻击者通过 Linq 注入执行任意代码。攻击者可以利用 Where、Select、OrderBy 等方法，通过构造恶意的表达式，调用 C# 函数，例如 `System.Diagnostics.Process.Start`，从而实现远程代码执行。

**有效性评估：**

提供的 POC 代码利用 `System.AppDomain.CreateInstanceAndUnwrap` 方法创建 `System.Diagnostics.Process` 类的实例，并通过 `System.Diagnostics.Process.Start` 方法执行命令。代码中提供了 Windows 和 Linux 平台的 payload 示例，分别使用 `cmd.exe /c <command-here>` 和 `bash -c <command-here>` 执行命令。
根据漏洞描述和 POC 代码，该漏洞利用方式是有效的，可以实现远程代码执行。

**投毒风险分析：**

该 POC 代码的主要目的是演示如何利用 Dynamic Linq 注入漏洞执行任意命令。代码本身并没有明显的投毒行为。存在的风险点在于 Dockerfile 构建过程中，如果引入了不可信的第三方依赖或执行了未知的脚本，则可能存在投毒风险。例如，在`docker-compose up --build`过程中。
由于仓库较为简单，并且主要代码集中在说明如何构造 payload，因此投毒风险较低。但是依旧存在，比例约为 10%。

**利用方式：**

1.  攻击者找到应用程序中使用 Dynamic Linq 的位置，并允许用户提供输入到 Where、Select 或 OrderBy 等方法中的查询字符串。
2.  攻击者构造包含恶意 C# 代码的查询字符串，利用 Dynamic Linq 注入漏洞，调用 `System.Diagnostics.Process.Start` 方法。
3.  恶意代码在服务器上执行，攻击者可以执行任意命令，例如反弹 shell、读取敏感文件等。

**缓解措施：**

1.  升级 Dynamic Linq 库到 1.3.0 或更高版本。
2.  对用户提供的输入进行严格的验证和过滤，防止恶意代码注入。
3.  使用最小权限原则运行应用程序，限制攻击者可以执行的操作。

**项目地址:** [vert16x/CVE-2023-32571-POC](https://github.com/vert16x/CVE-2023-32571-POC)

**漏洞详情:** [CVE-2023-32571](https://nvd.nist.gov/vuln/detail/CVE-2023-32571)