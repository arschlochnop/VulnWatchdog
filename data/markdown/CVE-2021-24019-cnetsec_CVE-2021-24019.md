## CVE-2021-24019 - FortiClientEMS 会话过期不足漏洞

**漏洞编号:** CVE-2021-24019

**漏洞类型:** 权限提升

**影响应用:** Fortinet FortiClientEMS

**危害等级:** 高危，可能导致未授权访问和控制FortiClientEMS服务器

**影响版本:** 6.4.2 及以下, 6.2.8 及以下

**利用条件:** 攻击者需要能够获取到有效的、但未过期的管理员会话ID（通过其他途径，例如网络嗅探或其他漏洞）。目标系统存在漏洞版本的FortiClientEMS。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-24019是一个FortiClientEMS中的会话过期不足漏洞。攻击者如果能够获取到未过期的管理员会话ID，就可以重用这些ID来获得管理员权限。该漏洞利用代码（exploit.py）通过读取 tokens.txt 文件中的会话ID，然后向目标URL发送包含这些会话ID的HTTP请求，检测会话ID是否有效。如果返回状态码为200，且页面包含"Dashboard"，则认为该会话ID有效，并输出"Access granted!"。尽管该脚本本身没有明显的投毒代码，但是该脚本依赖于外部提供的 `tokens.txt` 文件。如果攻击者使用了从其他来源获取的令牌，则无法确保令牌来源的安全性，但脚本本身不包含恶意代码。该漏洞的利用方式是：

1.  **获取会话ID：** 攻击者首先需要通过某种方式（例如网络嗅探、中间人攻击或其他漏洞）获取FortiClientEMS管理员的会话ID。
2.  **准备Token列表：** 将获取到的会话ID添加到 tokens.txt 文件中（或者自己构造会话token）。
3.  **运行利用脚本：** 运行 exploit.py 脚本，并输入目标FortiClientEMS服务器的URL。
4.  **验证访问：** 脚本会自动测试 tokens.txt 中的每个会话ID，如果找到有效的会话ID，脚本会报告访问已授权。

根据漏洞信息，搜索引擎结果和漏洞利用代码分析，利用的有效性取决于是否能获取有效的会话ID。 该利用方式依赖于攻击者事先获取有效的会话ID，因此攻击复杂度较高（CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:U/C:H/I:H/A:H/E:F/RL:X/RC:X）。 漏洞利用代码本身不包含投毒风险。

**项目地址:** [cnetsec/CVE-2021-24019](https://github.com/cnetsec/CVE-2021-24019)

**漏洞详情:** [CVE-2021-24019](https://nvd.nist.gov/vuln/detail/CVE-2021-24019)