## CVE-2022-1386 - Fusion Builder Unauthenticated SSRF

**漏洞编号:** CVE-2022-1386

**漏洞类型:** Server-Side Request Forgery (SSRF)

**影响应用:** Fusion Builder WordPress plugin (Avada theme)

**危害等级:** 高危，可能允许未授权的攻击者扫描内网，访问内部服务，绕过防火墙和访问控制。

**影响版本:** < 3.6.2

**利用条件:** 目标网站使用受影响版本的Fusion Builder插件，且存在可访问的wp-admin/admin-ajax.php接口。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于Fusion Builder插件的表单处理逻辑中，由于未充分验证用户提供的URL参数，攻击者可以利用`wp-admin/admin-ajax.php`接口发起SSRF攻击。

**有效性：**

根据提供的漏洞信息、搜索结果和漏洞利用代码，该漏洞利用是有效的。多个来源（NVD、WPScan、Checkmarx等）确认了CVE-2022-1386的存在，并描述了其SSRF的性质。提供的脚本`fubucker.sh`和`single-exploiter.sh`旨在自动化检测和利用该漏洞。脚本通过构造包含恶意URL的POST请求发送到`wp-admin/admin-ajax.php`，并检查响应来确定漏洞是否存在。

**投毒风险：**

`fubucker.sh`脚本的投毒风险评估为10%。虽然脚本本身看起来像是为了利用SSRF漏洞而设计的，但需要谨慎评估。脚本依赖于从目标站点获取`fusion_id`的值，如果攻击者控制了脚本，可能存在以下投毒方式：

*   **修改Payload URL:** 攻击者可以修改脚本中的`fusionAction`参数（如`https://pastebin.com/raw/VaxXtjGV`），指向一个恶意的payload地址，例如包含恶意JavaScript代码或尝试利用其他漏洞的服务器。
*   **修改请求参数:** 攻击者可以修改请求中的其他参数，例如添加额外的请求头或修改数据，以实现更复杂的攻击。
*   **记录目标信息:** 攻击者可以修改脚本，将扫描的目标URL和结果发送到其控制的服务器，从而收集敏感信息。
*   **依赖外部服务:** 虽然脚本使用了`pastebin.com`作为示例，但这使得payload执行依赖于该服务的可用性和内容。若`pastebin`被恶意修改，则会影响所有使用此脚本的目标。

鉴于脚本的开放性和可修改性，以及潜在的恶意利用方式，用户应谨慎使用，并在运行前仔细审查代码。

**利用方式：**

1.  **确定目标：** 寻找安装了Fusion Builder插件（3.6.2版本之前）的WordPress网站。
2.  **获取`fusion_id`：** 通过向`wp-admin/admin-ajax.php`发送`action=fusion_form_update_view`请求获取`fusion-form-nonce-0`的值。
3.  **构造恶意请求：** 使用获取的`fusion_id`构造POST请求，设置`action=fusion_form_submit_form_to_url`，并将`fusionAction`参数设置为攻击者想要访问的内部或外部URL。
4.  **发送请求：** 将构造的请求发送到`wp-admin/admin-ajax.php`。
5.  **分析响应：** 检查响应内容，验证是否成功发起了SSRF攻击。如果服务器返回了目标URL的内容，则表明漏洞存在。

通过SSRF，攻击者可以执行以下操作：

*   **端口扫描：** 扫描目标服务器的内部网络，查找开放的端口和服务。
*   **访问内部服务：** 访问只有内部网络才能访问的服务，例如数据库、管理面板等。
*   **读取本地文件：** 在某些情况下，可以读取服务器上的本地文件。
*   **远程代码执行：** 如果内部服务存在漏洞，攻击者可以通过SSRF利用这些漏洞，最终实现远程代码执行。

**项目地址:** [im-hanzou/fubucker](https://github.com/im-hanzou/fubucker)

**漏洞详情:** [CVE-2022-1386](https://nvd.nist.gov/vuln/detail/CVE-2022-1386)