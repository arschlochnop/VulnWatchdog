## CVE-2018-12533-JBoss RichFaces-EL表达式注入

**漏洞编号:** CVE-2018-12533

**漏洞类型:** EL表达式注入

**影响应用:** JBoss RichFaces

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 3.1.0 - 3.3.4

**利用条件:** 目标系统运行受影响版本的JBoss RichFaces，并且允许未授权的网络访问。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2018-12533 允许未授权的远程攻击者通过包含 `/DATA/` 子字符串的路径，以及 `org.richfaces.renderkit.html.Paint2DResource$ImageData` 对象，注入表达式语言（EL）表达式并执行任意 Java 代码。 

**有效性分析：**

提供的 POC 代码 `Generator_Paint2DResourceImageData.java` 旨在利用此漏洞。它通过构建恶意的 `ImageData` 对象，该对象包含一个 EL 表达式，该表达式使用 `ScriptEngineManager` 执行任意命令。该代码将序列化的 `ImageData` 对象进行压缩和 Base64 编码，并将其格式化为 RichFaces URL 所需的格式。通过构造特定的URL请求，将payload发送给目标服务器。目标服务器如果存在该漏洞，就会执行EL表达式，从而执行攻击者指定的命令。

**投毒风险分析：**

代码本身并没有明显的投毒行为。它的主要目的是生成利用 CVE-2018-12533 的 Payload。该脚本允许攻击者自定义要执行的命令。此仓库中不存在作者隐藏的投毒代码。投毒风险为0%。

**利用方式：**

1.  **构建恶意请求：** 攻击者构造一个包含特定路径（`/a4j/s/.../DATA/...seam`）的 HTTP 请求，其中包含 Base64 编码的恶意 `ImageData` 对象。此对象包含一个 EL 表达式，用于执行任意命令。
2.  **EL 表达式注入：** RichFaces 在处理此请求时，会解析 URL 中的 Base64 编码数据，并反序列化 `ImageData` 对象。由于缺少适当的输入验证，攻击者可以注入 EL 表达式。
3.  **远程代码执行：** 注入的 EL 表达式会被执行，导致服务器执行攻击者指定的任意 Java 代码，从而实现远程代码执行。

**项目地址:** [mhagnumdw/richfaces-vulnerability-cve-2018-12533-rf-14310](https://github.com/mhagnumdw/richfaces-vulnerability-cve-2018-12533-rf-14310)

**漏洞详情:** [CVE-2018-12533](https://nvd.nist.gov/vuln/detail/CVE-2018-12533)