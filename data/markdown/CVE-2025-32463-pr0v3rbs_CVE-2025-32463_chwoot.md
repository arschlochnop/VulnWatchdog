## CVE-2025-32463 - Sudo Chroot 本地提权

**漏洞编号:** CVE-2025-32463

**漏洞类型:** 本地提权

**影响应用:** Sudo

**危害等级:** 高危，本地用户可提升为root权限

**影响版本:** 1.9.14 <= 版本 < 1.9.17p1

**利用条件:** 本地用户权限

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2025-32463 允许本地用户利用 Sudo 的 `--chroot` 选项获得 root 权限。漏洞根源在于 Sudo 在使用 `--chroot` 选项时，会使用用户可控目录下的 `/etc/nsswitch.conf` 文件。攻击者可以创建一个恶意的 `/etc/nsswitch.conf`，劫持名称服务查询，并加载恶意动态链接库，从而执行任意代码。 

**有效性分析：**
提供的 POC 代码利用 Dockerfile 创建了一个包含漏洞版本 Sudo (1.9.16p2) 的 Ubuntu 24.04 环境。`sudo-chwoot.sh` 脚本通过以下步骤利用漏洞：

1.  创建一个临时目录。
2.  创建一个包含恶意代码的 C 文件 `woot1337.c`。这个文件包含一个构造函数，在加载时会设置进程的 uid 和 gid 为 0 (root)，然后执行 `/bin/bash`。
3.  创建一个 `woot/etc/nsswitch.conf` 文件，指定使用 `woot1337` 进行 passwd 查询。目的是通过 nsswitch 加载恶意动态链接库。
4.  编译 `woot1337.c` 为动态链接库 `libnss_/woot1337.so.2`。
5.  使用 `sudo -R woot woot` 命令。这会将根目录更改为 `woot`，然后执行 `woot` 命令（因为不存在，这里会触发nsswitch）。由于 `nsswitch.conf` 文件被劫持，恶意动态链接库会被加载，从而获得 root shell。

根据漏洞描述和 POC 代码，可以判断该 POC 代码是有效的。

**投毒风险分析：**
仔细分析了提供的 Dockerfile 和 shell 脚本，在 `sudo-chwoot.sh` 中，看到脚本主要目的是利用漏洞进行提权，没有发现明显的恶意代码或后门。`woot1337.c`的作用就是提权，不是后门。但是，任何代码都存在潜在的风险，因此不能完全排除投毒的可能性。评估认为投毒风险较低，大约 1%。

**利用方式总结：**

1.  目标系统需要存在漏洞版本的 Sudo (1.9.14 <= 版本 < 1.9.17p1)。
2.  攻击者需要具有本地用户权限。
3.  攻击者需要创建一个包含恶意配置的目录结构 (例如：`woot/etc/nsswitch.conf`)。
4.  攻击者需要使用 `sudo -R <chroot_dir> <command>` 命令触发漏洞，其中 `<chroot_dir>` 是包含恶意配置的目录，`<command>`可以是任何不存在的命令（这样能更快触发nsswitch）。

**项目地址:** [pr0v3rbs/CVE-2025-32463_chwoot](https://github.com/pr0v3rbs/CVE-2025-32463_chwoot)

**漏洞详情:** [CVE-2025-32463](https://nvd.nist.gov/vuln/detail/CVE-2025-32463)