## CVE-2023-46604-Apache ActiveMQ-RCE

**漏洞编号:** CVE-2023-46604

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache ActiveMQ

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** < 5.15.16, < 5.16.7, < 5.17.6, < 5.18.3

**利用条件:** 需要网络访问到ActiveMQ Broker或Client

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2023-46604 是 Apache ActiveMQ 中 Java OpenWire 协议 marshaller 存在的一个远程代码执行漏洞。攻击者可以通过操纵 OpenWire 协议中序列化的类类型，使客户端或 Broker（取决于攻击目标）实例化 classpath 上的任何类，从而执行任意 shell 命令。

**有效性：**
根据漏洞库信息、搜索引擎结果和漏洞利用代码可以判断该漏洞的POC大概率有效。搜索引擎结果中多个链接表明该漏洞已被积极利用，用于传播 Kinsing 恶意软件和勒索软件。

**投毒风险：**
提供的 Rust `Cargo.lock` 文件是项目依赖的锁定文件，本身不包含可执行代码，难以直接进行投毒。其中包含多个依赖项，逐一分析投毒可能性较低。虽然存在理论上通过供应链攻击进行投毒的可能性，但在此场景下可能性极低。通过分析依赖包的名称，如`bcrypt`, `reqwest`, `tokio`等，可以看出这是一个与网络请求，加密相关的项目，可能是一个用于检测漏洞的蜜罐程序。其中可能包含主动尝试触发漏洞的代码，不应将其误判为投毒行为。

**利用方式：**
1.  **攻击者构造恶意的 OpenWire 消息：**  消息中包含精心设计的序列化数据，指示 ActiveMQ 实例化一个恶意的 Java 类。
2.  **发送恶意消息：**  攻击者将此消息发送到 ActiveMQ Broker 或 Client。
3.  **反序列化漏洞触发：**  ActiveMQ 尝试反序列化消息中的数据，并实例化指定的恶意类。
4.  **远程代码执行：**  恶意类的实例化导致攻击者预先设定的代码被执行，从而控制服务器。

利用此漏洞通常需要先找到存在漏洞版本的ActiveMQ实例，然后构造特定的恶意payload通过openwire协议发送给ActiveMQ的broker或者client，目标解析payload时触发反序列化漏洞，达到远程代码执行的目的。


**项目地址:** [mranv/honeypot.rs](https://github.com/mranv/honeypot.rs)

**漏洞详情:** [CVE-2023-46604](https://nvd.nist.gov/vuln/detail/CVE-2023-46604)