## CVE-2017-9841-PHPUnit远程代码执行

**漏洞编号:** CVE-2017-9841

**漏洞类型:** 远程代码执行

**影响应用:** PHPUnit

**危害等级:** 高危，允许远程攻击者执行任意PHP代码

**影响版本:** 4.8.28之前和5.x在5.6.3之前的版本

**利用条件:** 目标服务器运行存在漏洞的PHPUnit版本，且/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php URI可以被外部访问。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2017-9841 漏洞存在于 PHPUnit 框架的 `Util/PHP/eval-stdin.php` 文件中。攻击者可以通过向该文件发送以 `<?php` 开头的 HTTP POST 数据，来执行任意 PHP 代码。 

**有效性：**
根据漏洞描述和提供的漏洞利用代码，该漏洞利用代码是有效的。它利用了 PHPUnit 的 `eval-stdin.php` 文件，该文件接受 POST 请求中的 PHP 代码并执行。通过发送特制的 POST 请求，攻击者可以执行任意命令。

**投毒风险：**
检查提供的 `phpunit-shell.py` 脚本和 `README.md`，该脚本主要功能是利用 CVE-2017-9841 漏洞执行命令。脚本本身看起来相对简单，主要通过构造 HTTP POST 请求，将 PHP 代码发送到目标服务器执行，没有发现明显的恶意代码或后门。
然而，存在以下几点需要注意：
1.  **依赖项风险：** 脚本依赖于 `requests` 和 `bs4` 模块。虽然这些模块本身通常是安全的，但如果从不可信的源安装，可能会被篡改。建议从官方 PyPI 仓库安装这些依赖项。
2.  **命令执行风险：** 该脚本允许执行任意系统命令。如果攻击者控制了该脚本或脚本运行的机器，他们可以利用此漏洞执行恶意操作。
3. **隐蔽性风险** 该脚本的作者的代码注释和README描述,存在诱导使用者使用的倾向,如果使用者没有代码审计能力,会加大被钓鱼的风险.

总体来说，`phpunit-shell.py` 脚本本身的投毒风险较低，但用户需要谨慎使用，并确保从可信的来源获取依赖项。考虑到依赖风险和隐蔽风险，投毒风险评估为5%。

**利用方式：**
1.  **确定目标：** 找到运行存在漏洞版本的 PHPUnit 的服务器，并确认 `eval-stdin.php` 文件可以从外部访问。
2.  **构造请求：** 使用提供的 `phpunit-shell.py` 脚本或手动构造一个 HTTP POST 请求，该请求包含以 `<?php` 开头的 PHP 代码。例如：`<?php system($_GET['cmd']); ?>`。
3.  **发送请求：** 将构造的请求发送到 `eval-stdin.php` 文件的 URL。
4.  **执行命令：** 成功利用后，攻击者可以在目标服务器上执行任意命令。在上面的例子中，攻击者可以通过 URL 参数 `cmd` 来指定要执行的命令，例如 `http://example.com/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php?cmd=whoami`。

**项目地址:** [p1ckzi/CVE-2017-9841](https://github.com/p1ckzi/CVE-2017-9841)

**漏洞详情:** [CVE-2017-9841](https://nvd.nist.gov/vuln/detail/CVE-2017-9841)