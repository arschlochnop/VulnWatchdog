## CVE-2025-32463-Sudo-本地提权

**漏洞编号:** CVE-2025-32463

**漏洞类型:** 本地权限提升

**影响应用:** Sudo

**危害等级:** 高危，本地用户可提升至root权限

**影响版本:** 1.9.14 <= version < 1.9.17p1

**利用条件:** 本地用户权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2025-32463 允许本地用户通过 `--chroot` 选项利用用户可控目录下的 `/etc/nsswitch.conf` 文件来获取 root 权限。从搜索引擎结果和漏洞库信息来看，该漏洞评级为严重，CVSS 评分高达 9.3。 

**漏洞利用方式：**

1.  **验证漏洞存在：** 运行 `sudo -R woot woot`。如果返回 `sudo: woot: No such file or directory`，则表示漏洞存在。
2.  **利用 POC 提权：**
    *   克隆包含利用脚本的 Git 仓库：`git clone https://github.com/Yuy0ung/CVE-2025-32463_chwoot.git`
    *   进入克隆的目录：`cd CVE-2025-32463_chwoot`
    *   授予执行权限：`chmod +x ./exp.sh`
    *   运行 exp.sh 脚本: `./exp.sh`，该脚本会创建一个包含恶意配置文件的 chroot 环境，并使用 `sudo -R` 选项运行 `sudo`，从而加载恶意的 `/etc/nsswitch.conf`，劫持动态链接库加载，执行任意代码，最终提升至 root 权限。

**投毒风险分析：**

POC 脚本首先会检测系统是否安装了 `gcc` 编译器。如果安装了，它会动态编译一个恶意的共享库 `woot1337.so.2`。如果没有安装，则使用预编译的版本。预编译的二进制文件存在一定的投毒风险，因为无法直接审查它的源代码。但考虑到该POC的主要逻辑都集中在exp.sh这个shell脚本中，且脚本内容较为简单，可以人工审核，所以可以一定程度降低预编译二进制带来的安全风险，但是依然不能排除作者在预编译二进制中添加恶意代码的可能性。

`exp.sh` 脚本的主要步骤如下：

1.  创建一个临时目录 `STAGE` 作为 chroot 环境。
2.  如果未提供命令，则默认执行 `/bin/bash` 以获得交互式 root shell。
3.  如果提供了命令，则转义该命令，以便安全地将其包含在 C 字符串字面量中。
4.  在 `STAGE` 目录下，创建 `woot/etc` 和 `libnss_` 目录。
5.  创建 `woot/etc/nsswitch.conf` 文件，内容为 `passwd: /woot1337`。这指示系统使用 `libnss_woot1337.so.2` 库来解析密码数据库。
6.  复制 `/etc/group` 文件到 `woot/etc` 目录下。
7.  如果系统安装了 `gcc`，则编译 `woot1337.c` 文件生成 `libnss_/woot1337.so.2`。
8.  否则，复制预编译的 `woot1337.so.2` 文件到 `libnss_` 目录下。
9.  使用 `sudo -R woot woot` 命令利用该漏洞。
10. 删除临时目录。

虽然脚本本身逻辑清晰，但是预编译的 `woot1337.so.2` 存在风险，因为shell脚本可以读取用户的环境变量，并且执行任意命令，如果存在其他漏洞，有被利用组合攻击的风险，所以存在一定的投毒风险。

**项目地址:** [Yuy0ung/CVE-2025-32463_chwoot](https://github.com/Yuy0ung/CVE-2025-32463_chwoot)

**漏洞详情:** [CVE-2025-32463](https://nvd.nist.gov/vuln/detail/CVE-2025-32463)