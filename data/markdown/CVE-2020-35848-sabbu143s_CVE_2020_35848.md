## CVE-2020-35848 - Agentejo Cockpit NoSQL注入

**漏洞编号:** CVE-2020-35848

**漏洞类型:** NoSQL注入

**影响应用:** Agentejo Cockpit CMS

**危害等级:** 高危，可能导致用户名枚举，密码重置，最终可能导致远程代码执行

**影响版本:** < 0.11.2

**利用条件:** 需要目标Cockpit CMS实例可访问

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2020-35848存在于Agentejo Cockpit CMS 0.11.2之前的版本中。攻击者可以通过/auth/newpassword接口进行NoSQL注入。

**利用方式：**

1.  **用户名枚举：** 通过在/auth/requestreset接口中注入NoSQL语句，可以枚举有效的用户名。
2.  **Token提取：** 通过在/auth/newpassword接口中注入NoSQL语句，可以提取密码重置token。
3.  **密码重置：** 使用提取的token，通过/auth/resetpassword接口重置任意用户的密码。
4.  **RCE（可能）：** 在成功登录后台后，攻击者可能通过上传文件或利用WebHook等功能实现远程代码执行。

**POC有效性：**

提供的POC代码看起来有效，它实现了用户名枚举、Token提取和密码重置的完整流程。脚本通过curl命令发送POST请求到相应的接口，并使用grep命令提取Token。最后尝试登录并获取web flag。

**投毒风险：**

该POC代码的投毒风险较低。`build.sh`脚本本身只是一个自动化的利用脚本，主要功能是发送HTTP请求并解析响应。虽然脚本会删除cookies.txt文件，但这不是恶意行为。 LICENSE文件和README.md文件都正常，没有隐藏的恶意代码。

**风险评估：**

虽然直接的恶意代码投毒的可能性很低，但需要注意的是，任何未经验证的第三方脚本都可能存在潜在的风险。例如，攻击者可以修改脚本，使其在目标系统上执行其他操作，例如收集敏感信息或执行拒绝服务攻击。因此，在使用任何第三方脚本之前，都应该进行仔细的审查和测试。

 **投毒风险结论：** 综上所述，该POC代码的投毒风险较低，约为1%。但是使用者需要对第三方脚本保持警惕。

**项目地址:** [sabbu143s/CVE_2020_35848](https://github.com/sabbu143s/CVE_2020_35848)

**漏洞详情:** [CVE-2020-35848](https://nvd.nist.gov/vuln/detail/CVE-2020-35848)