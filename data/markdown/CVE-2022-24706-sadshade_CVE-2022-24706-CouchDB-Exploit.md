## CVE-2022-24706 - Apache CouchDB Remote Code Execution

**漏洞编号:** CVE-2022-24706

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache CouchDB

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** <= 3.2.1

**利用条件:** 目标CouchDB实例使用默认Erlang Cookie且未进行适当的安全配置，监听端口对外开放

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-24706 漏洞存在于 Apache CouchDB 3.2.1 及更早版本中。攻击者无需身份验证即可访问配置不当的默认安装，并获得管理员权限，最终实现远程代码执行。

**有效性分析：**

根据漏洞库信息、搜索引擎结果以及提供的漏洞利用代码，此漏洞的POC代码是有效的。多个来源都确认了此漏洞的存在，并且有公开可用的漏洞利用程序。搜索引擎结果中也提及了该漏洞已被积极利用，并用于安装 Kinsing 恶意软件。

**投毒风险分析：**

对提供的 Python 漏洞利用代码进行了分析，未发现明显的恶意代码或后门。代码结构清晰，逻辑合理，主要功能是连接到 CouchDB 实例，利用默认 Erlang cookie 进行身份验证，然后执行任意命令。代码的功能与漏洞描述一致，用于利用漏洞而非植入恶意代码。因此，评估投毒风险为 0%。

**利用方式分析：**

1.  **EPMD 端口扫描：** 利用代码首先连接到目标主机的 EPMD (Erlang Port Mapper Daemon) 端口（默认 4369），获取 CouchDB 节点的 Erlang 端口号。
2.  **Erlang 端口连接：** 连接到获取到的 Erlang 端口。
3.  **身份验证绕过：** 利用默认的 Erlang cookie (monster) 构造认证信息。如果目标 CouchDB 实例使用了默认 cookie 并且未进行安全配置，则认证成功。
4.  **命令执行：** 成功认证后，攻击者可以发送包含任意命令的 Erlang 控制消息，从而在目标服务器上执行任意代码。

**利用条件总结：**

*   目标 CouchDB 版本 <= 3.2.1。
*   目标 CouchDB 实例使用默认的 Erlang cookie ("monster")。
*   目标 CouchDB 实例的 Erlang 端口和 EPMD 端口对外开放。
*   攻击者可以访问目标 CouchDB 实例的网络。

**项目地址:** [sadshade/CVE-2022-24706-CouchDB-Exploit](https://github.com/sadshade/CVE-2022-24706-CouchDB-Exploit)

**漏洞详情:** [CVE-2022-24706](https://nvd.nist.gov/vuln/detail/CVE-2022-24706)