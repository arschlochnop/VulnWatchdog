## CVE-2017-5638 Apache Struts2 远程代码执行

**漏洞编号:** CVE-2017-5638

**漏洞类型:** 远程代码执行

**影响应用:** Apache Struts2

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** 2.3.x before 2.3.32, 2.5.x before 2.5.10.1

**利用条件:** 目标系统运行受影响版本的Apache Struts2，且允许通过HTTP请求与目标交互。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2017-5638 是一个 Apache Struts 2 框架中的远程代码执行漏洞。该漏洞存在于 Jakarta Multipart parser 中，由于其在处理文件上传时的异常处理和错误消息生成不正确导致。攻击者可以通过构造恶意的 Content-Type、Content-Disposition 或 Content-Length HTTP 头，在服务器上执行任意命令。

**有效性：**

提供的PoC代码通过修改Content-Type头部，利用OGNL表达式注入恶意代码，从而实现远程代码执行。根据漏洞库信息和搜索结果，此漏洞在野外被广泛利用，因此PoC代码的有效性较高。

**投毒风险：**

PoC 代码本身是为了利用漏洞而编写的，其目的是执行任意命令。 从提供的代码来看，核心功能是构造包含恶意 OGNL 表达式的 HTTP 头部。
代码通过 Content-Type 注入 OGNL 表达式，该表达式首先获取 OgnlContext，然后清空了 OGNL 的黑名单，以便执行任意代码。接着，它使用 java.lang.ProcessBuilder 执行指定的命令，并将命令执行的结果返回。

综合分析，PoC 代码的功能是利用漏洞，而不是植入后门或进行其他恶意行为。因此，投毒风险评估为 0%。

**利用方式：**

1.  攻击者发送一个包含恶意Content-Type HTTP头的请求到目标服务器。
2.  恶意Content-Type头中包含OGNL表达式，该表达式能够执行任意系统命令。
3.  Struts2框架解析该请求时，会执行OGNL表达式，从而导致远程代码执行。
4.  攻击者通过执行系统命令，可以获取服务器的控制权。

**总结：**

CVE-2017-5638是一个高危的远程代码执行漏洞，利用简单，影响广泛。提供的PoC代码可以有效利用该漏洞。该PoC代码本身没有投毒风险，但攻击者可以利用该PoC代码攻击未修复的Struts2应用。

**项目地址:** [QHxDr-dz/CVE-2017-5638](https://github.com/QHxDr-dz/CVE-2017-5638)

**漏洞详情:** [CVE-2017-5638](https://nvd.nist.gov/vuln/detail/CVE-2017-5638)