## CVE-2025-29927-Next.js-Middleware权限绕过

**漏洞编号:** CVE-2025-29927

**漏洞类型:** 权限绕过

**影响应用:** Next.js

**危害等级:** 高危，可能导致未授权访问和数据泄露

**影响版本:** >= 11.1.4, <= 13.5.6, > 14.0.0, < 14.2.25, > 15.0.0, < 15.2.3

**利用条件:** 应用程序使用Next.js中间件进行权限验证

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2025-29927 是一个 Next.js 中间件的权限绕过漏洞。攻击者可以通过发送包含 `x-middleware-subrequest` 头的恶意请求来绕过中间件中的身份验证检查，从而访问受保护的资源。

**有效性：**
根据提供的漏洞利用代码，该漏洞利用方法是通过在请求头中添加 `x-middleware-subrequest` 字段，其值为一系列 `src/middleware` 的重复，来绕过中间件的验证。漏洞库信息和搜索引擎结果都表明该漏洞存在并已被修复，POC代码与漏洞描述相符，因此POC代码应该是有效的。

**投毒风险：**
分析提供的代码文件：
*   `README.md`: 提供了漏洞利用的步骤，没有可疑代码。
*   `next.config.mjs`: 这是一个标准的 Next.js 配置文件，没有发现恶意代码。
*   `package-lock.json`: 包含了项目依赖的信息。虽然依赖项本身可能存在潜在漏洞，但该文件本身不包含可直接执行的恶意代码。文件显示使用了 `next@14.2.13` 版本，是在受影响范围内。
*   `pages/api/flag.js`：是api端点返回flag的文件，属于后门验证文件，不是投毒文件。
*   `src/middleware.js`：中间件文件，用于模拟验证绕过情况，不是投毒文件。
综合以上分析，该仓库存在投毒代码的可能性较低，但不排除通过篡改依赖项版本引入恶意依赖的可能，因此投毒风险大约为10%。

**利用方式：**
1.  攻击者构造一个 HTTP 请求，目标是 Next.js 应用程序中需要身份验证的 API 端点（例如 `/api/flag`）。
2.  攻击者在请求头中添加 `x-middleware-subrequest` 字段，并将其值设置为 `src/middleware:src/middleware:src/middleware:src/middleware:src/middleware`。  该重复的`src/middleware`值被用于欺骗中间件。
3.  Next.js 应用程序的中间件在处理请求时，由于漏洞的存在，未能正确执行身份验证检查，导致攻击者可以绕过验证。
4.  攻击者成功访问受保护的 API 端点，获取敏感信息或执行未授权操作。

**修复建议：**
升级 Next.js 版本到 14.2.25 或 15.2.3 或更高版本，或者按照官方建议，阻止包含 `x-middleware-subrequest` 头的外部请求到达 Next.js 应用程序。

**项目地址:** [0xcucumbersalad/cve-2025-29927](https://github.com/0xcucumbersalad/cve-2025-29927)

**漏洞详情:** [CVE-2025-29927](https://nvd.nist.gov/vuln/detail/CVE-2025-29927)