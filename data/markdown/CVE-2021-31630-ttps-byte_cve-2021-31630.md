## CVE-2021-31630-OpenPLC Webserver v3-命令注入

**漏洞编号:** CVE-2021-31630

**漏洞类型:** 命令注入

**影响应用:** OpenPLC Webserver

**危害等级:** 高危，可能导致远程代码执行和系统控制

**影响版本:** v3

**利用条件:** 需要网络访问和有效的OpenPLC Webserver v3实例

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-31630 存在于 OpenPLC Webserver v3 中，允许远程攻击者通过 "Hardware Layer Code Box" 组件在 "/hardware" 页面上执行任意代码。

**有效性：**
根据漏洞库信息、搜索引擎结果以及提供的漏洞利用代码（breakerplc.py），此漏洞的POC代码是有效的。该代码利用命令注入漏洞，通过修改 "Hardware Layer Code Box" 中的代码来执行恶意命令，从而获得服务器的shell访问权限。

**投毒风险：**
通过分析 `breakerplc.py` 脚本，存在一定的投毒风险。具体分析如下：
*   **优点：**
    *   代码结构清晰，功能模块化，易于理解。
    *   脚本使用 `argparse` 模块处理命令行参数，方便用户自定义目标URL、用户名、密码、LHOST、LPORT等信息。
    *   脚本包含完整的漏洞利用流程，包括登录、上传payload、编译程序、触发漏洞等步骤。
*   **缺点和潜在投毒点：**
    *   脚本的安全性取决于用户的输入，如果用户输入不安全的参数（例如恶意的LHOST或LPORT），可能导致反弹shell到错误的地址或端口。
    *   脚本中使用了 `subprocess.Popen` 函数来启动 nc 监听，这部分代码可能存在安全风险，例如命令注入等。
    *  虽然脚本本身目的是利用命令注入，但仓库创建者可能通过其它方式植入后门代码，考虑到github仓库的普遍性及POC仓库的安全性，故风险较低。
*   **投毒风险评估：**
    代码主要功能是利用命令注入，虽然有潜在风险，但是并未发现明显的恶意代码或后门。因此，评估投毒风险为 **10%**。

**利用方式：**
利用此漏洞的步骤如下：
1.  使用提供的 `breakerplc.py` 脚本，并提供目标 OpenPLC Webserver v3 的 URL。
2.  提供有效的用户名和密码进行身份验证（默认是 openplc/openplc）。
3.  指定攻击者的监听 IP 地址 (LHOST) 和端口 (LPORT)，用于接收反弹 shell。
4.  脚本将构造包含反向 shell 命令的恶意代码，并通过 "Hardware Layer Code Box" 上传到目标服务器。
5.  脚本触发编译，由于存在命令注入漏洞，恶意代码将被执行，从而在攻击者机器上建立反向 shell 连接。
6.  连接后，可能需要输入命令(如whoami或者ls)来打破代码行，获取返回shell。

**项目地址:** [ttps-byte/cve-2021-31630](https://github.com/ttps-byte/cve-2021-31630)

**漏洞详情:** [CVE-2021-31630](https://nvd.nist.gov/vuln/detail/CVE-2021-31630)