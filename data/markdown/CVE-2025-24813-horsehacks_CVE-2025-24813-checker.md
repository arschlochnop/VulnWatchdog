## CVE-2025-24813-Apache Tomcat-路径等价/反序列化漏洞

**漏洞编号:** CVE-2025-24813

**漏洞类型:** 路径等价/反序列化漏洞

**影响应用:** Apache Tomcat

**危害等级:** 高危，可能导致远程代码执行和信息泄露

**影响版本:** 11.0.0-M1 <= version <= 11.0.2, 10.1.0-M1 <= version <= 10.1.34, 9.0.0.M1 <= version <= 9.0.98

**利用条件:** 需要满足以下条件：
  1. 默认Servlet的写入已启用（默认禁用）。
  2. 支持部分PUT（默认启用）。
  3. 存在安全敏感上传的目标URL，该URL是公共上传目标URL的子目录。
  4. 攻击者知道要上传的安全敏感文件的名称。
  5. 安全敏感文件也通过部分PUT上传。
或者，如果满足以下条件，则恶意用户可以执行远程代码执行：
  1. 默认Servlet的写入已启用（默认禁用）。
  2. 支持部分PUT（默认启用）。
  3. 应用程序正在使用Tomcat的基于文件的会话持久性，并使用默认存储位置。
  4. 应用程序包含一个可以在反序列化攻击中使用的库。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2025-24813是Apache Tomcat中的一个路径等价漏洞，结合默认Servlet的写入启用和部分PUT支持，攻击者可以通过构造特殊的上传路径，覆盖或修改服务器上的敏感文件，造成信息泄露或恶意代码执行。该漏洞还涉及反序列化利用链，如果应用程序满足特定条件，攻击者可以利用Tomcat的文件会话管理机制和应用程序中的反序列化漏洞来执行任意代码。

**有效性分析：**

提供的PoC代码通过检查以下几点来验证漏洞的有效性：

1.  **PUT方法允许性：** 检查目标URL是否允许PUT请求，这是利用该漏洞的前提。
2.  **Tomcat版本检测：** 检查目标服务器的Tomcat版本，确认其是否在受影响的范围内。
3.  **写入权限检查：** 尝试在目标URL的/uploads/目录下写入一个JSP文件，以验证是否具有写入权限。

如果以上三个条件都满足，则目标服务器可能存在CVE-2025-24813漏洞。

**投毒风险分析：**

检查了提供的Python脚本，发现它主要用于检测目标服务器是否存在CVE-2025-24813漏洞，脚本尝试上传JSP文件以验证写入权限。因此，存在很小的投毒风险，代码的功能主要是检测和验证漏洞，而非利用漏洞执行恶意操作，上传的JSP payload也是用于验证，而不是直接执行恶意代码. 但是依然存在服务器被动植入后门webshell的风险。

**利用方式：**

根据漏洞描述，利用方式主要包括以下两种：

1.  **信息泄露/文件篡改：**

   *   攻击者通过构造包含`.Name`（内部点）的恶意文件名，利用路径等价性绕过安全检查。
   *   利用部分PUT请求，将恶意内容注入到安全敏感文件中，或者直接覆盖文件。
   *   目标URL需要是公共上传URL的子目录，且攻击者需要知道敏感文件名。

2.  **远程代码执行：**

   *   攻击者需要找到应用程序中可利用的反序列化漏洞。
   *   利用Tomcat的文件会话管理，将包含恶意反序列化payload的文件上传到会话存储目录。
   *   当Tomcat加载会话数据时，触发反序列化，执行任意代码。

成功利用此漏洞需要满足多个条件，包括Tomcat配置、应用程序环境以及攻击者的知识。

**项目地址:** [horsehacks/CVE-2025-24813-checker](https://github.com/horsehacks/CVE-2025-24813-checker)

**漏洞详情:** [CVE-2025-24813](https://nvd.nist.gov/vuln/detail/CVE-2025-24813)