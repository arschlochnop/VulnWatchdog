## CVE-2020-17530-Apache Struts-远程代码执行

**漏洞编号:** CVE-2020-17530

**漏洞类型:** 远程代码执行

**影响应用:** Apache Struts

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** Struts 2.0.0 - Struts 2.5.25

**利用条件:** 需要Struts2应用存在漏洞，且允许用户输入进入OGNL表达式计算

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-17530是Apache Struts2框架中的一个远程代码执行漏洞，源于对用户输入进行OGNL表达式计算时，未进行充分的验证和过滤，导致攻击者可以通过构造恶意的OGNL表达式，在服务器端执行任意代码。\n\n**有效性：**\n根据漏洞库信息、搜索结果以及提供的漏洞利用代码，可以判定此漏洞的POC代码有效。漏洞库信息明确指出该漏洞的存在以及影响版本范围。搜索结果中多个链接指向漏洞详情、分析报告，以及利用示例。提供的POC代码包含执行系统命令和反弹shell的脚本，进一步证实了漏洞的可利用性。\n\n**投毒风险：**\n提供的代码仓库主要包含漏洞利用脚本和一些payload。`struts2-061-poc.py`执行简单命令，风险较低。`S2-061-shell.py` 脚本的风险略高，因为需要攻击者提供监听IP和端口，如果作者恶意篡改脚本，可能会将反弹shell指向其他IP，但这种投毒方式容易被发现。虽然仓库内的payload来自多个来源，但都用于执行命令，不存在明显的恶意投毒代码（例如，持续性的后门或数据窃取）。综合评估，投毒风险较低，大约为10%。\n\n**利用方式：**\n1.  **漏洞触发：** 漏洞触发点在于Struts2框架对标签属性中用户输入（未经过滤或验证）的OGNL表达式进行二次解析。攻击者需要找到一个允许用户控制标签属性的输入点。\n2.  **OGNL表达式构造：** 攻击者构造恶意的OGNL表达式，利用OGNL表达式的特性，获取Java对象，调用Java方法，最终执行系统命令。\n3.  **命令执行：** 攻击者可以使用`freemarker.template.utility.Execute`类来执行系统命令。\n4.  **反弹Shell：** 攻击者可以使用java代码来反弹shell，控制服务器。\n\n**利用示例（基于提供的Payload）：**\n1. 使用提供的`struts2-061-poc.py`脚本，指定目标URL和要执行的命令。例如：`python struts2-061-poc.py http://ip:port whoami`\n2. 使用提供的`S2-061-shell.py`脚本，首先在一台机器上监听指定端口，然后运行脚本，输入监听IP和端口，即可获得shell。\n3.  可以使用payload-1和payload-2中提供的OGNL表达式，对URL进行编码后，注入到存在漏洞的参数中。

**项目地址:** [wuzuowei/CVE-2020-17530](https://github.com/wuzuowei/CVE-2020-17530)

**漏洞详情:** [CVE-2020-17530](https://nvd.nist.gov/vuln/detail/CVE-2020-17530)