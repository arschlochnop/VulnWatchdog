## CVE-2023-50164 - Apache Struts 文件上传目录遍历导致远程代码执行

**漏洞编号:** CVE-2023-50164

**漏洞类型:** 目录遍历/远程代码执行

**影响应用:** Apache Struts

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 2.0.0 <= Struts <= 2.5.32, 6.0.0 <= Struts <= 6.3.0.1

**利用条件:** 需要应用存在文件上传功能，且使用了存在漏洞的Struts版本。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-50164 是 Apache Struts 2 的一个严重漏洞，攻击者可以操纵文件上传参数来实现路径遍历，在某些情况下，这会导致上传恶意文件，最终实现远程代码执行。

**有效性评估：**
根据漏洞库信息，搜索引擎结果以及漏洞利用代码，该漏洞是一个已确认且被广泛讨论的漏洞。大量安全厂商和研究人员都发布了关于此漏洞的分析和利用报告，证明了其有效性。同时，CISA 将其列为已知被利用的漏洞 (KEV)。

**投毒风险评估：**
提供的漏洞利用代码仓库包含用于查找系统中存在漏洞 Struts 2 应用程序的脚本，这些脚本本身不是漏洞利用代码，而是辅助工具。因此，直接的投毒风险较低，但是存在以下潜在风险：

*   **信息泄露：** 扫描脚本可能会泄露系统中的应用信息，如果攻击者获取这些信息，可能会用于进一步的攻击。
*   **误报：** 脚本可能存在误报，导致安全人员投入不必要的精力。
*   **扫描行为：** 频繁的扫描行为可能被认为是恶意行为，从而触发安全警报。

该仓库的主要作用是协助定位受影响的系统，而不是直接进行漏洞利用，因此，投毒风险较低，估计为 10%。 主要是考虑到脚本可能存在一些隐藏的逻辑，用于收集信息或进行其他恶意行为，但可能性较小。

**利用方式分析：**

1.  **路径遍历：** 攻击者通过修改文件上传请求中的参数（例如文件名），构造包含 `../` 的路径，从而突破上传目录的限制，将文件上传到任意位置。
2.  **恶意文件上传：** 攻击者上传包含恶意代码的文件，例如 JSP webshell。由于可以控制文件上传的位置，攻击者可以将恶意文件上传到 Web 服务器的可执行目录下。
3.  **远程代码执行：** 攻击者通过访问上传的恶意文件，触发其中的恶意代码，最终实现远程代码执行。

**缓解措施：**

*   升级到 Struts 2.5.33 或 6.3.0.2 或更高版本。
*   实施严格的文件上传验证，包括文件名、文件类型和文件大小的验证。
*   配置 Web 服务器，限制文件上传目录的执行权限。

**项目地址:** [helsecert/cve-2023-50164](https://github.com/helsecert/cve-2023-50164)

**漏洞详情:** [CVE-2023-50164](https://nvd.nist.gov/vuln/detail/CVE-2023-50164)