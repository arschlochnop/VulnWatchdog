## CVE-2021-1675 PrintNightmare Windows Print Spooler 远程代码执行漏洞

**漏洞编号:** CVE-2021-1675

**漏洞类型:** 远程代码执行

**影响应用:** Windows Print Spooler

**危害等级:** 高危，可能导致系统完全控制

**影响版本:** 受影响的Windows版本在漏洞库信息中已列出，通常为2021年6月之前的版本

**利用条件:** 需要目标系统开启Print Spooler服务，并且攻击者能够与目标系统进行网络通信。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

根据漏洞库信息、搜索引擎结果和提供的漏洞利用代码，对该漏洞的有效性、投毒风险和利用方式进行分析如下：

**1. 有效性：**

提供的POC代码针对Windows 10 20H2版本，它通过以下步骤尝试利用漏洞：
*   下载并解压包含`PNLPE.dll`, `vlib.dll`, 和`xconsole.exe`的ZIP文件。
*   将这些文件复制到`C:\temp\testcase`目录下。
*   提示用户运行`PNLPE.dll`。

搜索引擎结果表明，CVE-2021-1675 (PrintNightmare) 是一个Windows Print Spooler服务中的远程代码执行漏洞。多个安全厂商和研究人员都发布了关于此漏洞的报告和利用代码。综合来看，提供的POC代码**可能有效**，但需要目标系统满足特定的条件（如操作系统版本、未安装补丁等）。

**2. 投毒风险：**

分析POC代码，投毒风险主要存在于以下几个方面：
*   **下载的ZIP文件：** `Win10_Exploit.zip`可能包含恶意代码。尽管`README.md`文件指向GitHubusercontent，但该链接可能被劫持或篡改。
*   **PNLPE.dll：** 这是最可能的恶意代码植入点。漏洞利用的关键在于此DLL，攻击者可以在其中嵌入后门或者其他恶意功能。
*   **运行DLL文件：** `run.bat`脚本尝试以可执行文件的方式启动`PNLPE.dll`，这通常不是DLL的正常执行方式，存在恶意行为的风险。

虽然POC本身是为了验证漏洞而编写的，但攻击者可以很容易地修改它来包含恶意代码。`run.bat` 的代码本身没有发现明显的投毒特征，但是下载的DLL存在被替换的风险,因此判断存在 **10%** 的投毒风险。

**3. 利用方式：**

PrintNightmare漏洞的利用方式通常涉及以下步骤：
*   **利用`AddPrinterDriverEx`函数：**  该函数允许在Print Spooler服务中安装打印机驱动程序。通过构造恶意的打印机驱动程序，攻击者可以将恶意DLL加载到Print Spooler服务进程中。
*   **提升权限：**  Print Spooler服务以SYSTEM权限运行，因此加载的恶意DLL也具有SYSTEM权限，攻击者可以利用此权限执行任意代码。
*   **远程代码执行：**  通过精心构造的攻击载荷，攻击者可以实现远程代码执行，从而完全控制目标系统。

总而言之，这个漏洞的利用方式通常涉及到欺骗Print Spooler服务加载恶意的DLL文件，从而获取SYSTEM权限并执行任意代码。

**项目地址:** [peckre/PNCVE-Win10-20H2-Exploit](https://github.com/peckre/PNCVE-Win10-20H2-Exploit)

**漏洞详情:** [CVE-2021-1675](https://nvd.nist.gov/vuln/detail/CVE-2021-1675)