## CVE-2017-9248 - Telerik UI for ASP.NET AJAX Cryptographic Weakness

**漏洞编号:** CVE-2017-9248

**漏洞类型:** 密码学漏洞

**影响应用:** Telerik UI for ASP.NET AJAX 和 Sitefinity

**危害等级:** 高危，可能导致MachineKey泄露、任意文件上传/下载、XSS或ASP.NET ViewState compromise。

**影响版本:** Telerik UI for ASP.NET AJAX 在 R2 2017 SP1 之前, Sitefinity 在 10.0.6412.0 之前

**利用条件:** 需要目标系统使用存在漏洞的Telerik UI for ASP.NET AJAX 组件，并且攻击者可以访问包含漏洞的ASP.NET页面。

**POC 可用性:** 是

**投毒风险:** 2%

## 详情

CVE-2017-9248 是一个存在于 Progress Telerik UI for ASP.NET AJAX 组件中的密码学漏洞。该漏洞源于 Telerik.Web.UI.dll 未能正确保护 Telerik.Web.UI.DialogParametersEncryptionKey 或 MachineKey。攻击者利用此漏洞可以更容易地绕过加密保护机制，从而导致 MachineKey 泄露，进而造成任意文件上传/下载、XSS 或 ASP.NET ViewState compromise。

**漏洞利用方式：**

1.  **MachineKey 泄露：** 攻击者通过利用漏洞读取或破解加密密钥（DialogParametersEncryptionKey 或 MachineKey）。从搜索引擎结果来看，可以通过暴力破解等方式获取MachineKey。
2.  **利用泄露的 MachineKey：** 获得 MachineKey 后，攻击者可以进行以下攻击：
    *   **任意文件上传/下载：** 利用 MachineKey 伪造身份，上传恶意文件或下载敏感文件。
    *   **XSS：**  构造恶意的 ViewState，其中包含 XSS payload，然后利用 MachineKey 对其进行签名，从而执行跨站脚本攻击。
    *   **ASP.NET ViewState compromise：**  篡改 ViewState，从而影响应用程序的行为。

**POC代码分析：**

提供的dp_crypto3.py是一个用于利用 CVE-2017-9248 的 Python 脚本。该脚本尝试通过差分密码分析的方式恢复加密密钥，然后使用恢复的密钥来解密或加密数据。具体步骤如下：

1.  **初始化：**  脚本首先禁用InsecureRequestWarning，然后定义了一些全局变量，例如 base64 字符集、匹配表等。
2.  **密钥恢复：**  `get_key` 函数是密钥恢复的核心。它通过发送一系列精心构造的 HTTP 请求到目标服务器，并分析服务器的响应来推断密钥的每个字符。该函数使用差分密码分析技术，通过比较不同请求的响应来确定密钥字符。
3.  **加密/解密：**  `encrypt` 函数使用恢复的密钥来加密或解密数据。

**投毒风险分析：**

代码中`verify=False` 禁用SSL证书验证，存在中间人攻击的风险，但这不是投毒。`getProxy(args.proxy)`允许用户使用代理服务器，这本身不是投毒行为，但可能被滥用。检查脚本是否存在明显的恶意代码(例如删除文件，执行系统命令等)未发现。因此，认为存在非常低的投毒风险，约为2%。主要集中在滥用代理服务器上。

**有效性分析：**

根据漏洞描述和提供的POC代码，可以判断该漏洞利用代码是有效的。它实现了利用该漏洞所需的核心步骤，即密钥恢复和数据加密/解密。漏洞库信息和搜索引擎结果也证实了该漏洞的存在和可利用性。此外，CISA的已知被利用漏洞目录中也包含此漏洞，进一步确认了其有效性。

**项目地址:** [oldboysonnt/dp](https://github.com/oldboysonnt/dp)

**漏洞详情:** [CVE-2017-9248](https://nvd.nist.gov/vuln/detail/CVE-2017-9248)