## CVE-2023-25157-GeoServer-SQL注入

**漏洞编号:** CVE-2023-25157

**漏洞类型:** SQL注入

**影响应用:** GeoServer

**危害等级:** 高危，可能导致数据泄露和远程代码执行

**影响版本:** < 2.21.4, >= 2.22.0, < 2.22.2

**利用条件:** 需要目标GeoServer实例可访问，且存在受影响版本

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-25157是GeoServer中的一个SQL注入漏洞，存在于OGC Filter表达式语言和OGC Common Query Language (CQL)的支持中。攻击者可以通过构造恶意的CQL_FILTER参数来执行任意SQL查询。根据漏洞库信息和搜索结果，此漏洞危害严重，CVSS评分高达9.8。

**有效性：**
提供的POC代码看起来是有效的。它首先尝试获取GeoServer支持的FeatureTypes列表，然后遍历这些FeatureTypes，并尝试获取其属性。虽然POC代码中没有直接体现SQL注入攻击的利用载荷，但是通过控制传入`getProperties`方法的`ql_filters`参数可以进行SQL注入。通过burp抓包分析，如果将`ql_filters`参数修改为恶意的SQL代码，就能触发SQL注入。

**投毒风险：**
分析提供的POC代码和README文件，发现存在潜在投毒风险的可能性较低。虽然任何代码都存在被篡改的可能，但从代码结构和功能来看，该仓库的主要目的是提供漏洞验证和利用的示例。 风险评估为10%。主要基于以下几点：

*   **代码功能：** 代码的功能主要是获取FeatureType和对应的属性，没有发现明显的恶意代码。
*   **请求方法：** 代码使用GET方法发送请求，相对安全。
*   **作者意图：** 根据仓库描述，作者的意图是复现漏洞，而非进行恶意攻击。

**利用方式：**

1.  **获取Feature Types列表：** 利用`/geoserver/ows?service=WFS&version=1.0.0&request=GetCapabilities`端点获取GeoServer上可用的Feature Types。
2.  **构造恶意CQL_FILTER：**  构造包含SQL注入的CQL_FILTER参数，例如：`strStartsWith`等函数存在注入点，将恶意的sql语句传递到`getProperties`的`ql_filters`参数，例如`strStartsWith(propertyName,'%') AND 1=1`或者`strStartsWith(propertyName,'%') AND 1=2`来判断是否存在漏洞。更进一步，可以利用`FeatureId`来进行注入。
3.  **发送GetFeature请求：**  将构造好的CQL_FILTER作为参数，通过`/geoserver/ows?service=wfs&version=1.0.0&request=GetFeature`端点发送请求，触发SQL注入。
4.  **执行任意SQL查询：**  如果注入成功，攻击者可以执行任意SQL查询，获取敏感数据甚至控制服务器。

**项目地址:** [Rubikcuv5/CVE-2023-25157](https://github.com/Rubikcuv5/CVE-2023-25157)

**漏洞详情:** [CVE-2023-25157](https://nvd.nist.gov/vuln/detail/CVE-2023-25157)