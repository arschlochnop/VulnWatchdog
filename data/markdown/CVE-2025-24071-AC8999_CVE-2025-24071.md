## CVE-2025-24071-Windows文件资源管理器欺骗漏洞

**漏洞编号:** CVE-2025-24071

**漏洞类型:** 信息泄露/NTLM哈希窃取

**影响应用:** Microsoft Windows 文件资源管理器

**危害等级:** 中危，可能导致凭据泄露

**影响版本:** 受影响的Windows版本参见漏洞库信息

**利用条件:** 需要攻击者能够搭建SMB服务器，并诱使用户打开恶意制作的.library-ms文件或者包含该文件的ZIP压缩包。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2025-24071是一个Windows文件资源管理器欺骗漏洞，攻击者可以利用该漏洞通过诱使用户打开特制的`.library-ms`文件或包含该文件的`.zip`文件来窃取用户的NTLM哈希。

**利用方式：**

1.  **攻击者准备：**
    *   攻击者需要搭建一个SMB服务器，并拥有一个公网IP或者目标网络可访问的IP。
    *   攻击者需要准备一个恶意`.library-ms`文件。该文件包含指向攻击者控制的SMB服务器的UNC路径。当用户尝试访问该文件时，Windows会自动尝试通过SMB协议连接到攻击者的服务器，从而泄露用户的NTLM哈希。
    *   攻击者可以选择将`.library-ms`文件直接发送给受害者，或者将其打包到ZIP压缩包中。
    *   使用Responder等工具监听SMB流量，捕获NTLM哈希。
2.  **攻击步骤：**
    *   攻击者将恶意`.library-ms`文件或者包含该文件的ZIP压缩包发送给受害者。
    *   受害者打开`.library-ms`文件或者解压并打开ZIP压缩包中的`.library-ms`文件。
    *   Windows文件资源管理器会尝试连接到恶意`.library-ms`文件中指定的SMB服务器。
    *   受害者的NTLM哈希会被发送到攻击者的SMB服务器，攻击者使用Responder等工具捕获哈希。
3.  **POC代码分析：**
    *   `cve-2025-24071-exploit.py`脚本用于生成恶意`.library-ms`文件，将其打包为ZIP文件，并尝试将ZIP文件上传到目标服务器的共享目录（如果提供了有效的用户名和密码）。
    *   脚本使用`smbclient`命令上传ZIP文件。
    *   脚本允许通过命令行参数配置攻击者IP、目标IP、共享名、用户名、密码和网络接口。
4.  **有效性分析：**
    *   漏洞利用依赖于用户交互（打开恶意文件），因此具有一定的局限性。
    *   如果目标系统存在SMB签名策略，可能会阻止NTLM哈希的泄露。
    *   该漏洞的成功利用取决于目标系统是否受到其他安全措施的保护，例如启用了强制SMB签名等。
5.  **投毒风险分析：**
    *   对提供的POC代码进行分析后，发现作者在代码中植入恶意后门的概率较低。 代码主要功能是生成`.library-ms`文件和zip文件，以及上传zip文件到目标服务器。但依然存在微小的风险，例如利用`subprocess.run`执行`smbclient`命令时，可能存在命令注入的风险，如果攻击者能够控制用户名或密码参数，就有可能执行任意命令。因此，不能完全排除投毒的可能性，保守估计投毒风险为5%。

**项目地址:** [AC8999/CVE-2025-24071](https://github.com/AC8999/CVE-2025-24071)

**漏洞详情:** [CVE-2025-24071](https://nvd.nist.gov/vuln/detail/CVE-2025-24071)