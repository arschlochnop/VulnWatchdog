## CVE-2020-13398-FreeRDP-OOB写入

**漏洞编号:** CVE-2020-13398

**漏洞类型:** OOB写入

**影响应用:** FreeRDP

**危害等级:** 高危，可能导致拒绝服务或远程代码执行

**影响版本:** < 2.1.1

**利用条件:** 需要RDP客户端连接到恶意RDP服务器

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2020-13398是FreeRDP 2.1.1之前版本中crypto_rsa_common函数中存在的一个越界写入漏洞。攻击者可以搭建一个恶意的RDP服务器，当受害者使用存在漏洞的FreeRDP客户端连接到该服务器时，恶意服务器会发送特制的RDP license数据包，触发crypto_rsa_common函数中的越界写入，导致程序崩溃或执行恶意代码。

**有效性评估：**

根据漏洞信息和POC代码，该漏洞利用的有效性较高。POC代码提供了一个模拟恶意RDP服务器的脚本（server.py），该脚本会发送一个特制的RDP license数据包给连接的客户端，该数据包包含了畸形的RSA模数和指数，旨在触发libfreerdp/crypto/crypto.c中的越界写入漏洞。

**投毒风险评估：**

代码仓库中可能存在投毒代码的风险较低，约为5%。 原因是：
* POC的目的是演示漏洞，并非为了植入后门。查看server.py代码，主要是模拟RDP协议通信过程，并发送特制的license报文，代码结构简单清晰，没有发现明显的恶意代码。
* 虽然存在潜在的风险，例如修改返回的响应数据，导致客户端执行其他恶意操作，但这种可能性相对较小。因为该POC的主要作用是触发崩溃，而不是在目标系统上执行任意代码。
* 考虑到开发者可能出于测试目的，进行一些不常见的操作，但这些操作是否属于“恶意”，需要进一步分析上下文。比如在真实RDP协议交互中，可能会存在一些非标准的参数设置，如果直接判定为投毒，可能会造成误判。

**利用方式：**

1.  攻击者搭建一个恶意的RDP服务器（使用提供的server.py脚本）。
2.  攻击者诱骗受害者使用存在漏洞的FreeRDP客户端连接到该恶意服务器。
3.  恶意服务器发送特制的RDP license数据包，该数据包包含畸形的RSA模数和指数。
4.  FreeRDP客户端处理该数据包时，`crypto_rsa_common`函数中的越界写入漏洞被触发。
5.  漏洞触发可能导致程序崩溃（拒绝服务）或允许攻击者执行任意代码（远程代码执行）。

**项目地址:** [SpiralBL0CK/PoC-crash-CVE-2020-13398-](https://github.com/SpiralBL0CK/PoC-crash-CVE-2020-13398-)

**漏洞详情:** [CVE-2020-13398](https://nvd.nist.gov/vuln/detail/CVE-2020-13398)