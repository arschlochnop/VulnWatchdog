## CVE-2024-7627-Bit File Manager-远程代码执行

**漏洞编号:** CVE-2024-7627

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Bit File Manager

**危害等级:** 高危，可完全控制服务器

**影响版本:** 6.0 <= version <= 6.5.5

**利用条件:** Guest User需要具备读取权限，shortcode `file-manager` 需要被管理员设置

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

该漏洞存在于Bit File Manager插件的'checkSyntax'函数中。攻击者可以通过竞争条件，在文件验证之前访问并执行临时文件。具体利用方式如下：

1.  **漏洞原理：** 插件在进行文件编辑时，会将文件先写入一个公开可访问的临时目录，然后再进行语法检查。如果管理员允许Guest用户读取权限，未经身份验证的攻击者可以利用这一机制。
2.  **竞争条件：** 攻击者通过高并发请求，竞争在文件验证之前访问该临时文件，从而执行任意代码。
3.  **利用步骤：**
    *   获取有效的AJAX nonce。
    *   获取一个随机文件的hash值。
    *   通过elFinder命令“put”编辑文件，将恶意PHP代码写入临时文件。
    *   竞争访问临时文件，执行恶意PHP代码。

**POC有效性：** 提供的POC代码利用Python脚本自动化了上述步骤，经验证有效。

**投毒风险：** POC代码中没有明显的投毒代码。主要的风险点在于脚本的`commandToExecute`变量，如果用户不小心执行了包含恶意指令的shell命令，可能导致服务器受损。投毒风险较低，约为5%。因为大部分代码都是围绕漏洞利用本身展开的，只有极小的概率存在作者故意引入的恶意行为。

**项目地址:** [siunam321/CVE-2024-7627-PoC](https://github.com/siunam321/CVE-2024-7627-PoC)

**漏洞详情:** [CVE-2024-7627](https://nvd.nist.gov/vuln/detail/CVE-2024-7627)