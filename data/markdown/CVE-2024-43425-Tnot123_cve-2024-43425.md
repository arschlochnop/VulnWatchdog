## CVE-2024-43425 - Moodle 远程代码执行

**漏洞编号:** CVE-2024-43425

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Moodle

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** 4.4 到 4.4.1, 4.3 到 4.3.5, 4.2 到 4.2.8, 4.1 到 4.1.11 及更早的不受支持版本

**利用条件:** 需要有创建或修改 Moodle 课程中问题的权限。默认情况下，未经身份验证的用户无法利用此漏洞。高危利用需要修改请求。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-43425 漏洞存在于 Moodle 的计算问题类型中，允许攻击者通过构造恶意输入来执行任意代码。

**有效性:**
提供的 POC 代码描述了两种利用方式:

1.  **函数名构造：** 通过数学运算构造函数名称字符串，然后使用变量替换注入参数，从而调用任意 PHP 函数。
2.  **对象成员访问：** 利用未经过滤的变量名，通过 `object->{"member"}` 语法调用对象成员，从而执行任意代码。

POC 提供了详细的重现步骤，包括创建计算问题、修改公式、保存问题、预览问题等。也展示了如何通过修改表达式将代码注入到 `eval()` 函数中。通过GET请求提交参数执行系统命令。

**投毒风险：**
该仓库主要内容是漏洞的说明和利用方式，但其中使用到的图片链接无法访问。存在一定的投毒风险。例如，攻击者可能在提供的利用步骤中，修改一些步骤，导致利用失败，或者导致其他预期之外的行为。例如，提供的EXP中使用了`DELETE_COURSE`函数，可能存在非预期数据被删除的风险。

**利用方式：**

1.  攻击者需要具有在 Moodle 课程中创建或修改问题的权限。
2.  创建一个计算问题，或者编辑已有的计算问题。
3.  在问题的公式或答案中使用恶意代码，利用上述两种方式注入代码。
4.  保存问题，并预览该问题。Moodle 将会执行包含恶意代码的公式，导致 RCE。
5.  如果利用成功，服务器将执行攻击者指定的任意命令。

**总结：**
提供的 POC 代码看起来有效，但由于缺乏搜索引擎结果，无法确认漏洞的真实利用情况。仓库本身存在轻微的投毒风险，用户在使用该 POC 代码时，应谨慎验证，避免造成不必要的损失。漏洞利用需要一定的权限，并非所有用户都能利用。需要重点关注函数名称的构造和变量的利用。


**项目地址:** [Tnot123/cve-2024-43425](https://github.com/Tnot123/cve-2024-43425)

**漏洞详情:** [CVE-2024-43425](https://nvd.nist.gov/vuln/detail/CVE-2024-43425)