## CVE-2021-41163-Discourse-RCE

**漏洞编号:** CVE-2021-41163

**漏洞类型:** 远程代码执行

**影响应用:** Discourse

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** < 2.7.9 (stable), < 2.8.0.beta7 (beta/tests-passed)

**利用条件:** 需要目标Discourse实例存在漏洞，且攻击者能够发送恶意请求。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2021-41163 漏洞是 Discourse 平台中的一个远程代码执行漏洞，源于对 `subscribe_url` 值的验证不足。攻击者可以通过构造恶意的 SNS 订阅请求，利用主题导入功能执行任意代码。

**漏洞利用方式：**

1.  **获取CSRF令牌：**  首先，攻击者需要从 Discourse 网站获取 CSRF 令牌，用于后续的请求。
2.  **检查管理员权限：** 检查是否可以直接访问/admin页面，如果不能直接访问，尝试使用常见的权限绕过技术。
3.  **主题上传 RCE：** 上传包含恶意代码的主题 ZIP 文件。POC 代码中包含了 JavaScript RCE、CSS with JavaScript injection、Handlebars template injection、Theme settings with RCE 等多种攻击方式。
4. **Git 仓库导入 RCE：** POC代码中提及但是不完整. 通过导入包含恶意代码的 Git 仓库来触发 RCE。
5.  **主题组件 RCE：** POC代码中提及但是不完整, 利用主题组件执行 RCE。

**有效性：**

根据漏洞库信息、搜索引擎结果（如 CISA 敦促管理员修补此漏洞）以及提供的 POC 代码，该漏洞的利用是有效的。POC 代码针对多种 RCE 场景都提供了利用方式。

**投毒风险：**

该 POC 代码主要展示了如何利用漏洞进行攻击，未发现明显的恶意或隐藏功能。`Date: 2025` 有待验证，可能存在潜在风险。总体投毒风险较低，大约为 1%。该POC的主要目的是演示和验证漏洞，而不是部署后门。但是不排除作者隐藏极小的后门的可能性。

**项目地址:** [ibrahmsql/discourse-CVE-2021-41163](https://github.com/ibrahmsql/discourse-CVE-2021-41163)

**漏洞详情:** [CVE-2021-41163](https://nvd.nist.gov/vuln/detail/CVE-2021-41163)