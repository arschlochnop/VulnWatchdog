## CVE-2021-41773 Apache HTTP Server Path Traversal

**漏洞编号:** CVE-2021-41773

**漏洞类型:** 路径遍历

**影响应用:** Apache HTTP Server

**危害等级:** 高危，可能导致文件泄露和远程代码执行

**影响版本:** 2.4.49

**利用条件:** 需要目标服务器运行存在漏洞的Apache HTTP Server 2.4.49版本，并且Alias-like 指令配置不当，未对外部文件进行访问限制，同时开启了CGI脚本执行。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-41773 漏洞是 Apache HTTP Server 2.4.49 版本中存在的一个路径遍历漏洞。攻击者可以通过构造包含特殊字符（如`.%%32%65`）的URL，绕过服务器的路径规范化检查，从而访问到Alias-like指令配置目录以外的文件。如果目标服务器未对这些目录的文件进行访问限制（`require all denied`），攻击者就能读取敏感信息。更进一步，如果服务器允许在这些路径下执行CGI脚本，攻击者就可以实现远程代码执行。

**有效性分析：**

漏洞库信息和搜索结果均表明该漏洞已在野外被利用，PoC代码的存在也证实了其可利用性。

**利用方式分析：**

根据漏洞描述和提供的PoC代码，可以总结出以下利用方式：

1.  **路径遍历攻击：** 攻击者构造包含特殊编码的路径，例如：`/cgi-bin/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/etc/passwd`尝试读取`/etc/passwd`等敏感文件。
2.  **文件读取：**  如果服务器没有对目标文件进行访问限制，攻击者可以直接读取到文件内容。
3.  **远程代码执行（RCE）：** 如果目标路径允许执行CGI脚本，攻击者可以上传恶意脚本，然后通过路径遍历漏洞执行该脚本，从而实现远程代码执行。

**投毒风险分析：**

提供的PoC代码主要包含以下文件：

*   `1.rb`：一个 Metasploit 模块，尝试通过 GET 请求访问特定 URI（`http://192.168.137.1/cgi-bin/.%%32%65/htdocs/hacklab/websekolah/upload/test.txt`）。该模块的主要目的是读取文件，没有明显的恶意行为。
*   `2.rb`：另一个 Metasploit 模块，尝试通过 GET 请求获取 PDF 文件内容 (tugas.pdf)。该模块的主要目的是读取文件，没有明显的恶意行为。
*   `Makefile`：包含 Maven 命令，用于编译和执行 Java 代码。该命令执行 `com.shell.ReverseShell` 类，并传递一些参数，包括文件名、IP 地址、路径等。**`com.shell.ReverseShell` 存在潜在的投毒风险，因为它可能包含反向 shell 或其他恶意功能。**
*   `apache_rce.rb`：Metasploit 模块，未完全贴出，但是根据文件名推测是进行远程代码执行的模块，存在一定风险。

综合来看，`Makefile` 中调用的 Java 类 `com.shell.ReverseShell` 是最可疑的部分。如果该类包含恶意代码，例如反向 shell，那么执行此 Makefile 就可能导致受害者系统被控制。其他rb文件目前主要进行get请求，风险较低。

**风险评估：**

虽然大部分代码看起来是用于漏洞利用，但是 `Makefile` 中调用的`com.shell.ReverseShell` 存在潜在风险，如果里面包含恶意代码，比如反向 shell，则有被投毒的可能。因此，存在一定的投毒风险，比例估计为10%。

**项目地址:** [belajarqywok/CVE-2021-41773-MSF](https://github.com/belajarqywok/CVE-2021-41773-MSF)

**漏洞详情:** [CVE-2021-41773](https://nvd.nist.gov/vuln/detail/CVE-2021-41773)