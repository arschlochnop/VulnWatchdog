## CVE-2019-18634-sudo-缓冲区溢出

**漏洞编号:** CVE-2019-18634

**漏洞类型:** 缓冲区溢出

**影响应用:** sudo

**危害等级:** 高危，可导致提权

**影响版本:** < 1.8.26

**利用条件:** pwfeedback 在 /etc/sudoers 中启用

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2019-18634 是 sudo 1.8.26 之前版本中的一个缓冲区溢出漏洞。当 /etc/sudoers 中启用 pwfeedback 时，用户可以通过向 tgetpass.c 中的 getln() 函数的 stdin 传递一个长字符串来触发特权 sudo 进程中的基于栈的缓冲区溢出。

**有效性：**
根据漏洞库信息和搜索引擎结果，该漏洞存在于 sudo 1.8.26 之前的版本，并且需要在 /etc/sudoers 文件中启用 pwfeedback 选项。提供的 POC 代码 `exploit.py` 旨在利用此漏洞。它通过创建一个伪终端(pty)，并利用 `sudo -S` 命令将构造的恶意 payload 发送到 sudo 进程的 stdin，从而实现提权。

**投毒风险：**
`exploit.py` 首先创建了一个反向 shell 脚本 `/tmp/shell.sh`，用于在漏洞利用成功后建立与攻击者的连接。虽然这是一个后门，但它是漏洞利用的必要组成部分，而非投毒代码，因为该脚本是攻击者控制目标机器的一种手段。代码中存在通过网络连接的恶意风险,但是脚本代码较少,只有bash反弹shell,可以判断没有隐藏其他恶意指令.所以投毒风险较低,但是考虑到执行了chmod指令,可以判定存在1%投毒风险.

**利用方式：**
1.  **检查 pwfeedback 是否启用：** 首先，攻击者需要确定目标系统上的 /etc/sudoers 文件中是否启用了 pwfeedback 选项。
2.  **创建反向 shell 脚本：** POC 代码创建了一个反向 shell 脚本，当溢出成功时，该脚本会尝试连接到攻击者的机器。
3.  **创建伪终端：** 创建一个伪终端，以便与 sudo 进程进行交互。
4.  **构造 Payload：** 构造一个精心设计的 payload，该 payload 会溢出 getln() 函数的缓冲区，覆盖栈上的返回地址或其他关键数据。
5.  **执行 sudo -S：** 使用 `sudo -S` 命令，并将构造的 payload 通过伪终端的 stdin 发送到 sudo 进程。`SUDO_ASKPASS` 环境变量被设置为反向shell脚本,用于绕过密码输入,因为根本没有密码输入.
6.  **获得 Shell：** 如果漏洞利用成功，攻击者将获得一个具有 root 权限的反向 shell。

**优先级：**
搜索引擎结果和漏洞利用代码提供了有关漏洞利用的更多信息，因此比漏洞库信息具有更高的优先级。漏洞利用代码允许评估漏洞利用的有效性，搜索引擎结果有助于验证漏洞的存在和影响。

**项目地址:** [ngyinkit/cve-2019-18634](https://github.com/ngyinkit/cve-2019-18634)

**漏洞详情:** [CVE-2019-18634](https://nvd.nist.gov/vuln/detail/CVE-2019-18634)