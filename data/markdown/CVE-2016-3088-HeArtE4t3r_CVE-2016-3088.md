## CVE-2016-3088-Apache ActiveMQ 文件上传与执行

**漏洞编号:** CVE-2016-3088

**漏洞类型:** 文件上传与执行

**影响应用:** Apache ActiveMQ

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Apache ActiveMQ 5.x before 5.14.0

**利用条件:** 目标服务器运行存在漏洞版本的ActiveMQ，且Fileserver web application开启，攻击者可以访问目标ActiveMQ的web管理页面。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2016-3088 漏洞存在于 Apache ActiveMQ 5.14.0 之前的 5.x 版本中。该漏洞允许远程攻击者通过 HTTP PUT 请求上传任意文件，然后通过 HTTP MOVE 请求将上传的文件移动到 Web 应用的目录下，从而执行任意代码。攻击者首先上传一个 JSP 文件，然后将其移动到 ActiveMQ 的 admin 目录下，最后通过访问该 JSP 文件来执行恶意代码。

**有效性：**

根据漏洞信息和 Exploit-DB 记录 (https://www.exploit-db.com/exploits/42283/)，以及其他搜索结果，该漏洞存在且EXP利用代码可用，提供的POC代码有效。

**投毒风险：**

查看提供的 Python 脚本 CVE-2016-3088.py，代码逻辑较为清晰，主要功能是：

1.  **参数解析：** 解析目标 URL、上传路径、以及是否使用自定义脚本。
2.  **URL 验证：** 验证 URL 的有效性。
3.  **文件上传：** 使用 PUT 请求上传临时文件。
4.  **文件移动：** 使用 MOVE 请求将临时文件移动到指定位置（通常是 webapps/admin 目录下）。
5.  **Payload：** 脚本默认包含一个简单的payload，该payload支持URL传参执行命令。也可选择用户提供的自定义脚本进行base64编码并上传

代码中存在一定风险，风险主要来自用户提供的脚本参数。如果用户上传的脚本本身就是恶意脚本，那么攻击者就可以利用该漏洞执行恶意代码。但脚本本身并没有发现明显的恶意代码，例如反弹shell、下载执行其他程序等。

所以，投毒风险较低，但不能完全排除用户自定义脚本引入的风险。判断仓库中作者隐藏投毒代码的可能性为5%。

**利用方式：**

1.  **PUT 请求上传文件：** 攻击者首先向目标 ActiveMQ 服务器的 `/fileserver/` 路径发送一个 HTTP PUT 请求，上传一个包含恶意代码（例如 JSP shell）的文件，文件扩展名可以是任意的，因为后续会重命名。
2.  **MOVE 请求移动文件：** 攻击者然后发送一个 HTTP MOVE 请求，将刚刚上传的文件移动到 ActiveMQ Web 应用的目录下，通常是 `webapps/admin/` 目录。在移动的过程中，将文件名更改为 JSP 文件，例如 `shell.jsp`。
3.  **访问 JSP 文件：** 攻击者最后通过访问 `http://<target>/admin/shell.jsp` 来执行恶意代码。

该漏洞的利用依赖于 ActiveMQ 的 Fileserver web application 开启，并且攻击者具有对该应用目录的写权限。

**项目地址:** [HeArtE4t3r/CVE-2016-3088](https://github.com/HeArtE4t3r/CVE-2016-3088)

**漏洞详情:** [CVE-2016-3088](https://nvd.nist.gov/vuln/detail/CVE-2016-3088)