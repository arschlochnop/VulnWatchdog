## CVE-2019-18634-Sudo-Stack-Based Buffer Overflow

**漏洞编号:** CVE-2019-18634

**漏洞类型:** Stack-Based Buffer Overflow

**影响应用:** Sudo

**危害等级:** 高危，可能导致提权

**影响版本:** < 1.8.26

**利用条件:** pwfeedback 在 /etc/sudoers 中被启用

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2019-18634 是 Sudo 1.8.26 之前版本中的一个漏洞，当 /etc/sudoers 文件中启用了 pwfeedback 时，攻击者可以触发特权 sudo 进程中的基于栈的缓冲区溢出。

**有效性：**

根据漏洞库信息、搜索引擎结果以及提供的漏洞利用代码，该漏洞是有效的。漏洞利用代码中给出了触发漏洞的 Python 脚本示例，该脚本通过向 sudo 进程的 stdin 发送超长字符串来溢出缓冲区。

**投毒风险：**

提供的漏洞利用代码主要包括一个用于触发漏洞的 Python 脚本和一个 markdown 格式的说明文档。脚本的功能相对清晰，主要是发送 Payload 导致程序崩溃,没有发现明显的恶意代码或后门。Payload 本身用于溢出，但没有执行恶意操作。说明文档解释了漏洞原理和调试过程。因此，该代码的投毒风险较低，但仍需保持警惕，并进行进一步的代码审计。给1%的投毒风险主要是考虑到代码的复杂性，以及作者可能通过细微的手段植入不易察觉的恶意代码。

**利用方式：**

1.  **前提条件：**  `pwfeedback` 选项需要在 `/etc/sudoers` 文件中被启用。这通常不是默认配置，需要管理员手动配置。
2.  **漏洞触发：**  当满足上述前提条件时，攻击者可以向 `sudo` 命令的输入（stdin）发送一个特制的超长字符串。这个字符串会传递给 `getln()` 函数。
3.  **缓冲区溢出：**  `getln()` 函数在读取输入时，没有正确处理 `sudo_term_kill` 字符，如果 `write` 操作失败，会导致 `cp` 指针不回退，但 `left` 计数器重置，从而允许写入超出缓冲区大小的数据，导致栈溢出。
4.  **权限提升：**  通过精心构造的溢出数据，攻击者可以覆盖栈上的关键数据，例如返回地址，从而控制程序的执行流程。这可以被用来执行任意代码，最终获得 root 权限。

**项目地址:** [l0w3/CVE-2019-18634](https://github.com/l0w3/CVE-2019-18634)

**漏洞详情:** [CVE-2019-18634](https://nvd.nist.gov/vuln/detail/CVE-2019-18634)