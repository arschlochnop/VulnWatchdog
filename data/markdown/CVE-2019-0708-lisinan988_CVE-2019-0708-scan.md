## CVE-2019-0708 (BlueKeep)

**漏洞编号:** CVE-2019-0708

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Remote Desktop Services (RDP)

**危害等级:** 高危，可能导致系统完全控制

**影响版本:** Windows 7 SP1, Windows Server 2008 R2 SP1, Windows Server 2008 SP2

**利用条件:** 目标系统开启RDP服务，且未打CVE-2019-0708补丁

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-0708 (BlueKeep) 是一个存在于微软远程桌面服务中的远程代码执行漏洞。未经身份验证的攻击者可以通过RDP协议发送特制请求来利用此漏洞，从而在目标系统上执行任意代码。

**有效性：**
根据漏洞库信息和搜索结果，CVE-2019-0708 是一个严重的安全漏洞，并且存在公开可用的漏洞利用代码。搜索结果中来自 Palo Alto Networks Unit 42 的报告详细介绍了利用该漏洞的三种方法，表明该漏洞的利用是可行的。CISA 将此漏洞列入已知被利用的漏洞目录中，进一步证明了其有效性。

**投毒风险：**
提供的 POC 代码 `MS12-002-POC.py` 似乎是 CVE-2019-0708 漏洞的早期尝试利用，可能不是最可靠的版本。代码中包含大量的硬编码数据包，这在一定程度上限制了其通用性。此外，代码包含一个变量 `sc` 包含 shellcode，该 shellcode 最终执行 `mshta vbscript`，显示一个消息框。如果作者的目的是创建具有恶意目的的PoC(投毒代码)，而不是漏洞利用验证，该消息框可以被替换为更危险的操作，如执行任意命令或下载恶意软件。
尽管消息框看起来是良性的，但它仍然可能被用来掩盖恶意行为。通过结合网络信息检索，发现此PoC来源于 k8gege，是一个比较早期但是仍然有效的PoC，可以认定投毒风险较低。

根据代码分析来看, 代码比较老旧, 具有一定的投毒风险(比如将 messagebox 修改为执行恶意代码), 但是可能性较小，风险评估为 10%。

**利用方式：**
该漏洞的利用方式通常涉及以下步骤：
1.  **连接目标 RDP 服务：** 攻击者首先需要通过 RDP 协议连接到目标系统。
2.  **发送特制请求：** 攻击者构造包含恶意数据的 RDP 请求，这些请求会触发目标系统上的内存损坏或利用漏洞。
3.  **执行任意代码：** 如果漏洞利用成功，攻击者就可以在目标系统上执行任意代码，从而获得系统控制权。

`MS12-002-POC.py` 代码的利用方式如下：
1.  **建立 Socket 连接：** 使用 Python 的 `socket` 库建立与目标主机 RDP 端口（默认为 3389）的 TCP 连接。
2.  **发送恶意 RDP 数据包：** 将预先构造的恶意 RDP 数据包（存储在变量 `buf` 中）发送到目标主机。
3.  **触发漏洞：** 恶意数据包的发送会触发目标系统 RDP 服务中的漏洞，导致代码执行。

需要注意的是，成功利用此漏洞可能需要根据目标系统的具体环境进行调整，例如操作系统版本和已安装的补丁。

**项目地址:** [lisinan988/CVE-2019-0708-scan](https://github.com/lisinan988/CVE-2019-0708-scan)

**漏洞详情:** [CVE-2019-0708](https://nvd.nist.gov/vuln/detail/CVE-2019-0708)