## CVE-2020-24913-QCubed-SQL注入

**漏洞编号:** CVE-2020-24913

**漏洞类型:** SQL注入

**影响应用:** QCubed

**危害等级:** 高危，可能导致数据泄露

**影响版本:** <= 3.1.1

**利用条件:** 需要网络访问

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-24913是QCubed框架中profile.php文件存在的一个SQL注入漏洞，影响所有版本，包括3.1.1。该漏洞位于profile.php文件的`strQuery`参数，攻击者可以通过构造恶意SQL代码的POST请求，未经身份验证即可访问数据库。

**有效性：**

提供的PoC代码是有效的。PoC使用基于时间的盲注方法，因为无法使用堆叠查询。它展示了如何通过注入`SLEEP()`函数来判断条件是否为真，以此来提取数据库信息。通过控制`strProfileData`参数中的序列化数据和base64编码，攻击者可以执行任意SQL查询。

**投毒风险：**

该PoC仓库的主要目的是演示CVE-2020-24913漏洞，并没有明显的恶意代码。但是，任何公开的PoC都存在被修改并加入恶意代码的风险。该仓库的投毒风险评估为10%，主要考虑以下因素：

*   **代码复杂性：** PoC代码相对简单，更容易审查，降低了隐藏恶意代码的可能性。
*   **开发者信誉：** 开发者agarma在GitHub上公开了PoC，表明其意图是公开漏洞信息而非恶意攻击。
*   **社区审查：** 任何公开的PoC都会受到安全社区的审查，有助于发现潜在的恶意代码。

即便如此，用户在使用任何第三方PoC时都应该谨慎，仔细审查代码，并在隔离环境中进行测试，以避免潜在的风险。

**利用方式：**

1.  攻击者向`profile.php`发送一个POST请求，其中包含名为`strProfileData`的参数。
2.  `strProfileData`参数的值是一个经过base64编码的PHP序列化数组。
3.  该数组包含一个键为`strQuery`的元素，其值是攻击者注入的恶意SQL代码。
4.  服务器在处理`strQuery`参数时没有进行充分的过滤或转义，导致SQL注入漏洞。
5.  攻击者可以使用基于时间的盲注来提取数据库信息，例如数据库版本、表名、列名和数据。
6. PoC中使用 `SLEEP()` 函数来判断SQL查询条件真假，从而推断出数据库信息。

**修复建议：**

*   对所有用户输入进行严格的验证和过滤。
*   使用参数化查询或预编译语句来防止SQL注入。
*   升级到QCubed的最新版本，或应用官方提供的安全补丁。

**项目地址:** [agarma/CVE-2020-24913-PoC](https://github.com/agarma/CVE-2020-24913-PoC)

**漏洞详情:** [CVE-2020-24913](https://nvd.nist.gov/vuln/detail/CVE-2020-24913)