## CVE-2024-21762 - Fortinet FortiOS/FortiProxy 越界写入

**漏洞编号:** CVE-2024-21762

**漏洞类型:** 越界写入

**影响应用:** FortiOS/FortiProxy

**危害等级:** 高危，远程代码执行

**影响版本:** FortiOS: 7.4.0-7.4.2, 7.2.0-7.2.6, 7.0.0-7.0.13, 6.4.0-6.4.14, 6.2.0-6.2.15, 6.0.0-6.0.17; FortiProxy: 7.4.0-7.4.2, 7.2.0-7.2.8, 7.0.0-7.0.14, 2.0.0-2.0.13, 1.2.0-1.2.13, 1.1.0-1.1.6, 1.0.0-1.0.7

**利用条件:** 目标设备开启SSL VPN服务且允许未授权访问。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-21762是一个Fortinet FortiOS和FortiProxy中的越界写入漏洞。未经身份验证的远程攻击者可以通过特制的请求执行任意代码或命令。该漏洞存在于SSL VPN的sslvpnd守护进程中。 

**有效性分析：**
根据漏洞库信息和搜索引擎结果，该漏洞已经被积极利用。提供的POC代码是一个漏洞检测脚本，它利用Shodan API查找运行易受攻击的Fortigate SSL VPN的设备，并发送特定的HTTP请求来检查漏洞是否存在。具体检测方式是通过发送`control_req`和`check_req` 两个请求,根据返回状态判断是否存在漏洞。

**投毒风险分析：**
代码主要功能是查找并验证漏洞，没有发现明显的恶意代码，但存在以下潜在风险：
1.  **依赖风险：** `requirements.txt` 文件中列出的依赖库可能存在安全问题，如果安装了包含恶意代码的依赖项，可能导致投毒。
2.  **API密钥泄露：** 该脚本要求用户设置Shodan API密钥作为环境变量。如果用户的API密钥泄露，攻击者可以使用该密钥进行恶意活动。
3.  **滥用Shodan API：** 大规模扫描可能会被Shodan限制。
4.  **误报/漏报：** POC 代码的检测逻辑可能存在缺陷，导致误报或漏报。
考虑到代码的功能主要是漏洞检测而非利用，且依赖项比较常见，直接投毒的可能性较低，但以上潜在风险仍然存在。因此，投毒风险估计为5%。

**利用方式：**
1.  **信息收集：** 使用Shodan等搜索引擎查找暴露在互联网上的Fortinet SSL VPN设备。
2.  **漏洞验证：** 使用POC代码或类似工具验证目标设备是否存在CVE-2024-21762漏洞。
3.  **漏洞利用：** 如果设备存在漏洞，攻击者可以构造特制的HTTP请求来触发越界写入，从而执行任意代码或命令。
4.  **权限提升和持久化：** 在成功执行代码后，攻击者可以尝试提升权限，并在目标系统中建立持久化连接。

**缓解措施：**
1.  及时更新FortiOS和FortiProxy版本到安全版本。
2.  禁用或限制SSL VPN的访问。
3.  使用入侵检测系统（IDS）或入侵防御系统（IPS）来检测和阻止恶意流量。

**项目地址:** [rdoix/cve-2024-21762-checker](https://github.com/rdoix/cve-2024-21762-checker)

**漏洞详情:** [CVE-2024-21762](https://nvd.nist.gov/vuln/detail/CVE-2024-21762)