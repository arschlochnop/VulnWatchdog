## CVE-2017-0144 - Windows SMB 远程代码执行

**漏洞编号:** CVE-2017-0144

**漏洞类型:** 远程代码执行

**影响应用:** Windows SMBv1

**危害等级:** 高危，可能导致远程代码执行和系统控制

**影响版本:** Windows Vista SP2; Windows Server 2008 SP2 and R2 SP1; Windows 7 SP1; Windows 8.1; Windows Server 2012 Gold and R2; Windows RT 8.1; and Windows 10 Gold, 1511, and 1607; and Windows Server 2016

**利用条件:** 目标系统开启 SMBv1 服务且存在漏洞。

**POC 可用性:** 是

**投毒风险:** 20%

## 详情

CVE-2017-0144 漏洞（也被称为 EternalBlue）存在于 Microsoft Windows 的 SMBv1 服务器中。远程攻击者可以通过精心制作的 SMB 数据包利用此漏洞执行任意代码。

**有效性：**
根据漏洞库信息和搜索结果，此漏洞是一个高危漏洞，并且已经存在公开的漏洞利用代码。提供的 `eternalblue_scanner.py` 脚本旨在检测目标系统是否存在此漏洞。虽然此脚本本身不执行攻击，但它为进一步的漏洞利用提供了基础。

**投毒风险：**
分析提供的 `eternalblue_scanner.py` 脚本，该脚本的主要功能是发送特制的 SMB 数据包来检测目标系统是否存在 CVE-2017-0144 漏洞。通过分析代码，发现该脚本主要执行以下操作：

*   构建 SMB 协议数据包（`negotiate_proto_request`, `session_setup_andx_request` 等）。
*   发送这些数据包到目标系统。
*   根据响应判断目标系统是否易受攻击。

  脚本本身的功能是漏洞扫描，不包含任何主动植入后门或恶意代码的行为。因此，直接的投毒风险较低，例如，该脚本没有尝试写入文件、执行系统命令或进行其他恶意操作。投毒风险评估为20%。

**利用方式：**
1.  **协议协商：** 攻击者首先发送一个 SMB 协议协商请求（`negotiate_proto_request`）到目标系统，以确定双方使用的 SMB 协议版本。
2.  **会话建立：** 攻击者尝试建立一个 SMB 会话（`session_setup_andx_request`）。
3.  **漏洞触发：** 通过发送精心构造的 SMB 数据包来触发漏洞。具体的触发方式涉及 SMB 协议中的特定数据结构和字段，利用不正确的长度计算或边界检查错误，导致缓冲区溢出或内存损坏。
4.  **代码执行：** 成功利用漏洞后，攻击者可以在目标系统上执行任意代码。通常，攻击者会注入 shellcode，shellcode 负责下载并执行恶意负载，或者直接在内存中执行恶意操作。

**项目地址:** [kimocoder/eternalblue](https://github.com/kimocoder/eternalblue)

**漏洞详情:** [CVE-2017-0144](https://nvd.nist.gov/vuln/detail/CVE-2017-0144)