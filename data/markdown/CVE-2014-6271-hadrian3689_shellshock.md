## CVE-2014-6271 Shellshock

**漏洞编号:** CVE-2014-6271

**漏洞类型:** 远程代码执行

**影响应用:** GNU Bash

**危害等级:** 高危，可能导致远程代码执行，系统完全控制

**影响版本:** Bash <= 4.3

**利用条件:** 目标系统存在CGI脚本或通过OpenSSH等方式设置环境变量

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2014-6271，也被称为Shellshock，是一个存在于GNU Bash中的远程代码执行漏洞。该漏洞允许攻击者通过构造包含恶意代码的环境变量来执行任意命令。

**有效性：**
提供的POC代码是有效的。该Python脚本利用Shellshock漏洞通过User-Agent头注入恶意Bash代码，从而在目标系统上执行命令，可以实现反向shell或伪交互式shell。

**投毒风险：**
该脚本主要功能是利用Shellshock漏洞，但代码中存在一定的投毒风险：
*   **风险点：** `shellshock.py`中的payload构造部分，即`payload = "() { :;}; echo; /bin/bash -c 'echo " + cmd + " | base64 -d | sh'"`。虽然脚本本身的目标是实现反向shell，但是攻击者可以修改`cmd`变量的内容，插入恶意的、非反向shell的代码，进行破坏或植入后门。
*   **缓解措施：** 使用者应仔细审查脚本内容，尤其是`cmd`变量的赋值部分，确保脚本执行的是预期操作，并且来自可信来源。
*   **投毒风险百分比:** 10%。主要是脚本中自定义命令的灵活性可能被滥用，并非恶意代码。大部分代码功能清晰，实现的是漏洞利用逻辑。

**利用方式：**
1.  **漏洞原理：** Bash在解析环境变量时，如果环境变量的值包含函数定义，Bash会执行函数定义后面的字符串。攻击者可以利用这个特性，在环境变量中注入恶意代码。
2.  **攻击方法：**
    *   **通过HTTP User-Agent头：** POC脚本通过修改HTTP请求的User-Agent头，将包含恶意代码的环境变量传递给服务器。如果服务器使用Bash处理User-Agent头（例如，通过CGI脚本），那么恶意代码就会被执行。
    *   **反向Shell：** 脚本通过构造Bash命令，建立与攻击者机器的反向TCP连接，从而获得目标系统的shell访问权限。
    *   **正向Shell (防火墙绕过)：** 脚本创建一个命名管道(FIFO)用于输入和输出，攻击者通过HTTP请求向管道写入命令，并读取管道的输出来实现交互式shell。这种方式可以绕过一些防火墙的限制。
3.  **利用条件：**
    *   目标系统运行着存在Shellshock漏洞的Bash版本。
    *   存在可以传递环境变量给Bash的途径，例如CGI脚本、OpenSSH的ForceCommand等。
    *   如果使用反向shell，目标系统需要能够连接到攻击者的机器。

**项目地址:** [hadrian3689/shellshock](https://github.com/hadrian3689/shellshock)

**漏洞详情:** [CVE-2014-6271](https://nvd.nist.gov/vuln/detail/CVE-2014-6271)