## CVE-2022-22536 - SAP NetWeaver Request Smuggling/Concatenation

**漏洞编号:** CVE-2022-22536

**漏洞类型:** HTTP Request Smuggling/Concatenation

**影响应用:** SAP NetWeaver Application Server ABAP, SAP NetWeaver Application Server Java, ABAP Platform, SAP Content Server, SAP Web Dispatcher

**危害等级:** 高危，可能导致信息泄露、权限提升、缓存投毒、拒绝服务

**影响版本:** KERNEL 7.22, 8.04, 7.49, 7.53, 7.77, 7.81, 7.85, 7.86, 7.87, KRNL64UC 8.04, 7.22EXT, KRNL64NUC 7.22

**利用条件:** 目标系统存在漏洞版本，攻击者需要能够与目标系统建立网络连接。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-22536 是 SAP NetWeaver 平台上的一个 HTTP 请求走私/串联漏洞。未经身份验证的攻击者可以将恶意数据添加到受害者的请求中，从而冒充受害者执行功能或毒化中间 Web 缓存，可能导致系统完全崩溃。 

**漏洞利用方式分析：**

1.  **漏洞原理：** 该漏洞的根本原因是 SAP Web Dispatcher 或 SAP 应用服务器在处理 HTTP 请求时，对 Content-Length 和 Transfer-Encoding 等头部解析不一致，导致请求边界混淆。攻击者可以构造特殊的 HTTP 请求，将多个请求拼接在一起，服务器错误地将恶意请求的一部分解释为下一个用户的请求。

2.  **POC 代码分析：** 提供的 POC 代码旨在利用此漏洞。该代码首先尝试验证和缓存资源。然后，它构造一个包含填充数据和代理对齐请求的恶意 HTTP 请求。填充数据旨在利用 Content-Length 的差异，而代理对齐请求旨在确保服务器正确处理响应。代码发送这个恶意请求，并解析服务器的响应，以判断漏洞是否存在。具体来说:
    * `craft_payload` 函数构造恶意 payload，包含了填充数据和代理对齐请求。
    * `validate_resource_and_cache` 函数验证资源是否有效并缓存，为后续攻击做准备。
    * `send_payload` 函数负责发送payload并接收响应。
    * `parse_response` 函数解析响应，提取状态码等信息。

3. **有效性:** 根据漏洞库信息和提供的POC代码, 此POC代码可以验证并利用 CVE-2022-22536。

4. **投毒风险:** 检查了整个代码，没有发现明显的投毒代码。代码逻辑主要集中在构建和发送恶意 HTTP 请求，以及解析服务器响应。所有操作都在漏洞利用的范畴内。因此，投毒风险评估为 0%。

**项目地址:** [ZZ-SOCMAP/CVE-2022-22536](https://github.com/ZZ-SOCMAP/CVE-2022-22536)

**漏洞详情:** [CVE-2022-22536](https://nvd.nist.gov/vuln/detail/CVE-2022-22536)