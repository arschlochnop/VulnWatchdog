## CVE-2023-50164 - Apache Struts 文件上传路径遍历导致远程代码执行

**漏洞编号:** CVE-2023-50164

**漏洞类型:** 路径遍历/远程代码执行

**影响应用:** Apache Struts

**危害等级:** 高危，可能导致远程代码执行和服务器控制

**影响版本:** 2.0.0 <= version <= 2.5.32, 6.0.0 <= version <= 6.3.0.1

**利用条件:** 存在文件上传功能，且使用了受影响的Struts版本

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-50164 是 Apache Struts 2 中的一个严重漏洞，攻击者可以通过操纵文件上传参数来利用路径遍历漏洞，在特定情况下，这可能导致上传恶意文件，从而执行远程代码。

**有效性评估：**
根据漏洞库信息和搜索引擎结果，该漏洞已被公开披露，并且存在公开可用的PoC（Proof of Concept）利用代码。提供的代码仓库包含了一个简单的 Struts 2 应用，用于演示漏洞检测。虽然代码本身只是一个演示，但基于已公开的信息和 PoC 的存在，可以判定该漏洞是有效的。

**投毒风险分析：**
提供的代码仓库主要包含以下文件：
*   Dockerfile：用于构建包含 Struts 2 应用的 Docker 镜像。
*   README.md：项目介绍。
*   java-deployment.yaml：Kubernetes 部署文件。
*   pom.xml：Maven 项目配置文件，声明 Struts 2 依赖。
*   src/main/webapp/hello.jsp：JSP 页面。
*   src/main/webapp/WEB-INF/web.xml：Web 应用配置文件。
*   src/main/resources/struts.xml：Struts 配置文件。
*   src/main/java/com/example/HelloAction.java：Struts Action 类。

代码库本身似乎是为了演示漏洞检测而构建的，作者声明Sysdig不对代码提供任何保证。虽然该项目的目的是好的，但是代码仓库中的 `java-deployment.yaml` 文件中 `image: placeholder`，这意味着需要用户手动替换镜像，如果用户替换成包含恶意代码的镜像，那么该项目就会被投毒；其次该项目仓库中使用的是struts2-core 2.5.22版本，该版本已经受到影响，如果被攻击者修改struts.xml等配置文件，放入恶意代码，也会导致投毒。考虑到作者的免责声明，并且代码仓库本身的结构更偏向于演示目的，投毒的可能性较低，大约为 10%。

**利用方式：**
1.  **路径遍历：** 攻击者通过修改文件上传请求中的参数（例如，文件名），使其包含 `../` 等路径遍历字符。
2.  **恶意文件上传：** 攻击者利用路径遍历将恶意文件上传到 Web 服务器的可执行目录下，例如 Web 应用的根目录或 Tomcat 的 webapps 目录。
3.  **远程代码执行：** 攻击者访问上传的恶意文件，触发服务器执行其中的代码，从而实现远程代码执行。

简而言之，利用方式的核心在于利用路径遍历上传一个可执行的文件，例如包含恶意代码的 JSP 文件或者 Servlet，然后通过访问该文件来触发恶意代码的执行。

**项目地址:** [aaronm-sysdig/cve-2023-50164](https://github.com/aaronm-sysdig/cve-2023-50164)

**漏洞详情:** [CVE-2023-50164](https://nvd.nist.gov/vuln/detail/CVE-2023-50164)