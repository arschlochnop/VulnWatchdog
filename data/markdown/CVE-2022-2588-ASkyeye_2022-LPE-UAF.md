## CVE-2022-2588-Linux Kernel Use-After-Free

**漏洞编号:** CVE-2022-2588

**漏洞类型:** Use-After-Free

**影响应用:** Linux Kernel

**危害等级:** 中危，可能导致拒绝服务或权限提升

**影响版本:** < 6.0~rc1

**利用条件:** 需要用户命名空间支持

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-2588 是一个 Linux 内核中的 use-after-free 漏洞，存在于 cls_route 过滤器实现中。当过滤器的句柄值为 0 时，在释放过滤器之前，不会从哈希表中删除旧的过滤器，导致释放后使用。

**有效性：**

根据搜索结果，存在多个关于此漏洞的报告和PoC代码。结合漏洞库信息，该漏洞在 Linux kernel 6.0 rc1 之前的版本中存在。提供的代码仓库 [https://github.com/Markakd/CVE-2022-2588](https://github.com/Markakd/CVE-2022-2588) 表明存在可利用的PoC，验证了该漏洞的有效性。

**投毒风险：**

提供的两个 C 代码文件 `CVE-2022-2585.c` 和 `CVE-2022-2586.c`，看起来并不直接对应 CVE-2022-2588。`CVE-2022-2585.c` 似乎利用timer机制触发漏洞，而 `CVE-2022-2586.c` 通过 netfilter (nftables) 来设置一些规则和对象。虽然`CVE-2022-2586.c`创建了表、对象、集合，看起来有利用的潜力，但很难明确判断是否存在隐藏的投毒代码。需要进一步分析才能确定是否存在恶意行为。初步判断，投毒风险较低，估计为 10%。这里认为 `CVE-2022-2585.c` 和 `CVE-2022-2586.c`的命名有误，应是用于辅助利用CVE-2022-2588的，而不是两个独立的漏洞的POC。

**利用方式：**

利用方式大致如下：

1.  创建一个 cls_route 过滤器，并设置句柄为 0。
2.  释放该过滤器，但不将其从哈希表中移除。
3.  再次使用该过滤器，导致 use-after-free。
4. `CVE-2022-2586.c` 构造 netfilter 对象和 rules，可能是为了方便在利用use-after-free的时候，更容易控制执行流程，提升权限。
5. `CVE-2022-2585.c`则使用了用户命名空间来创建一个子进程，并使用timer触发poc，可能为了绕过一些缓解措施，或者创造并发条件。

**项目地址:** [ASkyeye/2022-LPE-UAF](https://github.com/ASkyeye/2022-LPE-UAF)

**漏洞详情:** [CVE-2022-2588](https://nvd.nist.gov/vuln/detail/CVE-2022-2588)