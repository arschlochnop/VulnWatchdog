## CVE-2025-47812 - Wing FTP Server Unauthenticated Remote Code Execution (RCE)

**漏洞编号:** CVE-2025-47812

**漏洞类型:** 远程代码执行

**影响应用:** Wing FTP Server

**危害等级:** 高危，未经身份验证的远程代码执行，可能导致服务器完全控制

**影响版本:** <= 7.4.3

**利用条件:** 目标服务器需要运行易受攻击的Wing FTP Server版本，且攻击者需要能够访问/loginok.html和/dir.html

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

该漏洞存在于Wing FTP Server 7.4.3及更早版本中。攻击者可以通过向/loginok.html发送包含NULL字节和Lua代码注入的恶意POST请求，在服务器上执行任意代码。漏洞利用的关键在于`username`参数处理中的缺陷：c_CheckUser()函数在NULL字节处截断用户名，而会话创建逻辑使用未经处理的完整用户名。成功身份验证（即使是匿名身份验证）后，服务器会设置一个UID cookie。然后，攻击者使用这个UID cookie向/dir.html发送GET请求，触发注入的Lua代码的执行，从而导致RCE。提供的PoC代码通过构造包含恶意负载的请求，自动化了该过程。

**有效性：** 根据提供的漏洞利用代码和描述，此PoC代码应有效，因为它精确地利用了漏洞描述中概述的NULL字节注入和Lua代码执行逻辑。

**投毒风险：** 经过对PoC代码的分析，未发现明显的恶意代码或后门。该脚本主要目的是利用漏洞执行命令，没有迹象表明存在任何隐藏的、与利用目标漏洞无关的恶意行为。因此，投毒风险评估为0%。

**利用方式：**

1.  攻击者向目标服务器的`/loginok.html`发送POST请求。
2.  POST请求的`username`参数包含一个经过URL编码的字符串，其中包含用户名，后跟NULL字节（`%00`），然后是经过URL编码的Lua代码。
3.  服务器验证用户名时，`c_CheckUser()` 函数在NULL字节处截断用户名，从而绕过身份验证。
4.  服务器创建会话文件时，使用完整的、未经过处理的用户名（包含Lua代码）。
5.  攻击者从登录响应中提取UID cookie。
6.  攻击者向`/dir.html`发送GET请求，并在Cookie头中包含提取的UID。
7.  当服务器处理`/dir.html`请求时，会加载包含恶意Lua代码的会话文件，导致代码执行。
8.  执行的Lua代码执行攻击者指定的命令，命令输出返回给攻击者。

**项目地址:** [4m3rr0r/CVE-2025-47812-poc](https://github.com/4m3rr0r/CVE-2025-47812-poc)

**漏洞详情:** [CVE-2025-47812](https://nvd.nist.gov/vuln/detail/CVE-2025-47812)