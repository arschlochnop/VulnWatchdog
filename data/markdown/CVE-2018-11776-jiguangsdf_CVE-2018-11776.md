## CVE-2018-11776-Apache Struts 远程代码执行

**漏洞编号:** CVE-2018-11776

**漏洞类型:** 远程代码执行

**影响应用:** Apache Struts

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** 2.3 to 2.3.34, 2.5 to 2.5.16

**利用条件:** alwaysSelectFullNamespace 为 true，且存在特定的namespace配置

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2018-11776 (S2-057) 是一个 Apache Struts 2 的远程代码执行漏洞。该漏洞是由于 Struts 在 XML 配置中，当 namespace 值未设置，且 Action Configuration 中未设置或用通配符 namespace 时，可能导致远程代码执行。

**有效性：**
根据漏洞库信息和搜索引擎结果，该漏洞是一个真实存在且高危的远程代码执行漏洞。提供的 POC 代码 `s2-057.py` 旨在验证漏洞是否存在。POC通过构造特殊的 URL，利用 OGNL 表达式注入，判断服务器是否返回预期的状态码和内容来判断漏洞是否存在。从代码逻辑来看，POC的有效性较高。

**投毒风险：**
分析提供的 POC 代码 `s2-057.py`，未发现明显的投毒代码。该脚本主要功能是发送 HTTP 请求，验证目标 URL 是否存在 CVE-2018-11776 漏洞。脚本中没有发现任何试图在目标服务器上执行恶意操作的代码，例如上传后门、篡改文件等。脚本只是通过判断HTTP响应状态码和Header头中的Location或者Response的内容，来判断是否存在漏洞。

**利用方式：**
1.  **条件：** 需要目标 Struts 应用满足以下条件：
    *   Struts 版本在 2.3.x (2.3 to 2.3.34) 或 2.5.x (2.5 to 2.5.16) 范围内。
    *   `alwaysSelectFullNamespace` 设置为 `true`（通常由用户或插件如 Convention Plugin 设置）。
    *   结果 (results) 在没有 namespace 的情况下使用，并且其上层 package 没有或使用了通配符 namespace。
    *   或者，使用 `url` 标签，但 `value` 和 `action` 未设置，并且其上层 package 没有或使用了通配符 namespace。
2.  **Payload 构造：** 攻击者构造包含恶意 OGNL 表达式的 URL。该表达式会被 Struts 解析和执行，从而导致远程代码执行。
3.  **触发漏洞：** 攻击者发送构造好的 URL 到目标 Struts 应用。Struts 处理请求时，会解析并执行 OGNL 表达式，导致远程代码执行。
4.  **代码执行：** 根据 POC 的验证方法，可以通过判断特定的HTTP响应状态码和Header头中的Location或者Response的内容，来判断是否存在漏洞，或者直接执行系统命令来获取执行结果。

综上所述，该漏洞利用方式较为直接，但需要满足特定的配置条件。提供的 POC 代码可以有效验证漏洞的存在，但本身没有投毒风险。

**项目地址:** [jiguangsdf/CVE-2018-11776](https://github.com/jiguangsdf/CVE-2018-11776)

**漏洞详情:** [CVE-2018-11776](https://nvd.nist.gov/vuln/detail/CVE-2018-11776)