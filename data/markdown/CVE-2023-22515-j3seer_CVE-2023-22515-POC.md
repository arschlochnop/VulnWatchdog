## CVE-2023-22515 Atlassian Confluence 权限提升/未授权管理员创建漏洞

**漏洞编号:** CVE-2023-22515

**漏洞类型:** 权限提升/Broken Access Control

**影响应用:** Atlassian Confluence Data Center/Server

**危害等级:** 高危，允许未授权用户创建管理员账户，完全控制 Confluence 实例

**影响版本:** 8.0.0 <= version < 8.3.3, 8.4.0 <= version < 8.4.3, 8.5.0 <= version < 8.5.2

**利用条件:** Confluence 实例可以公开访问，并且未完成初始化设置。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2023-22515 漏洞是一个 Atlassian Confluence Server 和 Data Center 实例上的严重权限提升漏洞。未经身份验证的攻击者可以利用此漏洞创建未经授权的 Confluence 管理员帐户并访问 Confluence 实例。

**漏洞利用方式：**

1.  **绕过安全检查:** 通过 `server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`  设置 `setupComplete`  为 `false`，绕过 Confluence 的安装设置检查。
2.  **创建管理员账户:** 利用 `/setup/setupadministrator.action`  端点，创建一个新的管理员账户。攻击者可以指定用户名、全名、邮箱和密码。
3.  **完成安装设置:** 利用 `/setup/finishsetup.action`  端点，完成安装设置。
4.  **XSRF 绕过:** 使用 `X-Atlassian-Token: no-check`  header 绕过跨站请求伪造 (XSRF) 保护。

**有效性：**

提供的 YAML 文件和 README.md 描述了一种有效的攻击方式。多个搜索结果也表明该漏洞已被积极利用。

**投毒风险：**

该漏洞利用代码的仓库中未发现明显的投毒代码。YAML 文件和 README.md 仅包含漏洞利用的必要步骤和信息。没有任何迹象表明作者试图隐藏恶意代码或后门。

**漏洞分析:**

该漏洞的根本原因是 Confluence 在初始化设置过程中，存在不安全的访问控制。攻击者可以通过操纵特定的 HTTP 请求参数，绕过安全检查，从而创建管理员账户。`Xwork interceptors`解析参数的特性,使得攻击者可以利用`set`和`get`方法,结合`X-Atlassian-Token`绕过XSRF,最终利用`/setup/*`创建管理员.


**项目地址:** [j3seer/CVE-2023-22515-POC](https://github.com/j3seer/CVE-2023-22515-POC)

**漏洞详情:** [CVE-2023-22515](https://nvd.nist.gov/vuln/detail/CVE-2023-22515)