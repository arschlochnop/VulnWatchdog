## CVE-2024-8193-Google Chrome-Skia堆缓冲区溢出

**漏洞编号:** CVE-2024-8193

**漏洞类型:** 堆缓冲区溢出

**影响应用:** Google Chrome

**危害等级:** 高危，可能导致堆破坏和远程代码执行

**影响版本:** < 128.0.6613.113

**利用条件:** 需要用户打开恶意HTML页面，且Renderer进程已被攻破

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-8193是Google Chrome浏览器Skia组件中的一个堆缓冲区溢出漏洞。该漏洞允许攻击者通过构造恶意HTML页面，在Renderer进程中触发堆破坏，从而可能执行任意代码。利用该漏洞需要攻击者首先攻破Renderer进程。提供的POC代码包含一个chromium.diff文件，用于修改gpu/command_buffer/client/raster_implementation.cc文件，引入了Skia图片数据。genskpic.py脚本用于生成drawable_picture.skp.hh，其中包含恶意Skia图片数据。攻击者需要应用该补丁，编译Chrome，并通过index.html触发漏洞。 

**有效性:** 根据描述，GPU进程会崩溃，证明POC可以触发漏洞，但可能需要进一步分析才能实现完整的代码执行。所以有效，但可能不稳定。

**投毒风险:** 投毒风险较低，约5%。主要基于以下几点考虑：
 1. 代码目的是为了触发堆溢出，通过构造特定大小和结构的Skia图片数据来实现。
 2. diff文件修改了raster_implementation.cc，增加了一些额外的处理逻辑，这些逻辑是为了触发漏洞。
 3.  虽然代码中包含二进制数据（kSkiaPictureBytes），但这些数据是Skia图片序列化后的结果，用于触发漏洞，并非恶意后门。
 4.  补丁中的条件判断 `if (base::CommandLine::ForCurrentProcess()->GetSwitchValueASCII("type") == "renderer" && raster_mapped_buffer_->size() > 32000)` 表明漏洞只在特定条件下触发，增加了分析和利用的复杂度，降低了攻击者利用此代码进行大规模投毒的可能性。

**利用方式:**

1.  **漏洞定位:** 漏洞位于Skia图形库中，由不正确的内存管理导致堆缓冲区溢出。
2.  **触发条件:** 需要用户打开包含恶意构造的HTML页面的网页。Renderer进程需要被攻破后才能触发该漏洞。
3.  **利用过程:** 攻击者首先需要制作包含恶意Skia图片的HTML页面。当用户使用受影响的Chrome版本打开该页面时，Renderer进程在处理Skia图片时会触发堆缓冲区溢出，进而可能导致任意代码执行。具体而言，补丁引入了一段代码，它在Renderer进程中创建了多个缓冲区和共享内存。然后，它将预先构建的Skia图片数据写入这些缓冲区，触发堆溢出。
4.  **补丁分析:** 补丁通过修改`raster_implementation.cc`文件，在`UnmapRasterCHROMIUM`函数中添加了漏洞触发代码。这段代码首先检查进程类型是否为renderer，以及raster_mapped_buffer_的大小。如果满足条件，则创建一些buffer，并使用恶意Skia数据填充它们。


**项目地址:** [HyHy100/Chrome-Skia-CVE-2024-8193](https://github.com/HyHy100/Chrome-Skia-CVE-2024-8193)

**漏洞详情:** [CVE-2024-8193](https://nvd.nist.gov/vuln/detail/CVE-2024-8193)