## CVE-2024-38856-Apache OFBiz-未授权访问漏洞

**漏洞编号:** CVE-2024-38856

**漏洞类型:** 未授权访问/远程代码执行

**影响应用:** Apache OFBiz

**危害等级:** 高危，可能导致远程代码执行和数据泄露

**影响版本:** <= 18.12.14

**利用条件:** 需要网络访问，目标服务器开启了webtools应用且存在未授权的ProgramExport接口

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-38856 是 Apache OFBiz 中的一个未授权访问漏洞，允许未经身份验证的攻击者执行任意 Groovy 代码，从而导致远程代码执行。漏洞存在于webtools应用下的ProgramExport接口，如果该接口未进行适当的权限控制，攻击者可以通过构造恶意的 Groovy 脚本，利用 execute() 方法执行系统命令。\n\n**有效性：** 提供的POC代码（scanner.py和exploit.py）看起来是有效的。scanner.py 脚本通过访问特定的 URL 并检查响应中是否存在指示漏洞存在的字符串来验证目标是否易受攻击。exploit.py 脚本利用漏洞通过构造包含恶意 Groovy 脚本的请求来执行远程代码。脚本中包含对payload进行base64编码,unicode编码的操作,可以绕过部分WAF的检测。\n\n**投毒风险：** 漏洞利用代码本身未发现明显的投毒代码。但存在一定风险，scanner.py可能被修改为带有其他目的，或者在反弹shell 的过程中被植入后门。因此，投毒风险评估为10%。\n\n**利用方式：** 该漏洞的利用方式如下：\n1. 使用 scanner.py 脚本检测目标系统是否存在 CVE-2024-38856 漏洞。该脚本发送一个包含简单 Groovy 代码的请求，该代码抛出一个异常并执行 `id` 命令。如果响应包含 `uid=0`，则表示目标系统易受攻击。\n2. 如果目标系统易受攻击，使用 exploit.py 脚本利用该漏洞。该脚本接受目标 URL 和要执行的 payload 作为参数。该脚本对payload进行base64编码,然后进行unicode编码。该脚本将 payload 嵌入到 Groovy 脚本中，并通过 `ProgramExport` 接口将其发送到目标系统。目标系统执行 Groovy 脚本，从而执行 payload。 payload 通常是一个反向 shell，允许攻击者控制目标系统。

**项目地址:** [Praison001/CVE-2024-38856-ApacheOfBiz](https://github.com/Praison001/CVE-2024-38856-ApacheOfBiz)

**漏洞详情:** [CVE-2024-38856](https://nvd.nist.gov/vuln/detail/CVE-2024-38856)