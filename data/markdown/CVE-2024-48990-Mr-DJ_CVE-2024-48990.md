## CVE-2024-48990-needrestart-本地权限提升

**漏洞编号:** CVE-2024-48990

**漏洞类型:** 本地权限提升

**影响应用:** needrestart

**危害等级:** 高危，允许本地低权限用户以root权限执行任意代码

**影响版本:** < 3.8

**利用条件:** 需要本地访问，并且目标系统上安装了受影响版本的needrestart

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-48990是`needrestart`实用程序中的一个本地权限提升漏洞。该漏洞存在于3.8之前的版本中。该服务在软件包安装等事件期间以root身份运行，不安全地扫描所有正在运行的进程。当它找到Python进程时，它会读取并信任来自该进程的PYTHONPATH环境变量。

利用方式：

1.  攻击者控制一个目录，并将POC代码克隆到该目录中。
2.  攻击者使exploit.sh脚本可执行。
3.  攻击者运行exploit.sh脚本。此脚本创建一个“诱饵”Python进程，并将PYTHONPATH环境变量设置为指向攻击者控制的目录。该目录包含一个恶意Python模块，当`needrestart`扫描该进程时，它将被导入并执行，从而以root权限创建SUID shell。

有效性：提供的POC代码似乎有效，它利用了`needrestart`对PYTHONPATH的不安全处理来执行任意代码。

投毒风险：该POC的代码未发现明显的投毒行为。 该脚本的主要目的是演示漏洞的利用，创建SUID shell 本身就是漏洞利用的最终结果。因此，可以认为投毒的概率为0%。

**项目地址:** [Mr-DJ/CVE-2024-48990](https://github.com/Mr-DJ/CVE-2024-48990)

**漏洞详情:** [CVE-2024-48990](https://nvd.nist.gov/vuln/detail/CVE-2024-48990)