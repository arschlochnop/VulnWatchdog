## CVE-2023-6241-Arm Mali GPU Kernel Driver Use-After-Free

**漏洞编号:** CVE-2023-6241

**漏洞类型:** Use-After-Free

**影响应用:** Arm Mali GPU Kernel Driver (Midgard, Bifrost, Valhall, 5th Gen)

**危害等级:** 高危，允许本地非特权用户利用软件竞态条件执行不正确的内存处理操作，进而导致任意内核代码执行和root权限获取。

**影响版本:** Midgard: r13p0-r32p0, Bifrost: r11p0-r25p0, Valhall: r19p0-r25p0, r29p0-r46p0, 5th Gen: r41p0-r46p0

**利用条件:** 本地访问，需要设备存在受影响版本的Arm Mali GPU驱动。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-6241是一个Arm Mali GPU内核驱动中的Use-After-Free漏洞。利用该漏洞需要精确控制内存布局，并触发竞态条件。提供的POC代码展示了如何将针对Pixel 8的利用移植到Pixel 7。

**有效性评估：**
根据搜索结果和POC代码，该漏洞利用是有效的。Github上有多个相关的POC（[webpage 4](https://github.com/s1204IT/CVE-2023-6241), [webpage 2](https://github.blog/security/vulnerability-research/gaining-kernel-code-execution-on-an-mte-enabled-pixel-8/), [webpage 7](https://securitylab.github.com/advisories/GHSL-2023-224_Arm_Mali/)）。POC说明已经成功地在Pixel 7上实现了利用，表明其具有一定的有效性和可移植性。

**投毒风险分析：**
POC代码仓库本身看起来是用于移植已知的漏洞利用代码，而不是从头开始创建一个全新的漏洞利用。仓库包含了适配Pixel 7的必要步骤，例如查找正确的内核符号偏移量。潜在的投毒风险可能存在于以下几个方面：

1.  **预编译的GLES_mali.so：**  POC说明需要从设备`/vendor/lib64/egl/libGLES_mali.so`提取此文件并用于编译。如果攻击者提供修改过的`libGLES_mali.so`，则可能引入恶意代码。但此仓库的目的为适配已知的漏洞利用，此处的目的是获取目标设备的`libGLES_mali.so`，因此风险较低。

2.  **编译过程：**  POC说明使用aarch64-linux-android34-clang编译器进行编译。如果攻击者提供了修改过的编译脚本或编译器，则可能注入恶意代码。 但编译依赖于用户的NDK环境，风险较低。

总的来说，由于POC是基于已知的漏洞利用进行修改和适配，并且需要用户自行从设备提取某些文件，因此直接在POC代码中进行投毒的难度较高。风险主要集中在用户提供的编译环境和依赖库的安全性上。
假设仓库作者隐藏了投毒代码，我评估其可能性约为10%。

**漏洞利用方式：**

1.  **漏洞原理：**  Use-After-Free漏洞允许攻击者在释放内存后，继续访问该内存，从而导致程序崩溃或执行恶意代码。
2.  **利用步骤：**
    *   触发竞态条件，导致GPU驱动程序释放一块内存。
    *   精心构造内存布局，使得被释放的内存重新被分配，并填充恶意数据。
    *   再次访问被释放的内存，从而执行恶意代码。
3.  **利用目标：**
    *   获取内核代码执行权限。
    *   禁用SELinux。
    *   获取root权限。

**项目地址:** [ilGobbo00/CVE-2023-6241-Pixel7_Adaptation](https://github.com/ilGobbo00/CVE-2023-6241-Pixel7_Adaptation)

**漏洞详情:** [CVE-2023-6241](https://nvd.nist.gov/vuln/detail/CVE-2023-6241)