## CVE-2023-42793-JetBrains TeamCity-RCE

**漏洞编号:** CVE-2023-42793

**漏洞类型:** 认证绕过导致远程代码执行

**影响应用:** JetBrains TeamCity

**危害等级:** 高危，允许未授权的攻击者创建管理员用户并执行任意代码

**影响版本:** < 2023.05.4

**利用条件:** 目标TeamCity服务器可以通过HTTP(S)访问

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2023-42793 是 JetBrains TeamCity 中的一个严重漏洞，允许未经身份验证的攻击者绕过身份验证并执行远程代码。从漏洞库信息和搜索结果来看，这是一个高危漏洞，已被积极利用。多个安全厂商和CISA已经发布了相关的分析和警告。 该漏洞的利用方式如下： 1. 攻击者利用未经身份验证的漏洞访问 TeamCity 服务器。2.  POC代码首先删除与ID为1的用户关联的token。3.  然后，它会再次向 `/app/rest/users/id:1/tokens/RPC2` 发送 POST 请求，获取新的token。4.  利用获取的token，攻击者可以向 `/app/rest/users` 端点发送 POST 请求，创建一个新的管理员用户，从而完全控制 TeamCity 服务器。 

**关于投毒风险：**
代码的功能是删除用户ID 1的token，并基于返回的XML，创建一个新的管理员用户。虽然代码功能是漏洞利用，但它依赖于TeamCity服务器返回的XML数据。恶意行为者可能会尝试修改服务器，返回恶意的XML数据，从而在被攻击的TeamCity服务器上植入后门。代码本身存在的植入风险较低，但考虑到该漏洞被广泛利用，服务器可能已经被入侵，所以存在投毒风险。但从POC本身来看，仅仅是利用漏洞创建新的管理员账户，因此投毒风险极低，估计为1%。

**项目地址:** [junnythemarksman/CVE-2023-42793](https://github.com/junnythemarksman/CVE-2023-42793)

**漏洞详情:** [CVE-2023-42793](https://nvd.nist.gov/vuln/detail/CVE-2023-42793)