## CVE-2022-42889-Apache Commons Text RCE

**漏洞编号:** CVE-2022-42889

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Commons Text

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** 1.5 <= version <= 1.9

**利用条件:** 应用程序使用受影响版本的 Apache Commons Text，且允许用户可控的字符串进行变量插值

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-42889，又名Text4Shell，是Apache Commons Text库中的一个严重漏洞。该漏洞源于库中存在不安全的变量插值默认配置，允许攻击者通过构造包含恶意表达式的输入字符串来执行任意代码。

**有效性：**
提供的POC代码有效，因为它提供了一个Docker环境来复现该漏洞，包括Dockerfile、README.md以及一个简单的Java应用（尽管未提供Java源码，但是dockerfile中指明了构建方式）。README.md中明确说明了利用方式，并提供了可以执行任意命令的payload示例，如 `${script:javascript:java.lang.Runtime.getRuntime().exec('touch /tmp/blop')}`。

**投毒风险：**
代码仓库中可能存在作者隐藏的投毒代码的风险较低。主要基于以下几点：
*   README.md 详细描述了如何构建和运行POC，意图是演示漏洞，而不是隐藏恶意代码。
*   提供的 `mask_cnn.ipynb` 似乎与漏洞利用本身无关，更像是与图像处理或机器学习相关的示例代码，虽然与漏洞无关，但提高了项目复杂性，存在一定的迷惑性,notebook文件无法直接分析是否是投毒代码.
*  Dockerfile 简单，没有包含任何可疑的命令。
*  考虑到漏洞本身的严重性，直接利用该漏洞执行恶意操作比在POC中隐藏后门更加直接有效。POC提供的重点在于演示漏洞。
总体而言，投毒风险较低，估计在 10% 左右。

**利用方式：**
1.  应用程序使用 Apache Commons Text 1.5 到 1.9版本。
2.  应用程序允许用户可控的字符串传递给 `StringSubstitutor.replace()` 方法或其他执行变量插值的方法。
3.  攻击者构造包含恶意表达式的字符串，例如使用 `script`, `dns`, 或 `url` 前缀。
4.  Commons Text 对该字符串进行插值，执行表达式，从而导致任意代码执行或与其他服务器建立连接。
例如：
    *   `${script:javascript:java.lang.Runtime.getRuntime().exec('command')}`：执行任意系统命令。
    *   `${dns:address|example.com}`：解析指定域名的DNS记录，可能导致信息泄露。
    *   `${url:UTF-8:http://example.com}`：从指定URL加载内容，可能导致SSRF攻击。

**项目地址:** [necroteddy/CVE-2022-42889](https://github.com/necroteddy/CVE-2022-42889)

**漏洞详情:** [CVE-2022-42889](https://nvd.nist.gov/vuln/detail/CVE-2022-42889)