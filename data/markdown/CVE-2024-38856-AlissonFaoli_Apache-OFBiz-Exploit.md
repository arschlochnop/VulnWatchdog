## CVE-2024-38856-Apache OFBiz-未授权RCE

**漏洞编号:** CVE-2024-38856

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache OFBiz

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** <= 18.12.14

**利用条件:** 目标服务器开放webtools端口，且目标OFBiz版本小于等于18.12.14。Screen definitions 未进行权限检查

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-38856 是 Apache OFBiz 中的一个未授权远程代码执行漏洞。攻击者可以在未经身份验证的情况下，通过构造特定的 HTTP POST 请求，利用 `ProgramExport` 端点执行任意代码。漏洞原因是由于未授权的端点能够执行屏幕渲染代码，而某些屏幕定义没有显式地检查用户权限，从而导致攻击者可以执行任意的Groovy代码。 

**利用方式：**

1.  攻击者发送一个POST请求到`/webtools/control/main/ProgramExport`端点。
2.  POST请求中包含一个名为`groovyProgram`的参数，该参数的值是经过Unicode编码的恶意Groovy代码。
3.  服务器执行该Groovy代码，从而导致远程代码执行。

**POC代码分析：**

提供的Python脚本利用了该漏洞，通过以下步骤实现远程代码执行：

1.  `generate_payload(cmd: str)`:  这个函数将要执行的命令作为参数，生成一个包含该命令的Groovy payload。该payload使用`ProcessBuilder`来执行命令，并将结果返回。
2.  `exploit(target:str, payload:str)`:  这个函数将目标URL和payload作为参数，发送一个POST请求到`/webtools/control/main/ProgramExport`端点，并将payload作为`groovyProgram`参数的值。
3.  `shell(target:str, lhost:str, lport:str)`:  这个函数用于生成反向shell的payload，并利用`exploit`函数执行该payload，从而在目标服务器上建立一个反向shell连接。

**投毒风险评估：**

代码中没有明显的恶意代码植入后门，但是经过Unicode编码，可以隐藏一些简单后门。

*   脚本会禁用SSL证书验证(`requests.urllib3.disable_warnings()`)，这在真实环境中是不安全的，可能导致中间人攻击。但这更可能是为了方便漏洞利用，而不是有意投毒。
*   代码结构比较简单，没有发现作者故意隐藏的恶意行为。
*   payload使用Unicode编码，方便绕过一些简单的过滤，但也增加了代码阅读的难度，可能隐藏了一些不明显的问题。

所以, 投毒风险不能完全排除，但也相对较低，约为5%。主要风险点在于Unicode编码可能隐藏一些简单的后门代码。

**项目地址:** [AlissonFaoli/Apache-OFBiz-Exploit](https://github.com/AlissonFaoli/Apache-OFBiz-Exploit)

**漏洞详情:** [CVE-2024-38856](https://nvd.nist.gov/vuln/detail/CVE-2024-38856)