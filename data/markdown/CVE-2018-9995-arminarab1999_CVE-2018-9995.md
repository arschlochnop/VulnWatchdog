## CVE-2018-9995 - TBK DVR Authentication Bypass

**漏洞编号:** CVE-2018-9995

**漏洞类型:** 身份验证绕过

**影响应用:** TBK DVR4104/DVR4216 及多个贴牌版本 (Novo, CeNova, QSee, Pulnix, XVR 5 in 1, Securus, Night OWL, DVR Login, HVR Login, MDVR Login)

**危害等级:** 高危，未经授权的访问，可能导致敏感信息泄露、设备控制等

**影响版本:** 受影响的 TBK DVR4104 和 DVR4216 设备及贴牌版本

**利用条件:** 需要网络访问 DVR 的 HTTP 服务端口（通常是 80 端口）。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于TBK DVR4104和DVR4216设备及其贴牌版本中，攻击者可以通过发送包含"Cookie: uid=admin"的HTTP请求头，绕过身份验证。提供的Python脚本通过构造带有特定Cookie的HTTP请求到 `/device.rsp?opt=user&cmd=list` 接口，获取设备上的用户名和密码信息。

**漏洞利用有效性：** 根据漏洞信息和提供的POC代码，该漏洞利用是有效的。POC代码通过设置Cookie绕过身份验证，并成功从DVR获取用户名和密码。

**投毒风险分析：**

*   **脚本功能：** 脚本的主要功能是发送HTTP请求，解析返回的JSON数据，提取用户名和密码。
*   **潜在风险：** 脚本中存在`input()`函数，这在python2上有代码执行的风险, 但是利用需要结合用户的输入. 另外，脚本本身会打印用户名和密码到屏幕，如果用户在不安全的环境中运行，可能会导致凭据泄露。
*   **投毒概率评估：** 投毒风险较低，约为10%。主要风险来自于用户在使用脚本时的操作不当，而非脚本本身存在恶意代码。

**漏洞利用方式：**

1.  攻击者确定目标DVR设备的IP地址和端口。
2.  攻击者运行提供的Python脚本，输入目标IP地址和端口。
3.  脚本构造一个带有`Cookie: uid=admin`的HTTP请求，发送到DVR的`/device.rsp?opt=user&cmd=list`接口。
4.  DVR设备错误地将请求视为管理员身份的请求，返回包含用户名和密码的JSON数据。
5.  脚本解析JSON数据，提取用户名和密码，并显示在屏幕上。
6.  攻击者可以使用这些凭据登录DVR设备，进行未授权的操作。

**项目地址:** [arminarab1999/CVE-2018-9995](https://github.com/arminarab1999/CVE-2018-9995)

**漏洞详情:** [CVE-2018-9995](https://nvd.nist.gov/vuln/detail/CVE-2018-9995)