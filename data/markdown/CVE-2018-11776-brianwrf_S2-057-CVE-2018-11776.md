## CVE-2018-11776 Apache Struts 远程代码执行

**漏洞编号:** CVE-2018-11776

**漏洞类型:** 远程代码执行

**影响应用:** Apache Struts

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** 2.3 to 2.3.34, 2.5 to 2.5.16

**利用条件:** alwaysSelectFullNamespace 为 true，且存在特定的namespace配置

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2018-11776 是 Apache Struts 2 的一个远程代码执行漏洞，存在于 2.3.x 版本到 2.3.34 和 2.5.x 版本到 2.5.16 中。

**有效性：**
提供的POC代码（exploit.py）是有效的。它通过构造恶意的OGNL表达式注入到URL中，利用Struts框架的漏洞执行任意系统命令。

**投毒风险：**
代码总体上是直接明了的漏洞利用程序，主要功能是通过构造包含恶意OGNL表达式的URL来利用漏洞。投毒的可能性较低，主要风险在于使用者使用该脚本攻击未经授权的系统。脚本本身包含少量payload，但大部分是用于执行命令和回显结果，没有发现明显的恶意代码或后门。但是要提醒使用者对从任何来源下载的代码都要谨慎审查。故投毒风险为5%。

**利用方式：**
1.  **漏洞触发条件:** 需要 `alwaysSelectFullNamespace` 为 true，或者使用 Convention Plugin 等插件导致该配置生效。
2.  **构造恶意URL:**  攻击者需要构造包含恶意 OGNL 表达式的 URL。OGNL 表达式允许攻击者执行任意代码。
3.  **命令执行:**  恶意 OGNL 表达式利用 `java.lang.Runtime.getRuntime().exec()` 执行操作系统命令。
4.  **结果回显:**  命令执行的结果通过 `HttpServletResponse` 的 `Writer` 对象回显到响应中。

**总结:**
CVE-2018-11776 是一个严重的远程代码执行漏洞。攻击者可以通过构造恶意的URL，在目标服务器上执行任意命令，导致服务器被完全控制。

**参考资料:**
*   NVD: [https://nvd.nist.gov/vuln/detail/cve-2018-11776](https://nvd.nist.gov/vuln/detail/cve-2018-11776)
*   Qualys Blog: [https://blog.qualys.com/vulnerabilities-threat-research/2018/08/23/detecting-apache-struts-2-namespace-rce-cve-2018-11776](https://blog.qualys.com/vulnerabilities-threat-research/2018/08/23/detecting-apache-struts-2-namespace-rce-cve-2018-11776)
*   Keysight Blog: [https://www.keysight.com/blogs/en/tech/nwvs/2022/06/03/strutting-to-remote-code-execution-anatomy-of-cve-2018-11776](https://www.keysight.com/blogs/en/tech/nwvs/2022/06/03/strutting-to-remote-code-execution-anatomy-of-cve-2018-11776)

**项目地址:** [brianwrf/S2-057-CVE-2018-11776](https://github.com/brianwrf/S2-057-CVE-2018-11776)

**漏洞详情:** [CVE-2018-11776](https://nvd.nist.gov/vuln/detail/CVE-2018-11776)