## CVE-2022-44268-ImageMagick-任意文件读取

**漏洞编号:** CVE-2022-44268

**漏洞类型:** 任意文件读取

**影响应用:** ImageMagick

**危害等级:** 高危，可能导致敏感信息泄露

**影响版本:** 7.1.0-49

**利用条件:** Magick二进制文件需要有读取目标文件的权限，受影响的应用需要使用存在漏洞的ImageMagick版本处理用户上传的PNG图片。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-44268是ImageMagick 7.1.0-49版本中的一个信息泄露漏洞。当ImageMagick解析PNG图像（例如，为了调整大小）时，如果magick二进制文件具有读取权限，生成的图像可能会嵌入任意文件的内容。 

**有效性：** 根据漏洞信息和搜索引擎结果，该漏洞是存在的，并且POC代码旨在验证该漏洞。POC代码提供的`pngout.png`文件应该包含一个恶意构造的PNG图像，该图像在被ImageMagick处理后，会将服务器上的`/etc/passwd`文件（或其他指定文件）的内容嵌入到输出图像中。 通过`identify -verbose edit_image.png`命令检查输出图像的Raw profile type是否包含目标文件的内容，即可判断漏洞是否存在。

**投毒风险：**  提供的漏洞利用代码本身似乎没有包含恶意代码。 仓库中只有一个README.md和一个 pngout.png 文件， README.md 文件只是解释了如何使用 pngout.png 进行测试。pngout.png 是漏洞的触发文件，其本身也不是恶意代码。因此，投毒的概率为0%。

**利用方式：**
1.  **上传恶意PNG图像：** 攻击者需要上传特制的PNG图像（例如，`pngout.png`）到使用了存在漏洞的ImageMagick版本的Web应用程序中。 
2.  **触发图像处理：** Web应用程序需要对上传的图像进行处理，例如调整大小、裁剪或编辑等操作，以触发ImageMagick解析该PNG图像。
3.  **下载处理后的图像：** 攻击者需要下载经过处理后的图像。
4.  **提取嵌入的文件内容：**  攻击者可以使用`identify -verbose`命令或其他方法来检查下载的图像，以提取嵌入的任意文件内容（例如`/etc/passwd`）。通过分析图像的元数据或原始数据，可以找到被泄露的文件内容。

**项目地址:** [Baikuya/CVE-2022-44268-PoC](https://github.com/Baikuya/CVE-2022-44268-PoC)

**漏洞详情:** [CVE-2022-44268](https://nvd.nist.gov/vuln/detail/CVE-2022-44268)