## CVE-2024-9474 PAN-OS Web管理界面权限提升漏洞

**漏洞编号:** CVE-2024-9474

**漏洞类型:** 权限提升/OS命令注入

**影响应用:** PAN-OS

**危害等级:** 高危，可能导致完全系统控制

**影响版本:** 10.1.0 < version < 10.1.14-h6
10.2.0 < version < 10.2.12-h2
11.0.0 < version < 11.0.6-h1
11.1.0 < version < 11.1.5-h1
11.2.0 < version < 11.2.4-h1

**利用条件:** 需要PAN-OS管理员账户访问Web管理界面，并且管理界面能够通过网络访问。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-9474是Palo Alto Networks PAN-OS软件中的一个权限提升漏洞。 具有Web管理界面访问权限的PAN-OS管理员可以利用此漏洞以root权限在防火墙上执行操作。根据漏洞信息和搜索结果，该漏洞的利用涉及到向易受攻击的Web管理界面发送特制的HTTP请求，从而注入操作系统命令。提供的Python POC代码通过构造包含恶意命令的`user`参数的POST请求，将命令执行结果写入`/var/appweb/htdocs/unauth/1.php`，然后通过访问此PHP文件获取命令执行结果。

**有效性:**
根据CISA已将此漏洞添加到已知被利用漏洞目录 (KEV) 中，并且搜索结果表明该漏洞已被积极利用，POC代码的有效性较高。

**投毒风险:**
POC代码本身看起来比较直接，主要功能是发送POST请求并在服务器上执行命令。 投毒风险较低，估计在10%左右。风险主要来自于:
1.  **脚本逻辑复杂性:** 代码相对简单，直接执行命令，隐藏恶意行为的空间有限。
2.  **文件写入位置:** 命令执行结果写入`/var/appweb/htdocs/unauth/1.php`， 比较明显。
3.  **作者信誉:** 无法评估作者信誉，存在潜在风险，但从代码本身看，恶意行为不太明显。

**利用方式:**
1.  **前提条件:** 攻击者需要具有PAN-OS Web管理界面的管理员权限。
2.  **漏洞触发:** 攻击者使用POC代码构造包含恶意命令的HTTP POST请求，发送到目标PAN-OS设备的`/php/utils/createRemoteAppwebSession.php/1.js.map`端点。
3.  **命令执行:** PAN-OS设备解析POST请求中的`user`参数，由于存在命令注入漏洞，恶意命令被执行，其结果被写入`/var/appweb/htdocs/unauth/1.php`。
4.  **结果获取:** 攻击者通过访问`/unauth/1.php`页面，获取命令执行的结果。
5.  **权限提升:** 攻击者利用执行的命令，可以进行任意操作，从而获得设备的完全控制权。

**项目地址:** [k4nfr3/CVE-2024-9474](https://github.com/k4nfr3/CVE-2024-9474)

**漏洞详情:** [CVE-2024-9474](https://nvd.nist.gov/vuln/detail/CVE-2024-9474)