## CVE-2025-32463-Sudo-Chroot权限提升

**漏洞编号:** CVE-2025-32463

**漏洞类型:** 本地权限提升

**影响应用:** Sudo

**危害等级:** 高危，允许本地用户获取root权限

**影响版本:** 1.9.14 到 1.9.17p1 (不包含)

**利用条件:** 需要用户拥有通过sudo以chroot方式运行命令的权限

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2025-32463 漏洞存在于 Sudo 的 `--chroot` 选项中。攻击者可以通过创建一个恶意的 `nsswitch.conf` 文件，并利用 Sudo 的 chroot 功能加载该文件，从而加载恶意的共享对象。该共享对象在加载时执行，从而绕过 chroot 环境的限制，以 root 权限执行任意代码。利用方式如下：

1.  **漏洞原理：** Sudo 在使用 `--chroot` 选项时，会读取 chroot 环境内的 `/etc/nsswitch.conf` 文件。`nsswitch.conf` 文件用于配置名称服务查找的顺序。攻击者可以创建一个恶意的 `nsswitch.conf` 文件，指定使用一个恶意的共享对象来处理密码查找。
2.  **PoC 代码分析：**
    *   `exploit.py` 脚本自动化了漏洞利用过程。
    *   它首先创建一个 C 语言 payload，该 payload 包含一个 `__attribute__((constructor))` 函数，该函数在共享对象加载时执行，用于提权并执行 shell。
    *   然后，它创建一个临时目录，作为 fake chroot 环境，其中包含恶意的 `/etc/nsswitch.conf` 文件。
    *   恶意的 `nsswitch.conf` 文件被配置为加载编译后的 C payload（`libnss_privesc.so.2`）。
    *   最后，当 `sudo` 以 `-R` 标志执行时，它进入 chroot，读取恶意的配置文件，加载共享对象，触发构造函数并生成 root shell。
3.  **利用过程：**
    *   攻击者需要具有通过 sudo 使用 `--chroot` 选项执行命令的权限。
    *   攻击者运行 `exploit.py` 脚本。
    *   脚本创建恶意环境和 payload。
    *   脚本利用 sudo 的 `--chroot` 选项执行命令，触发漏洞，获取 root 权限。
4. **投毒风险:**
  * 从提供的代码来看，投毒风险较低，但不能完全排除。`exploit.py`脚本的主要功能是构建恶意环境并触发漏洞利用。潜在的投毒点可能存在于C payload中，例如，在提权shell之后，执行一些恶意操作，但目前C payload的功能比较简单，风险较低。 另一个风险是脚本可能在完成攻击后不清理临时文件，或者在某些异常情况下留下后门，导致安全风险。 鉴于代码的相对简单性，以及其明确声明的用途， 投毒风险估计为5%。
5.  **有效性评估：** 根据漏洞库信息、搜索引擎结果以及提供的 PoC 代码，可以判断该漏洞是真实存在的，且 PoC 代码能够有效利用该漏洞。
6.  **缓解措施：** 升级到 Sudo 1.9.17p1 或更高版本。

**项目地址:** [nelissandro/CVE-2025-32463-Sudo-Chroot-Escape](https://github.com/nelissandro/CVE-2025-32463-Sudo-Chroot-Escape)

**漏洞详情:** [CVE-2025-32463](https://nvd.nist.gov/vuln/detail/CVE-2025-32463)