## CVE-2023-42793-JetBrains TeamCity-RCE

**漏洞编号:** CVE-2023-42793

**漏洞类型:** 远程代码执行（RCE）

**影响应用:** JetBrains TeamCity

**危害等级:** 极高，未经身份验证的远程代码执行

**影响版本:** < 2023.05.4

**利用条件:** TeamCity服务器可从网络访问

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2023-42793是JetBrains TeamCity 2023.05.4之前版本中存在的一个身份验证绕过漏洞，可能导致未经身份验证的远程代码执行。根据漏洞库信息，此漏洞的CVSS评分为9.8，属于严重级别。多个搜索结果表明，该漏洞已被积极利用，甚至被APT组织利用进行攻击。提供的POC代码是一个Python脚本，它利用漏洞执行远程命令。

**利用方式：**

1.  **身份验证绕过：** 该漏洞允许攻击者绕过TeamCity服务器的身份验证机制。
2.  **获取Bearer Token：** 利用未经身份验证的访问，通过`/app/rest/users/id:1/tokens/RPC2`端点创建一个临时的Bearer Token。
3.  **启用调试模式：** 使用获得的Bearer Token，通过`/admin/dataDir.html?action=edit&fileName=config/internal.properties&content=rest.debug.processes.enable=true`端点启用调试模式，即`rest.debug.processes.enable=true`。
4.  **远程代码执行：** 使用获得的Bearer Token，通过`/app/rest/debug/processes`端点执行任意命令。POC使用bash反弹shell，通过URL编码将命令传递给目标服务器。

**有效性评估：**

提供的POC代码看起来是有效的。它利用了TeamCity REST API中的漏洞，绕过身份验证并执行任意代码。 脚本首先尝试获取一个临时的Bearer Token，然后使用该Token来修改`internal.properties`文件以启用调试模式。最后，脚本使用调试模式来执行远程代码。 脚本的`README.md`文件中提供的参考链接也支持了该漏洞的存在和可利用性。搜索结果中大量的安全厂商报告和分析也证实了此漏洞的真实性和高危性。

**投毒风险评估：**

分析POC代码没有发现明显的投毒代码。脚本的功能主要集中在利用漏洞进行远程代码执行，没有发现额外的恶意行为或后门。该脚本的功能与漏洞描述以及利用方式相符，未发现任何异常行为。因此，投毒风险评估为0%。

**项目地址:** [hotplugin0x01/CVE-2023-42793](https://github.com/hotplugin0x01/CVE-2023-42793)

**漏洞详情:** [CVE-2023-42793](https://nvd.nist.gov/vuln/detail/CVE-2023-42793)