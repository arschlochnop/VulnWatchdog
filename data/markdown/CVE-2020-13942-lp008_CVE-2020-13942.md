## CVE-2020-13942 Apache Unomi RCE

**漏洞编号:** CVE-2020-13942

**漏洞类型:** 远程代码执行

**影响应用:** Apache Unomi

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** < 1.5.2

**利用条件:** 目标服务器运行Apache Unomi 1.5.2之前的版本，且/context.json接口对外开放。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-13942是Apache Unomi中的一个远程代码执行漏洞。攻击者可以通过向/context.json端点注入恶意的OGNL或MVEL脚本来利用此漏洞。由于Unomi对用户输入验证不足，未经身份验证的攻击者可以发送包含恶意表达式的POST请求，从而在服务器上执行任意代码。

**有效性:**

提供的POC代码有效。它通过构造一个包含恶意脚本的JSON payload，并将其发送到/context.json端点来触发漏洞。Payload中使用了`Runtime.getRuntime().exec('whoami')`命令来执行系统命令，从而验证了RCE的存在。

**投毒风险:**

该仓库主要包含漏洞利用代码和检测规则。检测规则(`alert http any any -> any any ...`)是用于安全设备（如Snort或Suricata）检测此漏洞攻击的规则，本身不构成恶意代码。POC代码本身展示了如何利用此漏洞，但其中`Runtime.getRuntime().exec('whoami')`仅仅是验证漏洞存在性的指令,如果替换成更具破坏性的指令(例如删除关键文件),则会造成更大的危害。漏洞利用代码的风险主要体现在其潜在的滥用上，而不是代码本身包含后门或恶意组件。将此仓库判定为具有投毒风险的概率较低，大约10%。因为该代码仓库的主要目的是复现和验证漏洞。

**利用方式:**

1.  攻击者向目标Apache Unomi服务器的/context.json端点发送POST请求。
2.  请求体包含一个精心构造的JSON payload，其中包含恶意OGNL或MVEL表达式。
3.  Unomi服务器解析JSON payload，由于输入验证不足，恶意表达式被执行。
4.  攻击者利用表达式执行任意系统命令，从而控制服务器。

简而言之，利用方式是利用未经身份验证的OGNL/MVEL表达式注入，通过/context.json接口执行任意代码。

**项目地址:** [lp008/CVE-2020-13942](https://github.com/lp008/CVE-2020-13942)

**漏洞详情:** [CVE-2020-13942](https://nvd.nist.gov/vuln/detail/CVE-2020-13942)