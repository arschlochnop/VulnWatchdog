## CVE-2024-27956 - WordPress Automatic Plugin SQL 注入

**漏洞编号:** CVE-2024-27956

**漏洞类型:** SQL 注入

**影响应用:** WordPress Automatic Plugin

**危害等级:** 高危，未经身份验证的攻击者可以执行任意 SQL 查询，可能导致数据泄露、数据篡改，甚至完全控制 WordPress 站点。

**影响版本:** <= 3.92.0

**利用条件:** 目标 WordPress 站点安装了受影响版本的 WP Automatic 插件，且漏洞利用端可以访问该站点。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-27956 是 WordPress Automatic 插件中的一个 SQL 注入漏洞。根据漏洞库信息和搜索结果，未经身份验证的攻击者可以通过向插件发送特制的请求来执行任意 SQL 命令。利用代码 `Exploit.py` 演示了如何利用此漏洞创建管理员用户。该脚本首先检查目标站点是否存在漏洞，然后通过两次注入攻击来创建新用户并在 `wp_usermeta` 表中赋予其管理员权限。  虽然代码主要功能是利用漏洞，但是仍有作者隐藏投毒代码的风险，例如，在请求头中加入恶意代码，或者在密码生成逻辑中引入弱密码。根据代码复杂度以及作者身份信息不明确，判断存在 10% 投毒风险。

**利用方式：**

1.  **漏洞验证：** 利用 `check_vulnerability` 函数发送包含 `SELECT 1` 的特制请求，通过检查响应内容中是否包含 "DATE" 字符串来判断目标站点是否存在漏洞。
2.  **创建管理员用户：** 
    *   **步骤 1：** 使用 `create_admin_user` 函数，首先构造包含恶意 SQL 语句的 POST 请求，向 `wp_users` 表中插入新的管理员用户记录，用户名和密码可以自定义。
    *   **步骤 2：** 构造另一个包含恶意 SQL 语句的 POST 请求，向 `wp_usermeta` 表中插入数据，将新创建用户的 `wp_capabilities` 设置为 `administrator`，从而赋予其管理员权限。

需要注意的是，`Exploit.py` 代码中使用了 `verify=False` 来禁用 SSL 验证，这在生产环境中是不安全的。同时，代码中使用硬编码的 hash 值对SQL语句进行了完整性校验，但是该校验逻辑存在缺陷，绕过该校验即可实现任意 SQL 注入。

**项目地址:** [devsec23/CVE-2024-27956](https://github.com/devsec23/CVE-2024-27956)

**漏洞详情:** [CVE-2024-27956](https://nvd.nist.gov/vuln/detail/CVE-2024-27956)