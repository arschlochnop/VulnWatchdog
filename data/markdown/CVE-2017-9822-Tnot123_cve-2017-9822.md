## CVE-2017-9822 DotNetNuke Cookie 反序列化 RCE

**漏洞编号:** CVE-2017-9822

**漏洞类型:** 反序列化漏洞

**影响应用:** DotNetNuke CMS

**危害等级:** 高危，可导致远程代码执行

**影响版本:** < 9.1.1

**利用条件:** 需要目标网站使用 DotNetNuke CMS 并且版本低于 9.1.1

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2017-9822 是 DotNetNuke CMS 9.1.1 之前版本中的一个远程代码执行漏洞。该漏洞源于程序使用 cookie 来识别用户，且存在不安全的反序列化操作。

**有效性分析：**

根据漏洞库信息、搜索引擎结果和提供的漏洞利用代码（虽然只提供了部分信息，但可以判断其方向），该漏洞利用是有效的。漏洞库和搜索引擎结果都明确指出该漏洞的存在和危害，并提供了利用方式的线索（cookie 反序列化）。利用代码中的描述也佐证了这一点，它详细描述了如何设置调试环境、分析漏洞原理，并提到利用 XmlSerializer、ObjectDataProvider、ResourceDictionary 等 .NET 组件来构造 Gadget 从而实现 RCE。

**投毒风险分析：**

提供的漏洞利用代码片段主要是环境搭建和原理分析，并没有直接的恶意代码。但是考虑到代码仓库中可能存在作者未展示的部分，存在一定的投毒风险。风险评估较低，约为 5%。原因如下：

*   漏洞本身已经足够危险，没有必要添加额外的恶意代码来迷惑使用者。
*   详细的漏洞分析和调试步骤降低了投毒的必要性，作者的重心似乎在于复现漏洞。
*   仅仅是部分文档，不能确定是否存在其他辅助利用脚本，需要进行分析。

**利用方式分析：**

利用方式的核心是不安全的反序列化。具体步骤如下：

1.  攻击者构造一个包含恶意代码的 XML 序列化对象。这个对象利用 .NET 中已知的 Gadget chain，例如 ObjectDataProvider + ResourceDictionary。
2.  将该 XML 序列化对象进行编码，并将其设置为 DotNetNuke 站点的 cookie 值，通常是 DNNPersonalization cookie。
3.  当 DotNetNuke 站点处理该 cookie 时，会对 XML 数据进行反序列化。
4.  反序列化过程会触发 Gadget chain，从而执行攻击者预先设定的恶意代码，最终实现远程代码执行。

总结：该漏洞利用的有效性高，利用方式清晰，但仍需注意潜在的投毒风险。

**项目地址:** [Tnot123/cve-2017-9822](https://github.com/Tnot123/cve-2017-9822)

**漏洞详情:** [CVE-2017-9822](https://nvd.nist.gov/vuln/detail/CVE-2017-9822)