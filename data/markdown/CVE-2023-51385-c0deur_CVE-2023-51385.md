## CVE-2023-51385-OpenSSH-命令注入

**漏洞编号:** CVE-2023-51385

**漏洞类型:** 命令注入

**影响应用:** OpenSSH

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** < 9.6

**利用条件:** 需要存在可利用的OpenSSH配置，如ProxyCommand，并允许受控用户名或主机名传递到该配置中。Git submodule的利用提到需要攻击者能够控制git仓库。

**POC 可用性:** 部分有效

**投毒风险:** 10%

## 详情

CVE-2023-51385是OpenSSH 9.6之前版本中存在的一个命令注入漏洞。当用户名或主机名包含shell元字符，并且这些名称在特定情况下被扩展令牌引用时，可能发生操作系统命令注入。

**有效性：**

根据提供的漏洞库信息、搜索结果和漏洞利用代码，该漏洞是真实存在的，并且已经被广泛报道。搜索结果中多个链接指向了关于此漏洞的描述、修复方案以及受影响的系统。

然而，提供的PoC代码 `README.md` 文件内容过于简单，仅包含漏洞ID，**并不能直接利用漏洞**。该文件本身不具备漏洞利用的能力，只是一个漏洞信息的标记。实际的PoC需要根据`ProxyCommand`的配置构造包含恶意shell元字符的用户名或主机名，才能触发命令注入。

**投毒风险：**

提供的 `README.md` 文件极其简单，几乎没有包含任何实际代码。因此，隐藏恶意代码的可能性极低，投毒风险较低，估计在10%左右。

**利用方式：**

1.  **漏洞原理：** OpenSSH在处理包含shell元字符的用户名或主机名时，如果这些名称被用于`ProxyCommand`等配置的扩展令牌，可能会执行未经转义的命令。
2.  **利用场景：** 攻击者可以控制的用户名或主机名，例如通过恶意Git仓库中的submodule，其中submodule的URL包含恶意的shell元字符。
3.  **攻击步骤：**
    *   攻击者创建一个恶意Git仓库，包含一个submodule。
    *   Submodule的URL中包含恶意的用户名或主机名，例如 `user="; touch /tmp/pwned;"@example.com`。
    *   当受害者克隆包含恶意submodule的仓库时，OpenSSH会尝试解析submodule的URL。
    *   如果OpenSSH配置了`ProxyCommand`，并且submodule的URL中的用户名或主机名被用于`ProxyCommand`的扩展令牌，那么恶意的shell命令将被执行。
4.  **修复方案：** 升级到OpenSSH 9.6或更高版本。对用户名和主机名进行适当的转义，避免shell元字符的注入。

**项目地址:** [c0deur/CVE-2023-51385](https://github.com/c0deur/CVE-2023-51385)

**漏洞详情:** [CVE-2023-51385](https://nvd.nist.gov/vuln/detail/CVE-2023-51385)