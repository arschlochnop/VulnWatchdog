## CVE-2018-11776-Apache Struts2 远程代码执行

**漏洞编号:** CVE-2018-11776

**漏洞类型:** 远程代码执行

**影响应用:** Apache Struts2

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** 2.3 to 2.3.34, 2.5 to 2.5.16

**利用条件:** alwaysSelectFullNamespace 为 true，并且存在特定的命名空间配置

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2018-11776 是 Apache Struts2 的一个远程代码执行漏洞。当 `alwaysSelectFullNamespace` 设置为 true 时，Struts2 可能会由于对命名空间验证不足而导致 OGNL 表达式注入。攻击者可以通过构造恶意的 URL 来执行任意代码。漏洞利用代码（struts-pwn.py）可以通过发送包含恶意 OGNL 表达式的 HTTP 请求来触发漏洞。搜索结果显示该漏洞被广泛利用，并且存在多个公开的 PoC。POC代码中的投毒风险较低，主要集中在对命令执行结果的处理可能存在潜在风险，例如，如果命令执行结果包含恶意字符，可能会导致后续处理出现问题。这个风险大概在10%左右。

**利用方式：**

1.  目标系统必须运行存在漏洞的 Apache Struts2 版本（2.3 to 2.3.34, 2.5 to 2.5.16）。
2.  `alwaysSelectFullNamespace` 必须设置为 true。
3.  存在特定命名空间配置，例如结果没有命名空间，且上层包没有或使用通配符命名空间。
4.  攻击者构造包含恶意 OGNL 表达式的 URL，例如：`http://example.com/?redirect:${(#context.getClass().forName('java.lang.Runtime').getRuntime().exec('id')).getInputStream().readAllBytes()}`。
5.  目标系统解析该 URL，执行 OGNL 表达式，从而执行攻击者指定的命令。

**项目地址:** [mazen160/struts-pwn_CVE-2018-11776](https://github.com/mazen160/struts-pwn_CVE-2018-11776)

**漏洞详情:** [CVE-2018-11776](https://nvd.nist.gov/vuln/detail/CVE-2018-11776)