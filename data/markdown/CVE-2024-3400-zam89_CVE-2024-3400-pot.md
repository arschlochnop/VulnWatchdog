## CVE-2024-3400 PAN-OS GlobalProtect 命令注入

**漏洞编号:** CVE-2024-3400

**漏洞类型:** 命令注入

**影响应用:** PAN-OS GlobalProtect

**危害等级:** 严重，未经身份验证的攻击者可以root权限执行任意代码。

**影响版本:** PAN-OS 10.2.0 < 10.2.9-h1, PAN-OS 11.0.0 < 11.0.4-h1, PAN-OS 11.1.0 < 11.1.2-h3，需要配置GlobalProtect网关或门户。

**利用条件:** 目标系统必须配置GlobalProtect网关或门户，且版本在受影响范围内。攻击者需要能够访问GlobalProtect的接口。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-3400是一个存在于Palo Alto Networks PAN-OS软件GlobalProtect功能中的命令注入漏洞。由于任意文件创建漏洞导致。未经身份验证的远程攻击者可以通过利用此漏洞，在防火墙上以root权限执行任意代码。  

**有效性：**
根据漏洞库信息、搜索结果和漏洞利用代码，可以判断该漏洞的POC代码是有效的。漏洞库和搜索结果都表明该漏洞已被积极利用，并且存在公开可用的PoC。提供的Python脚本看起来像一个蜜罐，模拟了GlobalProtect的一些端点行为，用于捕获攻击流量，特别是`hipreport.esp`端点，该端点会记录可疑的cookie头，并尝试保存包含目录遍历和命令注入的payload的文件。这个蜜罐的目的是捕获攻击，而不是执行攻击，因此脚本本身无法验证漏洞，但是脚本能够捕获攻击请求，从侧面说明该漏洞真实存在并且可以被利用。

**投毒风险：**
该POC代码的主要功能是模拟GlobalProtect服务并捕获恶意请求，所以本身并没有明显的投毒代码。但是，如果攻击者将此蜜罐部署在生产环境中，捕获到的Payload如果直接执行，会导致投毒。另外，开发人员如果直接将此代码部署在蜜罐中，可能会存在安全隐患。 因此推断存在10%的投毒风险。

**利用方式：**
根据漏洞信息，利用方式如下：

1.  **漏洞点：** GlobalProtect的某个未授权接口（推测为`hipreport.esp`相关）。
2.  **攻击方式：** 通过构造包含恶意命令的请求，利用任意文件创建漏洞，最终实现命令注入。
3.  **利用过程：** 攻击者发送特制的HTTP请求到GlobalProtect的接口，其中包含命令注入Payload。由于输入验证不足，Payload会被写入到服务器上的某个文件中。然后，该文件会被执行，从而导致任意命令执行。
4.  **权限提升：** 由于是在防火墙上执行命令，攻击者可以获得root权限。

**总结：**
总的来说，CVE-2024-3400是一个非常严重的漏洞，利用简单，影响范围广。建议受影响的用户尽快升级到安全版本。提供的POC代码主要是用来捕获攻击的蜜罐，本身不包含直接的恶意代码，但是，捕获到的payload如果直接被执行会导致投毒。

**项目地址:** [zam89/CVE-2024-3400-pot](https://github.com/zam89/CVE-2024-3400-pot)

**漏洞详情:** [CVE-2024-3400](https://nvd.nist.gov/vuln/detail/CVE-2024-3400)