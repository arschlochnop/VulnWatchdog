## CVE-2024-4040-CrushFTP-SSTI

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入(SSTI)

**影响应用:** CrushFTP

**危害等级:** 严重，允许未经身份验证的远程攻击者读取文件系统中的文件，绕过身份验证以获得管理访问权限，并在服务器上执行远程代码。

**影响版本:** 10.0 <= version < 10.7.1 and 11.0 <= version < 11.1.0

**利用条件:** 目标 CrushFTP 实例必须是受影响的版本，且可以通过网络访问。攻击者需要先获取目标服务器的 Cookie。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-4040 是 CrushFTP 中的一个服务器端模板注入 (SSTI) 漏洞。该漏洞位于WebInterface/function接口，未经身份验证的攻击者可以利用 `zip` 命令和 `c2f` 参数，结合 `<INCLUDE>` 标签，读取任意文件内容。利用方式如下：

1.  **获取 Cookie:**  攻击者首先需要访问目标 CrushFTP 服务器，通过 `get_cookies` 函数获取 `currentAuth` Cookie。这个Cookie是后续利用的基础。
2.  **构造恶意 URL:**  利用获取的 Cookie，构造包含 `<INCLUDE>` 标签的恶意 URL。URL 格式如下：
    ```
    /WebInterface/function/?command=zip&c2f=<currentAuth>&path=<INCLUDE><path_to_file></INCLUDE>&names=*
    ```
    其中，`<currentAuth>` 替换为 Cookie 值，`<path_to_file>` 替换为要读取的文件路径。
3.  **发送请求:** 向构造的恶意 URL 发送 GET 请求。
4.  **获取文件内容:** 服务器将返回请求的文件内容。

根据提供的 `exploit.py` 脚本，该脚本的功能仅为读取文件，并未发现任何隐藏的、恶意的后门或投毒代码。因此，投毒风险评估为 0%。搜索引擎结果也指向该漏洞的利用方式为文件读取、权限绕过和远程代码执行，均与提供的 POC 代码的功能相符。

**项目地址:** [rbih-boulanouar/CVE-2024-4040](https://github.com/rbih-boulanouar/CVE-2024-4040)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)