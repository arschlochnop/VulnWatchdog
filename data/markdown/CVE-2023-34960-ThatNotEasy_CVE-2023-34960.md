## CVE-2023-34960-Chamilo-命令注入

**漏洞编号:** CVE-2023-34960

**漏洞类型:** 命令注入

**影响应用:** Chamilo

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 1.11.* up to 1.11.18

**利用条件:** 需要网络访问，目标系统开启wsConvertPpt组件的SOAP API。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-34960是Chamilo 1.11.18及更早版本中wsConvertPpt组件存在的一个命令注入漏洞。攻击者可以通过构造恶意的PowerPoint文件名，并通过SOAP API调用wsConvertPpt组件来执行任意命令。

**有效性评估：**

漏洞库信息、搜索引擎结果和提供的PoC代码均表明该漏洞是有效的。多个来源都描述了相同的漏洞原理，即通过SOAP API注入恶意命令。提供的PoC代码是一个Python脚本，它构造一个包含恶意PowerPoint文件名的SOAP请求，利用该漏洞在目标系统上执行命令。Metasploit也收录了此漏洞的利用模块,可以佐证漏洞的有效性。

**投毒风险评估：**

PoC代码本身未发现明显的恶意代码（例如，下载和执行任意文件）。然而，存在轻微的投毒风险，概率约为10%。这种风险主要来自以下几个方面：

*   **依赖项：** PoC代码依赖于`requirements.txt`中指定的Python库。虽然常见库如`requests`是安全的，但如果`requirements.txt`中包含不常见的或来源不明的库，则可能存在恶意代码。需要人工审核`requirements.txt`文件，检查是否存在可疑的依赖关系。
*   **代码逻辑：** 虽然主要代码看起来是直接利用漏洞，但作者可以在脚本中添加隐蔽的后门或数据收集代码，例如向特定服务器发送目标信息。
*   **作者声明：** 作者免责声明暗示该脚本存在潜在风险，用户需要自行承担使用风险。
*  **README.md中的图片链接:** 链接到外部资源，可能存在被替换为恶意图片的风险。

**利用方式：**

1.  **目标确定：** 确定目标Chamilo实例的版本是否在受影响范围内 (1.11.* up to 1.11.18)。
2.  **SOAP请求构造：** 构造一个SOAP请求，其中`file_name`参数包含恶意命令。命令注入发生在PowerPoint文件名处理过程中。
3.  **API调用：** 将构造的SOAP请求发送到Chamilo的wsConvertPpt组件的API端点。通常可以通过分析Chamilo的`additional_webservices.php`文件来确定SOAP端点。
4.  **命令执行：** 如果漏洞利用成功，服务器将执行注入的命令。攻击者可以执行系统命令，例如反弹shell或读取敏感文件。

提供的PoC代码中，注入payload如下：

```xml
<value xsi:type="xsd:string">`{{}}`.pptx'|" |{command}||a #</value>
```

其中`{command}`将被替换为攻击者希望执行的命令。

总而言之，该漏洞利用的有效性高，但存在轻微的投毒风险。用户在使用PoC代码时应谨慎，并仔细检查代码和依赖项。

**项目地址:** [ThatNotEasy/CVE-2023-34960](https://github.com/ThatNotEasy/CVE-2023-34960)

**漏洞详情:** [CVE-2023-34960](https://nvd.nist.gov/vuln/detail/CVE-2023-34960)