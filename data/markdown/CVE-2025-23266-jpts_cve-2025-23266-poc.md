## CVE-2025-23266-NVIDIA Container Toolkit-权限提升/容器逃逸

**漏洞编号:** CVE-2025-23266

**漏洞类型:** 权限提升/容器逃逸

**影响应用:** NVIDIA Container Toolkit

**危害等级:** 高危，可能导致权限提升、数据篡改、信息泄露和拒绝服务

**影响版本:** NVIDIA Container Toolkit All versions up to and including 1.17.7 (CDI mode only for versions prior to 1.17.5), NVIDIA GPU Operator All versions up to and including 25.3.0 (CDI mode only for versions prior to 25.3.0)

**利用条件:** 需要NVIDIA Container Toolkit和Docker环境，目标容器需要使用NVIDIA runtime。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2025-23266 (NVIDIAScape) 是 NVIDIA Container Toolkit 中的一个关键漏洞，允许攻击者逃逸容器并获得主机上的 root 权限。漏洞根源在于容器初始化期间使用的一些 hook 存在缺陷，导致可以执行任意代码并提升权限。提供的 PoC 代码通过以下方式利用此漏洞：

1.  **构建恶意共享对象 (poc.so):**  `main.go` 文件包含一个 `onload` 函数，该函数在共享对象加载时执行。此函数获取主机名和当前用户的信息，并将这些信息写入 `/hacked` 文件。`go build -buildmode=c-shared -o poc.so` 命令将此 Go 代码编译为 C 共享对象。
2.  **创建 Docker 镜像:**  `Dockerfile` 使用 `busybox:stable-glibc` 作为基础镜像，设置 `NVIDIA_VISIBLE_DEVICES=all` 和 `LD_PRELOAD=/proc/self/cwd/poc.so` 环境变量。`LD_PRELOAD` 环境变量指示动态链接器在启动时加载指定的共享对象。由于 NVIDIA Container Toolkit 在容器初始化时会加载 NVIDIA 相关的库，恶意共享对象也会被加载。
3.  **运行容器:**  `docker run --rm --runtime=nvidia poc` 命令使用 NVIDIA runtime 运行构建的 Docker 镜像。当容器启动时，`LD_PRELOAD` 导致 `poc.so` 被加载，触发 `onload` 函数的执行，从而在主机上创建 `/hacked` 文件，证明漏洞利用成功。

**有效性评估:** 提供的 POC 代码是有效的，因为它能够成功触发漏洞并实现容器逃逸，在宿主机上写入`/hacked`文件，验证了权限提升。

**投毒风险评估:** 经过分析，提供的代码本身用于漏洞验证，没有发现作者隐藏的恶意或后门代码。投毒风险为0%。代码功能明确，仅用于演示漏洞利用，没有发现潜在的恶意行为。

**利用方式总结:** 漏洞利用的核心在于 `LD_PRELOAD` 环境变量，它允许攻击者在容器启动时加载恶意共享对象，并在主机上执行任意代码。利用流程如下：
    * 构建包含恶意代码的共享对象。
    * 创建设置 `LD_PRELOAD` 环境变量的 Docker 镜像。
    * 使用 NVIDIA runtime 运行 Docker 镜像。

**项目地址:** [jpts/cve-2025-23266-poc](https://github.com/jpts/cve-2025-23266-poc)

**漏洞详情:** [CVE-2025-23266](https://nvd.nist.gov/vuln/detail/CVE-2025-23266)