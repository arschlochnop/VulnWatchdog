## CVE-2021-38163 - SAP NetWeaver Visual Composer Unrestricted File Upload

**漏洞编号:** CVE-2021-38163

**漏洞类型:** Unrestricted File Upload

**影响应用:** SAP NetWeaver (Visual Composer 7.0 RT)

**危害等级:** 高危，可导致远程代码执行，读取或修改服务器信息，或关闭服务器

**影响版本:** 7.30, 7.31, 7.40, 7.50

**利用条件:** 需要非管理员用户身份验证和网络访问

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-38163是SAP NetWeaver Visual Composer 7.0 RT版本7.30、7.31、7.40和7.50中存在的一个不受限制的文件上传漏洞。经过身份验证的非管理用户可以通过网络上传恶意文件并触发其处理，从而以Java服务器进程的权限运行操作系统命令。这些命令可用于读取或修改服务器上的任何信息，或关闭服务器使其不可用。

**漏洞利用方式：**
1.  攻击者需要拥有一个非管理用户的有效SAP账号。
2.  利用该账号登录SAP系统。
3.  构造一个包含恶意代码的JSP文件，例如`urgent.jsp`，其中包含执行任意系统命令的代码。
4.  利用Visual Composer的文件上传功能，通过`VCParMigrator` servlet，将恶意JSP文件上传到服务器上的特定目录。利用路径遍历（../../）绕过上传限制,将文件上传到目标位置`/usr/sap/{SID}/{INSTANCE}/j2ee/cluster/apps/sap.com/rtmfcommunicator/servlet_jsp/rtmfCommunicator/root/html/urgent.jsp`。
5.  上传后，通过访问该JSP文件，例如`http://target:50000/rtmfCommunicator/html/urgent.jsp?cve=command`，触发恶意代码的执行，从而执行任意系统命令。

**投毒风险分析：**
POC代码主要实现了漏洞利用的功能，通过上传包含JSP后门的文件到目标服务器并执行命令。代码中存在一些网络请求和参数构造，如果作者在这些地方添加恶意代码，例如：
*   在发起请求时，偷偷向第三方服务器发送受害者信息。
*   在上传的文件中植入更隐蔽的后门，用于长期控制目标系统。
这些都属于潜在的投毒风险。但从代码本身来看，这些风险点并不明显，需要更深入的分析才能确认。

因此，综合评估，认为存在10%的投毒风险。主要是因为POC代码中的请求头、参数构造、以及上传的文件内容都有可能被用于隐藏恶意代码。

**搜索引擎结果分析：**
*   NVD、CVE Details等网站确认了该漏洞的存在和危害。
*   Broadcom安全中心指出该漏洞可能导致任意代码执行。
*   Onapsis的研究表明该漏洞已被积极利用。
*   SecurityBridge Cloud Platform提供了相关的安全补丁信息。

**项目地址:** [core1impact/CVE-2021-38163](https://github.com/core1impact/CVE-2021-38163)

**漏洞详情:** [CVE-2021-38163](https://nvd.nist.gov/vuln/detail/CVE-2021-38163)