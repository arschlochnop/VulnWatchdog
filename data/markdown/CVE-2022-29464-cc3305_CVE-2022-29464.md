## CVE-2022-29464-WSO2-任意文件上传导致RCE

**漏洞编号:** CVE-2022-29464

**漏洞类型:** 任意文件上传

**影响应用:** WSO2 API Manager, Identity Server, Enterprise Integrator, Open Banking AM/KM

**危害等级:** 高危，未经授权的远程代码执行

**影响版本:** WSO2 API Manager 2.2.0 up to 4.0.0, WSO2 Identity Server 5.2.0 up to 5.11.0, WSO2 Identity Server Analytics 5.4.0, 5.4.1, 5.5.0 and 5.6.0, WSO2 Identity Server as Key Manager 5.3.0 up to 5.11.0, WSO2 Enterprise Integrator 6.2.0 up to 6.6.0, WSO2 Open Banking AM 1.4.0 up to 2.0.0 and WSO2 Open Banking KM 1.4.0, up to 2.0.0.

**利用条件:** 需要网络访问目标WSO2服务器

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-29464 是一个存在于多个 WSO2 产品中的严重漏洞，允许未经身份验证的攻击者上传任意文件，从而导致远程代码执行（RCE）。

**有效性：**

根据漏洞库信息、搜索引擎结果和提供的漏洞利用代码，该漏洞的利用是有效的。搜索引擎结果表明该漏洞已被积极利用，存在公开可用的PoC，并且厂商建议用户立即更新或采取临时缓解措施。

**投毒风险：**

该PoC代码主要通过文件上传功能将恶意的JSP文件上传到目标服务器的webapps目录下。直接观察代码，存在投毒的可能性较低，例如作者可能嵌入反向shell或其他恶意功能，但并未发现明显的恶意行为。但仍需要对该脚本依赖的库，以及脚本的作者进行信誉评估。同时代码使用`force`参数绕过版本检测，如果目标事实上不存在漏洞，可能会因为尝试上传恶意文件导致服务不稳定。综合评估，投毒风险为10%。

**利用方式：**

1.  **漏洞触发：** 攻击者使用 `/fileupload` 端点，通过 `Content-Disposition` 中的目录遍历序列（例如 `../../../../`）将文件上传到 Web 根目录下的目录，如 `repository/deployment/server/webapps`。
2.  **文件上传：** 攻击者上传包含恶意代码的 JSP 文件（或其他 Web Shell），例如本例中，poc脚本构造一个jsp_shell，命令执行的命令通过参数传入，更加灵活。
3.  **代码执行：** 攻击者通过访问上传的 JSP 文件触发恶意代码的执行，从而在服务器上执行任意命令。

总而言之，该漏洞利用方式是通过精心构造的HTTP请求，利用WSO2文件上传接口的目录遍历漏洞，上传恶意JSP文件，最终导致远程代码执行。

**项目地址:** [cc3305/CVE-2022-29464](https://github.com/cc3305/CVE-2022-29464)

**漏洞详情:** [CVE-2022-29464](https://nvd.nist.gov/vuln/detail/CVE-2022-29464)