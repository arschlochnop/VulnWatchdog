## CVE-2023-28771-Zyxel防火墙远程命令注入

**漏洞编号:** CVE-2023-28771

**漏洞类型:** 远程命令注入 (RCE)

**影响应用:** Zyxel ZyWALL/USG, VPN, USG FLEX, ATP系列防火墙

**危害等级:** 高危，可导致完全系统控制

**影响版本:** ZyWALL/USG: 4.60-4.73, VPN/USG FLEX/ATP: 4.60-5.35

**利用条件:** 无需认证，网络可达受影响设备

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

该漏洞存在于Zyxel防火墙的IKEv2协议处理中。攻击者可以通过发送特制的IKEv2数据包，利用不正确的错误信息处理机制，注入操作系统命令。漏洞利用代码`CVE-2023-28771-poc.py`使用`scapy`库构造并发送恶意IKEv2数据包，其中命令通过`cmd`参数传递，或者通过提供`lhost`和`lport`参数建立反向shell。利用方式如下：

1.  **漏洞触发:** 向目标设备的UDP 500端口(IKE)发送特制的IKEv2数据包。
2.  **命令注入:** 数据包中的`IKEv2_payload_Notify`字段的`load`参数包含恶意命令，该命令会在设备上执行。
3.  **反向Shell/命令执行:** 通过`--cmd`参数执行任意命令，或通过`--lhost`和`--lport`参数，建立反向shell连接攻击者。

从代码和搜索结果来看，此POC有效且被广泛利用。搜索引擎结果表明，该漏洞已被用于DDoS僵尸网络。提供的代码仓库中没有发现明显的投毒代码。风险在于，如果用户下载并使用了来源于不可信源的POC，可能存在被替换或修改的风险。但是，从提供的代码片段来看，该仓库本身没有主动投毒行为。

漏洞利用方式：攻击者发送包含恶意命令的特制IKEv2数据包到目标设备的UDP 500端口，触发命令注入，最终实现远程命令执行或获取反向shell。

 **有效性评估:** 基于漏洞库信息，搜索结果和提供的POC代码，此POC是有效的，可以在未授权的情况下远程执行命令。

 **投毒风险评估:** 代码仓库本身没有明显的投毒迹象。所有操作都在POC验证的预期范围内。因此，投毒风险评估为0%。

 **利用方式总结:**

1.  使用`scapy`库构造恶意的IKEv2数据包。
2.  在`IKEv2_payload_Notify`的`load`字段中嵌入操作系统命令。
3.  将数据包发送到目标设备的UDP 500端口。
4.  命令将在目标设备上执行，攻击者可以获得反向shell或执行任意命令。

**项目地址:** [benjaminhays/CVE-2023-28771-PoC](https://github.com/benjaminhays/CVE-2023-28771-PoC)

**漏洞详情:** [CVE-2023-28771](https://nvd.nist.gov/vuln/detail/CVE-2023-28771)