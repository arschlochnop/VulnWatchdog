## CVE-2022-41352-Zimbra RCE

**漏洞编号:** CVE-2022-41352

**漏洞类型:** 远程代码执行

**影响应用:** Zimbra Collaboration Suite

**危害等级:** 高危，允许未经身份验证的远程代码执行

**影响版本:** <9.0.0.p27和 <8.8.15.p34

**利用条件:** 需要目标Zimbra服务器开启邮件接收功能，且未安装相应的补丁或pax

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-41352是Zimbra Collaboration Suite中的一个远程代码执行漏洞，源于使用存在漏洞的`cpio`版本处理上传的压缩包。攻击者可以构造一个恶意的tar压缩包，其中包含指向`/opt/zimbra/jetty/webapps/zimbra/public`目录的符号链接，从而将恶意JSP文件写入该目录，进而通过访问该JSP文件执行任意代码。

**有效性：**
根据漏洞信息和搜索结果，此漏洞利用代码是有效的。漏洞描述中提到可以通过 cpio 的 loophole 上传任意文件，从而导致 RCE。 搜索引擎结果中也显示此漏洞被广泛利用。

**投毒风险：**
代码的主要功能是构造一个恶意的tar文件，其中包含webshell，然后通过SMTP协议将该文件作为邮件附件发送给目标服务器。以下是对投毒风险的分析：

*   **Payload 植入:** POC代码本身包含恶意代码（webshell）。用户在使用此POC时，实际上就是在目标系统上部署一个webshell，这本身就是一种攻击行为。从这个意义上说，该POC *包含* 了恶意负载。
*   **配置信息:** POC代码中包含一些配置信息，例如目标服务器地址、webshell路径、文件名、发件人、收件人等。如果攻击者恶意修改这些配置信息，例如将webshell路径修改为其他敏感目录，可能会导致更严重的后果。
*   **SMTP配置：**POC代码需要配置SMTP服务器信息才能发送邮件。如果攻击者在未授权的情况下使用他人的SMTP服务器，可能会导致法律问题。

综合以上因素，我评估该POC代码存在 **10%** 的投毒风险。主要风险点在于使用者可能会被诱导使用默认配置或者被恶意配置导致更严重的后果，或是滥用他人SMTP。

**利用方式：**

1.  **配置目标信息：** 修改POC代码中的`TARGET`（目标Zimbra服务器地址）、`WEBSHELL_PATH`和`WEBSHELL_NAME`（webshell的存放路径和名称）、`SENDER`和`RECIPIENT`（发件人和收件人邮箱地址）等参数。
2.  **构造恶意Tar文件：** POC代码会创建一个包含恶意JSP webshell的tar文件。该tar文件利用了`cpio`命令处理符号链接时的漏洞，将webshell写入到`/opt/zimbra/jetty/webapps/zimbra/public`目录下。
3.  **发送邮件：** POC代码通过SMTP协议将构造好的tar文件作为附件发送给目标Zimbra服务器。即使收件人不存在，只要邮件被Zimbra服务器处理，漏洞就会被触发。
4.  **触发漏洞：** Zimbra服务器的amavis组件使用存在漏洞的`cpio`命令解压收到的tar文件，恶意JSP文件被写入到指定目录。
5.  **远程代码执行：** 攻击者通过Web浏览器访问上传的JSP webshell，从而在Zimbra服务器上执行任意代码。

**项目地址:** [Cr4ckC4t/cve-2022-41352-zimbra-rce](https://github.com/Cr4ckC4t/cve-2022-41352-zimbra-rce)

**漏洞详情:** [CVE-2022-41352](https://nvd.nist.gov/vuln/detail/CVE-2022-41352)