## CVE-2023-4220-Chamilo-RCE

**漏洞编号:** CVE-2023-4220

**漏洞类型:** 远程代码执行

**影响应用:** Chamilo LMS

**危害等级:** 高危，允许未经身份验证的攻击者上传webshell并执行任意代码

**影响版本:** <= 1.11.24

**利用条件:** Chamilo LMS 实例需要运行在易受攻击的版本上，并且需要能够通过网络访问 vulnerable_url

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-4220 存在于 Chamilo LMS <= 1.11.24 的 `/main/inc/lib/javascript/bigupload/inc/bigUpload.php` 文件中，是一个未授权的文件上传漏洞。

**有效性:**

根据漏洞信息、搜索结果和提供的漏洞利用代码，可以判定该漏洞利用代码是有效的。漏洞库信息明确指出该漏洞允许未经身份验证的攻击者上传 webshell 并执行远程代码。搜索引擎结果中也提到了这一点，并给出了PoC链接。漏洞利用代码 `exploit.py` 实现了漏洞利用的完整流程，包括：

1.  **检查目标 URL 是否易受攻击:**  `checkVuln` 函数通过检查 `/main/inc/lib/javascript/bigupload/files` 目录的可访问性来判断目标是否存在漏洞。
2.  **上传 webshell:**  `exploitVuln` 函数通过 POST 请求将包含恶意 PHP 代码 (webshell) 的文件上传到 `/main/inc/lib/javascript/bigupload/inc/bigUpload.php`，服务器会将文件存储在 `/main/inc/lib/javascript/bigupload/files` 目录下。
3.  **执行命令:** 漏洞利用代码通过访问上传的 webshell，利用 GET 参数 `cmd` 执行任意系统命令。
4.  **反弹shell:** 通过webshell执行bash反弹shell命令,获取服务器控制权.

**投毒风险:**

对提供的 `exploit.py` 代码进行分析，发现存在轻微的投毒风险。风险主要来自于以下几点：

*   **硬编码代理:** 代码中存在 `proxy = {'http': 'http://localhost:8080/'}`。如果用户没有注意到这一行，并且本地没有运行代理服务，可能会导致漏洞利用失败，并泄露目标URL。这是一个潜在的流量劫持点，虽然不太可能是有意的投毒，但仍存在一定风险。
*   **输入webshell文件名:** 漏洞利用代码允许用户自定义webshell的文件名,如果用户设置恶意文件名,可能会影响后续利用.
*   **Reverse Shell IP 和端口:** 脚本要求用户输入攻击者的 IP 地址和端口。如果攻击者没有正确配置监听器，则反弹 shell 将无法建立连接。

虽然存在上述风险，但这些风险更偏向于可用性问题，而不是恶意代码。漏洞利用的整体逻辑是清晰的，旨在利用漏洞，而不是进行恶意活动，因此投毒风险较低，估计在 10% 左右。

**利用方式:**

1.  **确定目标 Chamilo LMS 版本:**  确认目标 Chamilo LMS 实例的版本小于等于 1.11.24。
2.  **运行 `exploit.py`:**  使用 Python 运行 `exploit.py` 脚本，并提供目标 Chamilo LMS 的 URL 作为参数，选择 `exploit` 模式。
3.  **输入 webshell 文件名：** 输入希望使用的 webshell 文件名（不包含扩展名）。
4.  **设置反弹 shell 信息:**  输入攻击者的 IP 地址和端口，确保攻击者机器上已经启动了 netcat 监听器。
5.  **获取 shell:**  如果漏洞利用成功，攻击者将会在 netcat 监听器上获得一个反弹 shell，从而控制目标服务器。

**项目地址:** [H4cking4All/CVE-2023-4220](https://github.com/H4cking4All/CVE-2023-4220)

**漏洞详情:** [CVE-2023-4220](https://nvd.nist.gov/vuln/detail/CVE-2023-4220)