## CVE-2021-43798 Grafana 目录遍历

**漏洞编号:** CVE-2021-43798

**漏洞类型:** 目录遍历

**影响应用:** Grafana

**危害等级:** 高危，可能导致敏感信息泄露

**影响版本:** 8.0.0-beta1 to 8.3.0 (除已修复版本)

**利用条件:** 需要Grafana实例运行且版本在受影响范围内，无需身份验证

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-43798 是 Grafana 中的一个目录遍历漏洞。攻击者可以通过构造包含目录遍历序列的 URL，访问服务器上的任意文件。漏洞存在于 URL 路径 `/public/plugins//`，其中 `<plugin id>` 是任何已安装插件的 ID。利用方式是：首先确定目标 Grafana 实例是否运行在受影响的版本范围内。然后，构造包含目录遍历序列的 URL，例如 `http://<grafana_host_url>/public/plugins/<plugin_id>/../../../../../../etc/passwd`。如果服务器返回 `/etc/passwd` 文件的内容，则表明漏洞存在。

**有效性分析：**

提供的POC代码 `exploit.py` 实现了漏洞的利用，包括版本检测和利用过程。代码首先检查目标Grafana实例的版本是否在受影响范围内，然后构造包含目录遍历序列的URL，发送HTTP请求，并根据响应状态码判断漏洞是否存在。因此POC代码是有效的.

**投毒风险分析：**

代码主要功能是检查Grafana版本和发送包含目录遍历的请求，风险较低。payload.txt,paths.txt文件可能存在恶意payload。代码会尝试从payload.txt文件中读取payload，并结合目录遍历路径进行利用。虽然代码本身没有明显的恶意行为，但如果 `payload.txt` 文件中包含恶意命令或脚本，则存在潜在的投毒风险。因此，不能完全排除投毒风险，但风险较低。综合评估，投毒风险为10%。

**利用方式总结：**

1.  确定目标 Grafana 实例的 IP 地址和端口。
2.  检测目标 Grafana 实例的版本。
3.  构造包含目录遍历序列的 URL：`/public/plugins/<plugin_id>/../../../../../../etc/passwd` (例如)。
4.  发送 HTTP GET 请求到构造的 URL。
5.  如果服务器返回请求的文件内容，则漏洞存在。

**项目地址:** [aymenbouferroum/CVE-2021-43798_exploit](https://github.com/aymenbouferroum/CVE-2021-43798_exploit)

**漏洞详情:** [CVE-2021-43798](https://nvd.nist.gov/vuln/detail/CVE-2021-43798)