## CVE-2023-38831-WinRAR远程代码执行

**漏洞编号:** CVE-2023-38831

**漏洞类型:** 远程代码执行

**影响应用:** WinRAR

**危害等级:** 高危，可导致远程代码执行和系统控制

**影响版本:** < 6.23

**利用条件:** 需要用户解压特制的恶意ZIP压缩包

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2023-38831 漏洞存在于 WinRAR 6.23 之前的版本中。攻击者可以创建一个恶意的 ZIP 压缩包，其中包含一个伪装成普通文件的文件和一个同名的文件夹。当用户尝试在 WinRAR 中查看该“普通文件”时，WinRAR 会错误地执行同名文件夹中的内容，从而导致任意代码执行。

**有效性：**
提供的 PoC 代码 `poc.py` 能够生成利用此漏洞的恶意 ZIP 压缩包。该脚本首先创建一个包含恶意 payload (例如 script.bat) 和良性文件 (例如 pepe.jpg) 的目录结构。然后，它将此目录结构压缩成 ZIP 文件，并修改 ZIP 文件中的文件名，以触发漏洞。`script.bat` 的作用是在 `%TEMP%` 目录下提取 ZIP 文件内容，运行良性文件作为诱饵，然后执行恶意操作，例如创建一个包含 “hacked” 内容的文本文件并使用记事本打开。

**投毒风险：**
分析提供的代码，没有发现明显的投毒代码。`poc.py` 的作用是生成恶意 ZIP 文件，而 `script.bat` 包含的是恶意行为的代码，例如运行良性文件，创建 `hacked.txt` 等。这些行为是漏洞利用的一部分，而不是隐藏的恶意代码。虽然利用 `script.bat` 可以执行任意操作，但这属于漏洞利用的范畴，而非代码投毒。

**利用方式：**
1.  攻击者使用 `poc.py` 脚本生成一个恶意的 ZIP 压缩包，其中包含一个良性文件（例如图片）和一个同名的文件夹。
2.  攻击者将此恶意 ZIP 压缩包发送给受害者。
3.  受害者使用 WinRAR (6.23 之前的版本) 打开并尝试查看 ZIP 压缩包中的良性文件。
4.  WinRAR 错误地执行与良性文件同名的文件夹中的内容 (由 `script.bat` 控制)。
5.  `script.bat` 首先将 ZIP 文件的内容解压到临时目录。
6.  `script.bat` 运行良性文件（例如图片）作为诱饵，以迷惑受害者。
7.  `script.bat` 执行任意恶意操作，例如创建文件，修改注册表，安装恶意软件等。


**项目地址:** [kehrijksen/CVE-2023-38831](https://github.com/kehrijksen/CVE-2023-38831)

**漏洞详情:** [CVE-2023-38831](https://nvd.nist.gov/vuln/detail/CVE-2023-38831)