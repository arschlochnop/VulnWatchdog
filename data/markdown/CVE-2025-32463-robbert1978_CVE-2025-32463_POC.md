## CVE-2025-32463-Sudo-本地提权

**漏洞编号:** CVE-2025-32463

**漏洞类型:** 本地提权

**影响应用:** Sudo

**危害等级:** 高危，本地用户可提升至root权限

**影响版本:** 1.9.14 <= version < 1.9.17p1

**利用条件:** 需要本地用户权限，目标系统存在漏洞版本的sudo，并且nsswitch.conf配置允许加载libnss_systemd.so.2

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2025-32463是Sudo 1.9.14到1.9.17p1版本中存在的一个本地提权漏洞。该漏洞允许本地用户通过`sudo`命令的`--chroot`选项和精心构造的`/etc/nsswitch.conf`文件，来加载恶意的动态链接库，从而提升到root权限。

**漏洞利用方式:**

1.  **创建chroot环境:** 首先，需要创建一个包含基本目录结构的chroot环境，包括`/etc`、`/lib`、`/lib64`、`/bin`等。
2.  **复制必要的文件:** 将系统中的`/lib/x86_64-linux-gnu/libc.so.6`、`/lib64/ld-linux-x86-64.so.2`、`/bin/sh`、`/bin/passwd`、`/etc/nsswitch.conf`等文件复制到chroot环境中。
3.  **构造恶意的libnss_systemd.so.2:** 编写一个包含恶意代码的C程序，并将其编译为动态链接库`libnss_systemd.so.2`，放置在chroot环境的`/lib/libnss_systemd.so.2`中。该恶意代码会在加载时执行，提升当前用户的权限至root，并启动一个shell。
4.  **修改nsswitch.conf:** 确保chroot环境中的`/etc/nsswitch.conf`配置文件包含`passwd:         files systemd`这一行，使得sudo在chroot环境下尝试加载`libnss_systemd.so.2`。
5.  **利用sudo --chroot执行命令:** 使用`sudo -R chroot chroot`命令，让sudo在chroot环境下执行命令。由于chroot环境中的`/etc/nsswitch.conf`指向了恶意的`libnss_systemd.so.2`，该库会被加载执行，从而实现提权。

**有效性评估:**

提供的POC代码看起来是有效的。`Makefile`脚本负责创建chroot环境，复制必要的文件，编译恶意的`libnss_systemd.so.2`，以及调用`sudo -R chroot chroot`命令。`evil.c`包含了提权的恶意代码。`readme.md`文件解释了漏洞原理。

**投毒风险分析:**

该代码库的主要目的是利用CVE-2025-32463漏洞进行本地提权。尽管该漏洞本身可能被滥用，但就提供的代码而言，直接植入恶意后门的可能性较低，但依旧存在一定风险。风险分析如下：

*   **evil.c:** `evil.c` 看起来直接实现了提权的功能，并没有明显的恶意代码。
*   **Makefile:** `Makefile` 的主要功能是构建 chroot 环境和编译 evil.c, 其中存在getsrc, build_sudo,存在下载和编译sudo可能存在后门代码的风险,但是风险较低.
*   **隐蔽性后门风险:** 虽然没有发现明显的投毒代码，但也不能完全排除作者通过更隐蔽的方式植入后门的可能性，比如在编译过程中引入，或者在代码逻辑中隐藏。

基于以上分析，虽然没有直接证据表明存在投毒行为，但考虑到安全风险，需要保持警惕。POC中wget和build过程存在一定被篡改投毒的可能性，所以这里认为存在较低的投毒风险。因此，投毒风险评估为10%。

**项目地址:** [robbert1978/CVE-2025-32463_POC](https://github.com/robbert1978/CVE-2025-32463_POC)

**漏洞详情:** [CVE-2025-32463](https://nvd.nist.gov/vuln/detail/CVE-2025-32463)