## CVE-2024-4040-CrushFTP-SSTI

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入 (SSTI)

**影响应用:** CrushFTP

**危害等级:** 高危，可能导致任意文件读取、认证绕过和远程代码执行

**影响版本:** < 10.7.1 和 < 11.1.0

**利用条件:** 需要网络访问CrushFTP服务

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4040是CrushFTP中的一个服务器端模板注入漏洞。未经身份验证的远程攻击者可以利用此漏洞读取文件系统中的文件（超出VFS沙箱范围），绕过身份验证以获得管理访问权限，并在服务器上执行远程代码。

**有效性：**
提供的`scan_host.py`脚本通过尝试读取`users/MainUsers/groups.XML`或`prefs.XML`文件来检测漏洞是否存在。如果成功读取到这些文件，则认为目标易受攻击。脚本使用匿名登录，因此不需要有效的用户名和密码。

**投毒风险：**
虽然`scan_host.py`脚本本身主要是为了检测漏洞，但存在一些微小的投毒风险。该脚本直接发送payload到目标服务器，并根据返回结果判断是否存在漏洞，如果攻击者修改脚本，可能会包含以下风险：
1.  **信息收集：**  修改脚本以收集有关服务器的信息（例如，操作系统，安装路径），并将这些信息发送回攻击者。
2.  **拒绝服务 (DoS)：**  修改脚本以发送大量请求，从而使目标服务器过载。
3.  **漏洞利用尝试：** 脚本本身不执行RCE，但如果经过修改，可以尝试更复杂的利用，例如写入文件或执行命令。
虽然有上述风险，但由于`scan_host.py`只是验证型的exploit，整体投毒风险较低,预估为10%。
`scan_logs.py` 和 `scan_logs.ps1` 用于在CrushFTP日志中查找利用痕迹。这些脚本本身不具有利用漏洞的能力，因此不会造成直接损害。当然，如果攻击者能够篡改日志扫描脚本，可能会隐藏或伪造利用痕迹，从而逃避检测。

**利用方式：**
根据漏洞描述，攻击者可以通过发送包含恶意模板的请求来触发服务器端模板注入。例如，可以使用`<INCLUDE>`标签来读取任意文件。成功利用此漏洞后，攻击者可以:
1.  **读取敏感文件：**  获取配置文件、用户数据等。
2.  **绕过身份验证：**  可能通过读取配置文件或利用模板注入执行认证绕过。
3.  **远程代码执行 (RCE)：**  通过模板注入执行任意代码，完全控制服务器。

**项目地址:** [airbus-cert/CVE-2024-4040](https://github.com/airbus-cert/CVE-2024-4040)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)