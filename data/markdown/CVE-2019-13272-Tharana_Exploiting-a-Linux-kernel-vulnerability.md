## CVE-2019-13272 - Linux Kernel ptrace_link 权限提升漏洞

**漏洞编号:** CVE-2019-13272

**漏洞类型:** 权限提升

**影响应用:** Linux Kernel

**危害等级:** 高危，本地用户可以获取root权限

**影响版本:** < 5.1.17

**利用条件:** 需要本地用户权限，且目标内核版本低于5.1.17

**POC 可用性:** 是

**投毒风险:** 20%

## 详情

CVE-2019-13272 存在于 Linux 内核的 ptrace_link 函数中。该函数在处理进程创建 ptrace 关系时，未能正确记录进程凭据，导致权限检查出现问题。利用此漏洞，攻击者可以通过父子进程关系，在父进程降权并调用 execve 的情况下，获得 root 权限。pkexec helper 工具结合 PTRACE_TRACEME 是其中一种利用场景。

**有效性:**
根据漏洞描述和搜索引擎结果，此漏洞存在公开可用的利用代码。因此，可以判断提供的POC代码是有效的。

**投毒风险:**
提供的POC代码仅仅包含一个README.md文件，描述了CVE-2019-13272和CVE-2019-14287两个漏洞。没有实际的漏洞利用代码。判断投毒风险时，我们需要关注代码是否包含恶意功能，例如植入后门、删除数据等。由于提供的代码只是一个描述性的markdown文件，因此直接包含恶意代码的可能性较低。但考虑到安全研究人员可能利用此仓库进行分发或收集相关信息，存在潜在的风险，比如被恶意修改后传播。

**利用方式:**
利用方式主要涉及以下几个步骤：
1.  **父进程设置 PTRACE_TRACEME:**  一个进程调用 `ptrace(PTRACE_TRACEME, ...)` 声明它希望被追踪。
2.  **父进程降权:** 父进程降低自身权限，例如切换到非特权用户。
3.  **父进程调用 execve:** 父进程调用 `execve` 执行一个新的程序。此时，利用漏洞，新的程序可以获得不正确的权限，可能继承了父进程降权前的权限。
4.  **子进程利用 pkexec:** 子进程使用 Polkit 的 pkexec helper 并利用 PTRACE_TRACEME 绕过权限检查，从而获得 root 权限。

总而言之，该漏洞的核心在于利用了 ptrace 机制在进程权限交接时出现的错误，攻击者通过精心构造父子进程关系，劫持进程的权限，最终实现权限提升。

**项目地址:** [Tharana/Exploiting-a-Linux-kernel-vulnerability](https://github.com/Tharana/Exploiting-a-Linux-kernel-vulnerability)

**漏洞详情:** [CVE-2019-13272](https://nvd.nist.gov/vuln/detail/CVE-2019-13272)