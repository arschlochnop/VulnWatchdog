## CVE-2022-0492-Linux Kernel cgroup_release_agent 特权提升/容器逃逸

**漏洞编号:** CVE-2022-0492

**漏洞类型:** 特权提升/容器逃逸

**影响应用:** Linux Kernel

**危害等级:** 高危，可能导致容器逃逸和主机控制

**影响版本:** kernel 5.17 rc3 (可能影响其他版本)

**利用条件:** 需要cgroups v1, 容器环境，CAP_SYS_ADMIN能力或用户命名空间支持

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-0492 存在于 Linux 内核的 `cgroup_release_agent_write` 函数中。攻击者可以利用 cgroups v1 的 release_agent 特性来提升权限并绕过命名空间隔离，从而实现容器逃逸。根据漏洞库信息和搜索结果，这是一个高危漏洞。提供的POC代码（`can-ctr-escape-cve-2022-0492.sh`）是一个检测脚本，用于判断容器环境是否容易受到此漏洞的影响，而非直接的攻击代码。它首先创建测试目录，然后尝试挂载 cgroup 并检查 `release_agent` 文件是否可写。如果容器具有 `CAP_SYS_ADMIN` 且没有 AppArmor 或 SELinux 的保护，则认为该容器容易受到攻击，但这不一定需要CVE-2022-0492来利用，而可以通过其他方式利用CAP_SYS_ADMIN实现逃逸。或者，如果容器可以利用用户命名空间进行逃逸，也会标记为易受攻击。脚本最后删除测试目录。因此，POC代码的目的是检测漏洞的存在，而不是利用它进行攻击，所以不存在直接的投毒风险。漏洞利用方式是：1. 创建一个 cgroup; 2. 设置 `release_agent` 为攻击者可控的脚本路径; 3. 触发 cgroup 的 release 操作，导致内核执行攻击者设置的脚本，从而提升权限或者逃逸容器。由于POC仅为检查脚本，故投毒风险为0%。

**项目地址:** [PaloAltoNetworks/can-ctr-escape-cve-2022-0492](https://github.com/PaloAltoNetworks/can-ctr-escape-cve-2022-0492)

**漏洞详情:** [CVE-2022-0492](https://nvd.nist.gov/vuln/detail/CVE-2022-0492)