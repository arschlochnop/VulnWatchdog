## CVE-2022-26134 - Confluence OGNL注入远程代码执行

**漏洞编号:** CVE-2022-26134

**漏洞类型:** 远程代码执行

**影响应用:** Atlassian Confluence Server/Data Center

**危害等级:** 高危，未经身份验证的远程代码执行

**影响版本:** 1.3.0 < version < 7.4.17, 7.13.0 <= version < 7.13.7, 7.14.0 <= version < 7.14.3, 7.15.0 <= version < 7.15.2, 7.16.0 <= version < 7.16.4, 7.17.0 <= version < 7.17.4, 7.18.0 <= version < 7.18.1

**利用条件:** 目标Confluence实例存在于受影响的版本范围内，且攻击者可以访问Confluence服务器。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-26134 是一个存在于 Atlassian Confluence Server 和 Data Center 中的 OGNL 注入漏洞。未经身份验证的攻击者可以利用此漏洞在 Confluence 服务器上执行任意代码。

**有效性:**
根据漏洞库信息、搜索引擎结果（Rapid7, Qualys, NVD, Unit 42, Darktrace, Trend Micro, Akamai, Splunk, Datadog）和提供的漏洞利用代码，此漏洞是有效的，并且在野外被积极利用。

**投毒风险:**
提供的 Python 漏洞利用代码 `exploit.py` 总体来说没有明显的投毒代码。它通过构造包含恶意 OGNL 表达式的 URL 发送 HTTP 请求，并在响应头中接收命令执行结果。但是，有几个潜在的风险点：

1.  **依赖风险:** 代码依赖于 `requests`, `rich` 等第三方库，如果这些库被篡改，可能引入恶意代码。
2.  **反向 shell 代码:**  `-l` 和 `-p` 参数会植入反向shell，如被恶意利用可以控制目标服务器。本次分析**不视为投毒**。
3.  **结果判断:**  脚本通过检查 HTTP 状态码和 `X-Cmd-Response` 头的长度来判断漏洞是否成功利用。如果 Confluence 服务器的行为略有不同，攻击者可能会错误地认为目标易受攻击，并执行恶意操作。

综合判断，投毒风险为 10%，主要是由于可能存在的依赖风险。

**利用方式:**
该漏洞的利用方式如下：

1.  攻击者构造一个包含恶意 OGNL 表达式的 URL。
2.  攻击者将构造的 URL 发送到目标 Confluence 服务器。
3.  Confluence 服务器解析该 URL，执行 OGNL 表达式。
4.  如果 OGNL 表达式成功执行，攻击者可以在 Confluence 服务器上执行任意代码。
5.  漏洞利用代码 `exploit.py` 通过命令行参数指定目标 URL 和要执行的命令，构造包含恶意 OGNL 表达式的 HTTP GET 请求，服务器执行命令后，将结果放在HTTP Header的X-Cmd-Response字段中返回。或者通过指定lhost和lport, 执行反向shell, 从而获取目标服务器控制权。

**项目地址:** [Chocapikk/CVE-2022-26134](https://github.com/Chocapikk/CVE-2022-26134)

**漏洞详情:** [CVE-2022-26134](https://nvd.nist.gov/vuln/detail/CVE-2022-26134)