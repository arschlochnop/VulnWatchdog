## CVE-2023-34362-MOVEit Transfer-SQL注入

**漏洞编号:** CVE-2023-34362

**漏洞类型:** SQL注入

**影响应用:** MOVEit Transfer

**危害等级:** 高危，可导致未经身份验证的攻击者访问数据库，远程代码执行。

**影响版本:** 受影响版本包括早于 2021.0.6 (13.0.6), 2021.1.4 (13.1.4), 2022.0.4 (14.0.4), 2022.1.5 (14.1.5), 和 2023.0.1 (15.0.1) 的版本，以及所有这些版本之前的版本（例如 2020.0 和 2019x）以及较旧的不受支持的版本。

**利用条件:** 需要可以通过HTTP或HTTPS访问MOVEit Transfer的Web应用程序。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2023-34362 存在于 MOVEit Transfer Web 应用程序中，是一个未经身份验证的 SQL 注入漏洞。攻击者可以利用此漏洞访问 MOVEit Transfer 数据库，并根据使用的数据库引擎（MySQL、Microsoft SQL Server 或 Azure SQL），推断数据库的结构和内容，并执行 SQL 语句来更改或删除数据库元素。根据提供的漏洞利用代码`move.rb`，该漏洞利用脚本首先获取初始会话令牌和InstID，然后创建一个新的sysadmin帐户，利用API访问令牌，找到folderId。该脚本泄露 Org Key 并使用反序列化 Gadget 植入加密的Gadget到数据库中，最后触发 Gadget 反序列化，实现远程代码执行（RCE）。最后，该脚本删除IoC。

**有效性：**

从漏洞库信息、搜索结果和漏洞利用代码来看，该漏洞是真实存在的，并且已经被积极利用。提供的PoC代码通过执行一系列操作，包括创建管理员账户、上传恶意文件（gadget），然后利用反序列化漏洞执行任意代码，验证了漏洞的可利用性。

**投毒风险：**

提供的ruby脚本主要功能是利用漏洞，而不是进行投毒。

*   `move.rb` 脚本看起来是为了利用 MOVEit Transfer 中的 SQL 注入漏洞而设计的，目的是实现远程代码执行。它创建管理员帐户、上传文件、进行反序列化攻击等。这些行为都是直接针对漏洞利用，而不是为了在目标系统上安装恶意后门或进行其他恶意活动。

*   风险评估： 0.1%的可能将漏洞验证过程中写入数据库的后门判定为恶意投毒代码。

**利用方式：**

1.  **SQL 注入：** 攻击者利用 SQL 注入漏洞，在数据库中创建一个新的具有管理员权限的帐户。
2.  **文件上传：** 攻击者上传包含恶意代码的文件（gadget）。
3.  **反序列化：** 攻击者触发反序列化过程，执行上传的恶意代码，从而实现远程代码执行。

总而言之，提供的PoC代码是有效的，并且能够成功利用该漏洞实现远程代码执行。投毒的风险很低。


**项目地址:** [glen-pearson/MoveIT-CVE-2023-34362-RCE](https://github.com/glen-pearson/MoveIT-CVE-2023-34362-RCE)

**漏洞详情:** [CVE-2023-34362](https://nvd.nist.gov/vuln/detail/CVE-2023-34362)