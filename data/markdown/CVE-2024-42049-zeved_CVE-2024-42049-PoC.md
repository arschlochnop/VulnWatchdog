## CVE-2024-42049-TightVNC-控制管道未授权访问

**漏洞编号:** CVE-2024-42049

**漏洞类型:** 权限提升/信息泄露

**影响应用:** TightVNC Server for Windows

**危害等级:** 高危，可能导致敏感信息泄露和未授权控制

**影响版本:** < 2.8.84

**利用条件:** 目标主机运行TightVNC Server，且攻击者可网络访问目标主机的控制管道

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-42049 漏洞存在于 TightVNC Server for Windows 2.8.84 之前的版本中。攻击者可以通过网络连接到控制管道，从而发送未授权的命令。

**有效性评估：**

根据漏洞描述和PoC代码分析，该漏洞利用的有效性较高。漏洞描述明确指出攻击者可以通过网络连接控制管道。PoC代码演示了如何连接到控制管道并发送命令，例如断开所有客户端连接、获取客户端列表、关闭服务器、获取服务器信息和获取配置。PoC代码中包含了解密密码的函数，说明利用该漏洞可以获取到加密的密码并进行解密，进一步控制VNC服务器。

**投毒风险评估：**

PoC代码本身的功能是利用漏洞进行攻击，但代码中也存在一些潜在的投毒风险：
*   **依赖项风险：** PoC代码包含 descrypt.h，这个头文件和对应的加密库可能被替换为恶意版本，执行恶意代码。
*   **整数溢出/格式化字符串漏洞：** 虽然代码未发现明显的漏洞，但在处理用户输入（例如管道名称或偏移量）时，如果未进行充分的验证，可能会存在整数溢出或格式化字符串漏洞，从而导致远程代码执行。当然这些只是理论上的可能性。考虑到这是个人提交的PoC，并非官方代码，存在一定投毒风险是合理的。

综合以上因素，该PoC代码的投毒风险较低，初步判断为5%。主要的风险在于外部库descrypt。如果该库被替换，则可能引入恶意代码。

**利用方式：**

1.  **连接控制管道：** 攻击者需要通过网络连接到 TightVNC 服务器的控制管道。PoC 代码使用 `CreateFile` 函数来打开管道。
2.  **发送命令：** 连接成功后，攻击者可以向控制管道发送各种命令。PoC 代码演示了发送断开所有客户端连接、获取客户端列表、关闭服务器、获取服务器信息和获取配置等命令。具体利用命令参见 `commands` 数组。
3.  **解密密码：** 通过 `TVNC_CMD_GET_CONFIG` 命令可以获取加密的密码，PoC 代码中包含 `decrypt_passwords` 函数来解密这些密码。解密算法为DES，密钥硬编码在 `des_key` 变量中。
4.  **权限提升/控制：** 成功利用此漏洞后，攻击者可以获得对 TightVNC 服务器的控制权，例如关闭服务器、断开所有连接，甚至可以访问和控制受害者的计算机，这取决于服务器配置。

总结：该漏洞利用方式较为直接，通过未授权访问控制管道发送命令，即可控制 VNC 服务器。 PoC 代码已经实现了漏洞利用的关键步骤，降低了利用门槛。

**项目地址:** [zeved/CVE-2024-42049-PoC](https://github.com/zeved/CVE-2024-42049-PoC)

**漏洞详情:** [CVE-2024-42049](https://nvd.nist.gov/vuln/detail/CVE-2024-42049)