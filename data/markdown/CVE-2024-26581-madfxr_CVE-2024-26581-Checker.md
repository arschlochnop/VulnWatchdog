## CVE-2024-26581 - Linux Kernel Netfilter rbtree Use-After-Free

**漏洞编号:** CVE-2024-26581

**漏洞类型:** Use-After-Free

**影响应用:** Linux Kernel

**危害等级:** 高危，可能导致敏感信息泄露、权限提升或任意代码执行

**影响版本:** Linux kernel versions 5.4.262 to 5.4.268, 5.10.190 to 5.10.209, 5.15.124 to 5.15.148, 6.1.43 to 6.1.77, 6.5 to 6.6.16, 6.5 to 6.7.4, 6.5 to 6.7.9, and 6.4.8及以上

**利用条件:** 需要本地用户权限，并启用受影响的Netfilter配置（nftables rbtree）。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-26581是Linux内核Netfilter子系统nft_set_rbtree中的一个使用后释放漏洞。在rbtree的惰性垃圾回收过程中，可能会收集到刚添加的末端间隔元素，导致释放后再次被使用，从而触发UAF。根据搜索引擎结果，已经存在公开的PoC利用代码。

**有效性评估：**
根据搜索结果，PoC代码已经发布，表明漏洞具有一定的可利用性。提供的脚本包含两个文件：
*   `CVE-2024-26581-Manual.sh`：此脚本用于检查目标系统上运行的内核版本是否受漏洞影响，本质上是一个版本检测脚本，不包含漏洞利用代码。
*   `CVE-2024-26581.sh`：此脚本看起来像是漏洞利用脚本的残缺版本。代码不完整,无法直接利用。 
综合来看,该POC存在但不够完整.

**投毒风险分析：**
`CVE-2024-26581-Manual.sh` 脚本本身主要用于版本检测，风险较低。`CVE-2024-26581.sh`的代码不完整，难以直接分析其投毒风险。但从脚本的编写风格来看，存在潜在投毒的可能性，例如，作者可能会在完整版本的漏洞利用代码中，加入恶意命令，在成功利用漏洞后执行，所以脚本存在一定的投毒风险，但考虑到脚本不完整的事实，可以评估为**10%**的投毒风险。

**利用方式分析：**
漏洞利用通常涉及以下步骤：
1.  **触发漏洞：** 通过构造特定的Netfilter规则，触发rbtree的惰性垃圾回收机制，尝试释放刚插入的末端间隔元素。
2.  **释放后使用：** 在释放后，再次访问该元素，导致使用后释放错误。
3.  **控制程序流程：** 利用UAF漏洞，覆盖内存中的关键数据结构，从而控制程序流程，实现权限提升或任意代码执行。

总体而言，此漏洞需要对Netfilter和内核内存管理有深入的了解才能成功利用。利用难度相对较高，但由于具有权限提升或任意代码执行的潜力，因此风险等级为高危。

**项目地址:** [madfxr/CVE-2024-26581-Checker](https://github.com/madfxr/CVE-2024-26581-Checker)

**漏洞详情:** [CVE-2024-26581](https://nvd.nist.gov/vuln/detail/CVE-2024-26581)