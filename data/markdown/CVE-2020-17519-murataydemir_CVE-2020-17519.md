## CVE-2020-17519 - Apache Flink RESTful API 任意文件读取

**漏洞编号:** CVE-2020-17519

**漏洞类型:** 目录遍历

**影响应用:** Apache Flink

**危害等级:** 高危，可能导致敏感信息泄露

**影响版本:** 1.11.0 to 1.11.2

**利用条件:** 需要 Flink JobManager 进程的 REST 接口对外暴露，且攻击者能访问该接口。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2020-17519 漏洞存在于 Apache Flink 1.11.0 到 1.11.2 版本中。该漏洞允许未经身份验证的攻击者通过 JobManager 的 RESTful API 读取 JobManager 进程本地文件系统上的任意文件。漏洞原因是 `JobManagerCustomLogHandler.java` 类中的代码未对用户提供的文件名进行充分的验证和过滤，导致目录遍历漏洞。PoC 中构造了包含 `..%252f` 的恶意请求，绕过路径检查，读取 `/etc/passwd` 文件。修复方法是在获取文件名时，仅取文件名部分，避免目录遍历。

**有效性：** 提供的 PoC 代码有效。多个来源（漏洞库信息、搜索引擎结果和漏洞利用代码）都表明该漏洞是可利用的，并且提供了可用的 PoC。CISA的KEV目录收录了该漏洞,表明该漏洞在野外被利用。

**投毒风险：** 仓库主要包含漏洞描述、受影响的版本、PoC 示例和修复方案说明。没有发现恶意代码，如反弹 shell、下载执行等。漏洞利用代码本身是对漏洞的重现，其目的是证明漏洞的存在。考虑到代码简洁、目标明确、以及缺乏隐藏的恶意行为，投毒风险极低。此仓库中检测到作者隐藏投毒代码的风险小于1%。

**利用方式：** 攻击者通过构造包含目录遍历字符（`..%252f`）的 HTTP GET 请求，发送到 Flink JobManager 的 RESTful API 接口 `/jobmanager/logs/{filename}`。由于服务端未对 `{filename}` 参数进行严格的校验，攻击者可以利用该参数读取 JobManager 进程可访问的任意文件，例如配置文件、系统文件等。攻击需要具备网络可达性。

**项目地址:** [murataydemir/CVE-2020-17519](https://github.com/murataydemir/CVE-2020-17519)

**漏洞详情:** [CVE-2020-17519](https://nvd.nist.gov/vuln/detail/CVE-2020-17519)