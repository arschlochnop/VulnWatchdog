## CVE-2025-24016-Wazuh-RCE

**漏洞编号:** CVE-2025-24016

**漏洞类型:** 反序列化漏洞导致远程代码执行

**影响应用:** Wazuh

**危害等级:** 高危，可导致系统完全控制

**影响版本:** >= 4.4.0, < 4.9.1

**利用条件:** 需要API访问权限（可能是通过受损的Dashboard或集群中的Wazuh服务器），某些配置下可能被受损的Agent利用。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2025-24016 是一个存在于 Wazuh 服务器中的远程代码执行漏洞，由不安全的反序列化引起。攻击者可以利用此漏洞在受影响的 Wazuh 服务器上执行任意代码。

**有效性：**

提供的 POC 代码似乎有效。根据漏洞描述， DistributedAPI 参数以 JSON 格式序列化，并使用 `as_wazuh_object` 反序列化。如果攻击者能够在 DAPI 请求/响应中注入未经消毒的字典，他们可以伪造一个未处理的异常 (`__unhandled_exc__`) 来评估任意 Python 代码。提供的 POC 代码正是利用了这一点，通过 `__unhandled_exc__` 注入 `os.system` 函数，从而执行任意命令。

**投毒风险：**

检查提供的 Python 脚本 `exploit_wazuh.py` 和 `requirements.txt`，没有发现明显的恶意代码或后门。该脚本的功能明确，即利用 Wazuh 的反序列化漏洞执行命令。代码中没有发现任何试图连接外部服务器、收集敏感信息或执行其他可疑操作的迹象。
 `requirements.txt` 文件包含 `requests` 和 `urllib3` 库，这些都是常见的 Python 库，用于发送 HTTP 请求，没有可疑之处. 因此，可以认为该仓库存在投毒代码的风险为 0%。

**利用方式：**

1.  **漏洞点：** `framework/wazuh/core/cluster/common.py` 中的 `as_wazuh_object` 函数在处理 DistributedAPI 参数时存在不安全的反序列化。
2.  **攻击方法：** 攻击者需要首先获得 Wazuh API 的访问权限，这可以通过多种方式实现，例如攻击 Wazuh Dashboard，或者控制集群中的一台 Wazuh 服务器。在某些情况下，甚至受损的 Agent 也可以触发该漏洞。
3.  **利用过程：** 攻击者构造一个包含恶意 `__unhandled_exc__` 键的 JSON 负载，该键的值为一个包含 `__class__` 和 `__args__` 键的字典。`__class__` 键指定要执行的 Python 函数，`__args__` 键指定传递给该函数的参数。在本例中，`__class__` 被设置为 `os.system`，`__args__` 被设置为要执行的命令。
4.  **发送请求：** 攻击者将此恶意负载作为 DAPI 请求发送到 Wazuh 服务器。服务器在反序列化该负载时，会触发 `__unhandled_exc__` 异常，并执行攻击者指定的命令。

总而言之，此漏洞利用的有效性高，攻击难度适中，危害性极大，需要尽快修复。

**项目地址:** [celsius026/poc_CVE-2025-24016](https://github.com/celsius026/poc_CVE-2025-24016)

**漏洞详情:** [CVE-2025-24016](https://nvd.nist.gov/vuln/detail/CVE-2025-24016)