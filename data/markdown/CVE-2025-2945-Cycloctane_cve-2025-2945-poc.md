## CVE-2025-2945-pgAdmin 4-远程代码执行

**漏洞编号:** CVE-2025-2945

**漏洞类型:** 远程代码执行

**影响应用:** pgAdmin 4

**危害等级:** 高危，允许经过身份验证的用户执行任意代码。

**影响版本:** < 9.2 (影响 8.10 - 9.1)

**利用条件:** 需要有效的pgAdmin 4 用户凭据，并且目标pgAdmin 4实例的版本低于9.2

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2025-2945是pgAdmin 4中一个远程代码执行漏洞，存在于 Query Tool 和 Cloud Deployment 模块中。具体来说，漏洞存在于 `/sqleditor/query_tool/download` 端点的 `query_commited` 参数和 `/cloud/deploy` 端点的 `high_availability` 参数。这些参数会被不安全地传递给Python的 `eval()` 函数，导致任意代码执行。根据漏洞库信息，CVSS v3.1评分为9.9，属于严重级别。

**漏洞利用方式：**

1.  **身份验证：** 攻击者首先需要获得pgAdmin 4的有效用户名和密码。POC代码中可以看到，攻击者需要先使用用户名和密码登录到pgAdmin 4。
2.  **获取CSRF Token：** 登录后，攻击者需要获取CSRF token，用于后续的请求。
3.  **查找有效的Server ID：** 攻击者需要找到一个有效的Server ID，用于与数据库建立连接。POC代码中通过循环遍历Server ID，并发送请求来判断其有效性。
4.  **发送恶意请求：** 找到有效的Server ID后，攻击者构造包含恶意代码的请求，发送到 `/sqleditor/query_tool/download`  或 `/cloud/deploy` 端点。恶意代码会被 `eval()` 函数执行，从而实现远程代码执行。

**有效性：**

提供的POC代码是一个独立的Python脚本，旨在利用pgAdmin 4 Query Tool中经过身份验证的RCE漏洞（CVE-2025-2945）。该脚本通过模拟登录过程，获取CSRF token，找到有效服务器ID，并最终发送包含payload的恶意请求来实现远程代码执行。根据搜索结果，存在多个关于此漏洞的描述和PoC，包括Rapid7的Metasploit模块，表明该漏洞利用是有效的。

**投毒风险：**

虽然POC代码主要目标是利用漏洞，但仍然存在一定的投毒风险。代码中存在随机数生成等操作，如果恶意修改这些操作，例如，在payload中增加额外的恶意代码，或者将利用结果发送到指定的服务器，则可能构成投毒。虽然目前的代码看起来比较直接，但不能完全排除作者隐藏恶意代码的可能性。例如，`randint` 函数可能被替换为具有确定性输出的函数，以便在特定条件下执行恶意操作。因此，估计投毒风险为10%。需要进一步的代码审计才能确定是否存在隐藏的恶意行为。

**项目地址:** [Cycloctane/cve-2025-2945-poc](https://github.com/Cycloctane/cve-2025-2945-poc)

**漏洞详情:** [CVE-2025-2945](https://nvd.nist.gov/vuln/detail/CVE-2025-2945)