## CVE-2025-8714-PostgreSQL代码注入

**漏洞编号:** CVE-2025-8714

**漏洞类型:** 代码注入

**影响应用:** PostgreSQL

**危害等级:** 高危，可导致远程代码执行

**影响版本:** PostgreSQL版本低于17.6, 16.10, 15.14, 14.19, 13.22

**利用条件:** 需要目标服务器上存在恶意超级用户，并且攻击者能够访问或控制pg_dump/pg_dumpall的源服务器

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2025-8714漏洞允许PostgreSQL数据库中具有恶意权限的超级用户通过`pg_dump`或`pg_dumpall`命令注入恶意代码。当受害者使用`psql`恢复以纯文本格式导出的数据库备份时，注入的恶意代码将以受害者操作系统用户的身份执行，从而导致远程代码执行。

**有效性：**
提供的POC代码是有效的。它通过以下步骤利用该漏洞：
1.  生成包含反向shell的payload。
2.  启动一个易受攻击的PostgreSQL Docker容器。
3.  通过`psql`命令将payload注入到容器中，模拟使用`pg_dump`创建恶意备份的过程，从而触发反向shell。

**投毒风险：**
虽然POC代码本身实现了漏洞利用，但依旧存在轻微的投毒风险。该风险主要来自于以下几个方面：
1.  **脚本执行环境依赖：** 该POC依赖于Docker环境和Netcat，如果用户没有安装或者配置错误，可能导致脚本执行失败，但不会对系统造成实质性损害。
2.  **脚本中的IP地址替换：**  POC脚本要求用户手动替换攻击者IP地址，如果用户输入错误或者未能替换，可能会导致反向shell连接失败。
3.  **代码审查难度：** 虽然代码比较简洁，但对于不熟悉Bash脚本和PostgreSQL的用户来说，仍然难以完全审查代码逻辑，存在被植入恶意代码的潜在风险。例如, 作者可能在`generate_payload`函数中添加额外的恶意命令，或者在清理阶段执行一些恶意操作。

考虑到以上因素，综合评估投毒风险为10%。

**利用方式：**
1.  攻击者首先需要获得目标PostgreSQL服务器的超级用户权限。
2.  攻击者使用`pg_dump`或`pg_dumpall`命令备份数据库，并在备份内容中注入恶意代码。注入方式是利用PostgreSQL的元命令，这些命令在`psql`恢复备份时会被执行。
3.  攻击者将包含恶意代码的备份文件发送给受害者。
4.  受害者使用`psql`命令恢复备份文件。
5.  `psql`执行备份文件中的恶意代码，导致受害者主机被攻击者控制。

**项目地址:** [orderby99/CVE-2025-8714-POC](https://github.com/orderby99/CVE-2025-8714-POC)

**漏洞详情:** [CVE-2025-8714](https://nvd.nist.gov/vuln/detail/CVE-2025-8714)