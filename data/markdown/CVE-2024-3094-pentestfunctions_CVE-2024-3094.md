## CVE-2024-3094 - XZ Utils供应链后门

**漏洞编号:** CVE-2024-3094

**漏洞类型:** 供应链后门

**影响应用:** XZ Utils

**危害等级:** 极危，允许未经授权的远程SSH访问并可能执行任意代码

**影响版本:** 5.6.0, 5.6.1

**利用条件:** 系统使用受影响的XZ Utils版本，且sshd与liblzma链接。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2024-3094 描述了 XZ Utils 5.6.0 和 5.6.1 版本中发现的恶意代码。该后门通过复杂的混淆手段，在 liblzma 的构建过程中，从伪装的测试文件中提取预构建的目标文件，并用于修改 liblzma 代码中的特定函数。这导致任何链接到该修改后的 liblzma 库的软件都可能受到影响。攻击者可以利用此后门绕过 SSH 身份验证并执行远程代码。

**有效性：**

提供的 `checker.sh` 脚本旨在检测系统是否受到 CVE-2024-3094 的影响。它通过以下步骤进行检查：

1.  **检查 XZ 版本：** 确定系统上安装的 XZ Utils 版本，并判断是否为易受攻击的版本 (5.6.0 或 5.6.1)。
2.  **检查 sshd 二进制文件是否存在：** 确认系统中存在 sshd 服务。
3.  **检查 sshd 是否使用 lzma：** 验证 sshd 是否与 liblzma 库链接。
4.  **检查 lzma 中是否存在特定字节模式：** 在 liblzma 库中搜索后门相关的特定字节模式。

该脚本的有效性在于其能够准确识别系统中是否存在易受攻击的 XZ Utils 版本以及相关的 SSH 配置。

**投毒风险：**

`checker.sh` 脚本本身的投毒风险较低。脚本的主要功能是检测漏洞，而非利用漏洞。但是，任何从互联网上下载并执行的脚本都存在一定的风险。虽然该脚本目前看来是安全的，但未来的版本可能被恶意修改。所以评估为1%。

**利用方式：**

1.  **后门植入：** 恶意代码被嵌入到 XZ Utils 的源代码中，并通过复杂的构建过程注入到 liblzma 库中。
2.  **SSH 劫持：** 被感染的 liblzma 库在 sshd 服务中被使用，允许攻击者在未经授权的情况下访问系统。
3.  **远程代码执行：** 攻击者通过精心构造的数据包发送到受感染的 sshd 服务，从而触发后门，执行任意代码。

简而言之，该漏洞通过供应链攻击，在广泛使用的压缩库中植入后门，从而影响依赖该库的应用程序，特别是 SSH 服务。

**项目地址:** [pentestfunctions/CVE-2024-3094](https://github.com/pentestfunctions/CVE-2024-3094)

**漏洞详情:** [CVE-2024-3094](https://nvd.nist.gov/vuln/detail/CVE-2024-3094)