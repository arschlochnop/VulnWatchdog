## CVE-2024-0012 PAN-OS 身份验证绕过

**漏洞编号:** CVE-2024-0012

**漏洞类型:** 身份验证绕过

**影响应用:** Palo Alto Networks PAN-OS

**危害等级:** 高危，允许未经身份验证的攻击者获得管理员权限

**影响版本:** PAN-OS 10.2, 11.0, 11.1, 和 11.2 (受影响版本详见漏洞库信息)

**利用条件:** 管理 Web 界面可以通过网络访问，特别是来自互联网的访问

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-0012 是 Palo Alto Networks PAN-OS 软件中的一个身份验证绕过漏洞。未经身份验证的攻击者如果能访问管理 Web 界面，就可以获得 PAN-OS 管理员权限，执行管理操作，篡改配置，或者利用其他需要身份验证的提权漏洞（如 CVE-2024-9474）。

**利用方式：**

1.  **身份验证绕过：** 攻击者利用漏洞绕过管理 Web 界面的身份验证机制，无需提供有效的用户名和密码。
2.  **权限提升：** 成功绕过身份验证后，攻击者获得管理员权限。
3.  **恶意操作：** 攻击者可以使用管理员权限执行各种恶意操作，包括：
    *   篡改防火墙配置。
    *   执行任意命令。
    *   利用其他漏洞。

**POC 分析：**

提供的 POC 代码 (`cve-2024-0012-pan-os-poc.py`) 旨在验证漏洞的存在。该 POC 脚本执行以下步骤：

1.  **创建初始会话：** 使用包含命令注入 payload 的 `X-PAN-AUTHCHECK: off` 头发送 POST 请求到 `/php/utils/createRemoteAppwebSession.php/watchTowr.js.map`， 注入的命令将系统信息写入 `/var/appweb/htdocs/unauth/watchTowr.php` 文件。
2.  **触发执行：** 通过包含会话 ID 的 cookie，发送 GET 请求到 `/index.php/.js.map`，触发命令执行。
3.  **验证执行：** 检查 `/unauth/watchTowr.php` 是否存在且包含系统信息，以验证命令是否成功执行。

**投毒风险：**

POC 本身主要用于验证漏洞的存在。该POC 在`/var/appweb/htdocs/unauth/watchTowr.php`下创建了一个php文件，这个文件本身可以被用于后续的攻击.POC中注入的命令是将系统信息写入文件，但是完全可以替换成其他恶意命令.  因此虽然POC本身不是恶意代码, 但在后续使用时存在被滥用的风险。 仓库本身作者隐藏的投毒代码的可能性较低, 为10%.

**有效性：**

根据漏洞信息和 POC 代码，该漏洞是有效的，并且已经被观察到在野外被利用。

**项目地址:** [punitdarji/Paloalto-CVE-2024-0012](https://github.com/punitdarji/Paloalto-CVE-2024-0012)

**漏洞详情:** [CVE-2024-0012](https://nvd.nist.gov/vuln/detail/CVE-2024-0012)