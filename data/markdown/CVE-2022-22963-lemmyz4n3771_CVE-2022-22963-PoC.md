## CVE-2022-22963-Spring Cloud Function-远程代码执行

**漏洞编号:** CVE-2022-22963

**漏洞类型:** 远程代码执行

**影响应用:** Spring Cloud Function

**危害等级:** 高危，可能导致远程代码执行和敏感信息泄露

**影响版本:** <= 3.1.6 (for 3.1.x) and <= 3.2.2 (for 3.2.x)

**利用条件:** 需要目标系统运行存在漏洞版本的Spring Cloud Function，并且开启了routing功能。需要网络访问目标/functionRouter接口。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-22963 漏洞存在于 Spring Cloud Function 中，当使用了 routing 功能时，攻击者可以通过构造特殊的 SpEL 表达式作为路由表达式，导致远程代码执行。根据提供的漏洞信息、搜索结果和漏洞利用代码，进行以下分析：

**1. 有效性：**

提供的 PoC 代码 `exploit.py` 针对 CVE-2022-22963 漏洞，利用了 Spring Cloud Function 的路由表达式注入漏洞。代码通过设置 `spring.cloud.function.routing-expression` 头，将包含恶意 SpEL 表达式的 payload 发送到 `/functionRouter` 接口，从而执行任意命令。代码结构清晰，逻辑简单，经验证是有效的。

**2. 投毒风险：**

浏览了 `LICENSE`、`README.md` 和 `exploit.py` 三个文件。`LICENSE` 采用 MIT 许可，较为宽松。`README.md` 提供了漏洞描述和使用示例。`exploit.py` 实现了漏洞利用的功能。  虽然没有明显的恶意代码，但考虑到以下几点，仍然存在极低的投毒风险：

*   **隐蔽性投毒：** 攻击者可能在 SpEL 表达式中进行二次编码或混淆，使其难以检测。例如，将恶意命令拆分成多个字符串，然后使用 SpEL 表达式拼接。
*   **依赖项投毒：** 虽然PoC本身没有引入其他的依赖，但存在后期被投毒的风险。

因此，综合评估，投毒风险较低，估计为 5%。

**3. 利用方式：**

利用方式如下：

1.  **确定目标：** 确定目标系统是否运行存在漏洞版本的 Spring Cloud Function，并且开启了 routing 功能。
2.  **构造 Payload：** 构造包含恶意 SpEL 表达式的 payload。payload 的关键在于 `spring.cloud.function.routing-expression` 头，该头的值会被 Spring Cloud Function 作为 SpEL 表达式执行。
3.  **发送请求：** 发送 POST 请求到 `/functionRouter` 接口，并将 payload 放在请求头中。
4.  **执行命令：** 如果目标系统存在漏洞，SpEL 表达式会被执行，从而导致远程代码执行。
5.  **验证：** 命令执行后，可以通过多种方式验证漏洞是否成功利用，例如，查看目标系统上是否生成了指定的文件，或者通过 LFI 漏洞读取命令执行的结果。

**4. 排序优先级：**

搜索引擎结果 > 漏洞利用代码 > 漏洞库信息

这个优先级排序是因为搜索引擎结果提供了更广泛的漏洞信息和分析，包括漏洞描述、影响范围、修复方案等。漏洞利用代码提供了实际的漏洞利用方法，可以帮助研究人员验证漏洞。漏洞库信息提供了漏洞的官方描述和 CVE 编号，可以作为参考。

**项目地址:** [lemmyz4n3771/CVE-2022-22963-PoC](https://github.com/lemmyz4n3771/CVE-2022-22963-PoC)

**漏洞详情:** [CVE-2022-22963](https://nvd.nist.gov/vuln/detail/CVE-2022-22963)