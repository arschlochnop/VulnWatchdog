## CVE-2021-29447-WordPress-XXE

**漏洞编号:** CVE-2021-29447

**漏洞类型:** XXE

**影响应用:** WordPress

**危害等级:** 高危，可能导致敏感信息泄露

**影响版本:** >= 5.6.0, < 5.7.1

**利用条件:** 需要PHP 8环境，以及具有上传文件权限的WordPress用户（如Author）

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2021-29447是WordPress 5.6.0到5.7.1版本中的一个XML外部实体注入（XXE）漏洞。攻击者需要具备上传文件的权限，例如Author角色。该漏洞存在于WordPress的媒体库中，当WordPress运行在PHP 8环境下，上传包含恶意XML代码的WAV文件时，由于对XML解析不当，导致XXE攻击。

**漏洞利用方式：**

1.  **权限获取：** 攻击者首先需要获得一个具备文件上传权限的WordPress账户，例如Author角色。
2.  **恶意WAV文件制作：** 攻击者需要创建一个包含恶意XML代码的WAV文件。该XML代码会尝试通过外部实体引用来读取服务器上的文件，或者发起服务器端请求伪造（SSRF）攻击。POC代码中，攻击者构造了一个包含外部实体引用的WAV文件，指向攻击者控制的服务器上的evil.dtd文件。
3.  **攻击者服务器准备：** 攻击者需要搭建一个Web服务器，并创建一个evil.dtd文件，该文件定义了如何处理外部实体引用。evil.dtd文件中定义了读取/etc/passwd文件的操作，并将其内容进行base64编码后发送到攻击者服务器。攻击者使用`php -S 0.0.0.0:80` 命令启动了一个简单的web server。
4.  **上传WAV文件：** 攻击者将包含恶意XML代码的WAV文件上传到WordPress的媒体库。
5.  **触发漏洞：** 当WordPress处理上传的WAV文件时，会解析其中的XML代码，从而触发XXE漏洞。
6.  **数据泄露：** 如果漏洞利用成功，WordPress服务器会尝试从攻击者控制的服务器上下载evil.dtd文件，并执行其中定义的恶意操作，例如读取/etc/passwd文件。/etc/passwd文件的内容（经过base64编码）会通过HTTP请求发送到攻击者的服务器。
7.  **获取敏感信息：** 攻击者从接收到的HTTP请求中提取base64编码的内容，并进行解码，从而获得服务器上的敏感信息，例如/etc/passwd文件中的用户账户信息。

**有效性分析：**

提供的POC代码描述了漏洞的利用步骤，包括制作恶意WAV文件、搭建攻击者服务器、上传文件和获取敏感信息。根据漏洞信息和搜索结果，该POC代码是有效的，可以用于演示和验证该漏洞。

**投毒风险分析：**

POC代码主要包含以下几个部分：

*   Dockerfile 和 docker-compose.yml: 用于搭建 WordPress 环境,相对安全
*   wordpress.sh: 用于安装 wordpress,主要就是配置文件,检查发现没有明显的投毒代码.
*   payload.wav: 恶意WAV文件，包含XXE payload，用于触发漏洞。
*   evil.dtd: 攻击者服务器上的DTD文件，包含读取/etc/passwd文件的操作。这一部分是payload的关键.

虽然整体代码是为了演示XXE漏洞，但evil.dtd文件存在潜在的投毒风险，例如，攻击者可能在evil.dtd文件中包含其他恶意代码，例如反弹shell，用于进一步控制服务器。这种风险相对较低，因为需要特定的环境和配置才能成功利用。此外，dockerfile 中的代码从github获取，需要注意github源是否被篡改。
总体来说，投毒风险较低，但也需要保持警惕，特别是从不可信的来源获取代码时。 我认为存在的风险大概在5%。

**项目地址:** [dnr6419/CVE-2021-29447](https://github.com/dnr6419/CVE-2021-29447)

**漏洞详情:** [CVE-2021-29447](https://nvd.nist.gov/vuln/detail/CVE-2021-29447)