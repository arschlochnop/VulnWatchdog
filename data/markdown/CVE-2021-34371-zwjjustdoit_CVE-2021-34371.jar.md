## CVE-2021-34371-Neo4j-RCE

**漏洞编号:** CVE-2021-34371

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Neo4j

**危害等级:** 高危，可导致服务器完全控制

**影响版本:** <= 3.4.18

**利用条件:** Neo4j shell server 必须启用

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-34371 漏洞存在于 Neo4j 3.4.18 及更早版本中，当 shell server 启用时，攻击者可以通过 RMI 服务发送恶意构造的 Java 对象，利用反序列化漏洞执行任意代码。漏洞利用依赖于存在可利用的 gadget chains。

**有效性：**
根据漏洞信息、搜索结果，该漏洞的存在已被广泛证实。漏洞利用代码的 `README.md` 文件中的图片展示了利用该漏洞的步骤和效果，表明该POC具有一定的有效性，可以触发RCE。

**投毒风险：**
POC代码本身来源于 `vulhub/vulhub` 仓库，该仓库通常用于漏洞复现，信誉较高，恶意投毒的可能性较低。但是，任何第三方提供的代码都存在潜在的风险，在未完全审计代码之前，直接运行存在一定风险。通过分析 `README.md` 文件内容，仅包含漏洞信息、利用过程截图。 因此投毒风险不能排除，但是概率较低。 故评估投毒风险为10%。

**利用方式：**
1.  确认目标 Neo4j 实例启用了 shell server。
2.  利用 RMI 协议，通过 `setSessionVariable` 等方法，向目标服务器发送恶意构造的 Java 对象。
3.  该 Java 对象包含一个 gadget chain，当服务器反序列化该对象时，gadget chain 会被触发，从而执行攻击者预设的任意代码。

**项目地址:** [zwjjustdoit/CVE-2021-34371.jar](https://github.com/zwjjustdoit/CVE-2021-34371.jar)

**漏洞详情:** [CVE-2021-34371](https://nvd.nist.gov/vuln/detail/CVE-2021-34371)