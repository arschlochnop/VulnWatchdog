## CVE-2018-13379 - Fortinet FortiOS/FortiProxy 路径遍历漏洞

**漏洞编号:** CVE-2018-13379

**漏洞类型:** 路径遍历

**影响应用:** Fortinet FortiOS, FortiProxy

**危害等级:** 高危，可能导致敏感信息泄露

**影响版本:** FortiOS 6.0.0 to 6.0.4, 5.6.3 to 5.6.7 and 5.4.6 to 5.4.12, FortiProxy 2.0.0, 1.2.0 to 1.2.8, 1.1.0 to 1.1.6, 1.0.0 to 1.0.7

**利用条件:** 需要开启SSL VPN web portal且存在漏洞版本的FortiOS/FortiProxy实例

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2018-13379 是 Fortinet FortiOS 和 FortiProxy 中的一个路径遍历漏洞。未经验证的攻击者可以通过构造特制的 HTTP 请求，利用 SSL VPN web portal 下载系统文件。根据提供的漏洞利用代码，该工具 `at-doom-fortigate`  旨在通过 Tor 网络匿名扫描 Rapid7 Project Sonar 数据中易受攻击的 Fortigate 主机。它首先检查是否已连接到 Tor 网络，然后使用 Rapid7 的数据查找暴露在 10443 端口上的 Fortigate 设备。漏洞利用方式为构造恶意的 URL，利用路径遍历漏洞读取目标系统上的文件。 

**有效性评估：**
根据漏洞库信息和搜索结果，此漏洞已经存在多年，并且有公开的利用代码，因此该POC代码在理论上是有效的，但实际利用可能需要根据目标环境进行调整。

**投毒风险分析：**
代码的功能主要是扫描和检测漏洞，并通过Tor网络进行匿名操作。从代码本身来看，没有明显的恶意行为或后门代码。主要的风险在于:
1. **依赖项风险:**  项目依赖于第三方库，例如 `github.com/rs/zerolog` 和 `github.com/tidwall/gjson`。这些库本身如果存在安全问题，可能会影响到扫描工具的安全性。
2. **数据源风险:** 工具依赖于 Rapid7 的 Sonar 数据。如果 Rapid7 的数据被篡改或者包含恶意信息，可能会导致工具的行为异常。
3. **Tor网络风险:**  虽然 Tor 可以提供匿名性，但也可能被用于恶意目的。使用 Tor 可能会增加被追踪的难度，但不能完全保证安全性。

综合来看，该仓库存在投毒代码的可能性较低，大约为10%。主要风险来自于依赖库和数据源的安全。

**利用方式总结：**
1.  使用工具 `at-doom-fortigate` 通过 Tor 网络匿名扫描 Fortigate 设备。
2.  该工具依赖于 Rapid7 Project Sonar 数据，需要下载并配置相关数据文件。
3.  工具会尝试利用 CVE-2018-13379 漏洞，通过构造包含路径遍历的 HTTP 请求来读取 Fortigate 设备的敏感文件，比如 VPN 证书或用户凭据。

**项目地址:** [jpiechowka/at-doom-fortigate](https://github.com/jpiechowka/at-doom-fortigate)

**漏洞详情:** [CVE-2018-13379](https://nvd.nist.gov/vuln/detail/CVE-2018-13379)