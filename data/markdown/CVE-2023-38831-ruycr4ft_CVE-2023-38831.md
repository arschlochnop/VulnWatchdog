## CVE-2023-38831-WinRAR远程代码执行

**漏洞编号:** CVE-2023-38831

**漏洞类型:** 远程代码执行

**影响应用:** WinRAR

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** < 6.23

**利用条件:** 用户需要使用WinRAR打开特制的恶意ZIP压缩包

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-38831是一个存在于WinRAR 6.23之前版本中的远程代码执行漏洞。该漏洞源于WinRAR在处理ZIP压缩包时，对文件名和文件夹名相同的情况处理不当。攻击者可以构造一个恶意的ZIP压缩包，其中包含一个看似无害的文件（例如.jpg），同时包含一个同名的文件夹。当用户尝试打开该“无害文件”时，WinRAR会错误地执行同名文件夹中的恶意代码。\n\n**有效性：** 根据漏洞信息、搜索结果以及提供的POC代码，该漏洞利用是有效的。多个来源都表明该漏洞已被广泛利用，POC代码也展示了如何生成包含恶意代码的RAR压缩文件。POC代码通过创建同名文件和文件夹，并在文件夹中放入恶意脚本，利用WinRAR的缺陷触发代码执行。\n\n**投毒风险：**  仓库的投毒风险较低，大概10%。
  *   `poc.py`: 该脚本的功能是生成利用 CVE-2023-38831 的恶意 RAR 文件。虽然它允许用户指定 bait 文件和脚本文件，但脚本本身不包含任何预设的、隐藏的恶意行为。
  *   `script.bat`:  这个批处理文件包含使用 `nc.exe` (netcat) 反弹 shell 的命令。**这里存在一定的投毒风险。** 批处理文件明确地使用了`192.168.0.107`这个IP地址,如果用户直接使用该IP反弹shell,将会连接到攻击者的服务器。虽然IP地址可以被用户更改，但在默认情况下，如果用户不修改，将会连接到攻击者的IP。这是主要的投毒点。
  *   README.md: 该文件仅包含漏洞的简单介绍和演示图片。没有发现恶意代码。

**利用方式：**\n1.  攻击者创建一个恶意的ZIP压缩包。该压缩包包含一个诱饵文件（例如图片.jpg）和一个与其同名的文件夹（例如图片.jpg）。\n2.  攻击者将恶意代码（例如一个批处理脚本或可执行文件）放入同名文件夹中。\n3.  攻击者将包含恶意代码的ZIP压缩包发送给受害者。\n4.  受害者使用存在漏洞的WinRAR版本打开该ZIP压缩包，并尝试打开诱饵文件。\n5.  WinRAR错误地执行同名文件夹中的恶意代码，导致远程代码执行。

**项目地址:** [ruycr4ft/CVE-2023-38831](https://github.com/ruycr4ft/CVE-2023-38831)

**漏洞详情:** [CVE-2023-38831](https://nvd.nist.gov/vuln/detail/CVE-2023-38831)