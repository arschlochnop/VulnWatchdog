## CVE-2024-2887-Google Chrome-WebAssembly类型混淆

**漏洞编号:** CVE-2024-2887

**漏洞类型:** 类型混淆

**影响应用:** Google Chrome

**危害等级:** 高危，允许远程攻击者通过精心设计的HTML页面执行任意代码

**影响版本:** < 123.0.6312.86

**利用条件:** 需要用户使用受影响版本的Chrome浏览器访问恶意页面

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-2887 是 Google Chrome 中 WebAssembly 引擎中的一个类型混淆漏洞。攻击者可以利用此漏洞，通过构造恶意的 HTML 页面，在用户不知情的情况下执行任意代码。

**有效性：**

提供的 Python 脚本 `test_wasm_exploit.py` 是一个模糊测试工具，用于查找触发此类型混淆漏洞的 WebAssembly 模块大小阈值。它通过以下步骤工作：

1.  **生成 .wat 文件：** 脚本生成一个包含大量结构体定义的 WebAssembly 文本格式文件 (`.wat`)。结构体的数量由 `N` 参数控制，该参数在指定的范围内迭代。
2.  **wat2wasm：** 使用 `wat2wasm` 工具将 `.wat` 文件编译成 WebAssembly 二进制格式文件 (`.wasm`)。
3.  **创建 JS Harness：** 创建一个 JavaScript 文件 (`run.js`)，用于加载和实例化编译后的 WebAssembly 模块。JavaScript 代码调用导出的 `run` 函数，并捕获任何异常。
4.  **Invoke d8：** 使用 V8 的 `d8` 引擎运行 JavaScript 代码，同时启用实验性的 WebAssembly 垃圾回收功能 (`--experimental-wasm-gc`)。`d8` 引擎尝试运行生成的 WebAssembly 代码。
5.  **结果判断：** 脚本检查 `d8` 的输出。如果 `d8` 崩溃或抛出异常（指示漏洞已触发），脚本会报告“SUCCESS: crash/bug”并退出。如果 `d8` 成功运行，脚本会报告“FAIL: no bug”并继续测试下一个 `N` 值。

该脚本通过增加 WebAssembly 模块中结构体的数量，来触发 WebAssembly 引擎中的类型混淆漏洞。当结构体的数量达到某个阈值时，引擎可能会错误地处理类型信息，导致崩溃或允许执行任意代码。脚本的目的在于找到这个阈值。

根据ZDI博客（[webpage 0]）描述,此漏洞在Pwn2Own比赛中被成功利用。因此，可以认为POC是有效的。

**投毒风险：**

分析 `test_wasm_exploit.py` 脚本，没有发现任何明显的恶意代码或后门。该脚本的主要目的是生成 WebAssembly 模块并尝试触发类型混淆漏洞。脚本依赖于 `wat2wasm` 和 `d8` 工具，这些工具本身可能会存在安全风险，但脚本本身并没有主动引入任何投毒代码。 投毒风险评估为0%。

**利用方式：**

1.  **攻击者构造恶意的 HTML 页面，其中包含利用此漏洞的 WebAssembly 代码。**
2.  **当用户使用受影响版本的 Chrome 浏览器访问该页面时，WebAssembly 代码会被加载和执行。**
3.  **由于类型混淆漏洞，攻击者可以控制程序的执行流程，从而执行任意代码。**
4.  **攻击者可以利用此漏洞获取用户的敏感信息、安装恶意软件或执行其他恶意操作。**

漏洞的根本原因是 WebAssembly 引擎在处理类型信息时存在错误。攻击者可以利用此错误，使引擎将一种类型的数据误认为另一种类型，从而导致类型混淆。

根据CISA ADP Vulnrichment, CVSS v3.1 评分为 8.1，攻击向量为 LOCAL，但用户交互为 NONE 意味着攻击无需任何用户交互。 这似乎存在矛盾，需要进一步分析。


**项目地址:** [jjyuorg/reproduce-cve-2024-2887](https://github.com/jjyuorg/reproduce-cve-2024-2887)

**漏洞详情:** [CVE-2024-2887](https://nvd.nist.gov/vuln/detail/CVE-2024-2887)