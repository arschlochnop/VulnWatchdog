## CVE-2021-22986 - F5 BIG-IP/BIG-IQ iControl REST API 远程命令执行

**漏洞编号:** CVE-2021-22986

**漏洞类型:** 远程命令执行 (RCE)

**影响应用:** F5 BIG-IP/BIG-IQ

**危害等级:** 高危，可能导致完全控制系统

**影响版本:** BIG-IP 16.0.x before 16.0.1.1, 15.1.x before 15.1.2.1, 14.1.x before 14.1.4, 13.1.x before 13.1.3.6, 12.1.x before 12.1.5.3; BIG-IQ 7.1.0.x before 7.1.0.3, 7.0.0.x before 7.0.0.2

**利用条件:** 目标系统存在漏洞版本的 F5 BIG-IP/BIG-IQ 且 iControl REST 接口开放

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2021-22986 漏洞存在于 F5 BIG-IP 和 BIG-IQ 设备的 iControl REST 接口中，允许未经身份验证的远程攻击者执行任意命令。

**漏洞利用方式：**

1.  **获取 Token (Method 1):**  首先，POC尝试利用 `/mgmt/shared/authn/login` 接口泄漏认证 Token。它发送一个包含特定 `username` 和 `loginReference` 的 POST 请求，期望服务器返回一个有效的 Token。
2.  **执行命令:**  如果成功获取 Token，则使用该 Token 在 `/mgmt/tm/util/bash` 接口上执行命令。它构造一个包含 `command: run` 和 `utilCmdArgs` 的 JSON 数据，并将要执行的命令嵌入到 `utilCmdArgs` 中。
3. **另一种方式 (Method 2):** 如果无法通过Method 1获取Token,POC会尝试使用硬编码的Authorization头 'Authorization': 'Basic YWRtaW46QVNhc1M=' 结合X-F5-Auth-Token为空的方式，尝试在 `/mgmt/tm/util/bash` 接口上执行命令。

**有效性：**

根据漏洞描述、搜索结果（特别是 NCC Group 的报告指出无需 SSRF 即可利用）以及提供的 PoC 代码，该漏洞利用的有效性很高。存在多个公开的 PoC，并且该漏洞已被积极利用。

**投毒风险：**

该PoC主要功能为漏洞验证和利用，未发现明显的恶意行为。`README.md` 文件仅包含基本的使用说明。代码结构清晰，主要操作为发送 HTTP 请求和处理响应。该POC代码中的投毒风险较低，为1%。考虑到公开的 PoC 旨在利用漏洞，而非进行恶意活动，因此投毒的可能性较小。硬编码的Basic认证 `admin:ASasS=`也比较常见。

**总结：**

CVE-2021-22986 是一个严重的安全漏洞，允许未经身份验证的攻击者在 F5 BIG-IP 和 BIG-IQ 设备上执行任意命令。提供的 PoC 代码通过两种方式，首先是尝试泄漏Token，如果失败则尝试通过Basic认证结合X-F5-Auth-Token为空的方式，利用 `/mgmt/tm/util/bash` 接口执行命令。
根据现有信息，该漏洞利用的有效性很高，并且该漏洞在野外已被利用。PoC代码本身似乎没有明显的投毒行为，但使用者应始终注意从不受信任的来源获取代码的风险。

**项目地址:** [microvorld/CVE-2021-22986](https://github.com/microvorld/CVE-2021-22986)

**漏洞详情:** [CVE-2021-22986](https://nvd.nist.gov/vuln/detail/CVE-2021-22986)