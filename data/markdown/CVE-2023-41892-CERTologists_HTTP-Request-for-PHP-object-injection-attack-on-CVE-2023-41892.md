## CVE-2023-41892-Craft CMS-远程代码执行

**漏洞编号:** CVE-2023-41892

**漏洞类型:** 远程代码执行

**影响应用:** Craft CMS

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** <= 4.4.14

**利用条件:** 需要网络访问，目标服务器运行Craft CMS且版本在受影响范围内

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-41892是Craft CMS中的一个远程代码执行漏洞。根据漏洞库信息和搜索结果，该漏洞影响Craft CMS 4.4.14及更早版本。攻击者可以通过发送特制的请求，利用PHP反序列化漏洞执行任意代码。

**有效性：**
提供的POC代码模拟了一个利用PHP对象注入漏洞的场景。它首先定义了一个`SafeOperation`类，该类包含一个魔术方法`__destruct`，该方法在对象被销毁时触发。通过控制`logMessage`属性，可以调用`logExampleMessage`方法。POC代码接收一个包含序列化对象的`config`参数，并使用`unserialize`函数反序列化该对象。如果可以控制反序列化的内容，则可以触发任意代码执行。

**投毒风险：**
提供的代码主要用于展示PHP反序列化漏洞，本身没有明显的恶意行为，但也不排除隐藏的风险。`The request`文件中的`unserialize`操作是高危点，如果攻击者能够控制反序列化的字符串内容，则可以利用该点执行任意代码。`Readme`文件中的缓解策略，也说明了unserialize的风险，但具体是否存在后门要取决于部署环境和是否有其他依赖组件被引入。 因此投毒风险评估为10%,风险主要来自于使用者对漏洞理解不透彻，直接将后门代码引入。

**利用方式：**
1.  攻击者构造一个包含恶意类的序列化字符串。
2.  将该序列化字符串作为`config`参数的值发送给目标服务器。
3.  目标服务器使用`unserialize`函数反序列化该字符串。
4.  如果反序列化成功，且恶意类中包含魔术方法（如`__destruct`），则该方法将被自动调用。
5.  攻击者可以在魔术方法中执行任意代码，从而实现远程代码执行。

**项目地址:** [CERTologists/HTTP-Request-for-PHP-object-injection-attack-on-CVE-2023-41892](https://github.com/CERTologists/HTTP-Request-for-PHP-object-injection-attack-on-CVE-2023-41892)

**漏洞详情:** [CVE-2023-41892](https://nvd.nist.gov/vuln/detail/CVE-2023-41892)