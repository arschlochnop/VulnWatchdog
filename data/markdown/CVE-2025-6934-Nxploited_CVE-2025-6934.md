## CVE-2025-6934-Opal Estate Pro-权限提升

**漏洞编号:** CVE-2025-6934

**漏洞类型:** 权限提升

**影响应用:** Opal Estate Pro

**危害等级:** 高危，允许未认证的攻击者创建管理员账户

**影响版本:** <= 1.7.5

**利用条件:** 目标网站安装并启用了Opal Estate Pro插件，且版本小于等于1.7.5

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2025-6934是Opal Estate Pro WordPress插件中的一个权限提升漏洞。该漏洞源于在`on_regiser_user`函数中缺乏角色限制。未经身份验证的攻击者可以通过注册用户时选择任意角色（包括管理员角色）来利用此漏洞。 

**有效性评估：**
提供的PoC代码利用了此漏洞，通过发送带有`role=administrator`的POST请求到`/wp-admin/admin-ajax.php`，并调用`opalestate_register_form` action，来创建一个新的管理员用户。

PoC脚本首先检查插件版本，然后尝试从页面获取nonce，构造包含用户名、邮箱、密码、角色（设置为administrator）和nonce的POST请求，发送到WordPress的`admin-ajax.php`处理程序。如果成功，将会创建一个新的管理员用户。

根据漏洞描述和PoC代码的功能，可以判断该PoC代码是有效的。

**投毒风险评估：**
PoC代码本身的主要功能是利用漏洞创建管理员用户。但存在一些潜在的投毒风险：

*   **邮箱地址：** PoC需要攻击者提供邮箱地址来注册管理员。如果攻击者使用了恶意或者钓鱼的邮箱，可能会在之后利用该邮箱进行其他攻击。
*   **后门植入:** 检查代码没有发现明显的后门植入,但是通过license发现作者留下了自己的版权信息，且作者的github地址可以在代码中找到,这提高了代码的可信度，降低了直接投毒的可能性。 

考虑到这些潜在风险，投毒风险评估为5%。主要是利用社工或者密码复用扩大战果的可能性，代码本身直接投毒概率较低。

**利用方式分析：**
1.  **检查插件版本:** 通过访问`/wp-content/plugins/opal-estate-pro/readme.txt`获取插件版本，确认目标是否受漏洞影响。
2.  **获取Nonce:** 访问目标网站首页，解析HTML，提取`opalestate-register-nonce`字段的值。这个nonce值用于绕过注册表单的CSRF保护。
3.  **构造Payload:** 构造一个POST请求，包含以下参数：
    *   `username`: 新管理员用户名
    *   `email`: 新管理员邮箱
    *   `password`: 新管理员密码
    *   `password1`: 确认密码
    *   `role`: `administrator`
    *   `confirmed_register`: `on`
    *   `opalestate-register-nonce`: 前面获取的nonce值
    *   `_wp_http_referer`: `/`
    *   `ajax`: `1`
    *   `action`: `opalestate_register_form`
4.  **发送请求:** 将构造的POST请求发送到`/wp-admin/admin-ajax.php`。
5.  **验证结果:** 如果请求成功，并且返回的JSON数据中`status`为`true`，则表示管理员用户创建成功。

**项目地址:** [Nxploited/CVE-2025-6934](https://github.com/Nxploited/CVE-2025-6934)

**漏洞详情:** [CVE-2025-6934](https://nvd.nist.gov/vuln/detail/CVE-2025-6934)