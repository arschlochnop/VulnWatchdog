## CVE-2024-21626-runc容器逃逸

**漏洞编号:** CVE-2024-21626

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可能导致宿主机权限泄露和完全控制

**影响版本:** >=v1.0.0-rc93, < 1.1.12

**利用条件:** 需要受影响版本的runc，以及docker环境

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-21626是一个runc容器逃逸漏洞，攻击者可以利用该漏洞从容器内部访问甚至控制宿主机文件系统。

**漏洞利用方式：**

该漏洞源于runc在处理容器工作目录时存在缺陷。攻击者可以通过以下两种方式利用该漏洞：

1.  **runc exec:** 当使用`runc exec`命令在容器中执行新进程时，如果攻击者能够控制进程的工作目录（cwd），可以将其设置为宿主机的文件系统路径。通过泄露的文件描述符(`/proc/self/fd/`)访问宿主机的文件系统，从而逃逸容器。
2.  **恶意镜像:** 攻击者可以构建一个恶意的Docker镜像，该镜像在容器启动时将工作目录设置为宿主机的文件系统路径，使得容器内的进程能够访问和操作宿主机的文件系统。

根据漏洞利用代码，POC通过docker-compose启动多个容器，并尝试使用不同的文件描述符作为容器的工作目录，最终通过读取宿主机的`/etc/passwd`文件来验证漏洞是否存在。POC代码中使用了`/proc/self/fd/`的方式，这意味着它试图利用容器内部的文件描述符来访问宿主机的文件系统。

**投毒风险分析：**

该POC相对简单，主要目标是验证漏洞的存在。其中docker-compose.yml创建了多个容器，分别尝试不同的/proc/self/fd/值，增加了成功率。由于只是简单的文件读取，不存在明显的恶意代码。但是，仍需谨慎对待任何来自外部的POC代码。

*   **潜在风险:** 虽然代码主要目的是读取`/etc/passwd`，但理论上成功利用后，攻击者可以在宿主机上执行任意操作。如果攻击者在其他文件中加入恶意命令，存在潜在风险。

**结论:**

综合来看，该POC的投毒风险较低（约5%），主要风险在于成功利用漏洞后可能产生的潜在危害。使用者应该在隔离的环境中测试POC，并仔细检查代码是否存在恶意行为。

**项目地址:** [cdxiaodong/CVE-2024-21626](https://github.com/cdxiaodong/CVE-2024-21626)

**漏洞详情:** [CVE-2024-21626](https://nvd.nist.gov/vuln/detail/CVE-2024-21626)