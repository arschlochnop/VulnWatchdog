## CVE-2022-26134-Confluence-OGNL注入

**漏洞编号:** CVE-2022-26134

**漏洞类型:** OGNL注入

**影响应用:** Atlassian Confluence Server/Data Center

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 1.3.0 < version < 7.4.17, 7.13.0 < version < 7.13.7, 7.14.0 < version < 7.14.3, 7.15.0 < version < 7.15.2, 7.16.0 < version < 7.16.4, 7.17.0 < version < 7.17.4, 7.18.0 < version < 7.18.1

**利用条件:** 目标Confluence实例存在漏洞且网络可达

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-26134是一个存在于Atlassian Confluence Server和Data Center中的OGNL注入漏洞。未经身份验证的攻击者可以通过发送特制的请求到目标服务器，利用该漏洞执行任意代码。漏洞的根本原因是Confluence在处理用户输入时，未对OGNL表达式进行充分的验证和过滤，导致攻击者可以注入恶意的OGNL表达式，从而执行任意代码。从漏洞库信息来看，该漏洞影响多个版本的Confluence Server和Data Center。搜索引擎结果显示，该漏洞已被广泛利用，并被用于恶意挖矿等活动。漏洞利用代码（POC）提供了一个Python脚本，该脚本通过构造包含恶意OGNL表达式的HTTP请求，来利用该漏洞。该脚本首先尝试获取目标Confluence实例的版本信息，然后构造并发送包含恶意OGNL表达式的HTTP请求。如果目标服务器存在漏洞，该请求将导致目标服务器执行任意代码，并将结果返回给攻击者。脚本使用`requests`库发送HTTP请求，使用`BeautifulSoup`库解析HTML响应。POC代码本身相对简单，但由于OGNL表达式的强大功能，攻击者可以利用它执行各种恶意操作，包括读取敏感文件、执行系统命令和安装恶意软件。投毒风险分析：POC代码主体功能明确，主要功能是发送包含OGNL表达式的请求，没有发现明显的后门代码。但是，存在轻微的投毒风险：攻击者可以修改`command`变量，注入恶意的系统命令，从而将恶意软件安装到目标服务器上。例如，攻击者可以将`command`变量设置为下载和执行恶意脚本的命令。由于POC本身具备远程代码执行能力，添加恶意命令会进一步扩大攻击范围。因此，评判投毒风险为10%。利用方式总结：

1.  **确定目标：** 攻击者首先需要确定目标Confluence实例，并确认其版本是否在受影响的范围内。
2.  **构造Payload：** 攻击者需要构造包含恶意OGNL表达式的Payload。Payload的具体内容取决于攻击者的目的，例如，读取`/etc/passwd`文件或执行系统命令。
3.  **发送请求：** 攻击者需要将构造好的Payload嵌入到HTTP请求中，并发送到目标Confluence实例。根据POC代码，Payload可以作为URL的一部分发送。
4.  **执行代码：** 如果目标服务器存在漏洞，且Payload构造正确，目标服务器将执行Payload中包含的恶意代码。
5.  **获取结果：** 攻击者可以通过查看HTTP响应头或服务器日志来获取执行结果。

**项目地址:** [b4dboy17/CVE-2022-26134](https://github.com/b4dboy17/CVE-2022-26134)

**漏洞详情:** [CVE-2022-26134](https://nvd.nist.gov/vuln/detail/CVE-2022-26134)