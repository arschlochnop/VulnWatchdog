## CVE-2023-32315 - Openfire Authentication Bypass

**漏洞编号:** CVE-2023-32315

**漏洞类型:** 身份认证绕过 / 路径遍历

**影响应用:** Openfire

**危害等级:** 高危，允许未经授权访问管理控制台，可能导致敏感信息泄露和控制服务器

**影响版本:** 3.10.0 <= Openfire < 4.6.8, 4.7.0 <= Openfire < 4.7.5

**利用条件:** 目标系统运行受影响版本的Openfire，并且攻击者可以访问Openfire的Web管理界面(通常是9090端口)。需要目标服务器未完成初始化配置。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2023-32315 是一个 Openfire 的身份验证绕过漏洞，利用了路径遍历。攻击者可以利用此漏洞绕过身份验证，访问 Openfire 的管理控制台。\n\n**漏洞利用方式：**\n\n1.  **路径遍历：** 漏洞的根本原因是由于 Openfire 的安装设置页面存在路径遍历漏洞。攻击者可以构造特殊的 URL，例如`/setup/setup-s/%u002e%u002e/%u002e%u002e/log.jsp`，绕过身份验证检查，访问受限资源。其中`%u002e%u002e` 是 `..` 的 URL 编码，用于进行目录跳转。通过访问`log.jsp` 页面可以判断漏洞是否存在。\n2.  **创建管理员用户：** 利用路径遍历访问`user-create.jsp`页面，并结合一个有效的csrf token, 可以在无需认证的情况下创建新的管理员用户。 通过创建的管理员用户可以完全控制Openfire服务器。\n\n**POC 代码分析：**\n\n提供的 POC 代码 (Python) 演示了如何利用此漏洞。其步骤如下：\n\n1.  **获取 csrf token:** 访问`login.jsp`页面，从cookie中获取csrf token。\n2.  **构造 EXP URL：**  构造包含路径遍历的 URL，指向 `user-create.jsp` 页面，并附带创建管理员用户的必要参数，包括用户名、密码等。 URL 形式如: `{url}/setup/setup-s/%u002e%u002e/%u002e%u002e/user-create.jsp?csrf={csrf_cookie}&username=admin4&name=admin4&email=admin4%40123.com&password=1234567&passwordConfirm=1234567&isadmin=on&create=%E5%88%9B%E5%BB%BA%E7%94%A8%E6%88%B7`。\n3.  **发送请求：** 使用 `HackRequests` 库发送构造的 URL 请求，创建新的管理员用户。\n\n**投毒风险分析：**\n\n对提供的代码进行了分析，并未发现任何明显的投毒代码。POC 代码的功能是利用漏洞创建管理员用户，所有操作均是为了验证漏洞的存在和利用，不存在植入后门或者恶意代码的行为。但是，请务必在非生产环境中使用此 POC，避免对实际系统造成损害。如果利用成功，攻击者可以通过新创建的管理员帐户完全控制 Openfire 服务器。

**项目地址:** [5rGJ5aCh5oCq5YW9/CVE-2023-32315exp](https://github.com/5rGJ5aCh5oCq5YW9/CVE-2023-32315exp)

**漏洞详情:** [CVE-2023-32315](https://nvd.nist.gov/vuln/detail/CVE-2023-32315)