## CVE-2025-26529-Moodle-Stored XSS to RCE

**漏洞编号:** CVE-2025-26529

**漏洞类型:** Stored XSS

**影响应用:** Moodle

**危害等级:** 高危，可能导致敏感信息泄露和远程代码执行

**影响版本:** 4.5.0 to 4.5.1, 4.4.0 to 4.4.5, 4.3.0 to 4.3.9, 4.1.0 to 4.1.15

**利用条件:** 需要具有向管理日志写入描述信息权限的用户，以及管理员用户访问管理日志。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2025-26529 是 Moodle 中的一个存储型 XSS 漏洞，存在于站点管理实时日志的功能中。未经充分净化的描述信息会导致 XSS 风险。攻击者可以通过向管理日志中注入恶意 JavaScript 代码，当管理员访问该日志时，恶意代码会被执行，从而窃取管理员的 Cookie，最终利用 Cookie 提权并上传 webshell 实现远程代码执行。

**有效性：**
根据漏洞信息和提供的 PoC 代码，此漏洞利用的有效性较高。PoC 代码中明确指出在 Moodle 4.4.5 版本上测试通过，并且提供了详细的利用步骤和视频演示。

**投毒风险：**
分析 PoC 代码 `console.py`，主要功能是提供一个交互式控制台，用于在 Moodle 服务器上执行命令和下载文件。它依赖于一个名为 `moodle_webshell` 的插件。PoC本身看起来是为了简化利用过程，并没有明显的投毒代码。但是，该PoC仓库中包含的`moodle_webshell` 插件可能存在后门风险，或者被人恶意替换，由于无法获取`moodle_webshell`插件的代码，因此无法准确评估投毒风险。风险评估为10%是基于如下事实：
*PoC作者感谢了p0dalirius, 说明`moodle_webshell`并非PoC作者原创，可能存在未知风险。
*console.py 通过 POST 请求与webshell交互，如果webshell被篡改，可能导致恶意代码执行。

**利用方式：**
1.  **SSRF to XSS:** 首先，通过某种方式（PoC未明确说明，可能需要结合其他漏洞或功能）触发服务端请求伪造 (SSRF)。
2.  **Stored XSS:**  利用 SSRF 将包含恶意 JavaScript 代码的描述信息写入 Moodle 的管理日志。恶意代码的目的通常是窃取管理员的 Cookie。
3.  **Admin Cookie Theft:** 当管理员访问包含恶意代码的管理日志时，恶意 JavaScript 代码会在管理员的浏览器中执行，窃取管理员的 Cookie。
4.  **RCE via Webshell:** 使用窃取的管理员 Cookie 登录 Moodle 后台，然后上传并利用 `moodle_webshell` 插件执行任意命令，从而实现远程代码执行 (RCE)。`console.py` 脚本用于与上传的 webshell 交互。

请注意，此漏洞利用过程依赖于 `moodle_webshell` 插件，该插件并非 Moodle 官方组件，其安全性无法保证。

**项目地址:** [Astroo18/PoC-CVE-2025-26529](https://github.com/Astroo18/PoC-CVE-2025-26529)

**漏洞详情:** [CVE-2025-26529](https://nvd.nist.gov/vuln/detail/CVE-2025-26529)