## CVE-2021-43798 - Grafana Directory Traversal

**漏洞编号:** CVE-2021-43798

**漏洞类型:** 目录遍历

**影响应用:** Grafana

**危害等级:** 高危，允许未经授权的本地文件读取

**影响版本:** 8.0.0-beta1 to 8.3.0 (除已修复版本外)

**利用条件:** 需要Grafana实例运行且版本在受影响范围内，无需身份验证

**POC 可用性:** 是

**投毒风险:** 20%

## 详情

CVE-2021-43798是一个Grafana中的目录遍历漏洞。通过构造包含目录遍历序列（如`../`）的URL，攻击者可以读取Grafana服务器上的任意文件。漏洞存在于`/public/plugins/<plugin ID>/`路径下，`<plugin ID>`为已安装插件的ID。 

**有效性：**
根据漏洞库信息和搜索结果，该漏洞是有效的。存在多个公开的PoC代码，可以成功利用该漏洞读取文件。

**投毒风险：**
提供的PoC代码包含`Pipfile`、`Pipfile.lock`、`README.md`、`google-dorks.txt`和`main.py`。`README.md`描述了漏洞信息、使用方法和参考链接，`google-dorks.txt`包含用于在搜索引擎上查找易受攻击实例的dork。`main.py`是利用漏洞的主要脚本。虽然`main.py`的核心功能是利用目录遍历漏洞，但存在一定的投毒风险：

*   **依赖项：** `Pipfile`声明了`requests`依赖，攻击者可能通过控制pypi镜像源植入恶意依赖，但默认的pypi源风险较低。
*   **IP范围扫描和目标列表：** 该PoC支持通过IP范围扫描或目标列表进行漏洞利用。这可能被用于大规模扫描，从而增加被恶意利用的可能性。
*   **法律声明：** `README.md`中包含了免责声明，但这并不能完全排除恶意使用的可能性。
*   **gif图片:** readme文件里面存在引用外部gif图片，如果图片被替换，可能存在引诱用户下载恶意文件的风险

综合评估，该PoC存在一定的投毒风险，主要集中在潜在的恶意依赖项、大规模扫描利用以及外部资源引用风险。因此，投毒风险评估为20%。

**利用方式：**
1.  确定目标Grafana实例的版本是否在受影响范围内 (8.0.0-beta1 to 8.3.0，除已修复版本)。
2.  找到目标Grafana实例上已安装的插件ID。
3.  构造包含目录遍历序列的URL：`/<grafana_host_url>/public/plugins/<plugin ID>/../../../../../../../../../../etc/passwd` （例如）。
4.  发送构造的HTTP请求，尝试读取服务器上的`/etc/passwd`文件或其他敏感文件。
5.  根据返回的内容判断漏洞是否存在，以及是否成功读取了目标文件。


**项目地址:** [rodpwn/CVE-2021-43798-mass_scanner](https://github.com/rodpwn/CVE-2021-43798-mass_scanner)

**漏洞详情:** [CVE-2021-43798](https://nvd.nist.gov/vuln/detail/CVE-2021-43798)